{"version":3,"sources":["ChalkBoard/css/variables.module.scss","ChalkBoard/locales lazy /^/.*/.json$/ groupOptions: {} namespace object","ChalkBoard/data/encryption.js","ChalkBoard/analytics.js","ChalkBoard/constants.js","ChalkBoard/i18n.js","ChalkBoard/colors.js","ChalkBoard/keys.js","ChalkBoard/utils.js","ChalkBoard/appState.js","ChalkBoard/hooks/useCallbackRefState.js","ChalkBoard/element/typeChecks.js","ChalkBoard/math.js","ChalkBoard/points.js","ChalkBoard/element/bounds.js","ChalkBoard/renderer/renderElement.js","ChalkBoard/scene/Scene.js","ChalkBoard/random.js","ChalkBoard/element/mutateElement.js","ChalkBoard/element/sizeHelpers.js","ChalkBoard/groups.js","ChalkBoard/element/newElement.js","ChalkBoard/element/transformHandles.js","ChalkBoard/ga.js","ChalkBoard/galines.js","ChalkBoard/gapoints.js","ChalkBoard/gadirections.js","ChalkBoard/gatransforms.js","ChalkBoard/element/collision.js","ChalkBoard/element/resizeTest.js","ChalkBoard/element/linearElementEditor.js","ChalkBoard/element/binding.js","ChalkBoard/element/resizeElements.js","ChalkBoard/element/dragElements.js","ChalkBoard/element/textWysiwyg.jsx","ChalkBoard/element/textElement.js","ChalkBoard/element/showSelectedShapeActions.js","ChalkBoard/element/index.js","ChalkBoard/scene/scrollbars.js","ChalkBoard/scene/selection.js","ChalkBoard/scene/scroll.js","ChalkBoard/scene/comparisons.js","ChalkBoard/scene/zoom.js","ChalkBoard/errors.js","ChalkBoard/components/Spinner.jsx","ChalkBoard/components/ToolButton.jsx","ChalkBoard/components/icons.jsx","ChalkBoard/actions/register.js","ChalkBoard/actions/actionDeleteSelected.jsx","ChalkBoard/zindex.js","ChalkBoard/actions/actionZindex.jsx","ChalkBoard/actions/actionSelectAll.js","ChalkBoard/actions/actionDuplicateSelection.jsx","ChalkBoard/components/ButtonIconSelect.jsx","ChalkBoard/components/Popover.jsx","ChalkBoard/components/ColorPicker.jsx","ChalkBoard/components/IconPicker.jsx","ChalkBoard/actions/actionProperties.jsx","ChalkBoard/types.js","ChalkBoard/components/DarkModeToggle.jsx","ChalkBoard/components/Tooltip.jsx","ChalkBoard/components/ClearCanvas.jsx","ChalkBoard/actions/actionCanvas.jsx","ChalkBoard/actions/actionFinalize.jsx","ChalkBoard/components/ProjectName.jsx","ChalkBoard/renderer/roundRect.js","ChalkBoard/clients.js","ChalkBoard/renderer/renderScene.js","ChalkBoard/data/filesystem.js","ChalkBoard/data/restore.js","ChalkBoard/data/blob.js","ChalkBoard/data/json.js","ChalkBoard/element/image.js","ChalkBoard/scene/export.js","ChalkBoard/charts.js","ChalkBoard/clipboard.js","ChalkBoard/data/index.js","ChalkBoard/data/resave.js","ChalkBoard/components/CheckboxItem.jsx","ChalkBoard/components/Stack.jsx","ChalkBoard/components/ActiveFile.jsx","ChalkBoard/actions/actionExport.jsx","ChalkBoard/actions/actionStyles.js","ChalkBoard/components/HelpIcon.jsx","ChalkBoard/actions/actionGroup.jsx","ChalkBoard/actions/actionMenu.jsx","ChalkBoard/components/Avatar.jsx","ChalkBoard/actions/actionAddToLibrary.js","ChalkBoard/actions/actionNavigate.jsx","ChalkBoard/align.js","ChalkBoard/actions/actionAlign.jsx","ChalkBoard/disitrubte.js","ChalkBoard/actions/actionDistribute.jsx","ChalkBoard/actions/actionFlip.js","ChalkBoard/actions/actionClipboard.jsx","ChalkBoard/actions/actionToggleGridMode.jsx","ChalkBoard/actions/actionToggleZenMode.jsx","ChalkBoard/actions/actionToggleStats.jsx","ChalkBoard/actions/actionHistory.jsx","ChalkBoard/actions/manager.jsx","ChalkBoard/data/library.js","ChalkBoard/gesture.js","ChalkBoard/history.js","ChalkBoard/shapes.jsx","ChalkBoard/actions/shortcuts.js","ChalkBoard/components/ContextMenu.jsx","ChalkBoard/components/Actions.jsx","ChalkBoard/components/BackgroundPickerAndDarkModeToggle.jsx","ChalkBoard/components/CollabButton.jsx","ChalkBoard/components/ImageExportDialog.jsx","ChalkBoard/components/FixedSideContainer.jsx","ChalkBoard/components/HintViewer.jsx","ChalkBoard/components/Island.jsx","ChalkBoard/components/LibraryUnit.jsx","ChalkBoard/components/LoadingMessage.jsx","ChalkBoard/components/LockButton.jsx","ChalkBoard/components/Section.jsx","ChalkBoard/components/UserList.jsx","ChalkBoard/components/LibraryButton.jsx","ChalkBoard/components/MobileMenu.jsx","ChalkBoard/components/PasteChartDialog.jsx","ChalkBoard/components/HelpDialog.jsx","ChalkBoard/components/Card.jsx","ChalkBoard/components/JSONExportDialog.jsx","ChalkBoard/components/LayerUI.jsx","ChalkBoard/components/Stats.jsx","ChalkBoard/components/Toast.jsx","ChalkBoard/actions/actionToggleViewMode.jsx","ChalkBoard/components/App.jsx","ChalkBoard/excalidraw-app/app_constants.js","ChalkBoard/components/Modal.jsx","ChalkBoard/components/Dialog.jsx","ChalkBoard/components/ErrorDialog.jsx","ChalkBoard/components/TopErrorBoundary.jsx","ChalkBoard/components/InitializeApp.jsx","ChalkBoard/packages/excalidraw/index.jsx","ChalkBoard/excalidraw-app/data/FileManager.js","ChalkBoard/excalidraw-app/data/firebase.js","ChalkBoard/excalidraw-app/data/index.js","ChalkBoard/excalidraw-app/data/localStorage.js","ChalkBoard/excalidraw-app/collab/Portal.jsx","ChalkBoard/excalidraw-app/collab/RoomDialog.jsx","ChalkBoard/excalidraw-app/collab/reconciliation.js","ChalkBoard/excalidraw-app/collab/CollabWrapper.jsx","ChalkBoard/createInverseContext.jsx","ChalkBoard/excalidraw-app/CustomStats.jsx","ChalkBoard/excalidraw-app/components/icons.jsx","ChalkBoard/excalidraw-app/components/ExportToExcalidrawPlus.jsx","ChalkBoard/excalidraw-app/index.jsx","ChalkBoard/excalidraw-app/sentry.js","ChalkBoard/index.js","assets/files.js","TextEditor/TextEditor.js","actions/index.js","MultilanguageEditor/multiFile.js","actions/outputAction.js","IDE.js","Recorder/index.js","Player/index.js","assets/Gear-0.2s-200px.png","TestComponent/index.js","UserSection/index.js","RecorderForm/recorderForm.js","LiveClasses/liveClassEmitter.js","LiveClasses/liveClassReceiver.js","Card/card.js","Lectures/allLectures.js","reducers/filenameSelection.js","reducers/outputModalReducer.js","reducers/languageSelection.js","reducers/index.js","App.js","index.js","ChalkBoard/data/encode.js"],"names":["module","exports","map","webpackAsyncContext","req","Promise","resolve","then","__webpack_require__","o","e","Error","code","id","t","keys","Object","IV_LENGTH_BYTES","createIV","arr","Uint8Array","window","crypto","getRandomValues","generateEncryptionKey","a","subtle","generateKey","name","length","key","exportKey","k","getImportedKey","usage","importKey","alg","ext","key_ops","kty","encryptData","data","importedKey","iv","TextEncoder","encode","Blob","arrayBuffer","buffer","encrypt","encryptedBuffer","decryptData","encrypted","privateKey","decrypt","trackEvent","process","REACT_APP_GOOGLE_ANALYTICS_ID","gtag","category","label","value","event_category","event_label","JEST_WORKER_ID","EVENT","APP_NAME","DRAGGING_THRESHOLD","LINE_CONFIRM_THRESHOLD","ELEMENT_SHIFT_TRANSLATE_AMOUNT","ELEMENT_TRANSLATE_AMOUNT","TEXT_TO_CENTER_SNAP_THRESHOLD","SHIFT_LOCKING_ANGLE","Math","PI","CURSOR_TYPE","TEXT","CROSSHAIR","GRABBING","GRAB","POINTER","MOVE","AUTO","POINTER_BUTTON","MAIN","WHEEL","SECONDARY","TOUCH","ENV","TEST","DEVELOPMENT","CLASSES","SHAPE_ACTIONS_MENU","FONT_FAMILY","Virgil","Helvetica","Cascadia","THEME","LIGHT","DARK","WINDOWS_EMOJI_FALLBACK_FONT","DEFAULT_FONT_SIZE","DEFAULT_FONT_FAMILY","DEFAULT_TEXT_ALIGN","DEFAULT_VERTICAL_ALIGN","DEFAULT_VERSION","GRID_SIZE","MIME_TYPES","excalidraw","excalidrawlib","json","svg","png","jpg","gif","binary","EXPORT_DATA_TYPES","excalidrawClipboard","excalidrawLibrary","EXPORT_SOURCE","location","origin","STORAGE_KEYS","LOCAL_STORAGE_LIBRARY","IMAGE_RENDER_TIMEOUT","TAP_TWICE_TIMEOUT","TOUCH_CTX_MENU_TIMEOUT","TITLE_TIMEOUT","TOAST_TIMEOUT","VERSION_TIMEOUT","SCROLL_TIMEOUT","ZOOM_STEP","IDLE_THRESHOLD","ACTIVE_THRESHOLD","MODES","VIEW","ZEN","GRID","THEME_FILTER","cssVariables","themeFilter","URL_QUERY_KEYS","addLibrary","URL_HASH_KEYS","DEFAULT_UI_OPTIONS","canvasActions","changeViewBackgroundColor","clearCanvas","export","saveFileToDisk","loadScene","saveToActiveFile","theme","saveAsImage","MQ_MAX_WIDTH_PORTRAIT","MQ_MAX_WIDTH_LANDSCAPE","MQ_MAX_HEIGHT_LANDSCAPE","MAX_DECIMALS_FOR_SVG_EXPORT","EXPORT_SCALES","DEFAULT_EXPORT_PADDING","DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT","ALLOWED_IMAGE_MIME_TYPES","MAX_ALLOWED_FILE_BYTES","SVG_NS","defaultLang","languages","rtl","concat","sort","left","right","filter","lang","percentages","TEST_LANG_CODE","unshift","currentLang","currentLangData","setLanguage","document","documentElement","dir","startsWith","getLanguage","findPartsForData","parts","index","part","undefined","path","replacement","JSON","stringify","slice","split","translation","fallbackLangData","replace","shades","oc","red","pink","grape","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","canvasBackground","white","gray","elementBackground","elementStroke","black","isDarwin","test","navigator","platform","isWindows","CODES","KEYS","isArrowKey","shouldResizeFromCenter","event","altKey","shouldMaintainAspectRatio","shiftKey","shouldRotateWithDiscreteAngle","mockDateTime","getDateTime","date","Date","year","getFullYear","month","getMonth","padStart","day","getDate","hr","getHours","min","getMinutes","capitalizeString","str","charAt","toUpperCase","isWritableElement","target","HTMLElement","dataset","type","HTMLBRElement","HTMLTextAreaElement","HTMLInputElement","getFontFamilyString","fontFamily","entries","fontFamilyString","getFontString","fontSize","measureText","text","font","line","createElement","body","style","position","whiteSpace","appendChild","innerText","x","join","width","offsetWidth","height","offsetHeight","span","display","overflow","baseline","offsetTop","removeChild","debounce","fn","timeout","handle","lastArgs","ret","args","clearTimeout","setTimeout","flush","_lastArgs","cancel","distance","y","abs","resetCursor","canvas","cursor","setCursor","setCursorForShape","shape","isFullScreen","fullscreenElement","nodeName","getShortcutKey","shortcut","viewportCoordsToSceneCoords","clientX","clientY","zoom","offsetLeft","scrollX","scrollY","invScale","sceneCoordsToViewportCoords","sceneX","sceneY","getGlobalCSSVariable","getComputedStyle","getPropertyValue","RE_RTL_CHECK","RegExp","isRTL","tupleToCoors","xyTuple","muteFSAbortError","error","isTransparent","color","isRGBTransparent","substr","isRRGGBBTransparent","colors","resolvablePromise","reject","promise","_resolve","_reject","withBatchedUpdates","func","unstable_batchedUpdates","nFormatter","num","digits","si","symbol","toFixed","getVersion","querySelector","content","preventUnload","preventDefault","returnValue","defaultExportScale","includes","devicePixelRatio","getDefaultAppState","collaborators","Map","currentChartType","currentItemBackgroundColor","currentItemEndArrowhead","currentItemFillStyle","currentItemFontFamily","currentItemFontSize","currentItemLinearStrokeSharpness","currentItemOpacity","currentItemRoughness","currentItemStartArrowhead","currentItemStrokeColor","currentItemStrokeSharpness","currentItemStrokeStyle","currentItemStrokeWidth","currentItemTextAlign","cursorButton","draggingElement","editingElement","editingGroupId","editingLinearElement","elementLocked","elementType","errorMessage","exportBackground","exportScale","exportEmbedScene","exportWithDarkMode","fileHandle","gridSize","isBindingEnabled","isLibraryOpen","isLoading","isResizing","isRotating","lastPointerDownWith","multiElement","openMenu","openPopup","pasteDialog","shown","previousSelectedElementIds","resizingElement","scrolledOutside","selectedElementIds","selectedGroupIds","selectionElement","shouldCacheIgnoreZoom","showHelpDialog","showStats","startBoundElement","suggestedBindings","toastMessage","viewBackgroundColor","zenModeEnabled","viewModeEnabled","pendingImageElement","APP_STATE_STORAGE_CONF","browser","server","_clearAppStateForStorage","appState","exportType","stateForExport","propConfig","nextValue","clearAppStateForLocalStorage","cleanAppStateForExport","clearAppStateForDatabase","useCallbackRefState","useState","refValue","setRefValue","useCallback","isInitializedImageElement","element","fileId","isImageElement","isTextElement","isFreeDrawElement","isFreeDrawElementType","isLinearElement","isLinearElementType","isBindingElement","isBindingElementType","isBindableElement","rotate","x1","y1","x2","y2","angle","cos","sin","rotatePoint","point","center","adjustXYWithRotation","sides","deltaX1","deltaY1","deltaX2","deltaY2","w","n","s","distance2d","xd","yd","hypot","isPathALoop","points","zoomValue","first","last","isPointInPolygon","vertices","extreme","Number","MAX_SAFE_INTEGER","p","count","i","current","next","doSegmentsIntersect","orderedColinearOrientation","isPointWithinBounds","q","r","max","val","p1","q1","p2","q2","o1","o2","o3","o4","getGridPoint","round","getSizeFromPoints","xs","ys","rescalePoints","dimension","nextDimensionSize","prevPoints","prevDimValues","prevMaxDimension","prevMinDimension","prevDimensionSize","dimensionScaleFactor","nextMinDimension","Infinity","scaledPoints","prevPoint","currentDimension","scaledValue","scaledPoint","getElementAbsoluteCoords","getFreeDrawElementAbsoluteCoords","getLinearElementAbsoluteCoords","getCurvePathOps","sets","set","ops","getMinMaxXYFromCurvePathOps","transformXY","currentP","reduce","limits","op","p3","p0","equation","idx","pow","minY","minX","maxX","maxY","getBoundsFromPoints","coords","getShapeForElement","getElementBounds","bounds","cx","cy","getLinearElementRotatedBounds","x11","y11","x12","y12","x22","y22","x21","y21","h","ww","hh","getCommonBounds","elements","forEach","getResizedElementAbsoluteCoords","nextWidth","nextHeight","gen","rough","generator","curve","strokeSharpness","linearPath","generateRoughOptions","getElementPointsCoords","sharpness","defaultAppState","isPendingImageElement","sceneState","imageCache","has","getDashArrayDashed","strokeWidth","getDashArrayDotted","getCanvasPadding","IMAGE_PLACEHOLDER_IMG","src","encodeURIComponent","IMAGE_ERROR_PLACEHOLDER_IMG","drawElementOnCanvas","rc","context","globalAlpha","opacity","lineJoin","lineCap","draw","save","fillStyle","strokeColor","pathsCache","get","getFreeDrawPath2D","fill","restore","img","image","fillRect","imageMinWidthOrHeight","size","drawImage","status","drawImagePlaceholder","shouldTemporarilyAttach","isConnected","setAttribute","textAlign","lines","lineHeight","verticalOffset","horizontalOffset","fillText","remove","elementWithCanvasCache","WeakMap","shapeCache","invalidateShapeForElement","delete","continuousPath","options","seed","strokeLineDash","strokeStyle","disableMultiStroke","fillWeight","hachureGap","roughness","stroke","preserveVertices","fixedDecimalPlaceDigits","backgroundColor","curveFitting","generateElementShape","rectangle","topX","floor","rightX","rightY","getDiamondPoints","topY","bottomX","bottomY","leftX","leftY","polygon","ellipse","startArrowhead","endArrowhead","getArrowheadShapes","arrowhead","arrowheadPoints","prevOp","nx","ny","arrow","bar","dot","triangle","px","py","minSize","x3","y3","getArrowheadPoints","circle","x4","y4","dash","shapes","push","generateFreeDrawShape","generateElementWithCanvas","prevElementWithCanvas","shouldRegenerateBecauseZoom","canvasZoom","elementWithCanvas","getContext","padding","canvasOffsetX","canvasOffsetY","ceil","translate","scale","mimeType","generateElementCanvas","drawElementFromCanvas","_isPendingImageElement","scaleXFactor","scaleYFactor","renderElement","renderOptimizations","shiftX","shiftY","roughSVGDrawWithPrecision","rsvg","drawable","precision","pshape","renderElementToSvg","svgRoot","files","offsetX","offsetY","degree","node","group","ownerDocument","createElementNS","getFreeDrawSvgPath","fileData","symbolId","dataURL","prepend","use","direction","textAnchor","textContent","svgPathData","Path2D","inputPoints","simulatePressure","pressures","thinning","smoothing","streamline","easing","lastCommittedPoint","acc","med","TO_FIXED_PRECISION","getSvgPathFromStroke","getStroke","A","B","isIdKey","elementKey","Scene","this","callbacks","Set","nonDeletedElements","elementsMap","getElement","isNonDeletedElement","ids","result","getNonDeletedElement","nextElements","clear","mapElementToScene","getNonDeletedElements","informMutation","Array","from","callback","cb","add","sceneMapById","scene","sceneMapByElement","random","Random","now","randomInteger","randomId","nanoid","mutateElement","updates","didChange","prevScale","nextScale","nextPoints","didChangePoints","nextPoint","version","versionNonce","getScene","newElementWith","bumpVersion","isInvisiblySmallElement","getPerfectElementSize","absWidth","absHeight","lockedAngle","atan","tan","sign","getNormalizedDimensions","selectGroup","groupId","elementsInGroup","groupIds","fromEntries","isSelectedViaGroup","getSelectedGroupForElement","find","getSelectedGroupIds","selectGroupsForSelectedElements","nextAppState","selectedElements","getSelectedElements","indexOfEditingGroup","indexOf","isElementInGroup","getElementsInGroup","addToGroup","prevGroupIds","newGroupId","positionOfEditingGroupId","positionToInsert","splice","_newElementBase","boundElementIds","rest","isDeleted","newElement","opts","getTextElementPositionOffsets","metrics","verticalAlign","newTextElement","offsets","updateTextElement","nextText","nextBaseline","prevMetrics","isFinite","getAdjustedDimensions","newLinearElement","startBinding","endBinding","deepCopyElement","depth","prototype","toString","call","tmp","constructor","create","getPrototypeOf","hasOwnProperty","isArray","duplicateElement","groupIdMapForOperation","overrides","copy","mapper","endIndex","getNewGroupIdsForDuplication","assign","transformHandleSizes","mouse","pen","touch","OMIT_SIDES_FOR_MULTIPLE_ELEMENTS","OMIT_SIDES_FOR_TEXT_ELEMENT","OMIT_SIDES_FOR_LINE_SLASH","nw","se","OMIT_SIDES_FOR_LINE_BACKSLASH","ne","sw","generateTransformHandle","getTransformHandlesFromCoords","pointerType","omitSides","handleWidth","handleHeight","handleMarginX","handleMarginY","dashedLineMargin","centeringOffset","transformHandles","rotation","minimumSizeForEightHandles","getTransformHandles","nvector","reverse","b","isNumber","sub","mul","mulScalar","meet","joinScalar","norm","sqrt","inorm","normalized","inormalized","c","GA","through","to","orthogonal","toTuple","intersect","line1","line2","point1","point2","distanceToLine","pivot","apply","motor","isHittingElementBoundingBoxWithoutHittingElement","threshold","isHittingElementNotConsideringBoundingBox","isPointHittingElementBoundingBox","check","isStrictlyInside","isDraggableFromInside","isElementDraggableFromInside","isInsideCheck","isNearCheck","hitTestPointAgainstElement","isElementSelected","rotatedX","rotatedY","bindingBorderTest","maxBindingGap","isOutsideCheck","elementWidth","elementHeight","smallerDimension","distanceToBindableElement","distanceToRectangle","hitTestFreeDrawElement","hitTestLinear","console","warn","distanceToDiamond","distanceToEllipse","pointRelativeToElement","pointRel","hwidth","hheight","GAPoint","GALine","side","ellipseParamsForTest","tangent","tx","ty","_","xx","yy","ex","ey","rx","ry","qx","qy","intersection","closestPoint","rotatedPoint","P","delta","U","C","d","da","db","pointAbs","side1","side2","relX","relY","some","subshape","hitTestCurveInside","hitTestRoughShape","pointTuple","elementCoords","coordsCenter","GATransform","pointRotated","pointRelToCenterAbs","GADirection","elementPos","pointRelToPos","ax","ay","relativizationToElementCenter","bx","by","determineFocusDistance","relateToCenter","aRel","bRel","m","mabs","nabs","getSortedElementLineIntersections","nearPoint","intersections","gap","corners","getCorners","flatMap","edge","intersectSegment","offsetSegment","getCircleIntersections","getEllipseIntersections","sortedIntersections","i1","i2","hx","hy","segment","offset","squares","discr","discrRoot","xn","yn","radius","findFocusPointForEllipse","relativeDistance","relativeDistanceAbs","orientation","pyo","findFocusPointForRectangulars","maxDistance","tangentPoint","corner","odd","operation","polygonPoints","pointsOnBezierCurves","lineThreshold","retVal","mx","my","pointInBezierEquation","isInsideTransformHandle","transformHandle","getElementWithTransformHandleType","scenePointerX","scenePointerY","transformHandleType","rotationTransformHandle","resizeTest","getTransformHandleTypeFromCoords","RESIZE_CURSORS","getCursorForResizingElement","shouldSwapCursors","rotateResizeCursor","LinearElementEditor","elementId","normalizePoints","activePointIndex","lastUncommittedPoint","isDragging","pointerOffset","startBindingElement","endBindingElement","setState","maybeSuggestBinding","newPoint","createPointAt","movePoint","binding","bindingElement","getHoveredElementForBinding","getPointAtIndexGlobalCoordinates","history","scenePointer","didAddPoint","hitElement","resumeRecording","clickedPointIndex","getPointIndexUnderCursor","bindOrUnbindLinearElement","targetPoint","lastPoint","indexMaybeFromEnd","absoluteCoords","pointHandles","getPointsGlobalCoordinates","POINT_HANDLE_SIZE","pointerOnGrid","_idx","getNormalizedPoints","pointIndex","targetPosition","otherUpdates","deltaX","deltaY","nextCoords","prevCoords","nextCenterX","nextCenterY","prevCenterX","prevCenterY","rotated","linearElement","boundToElementIds","unboundFromElementIds","bindOrUnbindLinearElementEdge","onlyUnbound","bindableElement","otherEdgeBindableElement","startOrEnd","isLinearElementSimpleAndAlreadyBoundOnOppositeEdge","bindLinearElement","unbound","unbindLinearElement","bindOrUnbindSelectedElements","getElligibleElementForBindingElement","maybeBindBindableElement","getElligibleElementsForBindableElementAndWhere","where","maybeBindLinearElement","pointerCoords","hoveredElement","calculateFocusAndGap","otherBinding","isLinearElementSimpleAndAlreadyBound","alreadyBoundToId","unbindLinearElements","field","getElementAtPosition","getElements","edgePointIndex","adjacentPointIndex","edgePoint","adjacentPoint","focus","updateBoundElements","changedElement","newSize","simultaneouslyUpdated","simultaneouslyUpdatedElementIds","getSimultaneouslyUpdatedElementIds","doesNeedUpdate","maybeCalculateNewGapWhenScaling","updateBoundPoint","boundElement","newEdgePoint","focusPointAbsolute","adjecentPoint","adjecentPointRel","reverseRelateToCenter","determineFocusPoint","intersectElementWithLine","pointFromAbsoluteCoords","currentBinding","newWidth","newHeight","getElligibleElementsForBindingElement","getLinearElementEdgeCoors","canBindStart","isLinearElementEligibleForNewBindingByBindable","canBindEnd","maybeElement","fixBindingsAfterDuplication","sceneElements","oldElements","oldIdToDuplicatedId","duplicatesServeAsOld","allBoundElementIds","allBindableElementIds","shouldReverseRoles","oldElement","boundElementId","newBindingAfterDuplication","fixBindingsAfterDeletion","deletedElements","deletedElementIds","deletedElement","newBindingAfterDeletion","normalizeAngle","rotateSingleElement","pointerX","pointerY","atan2","reshapeSingleTwoPointElement","resizeArrowDirection","getPerfectElementSizeWithRotation","nextElementX","nextElementY","rescalePointsInElement","measureFontSizeFromWH","nextFontSize","resizeSingleTextElement","nextFont","getSidesForTransformHandle","resizeSingleElement","stateAtResizeStart","transformHandleDirection","startTopLeft","startBottomRight","startCenter","rotatedPointer","esx1","esy1","boundsCurrentWidth","boundsCurrentHeight","scaleX","scaleY","eleInitialWidth","eleInitialHeight","eleNewWidth","eleNewHeight","widthRatio","heightRatio","ratio","newBoundsX1","newBoundsY1","newBoundsWidth","newBoundsHeight","newTopLeft","bottomLeft","topRight","rotatedTopLeft","newCenter","rotatedNewCenter","rescaledPoints","newOrigin","resizedElement","resizeMultipleElements","getNextXY","origX1","origY1","finalX1","finalY1","origX2","origY2","finalX2","finalY2","prev","origCoords","finalCoords","rotateMultipleElements","pointerDownState","centerX","centerY","centerAngle","origAngle","originalElements","rotatedCX","rotatedCY","dragNewElement","originX","originY","widthAspectRatio","newX","newY","normalizeText","getTransform","maxWidth","translateX","translateY","redrawTextBoundingBox","showSelectedShapeActions","Boolean","getElementMap","getSceneVersion","el","_clearElements","clearElementsForDatabase","clearElementsForExport","clearElementsForLocalStorage","SCROLLBAR_COLOR","getScrollBars","viewportWidth","viewportHeight","horizontal","vertical","elementsMinX","elementsMinY","elementsMaxX","elementsMaxY","viewportWidthWithZoom","viewportHeightWithZoom","viewportWidthDiff","viewportHeightDiff","safeArea","top","parseInt","bottom","viewportMinX","viewportMinY","viewportMaxX","viewportMaxY","sceneMinX","sceneMinY","sceneMaxX","sceneMaxY","SCROLLBAR_MARGIN","isOverScrollBars","scrollBars","scrollBar","isOverHorizontal","isOverVertical","isOverEither","isSomeElementSelected","getTargetElements","centerScrollOn","scenePoint","viewportDimensions","calculateScrollCenter","getVisibleElements","cords","viewportX1","viewportY1","viewportX2","viewportY2","isOutsideViewPort","minDistance","closestElement","getClosestElementBounds","hasBackground","hasStrokeColor","hasStrokeWidth","hasStrokeStyle","canChangeSharpness","hasText","canHaveArrowheads","isAtPositionFn","getNewZoom","newZoomValue","prevZoom","canvasOffset","zoomOnViewportPoint","getNormalizedZoom","normalizedZoom","parseFloat","CanvasError","message","AbortError","DOMException","Spinner","circleWidth","className","viewBox","strokeMiterlimit","ToolButton","React","forwardRef","props","ref","excalId","useExcalidrawContainer","innerRef","useRef","useImperativeHandle","sizeCn","setIsLoading","isMountedRef","onClick","useEffect","lastPointerTypeRef","clsx","visible","hidden","ToolIcon","selected","title","disabled","icon","keyBindingLabel","showAriaLabel","children","onPointerDown","onPointerUp","requestAnimationFrame","onChange","checked","defaultProps","activeElementColor","iconFillColor","handlerColor","createIcon","mirror","focusable","role","checkIcon","link","saveAs","load","clipboard","trash","palette","exportFile","exportImage","exportToFileIcon","zoomIn","zoomOut","done","menu","undo","redo","questionCircle","share","shareIOS","shareWindows","BringForwardIcon","memo","SendBackwardIcon","BringToFrontIcon","SendToBackIcon","AlignTopIcon","strokeLinecap","AlignBottomIcon","AlignLeftIcon","AlignRightIcon","DistributeHorizontallyIcon","DistributeVerticallyIcon","CenterVerticallyIcon","strokeDasharray","CenterHorizontallyIcon","start","stop","close","back","marginLeft","clone","shield","file","GroupIcon","UngroupIcon","FillHachureIcon","fillRule","clipRule","FillCrossHatchIcon","FillSolidIcon","StrokeWidthIcon","StrokeStyleSolidIcon","StrokeStyleDashedIcon","StrokeStyleDottedIcon","SloppinessArchitectIcon","SloppinessArtistIcon","SloppinessCartoonistIcon","EdgeSharpIcon","EdgeRoundIcon","ArrowheadNoneIcon","ArrowheadArrowIcon","flip","transform","ArrowheadDotIcon","ArrowheadBarIcon","ArrowheadTriangleIcon","FontSizeSmallIcon","FontSizeMediumIcon","FontSizeLargeIcon","FontSizeExtraLargeIcon","FontFamilyHandDrawnIcon","FontFamilyNormalIcon","FontFamilyCodeIcon","TextAlignLeftIcon","TextAlignCenterIcon","TextAlignRightIcon","actions","register","action","handleGroupEditingState","siblingElements","actionDeleteSelected","perform","commitToHistory","deleteSelectedElements","contextItemLabel","keyTest","PanelComponent","updateData","getIndicesToMove","selectedIndices","deletedIndices","includeDeletedIndex","getTargetIndex","boundaryIndex","sourceElement","indexFilter","candidateIndex","array","fromIndex","findLastIndex","findIndex","nextElement","siblingGroupId","elementsInSiblingGroup","getTargetElementsMap","indices","shiftElements","indicesToMove","targetElementsMap","groupedIndices","toContiguousGroups","leadingIndex","trailingIndex","targetIndex","leadingElements","targetElements","displacedElements","trailingElements","shiftElementsToEnd","groupElements","values","moveOneLeft","moveOneRight","moveAllLeft","moveAllRight","actionSendBackward","keyPriority","actionBringForward","actionSendToBack","actionBringToFront","actionSelectAll","actionDuplicateSelection","selectedPoint","duplicateElements","groupIdMap","newElements","duplicateAndOffsetElement","finalElements","ButtonIconSelect","option","active","Popover","onCloseRequest","fitInViewport","popoverRef","useLayoutEffect","getBoundingClientRect","innerWidth","innerHeight","handler","contains","addEventListener","removeEventListener","isValidColor","Option","keyBindings","flat","Picker","onClose","showInput","firstItem","activeItem","gallery","colorInput","onKeyDown","activeElement","nextIndex","toLowerCase","nativeEvent","stopImmediatePropagation","stopPropagation","tabIndex","_color","_colorWithoutHash","currentTarget","log","onFocus","ColorInput","innerValue","setInnerValue","inputRef","changeColor","inputValue","getColor","spellCheck","onBlur","ColorPicker","isActive","setActive","pickerButton","Suspense","fallback","changedColor","rFirstItem","rActiveItem","rGallery","pressedOption","keyBinding","metaKey","ctrlKey","IconPicker","rPickerButton","UserIdleState","changeProperty","getFormValue","getAttribute","defaultValue","attributes","getCommonAttributeOfSelectedElements","DarkModeToggle","step","onWheel","shouldUpdateForNonLinearElements","every","shouldUpdateForLinearElements","ICONS","MOON","SUN","getTooltipDiv","existingDiv","div","classList","Tooltip","long","onPointerEnter","item","tooltip","minWidth","itemX","itemBottom","itemTop","itemWidth","labelWidth","labelHeight","margin","updateTooltip","onPointerLeave","ClearCanvas","onConfirm","showDialog","setShowDialog","toggleDialog","useIsMobile","small","zoomToFitElements","app","_elements","zoomToSelection","commonBounds","commonBoundsWidth","zoomValueForWidth","commonBoundsHeight","zoomValueForHeight","smallestZoomValue","zoomAdjustedToSteps","zoomValueToFitBoundsOnViewport","newZoom","actionFinalize","marginInlineStart","focusContainer","multiPointElement","isLoop","linePoints","firstPoint","ProjectName","fileName","setFileName","htmlFor","isNameEditable","parent","parentElement","focusNearestParent","isComposing","keyCode","blur","roundRect","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","getClientColors","clientId","currentUser","sum","charCodeAt","backgrounds","strokes","background","hasEmojiSupport","ctx","textBaseline","getImageData","supportsEmoji","strokeRectWithRotation","strokeRect","fillCircle","arc","strokeGrid","renderLinearPointHandles","lineWidth","setLineDash","renderScene","renderScrollbars","renderSelection","renderGrid","isExport","atLeastOneVisibleElement","setTransform","normalizedCanvasWidth","normalizedCanvasHeight","hasTransparence","clearRect","zoomTranslationX","zoomTranslationY","visibleElements","isVisibleElement","suggestedBinding","renderBindingHighlight","selections","selectionColors","remoteSelectedElementIds","socketId","elementX1","elementY1","elementX2","elementY2","addSelectionForGroupId","selection","renderSelectionBorder","locallySelectedElements","renderTransformHandles","dashedLinePadding","initialLineDash","getLineDash","remotePointerViewportCoords","isOutOfBounds","userState","remotePointerUserStates","AWAY","remotePointerButton","username","remotePointerUsernames","idleState","IDLE","ACTIVE","usernameAndIdleState","paddingHorizontal","paddingVertical","measure","measureHeight","actualBoundingBoxDescent","actualBoundingBoxAscent","SCROLLBAR_WIDTH","elementProperties","dashWidth","spaceWidth","lineDashOffset","renderHighlight","renderBindingHighlightForSuggestedPointBinding","renderBindingHighlightForBindableElement","strokeOffset","strokeDiamondWithRotation","strokeEllipseWithRotation","canvasWidth","canvasHeight","viewTransformations","topLeftSceneCoords","bottomRightSceneCoords","renderSceneToSvg","fileOpen","mimeTypes","extensions","_fileOpen","description","multiple","legacySetup","input","scheduleRejection","focusHandler","checkForFile","KEYUP","POINTER_UP","FOCUS","interval","setInterval","rejectPromise","clearInterval","fileSave","blob","_fileSave","extension","AllowedExcalidrawElementTypes","diamond","freedraw","restoreElementWithProperties","extra","base","restoreElement","fontFamilyName","fontPx","_fontFamily","restoreElements","localElements","localElementsMap","migratedElement","localElement","restoreAppState","localAppState","suppliedValue","localValue","parseFileContents","decodePngMetadata","contents","reader","FileReader","readAsText","onloadend","readyState","DONE","decodeSvgMetadata","getFileHandleType","match","isImageFileHandle","isSupportedImageFile","loadFromBlob","parse","isValidExcalidrawData","loadLibraryFromBlob","canvasToBlob","toBlob","generateIdFromFile","digest","hashBuffer","byte","getDataURL","onload","onerror","readAsDataURL","dataURLToFile","filename","dataIndexStart","byteString","atob","ab","ArrayBuffer","ia","File","resizeImageFile","maxWidthOrHeight","all","res","default","pica","imageBlobReduce","features","fileType","SVGStringToFile","SVGString","filterOutDeletedFiles","nextFiles","serializeAsJSON","source","saveAsJSON","serialized","loadFromJSON","isValidLibrary","saveLibraryAsJSON","library","loadLibrary","libraryItems","importLibraryFromJSON","importLibrary","loadHTMLImageElement","Image","updateImageCache","fileIds","updatedFiles","erroredFiles","promises","imagePromise","getInitializedImageElements","normalizeSVG","doc","DOMParser","parseFromString","hasAttribute","outerHTML","SVG_EXPORT_TAG","exportToCanvas","exportPadding","createCanvas","getCanvasSize","exportToSvg","metadata","encodeSvgMetadata","innerHTML","rect","BAR_WIDTH","BAR_GAP","BAR_HEIGHT","NOT_SPREADSHEET","VALID_SPREADSHEET","tryParseNumber","exec","isNumericColumn","columnIndex","tryParseCells","cells","numCols","reason","hasHeader","spreadsheet","labels","valueColumnIndex","labelColumnIndex","rows","row","bgColors","commonProps","getChartDimentions","chartWidth","chartHeight","chartBaseElements","debug","debugRect","chartXLabels","minYLabel","toLocaleString","chartYLabels","chartLines","renderSpreadsheet","chartType","dots","chartTypeLine","bars","barHeight","chartTypeBar","CLIPBOARD","PREFER_APP_CLIPBOARD","probablySupportsClipboardReadText","probablySupportsClipboardWriteText","probablySupportsClipboardBlob","HTMLCanvasElement","copyToClipboard","copyTextToSystemClipboard","getAppClipboard","parsePotentialSpreadsheet","trim","numColsFirstLine","transposedResults","nextCells","col","nextCellRow","transposeCells","tryParseSpreadsheet","getSystemClipboard","clipboardData","getData","readText","parseClipboard","systemClipboard","spreadsheetResult","appClipboardData","systemClipboardData","copyBlobToClipboardAsPng","write","ClipboardItem","copied","writeText","copyTextViaExecCommand","textarea","border","yPosition","pageYOffset","scrollTop","success","select","setSelectionRange","execCommand","exportCanvas","tempSvg","tempCanvas","encodePngMetadata","resaveAsImageWithScene","fileHandleType","CheckboxItem","align","justifyContent","alignItems","justifyItems","ActiveFile","onSave","actionSaveFileToDisk","appProps","allElements","exportedElements","trunc","getExportSize","scaleButtonTitle","fileHandleExists","nativeFileSystemSupported","copiedStyles","loadedElements","loadedAppState","marginTop","marginBottom","actionCopyStyles","actionPasteStyles","pastedElement","HelpIcon","enableActionGroup","requestFullscreen","exitFullscreen","allElementsInSameGroup","actionGroup","selectedGroupId","elementIdsInGroup","updatedElements","lastElementInGroup","lastGroupElementIndex","lastIndexOf","elementsAfterGroup","elementsBeforeGroup","updatedElement","updatedElementsInOrder","contextItemPredicate","actionUngroup","nextGroupIds","removeFromSelectedGroups","Avatar","actionAddToLibrary","collaborator","shortName","names","substring","firstName","lastName","getClientInitials","pointer","items","saveLibrary","getMaximumGroups","groups","currentGroupMembers","calculateTranslation","selectionBoundingBox","axis","groupBoundingBox","getCommonBoundingBox","noTranslation","alignSelectedElements","alignment","alignElements","updatedElementsMap","midX","midY","distributeSelectedElements","distribution","mid","end","extent","index0","g","index1","pos","box","distributeElements","actionFlipHorizontal","space","flipSelectedElements","eligibleElements","enableActionFlipHorizontal","actionFlipVertical","enableActionFlipVertical","flipDirection","flipElements","flipElement","rotateElement","originalX","originalY","originalAngle","finalOffsetX","usingNWHandle","newNCoordsX","nHandle","rotationAngle","actionCopy","actionCut","actionCopyAsSvg","_data","actionCopyAsPng","exportSelection","exportColorScheme","actionToggleGridMode","actionToggleZenMode","actionToggleStats","writeData","prevElements","updater","prevElementMap","nextElementMap","prevElement","syncHistory","ActionManager","getAppState","getElementsIncludingDeleted","renderAction","UIOptions","formState","actionResult","registerAction","Library","libraryCache","resetLibrary","onLibraryChange","restoreLibraryItem","libraryItem","libraryItemsFromStorage","prevLibraryItems","serializedItems","libraryFile","isUniqueitem","existingLibraryItems","targetLibraryItem","libItemExcalidrawItem","filtered","restoredItem","getCenter","pointers","allCoords","getDistance","clearAppStatePropertiesForHistory","History","elementCache","recording","stateHistory","redoStack","lastEntry","generateEntry","dehydrateHistoryEntry","dehydratedExcalidrawElement","versions","dehydratedHistoryEntry","hydrateHistoryEntry","nextEntry","newEntryDehydrated","newEntry","shouldCreateEntry","clearRedoStack","entryToRestore","pop","currentEntry","state","pushEntry","SHAPES","shortcutMap","cut","paste","copyStyles","pasteStyles","selectAll","duplicateSelection","sendBackward","bringForward","sendToBack","bringToFront","copyAsPng","copyAsSvg","ungroup","gridMode","zenMode","stats","addToLibrary","flipHorizontal","flipVertical","viewMode","getShortcutFromShortcutName","shortcuts","ContextMenu","actionManager","onContextMenu","actionName","dangerous","checkmark","executeAction","contextMenuNodeByContainer","params","of","render","container","contextMenuNode","unmountComponentAtNode","handleClose","getContextMenuNode","SelectedShapeActions","isEditing","isMobile","showFillIcons","showChangeBackgroundIcons","commonSelectedType","ShapesSwitcher","setAppState","onImageAction","letter","ZoomActions","BackgroundPickerAndDarkModeToggle","showThemeBtn","CollabButton","isCollaborating","collaboratorCount","supportsContextFilters","ErrorCanvasPreview","renderPreview","previewNode","ExportButton","shade","OpenColor","ImageExportModal","onExportToPng","onExportToSvg","onExportToClipboard","someElementIsSelected","exportSelected","setExportSelected","previewRef","catch","gridTemplateColumns","userSelect","ImageExportDialog","modalIsShown","setModalIsShown","FixedSideContainer","HintViewer","hint","multiMode","targetElement","getHints","Island","PLUS_ICON","LibraryUnit","pendingElements","onRemoveFromLibrary","elementsToRender","isHovered","setIsHovered","adder","onMouseEnter","onMouseLeave","draggable","onDragStart","dataTransfer","setData","LoadingMessage","CHECKED","xmlns","UNCHECKED","LockButton","Section","heading","header","UserList","mobile","UserList_mobile","LIBRARY_ICON","LibraryButton","MobileMenu","libraryMenu","renderJSONExportDialog","renderImageExportDialog","onCollabButtonClick","onLockToggle","renderCustomFooter","renderTopRightUI","insertOnCanvasDirectly","marginRight","client","Fragment","ChartPreviewBtn","chartElements","setChartElements","parentNode","PasteChartDialog","onInsertChart","handleChartClick","autofocus","Columns","flexDirection","flexWrap","Column","ShortcutIsland","caption","Shortcut","flex","isOr","ShortcutKey","HelpDialog","Card","JSONExportModal","exportOpts","onExportToBackend","renderCustomUI","JSONExportDialog","LibraryMenuItems","onAddToLibrary","onInsertShape","setLibraryItems","libraryReturnUrl","numCells","CELLS_PER_ROW","numRows","addedPendingElements","pathname","confirm","shouldAddPendingElements","bind","LibraryMenu","onClickOutside","listener","Element","useOnClickOutside","closest","loadingState","loadingTimerRef","race","Libraries","removeFromLibrary","indexToRemove","nextItems","LayerUI","onInsertElements","showExitZenModeBtn","toggleZenMode","createExporter","Separator","closeLibrary","deselectItems","dialogs","zIndex","renderTopUI","areEqual","getNecessaryObj","prevAppState","langCode","Stats","boundingBox","selectedBoundingBox","colSpan","renderCustomStats","Toast","clearToast","timerRef","scheduleTimeout","actionToggleViewMode","IsMobileContext","createContext","useContext","ExcalidrawContainerContext","didTapTwice","tappedTwiceTimer","cursorX","cursorY","isHoldingSpace","isPanning","isDraggingScrollBar","currentScrollBars","touchTimeout","invalidateContextMenu","lastPointerUp","gesture","lastCenter","initialDistance","initialScale","App","unmounted","trusted","excalidrawContainerRef","createRef","autoFocus","getSceneElementsIncludingDeleted","getSceneElements","syncActionResult","replaceAllElements","replaceFiles","addNewImagesToImageCache","gridModeEnabled","setCurrentState","onUnload","disableEvent","onFontLoaded","onSceneUpdated","importLibraryFromUrl","url","token","hash","URLSearchParams","replaceState","search","query","fetch","decodeURIComponent","request","numShapes","alert","resetHistory","resetScene","resetLoadingState","initializeScene","launchQueue","setConsumer","launchParams","getFile","initialData","scrollToContent","libraryUrl","onResize","onScroll","getCanvasOffsets","onCut","cutAll","onCopy","copyAll","onTapStart","resetTapTwice","touches","handleCanvasDoubleClick","onTapEnd","pasteFromClipboard","elementUnderCursor","elementFromPoint","string","endsWith","imageElement","createImageElement","insertImageElement","initializeImageDimensions","onPaste","addElementsFromPasteOrLibrary","addTextFromPaste","selectShapeTool","elementsCenterX","elementsCenterY","dx","dy","gridX","gridY","obj","removePointer","pointerId","toggleLock","prevState","toggleStats","setToastMessage","restoreFileFromShare","caches","open","webShareTargetCache","loadFileToCanvas","addFiles","filesMap","updateScene","sceneData","updateCurrentCursorPosition","Proxy","ev","prop","HTMLSelectElement","handleKeyDown","maybeSuggestBindingForAll","selectedElement","startTextEditing","findShapeByKey","onKeyUp","onGestureStart","onGestureChange","onGestureEnd","insertAtParentCenter","existingTextElement","getTextElementAtPosition","parentCenterPosition","getTextWysiwygSnappedToCenterPosition","elementCenterX","elementCenterY","handleTextWysiwyg","isExistingElement","getSelectedGroupIdForElement","handleCanvasPointerMove","savePointer","scaleFactor","resetShouldCacheIgnoreZoomDebounced","isOverScrollBar","handlePointerMove","maybeSuggestBindingAtCursor","maybeSuggestBindingForLinearElementAtCursor","buttons","elementWithTransformHandleType","isHittingCommonBoundingBoxOfSelectedElements","handleTouchMove","handleCanvasPointerDown","isTrusted","getSelection","anchorNode","removeAllRanges","maybeOpenContextMenuAfterPointerDownOnTouchDevices","maybeCleanupAfterMissingPointerUp","handleCanvasPanUsingWheelOrSpaceDrag","button","updateGestureOnPointerDown","initialPointerDownState","handleDraggingScrollBar","clearSelectionIfNotUsingSelection","updateBindingEnabledOnPointerMove","handleSelectionOnPointerDown","handleTextOnPointerDown","handleLinearElementOnPointerDown","handleFreeDrawElementOnPointerDown","createGenericElementOnPointerDown","onPointerMove","onPointerMoveFromPointerDownHandler","onPointerUpFromPointerDownHandler","onKeyDownFromPointerDownHandler","onKeyUpFromPointerDownHandler","POINTER_MOVE","KEYDOWN","eventListeners","onMove","onUp","handleCanvasContextMenu","nextPastePrevented","isLinux","lastX","lastY","preventNextPaste","PASTE","enableNextPaste","teardown","BLUR","passive","resize","handleType","getResizeOffsetXY","arrowDirection","getResizeArrowDirection","handlePointerDown","hit","allHitElements","getElementsAtPosition","someHitElementIsSelected","isASelectedElement","hasHitCommonBoundingBoxOfSelectedElements","clearSelection","wasAddedToSelection","pressure","initializeImage","imageFile","_imageElement","showCursorImagePreview","generateIdForFile","existingFileData","maxSize","resizedFile","setImagePreviewCursor","created","cachedImageData","cursorImageSizePx","imagePreview","previewDataURL","toDataURL","forceNaturalSize","placeholderSize","minHeight","maxHeight","naturalHeight","naturalWidth","_updateImageCache","imageElements","uncachedImageElements","scheduleImageRefresh","throttle","shouldEnableBinding","shouldEnableBindingForPointerEvent","hoveredBindableElement","oppositeBindingBoundElement","handleCanvasRef","handleWheel","TOUCH_START","TOUCH_END","handleAppOnDrop","getAsFileSystemHandle","libraryShapes","preferSelected","_openContextMenu","maybeDragNewGenericElement","lastCoords","aspectRatio","originInGrid","maybeHandleResize","resizeX","resizeY","transformElements","maybeGroupAction","maybeUngroupAction","maybeFlipHorizontal","maybeFlipVertical","separator","viewModeOptions","appStates","log10","isNaN","onPointerUpdate","pointersMap","updateDOMRect","currentWidth","currentHeight","currentOffsetTop","currentOffsetLeft","refresh","excalidrawRef","readyPromise","api","ready","getFiles","excalidrawContainerValue","registerAll","undoOnce","redoOnce","createRedoAction","canvasScale","canvasDOMWidth","canvasDOMHeight","onPointerCancel","onTouchMove","onDoubleClick","renderFooter","onDrop","handleKeyboardGlobally","Provider","renderCanvas","defineProperties","configurable","addCallback","addEventListeners","resizeObserver","ResizeObserver","observe","matchMedia","mediaQuery","matches","addListener","detachIsMobileMqHandler","removeListener","disconnect","removeEventListeners","destroy","COPY","CUT","nearestScrollableContainer","SCROLL","MOUSE_MOVE","RESIZE","UNLOAD","DRAG_OVER","DROP","GESTURE_START","GESTURE_CHANGE","GESTURE_END","detail","fonts","detectScroll","overflowY","scrollHeight","clientHeight","getNearestScrollableContainer","prevProps","updateLanguage","deselectElements","toggle","pointerViewportCoords","pointerUsernames","pointerUserStates","user","renderingElements","record","updateElement","_element","onSubmit","getViewportCoords","excalidrawContainer","updateWysiwygStyle","viewportX","viewportY","editable","wrap","backfaceVisibility","outline","oninput","onkeydown","submittedViaKeyboard","handleSubmit","outdent","indent","dispatchEvent","Event","TAB","repeat","RE_LEADING_TAB","selectionStart","selectionEnd","linesStartIndices","getSelectedLinesStartIndices","startIndex","startValue","endValue","removedTabs","tabMatch","startOffset","startIndices","stopEvent","cleanup","viaKeyboard","isDestroyed","onblur","observer","bindBlurEvent","unbindUpdate","SVGElement","capture","textWysiwyg","elementWithHighestZIndex","hitTest","withCmdOrCtrl","scrollbars","hasBeenDuplicated","drag","hasOccurred","handlePointerMoveOverScrollbars","getDragOffsetXY","didDrag","handlePointDragging","hasHitASelectedElement","dragX","dragY","dragDistanceX","dragDistanceY","lockDirection","distanceX","distanceY","lockX","lockY","original","dragSelectedElements","elementsToAppend","duplicatedElement","originDragX","originDragY","nextSceneElements","elementsWithinSelection","selectionX1","selectionY1","selectionX2","selectionY2","getElementsWithinSelection","childEvent","handlePointerUp","idsOfSelectedElementsThatAreInGroups","prevId","_prevState","gId","includedElementIds","getEligibleElementsForBinding","elementClickedInside","getElementContainingPosition","Component","SCENE","Modal","modalRoot","useBodyRoot","createPortal","labelledBy","setDiv","isMobileRef","isDarkTheme","Dialog","islandNode","setIslandNode","lastActiveElement","focusableElements","queryFocusableElements","currentIndex","querySelectorAll","ErrorDialog","TopErrorBoundary","arguments","hasError","sentryEventId","localStorage","errorSplash","errorInfo","_localStorage","Sentry","scope","setExtras","eventId","templateStrFn","reload","createGithubIssue","selectTextArea","readOnly","InitializeApp","loading","setLoading","updateLang","Excalidraw","nextProps","prevUIOptions","nextUIOptions","prevUIOptionsKeys","nextUIOptionsKeys","isUIOptionsSame","prevKeys","nextKeys","forwardedRefComp","FILE_UPLOAD_MAX_BYTES","BROADCAST","FIREBASE_STORAGE_PREFIXES","FileManager","saveFiles","fetchingFiles","savingFiles","savedFiles","isFileHandled","isFileSaved","addedFiles","_saveFiles","loadedFiles","_getFiles","shouldPreventUnload","shouldUpdateImageElementStatus","encodeFilesForUpload","maxBytes","encryptionKey","processedFiles","compressData","encodedFile","byteLength","updateStaleImageStatuses","excalidrawAPI","FIREBASE_CONFIG","firebasePromise","firestorePromise","firebaseStoragePromise","isFirebaseInitialized","_loadFirebase","firebase","initializeApp","_getFirebase","loadFirestore","loadFirebaseStorage","encryptElements","encoded","ciphertext","decryptElements","decrypted","decodedData","TextDecoder","decode","firebaseSceneVersionCache","isSavedToFirebase","portal","socket","roomId","roomKey","sceneVersion","saveFilesToFirebase","prefix","storage","put","cacheControl","saveToFirebase","nextDocData","firestore","fromUint8Array","docRef","collection","runTransaction","transaction","exists","update","didUpdate","loadFromFirebase","storedScene","toUint8Array","loadFilesFromFirebase","decryptionKey","filesIds","storageBucket","response","decompressData","byteToHex","generateRandomID","encryptAESGEM","decryptAESGEM","getCollaborationLinkData","URL","generateCollaborationLinkData","decryptImported","importFromBackend","ok","fixedIv","localDataState","exportToBackend","cryptoKey","payloadBlob","Response","payload","exportedKey","filesToUpload","method","href","urlString","prompt","error_class","importUsernameFromLocalStorage","getItem","saveToLocalStorage","setItem","getElementsStorageSize","getTotalStorageSize","collab","APP_STORAGE_KEYS","Portal","socketInitialized","broadcastedElementVersions","queueFileUpload","fileManager","broadcastScene","sceneType","syncAll","INIT","syncableElements","isSyncableElement","syncableElement","broadcastPromise","_broadcastSocketData","saveCollabRoomToFirebase","broadcastIdleChange","broadcastMouseLocation","on","emit","_socketId","clients","setCollaborators","volatile","isOpen","getShareIcon","isAppleBrowser","vendor","isWindowsBrowser","appVersion","RoomDialog","activeRoomLink","onUsernameChange","onRoomCreate","onRoomDestroy","setErrorMessage","roomLinkInput","copyRoomLink","shareRoomLink","selectInput","onKeyPress","shouldDiscardRemoteElement","local","remote","initialValue","Context","InverseConsumer","_updateProviderValue","InverseProvider","Consumer","createInverseContext","CollabContext","CollabContextConsumer","CollabContextProvider","CollabWrapper","lastBroadcastedOrReceivedSceneVersion","destroySocketClient","isUnload","beforeUnload","getSyncableElements","timestamp","room","openPortal","initializeSocketClient","closePortal","queueBroadcastAllElements","loadImageFiles","pushState","onRoomClose","reset","fetchImageFilesFromFirebase","unfetchedImages","existingRoomLinkData","scenePromise","socketIOClient","broadcastElements","socketInitializationTimer","initializeSocket","encryptedData","decryptedData","UPDATE","remoteElements","reconciledElements","reconcileElements","handleRemoteSceneUpdate","init","socketID","off","initializeIdleDetector","localElementsData","duplicates","remoteElementIdx","remoteElement","_reconcileElements","setLastBroadcastedOrReceivedSceneVersion","idleTimeoutId","reportIdle","activeIntervalId","reportActive","onVisibilityChange","onIdleStateChange","VISIBILITY_CHANGE","getLastBroadcastedOrReceivedSceneVersion","currentVersion","newVersion","saveUsernameToLocalStorage","contextValue","getContextValue","BEFORE_UNLOAD","sockets","PureComponent","getStorageSizes","total","CustomStats","storageSizes","setStorageSizes","sizes","excalidrawPlusIcon","exportToExcalidrawPlus","customMetadata","ExportToExcalidrawPlus","onError","filesStore","createStore","clearObsoleteFilesFromIndexedDB","allIds","currentFileIds","del","localFileStorage","getMany","filesData","languageDetector","LanguageDetector","languageUtils","formatLanguageCode","isWhitelisted","checkWhitelist","saveDebounced","onFilesSaved","searchParams","jsonBackendMatch","externalUrlMatch","roomLinkData","isExternalScene","once","collabAPI","ExcalidrawWrapper","currentLangCode","detect","initialStatePromiseRef","excalidrawRefCallback","loadImages","isInitialLoad","onHashChange","oldURL","titleTimeout","HASHCHANGE","unloadHandler","cacheUserLanguage","isTinyDevice","borderRadius","rel","removeItem","newEl","ExcalidrawApp","SentryEnvHostnameMap","onlineEnv","REACT_APP_DISABLE_SENTRY","hostname","dsn","environment","release","REACT_APP_GIT_SHA","ignoreErrors","integrations","SentryIntegrations","levels","beforeSend","__EXCALIDRAW_SHA__","ChalkBoard","language","TextEditor","srcDoc","useSelector","srcDocs","logs","setLogs","dispatch","useDispatch","getElementsByClassName","Hook","contentWindow","currLogs","Unhook","frame","contentDocument","fra","defaultLanguage","saveViewState","cursorSmoothCaretAnimation","frameBorder","variant","MultiFile","setModal","outputValue","setOutputValue","setInputValue","class","words","axios","post","stdin","versionIndex","script","runCode","output","CustomEvent","fontWeight","beforeMount","monaco","editor","defineTheme","inherit","rules","cols","placeholder","startTime","Recorder","lectureType","languageType","childValue","Recording","events","lastMouse","lastKey","lastKeyClass","handlers","eventName","time","pageX","pageY","Mp3Recorder","MicRecorder","bitRate","startRecording","stopRecording","recordingString","createdAt","FieldValue","serverTimestamp","lectureName","creator","lectureCreator","audioString","getMp3","lastModified","storageRef","lectureData","audio","child","putString","snapshot","IDE","parentCallBack","childData","Preloader","Video","useParams","setRefresh","startPlay","playerBlock","videoPlayer","playButton","audioPlayer","getElementById","offsetPlay","paused","FieldPath","documentId","snap","err","getDownloadURL","fakeCursor","playerPlay","playfunction","playerPause","pausefunction","frames","eve","PointerEvent","bubbles","cancelable","handleButtonEvents","tar","KeyboardEvent","clickEvent","MouseEvent","click","flashClass","drawEvent","charCode","play","pause","curTime","currentTime","controls","controlsList","Test","apps","apiKey","authDomain","projectId","messagingSenderId","appId","measurementId","pc","RTCPeerConnection","iceServers","urls","iceCandidatePoolSize","localStream","remoteStream","webcamButton","webcamVideo","callButton","callInput","answerButton","remoteVideo","hangupButton","onclick","mediaDevices","getUserMedia","video","MediaStream","getTracks","track","addTrack","ontrack","streams","srcObject","callDoc","offerCandidates","answerCandidates","onicecandidate","candidate","toJSON","createOffer","offerDescription","setLocalDescription","offer","sdp","onSnapshot","currentRemoteDescription","answer","answerDescription","RTCSessionDescription","setRemoteDescription","docChanges","change","RTCIceCandidate","addIceCandidate","callId","callData","createAnswer","autoPlay","playsInline","UserSection","uuidv4","motion","section","initial","animate","transition","duration","RecorderForm","classid","useHistory","languageList","LiveClassEmitter","socketRef","io","myVideo","sendData","startLive","stopLive","muted","LiveClassReceiver","setCallerSignal","answerId","setAnswerId","userVideo","signalData","answerCall","paddingRight","lectures","lecture","AllLectures","setLectures","lecturesArray","orderBy","limit","filenameReducer","outputModalReducer","languageReducer","allReducers","combineReducers","outputModal","middleware","thunk","composeEnhancer","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","allReducer","applyMiddleware","exact","component","Player","ide","ReactDOM","toByteString","readAsBinaryString","byteStringToArrayBuffer","bufferView","len","byteStringToString","stringToBase64","btoa","base64ToString","base64","isByteString","compress","deflate","deflated","encoding","compressed","decoded","inflate","DATA_VIEW_BITS_MAP","dataView","bytes","DataView","concatBuffers","buffers","splitBuffers","concatenatedBuffer","chunkSize","_encryptAndCompress","dataBuffer","fileInfo","compression","encryption","encodingMetadataBuffer","contentsMetadataBuffer","_decryptAndDecompress","decryptedBuffer","isCompressed","encodingMetadata","contentsBuffer"],"mappings":"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","file":"static/js/main.601c0864.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"themeFilter\":\"invert(93%) hue-rotate(180deg)\"};","var map = {\n\t\"./en.json\": 114,\n\t\"./percentages.json\": 115\n};\n\nfunction webpackAsyncContext(req) {\n\treturn Promise.resolve().then(function() {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\n\t\tvar id = map[req];\n\t\treturn __webpack_require__.t(id, 3);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 187;\nmodule.exports = webpackAsyncContext;","export const IV_LENGTH_BYTES = 12;\r\nexport const createIV = () => {\r\n    const arr = new Uint8Array(IV_LENGTH_BYTES);\r\n    return window.crypto.getRandomValues(arr);\r\n};\r\nexport const generateEncryptionKey = async () => {\r\n    const key = await window.crypto.subtle.generateKey({\r\n        name: \"AES-GCM\",\r\n        length: 128,\r\n    }, true, // extractable\r\n    [\"encrypt\", \"decrypt\"]);\r\n    return (await window.crypto.subtle.exportKey(\"jwk\", key)).k;\r\n};\r\nexport const getImportedKey = (key, usage) => window.crypto.subtle.importKey(\"jwk\", {\r\n    alg: \"A128GCM\",\r\n    ext: true,\r\n    k: key,\r\n    key_ops: [\"encrypt\", \"decrypt\"],\r\n    kty: \"oct\",\r\n}, {\r\n    name: \"AES-GCM\",\r\n    length: 128,\r\n}, false, // extractable\r\n[usage]);\r\nexport const encryptData = async (key, data) => {\r\n    const importedKey = await getImportedKey(key, \"encrypt\");\r\n    const iv = createIV();\r\n    const buffer = typeof data === \"string\"\r\n        ? new TextEncoder().encode(data)\r\n        : data instanceof Uint8Array\r\n            ? data\r\n            : data instanceof Blob\r\n                ? await data.arrayBuffer()\r\n                : data;\r\n    const encryptedBuffer = await window.crypto.subtle.encrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, importedKey, buffer);\r\n    return { encryptedBuffer, iv };\r\n};\r\nexport const decryptData = async (iv, encrypted, privateKey) => {\r\n    const key = await getImportedKey(privateKey, \"decrypt\");\r\n    return window.crypto.subtle.decrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, key, encrypted);\r\n};\r\n","export const trackEvent = typeof process !== \"undefined\" &&\r\n    process.env?.REACT_APP_GOOGLE_ANALYTICS_ID &&\r\n    typeof window !== \"undefined\" &&\r\n    window.gtag\r\n    ? (category, name, label, value) => {\r\n        window.gtag(\"event\", name, {\r\n            event_category: category,\r\n            event_label: label,\r\n            value,\r\n        });\r\n    }\r\n    : typeof process !== \"undefined\" && process.env?.JEST_WORKER_ID\r\n        ? (category, name, label, value) => { }\r\n        : (category, name, label, value) => {\r\n            // Uncomment the next line to track locally\r\n            // console.info(\"Track Event\", category, name, label, value);\r\n        };\r\n","import cssVariables from \"./css/variables.module.scss\";\r\nexport const APP_NAME = \"ChalkBoard\";\r\nexport const DRAGGING_THRESHOLD = 10; // px\r\nexport const LINE_CONFIRM_THRESHOLD = 8; // px\r\nexport const ELEMENT_SHIFT_TRANSLATE_AMOUNT = 5;\r\nexport const ELEMENT_TRANSLATE_AMOUNT = 1;\r\nexport const TEXT_TO_CENTER_SNAP_THRESHOLD = 30;\r\nexport const SHIFT_LOCKING_ANGLE = Math.PI / 12;\r\nexport const CURSOR_TYPE = {\r\n    TEXT: \"text\",\r\n    CROSSHAIR: \"crosshair\",\r\n    GRABBING: \"grabbing\",\r\n    GRAB: \"grab\",\r\n    POINTER: \"pointer\",\r\n    MOVE: \"move\",\r\n    AUTO: \"\",\r\n};\r\nexport const POINTER_BUTTON = {\r\n    MAIN: 0,\r\n    WHEEL: 1,\r\n    SECONDARY: 2,\r\n    TOUCH: -1,\r\n};\r\nexport var EVENT;\r\n(function (EVENT) {\r\n    EVENT[\"COPY\"] = \"copy\";\r\n    EVENT[\"PASTE\"] = \"paste\";\r\n    EVENT[\"CUT\"] = \"cut\";\r\n    EVENT[\"KEYDOWN\"] = \"keydown\";\r\n    EVENT[\"KEYUP\"] = \"keyup\";\r\n    EVENT[\"MOUSE_MOVE\"] = \"mousemove\";\r\n    EVENT[\"RESIZE\"] = \"resize\";\r\n    EVENT[\"UNLOAD\"] = \"unload\";\r\n    EVENT[\"FOCUS\"] = \"focus\";\r\n    EVENT[\"BLUR\"] = \"blur\";\r\n    EVENT[\"DRAG_OVER\"] = \"dragover\";\r\n    EVENT[\"DROP\"] = \"drop\";\r\n    EVENT[\"GESTURE_END\"] = \"gestureend\";\r\n    EVENT[\"BEFORE_UNLOAD\"] = \"beforeunload\";\r\n    EVENT[\"GESTURE_START\"] = \"gesturestart\";\r\n    EVENT[\"GESTURE_CHANGE\"] = \"gesturechange\";\r\n    EVENT[\"POINTER_MOVE\"] = \"pointermove\";\r\n    EVENT[\"POINTER_UP\"] = \"pointerup\";\r\n    EVENT[\"STATE_CHANGE\"] = \"statechange\";\r\n    EVENT[\"WHEEL\"] = \"wheel\";\r\n    EVENT[\"TOUCH_START\"] = \"touchstart\";\r\n    EVENT[\"TOUCH_END\"] = \"touchend\";\r\n    EVENT[\"HASHCHANGE\"] = \"hashchange\";\r\n    EVENT[\"VISIBILITY_CHANGE\"] = \"visibilitychange\";\r\n    EVENT[\"SCROLL\"] = \"scroll\";\r\n})(EVENT || (EVENT = {}));\r\nexport const ENV = {\r\n    TEST: \"test\",\r\n    DEVELOPMENT: \"development\",\r\n};\r\nexport const CLASSES = {\r\n    SHAPE_ACTIONS_MENU: \"App-menu__left\",\r\n};\r\n// 1-based in case we ever do `if(element.fontFamily)`\r\nexport const FONT_FAMILY = {\r\n    Virgil: 1,\r\n    Helvetica: 2,\r\n    Cascadia: 3,\r\n};\r\nexport const THEME = {\r\n    LIGHT: \"light\",\r\n    DARK: \"dark\",\r\n};\r\nexport const WINDOWS_EMOJI_FALLBACK_FONT = \"Segoe UI Emoji\";\r\nexport const DEFAULT_FONT_SIZE = 20;\r\nexport const DEFAULT_FONT_FAMILY = FONT_FAMILY.Virgil;\r\nexport const DEFAULT_TEXT_ALIGN = \"left\";\r\nexport const DEFAULT_VERTICAL_ALIGN = \"top\";\r\nexport const DEFAULT_VERSION = \"{version}\";\r\nexport const CANVAS_ONLY_ACTIONS = [\"selectAll\"];\r\nexport const GRID_SIZE = 20; // TODO make it configurable?\r\nexport const MIME_TYPES = {\r\n    excalidraw: \"application/vnd.excalidraw+json\",\r\n    excalidrawlib: \"application/vnd.excalidrawlib+json\",\r\n    json: \"application/json\",\r\n    svg: \"image/svg+xml\",\r\n    png: \"image/png\",\r\n    jpg: \"image/jpeg\",\r\n    gif: \"image/gif\",\r\n    binary: \"application/octet-stream\",\r\n};\r\nexport const EXPORT_DATA_TYPES = {\r\n    excalidraw: \"excalidraw\",\r\n    excalidrawClipboard: \"excalidraw/clipboard\",\r\n    excalidrawLibrary: \"chalkboardlib\",\r\n};\r\nexport const EXPORT_SOURCE = window.location.origin;\r\nexport const STORAGE_KEYS = {\r\n    LOCAL_STORAGE_LIBRARY: \"excalidraw-library\",\r\n};\r\n// time in milliseconds\r\nexport const IMAGE_RENDER_TIMEOUT = 500;\r\nexport const TAP_TWICE_TIMEOUT = 300;\r\nexport const TOUCH_CTX_MENU_TIMEOUT = 500;\r\nexport const TITLE_TIMEOUT = 10000;\r\nexport const TOAST_TIMEOUT = 5000;\r\nexport const VERSION_TIMEOUT = 30000;\r\nexport const SCROLL_TIMEOUT = 100;\r\nexport const ZOOM_STEP = 0.1;\r\n// Report a user inactive after IDLE_THRESHOLD milliseconds\r\nexport const IDLE_THRESHOLD = 60000;\r\n// Report a user active each ACTIVE_THRESHOLD milliseconds\r\nexport const ACTIVE_THRESHOLD = 3000;\r\nexport const MODES = {\r\n    VIEW: \"viewMode\",\r\n    ZEN: \"zenMode\",\r\n    GRID: \"gridMode\",\r\n};\r\nexport const THEME_FILTER = cssVariables.themeFilter;\r\nexport const URL_QUERY_KEYS = {\r\n    addLibrary: \"addLibrary\",\r\n};\r\nexport const URL_HASH_KEYS = {\r\n    addLibrary: \"addLibrary\",\r\n};\r\nexport const DEFAULT_UI_OPTIONS = {\r\n    canvasActions: {\r\n        changeViewBackgroundColor: true,\r\n        clearCanvas: true,\r\n        export: { saveFileToDisk: true },\r\n        loadScene: true,\r\n        saveToActiveFile: true,\r\n        theme: true,\r\n        saveAsImage: true,\r\n    },\r\n};\r\nexport const MQ_MAX_WIDTH_PORTRAIT = 730;\r\nexport const MQ_MAX_WIDTH_LANDSCAPE = 1000;\r\nexport const MQ_MAX_HEIGHT_LANDSCAPE = 500;\r\nexport const MAX_DECIMALS_FOR_SVG_EXPORT = 2;\r\nexport const EXPORT_SCALES = [1, 2, 3];\r\nexport const DEFAULT_EXPORT_PADDING = 10; // px\r\nexport const DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT = 1440;\r\nexport const ALLOWED_IMAGE_MIME_TYPES = [\r\n    MIME_TYPES.png,\r\n    MIME_TYPES.jpg,\r\n    MIME_TYPES.svg,\r\n    MIME_TYPES.gif,\r\n];\r\nexport const MAX_ALLOWED_FILE_BYTES = 2 * 1024 * 1024;\r\nexport const SVG_NS = \"http://www.w3.org/2000/svg\";\r\n","import fallbackLangData from \"./locales/en.json\";\r\nimport percentages from \"./locales/percentages.json\";\r\nimport { ENV } from \"./constants\";\r\nconst COMPLETION_THRESHOLD = 85;\r\nexport const defaultLang = { code: \"en\", label: \"English\" };\r\nconst allLanguages = [\r\n    { code: \"ar-SA\", label: \"العربية\", rtl: true },\r\n    { code: \"bg-BG\", label: \"Български\" },\r\n    { code: \"ca-ES\", label: \"Català\" },\r\n    { code: \"de-DE\", label: \"Deutsch\" },\r\n    { code: \"el-GR\", label: \"Ελληνικά\" },\r\n    { code: \"es-ES\", label: \"Español\" },\r\n    { code: \"fa-IR\", label: \"فارسی\", rtl: true },\r\n    { code: \"fi-FI\", label: \"Suomi\" },\r\n    { code: \"fr-FR\", label: \"Français\" },\r\n    { code: \"he-IL\", label: \"עברית\", rtl: true },\r\n    { code: \"hi-IN\", label: \"हिन्दी\" },\r\n    { code: \"hu-HU\", label: \"Magyar\" },\r\n    { code: \"id-ID\", label: \"Bahasa Indonesia\" },\r\n    { code: \"it-IT\", label: \"Italiano\" },\r\n    { code: \"ja-JP\", label: \"日本語\" },\r\n    { code: \"kab-KAB\", label: \"Taqbaylit\" },\r\n    { code: \"ko-KR\", label: \"한국어\" },\r\n    { code: \"my-MM\", label: \"Burmese\" },\r\n    { code: \"nb-NO\", label: \"Norsk bokmål\" },\r\n    { code: \"nl-NL\", label: \"Nederlands\" },\r\n    { code: \"nn-NO\", label: \"Norsk nynorsk\" },\r\n    { code: \"oc-FR\", label: \"Occitan\" },\r\n    { code: \"pa-IN\", label: \"ਪੰਜਾਬੀ\" },\r\n    { code: \"pl-PL\", label: \"Polski\" },\r\n    { code: \"pt-BR\", label: \"Português Brasileiro\" },\r\n    { code: \"pt-PT\", label: \"Português\" },\r\n    { code: \"ro-RO\", label: \"Română\" },\r\n    { code: \"ru-RU\", label: \"Русский\" },\r\n    { code: \"sk-SK\", label: \"Slovenčina\" },\r\n    { code: \"sv-SE\", label: \"Svenska\" },\r\n    { code: \"tr-TR\", label: \"Türkçe\" },\r\n    { code: \"uk-UA\", label: \"Українська\" },\r\n    { code: \"zh-CN\", label: \"简体中文\" },\r\n    { code: \"zh-TW\", label: \"繁體中文\" },\r\n    { code: \"lv-LV\", label: \"Latviešu\" },\r\n    { code: \"cs-CZ\", label: \"Česky\" },\r\n    { code: \"kk-KZ\", label: \"Қазақ тілі\" },\r\n].concat([defaultLang]);\r\nexport const languages = allLanguages\r\n    .sort((left, right) => (left.label > right.label ? 1 : -1))\r\n    .filter((lang) => percentages[lang.code] >=\r\n    COMPLETION_THRESHOLD);\r\nconst TEST_LANG_CODE = \"__test__\";\r\nif (process.env.NODE_ENV === ENV.DEVELOPMENT) {\r\n    languages.unshift({ code: TEST_LANG_CODE, label: \"test language\" }, {\r\n        code: `${TEST_LANG_CODE}.rtl`,\r\n        label: \"\\u{202a}test language (rtl)\\u{202c}\",\r\n        rtl: true,\r\n    });\r\n}\r\nlet currentLang = defaultLang;\r\nlet currentLangData = {};\r\nexport const setLanguage = async (lang) => {\r\n    currentLang = lang;\r\n    document.documentElement.dir = currentLang.rtl ? \"rtl\" : \"ltr\";\r\n    document.documentElement.lang = currentLang.code;\r\n    if (lang.code.startsWith(TEST_LANG_CODE)) {\r\n        currentLangData = {};\r\n    }\r\n    else {\r\n        currentLangData = await import(\r\n        /* webpackChunkName: \"i18n-[request]\" */ `./locales/${currentLang.code}.json`);\r\n    }\r\n};\r\nexport const getLanguage = () => currentLang;\r\nconst findPartsForData = (data, parts) => {\r\n    for (let index = 0; index < parts.length; ++index) {\r\n        const part = parts[index];\r\n        if (data[part] === undefined) {\r\n            return undefined;\r\n        }\r\n        data = data[part];\r\n    }\r\n    if (typeof data !== \"string\") {\r\n        return undefined;\r\n    }\r\n    return data;\r\n};\r\nexport const t = (path, replacement) => {\r\n    if (currentLang.code.startsWith(TEST_LANG_CODE)) {\r\n        const name = replacement\r\n            ? `${path}(${JSON.stringify(replacement).slice(1, -1)})`\r\n            : path;\r\n        return `\\u{202a}[[${name}]]\\u{202c}`;\r\n    }\r\n    const parts = path.split(\".\");\r\n    let translation = findPartsForData(currentLangData, parts) ||\r\n        findPartsForData(fallbackLangData, parts);\r\n    if (translation === undefined) {\r\n        throw new Error(`Can't find translation for ${path}`);\r\n    }\r\n    if (replacement) {\r\n        for (const key in replacement) {\r\n            translation = translation.replace(`{{${key}}}`, replacement[key]);\r\n        }\r\n    }\r\n    return translation;\r\n};\r\n","import oc from \"open-color\";\r\nconst shades = (index) => [\r\n    oc.red[index],\r\n    oc.pink[index],\r\n    oc.grape[index],\r\n    oc.violet[index],\r\n    oc.indigo[index],\r\n    oc.blue[index],\r\n    oc.cyan[index],\r\n    oc.teal[index],\r\n    oc.green[index],\r\n    oc.lime[index],\r\n    oc.yellow[index],\r\n    oc.orange[index],\r\n];\r\nexport default {\r\n    canvasBackground: [oc.white, oc.gray[0], oc.gray[1], ...shades(0)],\r\n    elementBackground: [\"transparent\", oc.gray[4], oc.gray[6], ...shades(6)],\r\n    elementStroke: [oc.black, oc.gray[8], oc.gray[7], ...shades(9)],\r\n};\r\n","export const isDarwin = /Mac|iPod|iPhone|iPad/.test(window.navigator.platform);\r\nexport const isWindows = /^Win/.test(window.navigator.platform);\r\nexport const CODES = {\r\n    EQUAL: \"Equal\",\r\n    MINUS: \"Minus\",\r\n    NUM_ADD: \"NumpadAdd\",\r\n    NUM_SUBTRACT: \"NumpadSubtract\",\r\n    NUM_ZERO: \"Numpad0\",\r\n    BRACKET_RIGHT: \"BracketRight\",\r\n    BRACKET_LEFT: \"BracketLeft\",\r\n    ONE: \"Digit1\",\r\n    TWO: \"Digit2\",\r\n    NINE: \"Digit9\",\r\n    QUOTE: \"Quote\",\r\n    ZERO: \"Digit0\",\r\n    SLASH: \"Slash\",\r\n    C: \"KeyC\",\r\n    D: \"KeyD\",\r\n    G: \"KeyG\",\r\n    F: \"KeyF\",\r\n    H: \"KeyH\",\r\n    V: \"KeyV\",\r\n    X: \"KeyX\",\r\n    Z: \"KeyZ\",\r\n    R: \"KeyR\",\r\n};\r\nexport const KEYS = {\r\n    ARROW_DOWN: \"ArrowDown\",\r\n    ARROW_LEFT: \"ArrowLeft\",\r\n    ARROW_RIGHT: \"ArrowRight\",\r\n    ARROW_UP: \"ArrowUp\",\r\n    BACKSPACE: \"Backspace\",\r\n    ALT: \"Alt\",\r\n    CTRL_OR_CMD: isDarwin ? \"metaKey\" : \"ctrlKey\",\r\n    DELETE: \"Delete\",\r\n    ENTER: \"Enter\",\r\n    ESCAPE: \"Escape\",\r\n    QUESTION_MARK: \"?\",\r\n    SPACE: \" \",\r\n    TAB: \"Tab\",\r\n    A: \"a\",\r\n    D: \"d\",\r\n    E: \"e\",\r\n    G: \"g\",\r\n    I: \"i\",\r\n    L: \"l\",\r\n    O: \"o\",\r\n    P: \"p\",\r\n    Q: \"q\",\r\n    R: \"r\",\r\n    S: \"s\",\r\n    T: \"t\",\r\n    V: \"v\",\r\n    X: \"x\",\r\n    Y: \"y\",\r\n    Z: \"z\",\r\n};\r\nexport const isArrowKey = (key) => key === KEYS.ARROW_LEFT ||\r\n    key === KEYS.ARROW_RIGHT ||\r\n    key === KEYS.ARROW_DOWN ||\r\n    key === KEYS.ARROW_UP;\r\nexport const shouldResizeFromCenter = (event) => event.altKey;\r\nexport const shouldMaintainAspectRatio = (event) => event.shiftKey;\r\nexport const shouldRotateWithDiscreteAngle = (event) => event.shiftKey;\r\n","import colors from \"./colors\";\r\nimport { CURSOR_TYPE, DEFAULT_VERSION, FONT_FAMILY, WINDOWS_EMOJI_FALLBACK_FONT, } from \"./constants\";\r\nimport { unstable_batchedUpdates } from \"react-dom\";\r\nimport { isDarwin } from \"./keys\";\r\nlet mockDateTime = null;\r\nexport const setDateTimeForTests = (dateTime) => {\r\n    mockDateTime = dateTime;\r\n};\r\nexport const getDateTime = () => {\r\n    if (mockDateTime) {\r\n        return mockDateTime;\r\n    }\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = `${date.getMonth() + 1}`.padStart(2, \"0\");\r\n    const day = `${date.getDate()}`.padStart(2, \"0\");\r\n    const hr = `${date.getHours()}`.padStart(2, \"0\");\r\n    const min = `${date.getMinutes()}`.padStart(2, \"0\");\r\n    return `${year}-${month}-${day}-${hr}${min}`;\r\n};\r\nexport const capitalizeString = (str) => str.charAt(0).toUpperCase() + str.slice(1);\r\nexport const isToolIcon = (target) => target instanceof HTMLElement && target.className.includes(\"ToolIcon\");\r\nexport const isInputLike = (target) => (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\r\n    target instanceof HTMLBRElement || // newline in wysiwyg\r\n    target instanceof HTMLInputElement ||\r\n    target instanceof HTMLTextAreaElement ||\r\n    target instanceof HTMLSelectElement;\r\nexport const isWritableElement = (target) => (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\r\n    target instanceof HTMLBRElement || // newline in wysiwyg\r\n    target instanceof HTMLTextAreaElement ||\r\n    (target instanceof HTMLInputElement &&\r\n        (target.type === \"text\" || target.type === \"number\"));\r\nexport const getFontFamilyString = ({ fontFamily, }) => {\r\n    for (const [fontFamilyString, id] of Object.entries(FONT_FAMILY)) {\r\n        if (id === fontFamily) {\r\n            return `${fontFamilyString}, ${WINDOWS_EMOJI_FALLBACK_FONT}`;\r\n        }\r\n    }\r\n    return WINDOWS_EMOJI_FALLBACK_FONT;\r\n};\r\n/** returns fontSize+fontFamily string for assignment to DOM elements */\r\nexport const getFontString = ({ fontSize, fontFamily, }) => {\r\n    return `${fontSize}px ${getFontFamilyString({ fontFamily })}`;\r\n};\r\n// https://github.com/grassator/canvas-text-editor/blob/master/lib/FontMetrics.js\r\nexport const measureText = (text, font) => {\r\n    const line = document.createElement(\"div\");\r\n    const body = document.body;\r\n    line.style.position = \"absolute\";\r\n    line.style.whiteSpace = \"pre\";\r\n    line.style.font = font;\r\n    body.appendChild(line);\r\n    line.innerText = text\r\n        .split(\"\\n\")\r\n        // replace empty lines with single space because leading/trailing empty\r\n        // lines would be stripped from computation\r\n        .map((x) => x || \" \")\r\n        .join(\"\\n\");\r\n    const width = line.offsetWidth;\r\n    const height = line.offsetHeight;\r\n    // Now creating 1px sized item that will be aligned to baseline\r\n    // to calculate baseline shift\r\n    const span = document.createElement(\"span\");\r\n    span.style.display = \"inline-block\";\r\n    span.style.overflow = \"hidden\";\r\n    span.style.width = \"1px\";\r\n    span.style.height = \"1px\";\r\n    line.appendChild(span);\r\n    // Baseline is important for positioning text on canvas\r\n    const baseline = span.offsetTop + span.offsetHeight;\r\n    document.body.removeChild(line);\r\n    return { width, height, baseline };\r\n};\r\nexport const debounce = (fn, timeout) => {\r\n    let handle = 0;\r\n    let lastArgs = null;\r\n    const ret = (...args) => {\r\n        lastArgs = args;\r\n        clearTimeout(handle);\r\n        handle = window.setTimeout(() => {\r\n            lastArgs = null;\r\n            fn(...args);\r\n        }, timeout);\r\n    };\r\n    ret.flush = () => {\r\n        clearTimeout(handle);\r\n        if (lastArgs) {\r\n            const _lastArgs = lastArgs;\r\n            lastArgs = null;\r\n            fn(..._lastArgs);\r\n        }\r\n    };\r\n    ret.cancel = () => {\r\n        lastArgs = null;\r\n        clearTimeout(handle);\r\n    };\r\n    return ret;\r\n};\r\nexport const selectNode = (node) => {\r\n    const selection = window.getSelection();\r\n    if (selection) {\r\n        const range = document.createRange();\r\n        range.selectNodeContents(node);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n    }\r\n};\r\nexport const removeSelection = () => {\r\n    const selection = window.getSelection();\r\n    if (selection) {\r\n        selection.removeAllRanges();\r\n    }\r\n};\r\nexport const distance = (x, y) => Math.abs(x - y);\r\nexport const resetCursor = (canvas) => {\r\n    if (canvas) {\r\n        canvas.style.cursor = \"\";\r\n    }\r\n};\r\nexport const setCursor = (canvas, cursor) => {\r\n    if (canvas) {\r\n        canvas.style.cursor = cursor;\r\n    }\r\n};\r\nexport const setCursorForShape = (canvas, shape) => {\r\n    if (!canvas) {\r\n        return;\r\n    }\r\n    if (shape === \"selection\") {\r\n        resetCursor(canvas);\r\n        // do nothing if image tool is selected which suggests there's\r\n        // a image-preview set as the cursor\r\n    }\r\n    else if (shape !== \"image\") {\r\n        canvas.style.cursor = CURSOR_TYPE.CROSSHAIR;\r\n    }\r\n};\r\nexport const isFullScreen = () => document.fullscreenElement?.nodeName === \"HTML\";\r\nexport const allowFullScreen = () => document.documentElement.requestFullscreen();\r\nexport const exitFullScreen = () => document.exitFullscreen();\r\nexport const getShortcutKey = (shortcut) => {\r\n    shortcut = shortcut\r\n        .replace(/\\bAlt\\b/i, \"Alt\")\r\n        .replace(/\\bShift\\b/i, \"Shift\")\r\n        .replace(/\\b(Enter|Return)\\b/i, \"Enter\")\r\n        .replace(/\\bDel\\b/i, \"Delete\");\r\n    if (isDarwin) {\r\n        return shortcut\r\n            .replace(/\\bCtrlOrCmd\\b/i, \"Cmd\")\r\n            .replace(/\\bAlt\\b/i, \"Option\");\r\n    }\r\n    return shortcut.replace(/\\bCtrlOrCmd\\b/i, \"Ctrl\");\r\n};\r\nexport const viewportCoordsToSceneCoords = ({ clientX, clientY }, { zoom, offsetLeft, offsetTop, scrollX, scrollY, }) => {\r\n    const invScale = 1 / zoom.value;\r\n    const x = (clientX - zoom.translation.x - offsetLeft) * invScale - scrollX;\r\n    const y = (clientY - zoom.translation.y - offsetTop) * invScale - scrollY;\r\n    return { x, y };\r\n};\r\nexport const sceneCoordsToViewportCoords = ({ sceneX, sceneY }, { zoom, offsetLeft, offsetTop, scrollX, scrollY, }) => {\r\n    const x = (sceneX + scrollX + offsetLeft) * zoom.value + zoom.translation.x;\r\n    const y = (sceneY + scrollY + offsetTop) * zoom.value + zoom.translation.y;\r\n    return { x, y };\r\n};\r\nexport const getGlobalCSSVariable = (name) => getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);\r\nconst RS_LTR_CHARS = \"A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\" +\r\n    \"\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF\";\r\nconst RS_RTL_CHARS = \"\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC\";\r\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\r\n/**\r\n * Checks whether first directional character is RTL. Meaning whether it starts\r\n *  with RTL characters, or indeterminate (numbers etc.) characters followed by\r\n *  RTL.\r\n * See https://github.com/excalidraw/excalidraw/pull/1722#discussion_r436340171\r\n */\r\nexport const isRTL = (text) => RE_RTL_CHECK.test(text);\r\nexport const tupleToCoors = (xyTuple) => {\r\n    const [x, y] = xyTuple;\r\n    return { x, y };\r\n};\r\n/** use as a rejectionHandler to mute filesystem Abort errors */\r\nexport const muteFSAbortError = (error) => {\r\n    if (error?.name === \"AbortError\") {\r\n        return;\r\n    }\r\n    throw error;\r\n};\r\nexport const findIndex = (array, cb, fromIndex = 0) => {\r\n    if (fromIndex < 0) {\r\n        fromIndex = array.length + fromIndex;\r\n    }\r\n    fromIndex = Math.min(array.length, Math.max(fromIndex, 0));\r\n    let index = fromIndex - 1;\r\n    while (++index < array.length) {\r\n        if (cb(array[index], index, array)) {\r\n            return index;\r\n        }\r\n    }\r\n    return -1;\r\n};\r\nexport const findLastIndex = (array, cb, fromIndex = array.length - 1) => {\r\n    if (fromIndex < 0) {\r\n        fromIndex = array.length + fromIndex;\r\n    }\r\n    fromIndex = Math.min(array.length - 1, Math.max(fromIndex, 0));\r\n    let index = fromIndex + 1;\r\n    while (--index > -1) {\r\n        if (cb(array[index], index, array)) {\r\n            return index;\r\n        }\r\n    }\r\n    return -1;\r\n};\r\nexport const isTransparent = (color) => {\r\n    const isRGBTransparent = color.length === 5 && color.substr(4, 1) === \"0\";\r\n    const isRRGGBBTransparent = color.length === 9 && color.substr(7, 2) === \"00\";\r\n    return (isRGBTransparent ||\r\n        isRRGGBBTransparent ||\r\n        color === colors.elementBackground[0]);\r\n};\r\nexport const resolvablePromise = () => {\r\n    let resolve;\r\n    let reject;\r\n    const promise = new Promise((_resolve, _reject) => {\r\n        resolve = _resolve;\r\n        reject = _reject;\r\n    });\r\n    promise.resolve = resolve;\r\n    promise.reject = reject;\r\n    return promise;\r\n};\r\n/**\r\n * @param func handler taking at most single parameter (event).\r\n */\r\nexport const withBatchedUpdates = (func) => ((event) => {\r\n    unstable_batchedUpdates(func, event);\r\n});\r\n//https://stackoverflow.com/a/9462382/8418\r\nexport const nFormatter = (num, digits) => {\r\n    const si = [\r\n        { value: 1, symbol: \"b\" },\r\n        { value: 1e3, symbol: \"k\" },\r\n        { value: 1e6, symbol: \"M\" },\r\n        { value: 1e9, symbol: \"G\" },\r\n    ];\r\n    const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\r\n    let index;\r\n    for (index = si.length - 1; index > 0; index--) {\r\n        if (num >= si[index].value) {\r\n            break;\r\n        }\r\n    }\r\n    return ((num / si[index].value).toFixed(digits).replace(rx, \"$1\") + si[index].symbol);\r\n};\r\nexport const getVersion = () => {\r\n    return (document.querySelector('meta[name=\"version\"]')?.content ||\r\n        DEFAULT_VERSION);\r\n};\r\n// Adapted from https://github.com/Modernizr/Modernizr/blob/master/feature-detects/emoji.js\r\nexport const supportsEmoji = () => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) {\r\n        return false;\r\n    }\r\n    const offset = 12;\r\n    ctx.fillStyle = \"#f00\";\r\n    ctx.textBaseline = \"top\";\r\n    ctx.font = \"32px Arial\";\r\n    // Modernizr used 🐨, but it is sort of supported on Windows 7.\r\n    // Luckily 😀 isn't supported.\r\n    ctx.fillText(\"😀\", 0, 0);\r\n    return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\r\n};\r\nexport const getNearestScrollableContainer = (element) => {\r\n    let parent = element.parentElement;\r\n    while (parent) {\r\n        if (parent === document.body) {\r\n            return document;\r\n        }\r\n        const { overflowY } = window.getComputedStyle(parent);\r\n        const hasScrollableContent = parent.scrollHeight > parent.clientHeight;\r\n        if (hasScrollableContent &&\r\n            (overflowY === \"auto\" || overflowY === \"scroll\")) {\r\n            return parent;\r\n        }\r\n        parent = parent.parentElement;\r\n    }\r\n    return document;\r\n};\r\nexport const focusNearestParent = (element) => {\r\n    let parent = element.parentElement;\r\n    while (parent) {\r\n        if (parent.tabIndex > -1) {\r\n            parent.focus();\r\n            return;\r\n        }\r\n        parent = parent.parentElement;\r\n    }\r\n};\r\nexport const preventUnload = (event) => {\r\n    event.preventDefault();\r\n    // NOTE: modern browsers no longer allow showing a custom message here\r\n    event.returnValue = \"\";\r\n};\r\n","import oc from \"open-color\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_FONT_SIZE, DEFAULT_TEXT_ALIGN, EXPORT_SCALES, THEME, } from \"./constants\";\r\nimport { t } from \"./i18n\";\r\nimport { getDateTime } from \"./utils\";\r\nconst defaultExportScale = EXPORT_SCALES.includes(devicePixelRatio)\r\n    ? devicePixelRatio\r\n    : 1;\r\nexport const getDefaultAppState = () => {\r\n    return {\r\n        theme: THEME.DARK,\r\n        collaborators: new Map(),\r\n        currentChartType: \"bar\",\r\n        currentItemBackgroundColor: \"transparent\",\r\n        currentItemEndArrowhead: \"arrow\",\r\n        currentItemFillStyle: \"hachure\",\r\n        currentItemFontFamily: DEFAULT_FONT_FAMILY,\r\n        currentItemFontSize: DEFAULT_FONT_SIZE,\r\n        currentItemLinearStrokeSharpness: \"round\",\r\n        currentItemOpacity: 100,\r\n        currentItemRoughness: 1,\r\n        currentItemStartArrowhead: null,\r\n        currentItemStrokeColor: oc.black,\r\n        currentItemStrokeSharpness: \"sharp\",\r\n        currentItemStrokeStyle: \"solid\",\r\n        currentItemStrokeWidth: 1,\r\n        currentItemTextAlign: DEFAULT_TEXT_ALIGN,\r\n        cursorButton: \"up\",\r\n        draggingElement: null,\r\n        editingElement: null,\r\n        editingGroupId: null,\r\n        editingLinearElement: null,\r\n        elementLocked: false,\r\n        elementType: \"selection\",\r\n        errorMessage: null,\r\n        exportBackground: true,\r\n        exportScale: defaultExportScale,\r\n        exportEmbedScene: false,\r\n        exportWithDarkMode: false,\r\n        fileHandle: null,\r\n        gridSize: null,\r\n        isBindingEnabled: true,\r\n        isLibraryOpen: false,\r\n        isLoading: false,\r\n        isResizing: false,\r\n        isRotating: false,\r\n        lastPointerDownWith: \"mouse\",\r\n        multiElement: null,\r\n        name: `${t(\"labels.untitled\")}-${getDateTime()}`,\r\n        openMenu: null,\r\n        openPopup: null,\r\n        pasteDialog: { shown: false, data: null },\r\n        previousSelectedElementIds: {},\r\n        resizingElement: null,\r\n        scrolledOutside: false,\r\n        scrollX: 0,\r\n        scrollY: 0,\r\n        selectedElementIds: {},\r\n        selectedGroupIds: {},\r\n        selectionElement: null,\r\n        shouldCacheIgnoreZoom: false,\r\n        showHelpDialog: false,\r\n        showStats: false,\r\n        startBoundElement: null,\r\n        suggestedBindings: [],\r\n        toastMessage: null,\r\n        viewBackgroundColor: oc.white,\r\n        zenModeEnabled: false,\r\n        zoom: { value: 1, translation: { x: 0, y: 0 } },\r\n        viewModeEnabled: false,\r\n        pendingImageElement: null,\r\n    };\r\n};\r\n/**\r\n * Config containing all AppState keys. Used to determine whether given state\r\n *  prop should be stripped when exporting to given storage type.\r\n */\r\nconst APP_STATE_STORAGE_CONF = ((config) => config)({\r\n    theme: { browser: true, export: false, server: false },\r\n    collaborators: { browser: false, export: false, server: false },\r\n    currentChartType: { browser: true, export: false, server: false },\r\n    currentItemBackgroundColor: { browser: true, export: false, server: false },\r\n    currentItemEndArrowhead: { browser: true, export: false, server: false },\r\n    currentItemFillStyle: { browser: true, export: false, server: false },\r\n    currentItemFontFamily: { browser: true, export: false, server: false },\r\n    currentItemFontSize: { browser: true, export: false, server: false },\r\n    currentItemLinearStrokeSharpness: {\r\n        browser: true,\r\n        export: false,\r\n        server: false,\r\n    },\r\n    currentItemOpacity: { browser: true, export: false, server: false },\r\n    currentItemRoughness: { browser: true, export: false, server: false },\r\n    currentItemStartArrowhead: { browser: true, export: false, server: false },\r\n    currentItemStrokeColor: { browser: true, export: false, server: false },\r\n    currentItemStrokeSharpness: { browser: true, export: false, server: false },\r\n    currentItemStrokeStyle: { browser: true, export: false, server: false },\r\n    currentItemStrokeWidth: { browser: true, export: false, server: false },\r\n    currentItemTextAlign: { browser: true, export: false, server: false },\r\n    cursorButton: { browser: true, export: false, server: false },\r\n    draggingElement: { browser: false, export: false, server: false },\r\n    editingElement: { browser: false, export: false, server: false },\r\n    editingGroupId: { browser: true, export: false, server: false },\r\n    editingLinearElement: { browser: false, export: false, server: false },\r\n    elementLocked: { browser: true, export: false, server: false },\r\n    elementType: { browser: true, export: false, server: false },\r\n    errorMessage: { browser: false, export: false, server: false },\r\n    exportBackground: { browser: true, export: false, server: false },\r\n    exportEmbedScene: { browser: true, export: false, server: false },\r\n    exportScale: { browser: true, export: false, server: false },\r\n    exportWithDarkMode: { browser: true, export: false, server: false },\r\n    fileHandle: { browser: false, export: false, server: false },\r\n    gridSize: { browser: true, export: true, server: true },\r\n    height: { browser: false, export: false, server: false },\r\n    isBindingEnabled: { browser: false, export: false, server: false },\r\n    isLibraryOpen: { browser: false, export: false, server: false },\r\n    isLoading: { browser: false, export: false, server: false },\r\n    isResizing: { browser: false, export: false, server: false },\r\n    isRotating: { browser: false, export: false, server: false },\r\n    lastPointerDownWith: { browser: true, export: false, server: false },\r\n    multiElement: { browser: false, export: false, server: false },\r\n    name: { browser: true, export: false, server: false },\r\n    offsetLeft: { browser: false, export: false, server: false },\r\n    offsetTop: { browser: false, export: false, server: false },\r\n    openMenu: { browser: true, export: false, server: false },\r\n    openPopup: { browser: false, export: false, server: false },\r\n    pasteDialog: { browser: false, export: false, server: false },\r\n    previousSelectedElementIds: { browser: true, export: false, server: false },\r\n    resizingElement: { browser: false, export: false, server: false },\r\n    scrolledOutside: { browser: true, export: false, server: false },\r\n    scrollX: { browser: true, export: false, server: false },\r\n    scrollY: { browser: true, export: false, server: false },\r\n    selectedElementIds: { browser: true, export: false, server: false },\r\n    selectedGroupIds: { browser: true, export: false, server: false },\r\n    selectionElement: { browser: false, export: false, server: false },\r\n    shouldCacheIgnoreZoom: { browser: true, export: false, server: false },\r\n    showHelpDialog: { browser: false, export: false, server: false },\r\n    showStats: { browser: true, export: false, server: false },\r\n    startBoundElement: { browser: false, export: false, server: false },\r\n    suggestedBindings: { browser: false, export: false, server: false },\r\n    toastMessage: { browser: false, export: false, server: false },\r\n    viewBackgroundColor: { browser: true, export: true, server: true },\r\n    width: { browser: false, export: false, server: false },\r\n    zenModeEnabled: { browser: true, export: false, server: false },\r\n    zoom: { browser: true, export: false, server: false },\r\n    viewModeEnabled: { browser: false, export: false, server: false },\r\n    pendingImageElement: { browser: false, export: false, server: false },\r\n});\r\nconst _clearAppStateForStorage = (appState, exportType) => {\r\n    const stateForExport = {};\r\n    for (const key of Object.keys(appState)) {\r\n        const propConfig = APP_STATE_STORAGE_CONF[key];\r\n        if (propConfig?.[exportType]) {\r\n            const nextValue = appState[key];\r\n            // https://github.com/microsoft/TypeScript/issues/31445\r\n            stateForExport[key] = nextValue;\r\n        }\r\n    }\r\n    return stateForExport;\r\n};\r\nexport const clearAppStateForLocalStorage = (appState) => {\r\n    return _clearAppStateForStorage(appState, \"browser\");\r\n};\r\nexport const cleanAppStateForExport = (appState) => {\r\n    return _clearAppStateForStorage(appState, \"export\");\r\n};\r\nexport const clearAppStateForDatabase = (appState) => {\r\n    return _clearAppStateForStorage(appState, \"server\");\r\n};\r\n","import { useCallback, useState } from \"react\";\r\nexport const useCallbackRefState = () => {\r\n    const [refValue, setRefValue] = useState(null);\r\n    const refCallback = useCallback((value) => setRefValue(value), []);\r\n    return [refValue, refCallback];\r\n};\r\n","export const isGenericElement = (element) => {\r\n    return (element != null &&\r\n        (element.type === \"selection\" ||\r\n            element.type === \"rectangle\" ||\r\n            element.type === \"diamond\" ||\r\n            element.type === \"ellipse\"));\r\n};\r\nexport const isInitializedImageElement = (element) => {\r\n    return !!element && element.type === \"image\" && !!element.fileId;\r\n};\r\nexport const isImageElement = (element) => {\r\n    return !!element && element.type === \"image\";\r\n};\r\nexport const isTextElement = (element) => {\r\n    return element != null && element.type === \"text\";\r\n};\r\nexport const isFreeDrawElement = (element) => {\r\n    return element != null && isFreeDrawElementType(element.type);\r\n};\r\nexport const isFreeDrawElementType = (elementType) => {\r\n    return elementType === \"freedraw\";\r\n};\r\nexport const isLinearElement = (element) => {\r\n    return element != null && isLinearElementType(element.type);\r\n};\r\nexport const isLinearElementType = (elementType) => {\r\n    return (elementType === \"arrow\" || elementType === \"line\" // || elementType === \"freedraw\"\r\n    );\r\n};\r\nexport const isBindingElement = (element) => {\r\n    return element != null && isBindingElementType(element.type);\r\n};\r\nexport const isBindingElementType = (elementType) => {\r\n    return elementType === \"arrow\";\r\n};\r\nexport const isBindableElement = (element) => {\r\n    return (element != null &&\r\n        (element.type === \"rectangle\" ||\r\n            element.type === \"diamond\" ||\r\n            element.type === \"ellipse\" ||\r\n            element.type === \"text\"));\r\n};\r\nexport const isExcalidrawElement = (element) => {\r\n    return (element?.type === \"text\" ||\r\n        element?.type === \"diamond\" ||\r\n        element?.type === \"rectangle\" ||\r\n        element?.type === \"ellipse\" ||\r\n        element?.type === \"arrow\" ||\r\n        element?.type === \"freedraw\" ||\r\n        element?.type === \"line\");\r\n};\r\n","import { LINE_CONFIRM_THRESHOLD } from \"./constants\";\r\nexport const rotate = (x1, y1, x2, y2, angle) => \r\n// 𝑎′𝑥=(𝑎𝑥−𝑐𝑥)cos𝜃−(𝑎𝑦−𝑐𝑦)sin𝜃+𝑐𝑥\r\n// 𝑎′𝑦=(𝑎𝑥−𝑐𝑥)sin𝜃+(𝑎𝑦−𝑐𝑦)cos𝜃+𝑐𝑦.\r\n// https://math.stackexchange.com/questions/2204520/how-do-i-rotate-a-line-segment-in-a-specific-point-on-the-line\r\n[\r\n    (x1 - x2) * Math.cos(angle) - (y1 - y2) * Math.sin(angle) + x2,\r\n    (x1 - x2) * Math.sin(angle) + (y1 - y2) * Math.cos(angle) + y2,\r\n];\r\nexport const rotatePoint = (point, center, angle) => rotate(point[0], point[1], center[0], center[1], angle);\r\nexport const adjustXYWithRotation = (sides, x, y, angle, deltaX1, deltaY1, deltaX2, deltaY2) => {\r\n    const cos = Math.cos(angle);\r\n    const sin = Math.sin(angle);\r\n    if (sides.e && sides.w) {\r\n        x += deltaX1 + deltaX2;\r\n    }\r\n    else if (sides.e) {\r\n        x += deltaX1 * (1 + cos);\r\n        y += deltaX1 * sin;\r\n        x += deltaX2 * (1 - cos);\r\n        y += deltaX2 * -sin;\r\n    }\r\n    else if (sides.w) {\r\n        x += deltaX1 * (1 - cos);\r\n        y += deltaX1 * -sin;\r\n        x += deltaX2 * (1 + cos);\r\n        y += deltaX2 * sin;\r\n    }\r\n    if (sides.n && sides.s) {\r\n        y += deltaY1 + deltaY2;\r\n    }\r\n    else if (sides.n) {\r\n        x += deltaY1 * sin;\r\n        y += deltaY1 * (1 - cos);\r\n        x += deltaY2 * -sin;\r\n        y += deltaY2 * (1 + cos);\r\n    }\r\n    else if (sides.s) {\r\n        x += deltaY1 * -sin;\r\n        y += deltaY1 * (1 + cos);\r\n        x += deltaY2 * sin;\r\n        y += deltaY2 * (1 - cos);\r\n    }\r\n    return [x, y];\r\n};\r\nexport const getPointOnAPath = (point, path) => {\r\n    const [px, py] = point;\r\n    const [start, ...other] = path;\r\n    let [lastX, lastY] = start;\r\n    let kLine = 0;\r\n    let idx = 0;\r\n    // if any item in the array is true, it means that a point is\r\n    // on some segment of a line based path\r\n    const retVal = other.some(([x2, y2], i) => {\r\n        // we always take a line when dealing with line segments\r\n        const x1 = lastX;\r\n        const y1 = lastY;\r\n        lastX = x2;\r\n        lastY = y2;\r\n        // if a point is not within the domain of the line segment\r\n        // it is not on the line segment\r\n        if (px < x1 || px > x2) {\r\n            return false;\r\n        }\r\n        // check if all points lie on the same line\r\n        // y1 = kx1 + b, y2 = kx2 + b\r\n        // y2 - y1 = k(x2 - x2) -> k = (y2 - y1) / (x2 - x1)\r\n        // coefficient for the line (p0, p1)\r\n        const kL = (y2 - y1) / (x2 - x1);\r\n        // coefficient for the line segment (p0, point)\r\n        const kP1 = (py - y1) / (px - x1);\r\n        // coefficient for the line segment (point, p1)\r\n        const kP2 = (py - y2) / (px - x2);\r\n        // because we are basing both lines from the same starting point\r\n        // the only option for collinearity is having same coefficients\r\n        // using it for floating point comparisons\r\n        const epsilon = 0.3;\r\n        // if coefficient is more than an arbitrary epsilon,\r\n        // these lines are nor collinear\r\n        if (Math.abs(kP1 - kL) > epsilon && Math.abs(kP2 - kL) > epsilon) {\r\n            return false;\r\n        }\r\n        // store the coefficient because we are goint to need it\r\n        kLine = kL;\r\n        idx = i;\r\n        return true;\r\n    });\r\n    // Return a coordinate that is always on the line segment\r\n    if (retVal === true) {\r\n        return { x: point[0], y: kLine * point[0], segment: idx };\r\n    }\r\n    return null;\r\n};\r\nexport const distance2d = (x1, y1, x2, y2) => {\r\n    const xd = x2 - x1;\r\n    const yd = y2 - y1;\r\n    return Math.hypot(xd, yd);\r\n};\r\nexport const centerPoint = (a, b) => {\r\n    return [(a[0] + b[0]) / 2, (a[1] + b[1]) / 2];\r\n};\r\n// Checks if the first and last point are close enough\r\n// to be considered a loop\r\nexport const isPathALoop = (points, \r\n/** supply if you want the loop detection to account for current zoom */\r\nzoomValue = 1) => {\r\n    if (points.length >= 3) {\r\n        const [first, last] = [points[0], points[points.length - 1]];\r\n        const distance = distance2d(first[0], first[1], last[0], last[1]);\r\n        // Adjusting LINE_CONFIRM_THRESHOLD to current zoom so that when zoomed in\r\n        // really close we make the threshold smaller, and vice versa.\r\n        return distance <= LINE_CONFIRM_THRESHOLD / zoomValue;\r\n    }\r\n    return false;\r\n};\r\n// Draw a line from the point to the right till infiinty\r\n// Check how many lines of the polygon does this infinite line intersects with\r\n// If the number of intersections is odd, point is in the polygon\r\nexport const isPointInPolygon = (points, x, y) => {\r\n    const vertices = points.length;\r\n    // There must be at least 3 vertices in polygon\r\n    if (vertices < 3) {\r\n        return false;\r\n    }\r\n    const extreme = [Number.MAX_SAFE_INTEGER, y];\r\n    const p = [x, y];\r\n    let count = 0;\r\n    for (let i = 0; i < vertices; i++) {\r\n        const current = points[i];\r\n        const next = points[(i + 1) % vertices];\r\n        if (doSegmentsIntersect(current, next, p, extreme)) {\r\n            if (orderedColinearOrientation(current, p, next) === 0) {\r\n                return isPointWithinBounds(current, p, next);\r\n            }\r\n            count++;\r\n        }\r\n    }\r\n    // true if count is off\r\n    return count % 2 === 1;\r\n};\r\n// Returns whether `q` lies inside the segment/rectangle defined by `p` and `r`.\r\n// This is an approximation to \"does `q` lie on a segment `pr`\" check.\r\nconst isPointWithinBounds = (p, q, r) => {\r\n    return (q[0] <= Math.max(p[0], r[0]) &&\r\n        q[0] >= Math.min(p[0], r[0]) &&\r\n        q[1] <= Math.max(p[1], r[1]) &&\r\n        q[1] >= Math.min(p[1], r[1]));\r\n};\r\n// For the ordered points p, q, r, return\r\n// 0 if p, q, r are colinear\r\n// 1 if Clockwise\r\n// 2 if counterclickwise\r\nconst orderedColinearOrientation = (p, q, r) => {\r\n    const val = (q[1] - p[1]) * (r[0] - q[0]) - (q[0] - p[0]) * (r[1] - q[1]);\r\n    if (val === 0) {\r\n        return 0;\r\n    }\r\n    return val > 0 ? 1 : 2;\r\n};\r\n// Check is p1q1 intersects with p2q2\r\nconst doSegmentsIntersect = (p1, q1, p2, q2) => {\r\n    const o1 = orderedColinearOrientation(p1, q1, p2);\r\n    const o2 = orderedColinearOrientation(p1, q1, q2);\r\n    const o3 = orderedColinearOrientation(p2, q2, p1);\r\n    const o4 = orderedColinearOrientation(p2, q2, q1);\r\n    if (o1 !== o2 && o3 !== o4) {\r\n        return true;\r\n    }\r\n    // p1, q1 and p2 are colinear and p2 lies on segment p1q1\r\n    if (o1 === 0 && isPointWithinBounds(p1, p2, q1)) {\r\n        return true;\r\n    }\r\n    // p1, q1 and p2 are colinear and q2 lies on segment p1q1\r\n    if (o2 === 0 && isPointWithinBounds(p1, q2, q1)) {\r\n        return true;\r\n    }\r\n    // p2, q2 and p1 are colinear and p1 lies on segment p2q2\r\n    if (o3 === 0 && isPointWithinBounds(p2, p1, q2)) {\r\n        return true;\r\n    }\r\n    // p2, q2 and q1 are colinear and q1 lies on segment p2q2\r\n    if (o4 === 0 && isPointWithinBounds(p2, q1, q2)) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n// TODO: Rounding this point causes some shake when free drawing\r\nexport const getGridPoint = (x, y, gridSize) => {\r\n    if (gridSize) {\r\n        return [\r\n            Math.round(x / gridSize) * gridSize,\r\n            Math.round(y / gridSize) * gridSize,\r\n        ];\r\n    }\r\n    return [x, y];\r\n};\r\n","export const getSizeFromPoints = (points) => {\r\n    const xs = points.map((point) => point[0]);\r\n    const ys = points.map((point) => point[1]);\r\n    return {\r\n        width: Math.max(...xs) - Math.min(...xs),\r\n        height: Math.max(...ys) - Math.min(...ys),\r\n    };\r\n};\r\nexport const rescalePoints = (dimension, nextDimensionSize, prevPoints) => {\r\n    const prevDimValues = prevPoints.map((point) => point[dimension]);\r\n    const prevMaxDimension = Math.max(...prevDimValues);\r\n    const prevMinDimension = Math.min(...prevDimValues);\r\n    const prevDimensionSize = prevMaxDimension - prevMinDimension;\r\n    const dimensionScaleFactor = prevDimensionSize === 0 ? 1 : nextDimensionSize / prevDimensionSize;\r\n    let nextMinDimension = Infinity;\r\n    const scaledPoints = prevPoints.map((prevPoint) => prevPoint.map((value, currentDimension) => {\r\n        if (currentDimension !== dimension) {\r\n            return value;\r\n        }\r\n        const scaledValue = value * dimensionScaleFactor;\r\n        nextMinDimension = Math.min(scaledValue, nextMinDimension);\r\n        return scaledValue;\r\n    }));\r\n    if (scaledPoints.length === 2) {\r\n        // we don't tranlate two-point lines\r\n        return scaledPoints;\r\n    }\r\n    const translation = prevMinDimension - nextMinDimension;\r\n    const nextPoints = scaledPoints.map((scaledPoint) => scaledPoint.map((value, currentDimension) => {\r\n        return currentDimension === dimension ? value + translation : value;\r\n    }));\r\n    return nextPoints;\r\n};\r\n","import { distance2d, rotate } from \"../math\";\r\nimport rough from \"roughjs/bin/rough\";\r\nimport { getShapeForElement, generateRoughOptions, } from \"../renderer/renderElement\";\r\nimport { isFreeDrawElement, isLinearElement } from \"./typeChecks\";\r\nimport { rescalePoints } from \"../points\";\r\n// If the element is created from right to left, the width is going to be negative\r\n// This set of functions retrieves the absolute position of the 4 points.\r\nexport const getElementAbsoluteCoords = (element) => {\r\n    if (isFreeDrawElement(element)) {\r\n        return getFreeDrawElementAbsoluteCoords(element);\r\n    }\r\n    else if (isLinearElement(element)) {\r\n        return getLinearElementAbsoluteCoords(element);\r\n    }\r\n    return [\r\n        element.x,\r\n        element.y,\r\n        element.x + element.width,\r\n        element.y + element.height,\r\n    ];\r\n};\r\nexport const pointRelativeTo = (element, absoluteCoords) => {\r\n    return [absoluteCoords[0] - element.x, absoluteCoords[1] - element.y];\r\n};\r\nexport const getDiamondPoints = (element) => {\r\n    // Here we add +1 to avoid these numbers to be 0\r\n    // otherwise rough.js will throw an error complaining about it\r\n    const topX = Math.floor(element.width / 2) + 1;\r\n    const topY = 0;\r\n    const rightX = element.width;\r\n    const rightY = Math.floor(element.height / 2) + 1;\r\n    const bottomX = topX;\r\n    const bottomY = element.height;\r\n    const leftX = 0;\r\n    const leftY = rightY;\r\n    return [topX, topY, rightX, rightY, bottomX, bottomY, leftX, leftY];\r\n};\r\nexport const getCurvePathOps = (shape) => {\r\n    for (const set of shape.sets) {\r\n        if (set.type === \"path\") {\r\n            return set.ops;\r\n        }\r\n    }\r\n    return shape.sets[0].ops;\r\n};\r\nconst getMinMaxXYFromCurvePathOps = (ops, transformXY) => {\r\n    let currentP = [0, 0];\r\n    const { minX, minY, maxX, maxY } = ops.reduce((limits, { op, data }) => {\r\n        // There are only four operation types:\r\n        // move, bcurveTo, lineTo, and curveTo\r\n        if (op === \"move\") {\r\n            // change starting point\r\n            currentP = data;\r\n            // move operation does not draw anything; so, it always\r\n            // returns false\r\n        }\r\n        else if (op === \"bcurveTo\") {\r\n            // create points from bezier curve\r\n            // bezier curve stores data as a flattened array of three positions\r\n            // [x1, y1, x2, y2, x3, y3]\r\n            const p1 = [data[0], data[1]];\r\n            const p2 = [data[2], data[3]];\r\n            const p3 = [data[4], data[5]];\r\n            const p0 = currentP;\r\n            currentP = p3;\r\n            const equation = (t, idx) => Math.pow(1 - t, 3) * p3[idx] +\r\n                3 * t * Math.pow(1 - t, 2) * p2[idx] +\r\n                3 * Math.pow(t, 2) * (1 - t) * p1[idx] +\r\n                p0[idx] * Math.pow(t, 3);\r\n            let t = 0;\r\n            while (t <= 1.0) {\r\n                let x = equation(t, 0);\r\n                let y = equation(t, 1);\r\n                if (transformXY) {\r\n                    [x, y] = transformXY(x, y);\r\n                }\r\n                limits.minY = Math.min(limits.minY, y);\r\n                limits.minX = Math.min(limits.minX, x);\r\n                limits.maxX = Math.max(limits.maxX, x);\r\n                limits.maxY = Math.max(limits.maxY, y);\r\n                t += 0.1;\r\n            }\r\n        }\r\n        else if (op === \"lineTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        else if (op === \"qcurveTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        return limits;\r\n    }, { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n    return [minX, minY, maxX, maxY];\r\n};\r\nconst getBoundsFromPoints = (points) => {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    for (const [x, y] of points) {\r\n        minX = Math.min(minX, x);\r\n        minY = Math.min(minY, y);\r\n        maxX = Math.max(maxX, x);\r\n        maxY = Math.max(maxY, y);\r\n    }\r\n    return [minX, minY, maxX, maxY];\r\n};\r\nconst getFreeDrawElementAbsoluteCoords = (element) => {\r\n    const [minX, minY, maxX, maxY] = getBoundsFromPoints(element.points);\r\n    return [\r\n        minX + element.x,\r\n        minY + element.y,\r\n        maxX + element.x,\r\n        maxY + element.y,\r\n    ];\r\n};\r\nconst getLinearElementAbsoluteCoords = (element) => {\r\n    let coords;\r\n    if (element.points.length < 2 || !getShapeForElement(element)) {\r\n        // XXX this is just a poor estimate and not very useful\r\n        const { minX, minY, maxX, maxY } = element.points.reduce((limits, [x, y]) => {\r\n            limits.minY = Math.min(limits.minY, y);\r\n            limits.minX = Math.min(limits.minX, x);\r\n            limits.maxX = Math.max(limits.maxX, x);\r\n            limits.maxY = Math.max(limits.maxY, y);\r\n            return limits;\r\n        }, { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n        coords = [\r\n            minX + element.x,\r\n            minY + element.y,\r\n            maxX + element.x,\r\n            maxY + element.y,\r\n        ];\r\n    }\r\n    else {\r\n        const shape = getShapeForElement(element);\r\n        // first element is always the curve\r\n        const ops = getCurvePathOps(shape[0]);\r\n        const [minX, minY, maxX, maxY] = getMinMaxXYFromCurvePathOps(ops);\r\n        coords = [\r\n            minX + element.x,\r\n            minY + element.y,\r\n            maxX + element.x,\r\n            maxY + element.y,\r\n        ];\r\n    }\r\n    return coords;\r\n};\r\nexport const getArrowheadPoints = (element, shape, position, arrowhead) => {\r\n    const ops = getCurvePathOps(shape[0]);\r\n    if (ops.length < 1) {\r\n        return null;\r\n    }\r\n    // The index of the bCurve operation to examine.\r\n    const index = position === \"start\" ? 1 : ops.length - 1;\r\n    const data = ops[index].data;\r\n    const p3 = [data[4], data[5]];\r\n    const p2 = [data[2], data[3]];\r\n    const p1 = [data[0], data[1]];\r\n    // We need to find p0 of the bezier curve.\r\n    // It is typically the last point of the previous\r\n    // curve; it can also be the position of moveTo operation.\r\n    const prevOp = ops[index - 1];\r\n    let p0 = [0, 0];\r\n    if (prevOp.op === \"move\") {\r\n        p0 = prevOp.data;\r\n    }\r\n    else if (prevOp.op === \"bcurveTo\") {\r\n        p0 = [prevOp.data[4], prevOp.data[5]];\r\n    }\r\n    // B(t) = p0 * (1-t)^3 + 3p1 * t * (1-t)^2 + 3p2 * t^2 * (1-t) + p3 * t^3\r\n    const equation = (t, idx) => Math.pow(1 - t, 3) * p3[idx] +\r\n        3 * t * Math.pow(1 - t, 2) * p2[idx] +\r\n        3 * Math.pow(t, 2) * (1 - t) * p1[idx] +\r\n        p0[idx] * Math.pow(t, 3);\r\n    // Ee know the last point of the arrow (or the first, if start arrowhead).\r\n    const [x2, y2] = position === \"start\" ? p0 : p3;\r\n    // By using cubic bezier equation (B(t)) and the given parameters,\r\n    // we calculate a point that is closer to the last point.\r\n    // The value 0.3 is chosen arbitrarily and it works best for all\r\n    // the tested cases.\r\n    const [x1, y1] = [equation(0.3, 0), equation(0.3, 1)];\r\n    // Find the normalized direction vector based on the\r\n    // previously calculated points.\r\n    const distance = Math.hypot(x2 - x1, y2 - y1);\r\n    const nx = (x2 - x1) / distance;\r\n    const ny = (y2 - y1) / distance;\r\n    const size = {\r\n        arrow: 30,\r\n        bar: 15,\r\n        dot: 15,\r\n        triangle: 15,\r\n    }[arrowhead]; // pixels (will differ for each arrowhead)\r\n    let length = 0;\r\n    if (arrowhead === \"arrow\") {\r\n        // Length for -> arrows is based on the length of the last section\r\n        const [cx, cy] = element.points[element.points.length - 1];\r\n        const [px, py] = element.points.length > 1\r\n            ? element.points[element.points.length - 2]\r\n            : [0, 0];\r\n        length = Math.hypot(cx - px, cy - py);\r\n    }\r\n    else {\r\n        // Length for other arrowhead types is based on the total length of the line\r\n        for (let i = 0; i < element.points.length; i++) {\r\n            const [px, py] = element.points[i - 1] || [0, 0];\r\n            const [cx, cy] = element.points[i];\r\n            length += Math.hypot(cx - px, cy - py);\r\n        }\r\n    }\r\n    // Scale down the arrowhead until we hit a certain size so that it doesn't look weird.\r\n    // This value is selected by minimizing a minimum size with the last segment of the arrowhead\r\n    const minSize = Math.min(size, length / 2);\r\n    const xs = x2 - nx * minSize;\r\n    const ys = y2 - ny * minSize;\r\n    if (arrowhead === \"dot\") {\r\n        const r = Math.hypot(ys - y2, xs - x2) + element.strokeWidth;\r\n        return [x2, y2, r];\r\n    }\r\n    const angle = {\r\n        arrow: 20,\r\n        bar: 90,\r\n        triangle: 25,\r\n    }[arrowhead]; // degrees\r\n    // Return points\r\n    const [x3, y3] = rotate(xs, ys, x2, y2, (-angle * Math.PI) / 180);\r\n    const [x4, y4] = rotate(xs, ys, x2, y2, (angle * Math.PI) / 180);\r\n    return [x2, y2, x3, y3, x4, y4];\r\n};\r\nconst getLinearElementRotatedBounds = (element, cx, cy) => {\r\n    if (element.points.length < 2 || !getShapeForElement(element)) {\r\n        // XXX this is just a poor estimate and not very useful\r\n        const { minX, minY, maxX, maxY } = element.points.reduce((limits, [x, y]) => {\r\n            [x, y] = rotate(element.x + x, element.y + y, cx, cy, element.angle);\r\n            limits.minY = Math.min(limits.minY, y);\r\n            limits.minX = Math.min(limits.minX, x);\r\n            limits.maxX = Math.max(limits.maxX, x);\r\n            limits.maxY = Math.max(limits.maxY, y);\r\n            return limits;\r\n        }, { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n        return [minX, minY, maxX, maxY];\r\n    }\r\n    const shape = getShapeForElement(element);\r\n    // first element is always the curve\r\n    const ops = getCurvePathOps(shape[0]);\r\n    const transformXY = (x, y) => rotate(element.x + x, element.y + y, cx, cy, element.angle);\r\n    return getMinMaxXYFromCurvePathOps(ops, transformXY);\r\n};\r\n// We could cache this stuff\r\nexport const getElementBounds = (element) => {\r\n    let bounds;\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    if (isFreeDrawElement(element)) {\r\n        const [minX, minY, maxX, maxY] = getBoundsFromPoints(element.points.map(([x, y]) => rotate(x, y, cx - element.x, cy - element.y, element.angle)));\r\n        return [\r\n            minX + element.x,\r\n            minY + element.y,\r\n            maxX + element.x,\r\n            maxY + element.y,\r\n        ];\r\n    }\r\n    else if (isLinearElement(element)) {\r\n        bounds = getLinearElementRotatedBounds(element, cx, cy);\r\n    }\r\n    else if (element.type === \"diamond\") {\r\n        const [x11, y11] = rotate(cx, y1, cx, cy, element.angle);\r\n        const [x12, y12] = rotate(cx, y2, cx, cy, element.angle);\r\n        const [x22, y22] = rotate(x1, cy, cx, cy, element.angle);\r\n        const [x21, y21] = rotate(x2, cy, cx, cy, element.angle);\r\n        const minX = Math.min(x11, x12, x22, x21);\r\n        const minY = Math.min(y11, y12, y22, y21);\r\n        const maxX = Math.max(x11, x12, x22, x21);\r\n        const maxY = Math.max(y11, y12, y22, y21);\r\n        bounds = [minX, minY, maxX, maxY];\r\n    }\r\n    else if (element.type === \"ellipse\") {\r\n        const w = (x2 - x1) / 2;\r\n        const h = (y2 - y1) / 2;\r\n        const cos = Math.cos(element.angle);\r\n        const sin = Math.sin(element.angle);\r\n        const ww = Math.hypot(w * cos, h * sin);\r\n        const hh = Math.hypot(h * cos, w * sin);\r\n        bounds = [cx - ww, cy - hh, cx + ww, cy + hh];\r\n    }\r\n    else {\r\n        const [x11, y11] = rotate(x1, y1, cx, cy, element.angle);\r\n        const [x12, y12] = rotate(x1, y2, cx, cy, element.angle);\r\n        const [x22, y22] = rotate(x2, y2, cx, cy, element.angle);\r\n        const [x21, y21] = rotate(x2, y1, cx, cy, element.angle);\r\n        const minX = Math.min(x11, x12, x22, x21);\r\n        const minY = Math.min(y11, y12, y22, y21);\r\n        const maxX = Math.max(x11, x12, x22, x21);\r\n        const maxY = Math.max(y11, y12, y22, y21);\r\n        bounds = [minX, minY, maxX, maxY];\r\n    }\r\n    return bounds;\r\n};\r\nexport const getCommonBounds = (elements) => {\r\n    if (!elements.length) {\r\n        return [0, 0, 0, 0];\r\n    }\r\n    let minX = Infinity;\r\n    let maxX = -Infinity;\r\n    let minY = Infinity;\r\n    let maxY = -Infinity;\r\n    elements.forEach((element) => {\r\n        const [x1, y1, x2, y2] = getElementBounds(element);\r\n        minX = Math.min(minX, x1);\r\n        minY = Math.min(minY, y1);\r\n        maxX = Math.max(maxX, x2);\r\n        maxY = Math.max(maxY, y2);\r\n    });\r\n    return [minX, minY, maxX, maxY];\r\n};\r\nexport const getResizedElementAbsoluteCoords = (element, nextWidth, nextHeight) => {\r\n    if (!(isLinearElement(element) || isFreeDrawElement(element))) {\r\n        return [\r\n            element.x,\r\n            element.y,\r\n            element.x + nextWidth,\r\n            element.y + nextHeight,\r\n        ];\r\n    }\r\n    const points = rescalePoints(0, nextWidth, rescalePoints(1, nextHeight, element.points));\r\n    let bounds;\r\n    if (isFreeDrawElement(element)) {\r\n        // Free Draw\r\n        bounds = getBoundsFromPoints(points);\r\n    }\r\n    else {\r\n        // Line\r\n        const gen = rough.generator();\r\n        const curve = element.strokeSharpness === \"sharp\"\r\n            ? gen.linearPath(points, generateRoughOptions(element))\r\n            : gen.curve(points, generateRoughOptions(element));\r\n        const ops = getCurvePathOps(curve);\r\n        bounds = getMinMaxXYFromCurvePathOps(ops);\r\n    }\r\n    const [minX, minY, maxX, maxY] = bounds;\r\n    return [\r\n        minX + element.x,\r\n        minY + element.y,\r\n        maxX + element.x,\r\n        maxY + element.y,\r\n    ];\r\n};\r\nexport const getElementPointsCoords = (element, points, sharpness) => {\r\n    // This might be computationally heavey\r\n    const gen = rough.generator();\r\n    const curve = sharpness === \"sharp\"\r\n        ? gen.linearPath(points, generateRoughOptions(element))\r\n        : gen.curve(points, generateRoughOptions(element));\r\n    const ops = getCurvePathOps(curve);\r\n    const [minX, minY, maxX, maxY] = getMinMaxXYFromCurvePathOps(ops);\r\n    return [\r\n        minX + element.x,\r\n        minY + element.y,\r\n        maxX + element.x,\r\n        maxY + element.y,\r\n    ];\r\n};\r\nexport const getClosestElementBounds = (elements, from) => {\r\n    if (!elements.length) {\r\n        return [0, 0, 0, 0];\r\n    }\r\n    let minDistance = Infinity;\r\n    let closestElement = elements[0];\r\n    elements.forEach((element) => {\r\n        const [x1, y1, x2, y2] = getElementBounds(element);\r\n        const distance = distance2d((x1 + x2) / 2, (y1 + y2) / 2, from.x, from.y);\r\n        if (distance < minDistance) {\r\n            minDistance = distance;\r\n            closestElement = element;\r\n        }\r\n    });\r\n    return getElementBounds(closestElement);\r\n};\r\n","import { isTextElement, isLinearElement, isFreeDrawElement, isInitializedImageElement, } from \"../element/typeChecks\";\r\nimport { getDiamondPoints, getElementAbsoluteCoords, getArrowheadPoints, } from \"../element/bounds\";\r\nimport { distance, getFontString, getFontFamilyString, isRTL } from \"../utils\";\r\nimport { isPathALoop } from \"../math\";\r\nimport rough from \"roughjs/bin/rough\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { MAX_DECIMALS_FOR_SVG_EXPORT, MIME_TYPES, SVG_NS } from \"../constants\";\r\nimport { getStroke } from \"perfect-freehand\";\r\nconst defaultAppState = getDefaultAppState();\r\nconst isPendingImageElement = (element, sceneState) => isInitializedImageElement(element) &&\r\n    !sceneState.imageCache.has(element.fileId);\r\nconst getDashArrayDashed = (strokeWidth) => [8, 8 + strokeWidth];\r\nconst getDashArrayDotted = (strokeWidth) => [1.5, 6 + strokeWidth];\r\nconst getCanvasPadding = (element) => element.type === \"freedraw\" ? element.strokeWidth * 12 : 20;\r\nconst generateElementCanvas = (element, zoom, sceneState) => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const context = canvas.getContext(\"2d\");\r\n    const padding = getCanvasPadding(element);\r\n    let canvasOffsetX = 0;\r\n    let canvasOffsetY = 0;\r\n    if (isLinearElement(element) || isFreeDrawElement(element)) {\r\n        let [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        x1 = Math.floor(x1);\r\n        x2 = Math.ceil(x2);\r\n        y1 = Math.floor(y1);\r\n        y2 = Math.ceil(y2);\r\n        canvas.width =\r\n            distance(x1, x2) * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n        canvas.height =\r\n            distance(y1, y2) * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n        canvasOffsetX =\r\n            element.x > x1\r\n                ? Math.floor(distance(element.x, x1)) *\r\n                    window.devicePixelRatio *\r\n                    zoom.value\r\n                : 0;\r\n        canvasOffsetY =\r\n            element.y > y1\r\n                ? Math.floor(distance(element.y, y1)) *\r\n                    window.devicePixelRatio *\r\n                    zoom.value\r\n                : 0;\r\n        context.translate(canvasOffsetX, canvasOffsetY);\r\n    }\r\n    else {\r\n        canvas.width =\r\n            element.width * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n        canvas.height =\r\n            element.height * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n    }\r\n    context.save();\r\n    context.translate(padding * zoom.value, padding * zoom.value);\r\n    context.scale(window.devicePixelRatio * zoom.value, window.devicePixelRatio * zoom.value);\r\n    const rc = rough.canvas(canvas);\r\n    if (sceneState.theme === \"dark\" &&\r\n        isInitializedImageElement(element) &&\r\n        !isPendingImageElement(element, sceneState) &&\r\n        sceneState.imageCache.get(element.fileId)?.mimeType !== MIME_TYPES.svg) {\r\n        // using a stronger invert (100% vs our regular 93%) and saturate\r\n        // as a temp hack to make images in dark theme look closer to original\r\n        // color scheme (it's still not quite there and the clors look slightly\r\n        // desaturing/black is not as black, but...)\r\n        context.filter = \"invert(100%) hue-rotate(180deg) saturate(1.25)\";\r\n    }\r\n    drawElementOnCanvas(element, rc, context, sceneState);\r\n    context.restore();\r\n    return {\r\n        element,\r\n        canvas,\r\n        theme: sceneState.theme,\r\n        canvasZoom: zoom.value,\r\n        canvasOffsetX,\r\n        canvasOffsetY,\r\n    };\r\n};\r\nconst IMAGE_PLACEHOLDER_IMG = document.createElement(\"img\");\r\nIMAGE_PLACEHOLDER_IMG.src = `data:${MIME_TYPES.svg},${encodeURIComponent(`<svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"image\" class=\"svg-inline--fa fa-image fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"#888\" d=\"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z\"></path></svg>`)}`;\r\nconst IMAGE_ERROR_PLACEHOLDER_IMG = document.createElement(\"img\");\r\nIMAGE_ERROR_PLACEHOLDER_IMG.src = `data:${MIME_TYPES.svg},${encodeURIComponent(`<svg viewBox=\"0 0 668 668\" xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" style=\"fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2\"><path d=\"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48ZM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56ZM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48Z\" style=\"fill:#888;fill-rule:nonzero\" transform=\"matrix(.81709 0 0 .81709 124.825 145.825)\"/><path d=\"M256 8C119.034 8 8 119.033 8 256c0 136.967 111.034 248 248 248s248-111.034 248-248S392.967 8 256 8Zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676ZM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676Z\" style=\"fill:#888;fill-rule:nonzero\" transform=\"matrix(.30366 0 0 .30366 506.822 60.065)\"/></svg>`)}`;\r\nconst drawImagePlaceholder = (element, context, zoomValue) => {\r\n    context.fillStyle = \"#E7E7E7\";\r\n    context.fillRect(0, 0, element.width, element.height);\r\n    const imageMinWidthOrHeight = Math.min(element.width, element.height);\r\n    const size = Math.min(imageMinWidthOrHeight, Math.min(imageMinWidthOrHeight * 0.4, 100));\r\n    context.drawImage(element.status === \"error\"\r\n        ? IMAGE_ERROR_PLACEHOLDER_IMG\r\n        : IMAGE_PLACEHOLDER_IMG, element.width / 2 - size / 2, element.height / 2 - size / 2, size, size);\r\n};\r\nconst drawElementOnCanvas = (element, rc, context, sceneState) => {\r\n    context.globalAlpha = element.opacity / 100;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\": {\r\n            context.lineJoin = \"round\";\r\n            context.lineCap = \"round\";\r\n            rc.draw(getShapeForElement(element));\r\n            break;\r\n        }\r\n        case \"arrow\":\r\n        case \"line\": {\r\n            context.lineJoin = \"round\";\r\n            context.lineCap = \"round\";\r\n            getShapeForElement(element).forEach((shape) => {\r\n                rc.draw(shape);\r\n            });\r\n            break;\r\n        }\r\n        case \"freedraw\": {\r\n            // Draw directly to canvas\r\n            context.save();\r\n            context.fillStyle = element.strokeColor;\r\n            const path = getFreeDrawPath2D(element);\r\n            context.fillStyle = element.strokeColor;\r\n            context.fill(path);\r\n            context.restore();\r\n            break;\r\n        }\r\n        case \"image\": {\r\n            const img = isInitializedImageElement(element)\r\n                ? sceneState.imageCache.get(element.fileId)?.image\r\n                : undefined;\r\n            if (img != null && !(img instanceof Promise)) {\r\n                context.drawImage(img, 0 /* hardcoded for the selection box*/, 0, element.width, element.height);\r\n            }\r\n            else {\r\n                drawImagePlaceholder(element, context, sceneState.zoom.value);\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            if (isTextElement(element)) {\r\n                const rtl = isRTL(element.text);\r\n                const shouldTemporarilyAttach = rtl && !context.canvas.isConnected;\r\n                if (shouldTemporarilyAttach) {\r\n                    // to correctly render RTL text mixed with LTR, we have to append it\r\n                    // to the DOM\r\n                    document.body.appendChild(context.canvas);\r\n                }\r\n                context.canvas.setAttribute(\"dir\", rtl ? \"rtl\" : \"ltr\");\r\n                context.save();\r\n                context.font = getFontString(element);\r\n                context.fillStyle = element.strokeColor;\r\n                context.textAlign = element.textAlign;\r\n                // Canvas does not support multiline text by default\r\n                const lines = element.text.replace(/\\r\\n?/g, \"\\n\").split(\"\\n\");\r\n                const lineHeight = element.height / lines.length;\r\n                const verticalOffset = element.height - element.baseline;\r\n                const horizontalOffset = element.textAlign === \"center\"\r\n                    ? element.width / 2\r\n                    : element.textAlign === \"right\"\r\n                        ? element.width\r\n                        : 0;\r\n                for (let index = 0; index < lines.length; index++) {\r\n                    context.fillText(lines[index], horizontalOffset, (index + 1) * lineHeight - verticalOffset);\r\n                }\r\n                context.restore();\r\n                if (shouldTemporarilyAttach) {\r\n                    context.canvas.remove();\r\n                }\r\n            }\r\n            else {\r\n                throw new Error(`Unimplemented type ${element.type}`);\r\n            }\r\n        }\r\n    }\r\n    context.globalAlpha = 1;\r\n};\r\nconst elementWithCanvasCache = new WeakMap();\r\nconst shapeCache = new WeakMap();\r\nexport const getShapeForElement = (element) => shapeCache.get(element);\r\nexport const invalidateShapeForElement = (element) => shapeCache.delete(element);\r\nexport const generateRoughOptions = (element, continuousPath = false) => {\r\n    const options = {\r\n        seed: element.seed,\r\n        strokeLineDash: element.strokeStyle === \"dashed\"\r\n            ? getDashArrayDashed(element.strokeWidth)\r\n            : element.strokeStyle === \"dotted\"\r\n                ? getDashArrayDotted(element.strokeWidth)\r\n                : undefined,\r\n        // for non-solid strokes, disable multiStroke because it tends to make\r\n        // dashes/dots overlay each other\r\n        disableMultiStroke: element.strokeStyle !== \"solid\",\r\n        // for non-solid strokes, increase the width a bit to make it visually\r\n        // similar to solid strokes, because we're also disabling multiStroke\r\n        strokeWidth: element.strokeStyle !== \"solid\"\r\n            ? element.strokeWidth + 0.5\r\n            : element.strokeWidth,\r\n        // when increasing strokeWidth, we must explicitly set fillWeight and\r\n        // hachureGap because if not specified, roughjs uses strokeWidth to\r\n        // calculate them (and we don't want the fills to be modified)\r\n        fillWeight: element.strokeWidth / 2,\r\n        hachureGap: element.strokeWidth * 4,\r\n        roughness: element.roughness,\r\n        stroke: element.strokeColor,\r\n        preserveVertices: continuousPath,\r\n        // disable decimals to fix Skia rendering issues #4046\r\n        fixedDecimalPlaceDigits: 0,\r\n    };\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\": {\r\n            options.fillStyle = element.fillStyle;\r\n            options.fill =\r\n                element.backgroundColor === \"transparent\"\r\n                    ? undefined\r\n                    : element.backgroundColor;\r\n            if (element.type === \"ellipse\") {\r\n                options.curveFitting = 1;\r\n            }\r\n            return options;\r\n        }\r\n        case \"line\": {\r\n            if (isPathALoop(element.points)) {\r\n                options.fillStyle = element.fillStyle;\r\n                options.fill =\r\n                    element.backgroundColor === \"transparent\"\r\n                        ? undefined\r\n                        : element.backgroundColor;\r\n            }\r\n            return options;\r\n        }\r\n        case \"freedraw\":\r\n        case \"arrow\":\r\n            return options;\r\n        default: {\r\n            throw new Error(`Unimplemented type ${element.type}`);\r\n        }\r\n    }\r\n};\r\n/**\r\n * Generates the element's shape and puts it into the cache.\r\n * @param element\r\n * @param generator\r\n */\r\nconst generateElementShape = (element, generator) => {\r\n    let shape = shapeCache.get(element) || null;\r\n    if (!shape) {\r\n        elementWithCanvasCache.delete(element);\r\n        switch (element.type) {\r\n            case \"rectangle\":\r\n                if (element.strokeSharpness === \"round\") {\r\n                    const w = element.width;\r\n                    const h = element.height;\r\n                    const r = Math.min(w, h) * 0.25;\r\n                    shape = generator.path(`M ${r} 0 L ${w - r} 0 Q ${w} 0, ${w} ${r} L ${w} ${h - r} Q ${w} ${h}, ${w - r} ${h} L ${r} ${h} Q 0 ${h}, 0 ${h - r} L 0 ${r} Q 0 0, ${r} 0`, generateRoughOptions(element, true));\r\n                }\r\n                else {\r\n                    shape = generator.rectangle(0, 0, element.width, element.height, generateRoughOptions(element));\r\n                }\r\n                break;\r\n            case \"diamond\": {\r\n                const [topX, topY, rightX, rightY, bottomX, bottomY, leftX, leftY] = getDiamondPoints(element);\r\n                shape = generator.polygon([\r\n                    [topX, topY],\r\n                    [rightX, rightY],\r\n                    [bottomX, bottomY],\r\n                    [leftX, leftY],\r\n                ], generateRoughOptions(element));\r\n                break;\r\n            }\r\n            case \"ellipse\":\r\n                shape = generator.ellipse(element.width / 2, element.height / 2, element.width, element.height, generateRoughOptions(element));\r\n                break;\r\n            case \"line\":\r\n            case \"arrow\": {\r\n                const options = generateRoughOptions(element);\r\n                // points array can be empty in the beginning, so it is important to add\r\n                // initial position to it\r\n                const points = element.points.length ? element.points : [[0, 0]];\r\n                // curve is always the first element\r\n                // this simplifies finding the curve for an element\r\n                if (element.strokeSharpness === \"sharp\") {\r\n                    if (options.fill) {\r\n                        shape = [generator.polygon(points, options)];\r\n                    }\r\n                    else {\r\n                        shape = [\r\n                            generator.linearPath(points, options),\r\n                        ];\r\n                    }\r\n                }\r\n                else {\r\n                    shape = [generator.curve(points, options)];\r\n                }\r\n                // add lines only in arrow\r\n                if (element.type === \"arrow\") {\r\n                    const { startArrowhead = null, endArrowhead = \"arrow\" } = element;\r\n                    const getArrowheadShapes = (element, shape, position, arrowhead) => {\r\n                        const arrowheadPoints = getArrowheadPoints(element, shape, position, arrowhead);\r\n                        if (arrowheadPoints === null) {\r\n                            return [];\r\n                        }\r\n                        // Other arrowheads here...\r\n                        if (arrowhead === \"dot\") {\r\n                            const [x, y, r] = arrowheadPoints;\r\n                            return [\r\n                                generator.circle(x, y, r, {\r\n                                    ...options,\r\n                                    fill: element.strokeColor,\r\n                                    fillStyle: \"solid\",\r\n                                    stroke: \"none\",\r\n                                }),\r\n                            ];\r\n                        }\r\n                        if (arrowhead === \"triangle\") {\r\n                            const [x, y, x2, y2, x3, y3] = arrowheadPoints;\r\n                            // always use solid stroke for triangle arrowhead\r\n                            delete options.strokeLineDash;\r\n                            return [\r\n                                generator.polygon([\r\n                                    [x, y],\r\n                                    [x2, y2],\r\n                                    [x3, y3],\r\n                                    [x, y],\r\n                                ], {\r\n                                    ...options,\r\n                                    fill: element.strokeColor,\r\n                                    fillStyle: \"solid\",\r\n                                }),\r\n                            ];\r\n                        }\r\n                        // Arrow arrowheads\r\n                        const [x2, y2, x3, y3, x4, y4] = arrowheadPoints;\r\n                        if (element.strokeStyle === \"dotted\") {\r\n                            // for dotted arrows caps, reduce gap to make it more legible\r\n                            const dash = getDashArrayDotted(element.strokeWidth - 1);\r\n                            options.strokeLineDash = [dash[0], dash[1] - 1];\r\n                        }\r\n                        else {\r\n                            // for solid/dashed, keep solid arrow cap\r\n                            delete options.strokeLineDash;\r\n                        }\r\n                        return [\r\n                            generator.line(x3, y3, x2, y2, options),\r\n                            generator.line(x4, y4, x2, y2, options),\r\n                        ];\r\n                    };\r\n                    if (startArrowhead !== null) {\r\n                        const shapes = getArrowheadShapes(element, shape, \"start\", startArrowhead);\r\n                        shape.push(...shapes);\r\n                    }\r\n                    if (endArrowhead !== null) {\r\n                        if (endArrowhead === undefined) {\r\n                            // Hey, we have an old arrow here!\r\n                        }\r\n                        const shapes = getArrowheadShapes(element, shape, \"end\", endArrowhead);\r\n                        shape.push(...shapes);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"freedraw\": {\r\n                generateFreeDrawShape(element);\r\n                shape = [];\r\n                break;\r\n            }\r\n            case \"text\":\r\n            case \"image\": {\r\n                // just to ensure we don't regenerate element.canvas on rerenders\r\n                shape = [];\r\n                break;\r\n            }\r\n        }\r\n        shapeCache.set(element, shape);\r\n    }\r\n};\r\nconst generateElementWithCanvas = (element, sceneState) => {\r\n    const zoom = sceneState ? sceneState.zoom : defaultAppState.zoom;\r\n    const prevElementWithCanvas = elementWithCanvasCache.get(element);\r\n    const shouldRegenerateBecauseZoom = prevElementWithCanvas &&\r\n        prevElementWithCanvas.canvasZoom !== zoom.value &&\r\n        !sceneState?.shouldCacheIgnoreZoom;\r\n    if (!prevElementWithCanvas ||\r\n        shouldRegenerateBecauseZoom ||\r\n        prevElementWithCanvas.theme !== sceneState.theme) {\r\n        const elementWithCanvas = generateElementCanvas(element, zoom, sceneState);\r\n        elementWithCanvasCache.set(element, elementWithCanvas);\r\n        return elementWithCanvas;\r\n    }\r\n    return prevElementWithCanvas;\r\n};\r\nconst drawElementFromCanvas = (elementWithCanvas, rc, context, sceneState) => {\r\n    const element = elementWithCanvas.element;\r\n    const padding = getCanvasPadding(element);\r\n    let [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    // Free draw elements will otherwise \"shuffle\" as the min x and y change\r\n    if (isFreeDrawElement(element)) {\r\n        x1 = Math.floor(x1);\r\n        x2 = Math.ceil(x2);\r\n        y1 = Math.floor(y1);\r\n        y2 = Math.ceil(y2);\r\n    }\r\n    const cx = ((x1 + x2) / 2 + sceneState.scrollX) * window.devicePixelRatio;\r\n    const cy = ((y1 + y2) / 2 + sceneState.scrollY) * window.devicePixelRatio;\r\n    const _isPendingImageElement = isPendingImageElement(element, sceneState);\r\n    const scaleXFactor = \"scale\" in elementWithCanvas.element && !_isPendingImageElement\r\n        ? elementWithCanvas.element.scale[0]\r\n        : 1;\r\n    const scaleYFactor = \"scale\" in elementWithCanvas.element && !_isPendingImageElement\r\n        ? elementWithCanvas.element.scale[1]\r\n        : 1;\r\n    context.save();\r\n    context.scale((1 / window.devicePixelRatio) * scaleXFactor, (1 / window.devicePixelRatio) * scaleYFactor);\r\n    context.translate(cx * scaleXFactor, cy * scaleYFactor);\r\n    context.rotate(element.angle * scaleXFactor * scaleYFactor);\r\n    context.drawImage(elementWithCanvas.canvas, (-(x2 - x1) / 2) * window.devicePixelRatio -\r\n        (padding * elementWithCanvas.canvasZoom) / elementWithCanvas.canvasZoom, (-(y2 - y1) / 2) * window.devicePixelRatio -\r\n        (padding * elementWithCanvas.canvasZoom) / elementWithCanvas.canvasZoom, elementWithCanvas.canvas.width / elementWithCanvas.canvasZoom, elementWithCanvas.canvas.height / elementWithCanvas.canvasZoom);\r\n    context.restore();\r\n    // Clear the nested element we appended to the DOM\r\n};\r\nexport const renderElement = (element, rc, context, renderOptimizations, sceneState) => {\r\n    const generator = rc.generator;\r\n    switch (element.type) {\r\n        case \"selection\": {\r\n            context.save();\r\n            context.translate(element.x + sceneState.scrollX, element.y + sceneState.scrollY);\r\n            context.fillStyle = \"rgba(0, 0, 255, 0.10)\";\r\n            context.fillRect(0, 0, element.width, element.height);\r\n            context.restore();\r\n            break;\r\n        }\r\n        case \"freedraw\": {\r\n            generateElementShape(element, generator);\r\n            if (renderOptimizations) {\r\n                const elementWithCanvas = generateElementWithCanvas(element, sceneState);\r\n                drawElementFromCanvas(elementWithCanvas, rc, context, sceneState);\r\n            }\r\n            else {\r\n                const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n                const cx = (x1 + x2) / 2 + sceneState.scrollX;\r\n                const cy = (y1 + y2) / 2 + sceneState.scrollY;\r\n                const shiftX = (x2 - x1) / 2 - (element.x - x1);\r\n                const shiftY = (y2 - y1) / 2 - (element.y - y1);\r\n                context.save();\r\n                context.translate(cx, cy);\r\n                context.rotate(element.angle);\r\n                context.translate(-shiftX, -shiftY);\r\n                drawElementOnCanvas(element, rc, context, sceneState);\r\n                context.restore();\r\n            }\r\n            break;\r\n        }\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\":\r\n        case \"line\":\r\n        case \"arrow\":\r\n        case \"image\":\r\n        case \"text\": {\r\n            generateElementShape(element, generator);\r\n            if (renderOptimizations) {\r\n                const elementWithCanvas = generateElementWithCanvas(element, sceneState);\r\n                drawElementFromCanvas(elementWithCanvas, rc, context, sceneState);\r\n            }\r\n            else {\r\n                const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n                const cx = (x1 + x2) / 2 + sceneState.scrollX;\r\n                const cy = (y1 + y2) / 2 + sceneState.scrollY;\r\n                const shiftX = (x2 - x1) / 2 - (element.x - x1);\r\n                const shiftY = (y2 - y1) / 2 - (element.y - y1);\r\n                context.save();\r\n                context.translate(cx, cy);\r\n                context.rotate(element.angle);\r\n                context.translate(-shiftX, -shiftY);\r\n                drawElementOnCanvas(element, rc, context, sceneState);\r\n                context.restore();\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            // @ts-ignore\r\n            throw new Error(`Unimplemented type ${element.type}`);\r\n        }\r\n    }\r\n};\r\nconst roughSVGDrawWithPrecision = (rsvg, drawable, precision) => {\r\n    if (typeof precision === \"undefined\") {\r\n        return rsvg.draw(drawable);\r\n    }\r\n    const pshape = {\r\n        sets: drawable.sets,\r\n        shape: drawable.shape,\r\n        options: { ...drawable.options, fixedDecimalPlaceDigits: precision },\r\n    };\r\n    return rsvg.draw(pshape);\r\n};\r\nexport const renderElementToSvg = (element, rsvg, svgRoot, files, offsetX, offsetY) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x2 - x1) / 2 - (element.x - x1);\r\n    const cy = (y2 - y1) / 2 - (element.y - y1);\r\n    const degree = (180 * element.angle) / Math.PI;\r\n    const generator = rsvg.generator;\r\n    switch (element.type) {\r\n        case \"selection\": {\r\n            // Since this is used only during editing experience, which is canvas based,\r\n            // this should not happen\r\n            throw new Error(\"Selection rendering is not supported for SVG\");\r\n        }\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\": {\r\n            generateElementShape(element, generator);\r\n            const node = roughSVGDrawWithPrecision(rsvg, getShapeForElement(element), MAX_DECIMALS_FOR_SVG_EXPORT);\r\n            const opacity = element.opacity / 100;\r\n            if (opacity !== 1) {\r\n                node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n            }\r\n            node.setAttribute(\"stroke-linecap\", \"round\");\r\n            node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n            svgRoot.appendChild(node);\r\n            break;\r\n        }\r\n        case \"line\":\r\n        case \"arrow\": {\r\n            generateElementShape(element, generator);\r\n            const group = svgRoot.ownerDocument.createElementNS(SVG_NS, \"g\");\r\n            const opacity = element.opacity / 100;\r\n            group.setAttribute(\"stroke-linecap\", \"round\");\r\n            getShapeForElement(element).forEach((shape) => {\r\n                const node = roughSVGDrawWithPrecision(rsvg, shape, MAX_DECIMALS_FOR_SVG_EXPORT);\r\n                if (opacity !== 1) {\r\n                    node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                    node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n                }\r\n                node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n                if (element.type === \"line\" &&\r\n                    isPathALoop(element.points) &&\r\n                    element.backgroundColor !== \"transparent\") {\r\n                    node.setAttribute(\"fill-rule\", \"evenodd\");\r\n                }\r\n                group.appendChild(node);\r\n            });\r\n            svgRoot.appendChild(group);\r\n            break;\r\n        }\r\n        case \"freedraw\": {\r\n            generateFreeDrawShape(element);\r\n            const opacity = element.opacity / 100;\r\n            const node = svgRoot.ownerDocument.createElementNS(SVG_NS, \"g\");\r\n            if (opacity !== 1) {\r\n                node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n            }\r\n            node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n            const path = svgRoot.ownerDocument.createElementNS(SVG_NS, \"path\");\r\n            node.setAttribute(\"stroke\", \"none\");\r\n            node.setAttribute(\"fill\", element.strokeColor);\r\n            path.setAttribute(\"d\", getFreeDrawSvgPath(element));\r\n            node.appendChild(path);\r\n            svgRoot.appendChild(node);\r\n            break;\r\n        }\r\n        case \"image\": {\r\n            const fileData = isInitializedImageElement(element) && files[element.fileId];\r\n            if (fileData) {\r\n                const symbolId = `image-${fileData.id}`;\r\n                let symbol = svgRoot.querySelector(`#${symbolId}`);\r\n                if (!symbol) {\r\n                    symbol = svgRoot.ownerDocument.createElementNS(SVG_NS, \"symbol\");\r\n                    symbol.id = symbolId;\r\n                    const image = svgRoot.ownerDocument.createElementNS(SVG_NS, \"image\");\r\n                    image.setAttribute(\"width\", \"100%\");\r\n                    image.setAttribute(\"height\", \"100%\");\r\n                    image.setAttribute(\"href\", fileData.dataURL);\r\n                    symbol.appendChild(image);\r\n                    svgRoot.prepend(symbol);\r\n                }\r\n                const use = svgRoot.ownerDocument.createElementNS(SVG_NS, \"use\");\r\n                use.setAttribute(\"href\", `#${symbolId}`);\r\n                use.setAttribute(\"width\", `${Math.round(element.width)}`);\r\n                use.setAttribute(\"height\", `${Math.round(element.height)}`);\r\n                use.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n                svgRoot.appendChild(use);\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            if (isTextElement(element)) {\r\n                const opacity = element.opacity / 100;\r\n                const node = svgRoot.ownerDocument.createElementNS(SVG_NS, \"g\");\r\n                if (opacity !== 1) {\r\n                    node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                    node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n                }\r\n                node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n                const lines = element.text.replace(/\\r\\n?/g, \"\\n\").split(\"\\n\");\r\n                const lineHeight = element.height / lines.length;\r\n                const verticalOffset = element.height - element.baseline;\r\n                const horizontalOffset = element.textAlign === \"center\"\r\n                    ? element.width / 2\r\n                    : element.textAlign === \"right\"\r\n                        ? element.width\r\n                        : 0;\r\n                const direction = isRTL(element.text) ? \"rtl\" : \"ltr\";\r\n                const textAnchor = element.textAlign === \"center\"\r\n                    ? \"middle\"\r\n                    : element.textAlign === \"right\" || direction === \"rtl\"\r\n                        ? \"end\"\r\n                        : \"start\";\r\n                for (let i = 0; i < lines.length; i++) {\r\n                    const text = svgRoot.ownerDocument.createElementNS(SVG_NS, \"text\");\r\n                    text.textContent = lines[i];\r\n                    text.setAttribute(\"x\", `${horizontalOffset}`);\r\n                    text.setAttribute(\"y\", `${(i + 1) * lineHeight - verticalOffset}`);\r\n                    text.setAttribute(\"font-family\", getFontFamilyString(element));\r\n                    text.setAttribute(\"font-size\", `${element.fontSize}px`);\r\n                    text.setAttribute(\"fill\", element.strokeColor);\r\n                    text.setAttribute(\"text-anchor\", textAnchor);\r\n                    text.setAttribute(\"style\", \"white-space: pre;\");\r\n                    text.setAttribute(\"direction\", direction);\r\n                    node.appendChild(text);\r\n                }\r\n                svgRoot.appendChild(node);\r\n            }\r\n            else {\r\n                // @ts-ignore\r\n                throw new Error(`Unimplemented type ${element.type}`);\r\n            }\r\n        }\r\n    }\r\n};\r\nexport const pathsCache = new WeakMap([]);\r\nexport function generateFreeDrawShape(element) {\r\n    const svgPathData = getFreeDrawSvgPath(element);\r\n    const path = new Path2D(svgPathData);\r\n    pathsCache.set(element, path);\r\n    return path;\r\n}\r\nexport function getFreeDrawPath2D(element) {\r\n    return pathsCache.get(element);\r\n}\r\nexport function getFreeDrawSvgPath(element) {\r\n    // If input points are empty (should they ever be?) return a dot\r\n    const inputPoints = element.simulatePressure\r\n        ? element.points\r\n        : element.points.length\r\n            ? element.points.map(([x, y], i) => [x, y, element.pressures[i]])\r\n            : [[0, 0, 0.5]];\r\n    // Consider changing the options for simulated pressure vs real pressure\r\n    const options = {\r\n        simulatePressure: element.simulatePressure,\r\n        size: element.strokeWidth * 4.25,\r\n        thinning: 0.6,\r\n        smoothing: 0.5,\r\n        streamline: 0.5,\r\n        easing: (t) => Math.sin((t * Math.PI) / 2),\r\n        last: !!element.lastCommittedPoint, // LastCommittedPoint is added on pointerup\r\n    };\r\n    return getSvgPathFromStroke(getStroke(inputPoints, options));\r\n}\r\nfunction med(A, B) {\r\n    return [(A[0] + B[0]) / 2, (A[1] + B[1]) / 2];\r\n}\r\n// Trim SVG path data so number are each two decimal points. This\r\n// improves SVG exports, and prevents rendering errors on points\r\n// with long decimals.\r\nconst TO_FIXED_PRECISION = /(\\s?[A-Z]?,?-?[0-9]*\\.[0-9]{0,2})(([0-9]|e|-)*)/g;\r\nfunction getSvgPathFromStroke(points) {\r\n    if (!points.length) {\r\n        return \"\";\r\n    }\r\n    const max = points.length - 1;\r\n    return points\r\n        .reduce((acc, point, i, arr) => {\r\n        if (i === max) {\r\n            acc.push(point, med(point, arr[0]), \"L\", arr[0], \"Z\");\r\n        }\r\n        else {\r\n            acc.push(point, med(point, arr[i + 1]));\r\n        }\r\n        return acc;\r\n    }, [\"M\", points[0], \"Q\"])\r\n        .join(\" \")\r\n        .replace(TO_FIXED_PRECISION, \"$1\");\r\n}\r\n","import { getNonDeletedElements, isNonDeletedElement } from \"../element\";\r\nconst isIdKey = (elementKey) => {\r\n    if (typeof elementKey === \"string\") {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nclass Scene {\r\n    constructor() {\r\n        // ---------------------------------------------------------------------------\r\n        // static methods/props\r\n        // ---------------------------------------------------------------------------\r\n        // ---------------------------------------------------------------------------\r\n        // instance methods/props\r\n        // ---------------------------------------------------------------------------\r\n        this.callbacks = new Set();\r\n        this.nonDeletedElements = [];\r\n        this.elements = [];\r\n        this.elementsMap = new Map();\r\n    }\r\n    static mapElementToScene(elementKey, scene) {\r\n        if (isIdKey(elementKey)) {\r\n            this.sceneMapById.set(elementKey, scene);\r\n        }\r\n        else {\r\n            this.sceneMapByElement.set(elementKey, scene);\r\n        }\r\n    }\r\n    static getScene(elementKey) {\r\n        if (isIdKey(elementKey)) {\r\n            return this.sceneMapById.get(elementKey) || null;\r\n        }\r\n        return this.sceneMapByElement.get(elementKey) || null;\r\n    }\r\n    // TODO: getAllElementsIncludingDeleted\r\n    getElementsIncludingDeleted() {\r\n        return this.elements;\r\n    }\r\n    // TODO: getAllNonDeletedElements\r\n    getElements() {\r\n        return this.nonDeletedElements;\r\n    }\r\n    getElement(id) {\r\n        return this.elementsMap.get(id) || null;\r\n    }\r\n    getNonDeletedElement(id) {\r\n        const element = this.getElement(id);\r\n        if (element && isNonDeletedElement(element)) {\r\n            return element;\r\n        }\r\n        return null;\r\n    }\r\n    // TODO: Rename methods here, this is confusing\r\n    getNonDeletedElements(ids) {\r\n        const result = [];\r\n        ids.forEach((id) => {\r\n            const element = this.getNonDeletedElement(id);\r\n            if (element != null) {\r\n                result.push(element);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n    replaceAllElements(nextElements) {\r\n        this.elements = nextElements;\r\n        this.elementsMap.clear();\r\n        nextElements.forEach((element) => {\r\n            this.elementsMap.set(element.id, element);\r\n            Scene.mapElementToScene(element, this);\r\n        });\r\n        this.nonDeletedElements = getNonDeletedElements(this.elements);\r\n        this.informMutation();\r\n    }\r\n    informMutation() {\r\n        for (const callback of Array.from(this.callbacks)) {\r\n            callback();\r\n        }\r\n    }\r\n    addCallback(cb) {\r\n        if (this.callbacks.has(cb)) {\r\n            throw new Error();\r\n        }\r\n        this.callbacks.add(cb);\r\n        return () => {\r\n            if (!this.callbacks.has(cb)) {\r\n                throw new Error();\r\n            }\r\n            this.callbacks.delete(cb);\r\n        };\r\n    }\r\n    destroy() {\r\n        Scene.sceneMapById.forEach((scene, elementKey) => {\r\n            if (scene === this) {\r\n                Scene.sceneMapById.delete(elementKey);\r\n            }\r\n        });\r\n        // done not for memory leaks, but to guard against possible late fires\r\n        // (I guess?)\r\n        this.callbacks.clear();\r\n    }\r\n}\r\nScene.sceneMapByElement = new WeakMap();\r\nScene.sceneMapById = new Map();\r\nexport default Scene;\r\n","import { Random } from \"roughjs/bin/math\";\r\nimport { nanoid } from \"nanoid\";\r\nlet random = new Random(Date.now());\r\nlet testIdBase = 0;\r\nexport const randomInteger = () => Math.floor(random.next() * 2 ** 31);\r\nexport const reseed = (seed) => {\r\n    random = new Random(seed);\r\n    testIdBase = 0;\r\n};\r\nexport const randomId = () => process.env.NODE_ENV === \"test\" ? `id${testIdBase++}` : nanoid();\r\n","import { invalidateShapeForElement } from \"../renderer/renderElement\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { getSizeFromPoints } from \"../points\";\r\nimport { randomInteger } from \"../random\";\r\n// This function tracks updates of text elements for the purposes for collaboration.\r\n// The version is used to compare updates when more than one user is working in\r\n// the same drawing. Note: this will trigger the component to update. Make sure you\r\n// are calling it either from a React event handler or within unstable_batchedUpdates().\r\nexport const mutateElement = (element, updates, informMutation = true) => {\r\n    let didChange = false;\r\n    // casting to any because can't use `in` operator\r\n    // (see https://github.com/microsoft/TypeScript/issues/21732)\r\n    const { points, fileId } = updates;\r\n    if (typeof points !== \"undefined\") {\r\n        updates = { ...getSizeFromPoints(points), ...updates };\r\n    }\r\n    for (const key in updates) {\r\n        const value = updates[key];\r\n        if (typeof value !== \"undefined\") {\r\n            if (element[key] === value &&\r\n                // if object, always update because its attrs could have changed\r\n                // (except for specific keys we handle below)\r\n                (typeof value !== \"object\" ||\r\n                    value === null ||\r\n                    key === \"groupIds\" ||\r\n                    key === \"scale\")) {\r\n                continue;\r\n            }\r\n            if (key === \"scale\") {\r\n                const prevScale = element[key];\r\n                const nextScale = value;\r\n                if (prevScale[0] === nextScale[0] && prevScale[1] === nextScale[1]) {\r\n                    continue;\r\n                }\r\n            }\r\n            else if (key === \"points\") {\r\n                const prevPoints = element[key];\r\n                const nextPoints = value;\r\n                if (prevPoints.length === nextPoints.length) {\r\n                    let didChangePoints = false;\r\n                    let index = prevPoints.length;\r\n                    while (--index) {\r\n                        const prevPoint = prevPoints[index];\r\n                        const nextPoint = nextPoints[index];\r\n                        if (prevPoint[0] !== nextPoint[0] ||\r\n                            prevPoint[1] !== nextPoint[1]) {\r\n                            didChangePoints = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!didChangePoints) {\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n            element[key] = value;\r\n            didChange = true;\r\n        }\r\n    }\r\n    if (!didChange) {\r\n        return element;\r\n    }\r\n    if (typeof updates.height !== \"undefined\" ||\r\n        typeof updates.width !== \"undefined\" ||\r\n        typeof fileId != \"undefined\" ||\r\n        typeof points !== \"undefined\") {\r\n        invalidateShapeForElement(element);\r\n    }\r\n    element.version++;\r\n    element.versionNonce = randomInteger();\r\n    if (informMutation) {\r\n        Scene.getScene(element)?.informMutation();\r\n    }\r\n    return element;\r\n};\r\nexport const newElementWith = (element, updates) => {\r\n    let didChange = false;\r\n    for (const key in updates) {\r\n        const value = updates[key];\r\n        if (typeof value !== \"undefined\") {\r\n            if (element[key] === value &&\r\n                // if object, always update because its attrs could have changed\r\n                (typeof value !== \"object\" || value === null)) {\r\n                continue;\r\n            }\r\n            didChange = true;\r\n        }\r\n    }\r\n    if (!didChange) {\r\n        return element;\r\n    }\r\n    return {\r\n        ...element,\r\n        ...updates,\r\n        version: element.version + 1,\r\n        versionNonce: randomInteger(),\r\n    };\r\n};\r\n/**\r\n * Mutates element and updates `version` & `versionNonce`.\r\n *\r\n * NOTE: does not trigger re-render.\r\n */\r\nexport const bumpVersion = (element, version) => {\r\n    element.version = (version ?? element.version) + 1;\r\n    element.versionNonce = randomInteger();\r\n    return element;\r\n};\r\n","import { mutateElement } from \"./mutateElement\";\r\nimport { isFreeDrawElement, isLinearElement } from \"./typeChecks\";\r\nimport { SHIFT_LOCKING_ANGLE } from \"../constants\";\r\nexport const isInvisiblySmallElement = (element) => {\r\n    if (isLinearElement(element) || isFreeDrawElement(element)) {\r\n        return element.points.length < 2;\r\n    }\r\n    return element.width === 0 && element.height === 0;\r\n};\r\n/**\r\n * Makes a perfect shape or diagonal/horizontal/vertical line\r\n */\r\nexport const getPerfectElementSize = (elementType, width, height) => {\r\n    const absWidth = Math.abs(width);\r\n    const absHeight = Math.abs(height);\r\n    if (elementType === \"line\" ||\r\n        elementType === \"arrow\" ||\r\n        elementType === \"freedraw\") {\r\n        const lockedAngle = Math.round(Math.atan(absHeight / absWidth) / SHIFT_LOCKING_ANGLE) *\r\n            SHIFT_LOCKING_ANGLE;\r\n        if (lockedAngle === 0) {\r\n            height = 0;\r\n        }\r\n        else if (lockedAngle === Math.PI / 2) {\r\n            width = 0;\r\n        }\r\n        else {\r\n            height =\r\n                Math.round(absWidth * Math.tan(lockedAngle)) * Math.sign(height) ||\r\n                    height;\r\n        }\r\n    }\r\n    else if (elementType !== \"selection\") {\r\n        height = absWidth * Math.sign(height);\r\n    }\r\n    return { width, height };\r\n};\r\nexport const resizePerfectLineForNWHandler = (element, x, y) => {\r\n    const anchorX = element.x + element.width;\r\n    const anchorY = element.y + element.height;\r\n    const distanceToAnchorX = x - anchorX;\r\n    const distanceToAnchorY = y - anchorY;\r\n    if (Math.abs(distanceToAnchorX) < Math.abs(distanceToAnchorY) / 2) {\r\n        mutateElement(element, {\r\n            x: anchorX,\r\n            width: 0,\r\n            y,\r\n            height: -distanceToAnchorY,\r\n        });\r\n    }\r\n    else if (Math.abs(distanceToAnchorY) < Math.abs(element.width) / 2) {\r\n        mutateElement(element, {\r\n            y: anchorY,\r\n            height: 0,\r\n        });\r\n    }\r\n    else {\r\n        const nextHeight = Math.sign(distanceToAnchorY) *\r\n            Math.sign(distanceToAnchorX) *\r\n            element.width;\r\n        mutateElement(element, {\r\n            x,\r\n            y: anchorY - nextHeight,\r\n            width: -distanceToAnchorX,\r\n            height: nextHeight,\r\n        });\r\n    }\r\n};\r\nexport const getNormalizedDimensions = (element) => {\r\n    const ret = {\r\n        width: element.width,\r\n        height: element.height,\r\n        x: element.x,\r\n        y: element.y,\r\n    };\r\n    if (element.width < 0) {\r\n        const nextWidth = Math.abs(element.width);\r\n        ret.width = nextWidth;\r\n        ret.x = element.x - nextWidth;\r\n    }\r\n    if (element.height < 0) {\r\n        const nextHeight = Math.abs(element.height);\r\n        ret.height = nextHeight;\r\n        ret.y = element.y - nextHeight;\r\n    }\r\n    return ret;\r\n};\r\n","import { getSelectedElements } from \"./scene\";\r\nexport const selectGroup = (groupId, appState, elements) => {\r\n    const elementsInGroup = elements.filter((element) => element.groupIds.includes(groupId));\r\n    if (elementsInGroup.length < 2) {\r\n        if (appState.selectedGroupIds[groupId] ||\r\n            appState.editingGroupId === groupId) {\r\n            return {\r\n                ...appState,\r\n                selectedGroupIds: { ...appState.selectedGroupIds, [groupId]: false },\r\n                editingGroupId: null,\r\n            };\r\n        }\r\n        return appState;\r\n    }\r\n    return {\r\n        ...appState,\r\n        selectedGroupIds: { ...appState.selectedGroupIds, [groupId]: true },\r\n        selectedElementIds: {\r\n            ...appState.selectedElementIds,\r\n            ...Object.fromEntries(elementsInGroup.map((element) => [element.id, true])),\r\n        },\r\n    };\r\n};\r\n/**\r\n * If the element's group is selected, don't render an individual\r\n * selection border around it.\r\n */\r\nexport const isSelectedViaGroup = (appState, element) => getSelectedGroupForElement(appState, element) != null;\r\nexport const getSelectedGroupForElement = (appState, element) => element.groupIds\r\n    .filter((groupId) => groupId !== appState.editingGroupId)\r\n    .find((groupId) => appState.selectedGroupIds[groupId]);\r\nexport const getSelectedGroupIds = (appState) => Object.entries(appState.selectedGroupIds)\r\n    .filter(([groupId, isSelected]) => isSelected)\r\n    .map(([groupId, isSelected]) => groupId);\r\n/**\r\n * When you select an element, you often want to actually select the whole group it's in, unless\r\n * you're currently editing that group.\r\n */\r\nexport const selectGroupsForSelectedElements = (appState, elements) => {\r\n    let nextAppState = { ...appState, selectedGroupIds: {} };\r\n    const selectedElements = getSelectedElements(elements, appState);\r\n    if (!selectedElements.length) {\r\n        return { ...nextAppState, editingGroupId: null };\r\n    }\r\n    for (const selectedElement of selectedElements) {\r\n        let groupIds = selectedElement.groupIds;\r\n        if (appState.editingGroupId) {\r\n            // handle the case where a group is nested within a group\r\n            const indexOfEditingGroup = groupIds.indexOf(appState.editingGroupId);\r\n            if (indexOfEditingGroup > -1) {\r\n                groupIds = groupIds.slice(0, indexOfEditingGroup);\r\n            }\r\n        }\r\n        if (groupIds.length > 0) {\r\n            const groupId = groupIds[groupIds.length - 1];\r\n            nextAppState = selectGroup(groupId, nextAppState, elements);\r\n        }\r\n    }\r\n    return nextAppState;\r\n};\r\nexport const editGroupForSelectedElement = (appState, element) => {\r\n    return {\r\n        ...appState,\r\n        editingGroupId: element.groupIds.length ? element.groupIds[0] : null,\r\n        selectedGroupIds: {},\r\n        selectedElementIds: {\r\n            [element.id]: true,\r\n        },\r\n    };\r\n};\r\nexport const isElementInGroup = (element, groupId) => element.groupIds.includes(groupId);\r\nexport const getElementsInGroup = (elements, groupId) => elements.filter((element) => isElementInGroup(element, groupId));\r\nexport const getSelectedGroupIdForElement = (element, selectedGroupIds) => element.groupIds.find((groupId) => selectedGroupIds[groupId]);\r\nexport const getNewGroupIdsForDuplication = (groupIds, editingGroupId, mapper) => {\r\n    const copy = [...groupIds];\r\n    const positionOfEditingGroupId = editingGroupId\r\n        ? groupIds.indexOf(editingGroupId)\r\n        : -1;\r\n    const endIndex = positionOfEditingGroupId > -1 ? positionOfEditingGroupId : groupIds.length;\r\n    for (let index = 0; index < endIndex; index++) {\r\n        copy[index] = mapper(copy[index]);\r\n    }\r\n    return copy;\r\n};\r\nexport const addToGroup = (prevGroupIds, newGroupId, editingGroupId) => {\r\n    // insert before the editingGroupId, or push to the end.\r\n    const groupIds = [...prevGroupIds];\r\n    const positionOfEditingGroupId = editingGroupId\r\n        ? groupIds.indexOf(editingGroupId)\r\n        : -1;\r\n    const positionToInsert = positionOfEditingGroupId > -1 ? positionOfEditingGroupId : groupIds.length;\r\n    groupIds.splice(positionToInsert, 0, newGroupId);\r\n    return groupIds;\r\n};\r\nexport const removeFromSelectedGroups = (groupIds, selectedGroupIds) => groupIds.filter((groupId) => !selectedGroupIds[groupId]);\r\n","import { measureText, getFontString } from \"../utils\";\r\nimport { randomInteger, randomId } from \"../random\";\r\nimport { newElementWith } from \"./mutateElement\";\r\nimport { getNewGroupIdsForDuplication } from \"../groups\";\r\nimport { getElementAbsoluteCoords } from \".\";\r\nimport { adjustXYWithRotation } from \"../math\";\r\nimport { getResizedElementAbsoluteCoords } from \"./bounds\";\r\nconst _newElementBase = (type, { x, y, strokeColor, backgroundColor, fillStyle, strokeWidth, strokeStyle, roughness, opacity, width = 0, height = 0, angle = 0, groupIds = [], strokeSharpness, boundElementIds = null, ...rest }) => ({\r\n    id: rest.id || randomId(),\r\n    type,\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    angle,\r\n    strokeColor,\r\n    backgroundColor,\r\n    fillStyle,\r\n    strokeWidth,\r\n    strokeStyle,\r\n    roughness,\r\n    opacity,\r\n    groupIds,\r\n    strokeSharpness,\r\n    seed: rest.seed ?? randomInteger(),\r\n    version: rest.version || 1,\r\n    versionNonce: rest.versionNonce ?? 0,\r\n    isDeleted: false,\r\n    boundElementIds,\r\n});\r\nexport const newElement = (opts) => _newElementBase(opts.type, opts);\r\n/** computes element x/y offset based on textAlign/verticalAlign */\r\nconst getTextElementPositionOffsets = (opts, metrics) => {\r\n    return {\r\n        x: opts.textAlign === \"center\"\r\n            ? metrics.width / 2\r\n            : opts.textAlign === \"right\"\r\n                ? metrics.width\r\n                : 0,\r\n        y: opts.verticalAlign === \"middle\" ? metrics.height / 2 : 0,\r\n    };\r\n};\r\nexport const newTextElement = (opts) => {\r\n    const metrics = measureText(opts.text, getFontString(opts));\r\n    const offsets = getTextElementPositionOffsets(opts, metrics);\r\n    const textElement = newElementWith({\r\n        ..._newElementBase(\"text\", opts),\r\n        text: opts.text,\r\n        fontSize: opts.fontSize,\r\n        fontFamily: opts.fontFamily,\r\n        textAlign: opts.textAlign,\r\n        verticalAlign: opts.verticalAlign,\r\n        x: opts.x - offsets.x,\r\n        y: opts.y - offsets.y,\r\n        width: metrics.width,\r\n        height: metrics.height,\r\n        baseline: metrics.baseline,\r\n    }, {});\r\n    return textElement;\r\n};\r\nconst getAdjustedDimensions = (element, nextText) => {\r\n    const { width: nextWidth, height: nextHeight, baseline: nextBaseline, } = measureText(nextText, getFontString(element));\r\n    const { textAlign, verticalAlign } = element;\r\n    let x;\r\n    let y;\r\n    if (textAlign === \"center\" && verticalAlign === \"middle\") {\r\n        const prevMetrics = measureText(element.text, getFontString(element));\r\n        const offsets = getTextElementPositionOffsets(element, {\r\n            width: nextWidth - prevMetrics.width,\r\n            height: nextHeight - prevMetrics.height,\r\n        });\r\n        x = element.x - offsets.x;\r\n        y = element.y - offsets.y;\r\n    }\r\n    else {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const [nextX1, nextY1, nextX2, nextY2] = getResizedElementAbsoluteCoords(element, nextWidth, nextHeight);\r\n        const deltaX1 = (x1 - nextX1) / 2;\r\n        const deltaY1 = (y1 - nextY1) / 2;\r\n        const deltaX2 = (x2 - nextX2) / 2;\r\n        const deltaY2 = (y2 - nextY2) / 2;\r\n        [x, y] = adjustXYWithRotation({\r\n            s: true,\r\n            e: textAlign === \"center\" || textAlign === \"left\",\r\n            w: textAlign === \"center\" || textAlign === \"right\",\r\n        }, element.x, element.y, element.angle, deltaX1, deltaY1, deltaX2, deltaY2);\r\n    }\r\n    return {\r\n        width: nextWidth,\r\n        height: nextHeight,\r\n        x: Number.isFinite(x) ? x : element.x,\r\n        y: Number.isFinite(y) ? y : element.y,\r\n        baseline: nextBaseline,\r\n    };\r\n};\r\nexport const updateTextElement = (element, { text, isDeleted }) => {\r\n    return newElementWith(element, {\r\n        text,\r\n        isDeleted: isDeleted ?? element.isDeleted,\r\n        ...getAdjustedDimensions(element, text),\r\n    });\r\n};\r\nexport const newFreeDrawElement = (opts) => {\r\n    return {\r\n        ..._newElementBase(opts.type, opts),\r\n        points: opts.points || [],\r\n        pressures: [],\r\n        simulatePressure: opts.simulatePressure,\r\n        lastCommittedPoint: null,\r\n    };\r\n};\r\nexport const newLinearElement = (opts) => {\r\n    return {\r\n        ..._newElementBase(opts.type, opts),\r\n        points: opts.points || [],\r\n        lastCommittedPoint: null,\r\n        startBinding: null,\r\n        endBinding: null,\r\n        startArrowhead: opts.startArrowhead,\r\n        endArrowhead: opts.endArrowhead,\r\n    };\r\n};\r\nexport const newImageElement = (opts) => {\r\n    return {\r\n        ..._newElementBase(\"image\", opts),\r\n        // in the future we'll support changing stroke color for some SVG elements,\r\n        // and `transparent` will likely mean \"use original colors of the image\"\r\n        strokeColor: \"transparent\",\r\n        status: \"pending\",\r\n        fileId: null,\r\n        scale: [1, 1],\r\n    };\r\n};\r\n// Simplified deep clone for the purpose of cloning ExcalidrawElement only\r\n// (doesn't clone Date, RegExp, Map, Set, Typed arrays etc.)\r\n//\r\n// Adapted from https://github.com/lukeed/klona\r\nexport const deepCopyElement = (val, depth = 0) => {\r\n    if (val == null || typeof val !== \"object\") {\r\n        return val;\r\n    }\r\n    if (Object.prototype.toString.call(val) === \"[object Object]\") {\r\n        const tmp = typeof val.constructor === \"function\"\r\n            ? Object.create(Object.getPrototypeOf(val))\r\n            : {};\r\n        for (const key in val) {\r\n            if (val.hasOwnProperty(key)) {\r\n                // don't copy top-level shape property, which we want to regenerate\r\n                if (depth === 0 && (key === \"shape\" || key === \"canvas\")) {\r\n                    continue;\r\n                }\r\n                tmp[key] = deepCopyElement(val[key], depth + 1);\r\n            }\r\n        }\r\n        return tmp;\r\n    }\r\n    if (Array.isArray(val)) {\r\n        let k = val.length;\r\n        const arr = new Array(k);\r\n        while (k--) {\r\n            arr[k] = deepCopyElement(val[k], depth + 1);\r\n        }\r\n        return arr;\r\n    }\r\n    return val;\r\n};\r\n/**\r\n * Duplicate an element, often used in the alt-drag operation.\r\n * Note that this method has gotten a bit complicated since the\r\n * introduction of gruoping/ungrouping elements.\r\n * @param editingGroupId The current group being edited. The new\r\n *                       element will inherit this group and its\r\n *                       parents.\r\n * @param groupIdMapForOperation A Map that maps old group IDs to\r\n *                               duplicated ones. If you are duplicating\r\n *                               multiple elements at once, share this map\r\n *                               amongst all of them\r\n * @param element Element to duplicate\r\n * @param overrides Any element properties to override\r\n */\r\nexport const duplicateElement = (editingGroupId, groupIdMapForOperation, element, overrides) => {\r\n    let copy = deepCopyElement(element);\r\n    if (process.env.NODE_ENV === \"test\") {\r\n        copy.id = `${copy.id}_copy`;\r\n        // `window.h` may not be defined in some unit tests\r\n        if (window.h?.app\r\n            ?.getSceneElementsIncludingDeleted()\r\n            .find((el) => el.id === copy.id)) {\r\n            copy.id += \"_copy\";\r\n        }\r\n    }\r\n    else {\r\n        copy.id = randomId();\r\n    }\r\n    copy.seed = randomInteger();\r\n    copy.groupIds = getNewGroupIdsForDuplication(copy.groupIds, editingGroupId, (groupId) => {\r\n        if (!groupIdMapForOperation.has(groupId)) {\r\n            groupIdMapForOperation.set(groupId, randomId());\r\n        }\r\n        return groupIdMapForOperation.get(groupId);\r\n    });\r\n    if (overrides) {\r\n        copy = Object.assign(copy, overrides);\r\n    }\r\n    return copy;\r\n};\r\n","import { getElementAbsoluteCoords } from \"./bounds\";\r\nimport { rotate } from \"../math\";\r\nconst transformHandleSizes = {\r\n    mouse: 8,\r\n    pen: 16,\r\n    touch: 28,\r\n};\r\nconst ROTATION_RESIZE_HANDLE_GAP = 16;\r\nexport const OMIT_SIDES_FOR_MULTIPLE_ELEMENTS = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n};\r\nconst OMIT_SIDES_FOR_TEXT_ELEMENT = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n};\r\nconst OMIT_SIDES_FOR_LINE_SLASH = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n    nw: true,\r\n    se: true,\r\n};\r\nconst OMIT_SIDES_FOR_LINE_BACKSLASH = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n    ne: true,\r\n    sw: true,\r\n};\r\nconst generateTransformHandle = (x, y, width, height, cx, cy, angle) => {\r\n    const [xx, yy] = rotate(x + width / 2, y + height / 2, cx, cy, angle);\r\n    return [xx - width / 2, yy - height / 2, width, height];\r\n};\r\nexport const getTransformHandlesFromCoords = ([x1, y1, x2, y2], angle, zoom, pointerType, omitSides = {}) => {\r\n    const size = transformHandleSizes[pointerType];\r\n    const handleWidth = size / zoom.value;\r\n    const handleHeight = size / zoom.value;\r\n    const handleMarginX = size / zoom.value;\r\n    const handleMarginY = size / zoom.value;\r\n    const width = x2 - x1;\r\n    const height = y2 - y1;\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    const dashedLineMargin = 4 / zoom.value;\r\n    const centeringOffset = (size - 8) / (2 * zoom.value);\r\n    const transformHandles = {\r\n        nw: omitSides.nw\r\n            ? undefined\r\n            : generateTransformHandle(x1 - dashedLineMargin - handleMarginX + centeringOffset, y1 - dashedLineMargin - handleMarginY + centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        ne: omitSides.ne\r\n            ? undefined\r\n            : generateTransformHandle(x2 + dashedLineMargin - centeringOffset, y1 - dashedLineMargin - handleMarginY + centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        sw: omitSides.sw\r\n            ? undefined\r\n            : generateTransformHandle(x1 - dashedLineMargin - handleMarginX + centeringOffset, y2 + dashedLineMargin - centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        se: omitSides.se\r\n            ? undefined\r\n            : generateTransformHandle(x2 + dashedLineMargin - centeringOffset, y2 + dashedLineMargin - centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        rotation: omitSides.rotation\r\n            ? undefined\r\n            : generateTransformHandle(x1 + width / 2 - handleWidth / 2, y1 -\r\n                dashedLineMargin -\r\n                handleMarginY +\r\n                centeringOffset -\r\n                ROTATION_RESIZE_HANDLE_GAP / zoom.value, handleWidth, handleHeight, cx, cy, angle),\r\n    };\r\n    // We only want to show height handles (all cardinal directions)  above a certain size\r\n    // Note: we render using \"mouse\" size so we should also use \"mouse\" size for this check\r\n    const minimumSizeForEightHandles = (5 * transformHandleSizes.mouse) / zoom.value;\r\n    if (Math.abs(width) > minimumSizeForEightHandles) {\r\n        if (!omitSides.n) {\r\n            transformHandles.n = generateTransformHandle(x1 + width / 2 - handleWidth / 2, y1 - dashedLineMargin - handleMarginY + centeringOffset, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n        if (!omitSides.s) {\r\n            transformHandles.s = generateTransformHandle(x1 + width / 2 - handleWidth / 2, y2 + dashedLineMargin - centeringOffset, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n    }\r\n    if (Math.abs(height) > minimumSizeForEightHandles) {\r\n        if (!omitSides.w) {\r\n            transformHandles.w = generateTransformHandle(x1 - dashedLineMargin - handleMarginX + centeringOffset, y1 + height / 2 - handleHeight / 2, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n        if (!omitSides.e) {\r\n            transformHandles.e = generateTransformHandle(x2 + dashedLineMargin - centeringOffset, y1 + height / 2 - handleHeight / 2, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n    }\r\n    return transformHandles;\r\n};\r\nexport const getTransformHandles = (element, zoom, pointerType = \"mouse\") => {\r\n    let omitSides = {};\r\n    if (element.type === \"arrow\" ||\r\n        element.type === \"line\" ||\r\n        element.type === \"freedraw\") {\r\n        if (element.points.length === 2) {\r\n            // only check the last point because starting point is always (0,0)\r\n            const [, p1] = element.points;\r\n            if (p1[0] === 0 || p1[1] === 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_BACKSLASH;\r\n            }\r\n            else if (p1[0] > 0 && p1[1] < 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_SLASH;\r\n            }\r\n            else if (p1[0] > 0 && p1[1] > 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_BACKSLASH;\r\n            }\r\n            else if (p1[0] < 0 && p1[1] > 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_SLASH;\r\n            }\r\n            else if (p1[0] < 0 && p1[1] < 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_BACKSLASH;\r\n            }\r\n        }\r\n    }\r\n    else if (element.type === \"text\") {\r\n        omitSides = OMIT_SIDES_FOR_TEXT_ELEMENT;\r\n    }\r\n    return getTransformHandlesFromCoords(getElementAbsoluteCoords(element), element.angle, zoom, pointerType, omitSides);\r\n};\r\n","/**\r\n * This is a 2D Projective Geometric Algebra implementation.\r\n *\r\n * For wider context on geometric algebra visit see https://bivector.net.\r\n *\r\n * For this specific algebra see cheatsheet https://bivector.net/2DPGA.pdf.\r\n *\r\n * Converted from generator written by enki, with a ton of added on top.\r\n *\r\n * This library uses 8-vectors to represent points, directions and lines\r\n * in 2D space.\r\n *\r\n * An array `[a, b, c, d, e, f, g, h]` represents a n(8)vector:\r\n *   a + b*e0 + c*e1 + d*e2 + e*e01 + f*e20 + g*e12 + h*e012\r\n *\r\n * See GAPoint, GALine, GADirection and GATransform modules for common\r\n * operations.\r\n */\r\nexport const point = (x, y) => [0, 0, 0, 0, y, x, 1, 0];\r\nexport const origin = () => [0, 0, 0, 0, 0, 0, 1, 0];\r\nexport const direction = (x, y) => {\r\n    const norm = Math.hypot(x, y); // same as `inorm(direction(x, y))`\r\n    return [0, 0, 0, 0, y / norm, x / norm, 0, 0];\r\n};\r\nexport const offset = (x, y) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    y,\r\n    x,\r\n    0,\r\n    0,\r\n];\r\n// These are labels for what each number in an nvector represents\r\nconst NVECTOR_BASE = [\"1\", \"e0\", \"e1\", \"e2\", \"e01\", \"e20\", \"e12\", \"e012\"];\r\n// Used to represent points, lines and transformations\r\nexport const nvector = (value = 0, index = 0) => {\r\n    const result = [0, 0, 0, 0, 0, 0, 0, 0];\r\n    if (index < 0 || index > 7) {\r\n        throw new Error(`Expected \\`index\\` betwen 0 and 7, got \\`${index}\\``);\r\n    }\r\n    if (value !== 0) {\r\n        result[index] = value;\r\n    }\r\n    return result;\r\n};\r\nconst STRING_EPSILON = 0.000001;\r\nexport const toString = (nvector) => {\r\n    const result = nvector\r\n        .map((value, index) => Math.abs(value) > STRING_EPSILON\r\n        ? value.toFixed(7).replace(/(\\.|0+)$/, \"\") +\r\n            (index > 0 ? NVECTOR_BASE[index] : \"\")\r\n        : null)\r\n        .filter((representation) => representation != null)\r\n        .join(\" + \");\r\n    return result === \"\" ? \"0\" : result;\r\n};\r\n// Reverse the order of the basis blades.\r\nexport const reverse = (nvector) => [\r\n    nvector[0],\r\n    nvector[1],\r\n    nvector[2],\r\n    nvector[3],\r\n    -nvector[4],\r\n    -nvector[5],\r\n    -nvector[6],\r\n    -nvector[7],\r\n];\r\n// Poincare duality operator.\r\nexport const dual = (nvector) => [\r\n    nvector[7],\r\n    nvector[6],\r\n    nvector[5],\r\n    nvector[4],\r\n    nvector[3],\r\n    nvector[2],\r\n    nvector[1],\r\n    nvector[0],\r\n];\r\n// Clifford Conjugation\r\nexport const conjugate = (nvector) => [\r\n    nvector[0],\r\n    -nvector[1],\r\n    -nvector[2],\r\n    -nvector[3],\r\n    -nvector[4],\r\n    -nvector[5],\r\n    -nvector[6],\r\n    nvector[7],\r\n];\r\n// Main involution\r\nexport const involute = (nvector) => [\r\n    nvector[0],\r\n    -nvector[1],\r\n    -nvector[2],\r\n    -nvector[3],\r\n    nvector[4],\r\n    nvector[5],\r\n    nvector[6],\r\n    -nvector[7],\r\n];\r\n// Multivector addition\r\nexport const add = (a, b) => {\r\n    if (isNumber(b)) {\r\n        return [a[0] + b, a[1], a[2], a[3], a[4], a[5], a[6], a[7]];\r\n    }\r\n    return [\r\n        a[0] + b[0],\r\n        a[1] + b[1],\r\n        a[2] + b[2],\r\n        a[3] + b[3],\r\n        a[4] + b[4],\r\n        a[5] + b[5],\r\n        a[6] + b[6],\r\n        a[7] + b[7],\r\n    ];\r\n};\r\n// Multivector subtraction\r\nexport const sub = (a, b) => {\r\n    if (isNumber(b)) {\r\n        return [a[0] - b, a[1], a[2], a[3], a[4], a[5], a[6], a[7]];\r\n    }\r\n    return [\r\n        a[0] - b[0],\r\n        a[1] - b[1],\r\n        a[2] - b[2],\r\n        a[3] - b[3],\r\n        a[4] - b[4],\r\n        a[5] - b[5],\r\n        a[6] - b[6],\r\n        a[7] - b[7],\r\n    ];\r\n};\r\n// The geometric product.\r\nexport const mul = (a, b) => {\r\n    if (isNumber(b)) {\r\n        return [\r\n            a[0] * b,\r\n            a[1] * b,\r\n            a[2] * b,\r\n            a[3] * b,\r\n            a[4] * b,\r\n            a[5] * b,\r\n            a[6] * b,\r\n            a[7] * b,\r\n        ];\r\n    }\r\n    return [\r\n        mulScalar(a, b),\r\n        b[1] * a[0] +\r\n            b[0] * a[1] -\r\n            b[4] * a[2] +\r\n            b[5] * a[3] +\r\n            b[2] * a[4] -\r\n            b[3] * a[5] -\r\n            b[7] * a[6] -\r\n            b[6] * a[7],\r\n        b[2] * a[0] + b[0] * a[2] - b[6] * a[3] + b[3] * a[6],\r\n        b[3] * a[0] + b[6] * a[2] + b[0] * a[3] - b[2] * a[6],\r\n        b[4] * a[0] +\r\n            b[2] * a[1] -\r\n            b[1] * a[2] +\r\n            b[7] * a[3] +\r\n            b[0] * a[4] +\r\n            b[6] * a[5] -\r\n            b[5] * a[6] +\r\n            b[3] * a[7],\r\n        b[5] * a[0] -\r\n            b[3] * a[1] +\r\n            b[7] * a[2] +\r\n            b[1] * a[3] -\r\n            b[6] * a[4] +\r\n            b[0] * a[5] +\r\n            b[4] * a[6] +\r\n            b[2] * a[7],\r\n        b[6] * a[0] + b[3] * a[2] - b[2] * a[3] + b[0] * a[6],\r\n        b[7] * a[0] +\r\n            b[6] * a[1] +\r\n            b[5] * a[2] +\r\n            b[4] * a[3] +\r\n            b[3] * a[4] +\r\n            b[2] * a[5] +\r\n            b[1] * a[6] +\r\n            b[0] * a[7],\r\n    ];\r\n};\r\nexport const mulScalar = (a, b) => b[0] * a[0] + b[2] * a[2] + b[3] * a[3] - b[6] * a[6];\r\n// The outer/exterior/wedge product.\r\nexport const meet = (a, b) => [\r\n    b[0] * a[0],\r\n    b[1] * a[0] + b[0] * a[1],\r\n    b[2] * a[0] + b[0] * a[2],\r\n    b[3] * a[0] + b[0] * a[3],\r\n    b[4] * a[0] + b[2] * a[1] - b[1] * a[2] + b[0] * a[4],\r\n    b[5] * a[0] - b[3] * a[1] + b[1] * a[3] + b[0] * a[5],\r\n    b[6] * a[0] + b[3] * a[2] - b[2] * a[3] + b[0] * a[6],\r\n    b[7] * a[0] +\r\n        b[6] * a[1] +\r\n        b[5] * a[2] +\r\n        b[4] * a[3] +\r\n        b[3] * a[4] +\r\n        b[2] * a[5] +\r\n        b[1] * a[6],\r\n];\r\n// The regressive product.\r\nexport const join = (a, b) => [\r\n    joinScalar(a, b),\r\n    a[1] * b[7] + a[4] * b[5] - a[5] * b[4] + a[7] * b[1],\r\n    a[2] * b[7] - a[4] * b[6] + a[6] * b[4] + a[7] * b[2],\r\n    a[3] * b[7] + a[5] * b[6] - a[6] * b[5] + a[7] * b[3],\r\n    a[4] * b[7] + a[7] * b[4],\r\n    a[5] * b[7] + a[7] * b[5],\r\n    a[6] * b[7] + a[7] * b[6],\r\n    a[7] * b[7],\r\n];\r\nexport const joinScalar = (a, b) => a[0] * b[7] +\r\n    a[1] * b[6] +\r\n    a[2] * b[5] +\r\n    a[3] * b[4] +\r\n    a[4] * b[3] +\r\n    a[5] * b[2] +\r\n    a[6] * b[1] +\r\n    a[7] * b[0];\r\n// The inner product.\r\nexport const dot = (a, b) => [\r\n    b[0] * a[0] + b[2] * a[2] + b[3] * a[3] - b[6] * a[6],\r\n    b[1] * a[0] +\r\n        b[0] * a[1] -\r\n        b[4] * a[2] +\r\n        b[5] * a[3] +\r\n        b[2] * a[4] -\r\n        b[3] * a[5] -\r\n        b[7] * a[6] -\r\n        b[6] * a[7],\r\n    b[2] * a[0] + b[0] * a[2] - b[6] * a[3] + b[3] * a[6],\r\n    b[3] * a[0] + b[6] * a[2] + b[0] * a[3] - b[2] * a[6],\r\n    b[4] * a[0] + b[7] * a[3] + b[0] * a[4] + b[3] * a[7],\r\n    b[5] * a[0] + b[7] * a[2] + b[0] * a[5] + b[2] * a[7],\r\n    b[6] * a[0] + b[0] * a[6],\r\n    b[7] * a[0] + b[0] * a[7],\r\n];\r\nexport const norm = (a) => Math.sqrt(Math.abs(a[0] * a[0] - a[2] * a[2] - a[3] * a[3] + a[6] * a[6]));\r\nexport const inorm = (a) => Math.sqrt(Math.abs(a[7] * a[7] - a[5] * a[5] - a[4] * a[4] + a[1] * a[1]));\r\nexport const normalized = (a) => {\r\n    const n = norm(a);\r\n    if (n === 0 || n === 1) {\r\n        return a;\r\n    }\r\n    const sign = a[6] < 0 ? -1 : 1;\r\n    return mul(a, sign / n);\r\n};\r\nexport const inormalized = (a) => {\r\n    const n = inorm(a);\r\n    if (n === 0 || n === 1) {\r\n        return a;\r\n    }\r\n    return mul(a, 1 / n);\r\n};\r\nconst isNumber = (a) => typeof a === \"number\";\r\nexport const E0 = nvector(1, 1);\r\nexport const E1 = nvector(1, 2);\r\nexport const E2 = nvector(1, 3);\r\nexport const E01 = nvector(1, 4);\r\nexport const E20 = nvector(1, 5);\r\nexport const E12 = nvector(1, 6);\r\nexport const E012 = nvector(1, 7);\r\nexport const I = E012;\r\n","import * as GA from \"./ga\";\r\n/**\r\n * A line is stored as an array `[0, c, a, b, 0, 0, 0, 0]` representing:\r\n *   c * e0 + a * e1 + b*e2\r\n *\r\n * This maps to a standard formula `a * x + b * y + c`.\r\n *\r\n * `(-b, a)` correponds to a 2D vector parallel to the line. The lines\r\n * have a natural orientation, corresponding to that vector.\r\n *\r\n * The magnitude (\"norm\") of the line is `sqrt(a ^ 2 + b ^ 2)`.\r\n * `c / norm(line)` is the oriented distance from line to origin.\r\n */\r\n// Returns line with direction (x, y) through origin\r\nexport const vector = (x, y) => GA.normalized([0, 0, -y, x, 0, 0, 0, 0]);\r\n// For equation ax + by + c = 0.\r\nexport const equation = (a, b, c) => GA.normalized([0, c, a, b, 0, 0, 0, 0]);\r\nexport const through = (from, to) => GA.normalized(GA.join(to, from));\r\nexport const orthogonal = (line, point) => GA.dot(line, point);\r\n// Returns a line perpendicular to the line through `against` and `intersection`\r\n// going through `intersection`.\r\nexport const orthogonalThrough = (against, intersection) => orthogonal(through(against, intersection), intersection);\r\nexport const parallel = (line, distance) => {\r\n    const result = line.slice();\r\n    result[1] -= distance;\r\n    return result;\r\n};\r\nexport const parallelThrough = (line, point) => orthogonal(orthogonal(point, line), point);\r\nexport const distance = (line1, line2) => GA.inorm(GA.meet(line1, line2));\r\nexport const angle = (line1, line2) => Math.acos(GA.dot(line1, line2)[0]);\r\n// The orientation of the line\r\nexport const sign = (line) => Math.sign(line[1]);\r\n","import * as GA from \"./ga\";\r\nimport * as GALine from \"./galines\";\r\nimport { join } from \"./ga\";\r\nexport const from = ([x, y]) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    y,\r\n    x,\r\n    1,\r\n    0,\r\n];\r\nexport const toTuple = (point) => [point[5], point[4]];\r\nexport const abs = (point) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    Math.abs(point[4]),\r\n    Math.abs(point[5]),\r\n    1,\r\n    0,\r\n];\r\nexport const intersect = (line1, line2) => GA.normalized(GA.meet(line1, line2));\r\n// Projects `point` onto the `line`.\r\n// The returned point is the closest point on the `line` to the `point`.\r\nexport const project = (point, line) => intersect(GALine.orthogonal(line, point), line);\r\nexport const distance = (point1, point2) => GA.norm(join(point1, point2));\r\nexport const distanceToLine = (point, line) => GA.joinScalar(point, line);\r\n","import * as GA from \"./ga\";\r\n/**\r\n * A direction is stored as an array `[0, 0, 0, 0, y, x, 0, 0]` representing\r\n * vector `(x, y)`.\r\n */\r\nexport const from = (point) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    point[4],\r\n    point[5],\r\n    0,\r\n    0,\r\n];\r\nexport const fromTo = (from, to) => GA.inormalized([0, 0, 0, 0, to[4] - from[4], to[5] - from[5], 0, 0]);\r\nexport const orthogonal = (direction) => GA.inormalized([0, 0, 0, 0, -direction[5], direction[4], 0, 0]);\r\nexport const orthogonalToLine = (line) => GA.mul(line, GA.I);\r\n","import * as GA from \"./ga\";\r\nimport * as GADirection from \"./gadirections\";\r\n/**\r\n * TODO: docs\r\n */\r\nexport const rotation = (pivot, angle) => GA.add(GA.mul(pivot, Math.sin(angle / 2)), Math.cos(angle / 2));\r\nexport const translation = (direction) => [\r\n    1,\r\n    0,\r\n    0,\r\n    0,\r\n    -(0.5 * direction[5]),\r\n    0.5 * direction[4],\r\n    0,\r\n    0,\r\n];\r\nexport const translationOrthogonal = (direction, distance) => {\r\n    const scale = 0.5 * distance;\r\n    return [1, 0, 0, 0, scale * direction[4], scale * direction[5], 0, 0];\r\n};\r\nexport const translationAlong = (line, distance) => GA.add(GA.mul(GADirection.orthogonalToLine(line), 0.5 * distance), 1);\r\nexport const compose = (motor1, motor2) => GA.mul(motor2, motor1);\r\nexport const apply = (motor, nvector) => GA.normalized(GA.mul(GA.mul(motor, nvector), GA.reverse(motor)));\r\n","import * as GA from \"../ga\";\r\nimport * as GAPoint from \"../gapoints\";\r\nimport * as GADirection from \"../gadirections\";\r\nimport * as GALine from \"../galines\";\r\nimport * as GATransform from \"../gatransforms\";\r\nimport { distance2d, rotatePoint, isPathALoop, isPointInPolygon, rotate, } from \"../math\";\r\nimport { pointsOnBezierCurves } from \"points-on-curve\";\r\nimport { getElementAbsoluteCoords, getCurvePathOps } from \"./bounds\";\r\nimport { getShapeForElement } from \"../renderer/renderElement\";\r\nimport { isImageElement } from \"./typeChecks\";\r\nconst isElementDraggableFromInside = (element) => {\r\n    if (element.type === \"arrow\") {\r\n        return false;\r\n    }\r\n    if (element.type === \"freedraw\") {\r\n        return true;\r\n    }\r\n    const isDraggableFromInside = element.backgroundColor !== \"transparent\";\r\n    if (element.type === \"line\") {\r\n        return isDraggableFromInside && isPathALoop(element.points);\r\n    }\r\n    return isDraggableFromInside || isImageElement(element);\r\n};\r\nexport const hitTest = (element, appState, x, y) => {\r\n    // How many pixels off the shape boundary we still consider a hit\r\n    const threshold = 10 / appState.zoom.value;\r\n    const point = [x, y];\r\n    if (isElementSelected(appState, element)) {\r\n        return isPointHittingElementBoundingBox(element, point, threshold);\r\n    }\r\n    return isHittingElementNotConsideringBoundingBox(element, appState, point);\r\n};\r\nexport const isHittingElementBoundingBoxWithoutHittingElement = (element, appState, x, y) => {\r\n    const threshold = 10 / appState.zoom.value;\r\n    return (!isHittingElementNotConsideringBoundingBox(element, appState, [x, y]) &&\r\n        isPointHittingElementBoundingBox(element, [x, y], threshold));\r\n};\r\nconst isHittingElementNotConsideringBoundingBox = (element, appState, point) => {\r\n    const threshold = 10 / appState.zoom.value;\r\n    const check = element.type === \"text\"\r\n        ? isStrictlyInside\r\n        : isElementDraggableFromInside(element)\r\n            ? isInsideCheck\r\n            : isNearCheck;\r\n    return hitTestPointAgainstElement({ element, point, threshold, check });\r\n};\r\nconst isElementSelected = (appState, element) => appState.selectedElementIds[element.id];\r\nconst isPointHittingElementBoundingBox = (element, [x, y], threshold) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const elementCenterX = (x1 + x2) / 2;\r\n    const elementCenterY = (y1 + y2) / 2;\r\n    // reverse rotate to take element's angle into account.\r\n    const [rotatedX, rotatedY] = rotate(x, y, elementCenterX, elementCenterY, -element.angle);\r\n    return (rotatedX > x1 - threshold &&\r\n        rotatedX < x2 + threshold &&\r\n        rotatedY > y1 - threshold &&\r\n        rotatedY < y2 + threshold);\r\n};\r\nexport const bindingBorderTest = (element, { x, y }) => {\r\n    const threshold = maxBindingGap(element, element.width, element.height);\r\n    const check = isOutsideCheck;\r\n    const point = [x, y];\r\n    return hitTestPointAgainstElement({ element, point, threshold, check });\r\n};\r\nexport const maxBindingGap = (element, elementWidth, elementHeight) => {\r\n    // Aligns diamonds with rectangles\r\n    const shapeRatio = element.type === \"diamond\" ? 1 / Math.sqrt(2) : 1;\r\n    const smallerDimension = shapeRatio * Math.min(elementWidth, elementHeight);\r\n    // We make the bindable boundary bigger for bigger elements\r\n    return Math.max(16, Math.min(0.25 * smallerDimension, 32));\r\n};\r\nconst hitTestPointAgainstElement = (args) => {\r\n    switch (args.element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n        case \"diamond\":\r\n        case \"ellipse\":\r\n            const distance = distanceToBindableElement(args.element, args.point);\r\n            return args.check(distance, args.threshold);\r\n        case \"freedraw\": {\r\n            if (!args.check(distanceToRectangle(args.element, args.point), args.threshold)) {\r\n                return false;\r\n            }\r\n            return hitTestFreeDrawElement(args.element, args.point, args.threshold);\r\n        }\r\n        case \"arrow\":\r\n        case \"line\":\r\n            return hitTestLinear(args);\r\n        case \"selection\":\r\n            console.warn(\"This should not happen, we need to investigate why it does.\");\r\n            return false;\r\n    }\r\n};\r\nexport const distanceToBindableElement = (element, point) => {\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n            return distanceToRectangle(element, point);\r\n        case \"diamond\":\r\n            return distanceToDiamond(element, point);\r\n        case \"ellipse\":\r\n            return distanceToEllipse(element, point);\r\n    }\r\n};\r\nconst isStrictlyInside = (distance, threshold) => {\r\n    return distance < 0;\r\n};\r\nconst isInsideCheck = (distance, threshold) => {\r\n    return distance < threshold;\r\n};\r\nconst isNearCheck = (distance, threshold) => {\r\n    return Math.abs(distance) < threshold;\r\n};\r\nconst isOutsideCheck = (distance, threshold) => {\r\n    return 0 <= distance && distance < threshold;\r\n};\r\nconst distanceToRectangle = (element, point) => {\r\n    const [, pointRel, hwidth, hheight] = pointRelativeToElement(element, point);\r\n    return Math.max(GAPoint.distanceToLine(pointRel, GALine.equation(0, 1, -hheight)), GAPoint.distanceToLine(pointRel, GALine.equation(1, 0, -hwidth)));\r\n};\r\nconst distanceToDiamond = (element, point) => {\r\n    const [, pointRel, hwidth, hheight] = pointRelativeToElement(element, point);\r\n    const side = GALine.equation(hheight, hwidth, -hheight * hwidth);\r\n    return GAPoint.distanceToLine(pointRel, side);\r\n};\r\nconst distanceToEllipse = (element, point) => {\r\n    const [pointRel, tangent] = ellipseParamsForTest(element, point);\r\n    return -GALine.sign(tangent) * GAPoint.distanceToLine(pointRel, tangent);\r\n};\r\nconst ellipseParamsForTest = (element, point) => {\r\n    const [, pointRel, hwidth, hheight] = pointRelativeToElement(element, point);\r\n    const [px, py] = GAPoint.toTuple(pointRel);\r\n    // We're working in positive quadrant, so start with `t = 45deg`, `tx=cos(t)`\r\n    let tx = 0.707;\r\n    let ty = 0.707;\r\n    const a = hwidth;\r\n    const b = hheight;\r\n    // This is a numerical method to find the params tx, ty at which\r\n    // the ellipse has the closest point to the given point\r\n    [0, 1, 2, 3].forEach((_) => {\r\n        const xx = a * tx;\r\n        const yy = b * ty;\r\n        const ex = ((a * a - b * b) * tx ** 3) / a;\r\n        const ey = ((b * b - a * a) * ty ** 3) / b;\r\n        const rx = xx - ex;\r\n        const ry = yy - ey;\r\n        const qx = px - ex;\r\n        const qy = py - ey;\r\n        const r = Math.hypot(ry, rx);\r\n        const q = Math.hypot(qy, qx);\r\n        tx = Math.min(1, Math.max(0, ((qx * r) / q + ex) / a));\r\n        ty = Math.min(1, Math.max(0, ((qy * r) / q + ey) / b));\r\n        const t = Math.hypot(ty, tx);\r\n        tx /= t;\r\n        ty /= t;\r\n    });\r\n    const closestPoint = GA.point(a * tx, b * ty);\r\n    const tangent = GALine.orthogonalThrough(pointRel, closestPoint);\r\n    return [pointRel, tangent];\r\n};\r\nconst hitTestFreeDrawElement = (element, point, threshold) => {\r\n    // Check point-distance-to-line-segment for every segment in the\r\n    // element's points (its input points, not its outline points).\r\n    // This is... okay? It's plenty fast, but the GA library may\r\n    // have a faster option.\r\n    let x;\r\n    let y;\r\n    if (element.angle === 0) {\r\n        x = point[0] - element.x;\r\n        y = point[1] - element.y;\r\n    }\r\n    else {\r\n        // Counter-rotate the point around center before testing\r\n        const [minX, minY, maxX, maxY] = getElementAbsoluteCoords(element);\r\n        const rotatedPoint = rotatePoint(point, [minX + (maxX - minX) / 2, minY + (maxY - minY) / 2], -element.angle);\r\n        x = rotatedPoint[0] - element.x;\r\n        y = rotatedPoint[1] - element.y;\r\n    }\r\n    let [A, B] = element.points;\r\n    let P;\r\n    // For freedraw dots\r\n    if (distance2d(A[0], A[1], x, y) < threshold ||\r\n        distance2d(B[0], B[1], x, y) < threshold) {\r\n        return true;\r\n    }\r\n    // For freedraw lines\r\n    for (let i = 0; i < element.points.length; i++) {\r\n        const delta = [B[0] - A[0], B[1] - A[1]];\r\n        const length = Math.hypot(delta[1], delta[0]);\r\n        const U = [delta[0] / length, delta[1] / length];\r\n        const C = [x - A[0], y - A[1]];\r\n        const d = (C[0] * U[0] + C[1] * U[1]) / Math.hypot(U[1], U[0]);\r\n        P = [A[0] + U[0] * d, A[1] + U[1] * d];\r\n        const da = distance2d(P[0], P[1], A[0], A[1]);\r\n        const db = distance2d(P[0], P[1], B[0], B[1]);\r\n        P = db < da && da > length ? B : da < db && db > length ? A : P;\r\n        if (Math.hypot(y - P[1], x - P[0]) < threshold) {\r\n            return true;\r\n        }\r\n        A = B;\r\n        B = element.points[i + 1];\r\n    }\r\n    return false;\r\n};\r\nconst hitTestLinear = (args) => {\r\n    const { element, threshold } = args;\r\n    if (!getShapeForElement(element)) {\r\n        return false;\r\n    }\r\n    const [point, pointAbs, hwidth, hheight] = pointRelativeToElement(args.element, args.point);\r\n    const side1 = GALine.equation(0, 1, -hheight);\r\n    const side2 = GALine.equation(1, 0, -hwidth);\r\n    if (!isInsideCheck(GAPoint.distanceToLine(pointAbs, side1), threshold) ||\r\n        !isInsideCheck(GAPoint.distanceToLine(pointAbs, side2), threshold)) {\r\n        return false;\r\n    }\r\n    const [relX, relY] = GAPoint.toTuple(point);\r\n    const shape = getShapeForElement(element);\r\n    if (args.check === isInsideCheck) {\r\n        const hit = shape.some((subshape) => hitTestCurveInside(subshape, relX, relY, element.strokeSharpness));\r\n        if (hit) {\r\n            return true;\r\n        }\r\n    }\r\n    // hit test all \"subshapes\" of the linear element\r\n    return shape.some((subshape) => hitTestRoughShape(subshape, relX, relY, threshold));\r\n};\r\n// Returns:\r\n//   1. the point relative to the elements (x, y) position\r\n//   2. the point relative to the element's center with positive (x, y)\r\n//   3. half element width\r\n//   4. half element height\r\n//\r\n// Note that for linear elements the (x, y) position is not at the\r\n// top right corner of their boundary.\r\n//\r\n// Rectangles, diamonds and ellipses are symmetrical over axes,\r\n// and other elements have a rectangular boundary,\r\n// so we only need to perform hit tests for the positive quadrant.\r\nconst pointRelativeToElement = (element, pointTuple) => {\r\n    const point = GAPoint.from(pointTuple);\r\n    const elementCoords = getElementAbsoluteCoords(element);\r\n    const center = coordsCenter(elementCoords);\r\n    // GA has angle orientation opposite to `rotate`\r\n    const rotate = GATransform.rotation(center, element.angle);\r\n    const pointRotated = GATransform.apply(rotate, point);\r\n    const pointRelToCenter = GA.sub(pointRotated, GADirection.from(center));\r\n    const pointRelToCenterAbs = GAPoint.abs(pointRelToCenter);\r\n    const elementPos = GA.offset(element.x, element.y);\r\n    const pointRelToPos = GA.sub(pointRotated, elementPos);\r\n    const [ax, ay, bx, by] = elementCoords;\r\n    const halfWidth = (bx - ax) / 2;\r\n    const halfHeight = (by - ay) / 2;\r\n    return [pointRelToPos, pointRelToCenterAbs, halfWidth, halfHeight];\r\n};\r\n// Returns point in absolute coordinates\r\nexport const pointInAbsoluteCoords = (element, \r\n// Point relative to the element position\r\npoint) => {\r\n    const [x, y] = point;\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x2 - x1) / 2;\r\n    const cy = (y2 - y1) / 2;\r\n    const [rotatedX, rotatedY] = rotate(x, y, cx, cy, element.angle);\r\n    return [element.x + rotatedX, element.y + rotatedY];\r\n};\r\nconst relativizationToElementCenter = (element) => {\r\n    const elementCoords = getElementAbsoluteCoords(element);\r\n    const center = coordsCenter(elementCoords);\r\n    // GA has angle orientation opposite to `rotate`\r\n    const rotate = GATransform.rotation(center, element.angle);\r\n    const translate = GA.reverse(GATransform.translation(GADirection.from(center)));\r\n    return GATransform.compose(rotate, translate);\r\n};\r\nconst coordsCenter = ([ax, ay, bx, by]) => {\r\n    return GA.point((ax + bx) / 2, (ay + by) / 2);\r\n};\r\n// The focus distance is the oriented ratio between the size of\r\n// the `element` and the \"focus image\" of the element on which\r\n// all focus points lie, so it's a number between -1 and 1.\r\n// The line going through `a` and `b` is a tangent to the \"focus image\"\r\n// of the element.\r\nexport const determineFocusDistance = (element, \r\n// Point on the line, in absolute coordinates\r\na, \r\n// Another point on the line, in absolute coordinates (closer to element)\r\nb) => {\r\n    const relateToCenter = relativizationToElementCenter(element);\r\n    const aRel = GATransform.apply(relateToCenter, GAPoint.from(a));\r\n    const bRel = GATransform.apply(relateToCenter, GAPoint.from(b));\r\n    const line = GALine.through(aRel, bRel);\r\n    const q = element.height / element.width;\r\n    const hwidth = element.width / 2;\r\n    const hheight = element.height / 2;\r\n    const n = line[2];\r\n    const m = line[3];\r\n    const c = line[1];\r\n    const mabs = Math.abs(m);\r\n    const nabs = Math.abs(n);\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n            return c / (hwidth * (nabs + q * mabs));\r\n        case \"diamond\":\r\n            return mabs < nabs ? c / (nabs * hwidth) : c / (mabs * hheight);\r\n        case \"ellipse\":\r\n            return c / (hwidth * Math.sqrt(n ** 2 + q ** 2 * m ** 2));\r\n    }\r\n};\r\nexport const determineFocusPoint = (element, \r\n// The oriented, relative distance from the center of `element` of the\r\n// returned focusPoint\r\nfocus, adjecentPoint) => {\r\n    if (focus === 0) {\r\n        const elementCoords = getElementAbsoluteCoords(element);\r\n        const center = coordsCenter(elementCoords);\r\n        return GAPoint.toTuple(center);\r\n    }\r\n    const relateToCenter = relativizationToElementCenter(element);\r\n    const adjecentPointRel = GATransform.apply(relateToCenter, GAPoint.from(adjecentPoint));\r\n    const reverseRelateToCenter = GA.reverse(relateToCenter);\r\n    let point;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n        case \"diamond\":\r\n            point = findFocusPointForRectangulars(element, focus, adjecentPointRel);\r\n            break;\r\n        case \"ellipse\":\r\n            point = findFocusPointForEllipse(element, focus, adjecentPointRel);\r\n            break;\r\n    }\r\n    return GAPoint.toTuple(GATransform.apply(reverseRelateToCenter, point));\r\n};\r\n// Returns 2 or 0 intersection points between line going through `a` and `b`\r\n// and the `element`, in ascending order of distance from `a`.\r\nexport const intersectElementWithLine = (element, \r\n// Point on the line, in absolute coordinates\r\na, \r\n// Another point on the line, in absolute coordinates\r\nb, \r\n// If given, the element is inflated by this value\r\ngap = 0) => {\r\n    const relateToCenter = relativizationToElementCenter(element);\r\n    const aRel = GATransform.apply(relateToCenter, GAPoint.from(a));\r\n    const bRel = GATransform.apply(relateToCenter, GAPoint.from(b));\r\n    const line = GALine.through(aRel, bRel);\r\n    const reverseRelateToCenter = GA.reverse(relateToCenter);\r\n    const intersections = getSortedElementLineIntersections(element, line, aRel, gap);\r\n    return intersections.map((point) => GAPoint.toTuple(GATransform.apply(reverseRelateToCenter, point)));\r\n};\r\nconst getSortedElementLineIntersections = (element, \r\n// Relative to element center\r\nline, \r\n// Relative to element center\r\nnearPoint, gap = 0) => {\r\n    let intersections;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n        case \"diamond\":\r\n            const corners = getCorners(element);\r\n            intersections = corners\r\n                .flatMap((point, i) => {\r\n                const edge = [point, corners[(i + 1) % 4]];\r\n                return intersectSegment(line, offsetSegment(edge, gap));\r\n            })\r\n                .concat(corners.flatMap((point) => getCircleIntersections(point, gap, line)));\r\n            break;\r\n        case \"ellipse\":\r\n            intersections = getEllipseIntersections(element, gap, line);\r\n            break;\r\n    }\r\n    if (intersections.length < 2) {\r\n        // Ignore the \"edge\" case of only intersecting with a single corner\r\n        return [];\r\n    }\r\n    const sortedIntersections = intersections.sort((i1, i2) => GAPoint.distance(i1, nearPoint) - GAPoint.distance(i2, nearPoint));\r\n    return [\r\n        sortedIntersections[0],\r\n        sortedIntersections[sortedIntersections.length - 1],\r\n    ];\r\n};\r\nconst getCorners = (element, scale = 1) => {\r\n    const hx = (scale * element.width) / 2;\r\n    const hy = (scale * element.height) / 2;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n            return [\r\n                GA.point(hx, hy),\r\n                GA.point(hx, -hy),\r\n                GA.point(-hx, -hy),\r\n                GA.point(-hx, hy),\r\n            ];\r\n        case \"diamond\":\r\n            return [\r\n                GA.point(0, hy),\r\n                GA.point(hx, 0),\r\n                GA.point(0, -hy),\r\n                GA.point(-hx, 0),\r\n            ];\r\n    }\r\n};\r\n// Returns intersection of `line` with `segment`, with `segment` moved by\r\n// `gap` in its polar direction.\r\n// If intersection conincides with second segment point returns empty array.\r\nconst intersectSegment = (line, segment) => {\r\n    const [a, b] = segment;\r\n    const aDist = GAPoint.distanceToLine(a, line);\r\n    const bDist = GAPoint.distanceToLine(b, line);\r\n    if (aDist * bDist >= 0) {\r\n        // The intersection is outside segment `(a, b)`\r\n        return [];\r\n    }\r\n    return [GAPoint.intersect(line, GALine.through(a, b))];\r\n};\r\nconst offsetSegment = (segment, distance) => {\r\n    const [a, b] = segment;\r\n    const offset = GATransform.translationOrthogonal(GADirection.fromTo(a, b), distance);\r\n    return [GATransform.apply(offset, a), GATransform.apply(offset, b)];\r\n};\r\nconst getEllipseIntersections = (element, gap, line) => {\r\n    const a = element.width / 2 + gap;\r\n    const b = element.height / 2 + gap;\r\n    const m = line[2];\r\n    const n = line[3];\r\n    const c = line[1];\r\n    const squares = a * a * m * m + b * b * n * n;\r\n    const discr = squares - c * c;\r\n    if (squares === 0 || discr <= 0) {\r\n        return [];\r\n    }\r\n    const discrRoot = Math.sqrt(discr);\r\n    const xn = -a * a * m * c;\r\n    const yn = -b * b * n * c;\r\n    return [\r\n        GA.point((xn + a * b * n * discrRoot) / squares, (yn - a * b * m * discrRoot) / squares),\r\n        GA.point((xn - a * b * n * discrRoot) / squares, (yn + a * b * m * discrRoot) / squares),\r\n    ];\r\n};\r\nexport const getCircleIntersections = (center, radius, line) => {\r\n    if (radius === 0) {\r\n        return GAPoint.distanceToLine(line, center) === 0 ? [center] : [];\r\n    }\r\n    const m = line[2];\r\n    const n = line[3];\r\n    const c = line[1];\r\n    const [a, b] = GAPoint.toTuple(center);\r\n    const r = radius;\r\n    const squares = m * m + n * n;\r\n    const discr = r * r * squares - (m * a + n * b + c) ** 2;\r\n    if (squares === 0 || discr <= 0) {\r\n        return [];\r\n    }\r\n    const discrRoot = Math.sqrt(discr);\r\n    const xn = a * n * n - b * m * n - m * c;\r\n    const yn = b * m * m - a * m * n - n * c;\r\n    return [\r\n        GA.point((xn + n * discrRoot) / squares, (yn - m * discrRoot) / squares),\r\n        GA.point((xn - n * discrRoot) / squares, (yn + m * discrRoot) / squares),\r\n    ];\r\n};\r\n// The focus point is the tangent point of the \"focus image\" of the\r\n// `element`, where the tangent goes through `point`.\r\nexport const findFocusPointForEllipse = (ellipse, \r\n// Between -1 and 1 (not 0) the relative size of the \"focus image\" of\r\n// the element on which the focus point lies\r\nrelativeDistance, \r\n// The point for which we're trying to find the focus point, relative\r\n// to the ellipse center.\r\npoint) => {\r\n    const relativeDistanceAbs = Math.abs(relativeDistance);\r\n    const a = (ellipse.width * relativeDistanceAbs) / 2;\r\n    const b = (ellipse.height * relativeDistanceAbs) / 2;\r\n    const orientation = Math.sign(relativeDistance);\r\n    const [px, pyo] = GAPoint.toTuple(point);\r\n    // The calculation below can't handle py = 0\r\n    const py = pyo === 0 ? 0.0001 : pyo;\r\n    const squares = px ** 2 * b ** 2 + py ** 2 * a ** 2;\r\n    // Tangent mx + ny + 1 = 0\r\n    const m = (-px * b ** 2 +\r\n        orientation * py * Math.sqrt(Math.max(0, squares - a ** 2 * b ** 2))) /\r\n        squares;\r\n    const n = (-m * px - 1) / py;\r\n    const x = -(a ** 2 * m) / (n ** 2 * b ** 2 + m ** 2 * a ** 2);\r\n    return GA.point(x, (-m * x - 1) / n);\r\n};\r\nexport const findFocusPointForRectangulars = (element, \r\n// Between -1 and 1 for how far away should the focus point be relative\r\n// to the size of the element. Sign determines orientation.\r\nrelativeDistance, \r\n// The point for which we're trying to find the focus point, relative\r\n// to the element center.\r\npoint) => {\r\n    const relativeDistanceAbs = Math.abs(relativeDistance);\r\n    const orientation = Math.sign(relativeDistance);\r\n    const corners = getCorners(element, relativeDistanceAbs);\r\n    let maxDistance = 0;\r\n    let tangentPoint = null;\r\n    corners.forEach((corner) => {\r\n        const distance = orientation * GALine.through(point, corner)[1];\r\n        if (distance > maxDistance) {\r\n            maxDistance = distance;\r\n            tangentPoint = corner;\r\n        }\r\n    });\r\n    return tangentPoint;\r\n};\r\nconst pointInBezierEquation = (p0, p1, p2, p3, [mx, my], lineThreshold) => {\r\n    // B(t) = p0 * (1-t)^3 + 3p1 * t * (1-t)^2 + 3p2 * t^2 * (1-t) + p3 * t^3\r\n    const equation = (t, idx) => Math.pow(1 - t, 3) * p3[idx] +\r\n        3 * t * Math.pow(1 - t, 2) * p2[idx] +\r\n        3 * Math.pow(t, 2) * (1 - t) * p1[idx] +\r\n        p0[idx] * Math.pow(t, 3);\r\n    // go through t in increments of 0.01\r\n    let t = 0;\r\n    while (t <= 1.0) {\r\n        const tx = equation(t, 0);\r\n        const ty = equation(t, 1);\r\n        const diff = Math.sqrt(Math.pow(tx - mx, 2) + Math.pow(ty - my, 2));\r\n        if (diff < lineThreshold) {\r\n            return true;\r\n        }\r\n        t += 0.01;\r\n    }\r\n    return false;\r\n};\r\nconst hitTestCurveInside = (drawable, x, y, sharpness) => {\r\n    const ops = getCurvePathOps(drawable);\r\n    const points = [];\r\n    let odd = false; // select one line out of double lines\r\n    for (const operation of ops) {\r\n        if (operation.op === \"move\") {\r\n            odd = !odd;\r\n            if (odd) {\r\n                points.push([operation.data[0], operation.data[1]]);\r\n            }\r\n        }\r\n        else if (operation.op === \"bcurveTo\") {\r\n            if (odd) {\r\n                points.push([operation.data[0], operation.data[1]]);\r\n                points.push([operation.data[2], operation.data[3]]);\r\n                points.push([operation.data[4], operation.data[5]]);\r\n            }\r\n        }\r\n    }\r\n    if (points.length >= 4) {\r\n        if (sharpness === \"sharp\") {\r\n            return isPointInPolygon(points, x, y);\r\n        }\r\n        const polygonPoints = pointsOnBezierCurves(points, 10, 5);\r\n        return isPointInPolygon(polygonPoints, x, y);\r\n    }\r\n    return false;\r\n};\r\nconst hitTestRoughShape = (drawable, x, y, lineThreshold) => {\r\n    // read operations from first opSet\r\n    const ops = getCurvePathOps(drawable);\r\n    // set start position as (0,0) just in case\r\n    // move operation does not exist (unlikely but it is worth safekeeping it)\r\n    let currentP = [0, 0];\r\n    return ops.some(({ op, data }, idx) => {\r\n        // There are only four operation types:\r\n        // move, bcurveTo, lineTo, and curveTo\r\n        if (op === \"move\") {\r\n            // change starting point\r\n            currentP = data;\r\n            // move operation does not draw anything; so, it always\r\n            // returns false\r\n        }\r\n        else if (op === \"bcurveTo\") {\r\n            // create points from bezier curve\r\n            // bezier curve stores data as a flattened array of three positions\r\n            // [x1, y1, x2, y2, x3, y3]\r\n            const p1 = [data[0], data[1]];\r\n            const p2 = [data[2], data[3]];\r\n            const p3 = [data[4], data[5]];\r\n            const p0 = currentP;\r\n            currentP = p3;\r\n            // check if points are on the curve\r\n            // cubic bezier curves require four parameters\r\n            // the first parameter is the last stored position (p0)\r\n            const retVal = pointInBezierEquation(p0, p1, p2, p3, [x, y], lineThreshold);\r\n            // set end point of bezier curve as the new starting point for\r\n            // upcoming operations as each operation is based on the last drawn\r\n            // position of the previous operation\r\n            return retVal;\r\n        }\r\n        else if (op === \"lineTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        else if (op === \"qcurveTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        return false;\r\n    });\r\n};\r\n","import { OMIT_SIDES_FOR_MULTIPLE_ELEMENTS, getTransformHandlesFromCoords, getTransformHandles, } from \"./transformHandles\";\r\nconst isInsideTransformHandle = (transformHandle, x, y) => x >= transformHandle[0] &&\r\n    x <= transformHandle[0] + transformHandle[2] &&\r\n    y >= transformHandle[1] &&\r\n    y <= transformHandle[1] + transformHandle[3];\r\nexport const resizeTest = (element, appState, x, y, zoom, pointerType) => {\r\n    if (!appState.selectedElementIds[element.id]) {\r\n        return false;\r\n    }\r\n    const { rotation: rotationTransformHandle, ...transformHandles } = getTransformHandles(element, zoom, pointerType);\r\n    if (rotationTransformHandle &&\r\n        isInsideTransformHandle(rotationTransformHandle, x, y)) {\r\n        return \"rotation\";\r\n    }\r\n    const filter = Object.keys(transformHandles).filter((key) => {\r\n        const transformHandle = transformHandles[key];\r\n        if (!transformHandle) {\r\n            return false;\r\n        }\r\n        return isInsideTransformHandle(transformHandle, x, y);\r\n    });\r\n    if (filter.length > 0) {\r\n        return filter[0];\r\n    }\r\n    return false;\r\n};\r\nexport const getElementWithTransformHandleType = (elements, appState, scenePointerX, scenePointerY, zoom, pointerType) => {\r\n    return elements.reduce((result, element) => {\r\n        if (result) {\r\n            return result;\r\n        }\r\n        const transformHandleType = resizeTest(element, appState, scenePointerX, scenePointerY, zoom, pointerType);\r\n        return transformHandleType ? { element, transformHandleType } : null;\r\n    }, null);\r\n};\r\nexport const getTransformHandleTypeFromCoords = ([x1, y1, x2, y2], scenePointerX, scenePointerY, zoom, pointerType) => {\r\n    const transformHandles = getTransformHandlesFromCoords([x1, y1, x2, y2], 0, zoom, pointerType, OMIT_SIDES_FOR_MULTIPLE_ELEMENTS);\r\n    const found = Object.keys(transformHandles).find((key) => {\r\n        const transformHandle = transformHandles[key];\r\n        return (transformHandle &&\r\n            isInsideTransformHandle(transformHandle, scenePointerX, scenePointerY));\r\n    });\r\n    return (found || false);\r\n};\r\nconst RESIZE_CURSORS = [\"ns\", \"nesw\", \"ew\", \"nwse\"];\r\nconst rotateResizeCursor = (cursor, angle) => {\r\n    const index = RESIZE_CURSORS.indexOf(cursor);\r\n    if (index >= 0) {\r\n        const a = Math.round(angle / (Math.PI / 4));\r\n        cursor = RESIZE_CURSORS[(index + a) % RESIZE_CURSORS.length];\r\n    }\r\n    return cursor;\r\n};\r\n/*\r\n * Returns bi-directional cursor for the element being resized\r\n */\r\nexport const getCursorForResizingElement = (resizingElement) => {\r\n    const { element, transformHandleType } = resizingElement;\r\n    const shouldSwapCursors = element && Math.sign(element.height) * Math.sign(element.width) === -1;\r\n    let cursor = null;\r\n    switch (transformHandleType) {\r\n        case \"n\":\r\n        case \"s\":\r\n            cursor = \"ns\";\r\n            break;\r\n        case \"w\":\r\n        case \"e\":\r\n            cursor = \"ew\";\r\n            break;\r\n        case \"nw\":\r\n        case \"se\":\r\n            if (shouldSwapCursors) {\r\n                cursor = \"nesw\";\r\n            }\r\n            else {\r\n                cursor = \"nwse\";\r\n            }\r\n            break;\r\n        case \"ne\":\r\n        case \"sw\":\r\n            if (shouldSwapCursors) {\r\n                cursor = \"nwse\";\r\n            }\r\n            else {\r\n                cursor = \"nesw\";\r\n            }\r\n            break;\r\n        case \"rotation\":\r\n            return \"grab\";\r\n    }\r\n    if (cursor && element) {\r\n        cursor = rotateResizeCursor(cursor, element.angle);\r\n    }\r\n    return cursor ? `${cursor}-resize` : \"\";\r\n};\r\n","import { distance2d, rotate, isPathALoop, getGridPoint } from \"../math\";\r\nimport { getElementAbsoluteCoords } from \".\";\r\nimport { getElementPointsCoords } from \"./bounds\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { bindOrUnbindLinearElement, getHoveredElementForBinding, isBindingEnabled, } from \"./binding\";\r\nimport { tupleToCoors } from \"../utils\";\r\nimport { isBindingElement } from \"./typeChecks\";\r\nexport class LinearElementEditor {\r\n    constructor(element, scene) {\r\n        this.elementId = element.id;\r\n        Scene.mapElementToScene(this.elementId, scene);\r\n        LinearElementEditor.normalizePoints(element);\r\n        this.activePointIndex = null;\r\n        this.lastUncommittedPoint = null;\r\n        this.isDragging = false;\r\n        this.pointerOffset = { x: 0, y: 0 };\r\n        this.startBindingElement = \"keep\";\r\n        this.endBindingElement = \"keep\";\r\n    }\r\n    /**\r\n     * @param id the `elementId` from the instance of this class (so that we can\r\n     *  statically guarantee this method returns an ExcalidrawLinearElement)\r\n     */\r\n    static getElement(id) {\r\n        const element = Scene.getScene(id)?.getNonDeletedElement(id);\r\n        if (element) {\r\n            return element;\r\n        }\r\n        return null;\r\n    }\r\n    /** @returns whether point was dragged */\r\n    static handlePointDragging(appState, setState, scenePointerX, scenePointerY, maybeSuggestBinding) {\r\n        if (!appState.editingLinearElement) {\r\n            return false;\r\n        }\r\n        const { editingLinearElement } = appState;\r\n        const { activePointIndex, elementId, isDragging } = editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return false;\r\n        }\r\n        if (activePointIndex != null && activePointIndex > -1) {\r\n            if (isDragging === false) {\r\n                setState({\r\n                    editingLinearElement: {\r\n                        ...editingLinearElement,\r\n                        isDragging: true,\r\n                    },\r\n                });\r\n            }\r\n            const newPoint = LinearElementEditor.createPointAt(element, scenePointerX - editingLinearElement.pointerOffset.x, scenePointerY - editingLinearElement.pointerOffset.y, appState.gridSize);\r\n            LinearElementEditor.movePoint(element, activePointIndex, newPoint);\r\n            if (isBindingElement(element)) {\r\n                maybeSuggestBinding(element, activePointIndex === 0 ? \"start\" : \"end\");\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    static handlePointerUp(event, editingLinearElement, appState) {\r\n        const { elementId, activePointIndex, isDragging } = editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return editingLinearElement;\r\n        }\r\n        let binding = {};\r\n        if (isDragging &&\r\n            (activePointIndex === 0 || activePointIndex === element.points.length - 1)) {\r\n            if (isPathALoop(element.points, appState.zoom.value)) {\r\n                LinearElementEditor.movePoint(element, activePointIndex, activePointIndex === 0\r\n                    ? element.points[element.points.length - 1]\r\n                    : element.points[0]);\r\n            }\r\n            const bindingElement = isBindingEnabled(appState)\r\n                ? getHoveredElementForBinding(tupleToCoors(LinearElementEditor.getPointAtIndexGlobalCoordinates(element, activePointIndex)), Scene.getScene(element))\r\n                : null;\r\n            binding = {\r\n                [activePointIndex === 0 ? \"startBindingElement\" : \"endBindingElement\"]: bindingElement,\r\n            };\r\n        }\r\n        return {\r\n            ...editingLinearElement,\r\n            ...binding,\r\n            isDragging: false,\r\n            pointerOffset: { x: 0, y: 0 },\r\n        };\r\n    }\r\n    static handlePointerDown(event, appState, setState, history, scenePointer) {\r\n        const ret = {\r\n            didAddPoint: false,\r\n            hitElement: null,\r\n        };\r\n        if (!appState.editingLinearElement) {\r\n            return ret;\r\n        }\r\n        const { elementId } = appState.editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return ret;\r\n        }\r\n        if (event.altKey) {\r\n            if (appState.editingLinearElement.lastUncommittedPoint == null) {\r\n                mutateElement(element, {\r\n                    points: [\r\n                        ...element.points,\r\n                        LinearElementEditor.createPointAt(element, scenePointer.x, scenePointer.y, appState.gridSize),\r\n                    ],\r\n                });\r\n            }\r\n            history.resumeRecording();\r\n            setState({\r\n                editingLinearElement: {\r\n                    ...appState.editingLinearElement,\r\n                    activePointIndex: element.points.length - 1,\r\n                    lastUncommittedPoint: null,\r\n                    endBindingElement: getHoveredElementForBinding(scenePointer, Scene.getScene(element)),\r\n                },\r\n            });\r\n            ret.didAddPoint = true;\r\n            return ret;\r\n        }\r\n        const clickedPointIndex = LinearElementEditor.getPointIndexUnderCursor(element, appState.zoom, scenePointer.x, scenePointer.y);\r\n        // if we clicked on a point, set the element as hitElement otherwise\r\n        // it would get deselected if the point is outside the hitbox area\r\n        if (clickedPointIndex > -1) {\r\n            ret.hitElement = element;\r\n        }\r\n        else {\r\n            // You might be wandering why we are storing the binding elements on\r\n            // LinearElementEditor and passing them in, insted of calculating them\r\n            // from the end points of the `linearElement` - this is to allow disabling\r\n            // binding (which needs to happen at the point the user finishes moving\r\n            // the point).\r\n            const { startBindingElement, endBindingElement } = appState.editingLinearElement;\r\n            if (isBindingEnabled(appState) && isBindingElement(element)) {\r\n                bindOrUnbindLinearElement(element, startBindingElement, endBindingElement);\r\n            }\r\n        }\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const targetPoint = clickedPointIndex > -1 &&\r\n            rotate(element.x + element.points[clickedPointIndex][0], element.y + element.points[clickedPointIndex][1], cx, cy, element.angle);\r\n        setState({\r\n            editingLinearElement: {\r\n                ...appState.editingLinearElement,\r\n                activePointIndex: clickedPointIndex > -1 ? clickedPointIndex : null,\r\n                pointerOffset: targetPoint\r\n                    ? {\r\n                        x: scenePointer.x - targetPoint[0],\r\n                        y: scenePointer.y - targetPoint[1],\r\n                    }\r\n                    : { x: 0, y: 0 },\r\n            },\r\n        });\r\n        return ret;\r\n    }\r\n    static handlePointerMove(event, scenePointerX, scenePointerY, editingLinearElement, gridSize) {\r\n        const { elementId, lastUncommittedPoint } = editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return editingLinearElement;\r\n        }\r\n        const { points } = element;\r\n        const lastPoint = points[points.length - 1];\r\n        if (!event.altKey) {\r\n            if (lastPoint === lastUncommittedPoint) {\r\n                LinearElementEditor.movePoint(element, points.length - 1, \"delete\");\r\n            }\r\n            return { ...editingLinearElement, lastUncommittedPoint: null };\r\n        }\r\n        const newPoint = LinearElementEditor.createPointAt(element, scenePointerX - editingLinearElement.pointerOffset.x, scenePointerY - editingLinearElement.pointerOffset.y, gridSize);\r\n        if (lastPoint === lastUncommittedPoint) {\r\n            LinearElementEditor.movePoint(element, element.points.length - 1, newPoint);\r\n        }\r\n        else {\r\n            LinearElementEditor.movePoint(element, \"new\", newPoint);\r\n        }\r\n        return {\r\n            ...editingLinearElement,\r\n            lastUncommittedPoint: element.points[element.points.length - 1],\r\n        };\r\n    }\r\n    static getPointsGlobalCoordinates(element) {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        return element.points.map((point) => {\r\n            let { x, y } = element;\r\n            [x, y] = rotate(x + point[0], y + point[1], cx, cy, element.angle);\r\n            return [x, y];\r\n        });\r\n    }\r\n    static getPointAtIndexGlobalCoordinates(element, indexMaybeFromEnd) {\r\n        const index = indexMaybeFromEnd < 0\r\n            ? element.points.length + indexMaybeFromEnd\r\n            : indexMaybeFromEnd;\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const point = element.points[index];\r\n        const { x, y } = element;\r\n        return rotate(x + point[0], y + point[1], cx, cy, element.angle);\r\n    }\r\n    static pointFromAbsoluteCoords(element, absoluteCoords) {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const [x, y] = rotate(absoluteCoords[0], absoluteCoords[1], cx, cy, -element.angle);\r\n        return [x - element.x, y - element.y];\r\n    }\r\n    static getPointIndexUnderCursor(element, zoom, x, y) {\r\n        const pointHandles = this.getPointsGlobalCoordinates(element);\r\n        let idx = pointHandles.length;\r\n        // loop from right to left because points on the right are rendered over\r\n        // points on the left, thus should take precedence when clicking, if they\r\n        // overlap\r\n        while (--idx > -1) {\r\n            const point = pointHandles[idx];\r\n            if (distance2d(x, y, point[0], point[1]) * zoom.value <\r\n                // +1px to account for outline stroke\r\n                this.POINT_HANDLE_SIZE / 2 + 1) {\r\n                return idx;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n    static createPointAt(element, scenePointerX, scenePointerY, gridSize) {\r\n        const pointerOnGrid = getGridPoint(scenePointerX, scenePointerY, gridSize);\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const [rotatedX, rotatedY] = rotate(pointerOnGrid[0], pointerOnGrid[1], cx, cy, -element.angle);\r\n        return [rotatedX - element.x, rotatedY - element.y];\r\n    }\r\n    /**\r\n     * Normalizes line points so that the start point is at [0,0]. This is\r\n     * expected in various parts of the codebase. Also returns new x/y to account\r\n     * for the potential normalization.\r\n     */\r\n    static getNormalizedPoints(element) {\r\n        const { points } = element;\r\n        const offsetX = points[0][0];\r\n        const offsetY = points[0][1];\r\n        return {\r\n            points: points.map((point, _idx) => {\r\n                return [point[0] - offsetX, point[1] - offsetY];\r\n            }),\r\n            x: element.x + offsetX,\r\n            y: element.y + offsetY,\r\n        };\r\n    }\r\n    // element-mutating methods\r\n    // ---------------------------------------------------------------------------\r\n    static normalizePoints(element) {\r\n        mutateElement(element, LinearElementEditor.getNormalizedPoints(element));\r\n    }\r\n    static movePointByOffset(element, pointIndex, offset) {\r\n        const [x, y] = element.points[pointIndex];\r\n        LinearElementEditor.movePoint(element, pointIndex, [\r\n            x + offset.x,\r\n            y + offset.y,\r\n        ]);\r\n    }\r\n    static movePoint(element, pointIndex, targetPosition, otherUpdates) {\r\n        const { points } = element;\r\n        // in case we're moving start point, instead of modifying its position\r\n        // which would break the invariant of it being at [0,0], we move\r\n        // all the other points in the opposite direction by delta to\r\n        // offset it. We do the same with actual element.x/y position, so\r\n        // this hacks are completely transparent to the user.\r\n        let offsetX = 0;\r\n        let offsetY = 0;\r\n        let nextPoints;\r\n        if (targetPosition === \"delete\") {\r\n            // remove point\r\n            if (pointIndex === \"new\") {\r\n                throw new Error(\"invalid args in movePoint\");\r\n            }\r\n            nextPoints = points.slice();\r\n            nextPoints.splice(pointIndex, 1);\r\n            if (pointIndex === 0) {\r\n                // if deleting first point, make the next to be [0,0] and recalculate\r\n                // positions of the rest with respect to it\r\n                offsetX = nextPoints[0][0];\r\n                offsetY = nextPoints[0][1];\r\n                nextPoints = nextPoints.map((point, idx) => {\r\n                    if (idx === 0) {\r\n                        return [0, 0];\r\n                    }\r\n                    return [point[0] - offsetX, point[1] - offsetY];\r\n                });\r\n            }\r\n        }\r\n        else if (pointIndex === \"new\") {\r\n            nextPoints = [...points, targetPosition];\r\n        }\r\n        else {\r\n            const deltaX = targetPosition[0] - points[pointIndex][0];\r\n            const deltaY = targetPosition[1] - points[pointIndex][1];\r\n            nextPoints = points.map((point, idx) => {\r\n                if (idx === pointIndex) {\r\n                    if (idx === 0) {\r\n                        offsetX = deltaX;\r\n                        offsetY = deltaY;\r\n                        return point;\r\n                    }\r\n                    offsetX = 0;\r\n                    offsetY = 0;\r\n                    return [point[0] + deltaX, point[1] + deltaY];\r\n                }\r\n                return offsetX || offsetY\r\n                    ? [point[0] - offsetX, point[1] - offsetY]\r\n                    : point;\r\n            });\r\n        }\r\n        const nextCoords = getElementPointsCoords(element, nextPoints, element.strokeSharpness || \"round\");\r\n        const prevCoords = getElementPointsCoords(element, points, element.strokeSharpness || \"round\");\r\n        const nextCenterX = (nextCoords[0] + nextCoords[2]) / 2;\r\n        const nextCenterY = (nextCoords[1] + nextCoords[3]) / 2;\r\n        const prevCenterX = (prevCoords[0] + prevCoords[2]) / 2;\r\n        const prevCenterY = (prevCoords[1] + prevCoords[3]) / 2;\r\n        const dX = prevCenterX - nextCenterX;\r\n        const dY = prevCenterY - nextCenterY;\r\n        const rotated = rotate(offsetX, offsetY, dX, dY, element.angle);\r\n        mutateElement(element, {\r\n            ...otherUpdates,\r\n            points: nextPoints,\r\n            x: element.x + rotated[0],\r\n            y: element.y + rotated[1],\r\n        });\r\n    }\r\n}\r\n// ---------------------------------------------------------------------------\r\n// static methods\r\n// ---------------------------------------------------------------------------\r\nLinearElementEditor.POINT_HANDLE_SIZE = 20;\r\n","import { getElementAtPosition } from \"../scene\";\r\nimport { isBindableElement, isBindingElement } from \"./typeChecks\";\r\nimport { bindingBorderTest, distanceToBindableElement, maxBindingGap, determineFocusDistance, intersectElementWithLine, determineFocusPoint, } from \"./collision\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { LinearElementEditor } from \"./linearElementEditor\";\r\nimport { tupleToCoors } from \"../utils\";\r\nimport { KEYS } from \"../keys\";\r\nexport const shouldEnableBindingForPointerEvent = (event) => {\r\n    return !event[KEYS.CTRL_OR_CMD];\r\n};\r\nexport const isBindingEnabled = (appState) => {\r\n    return appState.isBindingEnabled;\r\n};\r\nexport const bindOrUnbindLinearElement = (linearElement, startBindingElement, endBindingElement) => {\r\n    const boundToElementIds = new Set();\r\n    const unboundFromElementIds = new Set();\r\n    bindOrUnbindLinearElementEdge(linearElement, startBindingElement, endBindingElement, \"start\", boundToElementIds, unboundFromElementIds);\r\n    bindOrUnbindLinearElementEdge(linearElement, endBindingElement, startBindingElement, \"end\", boundToElementIds, unboundFromElementIds);\r\n    const onlyUnbound = Array.from(unboundFromElementIds).filter((id) => !boundToElementIds.has(id));\r\n    Scene.getScene(linearElement)\r\n        .getNonDeletedElements(onlyUnbound)\r\n        .forEach((element) => {\r\n        mutateElement(element, {\r\n            boundElementIds: element.boundElementIds?.filter((id) => id !== linearElement.id),\r\n        });\r\n    });\r\n};\r\nconst bindOrUnbindLinearElementEdge = (linearElement, bindableElement, otherEdgeBindableElement, startOrEnd, \r\n// Is mutated\r\nboundToElementIds, \r\n// Is mutated\r\nunboundFromElementIds) => {\r\n    if (bindableElement !== \"keep\") {\r\n        if (bindableElement != null) {\r\n            // Don't bind if we're trying to bind or are already bound to the same\r\n            // element on the other edge already (\"start\" edge takes precedence).\r\n            if (otherEdgeBindableElement == null ||\r\n                (otherEdgeBindableElement === \"keep\"\r\n                    ? !isLinearElementSimpleAndAlreadyBoundOnOppositeEdge(linearElement, bindableElement, startOrEnd)\r\n                    : startOrEnd === \"start\" ||\r\n                        otherEdgeBindableElement.id !== bindableElement.id)) {\r\n                bindLinearElement(linearElement, bindableElement, startOrEnd);\r\n                boundToElementIds.add(bindableElement.id);\r\n            }\r\n        }\r\n        else {\r\n            const unbound = unbindLinearElement(linearElement, startOrEnd);\r\n            if (unbound != null) {\r\n                unboundFromElementIds.add(unbound);\r\n            }\r\n        }\r\n    }\r\n};\r\nexport const bindOrUnbindSelectedElements = (elements) => {\r\n    elements.forEach((element) => {\r\n        if (isBindingElement(element)) {\r\n            bindOrUnbindLinearElement(element, getElligibleElementForBindingElement(element, \"start\"), getElligibleElementForBindingElement(element, \"end\"));\r\n        }\r\n        else if (isBindableElement(element)) {\r\n            maybeBindBindableElement(element);\r\n        }\r\n    });\r\n};\r\nconst maybeBindBindableElement = (bindableElement) => {\r\n    getElligibleElementsForBindableElementAndWhere(bindableElement).forEach(([linearElement, where]) => bindOrUnbindLinearElement(linearElement, where === \"end\" ? \"keep\" : bindableElement, where === \"start\" ? \"keep\" : bindableElement));\r\n};\r\nexport const maybeBindLinearElement = (linearElement, appState, scene, pointerCoords) => {\r\n    if (appState.startBoundElement != null) {\r\n        bindLinearElement(linearElement, appState.startBoundElement, \"start\");\r\n    }\r\n    const hoveredElement = getHoveredElementForBinding(pointerCoords, scene);\r\n    if (hoveredElement != null &&\r\n        !isLinearElementSimpleAndAlreadyBoundOnOppositeEdge(linearElement, hoveredElement, \"end\")) {\r\n        bindLinearElement(linearElement, hoveredElement, \"end\");\r\n    }\r\n};\r\nconst bindLinearElement = (linearElement, hoveredElement, startOrEnd) => {\r\n    mutateElement(linearElement, {\r\n        [startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\"]: {\r\n            elementId: hoveredElement.id,\r\n            ...calculateFocusAndGap(linearElement, hoveredElement, startOrEnd),\r\n        },\r\n    });\r\n    mutateElement(hoveredElement, {\r\n        boundElementIds: Array.from(new Set([...(hoveredElement.boundElementIds ?? []), linearElement.id])),\r\n    });\r\n};\r\n// Don't bind both ends of a simple segment\r\nconst isLinearElementSimpleAndAlreadyBoundOnOppositeEdge = (linearElement, bindableElement, startOrEnd) => {\r\n    const otherBinding = linearElement[startOrEnd === \"start\" ? \"endBinding\" : \"startBinding\"];\r\n    return isLinearElementSimpleAndAlreadyBound(linearElement, otherBinding?.elementId, bindableElement);\r\n};\r\nexport const isLinearElementSimpleAndAlreadyBound = (linearElement, alreadyBoundToId, bindableElement) => {\r\n    return (alreadyBoundToId === bindableElement.id && linearElement.points.length < 3);\r\n};\r\nexport const unbindLinearElements = (elements) => {\r\n    elements.forEach((element) => {\r\n        if (isBindingElement(element)) {\r\n            bindOrUnbindLinearElement(element, null, null);\r\n        }\r\n    });\r\n};\r\nconst unbindLinearElement = (linearElement, startOrEnd) => {\r\n    const field = startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\";\r\n    const binding = linearElement[field];\r\n    if (binding == null) {\r\n        return null;\r\n    }\r\n    mutateElement(linearElement, { [field]: null });\r\n    return binding.elementId;\r\n};\r\nexport const getHoveredElementForBinding = (pointerCoords, scene) => {\r\n    const hoveredElement = getElementAtPosition(scene.getElements(), (element) => isBindableElement(element) && bindingBorderTest(element, pointerCoords));\r\n    return hoveredElement;\r\n};\r\nconst calculateFocusAndGap = (linearElement, hoveredElement, startOrEnd) => {\r\n    const direction = startOrEnd === \"start\" ? -1 : 1;\r\n    const edgePointIndex = direction === -1 ? 0 : linearElement.points.length - 1;\r\n    const adjacentPointIndex = edgePointIndex - direction;\r\n    const edgePoint = LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, edgePointIndex);\r\n    const adjacentPoint = LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, adjacentPointIndex);\r\n    return {\r\n        focus: determineFocusDistance(hoveredElement, adjacentPoint, edgePoint),\r\n        gap: Math.max(1, distanceToBindableElement(hoveredElement, edgePoint)),\r\n    };\r\n};\r\n// Supports translating, rotating and scaling `changedElement` with bound\r\n// linear elements.\r\n// Because scaling involves moving the focus points as well, it is\r\n// done before the `changedElement` is updated, and the `newSize` is passed\r\n// in explicitly.\r\nexport const updateBoundElements = (changedElement, options) => {\r\n    const boundElementIds = changedElement.boundElementIds ?? [];\r\n    if (boundElementIds.length === 0) {\r\n        return;\r\n    }\r\n    const { newSize, simultaneouslyUpdated } = options ?? {};\r\n    const simultaneouslyUpdatedElementIds = getSimultaneouslyUpdatedElementIds(simultaneouslyUpdated);\r\n    Scene.getScene(changedElement).getNonDeletedElements(boundElementIds).forEach((linearElement) => {\r\n        const bindableElement = changedElement;\r\n        // In case the boundElementIds are stale\r\n        if (!doesNeedUpdate(linearElement, bindableElement)) {\r\n            return;\r\n        }\r\n        const startBinding = maybeCalculateNewGapWhenScaling(bindableElement, linearElement.startBinding, newSize);\r\n        const endBinding = maybeCalculateNewGapWhenScaling(bindableElement, linearElement.endBinding, newSize);\r\n        // `linearElement` is being moved/scaled already, just update the binding\r\n        if (simultaneouslyUpdatedElementIds.has(linearElement.id)) {\r\n            mutateElement(linearElement, { startBinding, endBinding });\r\n            return;\r\n        }\r\n        updateBoundPoint(linearElement, \"start\", startBinding, changedElement);\r\n        updateBoundPoint(linearElement, \"end\", endBinding, changedElement);\r\n    });\r\n};\r\nconst doesNeedUpdate = (boundElement, changedElement) => {\r\n    return (boundElement.startBinding?.elementId === changedElement.id ||\r\n        boundElement.endBinding?.elementId === changedElement.id);\r\n};\r\nconst getSimultaneouslyUpdatedElementIds = (simultaneouslyUpdated) => {\r\n    return new Set((simultaneouslyUpdated || []).map((element) => element.id));\r\n};\r\nconst updateBoundPoint = (linearElement, startOrEnd, binding, changedElement) => {\r\n    if (binding == null ||\r\n        // We only need to update the other end if this is a 2 point line element\r\n        (binding.elementId !== changedElement.id && linearElement.points.length > 2)) {\r\n        return;\r\n    }\r\n    const bindingElement = Scene.getScene(linearElement).getElement(binding.elementId);\r\n    if (bindingElement == null) {\r\n        // We're not cleaning up after deleted elements atm., so handle this case\r\n        return;\r\n    }\r\n    const direction = startOrEnd === \"start\" ? -1 : 1;\r\n    const edgePointIndex = direction === -1 ? 0 : linearElement.points.length - 1;\r\n    const adjacentPointIndex = edgePointIndex - direction;\r\n    const adjacentPoint = LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, adjacentPointIndex);\r\n    const focusPointAbsolute = determineFocusPoint(bindingElement, binding.focus, adjacentPoint);\r\n    let newEdgePoint;\r\n    // The linear element was not originally pointing inside the bound shape,\r\n    // we can point directly at the focus point\r\n    if (binding.gap === 0) {\r\n        newEdgePoint = focusPointAbsolute;\r\n    }\r\n    else {\r\n        const intersections = intersectElementWithLine(bindingElement, adjacentPoint, focusPointAbsolute, binding.gap);\r\n        if (intersections.length === 0) {\r\n            // This should never happen, since focusPoint should always be\r\n            // inside the element, but just in case, bail out\r\n            newEdgePoint = focusPointAbsolute;\r\n        }\r\n        else {\r\n            // Guaranteed to intersect because focusPoint is always inside the shape\r\n            newEdgePoint = intersections[0];\r\n        }\r\n    }\r\n    LinearElementEditor.movePoint(linearElement, edgePointIndex, LinearElementEditor.pointFromAbsoluteCoords(linearElement, newEdgePoint), { [startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\"]: binding });\r\n};\r\nconst maybeCalculateNewGapWhenScaling = (changedElement, currentBinding, newSize) => {\r\n    if (currentBinding == null || newSize == null) {\r\n        return currentBinding;\r\n    }\r\n    const { gap, focus, elementId } = currentBinding;\r\n    const { width: newWidth, height: newHeight } = newSize;\r\n    const { width, height } = changedElement;\r\n    const newGap = Math.max(1, Math.min(maxBindingGap(changedElement, newWidth, newHeight), gap * (newWidth < newHeight ? newWidth / width : newHeight / height)));\r\n    return { elementId, gap: newGap, focus };\r\n};\r\nexport const getEligibleElementsForBinding = (elements) => {\r\n    const includedElementIds = new Set(elements.map(({ id }) => id));\r\n    return elements.flatMap((element) => isBindingElement(element)\r\n        ? getElligibleElementsForBindingElement(element).filter((element) => !includedElementIds.has(element.id))\r\n        : isBindableElement(element)\r\n            ? getElligibleElementsForBindableElementAndWhere(element).filter((binding) => !includedElementIds.has(binding[0].id))\r\n            : []);\r\n};\r\nconst getElligibleElementsForBindingElement = (linearElement) => {\r\n    return [\r\n        getElligibleElementForBindingElement(linearElement, \"start\"),\r\n        getElligibleElementForBindingElement(linearElement, \"end\"),\r\n    ].filter((element) => element != null);\r\n};\r\nconst getElligibleElementForBindingElement = (linearElement, startOrEnd) => {\r\n    return getHoveredElementForBinding(getLinearElementEdgeCoors(linearElement, startOrEnd), Scene.getScene(linearElement));\r\n};\r\nconst getLinearElementEdgeCoors = (linearElement, startOrEnd) => {\r\n    const index = startOrEnd === \"start\" ? 0 : -1;\r\n    return tupleToCoors(LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, index));\r\n};\r\nconst getElligibleElementsForBindableElementAndWhere = (bindableElement) => {\r\n    return Scene.getScene(bindableElement)\r\n        .getElements()\r\n        .map((element) => {\r\n        if (!isBindingElement(element)) {\r\n            return null;\r\n        }\r\n        const canBindStart = isLinearElementEligibleForNewBindingByBindable(element, \"start\", bindableElement);\r\n        const canBindEnd = isLinearElementEligibleForNewBindingByBindable(element, \"end\", bindableElement);\r\n        if (!canBindStart && !canBindEnd) {\r\n            return null;\r\n        }\r\n        return [\r\n            element,\r\n            canBindStart && canBindEnd ? \"both\" : canBindStart ? \"start\" : \"end\",\r\n            bindableElement,\r\n        ];\r\n    })\r\n        .filter((maybeElement) => maybeElement != null);\r\n};\r\nconst isLinearElementEligibleForNewBindingByBindable = (linearElement, startOrEnd, bindableElement) => {\r\n    const existingBinding = linearElement[startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\"];\r\n    return (existingBinding == null &&\r\n        !isLinearElementSimpleAndAlreadyBoundOnOppositeEdge(linearElement, bindableElement, startOrEnd) &&\r\n        bindingBorderTest(bindableElement, getLinearElementEdgeCoors(linearElement, startOrEnd)));\r\n};\r\n// We need to:\r\n// 1: Update elements not selected to point to duplicated elements\r\n// 2: Update duplicated elements to point to other duplicated elements\r\nexport const fixBindingsAfterDuplication = (sceneElements, oldElements, oldIdToDuplicatedId, \r\n// There are three copying mechanisms: Copy-paste, duplication and alt-drag.\r\n// Only when alt-dragging the new \"duplicates\" act as the \"old\", while\r\n// the \"old\" elements act as the \"new copy\" - essentially working reverse\r\n// to the other two.\r\nduplicatesServeAsOld) => {\r\n    // First collect all the binding/bindable elements, so we only update\r\n    // each once, regardless of whether they were duplicated or not.\r\n    const allBoundElementIds = new Set();\r\n    const allBindableElementIds = new Set();\r\n    const shouldReverseRoles = duplicatesServeAsOld === \"duplicatesServeAsOld\";\r\n    oldElements.forEach((oldElement) => {\r\n        const { boundElementIds } = oldElement;\r\n        if (boundElementIds != null && boundElementIds.length > 0) {\r\n            boundElementIds.forEach((boundElementId) => {\r\n                if (shouldReverseRoles && !oldIdToDuplicatedId.has(boundElementId)) {\r\n                    allBoundElementIds.add(boundElementId);\r\n                }\r\n            });\r\n            allBindableElementIds.add(oldIdToDuplicatedId.get(oldElement.id));\r\n        }\r\n        if (isBindingElement(oldElement)) {\r\n            if (oldElement.startBinding != null) {\r\n                const { elementId } = oldElement.startBinding;\r\n                if (shouldReverseRoles && !oldIdToDuplicatedId.has(elementId)) {\r\n                    allBindableElementIds.add(elementId);\r\n                }\r\n            }\r\n            if (oldElement.endBinding != null) {\r\n                const { elementId } = oldElement.endBinding;\r\n                if (shouldReverseRoles && !oldIdToDuplicatedId.has(elementId)) {\r\n                    allBindableElementIds.add(elementId);\r\n                }\r\n            }\r\n            if (oldElement.startBinding != null || oldElement.endBinding != null) {\r\n                allBoundElementIds.add(oldIdToDuplicatedId.get(oldElement.id));\r\n            }\r\n        }\r\n    });\r\n    // Update the linear elements\r\n    sceneElements.filter(({ id }) => allBoundElementIds.has(id)).forEach((element) => {\r\n        const { startBinding, endBinding } = element;\r\n        mutateElement(element, {\r\n            startBinding: newBindingAfterDuplication(startBinding, oldIdToDuplicatedId),\r\n            endBinding: newBindingAfterDuplication(endBinding, oldIdToDuplicatedId),\r\n        });\r\n    });\r\n    // Update the bindable shapes\r\n    sceneElements\r\n        .filter(({ id }) => allBindableElementIds.has(id))\r\n        .forEach((bindableElement) => {\r\n        const { boundElementIds } = bindableElement;\r\n        if (boundElementIds != null && boundElementIds.length > 0) {\r\n            mutateElement(bindableElement, {\r\n                boundElementIds: boundElementIds.map((boundElementId) => oldIdToDuplicatedId.get(boundElementId) ?? boundElementId),\r\n            });\r\n        }\r\n    });\r\n};\r\nconst newBindingAfterDuplication = (binding, oldIdToDuplicatedId) => {\r\n    if (binding == null) {\r\n        return null;\r\n    }\r\n    const { elementId, focus, gap } = binding;\r\n    return {\r\n        focus,\r\n        gap,\r\n        elementId: oldIdToDuplicatedId.get(elementId) ?? elementId,\r\n    };\r\n};\r\nexport const fixBindingsAfterDeletion = (sceneElements, deletedElements) => {\r\n    const deletedElementIds = new Set(deletedElements.map((element) => element.id));\r\n    // Non deleted and need an update\r\n    const boundElementIds = new Set();\r\n    deletedElements.forEach((deletedElement) => {\r\n        if (isBindableElement(deletedElement)) {\r\n            deletedElement.boundElementIds?.forEach((id) => {\r\n                if (!deletedElementIds.has(id)) {\r\n                    boundElementIds.add(id);\r\n                }\r\n            });\r\n        }\r\n    });\r\n    sceneElements.filter(({ id }) => boundElementIds.has(id)).forEach((element) => {\r\n        const { startBinding, endBinding } = element;\r\n        mutateElement(element, {\r\n            startBinding: newBindingAfterDeletion(startBinding, deletedElementIds),\r\n            endBinding: newBindingAfterDeletion(endBinding, deletedElementIds),\r\n        });\r\n    });\r\n};\r\nconst newBindingAfterDeletion = (binding, deletedElementIds) => {\r\n    if (binding == null || deletedElementIds.has(binding.elementId)) {\r\n        return null;\r\n    }\r\n    return binding;\r\n};\r\n","import { SHIFT_LOCKING_ANGLE } from \"../constants\";\r\nimport { rescalePoints } from \"../points\";\r\nimport { rotate, adjustXYWithRotation, centerPoint, rotatePoint, } from \"../math\";\r\nimport { getElementAbsoluteCoords, getCommonBounds, getResizedElementAbsoluteCoords, } from \"./bounds\";\r\nimport { isFreeDrawElement, isLinearElement, isTextElement, } from \"./typeChecks\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport { getPerfectElementSize } from \"./sizeHelpers\";\r\nimport { measureText, getFontString } from \"../utils\";\r\nimport { updateBoundElements } from \"./binding\";\r\nexport const normalizeAngle = (angle) => {\r\n    if (angle >= 2 * Math.PI) {\r\n        return angle - 2 * Math.PI;\r\n    }\r\n    return angle;\r\n};\r\n// Returns true when transform (resizing/rotation) happened\r\nexport const transformElements = (pointerDownState, transformHandleType, selectedElements, resizeArrowDirection, shouldRotateWithDiscreteAngle, shouldResizeFromCenter, shouldMaintainAspectRatio, pointerX, pointerY, centerX, centerY) => {\r\n    if (selectedElements.length === 1) {\r\n        const [element] = selectedElements;\r\n        if (transformHandleType === \"rotation\") {\r\n            rotateSingleElement(element, pointerX, pointerY, shouldRotateWithDiscreteAngle);\r\n            updateBoundElements(element);\r\n        }\r\n        else if (isLinearElement(element) &&\r\n            element.points.length === 2 &&\r\n            (transformHandleType === \"nw\" ||\r\n                transformHandleType === \"ne\" ||\r\n                transformHandleType === \"sw\" ||\r\n                transformHandleType === \"se\")) {\r\n            reshapeSingleTwoPointElement(element, resizeArrowDirection, shouldRotateWithDiscreteAngle, pointerX, pointerY);\r\n        }\r\n        else if (isTextElement(element) &&\r\n            (transformHandleType === \"nw\" ||\r\n                transformHandleType === \"ne\" ||\r\n                transformHandleType === \"sw\" ||\r\n                transformHandleType === \"se\")) {\r\n            resizeSingleTextElement(element, transformHandleType, shouldResizeFromCenter, pointerX, pointerY);\r\n            updateBoundElements(element);\r\n        }\r\n        else if (transformHandleType) {\r\n            resizeSingleElement(pointerDownState.originalElements.get(element.id), shouldMaintainAspectRatio, element, transformHandleType, shouldResizeFromCenter, pointerX, pointerY);\r\n        }\r\n        return true;\r\n    }\r\n    else if (selectedElements.length > 1) {\r\n        if (transformHandleType === \"rotation\") {\r\n            rotateMultipleElements(pointerDownState, selectedElements, pointerX, pointerY, shouldRotateWithDiscreteAngle, centerX, centerY);\r\n            return true;\r\n        }\r\n        else if (transformHandleType === \"nw\" ||\r\n            transformHandleType === \"ne\" ||\r\n            transformHandleType === \"sw\" ||\r\n            transformHandleType === \"se\") {\r\n            resizeMultipleElements(selectedElements, transformHandleType, pointerX, pointerY);\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\nconst rotateSingleElement = (element, pointerX, pointerY, shouldRotateWithDiscreteAngle) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    let angle = (5 * Math.PI) / 2 + Math.atan2(pointerY - cy, pointerX - cx);\r\n    if (shouldRotateWithDiscreteAngle) {\r\n        angle += SHIFT_LOCKING_ANGLE / 2;\r\n        angle -= angle % SHIFT_LOCKING_ANGLE;\r\n    }\r\n    angle = normalizeAngle(angle);\r\n    mutateElement(element, { angle });\r\n};\r\n// used in DEV only\r\nconst validateTwoPointElementNormalized = (element) => {\r\n    if (element.points.length !== 2 ||\r\n        element.points[0][0] !== 0 ||\r\n        element.points[0][1] !== 0 ||\r\n        Math.abs(element.points[1][0]) !== element.width ||\r\n        Math.abs(element.points[1][1]) !== element.height) {\r\n        throw new Error(\"Two-point element is not normalized\");\r\n    }\r\n};\r\nconst getPerfectElementSizeWithRotation = (elementType, width, height, angle) => {\r\n    const size = getPerfectElementSize(elementType, ...rotate(width, height, 0, 0, angle));\r\n    return rotate(size.width, size.height, 0, 0, -angle);\r\n};\r\nexport const reshapeSingleTwoPointElement = (element, resizeArrowDirection, shouldRotateWithDiscreteAngle, pointerX, pointerY) => {\r\n    if (process.env.NODE_ENV !== \"production\") {\r\n        validateTwoPointElementNormalized(element);\r\n    }\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    // rotation pointer with reverse angle\r\n    const [rotatedX, rotatedY] = rotate(pointerX, pointerY, cx, cy, -element.angle);\r\n    let [width, height] = resizeArrowDirection === \"end\"\r\n        ? [rotatedX - element.x, rotatedY - element.y]\r\n        : [\r\n            element.x + element.points[1][0] - rotatedX,\r\n            element.y + element.points[1][1] - rotatedY,\r\n        ];\r\n    if (shouldRotateWithDiscreteAngle) {\r\n        [width, height] = getPerfectElementSizeWithRotation(element.type, width, height, element.angle);\r\n    }\r\n    const [nextElementX, nextElementY] = adjustXYWithRotation(resizeArrowDirection === \"end\"\r\n        ? { s: true, e: true }\r\n        : { n: true, w: true }, element.x, element.y, element.angle, 0, 0, (element.points[1][0] - width) / 2, (element.points[1][1] - height) / 2);\r\n    mutateElement(element, {\r\n        x: nextElementX,\r\n        y: nextElementY,\r\n        points: [\r\n            [0, 0],\r\n            [width, height],\r\n        ],\r\n    });\r\n};\r\nconst rescalePointsInElement = (element, width, height) => isLinearElement(element) || isFreeDrawElement(element)\r\n    ? {\r\n        points: rescalePoints(0, width, rescalePoints(1, height, element.points)),\r\n    }\r\n    : {};\r\nconst MIN_FONT_SIZE = 1;\r\nconst measureFontSizeFromWH = (element, nextWidth, nextHeight) => {\r\n    // We only use width to scale font on resize\r\n    const nextFontSize = element.fontSize * (nextWidth / element.width);\r\n    if (nextFontSize < MIN_FONT_SIZE) {\r\n        return null;\r\n    }\r\n    const metrics = measureText(element.text, getFontString({ fontSize: nextFontSize, fontFamily: element.fontFamily }));\r\n    return {\r\n        size: nextFontSize,\r\n        baseline: metrics.baseline + (nextHeight - metrics.height),\r\n    };\r\n};\r\nconst getSidesForTransformHandle = (transformHandleType, shouldResizeFromCenter) => {\r\n    return {\r\n        n: /^(n|ne|nw)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(s|se|sw)$/.test(transformHandleType)),\r\n        s: /^(s|se|sw)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(n|ne|nw)$/.test(transformHandleType)),\r\n        w: /^(w|nw|sw)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(e|ne|se)$/.test(transformHandleType)),\r\n        e: /^(e|ne|se)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(w|nw|sw)$/.test(transformHandleType)),\r\n    };\r\n};\r\nconst resizeSingleTextElement = (element, transformHandleType, shouldResizeFromCenter, pointerX, pointerY) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    // rotation pointer with reverse angle\r\n    const [rotatedX, rotatedY] = rotate(pointerX, pointerY, cx, cy, -element.angle);\r\n    let scale;\r\n    switch (transformHandleType) {\r\n        case \"se\":\r\n            scale = Math.max((rotatedX - x1) / (x2 - x1), (rotatedY - y1) / (y2 - y1));\r\n            break;\r\n        case \"nw\":\r\n            scale = Math.max((x2 - rotatedX) / (x2 - x1), (y2 - rotatedY) / (y2 - y1));\r\n            break;\r\n        case \"ne\":\r\n            scale = Math.max((rotatedX - x1) / (x2 - x1), (y2 - rotatedY) / (y2 - y1));\r\n            break;\r\n        case \"sw\":\r\n            scale = Math.max((x2 - rotatedX) / (x2 - x1), (rotatedY - y1) / (y2 - y1));\r\n            break;\r\n    }\r\n    if (scale > 0) {\r\n        const nextWidth = element.width * scale;\r\n        const nextHeight = element.height * scale;\r\n        const nextFont = measureFontSizeFromWH(element, nextWidth, nextHeight);\r\n        if (nextFont === null) {\r\n            return;\r\n        }\r\n        const [nextX1, nextY1, nextX2, nextY2] = getResizedElementAbsoluteCoords(element, nextWidth, nextHeight);\r\n        const deltaX1 = (x1 - nextX1) / 2;\r\n        const deltaY1 = (y1 - nextY1) / 2;\r\n        const deltaX2 = (x2 - nextX2) / 2;\r\n        const deltaY2 = (y2 - nextY2) / 2;\r\n        const [nextElementX, nextElementY] = adjustXYWithRotation(getSidesForTransformHandle(transformHandleType, shouldResizeFromCenter), element.x, element.y, element.angle, deltaX1, deltaY1, deltaX2, deltaY2);\r\n        mutateElement(element, {\r\n            fontSize: nextFont.size,\r\n            width: nextWidth,\r\n            height: nextHeight,\r\n            baseline: nextFont.baseline,\r\n            x: nextElementX,\r\n            y: nextElementY,\r\n        });\r\n    }\r\n};\r\nexport const resizeSingleElement = (stateAtResizeStart, shouldMaintainAspectRatio, element, transformHandleDirection, shouldResizeFromCenter, pointerX, pointerY) => {\r\n    // Gets bounds corners\r\n    const [x1, y1, x2, y2] = getResizedElementAbsoluteCoords(stateAtResizeStart, stateAtResizeStart.width, stateAtResizeStart.height);\r\n    const startTopLeft = [x1, y1];\r\n    const startBottomRight = [x2, y2];\r\n    const startCenter = centerPoint(startTopLeft, startBottomRight);\r\n    // Calculate new dimensions based on cursor position\r\n    const rotatedPointer = rotatePoint([pointerX, pointerY], startCenter, -stateAtResizeStart.angle);\r\n    // Get bounds corners rendered on screen\r\n    const [esx1, esy1, esx2, esy2] = getResizedElementAbsoluteCoords(element, element.width, element.height);\r\n    const boundsCurrentWidth = esx2 - esx1;\r\n    const boundsCurrentHeight = esy2 - esy1;\r\n    // It's important we set the initial scale value based on the width and height at resize start,\r\n    // otherwise previous dimensions affected by modifiers will be taken into account.\r\n    const atStartBoundsWidth = startBottomRight[0] - startTopLeft[0];\r\n    const atStartBoundsHeight = startBottomRight[1] - startTopLeft[1];\r\n    let scaleX = atStartBoundsWidth / boundsCurrentWidth;\r\n    let scaleY = atStartBoundsHeight / boundsCurrentHeight;\r\n    if (transformHandleDirection.includes(\"e\")) {\r\n        scaleX = (rotatedPointer[0] - startTopLeft[0]) / boundsCurrentWidth;\r\n    }\r\n    if (transformHandleDirection.includes(\"s\")) {\r\n        scaleY = (rotatedPointer[1] - startTopLeft[1]) / boundsCurrentHeight;\r\n    }\r\n    if (transformHandleDirection.includes(\"w\")) {\r\n        scaleX = (startBottomRight[0] - rotatedPointer[0]) / boundsCurrentWidth;\r\n    }\r\n    if (transformHandleDirection.includes(\"n\")) {\r\n        scaleY = (startBottomRight[1] - rotatedPointer[1]) / boundsCurrentHeight;\r\n    }\r\n    // Linear elements dimensions differ from bounds dimensions\r\n    const eleInitialWidth = stateAtResizeStart.width;\r\n    const eleInitialHeight = stateAtResizeStart.height;\r\n    // We have to use dimensions of element on screen, otherwise the scaling of the\r\n    // dimensions won't match the cursor for linear elements.\r\n    let eleNewWidth = element.width * scaleX;\r\n    let eleNewHeight = element.height * scaleY;\r\n    // adjust dimensions for resizing from center\r\n    if (shouldResizeFromCenter) {\r\n        eleNewWidth = 2 * eleNewWidth - eleInitialWidth;\r\n        eleNewHeight = 2 * eleNewHeight - eleInitialHeight;\r\n    }\r\n    // adjust dimensions to keep sides ratio\r\n    if (shouldMaintainAspectRatio) {\r\n        const widthRatio = Math.abs(eleNewWidth) / eleInitialWidth;\r\n        const heightRatio = Math.abs(eleNewHeight) / eleInitialHeight;\r\n        if (transformHandleDirection.length === 1) {\r\n            eleNewHeight *= widthRatio;\r\n            eleNewWidth *= heightRatio;\r\n        }\r\n        if (transformHandleDirection.length === 2) {\r\n            const ratio = Math.max(widthRatio, heightRatio);\r\n            eleNewWidth = eleInitialWidth * ratio * Math.sign(eleNewWidth);\r\n            eleNewHeight = eleInitialHeight * ratio * Math.sign(eleNewHeight);\r\n        }\r\n    }\r\n    const [newBoundsX1, newBoundsY1, newBoundsX2, newBoundsY2] = getResizedElementAbsoluteCoords(stateAtResizeStart, eleNewWidth, eleNewHeight);\r\n    const newBoundsWidth = newBoundsX2 - newBoundsX1;\r\n    const newBoundsHeight = newBoundsY2 - newBoundsY1;\r\n    // Calculate new topLeft based on fixed corner during resize\r\n    let newTopLeft = [...startTopLeft];\r\n    if ([\"n\", \"w\", \"nw\"].includes(transformHandleDirection)) {\r\n        newTopLeft = [\r\n            startBottomRight[0] - Math.abs(newBoundsWidth),\r\n            startBottomRight[1] - Math.abs(newBoundsHeight),\r\n        ];\r\n    }\r\n    if (transformHandleDirection === \"ne\") {\r\n        const bottomLeft = [startTopLeft[0], startBottomRight[1]];\r\n        newTopLeft = [bottomLeft[0], bottomLeft[1] - Math.abs(newBoundsHeight)];\r\n    }\r\n    if (transformHandleDirection === \"sw\") {\r\n        const topRight = [startBottomRight[0], startTopLeft[1]];\r\n        newTopLeft = [topRight[0] - Math.abs(newBoundsWidth), topRight[1]];\r\n    }\r\n    // Keeps opposite handle fixed during resize\r\n    if (shouldMaintainAspectRatio) {\r\n        if ([\"s\", \"n\"].includes(transformHandleDirection)) {\r\n            newTopLeft[0] = startCenter[0] - newBoundsWidth / 2;\r\n        }\r\n        if ([\"e\", \"w\"].includes(transformHandleDirection)) {\r\n            newTopLeft[1] = startCenter[1] - newBoundsHeight / 2;\r\n        }\r\n    }\r\n    // Flip horizontally\r\n    if (eleNewWidth < 0) {\r\n        if (transformHandleDirection.includes(\"e\")) {\r\n            newTopLeft[0] -= Math.abs(newBoundsWidth);\r\n        }\r\n        if (transformHandleDirection.includes(\"w\")) {\r\n            newTopLeft[0] += Math.abs(newBoundsWidth);\r\n        }\r\n    }\r\n    // Flip vertically\r\n    if (eleNewHeight < 0) {\r\n        if (transformHandleDirection.includes(\"s\")) {\r\n            newTopLeft[1] -= Math.abs(newBoundsHeight);\r\n        }\r\n        if (transformHandleDirection.includes(\"n\")) {\r\n            newTopLeft[1] += Math.abs(newBoundsHeight);\r\n        }\r\n    }\r\n    if (shouldResizeFromCenter) {\r\n        newTopLeft[0] = startCenter[0] - Math.abs(newBoundsWidth) / 2;\r\n        newTopLeft[1] = startCenter[1] - Math.abs(newBoundsHeight) / 2;\r\n    }\r\n    // adjust topLeft to new rotation point\r\n    const angle = stateAtResizeStart.angle;\r\n    const rotatedTopLeft = rotatePoint(newTopLeft, startCenter, angle);\r\n    const newCenter = [\r\n        newTopLeft[0] + Math.abs(newBoundsWidth) / 2,\r\n        newTopLeft[1] + Math.abs(newBoundsHeight) / 2,\r\n    ];\r\n    const rotatedNewCenter = rotatePoint(newCenter, startCenter, angle);\r\n    newTopLeft = rotatePoint(rotatedTopLeft, rotatedNewCenter, -angle);\r\n    // Readjust points for linear elements\r\n    const rescaledPoints = rescalePointsInElement(stateAtResizeStart, eleNewWidth, eleNewHeight);\r\n    // For linear elements (x,y) are the coordinates of the first drawn point not the top-left corner\r\n    // So we need to readjust (x,y) to be where the first point should be\r\n    const newOrigin = [...newTopLeft];\r\n    newOrigin[0] += stateAtResizeStart.x - newBoundsX1;\r\n    newOrigin[1] += stateAtResizeStart.y - newBoundsY1;\r\n    const resizedElement = {\r\n        width: Math.abs(eleNewWidth),\r\n        height: Math.abs(eleNewHeight),\r\n        x: newOrigin[0],\r\n        y: newOrigin[1],\r\n        ...rescaledPoints,\r\n    };\r\n    if (\"scale\" in element && \"scale\" in stateAtResizeStart) {\r\n        mutateElement(element, {\r\n            scale: [\r\n                // defaulting because scaleX/Y can be 0/-0\r\n                (Math.sign(scaleX) || stateAtResizeStart.scale[0]) *\r\n                    stateAtResizeStart.scale[0],\r\n                (Math.sign(scaleY) || stateAtResizeStart.scale[1]) *\r\n                    stateAtResizeStart.scale[1],\r\n            ],\r\n        });\r\n    }\r\n    if (resizedElement.width !== 0 &&\r\n        resizedElement.height !== 0 &&\r\n        Number.isFinite(resizedElement.x) &&\r\n        Number.isFinite(resizedElement.y)) {\r\n        updateBoundElements(element, {\r\n            newSize: { width: resizedElement.width, height: resizedElement.height },\r\n        });\r\n        mutateElement(element, resizedElement);\r\n    }\r\n};\r\nconst resizeMultipleElements = (elements, transformHandleType, pointerX, pointerY) => {\r\n    const [x1, y1, x2, y2] = getCommonBounds(elements);\r\n    let scale;\r\n    let getNextXY;\r\n    switch (transformHandleType) {\r\n        case \"se\":\r\n            scale = Math.max((pointerX - x1) / (x2 - x1), (pointerY - y1) / (y2 - y1));\r\n            getNextXY = (element, [origX1, origY1], [finalX1, finalY1]) => {\r\n                const x = element.x + (origX1 - x1) * (scale - 1) + origX1 - finalX1;\r\n                const y = element.y + (origY1 - y1) * (scale - 1) + origY1 - finalY1;\r\n                return { x, y };\r\n            };\r\n            break;\r\n        case \"nw\":\r\n            scale = Math.max((x2 - pointerX) / (x2 - x1), (y2 - pointerY) / (y2 - y1));\r\n            getNextXY = (element, [, , origX2, origY2], [, , finalX2, finalY2]) => {\r\n                const x = element.x - (x2 - origX2) * (scale - 1) + origX2 - finalX2;\r\n                const y = element.y - (y2 - origY2) * (scale - 1) + origY2 - finalY2;\r\n                return { x, y };\r\n            };\r\n            break;\r\n        case \"ne\":\r\n            scale = Math.max((pointerX - x1) / (x2 - x1), (y2 - pointerY) / (y2 - y1));\r\n            getNextXY = (element, [origX1, , , origY2], [finalX1, , , finalY2]) => {\r\n                const x = element.x + (origX1 - x1) * (scale - 1) + origX1 - finalX1;\r\n                const y = element.y - (y2 - origY2) * (scale - 1) + origY2 - finalY2;\r\n                return { x, y };\r\n            };\r\n            break;\r\n        case \"sw\":\r\n            scale = Math.max((x2 - pointerX) / (x2 - x1), (pointerY - y1) / (y2 - y1));\r\n            getNextXY = (element, [, origY1, origX2], [, finalY1, finalX2]) => {\r\n                const x = element.x - (x2 - origX2) * (scale - 1) + origX2 - finalX2;\r\n                const y = element.y + (origY1 - y1) * (scale - 1) + origY1 - finalY1;\r\n                return { x, y };\r\n            };\r\n            break;\r\n    }\r\n    if (scale > 0) {\r\n        const updates = elements.reduce((prev, element) => {\r\n            if (!prev) {\r\n                return prev;\r\n            }\r\n            const width = element.width * scale;\r\n            const height = element.height * scale;\r\n            let font = {};\r\n            if (element.type === \"text\") {\r\n                const nextFont = measureFontSizeFromWH(element, width, height);\r\n                if (nextFont === null) {\r\n                    return null;\r\n                }\r\n                font = { fontSize: nextFont.size, baseline: nextFont.baseline };\r\n            }\r\n            const origCoords = getElementAbsoluteCoords(element);\r\n            const rescaledPoints = rescalePointsInElement(element, width, height);\r\n            updateBoundElements(element, {\r\n                newSize: { width, height },\r\n                simultaneouslyUpdated: elements,\r\n            });\r\n            const finalCoords = getResizedElementAbsoluteCoords({\r\n                ...element,\r\n                ...rescaledPoints,\r\n            }, width, height);\r\n            const { x, y } = getNextXY(element, origCoords, finalCoords);\r\n            return [...prev, { width, height, x, y, ...rescaledPoints, ...font }];\r\n        }, []);\r\n        if (updates) {\r\n            elements.forEach((element, index) => {\r\n                mutateElement(element, updates[index]);\r\n            });\r\n        }\r\n    }\r\n};\r\nconst rotateMultipleElements = (pointerDownState, elements, pointerX, pointerY, shouldRotateWithDiscreteAngle, centerX, centerY) => {\r\n    let centerAngle = (5 * Math.PI) / 2 + Math.atan2(pointerY - centerY, pointerX - centerX);\r\n    if (shouldRotateWithDiscreteAngle) {\r\n        centerAngle += SHIFT_LOCKING_ANGLE / 2;\r\n        centerAngle -= centerAngle % SHIFT_LOCKING_ANGLE;\r\n    }\r\n    elements.forEach((element, index) => {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const origAngle = pointerDownState.originalElements.get(element.id)?.angle ?? element.angle;\r\n        const [rotatedCX, rotatedCY] = rotate(cx, cy, centerX, centerY, centerAngle + origAngle - element.angle);\r\n        mutateElement(element, {\r\n            x: element.x + (rotatedCX - cx),\r\n            y: element.y + (rotatedCY - cy),\r\n            angle: normalizeAngle(centerAngle + origAngle),\r\n        });\r\n    });\r\n};\r\nexport const getResizeOffsetXY = (transformHandleType, selectedElements, x, y) => {\r\n    const [x1, y1, x2, y2] = selectedElements.length === 1\r\n        ? getElementAbsoluteCoords(selectedElements[0])\r\n        : getCommonBounds(selectedElements);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    const angle = selectedElements.length === 1 ? selectedElements[0].angle : 0;\r\n    [x, y] = rotate(x, y, cx, cy, -angle);\r\n    switch (transformHandleType) {\r\n        case \"n\":\r\n            return rotate(x - (x1 + x2) / 2, y - y1, 0, 0, angle);\r\n        case \"s\":\r\n            return rotate(x - (x1 + x2) / 2, y - y2, 0, 0, angle);\r\n        case \"w\":\r\n            return rotate(x - x1, y - (y1 + y2) / 2, 0, 0, angle);\r\n        case \"e\":\r\n            return rotate(x - x2, y - (y1 + y2) / 2, 0, 0, angle);\r\n        case \"nw\":\r\n            return rotate(x - x1, y - y1, 0, 0, angle);\r\n        case \"ne\":\r\n            return rotate(x - x2, y - y1, 0, 0, angle);\r\n        case \"sw\":\r\n            return rotate(x - x1, y - y2, 0, 0, angle);\r\n        case \"se\":\r\n            return rotate(x - x2, y - y2, 0, 0, angle);\r\n        default:\r\n            return [0, 0];\r\n    }\r\n};\r\nexport const getResizeArrowDirection = (transformHandleType, element) => {\r\n    const [, [px, py]] = element.points;\r\n    const isResizeEnd = (transformHandleType === \"nw\" && (px < 0 || py < 0)) ||\r\n        (transformHandleType === \"ne\" && px >= 0) ||\r\n        (transformHandleType === \"sw\" && px <= 0) ||\r\n        (transformHandleType === \"se\" && (px > 0 || py > 0));\r\n    return isResizeEnd ? \"end\" : \"origin\";\r\n};\r\n","import { updateBoundElements } from \"./binding\";\r\nimport { getCommonBounds } from \"./bounds\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport { getPerfectElementSize } from \"./sizeHelpers\";\r\nexport const dragSelectedElements = (pointerDownState, selectedElements, pointerX, pointerY, scene, lockDirection = false, distanceX = 0, distanceY = 0) => {\r\n    const [x1, y1] = getCommonBounds(selectedElements);\r\n    const offset = { x: pointerX - x1, y: pointerY - y1 };\r\n    selectedElements.forEach((element) => {\r\n        let x;\r\n        let y;\r\n        if (lockDirection) {\r\n            const lockX = lockDirection && distanceX < distanceY;\r\n            const lockY = lockDirection && distanceX > distanceY;\r\n            const original = pointerDownState.originalElements.get(element.id);\r\n            x = lockX && original ? original.x : element.x + offset.x;\r\n            y = lockY && original ? original.y : element.y + offset.y;\r\n        }\r\n        else {\r\n            x = element.x + offset.x;\r\n            y = element.y + offset.y;\r\n        }\r\n        mutateElement(element, {\r\n            x,\r\n            y,\r\n        });\r\n        updateBoundElements(element, {\r\n            simultaneouslyUpdated: selectedElements,\r\n        });\r\n    });\r\n};\r\nexport const getDragOffsetXY = (selectedElements, x, y) => {\r\n    const [x1, y1] = getCommonBounds(selectedElements);\r\n    return [x - x1, y - y1];\r\n};\r\nexport const dragNewElement = (draggingElement, elementType, originX, originY, x, y, width, height, shouldMaintainAspectRatio, shouldResizeFromCenter, \r\n/** whether to keep given aspect ratio when `isResizeWithSidesSameLength` is\r\n    true */\r\nwidthAspectRatio) => {\r\n    if (shouldMaintainAspectRatio) {\r\n        if (widthAspectRatio) {\r\n            height = width / widthAspectRatio;\r\n        }\r\n        else {\r\n            ({ width, height } = getPerfectElementSize(elementType, width, y < originY ? -height : height));\r\n            if (height < 0) {\r\n                height = -height;\r\n            }\r\n        }\r\n    }\r\n    let newX = x < originX ? originX - width : originX;\r\n    let newY = y < originY ? originY - height : originY;\r\n    if (shouldResizeFromCenter) {\r\n        width += width;\r\n        height += height;\r\n        newX = originX - width / 2;\r\n        newY = originY - height / 2;\r\n    }\r\n    if (width !== 0 && height !== 0) {\r\n        mutateElement(draggingElement, {\r\n            x: newX,\r\n            y: newY,\r\n            width,\r\n            height,\r\n        });\r\n    }\r\n};\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { isWritableElement, getFontString } from \"../utils\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { isTextElement } from \"./typeChecks\";\r\nimport { CLASSES } from \"../constants\";\r\nconst normalizeText = (text) => {\r\n    return (text\r\n        // replace tabs with spaces so they render and measure correctly\r\n        .replace(/\\t/g, \"        \")\r\n        // normalize newlines\r\n        .replace(/\\r?\\n|\\r/g, \"\\n\"));\r\n};\r\nconst getTransform = (width, height, angle, appState, maxWidth) => {\r\n    const { zoom, offsetTop, offsetLeft } = appState;\r\n    const degree = (180 * angle) / Math.PI;\r\n    // offsets must be multiplied by 2 to account for the division by 2 of\r\n    // the whole expression afterwards\r\n    let translateX = ((width - offsetLeft * 2) * (zoom.value - 1)) / 2;\r\n    const translateY = ((height - offsetTop * 2) * (zoom.value - 1)) / 2;\r\n    if (width > maxWidth && zoom.value !== 1) {\r\n        translateX = (maxWidth / 2) * (zoom.value - 1);\r\n    }\r\n    return `translate(${translateX}px, ${translateY}px) scale(${zoom.value}) rotate(${degree}deg)`;\r\n};\r\nexport const textWysiwyg = ({ id, appState, onChange, onSubmit, getViewportCoords, element, canvas, excalidrawContainer, }) => {\r\n    const updateWysiwygStyle = () => {\r\n        const updatedElement = Scene.getScene(element)?.getElement(id);\r\n        if (updatedElement && isTextElement(updatedElement)) {\r\n            const [viewportX, viewportY] = getViewportCoords(updatedElement.x, updatedElement.y);\r\n            const { textAlign, angle } = updatedElement;\r\n            editable.value = updatedElement.text;\r\n            const lines = updatedElement.text.replace(/\\r\\n?/g, \"\\n\").split(\"\\n\");\r\n            const lineHeight = updatedElement.height / lines.length;\r\n            const maxWidth = (appState.offsetLeft + appState.width - viewportX - 8) /\r\n                appState.zoom.value -\r\n                // margin-right of parent if any\r\n                Number(getComputedStyle(excalidrawContainer?.parentNode).marginRight.slice(0, -2));\r\n            Object.assign(editable.style, {\r\n                font: getFontString(updatedElement),\r\n                // must be defined *after* font ¯\\_(ツ)_/¯\r\n                lineHeight: `${lineHeight}px`,\r\n                width: `${updatedElement.width}px`,\r\n                height: `${updatedElement.height}px`,\r\n                left: `${viewportX}px`,\r\n                top: `${viewportY}px`,\r\n                transform: getTransform(updatedElement.width, updatedElement.height, angle, appState, maxWidth),\r\n                textAlign,\r\n                color: updatedElement.strokeColor,\r\n                opacity: updatedElement.opacity / 100,\r\n                filter: \"var(--theme-filter)\",\r\n                maxWidth: `${maxWidth}px`,\r\n            });\r\n        }\r\n    };\r\n    const editable = document.createElement(\"textarea\");\r\n    editable.dir = \"auto\";\r\n    editable.tabIndex = 0;\r\n    editable.className = \"canvas_text\";\r\n    editable.dataset.type = \"wysiwyg\";\r\n    // prevent line wrapping on Safari\r\n    editable.wrap = \"off\";\r\n    Object.assign(editable.style, {\r\n        position: \"absolute\",\r\n        display: \"inline-block\",\r\n        minHeight: \"1em\",\r\n        backfaceVisibility: \"hidden\",\r\n        margin: 0,\r\n        padding: 0,\r\n        border: 0,\r\n        outline: 0,\r\n        resize: \"none\",\r\n        background: \"transparent\",\r\n        overflow: \"hidden\",\r\n        font: \"Virgil\",\r\n        // prevent line wrapping (`whitespace: nowrap` doesn't work on FF)\r\n        whiteSpace: \"pre\",\r\n        // must be specified because in dark mode canvas creates a stacking context\r\n        zIndex: \"var(--zIndex-wysiwyg)\",\r\n    });\r\n    updateWysiwygStyle();\r\n    if (onChange) {\r\n        editable.oninput = () => {\r\n           \r\n            onChange(normalizeText(editable.value));\r\n        };\r\n    }\r\n    editable.onkeydown = (event) => {\r\n        event.stopPropagation();\r\n        if (event.key === KEYS.ESCAPE) {\r\n            event.preventDefault();\r\n            submittedViaKeyboard = true;\r\n            handleSubmit();\r\n        }\r\n        else if (event.key === KEYS.ENTER && event[KEYS.CTRL_OR_CMD]) {\r\n            event.preventDefault();\r\n            if (event.isComposing || event.keyCode === 229) {\r\n                return;\r\n            }\r\n            submittedViaKeyboard = true;\r\n            handleSubmit();\r\n        }\r\n        else if (event.key === KEYS.TAB ||\r\n            (event[KEYS.CTRL_OR_CMD] &&\r\n                (event.code === CODES.BRACKET_LEFT ||\r\n                    event.code === CODES.BRACKET_RIGHT))) {\r\n            event.preventDefault();\r\n            if (event.shiftKey || event.code === CODES.BRACKET_LEFT) {\r\n                outdent();\r\n            }\r\n            else {\r\n                indent();\r\n            }\r\n            \r\n            // We must send an input event to resize the element\r\n            editable.dispatchEvent(new Event(\"input\"));\r\n        }\r\n        console.log(\"here on 89\");\r\n        editable.dispatchEvent(new Event(\"input\"));\r\n    };\r\n    const TAB_SIZE = 4;\r\n    const TAB = \" \".repeat(TAB_SIZE);\r\n    const RE_LEADING_TAB = new RegExp(`^ {1,${TAB_SIZE}}`);\r\n    const indent = () => {\r\n        const { selectionStart, selectionEnd } = editable;\r\n        const linesStartIndices = getSelectedLinesStartIndices();\r\n        let value = editable.value;\r\n        linesStartIndices.forEach((startIndex) => {\r\n            const startValue = value.slice(0, startIndex);\r\n            const endValue = value.slice(startIndex);\r\n            value = `${startValue}${TAB}${endValue}`;\r\n        });\r\n        editable.value = value;\r\n        editable.selectionStart = selectionStart + TAB_SIZE;\r\n        editable.selectionEnd = selectionEnd + TAB_SIZE * linesStartIndices.length;\r\n    };\r\n    const outdent = () => {\r\n        const { selectionStart, selectionEnd } = editable;\r\n        const linesStartIndices = getSelectedLinesStartIndices();\r\n        const removedTabs = [];\r\n        let value = editable.value;\r\n        linesStartIndices.forEach((startIndex) => {\r\n            const tabMatch = value\r\n                .slice(startIndex, startIndex + TAB_SIZE)\r\n                .match(RE_LEADING_TAB);\r\n            if (tabMatch) {\r\n                const startValue = value.slice(0, startIndex);\r\n                const endValue = value.slice(startIndex + tabMatch[0].length);\r\n                // Delete a tab from the line\r\n                value = `${startValue}${endValue}`;\r\n                removedTabs.push(startIndex);\r\n            }\r\n        });\r\n        editable.value = value;\r\n        if (removedTabs.length) {\r\n            if (selectionStart > removedTabs[removedTabs.length - 1]) {\r\n                editable.selectionStart = Math.max(selectionStart - TAB_SIZE, removedTabs[removedTabs.length - 1]);\r\n            }\r\n            else {\r\n                // If the cursor is before the first tab removed, ex:\r\n                // Line| #1\r\n                //     Line #2\r\n                // Lin|e #3\r\n                // we should reset the selectionStart to his initial value.\r\n                editable.selectionStart = selectionStart;\r\n            }\r\n            editable.selectionEnd = Math.max(editable.selectionStart, selectionEnd - TAB_SIZE * removedTabs.length);\r\n        }\r\n    };\r\n    /**\r\n     * @returns indeces of start positions of selected lines, in reverse order\r\n     */\r\n    const getSelectedLinesStartIndices = () => {\r\n        let { selectionStart, selectionEnd, value } = editable;\r\n        // chars before selectionStart on the same line\r\n        const startOffset = value.slice(0, selectionStart).match(/[^\\n]*$/)[0]\r\n            .length;\r\n        // put caret at the start of the line\r\n        selectionStart = selectionStart - startOffset;\r\n        const selected = value.slice(selectionStart, selectionEnd);\r\n        return selected\r\n            .split(\"\\n\")\r\n            .reduce((startIndices, line, idx, lines) => startIndices.concat(idx\r\n            ? // curr line index is prev line's start + prev line's length + \\n\r\n                startIndices[idx - 1] + lines[idx - 1].length + 1\r\n            : // first selected line\r\n                selectionStart), [])\r\n            .reverse();\r\n    };\r\n    const stopEvent = (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n    };\r\n    // using a state variable instead of passing it to the handleSubmit callback\r\n    // so that we don't need to create separate a callback for event handlers\r\n    let submittedViaKeyboard = false;\r\n    const handleSubmit = () => {\r\n        // cleanup must be run before onSubmit otherwise when app blurs the wysiwyg\r\n        // it'd get stuck in an infinite loop of blur→onSubmit after we re-focus the\r\n        // wysiwyg on update\r\n        cleanup();\r\n        onSubmit({\r\n            text: normalizeText(editable.value),\r\n            viaKeyboard: submittedViaKeyboard,\r\n        });\r\n    };\r\n    const cleanup = () => {\r\n        if (isDestroyed) {\r\n            return;\r\n        }\r\n        isDestroyed = true;\r\n        // remove events to ensure they don't late-fire\r\n        editable.onblur = null;\r\n        editable.oninput = null;\r\n        editable.onkeydown = null;\r\n        if (observer) {\r\n            observer.disconnect();\r\n        }\r\n        window.removeEventListener(\"resize\", updateWysiwygStyle);\r\n        window.removeEventListener(\"wheel\", stopEvent, true);\r\n        window.removeEventListener(\"pointerdown\", onPointerDown);\r\n        window.removeEventListener(\"pointerup\", bindBlurEvent);\r\n        window.removeEventListener(\"blur\", handleSubmit);\r\n        unbindUpdate();\r\n        editable.remove();\r\n    };\r\n    const bindBlurEvent = () => {\r\n        window.removeEventListener(\"pointerup\", bindBlurEvent);\r\n        // Deferred so that the pointerdown that initiates the wysiwyg doesn't\r\n        // trigger the blur on ensuing pointerup.\r\n        // Also to handle cases such as picking a color which would trigger a blur\r\n        // in that same tick.\r\n        setTimeout(() => {\r\n            editable.onblur = handleSubmit;\r\n            // case: clicking on the same property → no change → no update → no focus\r\n            editable.focus();\r\n        });\r\n    };\r\n    // prevent blur when changing properties from the menu\r\n    const onPointerDown = (event) => {\r\n        if ((event.target instanceof HTMLElement ||\r\n            event.target instanceof SVGElement) &&\r\n            event.target.closest(`.${CLASSES.SHAPE_ACTIONS_MENU}`) &&\r\n            !isWritableElement(event.target)) {\r\n            editable.onblur = null;\r\n            window.addEventListener(\"pointerup\", bindBlurEvent);\r\n            // handle edge-case where pointerup doesn't fire e.g. due to user\r\n            // alt-tabbing away\r\n            window.addEventListener(\"blur\", handleSubmit);\r\n        }\r\n    };\r\n    // handle updates of textElement properties of editing element\r\n    const unbindUpdate = Scene.getScene(element).addCallback(() => {\r\n        updateWysiwygStyle();\r\n        editable.focus();\r\n    });\r\n    // ---------------------------------------------------------------------------\r\n    let isDestroyed = false;\r\n    // select on init (focusing is done separately inside the bindBlurEvent()\r\n    // because we need it to happen *after* the blur event from `pointerdown`)\r\n    editable.select();\r\n    bindBlurEvent();\r\n    // reposition wysiwyg in case of canvas is resized. Using ResizeObserver\r\n    // is preferred so we catch changes from host, where window may not resize.\r\n    let observer = null;\r\n    if (canvas && \"ResizeObserver\" in window) {\r\n        observer = new window.ResizeObserver(() => {\r\n            updateWysiwygStyle();\r\n        });\r\n        observer.observe(canvas);\r\n    }\r\n    else {\r\n        window.addEventListener(\"resize\", updateWysiwygStyle);\r\n    }\r\n    window.addEventListener(\"pointerdown\", onPointerDown);\r\n    window.addEventListener(\"wheel\", stopEvent, {\r\n        passive: false,\r\n        capture: true,\r\n    });\r\n    excalidrawContainer\r\n        ?.querySelector(\".excalidraw-textEditorContainer\")\r\n        .appendChild(editable);\r\n};\r\n","import { measureText, getFontString } from \"../utils\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nexport const redrawTextBoundingBox = (element) => {\r\n    const metrics = measureText(element.text, getFontString(element));\r\n    mutateElement(element, {\r\n        width: metrics.width,\r\n        height: metrics.height,\r\n        baseline: metrics.baseline,\r\n    });\r\n};\r\n","import { getSelectedElements } from \"../scene\";\r\nexport const showSelectedShapeActions = (appState, elements) => Boolean(!appState.viewModeEnabled &&\r\n    (appState.editingElement ||\r\n        getSelectedElements(elements, appState).length ||\r\n        appState.elementType !== \"selection\"));\r\n","import { isInvisiblySmallElement } from \"./sizeHelpers\";\r\nimport { isLinearElementType } from \"./typeChecks\";\r\nexport { newElement, newTextElement, updateTextElement, newLinearElement, newImageElement, duplicateElement, } from \"./newElement\";\r\nexport { getElementAbsoluteCoords, getElementBounds, getCommonBounds, getDiamondPoints, getArrowheadPoints, getClosestElementBounds, } from \"./bounds\";\r\nexport { OMIT_SIDES_FOR_MULTIPLE_ELEMENTS, getTransformHandlesFromCoords, getTransformHandles, } from \"./transformHandles\";\r\nexport { hitTest, isHittingElementBoundingBoxWithoutHittingElement, } from \"./collision\";\r\nexport { resizeTest, getCursorForResizingElement, getElementWithTransformHandleType, getTransformHandleTypeFromCoords, } from \"./resizeTest\";\r\nexport { transformElements, getResizeOffsetXY, getResizeArrowDirection, } from \"./resizeElements\";\r\nexport { dragSelectedElements, getDragOffsetXY, dragNewElement, } from \"./dragElements\";\r\nexport { isTextElement, isExcalidrawElement } from \"./typeChecks\";\r\nexport { textWysiwyg } from \"./textWysiwyg\";\r\nexport { redrawTextBoundingBox } from \"./textElement\";\r\nexport { getPerfectElementSize, isInvisiblySmallElement, resizePerfectLineForNWHandler, getNormalizedDimensions, } from \"./sizeHelpers\";\r\nexport { showSelectedShapeActions } from \"./showSelectedShapeActions\";\r\nexport const getElementMap = (elements) => elements.reduce((acc, element) => {\r\n    acc[element.id] = element;\r\n    return acc;\r\n}, {});\r\nexport const getSceneVersion = (elements) => elements.reduce((acc, el) => acc + el.version, 0);\r\nexport const getVisibleElements = (elements) => elements.filter((el) => !el.isDeleted && !isInvisiblySmallElement(el));\r\nexport const getNonDeletedElements = (elements) => elements.filter((element) => !element.isDeleted);\r\nexport const isNonDeletedElement = (element) => !element.isDeleted;\r\nconst _clearElements = (elements) => getNonDeletedElements(elements).map((element) => isLinearElementType(element.type)\r\n    ? { ...element, lastCommittedPoint: null }\r\n    : element);\r\nexport const clearElementsForDatabase = (elements) => _clearElements(elements);\r\nexport const clearElementsForExport = (elements) => _clearElements(elements);\r\nexport const clearElementsForLocalStorage = (elements) => _clearElements(elements);\r\n","import { getCommonBounds } from \"../element\";\r\nimport { getGlobalCSSVariable } from \"../utils\";\r\nimport { getLanguage } from \"../i18n\";\r\nexport const SCROLLBAR_MARGIN = 4;\r\nexport const SCROLLBAR_WIDTH = 6;\r\nexport const SCROLLBAR_COLOR = \"rgba(0,0,0,0.3)\";\r\nexport const getScrollBars = (elements, viewportWidth, viewportHeight, { scrollX, scrollY, zoom, }) => {\r\n    if (elements.length === 0) {\r\n        return {\r\n            horizontal: null,\r\n            vertical: null,\r\n        };\r\n    }\r\n    // This is the bounding box of all the elements\r\n    const [elementsMinX, elementsMinY, elementsMaxX, elementsMaxY] = getCommonBounds(elements);\r\n    // Apply zoom\r\n    const viewportWidthWithZoom = viewportWidth / zoom.value;\r\n    const viewportHeightWithZoom = viewportHeight / zoom.value;\r\n    const viewportWidthDiff = viewportWidth - viewportWidthWithZoom;\r\n    const viewportHeightDiff = viewportHeight - viewportHeightWithZoom;\r\n    const safeArea = {\r\n        top: parseInt(getGlobalCSSVariable(\"sat\")),\r\n        bottom: parseInt(getGlobalCSSVariable(\"sab\")),\r\n        left: parseInt(getGlobalCSSVariable(\"sal\")),\r\n        right: parseInt(getGlobalCSSVariable(\"sar\")),\r\n    };\r\n    const isRTL = getLanguage().rtl;\r\n    // The viewport is the rectangle currently visible for the user\r\n    const viewportMinX = -scrollX + viewportWidthDiff / 2 + safeArea.left;\r\n    const viewportMinY = -scrollY + viewportHeightDiff / 2 + safeArea.top;\r\n    const viewportMaxX = viewportMinX + viewportWidthWithZoom - safeArea.right;\r\n    const viewportMaxY = viewportMinY + viewportHeightWithZoom - safeArea.bottom;\r\n    // The scene is the bounding box of both the elements and viewport\r\n    const sceneMinX = Math.min(elementsMinX, viewportMinX);\r\n    const sceneMinY = Math.min(elementsMinY, viewportMinY);\r\n    const sceneMaxX = Math.max(elementsMaxX, viewportMaxX);\r\n    const sceneMaxY = Math.max(elementsMaxY, viewportMaxY);\r\n    // The scrollbar represents where the viewport is in relationship to the scene\r\n    return {\r\n        horizontal: viewportMinX === sceneMinX && viewportMaxX === sceneMaxX\r\n            ? null\r\n            : {\r\n                x: Math.max(safeArea.left, SCROLLBAR_MARGIN) +\r\n                    ((viewportMinX - sceneMinX) / (sceneMaxX - sceneMinX)) *\r\n                        viewportWidth,\r\n                y: viewportHeight -\r\n                    SCROLLBAR_WIDTH -\r\n                    Math.max(SCROLLBAR_MARGIN, safeArea.bottom),\r\n                width: ((viewportMaxX - viewportMinX) / (sceneMaxX - sceneMinX)) *\r\n                    viewportWidth -\r\n                    Math.max(SCROLLBAR_MARGIN * 2, safeArea.left + safeArea.right),\r\n                height: SCROLLBAR_WIDTH,\r\n            },\r\n        vertical: viewportMinY === sceneMinY && viewportMaxY === sceneMaxY\r\n            ? null\r\n            : {\r\n                x: isRTL\r\n                    ? Math.max(safeArea.left, SCROLLBAR_MARGIN)\r\n                    : viewportWidth -\r\n                        SCROLLBAR_WIDTH -\r\n                        Math.max(safeArea.right, SCROLLBAR_MARGIN),\r\n                y: ((viewportMinY - sceneMinY) / (sceneMaxY - sceneMinY)) *\r\n                    viewportHeight +\r\n                    Math.max(safeArea.top, SCROLLBAR_MARGIN),\r\n                width: SCROLLBAR_WIDTH,\r\n                height: ((viewportMaxY - viewportMinY) / (sceneMaxY - sceneMinY)) *\r\n                    viewportHeight -\r\n                    Math.max(SCROLLBAR_MARGIN * 2, safeArea.top + safeArea.bottom),\r\n            },\r\n    };\r\n};\r\nexport const isOverScrollBars = (scrollBars, x, y) => {\r\n    const [isOverHorizontal, isOverVertical] = [\r\n        scrollBars.horizontal,\r\n        scrollBars.vertical,\r\n    ].map((scrollBar) => {\r\n        return (scrollBar != null &&\r\n            scrollBar.x <= x &&\r\n            x <= scrollBar.x + scrollBar.width &&\r\n            scrollBar.y <= y &&\r\n            y <= scrollBar.y + scrollBar.height);\r\n    });\r\n    const isOverEither = isOverHorizontal || isOverVertical;\r\n    return { isOverEither, isOverHorizontal, isOverVertical };\r\n};\r\n","import { getElementAbsoluteCoords, getElementBounds } from \"../element\";\r\nexport const getElementsWithinSelection = (elements, selection) => {\r\n    const [selectionX1, selectionY1, selectionX2, selectionY2] = getElementAbsoluteCoords(selection);\r\n    return elements.filter((element) => {\r\n        const [elementX1, elementY1, elementX2, elementY2] = getElementBounds(element);\r\n        return (element.type !== \"selection\" &&\r\n            selectionX1 <= elementX1 &&\r\n            selectionY1 <= elementY1 &&\r\n            selectionX2 >= elementX2 &&\r\n            selectionY2 >= elementY2);\r\n    });\r\n};\r\nexport const isSomeElementSelected = (elements, appState) => elements.some((element) => appState.selectedElementIds[element.id]);\r\n/**\r\n * Returns common attribute (picked by `getAttribute` callback) of selected\r\n *  elements. If elements don't share the same value, returns `null`.\r\n */\r\nexport const getCommonAttributeOfSelectedElements = (elements, appState, getAttribute) => {\r\n    const attributes = Array.from(new Set(getSelectedElements(elements, appState).map((element) => getAttribute(element))));\r\n    return attributes.length === 1 ? attributes[0] : null;\r\n};\r\nexport const getSelectedElements = (elements, appState) => elements.filter((element) => appState.selectedElementIds[element.id]);\r\nexport const getTargetElements = (elements, appState) => appState.editingElement\r\n    ? [appState.editingElement]\r\n    : getSelectedElements(elements, appState);\r\n","import { getCommonBounds, getClosestElementBounds, getVisibleElements, } from \"../element\";\r\nimport { sceneCoordsToViewportCoords, viewportCoordsToSceneCoords, } from \"../utils\";\r\nconst isOutsideViewPort = (appState, canvas, cords) => {\r\n    const [x1, y1, x2, y2] = cords;\r\n    const { x: viewportX1, y: viewportY1 } = sceneCoordsToViewportCoords({ sceneX: x1, sceneY: y1 }, appState);\r\n    const { x: viewportX2, y: viewportY2 } = sceneCoordsToViewportCoords({ sceneX: x2, sceneY: y2 }, appState);\r\n    return (viewportX2 - viewportX1 > appState.width ||\r\n        viewportY2 - viewportY1 > appState.height);\r\n};\r\nexport const centerScrollOn = ({ scenePoint, viewportDimensions, zoom, }) => {\r\n    return {\r\n        scrollX: (viewportDimensions.width / 2) * (1 / zoom.value) -\r\n            scenePoint.x -\r\n            zoom.translation.x * (1 / zoom.value),\r\n        scrollY: (viewportDimensions.height / 2) * (1 / zoom.value) -\r\n            scenePoint.y -\r\n            zoom.translation.y * (1 / zoom.value),\r\n    };\r\n};\r\nexport const calculateScrollCenter = (elements, appState, canvas) => {\r\n    elements = getVisibleElements(elements);\r\n    if (!elements.length) {\r\n        return {\r\n            scrollX: 0,\r\n            scrollY: 0,\r\n        };\r\n    }\r\n    let [x1, y1, x2, y2] = getCommonBounds(elements);\r\n    if (isOutsideViewPort(appState, canvas, [x1, y1, x2, y2])) {\r\n        [x1, y1, x2, y2] = getClosestElementBounds(elements, viewportCoordsToSceneCoords({ clientX: appState.scrollX, clientY: appState.scrollY }, appState));\r\n    }\r\n    const centerX = (x1 + x2) / 2;\r\n    const centerY = (y1 + y2) / 2;\r\n    return centerScrollOn({\r\n        scenePoint: { x: centerX, y: centerY },\r\n        viewportDimensions: { width: appState.width, height: appState.height },\r\n        zoom: appState.zoom,\r\n    });\r\n};\r\n","import { getElementAbsoluteCoords } from \"../element\";\r\nexport const hasBackground = (type) => type === \"rectangle\" ||\r\n    type === \"ellipse\" ||\r\n    type === \"diamond\" ||\r\n    type === \"line\";\r\nexport const hasStrokeColor = (type) => type !== \"image\";\r\nexport const hasStrokeWidth = (type) => type === \"rectangle\" ||\r\n    type === \"ellipse\" ||\r\n    type === \"diamond\" ||\r\n    type === \"freedraw\" ||\r\n    type === \"arrow\" ||\r\n    type === \"line\";\r\nexport const hasStrokeStyle = (type) => type === \"rectangle\" ||\r\n    type === \"ellipse\" ||\r\n    type === \"diamond\" ||\r\n    type === \"arrow\" ||\r\n    type === \"line\";\r\nexport const canChangeSharpness = (type) => type === \"rectangle\" || type === \"arrow\" || type === \"line\";\r\nexport const hasText = (type) => type === \"text\";\r\nexport const canHaveArrowheads = (type) => type === \"arrow\";\r\nexport const getElementAtPosition = (elements, isAtPositionFn) => {\r\n    let hitElement = null;\r\n    // We need to to hit testing from front (end of the array) to back (beginning of the array)\r\n    // because array is ordered from lower z-index to highest and we want element z-index\r\n    // with higher z-index\r\n    for (let index = elements.length - 1; index >= 0; --index) {\r\n        const element = elements[index];\r\n        if (element.isDeleted) {\r\n            continue;\r\n        }\r\n        if (isAtPositionFn(element)) {\r\n            hitElement = element;\r\n            break;\r\n        }\r\n    }\r\n    return hitElement;\r\n};\r\nexport const getElementsAtPosition = (elements, isAtPositionFn) => {\r\n    // The parameter elements comes ordered from lower z-index to higher.\r\n    // We want to preserve that order on the returned array.\r\n    return elements.filter((element) => !element.isDeleted && isAtPositionFn(element));\r\n};\r\nexport const getElementContainingPosition = (elements, x, y) => {\r\n    let hitElement = null;\r\n    // We need to to hit testing from front (end of the array) to back (beginning of the array)\r\n    for (let index = elements.length - 1; index >= 0; --index) {\r\n        if (elements[index].isDeleted) {\r\n            continue;\r\n        }\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(elements[index]);\r\n        if (x1 < x && x < x2 && y1 < y && y < y2) {\r\n            hitElement = elements[index];\r\n            break;\r\n        }\r\n    }\r\n    return hitElement;\r\n};\r\n","export const getNewZoom = (newZoomValue, prevZoom, canvasOffset, zoomOnViewportPoint = { x: 0, y: 0 }) => {\r\n    return {\r\n        value: newZoomValue,\r\n        translation: {\r\n            x: zoomOnViewportPoint.x -\r\n                canvasOffset.left -\r\n                (zoomOnViewportPoint.x - canvasOffset.left - prevZoom.translation.x) *\r\n                    (newZoomValue / prevZoom.value),\r\n            y: zoomOnViewportPoint.y -\r\n                canvasOffset.top -\r\n                (zoomOnViewportPoint.y - canvasOffset.top - prevZoom.translation.y) *\r\n                    (newZoomValue / prevZoom.value),\r\n        },\r\n    };\r\n};\r\nexport const getNormalizedZoom = (zoom) => {\r\n    const normalizedZoom = parseFloat(zoom.toFixed(2));\r\n    const clampedZoom = Math.max(0.1, Math.min(normalizedZoom, 10));\r\n    return clampedZoom;\r\n};\r\n","export class CanvasError extends Error {\r\n    constructor(message = \"Couldn't export canvas.\", name = \"CANVAS_ERROR\") {\r\n        super();\r\n        this.name = name;\r\n        this.message = message;\r\n    }\r\n}\r\nexport class AbortError extends DOMException {\r\n    constructor(message = \"Request Aborted\") {\r\n        super(message, \"AbortError\");\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport \"./Spinner.scss\";\r\nconst Spinner = ({ size = \"1em\", circleWidth = 8, }) => {\r\n    return (<div className=\"Spinner\">\r\n      <svg viewBox=\"0 0 100 100\" style={{ width: size, height: size }}>\r\n        <circle cx=\"50\" cy=\"50\" r={50 - circleWidth / 2} strokeWidth={circleWidth} fill=\"none\" strokeMiterlimit=\"10\"/>\r\n      </svg>\r\n    </div>);\r\n};\r\nexport default Spinner;\r\n","import \"./ToolIcon.scss\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nimport { AbortError } from \"../errors\";\r\nimport Spinner from \"./Spinner\";\r\nexport const ToolButton = React.forwardRef((props, ref) => {\r\n    const { id: excalId } = useExcalidrawContainer();\r\n    const innerRef = React.useRef(null);\r\n    React.useImperativeHandle(ref, () => innerRef.current);\r\n    const sizeCn = `ToolIcon_size_${props.size}`;\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const isMountedRef = useRef(true);\r\n    const onClick = async (event) => {\r\n        const ret = \"onClick\" in props && props.onClick?.(event);\r\n        if (ret && \"then\" in ret) {\r\n            try {\r\n                setIsLoading(true);\r\n                await ret;\r\n            }\r\n            catch (error) {\r\n                if (!(error instanceof AbortError)) {\r\n                    throw error;\r\n                }\r\n            }\r\n            finally {\r\n                if (isMountedRef.current) {\r\n                    setIsLoading(false);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    useEffect(() => () => {\r\n        isMountedRef.current = false;\r\n    }, []);\r\n    const lastPointerTypeRef = useRef(null);\r\n    if (props.type === \"button\" || props.type === \"icon\") {\r\n        return (<button className={clsx(\"ToolIcon_type_button\", sizeCn, props.className, props.visible && !props.hidden\r\n                ? \"ToolIcon_type_button--show\"\r\n                : \"ToolIcon_type_button--hide\", {\r\n                ToolIcon: !props.hidden,\r\n                \"ToolIcon--selected\": props.selected,\r\n                \"ToolIcon--plain\": props.type === \"icon\",\r\n            })} data-testid={props[\"data-testid\"]} hidden={props.hidden} title={props.title} aria-label={props[\"aria-label\"]} type=\"button\" onClick={onClick} ref={innerRef} disabled={isLoading}>\r\n        {(props.icon || props.label) && (<div className=\"ToolIcon__icon\" aria-hidden=\"true\">\r\n            {props.icon || props.label}\r\n            {props.keyBindingLabel && (<span className=\"ToolIcon__keybinding\">\r\n                {props.keyBindingLabel}\r\n              </span>)}\r\n          </div>)}\r\n        {props.showAriaLabel && (<div className=\"ToolIcon__label\">\r\n            {props[\"aria-label\"]} {isLoading && <Spinner />}\r\n          </div>)}\r\n        {props.children}\r\n      </button>);\r\n    }\r\n    return (<label className={clsx(`ToolIcon ${props.title}`, props.className)} title={props.title} onPointerDown={(event) => {\r\n            lastPointerTypeRef.current = event.pointerType || null;\r\n        }} onPointerUp={() => {\r\n            requestAnimationFrame(() => {\r\n                lastPointerTypeRef.current = null;\r\n            });\r\n        }}>\r\n      <input className={`ToolIcon_type_radio ${sizeCn} ${props[\"aria-label\"]}`} type=\"radio\" name={props.name} aria-label={props[\"aria-label\"]} aria-keyshortcuts={props[\"aria-keyshortcuts\"]} data-testid={props[\"data-testid\"]} id={`${excalId}-${props.id}`} onChange={() => {\r\n            props.onChange?.({ pointerType: lastPointerTypeRef.current });\r\n        }} checked={props.checked} ref={innerRef}/>\r\n      <div className = {`ToolIcon__icon ${props[\"aria-label\"]}`}>\r\n        {props.icon}\r\n        {props.keyBindingLabel && (<span className=\"ToolIcon__keybinding\">{props.keyBindingLabel}</span>)}\r\n      </div>\r\n    </label>);\r\n});\r\nToolButton.defaultProps = {\r\n    visible: true,\r\n    className: \"\",\r\n    size: \"medium\",\r\n};\r\n","//\r\n// All icons are imported from https://fontawesome.com/icons?d=gallery\r\n// Icons are under the license https://fontawesome.com/license\r\n//\r\n// Note: when adding new icons, review https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/RTL_Guidelines\r\n// to determine whether or not the icons should be mirrored in right-to-left languages.\r\nimport React from \"react\";\r\nimport oc from \"open-color\";\r\nimport clsx from \"clsx\";\r\nimport { THEME } from \"../constants\";\r\nconst activeElementColor = (theme) => theme === THEME.LIGHT ? oc.orange[4] : oc.orange[9];\r\nconst iconFillColor = (theme) => theme === THEME.LIGHT ? oc.black : oc.gray[4];\r\nconst handlerColor = (theme) => theme === THEME.LIGHT ? oc.white : \"#1e1e1e\";\r\nexport const createIcon = (d, opts = 512) => {\r\n    const { width = 512, height = width, mirror, style, } = typeof opts === \"number\" ? { width: opts } : opts;\r\n    return (<svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox={`0 0 ${width} ${height}`} className={clsx({ \"rtl-mirror\": mirror })} style={style}>\r\n      {typeof d === \"string\" ? <path fill=\"currentColor\" d={d}/> : d}\r\n    </svg>);\r\n};\r\nexport const checkIcon = createIcon(<polyline fill=\"none\" stroke=\"currentColor\" points=\"20 6 9 17 4 12\"/>, {\r\n    width: 24,\r\n    height: 24,\r\n});\r\nexport const link = createIcon(\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\", { mirror: true });\r\nexport const save = createIcon(\"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z\", { width: 448, height: 512 });\r\nexport const saveAs = createIcon(\"M252 54L203 8a28 27 0 00-20-8H28C12 0 0 12 0 27v195c0 15 12 26 28 26h204c15 0 28-11 28-26V73a28 27 0 00-8-19zM130 213c-21 0-37-16-37-36 0-19 16-35 37-35 20 0 37 16 37 35 0 20-17 36-37 36zm56-169v56c0 4-4 6-7 6H44c-4 0-7-2-7-6V42c0-4 3-7 7-7h133l4 2 3 2a7 7 0 012 5z M296 201l87 95-188 205-78 9c-10 1-19-8-18-20l9-84zm141-14l-41-44a31 31 0 00-46 0l-38 41 87 95 38-42c13-14 13-36 0-50z\", { width: 448, height: 512 });\r\nexport const load = createIcon(\"M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z\", { width: 576, height: 512, mirror: true });\r\nexport const clipboard = createIcon(\"M384 112v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h80c0-35.29 28.71-64 64-64s64 28.71 64 64h80c26.51 0 48 21.49 48 48zM192 40c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24m96 114v-20a6 6 0 0 0-6-6H102a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h180a6 6 0 0 0 6-6z\", { width: 384, height: 512 });\r\nexport const trash = createIcon(\"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\", { width: 448, height: 512 });\r\nexport const palette = createIcon(\"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z\");\r\nexport const exportFile = createIcon(\"M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z\", { width: 576, height: 512, mirror: true });\r\nexport const exportImage = createIcon(<>\r\n    <path d=\"M571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-187 44v-64 64z\"/>\r\n    <path d=\"M384 121.941V128H256V0h6.059c6.362 0 12.471 2.53 16.97 7.029l97.941 97.941a24.01 24.01 0 017.03 16.971zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zm-135.455 16c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.491-48 48-48zm208 240h-256l.485-48.485L104.545 328c4.686-4.686 11.799-4.201 16.485.485L160.545 368 264.06 264.485c4.686-4.686 12.284-4.686 16.971 0L320.545 304v112z\"/>\r\n  </>, { width: 576, height: 512, mirror: true });\r\nexport const exportToFileIcon = createIcon(\"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z\", { width: 512, height: 512 });\r\nexport const zoomIn = createIcon(\"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\", { width: 448, height: 512 });\r\nexport const zoomOut = createIcon(\"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\", { width: 448, height: 512 });\r\nexport const done = createIcon(\"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z\");\r\nexport const menu = createIcon(\"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z\");\r\nexport const undo = createIcon(\"M255.545 8c-66.269.119-126.438 26.233-170.86 68.685L48.971 40.971C33.851 25.851 8 36.559 8 57.941V192c0 13.255 10.745 24 24 24h134.059c21.382 0 32.09-25.851 16.971-40.971l-41.75-41.75c30.864-28.899 70.801-44.907 113.23-45.273 92.398-.798 170.283 73.977 169.484 169.442C423.236 348.009 349.816 424 256 424c-41.127 0-79.997-14.678-110.63-41.556-4.743-4.161-11.906-3.908-16.368.553L89.34 422.659c-4.872 4.872-4.631 12.815.482 17.433C133.798 479.813 192.074 504 256 504c136.966 0 247.999-111.033 248-247.998C504.001 119.193 392.354 7.755 255.545 8z\", { mirror: true });\r\nexport const redo = createIcon(\"M256.455 8c66.269.119 126.437 26.233 170.859 68.685l35.715-35.715C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.75c-30.864-28.899-70.801-44.907-113.23-45.273-92.398-.798-170.283 73.977-169.484 169.442C88.764 348.009 162.184 424 256 424c41.127 0 79.997-14.678 110.629-41.556 4.743-4.161 11.906-3.908 16.368.553l39.662 39.662c4.872 4.872 4.631 12.815-.482 17.433C378.202 479.813 319.926 504 256 504 119.034 504 8.001 392.967 8 256.002 7.999 119.193 119.646 7.755 256.455 8z\", { mirror: true });\r\nexport const questionCircle = createIcon(\"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z\", { mirror: true });\r\nexport const share = createIcon(\"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z\", { width: 24, height: 24 });\r\nexport const shareIOS = createIcon(\"M16 5l-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z\", { width: 24, height: 24 });\r\nexport const shareWindows = createIcon(<>\r\n    <path stroke=\"currentColor\" fill=\"currentColor\" d=\"M40 5.6v6.1l-4.1.7c-8.9 1.4-16.5 6.9-20.6 15C13 32 10.9 43 12.4 43c.4 0 2.4-1.3 4.4-3 5-3.9 12.1-7 18.2-7.7l5-.6v12.8l11.2-11.3L62.5 22 51.2 10.8 40-.5v6.1zm10.2 22.6L44 34.5v-6.8l-6.9.6c-3.9.3-9.8 1.7-13.2 3.1-3.5 1.4-6.5 2.4-6.7 2.2-.9-1 3-7.5 6.4-10.8C28 18.6 34.4 16 40.1 16c3.7 0 3.9-.1 3.9-3.2V9.5l6.2 6.3 6.3 6.2-6.3 6.2z\"/>\r\n    <path stroke=\"currentColor\" fill=\"currentColor\" d=\"M0 36v20h48v-6.2c0-6 0-6.1-2-4.3-1.1 1-2 2.9-2 4.2V52H4V34c0-17.3-.1-18-2-18s-2 .7-2 20z\"/>\r\n  </>, { width: 64, height: 64 });\r\n// Icon imported form Storybook\r\n// Storybook is licensed under MIT https://github.com/storybookjs/storybook/blob/next/LICENSE\r\nexport const resetZoom = createIcon(<path stroke=\"currentColor\" strokeWidth=\"40\" fill=\"currentColor\" d=\"M148 560a318 318 0 0 0 522 110 316 316 0 0 0 0-450 316 316 0 0 0-450 0c-11 11-21 22-30 34v4h47c25 0 46 21 46 46s-21 45-46 45H90c-13 0-25-6-33-14-9-9-14-20-14-33V156c0-25 20-45 45-45s45 20 45 45v32l1 1a401 401 0 0 1 623 509l212 212a42 42 0 0 1-59 59L698 757A401 401 0 0 1 65 570a42 42 0 0 1 83-10z\"/>, { width: 1024 });\r\nexport const BringForwardIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M22 9.556C22 8.696 21.303 8 20.444 8H16v8H8v4.444C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const SendBackwardIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M22 9.556C22 8.696 21.303 8 20.444 8H9.556C8.696 8 8 8.697 8 9.556v10.888C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const BringToFrontIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M13 21a1 1 0 001 1h7a1 1 0 001-1v-7a1 1 0 00-1-1h-3v5h-5v3zM11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h3V6h5V3z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const SendToBackIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h8V3zM22 14a1 1 0 00-1-1h-7a1 1 0 00-1 1v7a1 1 0 001 1h8v-8z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\n//\r\n// Align action icons created from scratch to match those of z-index actions\r\n// Note: vertical align icons are flipped so the larger item is always the\r\n// first one the user sees. Horizontal align icons should not be flipped since\r\n// that would make them lie about their function.\r\n//\r\nexport const AlignTopIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 2,5 H 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"M 6,7 C 5.446,7 5,7.446 5,8 v 9.999992 c 0,0.554 0.446,1 1,1 h 3.0000001 c 0.554,0 0.9999999,-0.446 0.9999999,-1 V 8 C 10,7.446 9.5540001,7 9.0000001,7 Z m 9,0 c -0.554,0 -1,0.446 -1,1 v 5.999992 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 V 8 C 19,7.446 18.554,7 18,7 Z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const AlignBottomIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 2,19 H 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"m 6,16.999992 c -0.554,0 -1,-0.446 -1,-1 V 6 C 5,5.446 5.446,5 6,5 H 9.0000001 C 9.5540001,5 10,5.446 10,6 v 9.999992 c 0,0.554 -0.4459999,1 -0.9999999,1 z m 9,0 c -0.554,0 -1,-0.446 -1,-1 V 10 c 0,-0.554 0.446,-1 1,-1 h 3 c 0.554,0 1,0.446 1,1 v 5.999992 c 0,0.554 -0.446,1 -1,1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const AlignLeftIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 5,2 V 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"m 7.000004,5.999996 c 0,-0.554 0.446,-1 1,-1 h 9.999992 c 0.554,0 1,0.446 1,1 v 3.0000001 c 0,0.554 -0.446,0.9999999 -1,0.9999999 H 8.000004 c -0.554,0 -1,-0.4459999 -1,-0.9999999 z m 0,9 c 0,-0.554 0.446,-1 1,-1 h 5.999992 c 0.554,0 1,0.446 1,1 v 3 c 0,0.554 -0.446,1 -1,1 H 8.000004 c -0.554,0 -1,-0.446 -1,-1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24 }));\r\nexport const AlignRightIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 19,2 V 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"m 16.999996,5.999996 c 0,-0.554 -0.446,-1 -1,-1 H 6.000004 c -0.554,0 -1,0.446 -1,1 v 3.0000001 c 0,0.554 0.446,0.9999999 1,0.9999999 h 9.999992 c 0.554,0 1,-0.4459999 1,-0.9999999 z m 0,9 c 0,-0.554 -0.446,-1 -1,-1 h -5.999992 c -0.554,0 -1,0.446 -1,1 v 3 c 0,0.554 0.446,1 1,1 h 5.999992 c 0.554,0 1,-0.446 1,-1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24 }));\r\nexport const DistributeHorizontallyIcon = React.memo(({ theme }) => createIcon(<>\r\n        <path d=\"M19 5V19M5 5V19\" stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n        <path d=\"M15 9C15.554 9 16 9.446 16 10V14C16 14.554 15.554 15 15 15H9C8.446 15 8 14.554 8 14V10C8 9.446 8.446 9 9 9H15Z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      </>, { width: 24 }));\r\nexport const DistributeVerticallyIcon = React.memo(({ theme }) => createIcon(<>\r\n        <path d=\"M5 5L19 5M5 19H19\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n        <path d=\"M15 9C15.554 9 16 9.446 16 10V14C16 14.554 15.554 15 15 15H9C8.446 15 8 14.554 8 14V10C8 9.446 8.446 9 9 9H15Z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      </>, { width: 24 }));\r\nexport const CenterVerticallyIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"m 5.000004,16.999996 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 v -10 c 0,-0.554 -0.446,-1 -1,-1 h -3 c -0.554,0 -1,0.446 -1,1 z m 9,-2 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 v -6 c 0,-0.554 -0.446,-1 -1,-1 h -3 c -0.554,0 -1,0.446 -1,1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M 2,12 H 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeDasharray=\"1, 2.8\" strokeLinecap=\"round\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const CenterHorizontallyIcon = React.memo(({ theme }) => createIcon(<>\r\n        <path d=\"M 7 5 C 6.446 5 6 5.446 6 6 L 6 9 C 6 9.554 6.446 10 7 10 L 17 10 C 17.554 10 18 9.554 18 9 L 18 6 C 18 5.446 17.554 5 17 5 L 7 5 z M 9 14 C 8.446 14 8 14.446 8 15 L 8 18 C 8 18.554 8.446 19 9 19 L 15 19 C 15.554 19 16 18.554 16 18 L 16 15 C 16 14.446 15.554 14 15 14 L 9 14 z \" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n        <path d=\"M 12,2 V 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeDasharray=\"1, 2.8\" strokeLinecap=\"round\"/>\r\n      </>, { width: 24 }));\r\nexport const users = createIcon(\"M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z\", { width: 640, height: 512, mirror: true });\r\n// not mirrored because it's inspired by a playback control, which is always RTL\r\nexport const start = createIcon(\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z\");\r\nexport const stop = createIcon(\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm96 328c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h160c8.8 0 16 7.2 16 16v160z\");\r\nexport const close = createIcon(\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\", { width: 352, height: 512 });\r\nexport const back = createIcon(\"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z\", { width: 320, height: 512, style: { marginLeft: \"-0.2rem\" }, mirror: true });\r\nexport const clone = createIcon(\"M464 0c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48H176c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h288M176 416c-44.112 0-80-35.888-80-80V128H48c-26.51 0-48 21.49-48 48v288c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48v-48H176z\", { mirror: true });\r\n// modified https://feathericons.com/?query=shield\r\nexport const shield = createIcon(\"M11.553 22.894a.998.998 0 00.894 0s3.037-1.516 5.465-4.097C19.616 16.987 21 14.663 21 12V5a1 1 0 00-.649-.936l-8-3a.998.998 0 00-.702 0l-8 3A1 1 0 003 5v7c0 2.663 1.384 4.987 3.088 6.797 2.428 2.581 5.465 4.097 5.465 4.097zm-1.303-8.481l6.644-6.644a.856.856 0 111.212 1.212l-7.25 7.25a.856.856 0 01-1.212 0l-3.75-3.75a.856.856 0 111.212-1.212l3.144 3.144z\", { width: 24 });\r\nexport const file = createIcon(\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm32-48h224V288l-23.5-23.5c-4.7-4.7-12.3-4.7-17 0L176 352l-39.5-39.5c-4.7-4.7-12.3-4.7-17 0L80 352v64zm48-240c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z\", { width: 384, height: 512 });\r\nexport const GroupIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M25 26H111V111H25\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M25 111C25 80.2068 25 49.4135 25 26M25 26C48.6174 26 72.2348 26 111 26H25ZM25 26C53.3671 26 81.7343 26 111 26H25ZM111 26C111 52.303 111 78.606 111 111V26ZM111 26C111 51.2947 111 76.5893 111 111V26ZM111 111C87.0792 111 63.1585 111 25 111H111ZM111 111C87.4646 111 63.9293 111 25 111H111ZM25 111C25 81.1514 25 51.3028 25 26V111Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M100 100H160V160H100\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M100 160C100 144.106 100 128.211 100 100M100 100C117.706 100 135.412 100 160 100H100ZM100 100C114.214 100 128.428 100 160 100H100ZM160 100C160 120.184 160 140.369 160 160V100ZM160 100C160 113.219 160 126.437 160 160V100ZM160 160C145.534 160 131.068 160 100 160H160ZM160 160C143.467 160 126.934 160 100 160H160ZM100 160C100 143.661 100 127.321 100 100V160Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <g fill={handlerColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"6\">\r\n        <rect x=\"2.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"2.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n      </g>\r\n    </>, { width: 182, height: 182, mirror: true }));\r\nexport const UngroupIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M25 26H111V111H25\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M25 111C25 80.2068 25 49.4135 25 26M25 26C48.6174 26 72.2348 26 111 26H25ZM25 26C53.3671 26 81.7343 26 111 26H25ZM111 26C111 52.303 111 78.606 111 111V26ZM111 26C111 51.2947 111 76.5893 111 111V26ZM111 111C87.0792 111 63.1585 111 25 111H111ZM111 111C87.4646 111 63.9293 111 25 111H111ZM25 111C25 81.1514 25 51.3028 25 26V111Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M100 100H160V160H100\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M100 160C100 144.106 100 128.211 100 100M100 100C117.706 100 135.412 100 160 100H100ZM100 100C114.214 100 128.428 100 160 100H100ZM160 100C160 120.184 160 140.369 160 160V100ZM160 100C160 113.219 160 126.437 160 160V100ZM160 160C145.534 160 131.068 160 100 160H160ZM160 160C143.467 160 126.934 160 100 160H160ZM100 160C100 143.661 100 127.321 100 100V160Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <g fill={handlerColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"6\">\r\n        <rect x=\"2.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"78.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"78.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"105.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"2.5\" y=\"102.5\" width=\"30\" height=\"30\"/>\r\n      </g>\r\n    </>, { width: 182, height: 182, mirror: true }));\r\nexport const FillHachureIcon = React.memo(({ theme }) => createIcon(<path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M20.101 16H28.0934L36 8.95989V4H33.5779L20.101 16ZM30.5704 4L17.0935 16H9.10101L22.5779 4H30.5704ZM19.5704 4L6.09349 16H4V10.7475L11.5779 4H19.5704ZM8.57036 4H4V8.06952L8.57036 4ZM36 11.6378L31.101 16H36V11.6378ZM2 2V18H38V2H2Z\" fill={iconFillColor(theme)}/>, { width: 40, height: 20 }));\r\nexport const FillCrossHatchIcon = React.memo(({ theme }) => createIcon(<g fill={iconFillColor(theme)} fillRule=\"evenodd\" clipRule=\"evenodd\">\r\n      <path d=\"M20.101 16H28.0934L36 8.95989V4H33.5779L20.101 16ZM30.5704 4L17.0935 16H9.10101L22.5779 4H30.5704ZM19.5704 4L6.09349 16H4V10.7475L11.5779 4H19.5704ZM8.57036 4H4V8.06952L8.57036 4ZM36 11.6378L31.101 16H36V11.6378ZM2 2V18H38V2H2Z\"/>\r\n      <path d=\"M14.0001 18L3.00006 4.00002L4.5727 2.76438L15.5727 16.7644L14.0001 18ZM25.0001 18L14.0001 4.00002L15.5727 2.76438L26.5727 16.7644L25.0001 18ZM36.0001 18L25.0001 4.00002L26.5727 2.76438L37.5727 16.7644L36.0001 18Z\"/>\r\n    </g>, { width: 40, height: 20 }));\r\nexport const FillSolidIcon = React.memo(({ theme }) => createIcon(<path d=\"M2 2H38V18H2V2Z\" fill={iconFillColor(theme)}/>, {\r\n    width: 40,\r\n    height: 20,\r\n}));\r\nexport const StrokeWidthIcon = React.memo(({ theme, strokeWidth }) => createIcon(<path d=\"M6 10H32\" stroke={iconFillColor(theme)} strokeWidth={strokeWidth} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20 }));\r\nexport const StrokeStyleSolidIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H34\" stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\" strokeLinecap=\"round\"/>, {\r\n    width: 40,\r\n    height: 20,\r\n}));\r\nexport const StrokeStyleDashedIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H34\" stroke={iconFillColor(theme)} strokeWidth={2.5} strokeDasharray={\"10, 8\"} fill=\"none\" strokeLinecap=\"round\"/>, { width: 40, height: 20 }));\r\nexport const StrokeStyleDottedIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H36\" stroke={iconFillColor(theme)} strokeWidth={2.5} strokeDasharray={\"2, 4.5\"} fill=\"none\" strokeLinecap=\"round\"/>, { width: 40, height: 20 }));\r\nexport const SloppinessArchitectIcon = React.memo(({ theme }) => createIcon(<path d=\"M3.00098 16.1691C6.28774 13.9744 19.6399 2.8905 22.7215 3.00082C25.8041 3.11113 19.1158 15.5488 21.4962 16.8309C23.8757 18.1131 34.4155 11.7148 37.0001 10.6919\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const SloppinessArtistIcon = React.memo(({ theme }) => createIcon(<path d=\"M3 17C6.68158 14.8752 16.1296 9.09849 22.0648 6.54922C28 3.99995 22.2896 13.3209 25 14C27.7104 14.6791 36.3757 9.6471 36.3757 9.6471M6.40706 15C13 11.1918 20.0468 1.51045 23.0234 3.0052C26 4.49995 20.457 12.8659 22.7285 16.4329C25 20 36.3757 13 36.3757 13\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const SloppinessCartoonistIcon = React.memo(({ theme }) => createIcon(<path d=\"M3 15.6468C6.93692 13.5378 22.5544 2.81528 26.6206 3.00242C30.6877 3.18956 25.6708 15.3346 27.4009 16.7705C29.1309 18.2055 35.4001 12.4762 37 11.6177M3.97143 10.4917C6.61158 9.24563 16.3706 2.61886 19.8104 3.01724C23.2522 3.41472 22.0773 12.2013 24.6181 12.8783C27.1598 13.5536 33.3179 8.04068 35.0571 7.07244\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const EdgeSharpIcon = React.memo(({ theme }) => createIcon(<path d=\"M10 17L10 5L35 5\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const EdgeRoundIcon = React.memo(({ theme }) => createIcon(<path d=\"M10 17V15C10 8 13 5 21 5L33.5 5\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const ArrowheadNoneIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H34\" stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\"/>, {\r\n    width: 40,\r\n    height: 20,\r\n}));\r\nexport const ArrowheadArrowIcon = React.memo(({ theme, flip = false }) => createIcon(<g transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"} stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\">\r\n        <path d=\"M34 10H6M34 10L27 5M34 10L27 15\"/>\r\n        <path d=\"M27.5 5L34.5 10L27.5 15\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const ArrowheadDotIcon = React.memo(({ theme, flip = false }) => createIcon(<g stroke={iconFillColor(theme)} fill={iconFillColor(theme)} transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"}>\r\n        <path d=\"M32 10L6 10\" strokeWidth={2}/>\r\n        <circle r=\"4\" transform=\"matrix(-1 0 0 1 30 10)\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const ArrowheadBarIcon = React.memo(({ theme, flip = false }) => createIcon(<g transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"}>\r\n        <path d=\"M34 10H5.99996M34 10L34 5M34 10L34 15\" stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const ArrowheadTriangleIcon = React.memo(({ theme, flip = false }) => createIcon(<g stroke={iconFillColor(theme)} fill={iconFillColor(theme)} transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"}>\r\n        <path d=\"M32 10L6 10\" strokeWidth={2}/>\r\n        <path d=\"M27.5 5.5L34.5 10L27.5 14.5L27.5 5.5\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const FontSizeSmallIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 0 69.092 L 0 55.03 A 124.24 124.24 0 0 0 4.706 57.02 Q 6.826 57.863 8.708 58.5 A 53.466 53.466 0 0 0 12.231 59.571 Q 17.236 60.889 21.387 60.889 A 20.909 20.909 0 0 0 24.265 60.704 Q 25.719 60.502 26.903 60.077 A 8.649 8.649 0 0 0 29.028 58.985 Q 31.689 57.08 31.689 53.321 Q 31.689 51.221 30.518 49.585 A 10.126 10.126 0 0 0 29.282 48.177 Q 28.352 47.287 27.075 46.436 A 23.719 23.719 0 0 0 25.752 45.627 Q 23.774 44.492 20.176 42.735 A 254.44 254.44 0 0 0 17.822 41.602 Q 11.503 38.631 8.236 35.888 A 19.742 19.742 0 0 1 8.008 35.694 A 22.18 22.18 0 0 1 2.783 29.102 Q 0.83 25.342 0.83 20.313 A 22.471 22.471 0 0 1 1.733 13.778 A 17.283 17.283 0 0 1 7.251 5.42 A 21.486 21.486 0 0 1 15.177 1.272 Q 18.361 0.338 22.166 0.09 A 43.573 43.573 0 0 1 25 0 A 42.399 42.399 0 0 1 34.349 1.01 A 39.075 39.075 0 0 1 35.62 1.319 A 67.407 67.407 0 0 1 42.108 3.382 A 83.357 83.357 0 0 1 46.191 5.03 L 41.309 16.797 Q 35.596 14.453 31.86 13.526 A 30.762 30.762 0 0 0 25.417 12.612 A 28.337 28.337 0 0 0 24.512 12.598 A 14.846 14.846 0 0 0 22.022 12.793 Q 19.498 13.224 17.92 14.6 Q 15.625 16.602 15.625 19.824 Q 15.625 21.826 16.553 23.316 Q 17.48 24.805 19.507 26.197 A 18.343 18.343 0 0 0 20.659 26.912 Q 22.596 28.035 26.516 29.953 A 299.99 299.99 0 0 0 29.102 31.201 Q 37.91 35.412 41.841 39.642 A 16.553 16.553 0 0 1 42.822 40.796 A 17.675 17.675 0 0 1 46.301 49.233 A 23.517 23.517 0 0 1 46.533 52.588 A 21.581 21.581 0 0 1 45.471 59.515 A 17.733 17.733 0 0 1 39.575 67.823 Q 33.745 72.486 24.094 73.243 A 49.683 49.683 0 0 1 20.215 73.389 A 51.712 51.712 0 0 1 9.448 72.315 A 40.672 40.672 0 0 1 0 69.092 Z\"/>, { width: 47, height: 77 }));\r\nexport const FontSizeMediumIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 44.092 71.387 L 30.225 71.387 L 13.037 15.381 L 12.598 15.381 A 1505.093 1505.093 0 0 1 12.959 22.313 Q 13.426 31.715 13.508 36.4 A 102.991 102.991 0 0 1 13.525 38.184 L 13.525 71.387 L 0 71.387 L 0 0 L 20.605 0 L 37.5 54.59 L 37.793 54.59 L 55.713 0 L 76.318 0 L 76.318 71.387 L 62.207 71.387 L 62.207 37.598 Q 62.207 35.205 62.28 32.08 A 160.703 160.703 0 0 1 62.326 30.544 Q 62.452 26.754 62.866 17.168 A 5390.536 5390.536 0 0 1 62.939 15.479 L 62.5 15.479 L 44.092 71.387 Z\"/>, { width: 77, height: 75 }));\r\nexport const FontSizeLargeIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 44.092 71.387 L 0 71.387 L 0 0 L 15.137 0 L 15.137 58.887 L 44.092 58.887 L 44.092 71.387 Z\"/>, { width: 45, height: 75 }));\r\nexport const FontSizeExtraLargeIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 42.578 35.4 L 66.699 71.387 L 49.414 71.387 L 32.813 44.385 L 16.211 71.387 L 0 71.387 L 23.682 34.57 L 1.514 0 L 18.213 0 L 33.594 25.684 L 48.682 0 L 64.99 0 L 42.578 35.4 Z M 119.775 71.387 L 75.684 71.387 L 75.684 0 L 90.82 0 L 90.82 58.887 L 119.775 58.887 L 119.775 71.387 Z\"/>, { width: 120, height: 75 }));\r\nexport const FontFamilyHandDrawnIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z\"/>, { width: 448, height: 512 }));\r\nexport const FontFamilyNormalIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path fill={iconFillColor(theme)} d=\"M 63.818 71.68 L 54.492 71.68 L 45.898 49.561 L 17.578 49.561 L 9.082 71.68 L 0 71.68 L 27.881 0 L 35.986 0 L 63.818 71.68 Z M 20.605 41.602 L 43.213 41.602 L 35.205 19.971 L 31.787 9.277 Q 30.322 15.137 28.711 19.971 L 20.605 41.602 Z\"/>\r\n      <path fill={iconFillColor(theme)} d=\"M 68.994 71.68 L 52.686 71.68 L 47.51 54.688 L 21.484 54.688 L 16.309 71.68 L 0 71.68 L 25.195 0 L 43.701 0 L 68.994 71.68 Z M 25.293 41.992 L 43.896 41.992 A 27590.463 27590.463 0 0 1 42.2 36.532 Q 36.965 19.676 35.937 16.273 A 120.932 120.932 0 0 1 35.815 15.869 A 131.65 131.65 0 0 1 35.396 14.435 Q 34.951 12.879 34.675 11.741 A 34.866 34.866 0 0 1 34.521 11.084 A 141.762 141.762 0 0 1 33.706 14.075 Q 31.482 21.957 25.293 41.992 Z\"/>\r\n    </>, { width: 70, height: 78 }));\r\nexport const FontFamilyCodeIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path fill={iconFillColor(theme)} d=\"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z\"/>\r\n    </>, { width: 640, height: 512 }));\r\nexport const TextAlignLeftIcon = React.memo(({ theme }) => createIcon(<path d=\"M12.83 352h262.34A12.82 12.82 0 00288 339.17v-38.34A12.82 12.82 0 00275.17 288H12.83A12.82 12.82 0 000 300.83v38.34A12.82 12.82 0 0012.83 352zm0-256h262.34A12.82 12.82 0 00288 83.17V44.83A12.82 12.82 0 00275.17 32H12.83A12.82 12.82 0 000 44.83v38.34A12.82 12.82 0 0012.83 96zM432 160H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm0 256H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16z\" fill={iconFillColor(theme)} strokeLinecap=\"round\"/>, { width: 448, height: 512 }));\r\nexport const TextAlignCenterIcon = React.memo(({ theme }) => createIcon(<path d=\"M432 160H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm0 256H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zM108.1 96h231.81A12.09 12.09 0 00352 83.9V44.09A12.09 12.09 0 00339.91 32H108.1A12.09 12.09 0 0096 44.09V83.9A12.1 12.1 0 00108.1 96zm231.81 256A12.09 12.09 0 00352 339.9v-39.81A12.09 12.09 0 00339.91 288H108.1A12.09 12.09 0 0096 300.09v39.81a12.1 12.1 0 0012.1 12.1z\" fill={iconFillColor(theme)}/>, { width: 448, height: 512 }));\r\nexport const TextAlignRightIcon = React.memo(({ theme }) => createIcon(<path d=\"M16 224h416a16 16 0 0016-16v-32a16 16 0 00-16-16H16a16 16 0 00-16 16v32a16 16 0 0016 16zm416 192H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm3.17-384H172.83A12.82 12.82 0 00160 44.83v38.34A12.82 12.82 0 00172.83 96h262.34A12.82 12.82 0 00448 83.17V44.83A12.82 12.82 0 00435.17 32zm0 256H172.83A12.82 12.82 0 00160 300.83v38.34A12.82 12.82 0 00172.83 352h262.34A12.82 12.82 0 00448 339.17v-38.34A12.82 12.82 0 00435.17 288z\" fill={iconFillColor(theme)} strokeLinecap=\"round\"/>, { width: 448, height: 512 }));\r\n","export let actions = [];\r\nexport const register = (action) => {\r\n    actions = actions.concat(action);\r\n    return action;\r\n};\r\n","import { isSomeElementSelected } from \"../scene\";\r\nimport { KEYS } from \"../keys\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { trash } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport { register } from \"./register\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { getElementsInGroup } from \"../groups\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\r\nconst deleteSelectedElements = (elements, appState) => {\r\n    return {\r\n        elements: elements.map((el) => {\r\n            if (appState.selectedElementIds[el.id]) {\r\n                return newElementWith(el, { isDeleted: true });\r\n            }\r\n            return el;\r\n        }),\r\n        appState: {\r\n            ...appState,\r\n            selectedElementIds: {},\r\n        },\r\n    };\r\n};\r\nconst handleGroupEditingState = (appState, elements) => {\r\n    if (appState.editingGroupId) {\r\n        const siblingElements = getElementsInGroup(getNonDeletedElements(elements), appState.editingGroupId);\r\n        if (siblingElements.length) {\r\n            return {\r\n                ...appState,\r\n                selectedElementIds: { [siblingElements[0].id]: true },\r\n            };\r\n        }\r\n    }\r\n    return appState;\r\n};\r\nexport const actionDeleteSelected = register({\r\n    name: \"deleteSelectedElements\",\r\n    perform: (elements, appState) => {\r\n        if (appState.editingLinearElement) {\r\n            const { elementId, activePointIndex, startBindingElement, endBindingElement, } = appState.editingLinearElement;\r\n            const element = LinearElementEditor.getElement(elementId);\r\n            if (!element) {\r\n                return false;\r\n            }\r\n            if (\r\n            // case: no point selected → delete whole element\r\n            activePointIndex == null ||\r\n                activePointIndex === -1 ||\r\n                // case: deleting last remaining point\r\n                element.points.length < 2) {\r\n                const nextElements = elements.filter((el) => el.id !== element.id);\r\n                const nextAppState = handleGroupEditingState(appState, nextElements);\r\n                return {\r\n                    elements: nextElements,\r\n                    appState: {\r\n                        ...nextAppState,\r\n                        editingLinearElement: null,\r\n                    },\r\n                    commitToHistory: false,\r\n                };\r\n            }\r\n            // We cannot do this inside `movePoint` because it is also called\r\n            // when deleting the uncommitted point (which hasn't caused any binding)\r\n            const binding = {\r\n                startBindingElement: activePointIndex === 0 ? null : startBindingElement,\r\n                endBindingElement: activePointIndex === element.points.length - 1\r\n                    ? null\r\n                    : endBindingElement,\r\n            };\r\n            LinearElementEditor.movePoint(element, activePointIndex, \"delete\");\r\n            return {\r\n                elements,\r\n                appState: {\r\n                    ...appState,\r\n                    editingLinearElement: {\r\n                        ...appState.editingLinearElement,\r\n                        ...binding,\r\n                        activePointIndex: activePointIndex > 0 ? activePointIndex - 1 : 0,\r\n                    },\r\n                },\r\n                commitToHistory: true,\r\n            };\r\n        }\r\n        let { elements: nextElements, appState: nextAppState } = deleteSelectedElements(elements, appState);\r\n        fixBindingsAfterDeletion(nextElements, elements.filter(({ id }) => appState.selectedElementIds[id]));\r\n        nextAppState = handleGroupEditingState(nextAppState, nextElements);\r\n        return {\r\n            elements: nextElements,\r\n            appState: {\r\n                ...nextAppState,\r\n                elementType: \"selection\",\r\n                multiElement: null,\r\n            },\r\n            commitToHistory: isSomeElementSelected(getNonDeletedElements(elements), appState),\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.delete\",\r\n    keyTest: (event) => event.key === KEYS.BACKSPACE || event.key === KEYS.DELETE,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton type=\"button\" icon={trash} title={t(\"labels.delete\")} aria-label={t(\"labels.delete\")} onClick={() => updateData(null)} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\n","import { bumpVersion } from \"./element/mutateElement\";\r\nimport { getElementsInGroup } from \"./groups\";\r\nimport { findIndex, findLastIndex } from \"./utils\";\r\n/**\r\n * Returns indices of elements to move based on selected elements.\r\n * Includes contiguous deleted elements that are between two selected elements,\r\n *  e.g.: [0 (selected), 1 (deleted), 2 (deleted), 3 (selected)]\r\n */\r\nconst getIndicesToMove = (elements, appState) => {\r\n    let selectedIndices = [];\r\n    let deletedIndices = [];\r\n    let includeDeletedIndex = null;\r\n    let index = -1;\r\n    while (++index < elements.length) {\r\n        if (appState.selectedElementIds[elements[index].id]) {\r\n            if (deletedIndices.length) {\r\n                selectedIndices = selectedIndices.concat(deletedIndices);\r\n                deletedIndices = [];\r\n            }\r\n            selectedIndices.push(index);\r\n            includeDeletedIndex = index + 1;\r\n        }\r\n        else if (elements[index].isDeleted && includeDeletedIndex === index) {\r\n            includeDeletedIndex = index + 1;\r\n            deletedIndices.push(index);\r\n        }\r\n        else {\r\n            deletedIndices = [];\r\n        }\r\n    }\r\n    return selectedIndices;\r\n};\r\nconst toContiguousGroups = (array) => {\r\n    let cursor = 0;\r\n    return array.reduce((acc, value, index) => {\r\n        if (index > 0 && array[index - 1] !== value - 1) {\r\n            cursor = ++cursor;\r\n        }\r\n        (acc[cursor] || (acc[cursor] = [])).push(value);\r\n        return acc;\r\n    }, []);\r\n};\r\n/**\r\n * Returns next candidate index that's available to be moved to. Currently that\r\n *  is a non-deleted element, and not inside a group (unless we're editing it).\r\n */\r\nconst getTargetIndex = (appState, elements, boundaryIndex, direction) => {\r\n    const sourceElement = elements[boundaryIndex];\r\n    const indexFilter = (element) => {\r\n        if (element.isDeleted) {\r\n            return false;\r\n        }\r\n        // if we're editing group, find closest sibling irrespective of whether\r\n        // there's a different-group element between them (for legacy reasons)\r\n        if (appState.editingGroupId) {\r\n            return element.groupIds.includes(appState.editingGroupId);\r\n        }\r\n        return true;\r\n    };\r\n    const candidateIndex = direction === \"left\"\r\n        ? findLastIndex(elements, indexFilter, Math.max(0, boundaryIndex - 1))\r\n        : findIndex(elements, indexFilter, boundaryIndex + 1);\r\n    const nextElement = elements[candidateIndex];\r\n    if (!nextElement) {\r\n        return -1;\r\n    }\r\n    if (appState.editingGroupId) {\r\n        if (\r\n        // candidate element is a sibling in current editing group → return\r\n        sourceElement?.groupIds.join(\"\") === nextElement?.groupIds.join(\"\")) {\r\n            return candidateIndex;\r\n        }\r\n        else if (!nextElement?.groupIds.includes(appState.editingGroupId)) {\r\n            // candidate element is outside current editing group → prevent\r\n            return -1;\r\n        }\r\n    }\r\n    if (!nextElement.groupIds.length) {\r\n        return candidateIndex;\r\n    }\r\n    const siblingGroupId = appState.editingGroupId\r\n        ? nextElement.groupIds[nextElement.groupIds.indexOf(appState.editingGroupId) - 1]\r\n        : nextElement.groupIds[nextElement.groupIds.length - 1];\r\n    const elementsInSiblingGroup = getElementsInGroup(elements, siblingGroupId);\r\n    if (elementsInSiblingGroup.length) {\r\n        // assumes getElementsInGroup() returned elements are sorted\r\n        // by zIndex (ascending)\r\n        return direction === \"left\"\r\n            ? elements.indexOf(elementsInSiblingGroup[0])\r\n            : elements.indexOf(elementsInSiblingGroup[elementsInSiblingGroup.length - 1]);\r\n    }\r\n    return candidateIndex;\r\n};\r\nconst getTargetElementsMap = (elements, indices) => {\r\n    return indices.reduce((acc, index) => {\r\n        const element = elements[index];\r\n        acc[element.id] = element;\r\n        return acc;\r\n    }, {});\r\n};\r\nconst shiftElements = (appState, elements, direction) => {\r\n    const indicesToMove = getIndicesToMove(elements, appState);\r\n    const targetElementsMap = getTargetElementsMap(elements, indicesToMove);\r\n    let groupedIndices = toContiguousGroups(indicesToMove);\r\n    if (direction === \"right\") {\r\n        groupedIndices = groupedIndices.reverse();\r\n    }\r\n    groupedIndices.forEach((indices, i) => {\r\n        const leadingIndex = indices[0];\r\n        const trailingIndex = indices[indices.length - 1];\r\n        const boundaryIndex = direction === \"left\" ? leadingIndex : trailingIndex;\r\n        const targetIndex = getTargetIndex(appState, elements, boundaryIndex, direction);\r\n        if (targetIndex === -1 || boundaryIndex === targetIndex) {\r\n            return;\r\n        }\r\n        const leadingElements = direction === \"left\"\r\n            ? elements.slice(0, targetIndex)\r\n            : elements.slice(0, leadingIndex);\r\n        const targetElements = elements.slice(leadingIndex, trailingIndex + 1);\r\n        const displacedElements = direction === \"left\"\r\n            ? elements.slice(targetIndex, leadingIndex)\r\n            : elements.slice(trailingIndex + 1, targetIndex + 1);\r\n        const trailingElements = direction === \"left\"\r\n            ? elements.slice(trailingIndex + 1)\r\n            : elements.slice(targetIndex + 1);\r\n        elements =\r\n            direction === \"left\"\r\n                ? [\r\n                    ...leadingElements,\r\n                    ...targetElements,\r\n                    ...displacedElements,\r\n                    ...trailingElements,\r\n                ]\r\n                : [\r\n                    ...leadingElements,\r\n                    ...displacedElements,\r\n                    ...targetElements,\r\n                    ...trailingElements,\r\n                ];\r\n    });\r\n    return elements.map((element) => {\r\n        if (targetElementsMap[element.id]) {\r\n            return bumpVersion(element);\r\n        }\r\n        return element;\r\n    });\r\n};\r\nconst shiftElementsToEnd = (elements, appState, direction) => {\r\n    const indicesToMove = getIndicesToMove(elements, appState);\r\n    const targetElementsMap = getTargetElementsMap(elements, indicesToMove);\r\n    const displacedElements = [];\r\n    let leadingIndex;\r\n    let trailingIndex;\r\n    if (direction === \"left\") {\r\n        if (appState.editingGroupId) {\r\n            const groupElements = getElementsInGroup(elements, appState.editingGroupId);\r\n            if (!groupElements.length) {\r\n                return elements;\r\n            }\r\n            leadingIndex = elements.indexOf(groupElements[0]);\r\n        }\r\n        else {\r\n            leadingIndex = 0;\r\n        }\r\n        trailingIndex = indicesToMove[indicesToMove.length - 1];\r\n    }\r\n    else {\r\n        if (appState.editingGroupId) {\r\n            const groupElements = getElementsInGroup(elements, appState.editingGroupId);\r\n            if (!groupElements.length) {\r\n                return elements;\r\n            }\r\n            trailingIndex = elements.indexOf(groupElements[groupElements.length - 1]);\r\n        }\r\n        else {\r\n            trailingIndex = elements.length - 1;\r\n        }\r\n        leadingIndex = indicesToMove[0];\r\n    }\r\n    for (let index = leadingIndex; index < trailingIndex + 1; index++) {\r\n        if (!indicesToMove.includes(index)) {\r\n            displacedElements.push(elements[index]);\r\n        }\r\n    }\r\n    const targetElements = Object.values(targetElementsMap).map((element) => {\r\n        return bumpVersion(element);\r\n    });\r\n    const leadingElements = elements.slice(0, leadingIndex);\r\n    const trailingElements = elements.slice(trailingIndex + 1);\r\n    return direction === \"left\"\r\n        ? [\r\n            ...leadingElements,\r\n            ...targetElements,\r\n            ...displacedElements,\r\n            ...trailingElements,\r\n        ]\r\n        : [\r\n            ...leadingElements,\r\n            ...displacedElements,\r\n            ...targetElements,\r\n            ...trailingElements,\r\n        ];\r\n};\r\n// public API\r\n// -----------------------------------------------------------------------------\r\nexport const moveOneLeft = (elements, appState) => {\r\n    return shiftElements(appState, elements, \"left\");\r\n};\r\nexport const moveOneRight = (elements, appState) => {\r\n    return shiftElements(appState, elements, \"right\");\r\n};\r\nexport const moveAllLeft = (elements, appState) => {\r\n    return shiftElementsToEnd(elements, appState, \"left\");\r\n};\r\nexport const moveAllRight = (elements, appState) => {\r\n    return shiftElementsToEnd(elements, appState, \"right\");\r\n};\r\n","import React from \"react\";\r\nimport { moveOneLeft, moveOneRight, moveAllLeft, moveAllRight, } from \"../zindex\";\r\nimport { KEYS, isDarwin, CODES } from \"../keys\";\r\nimport { t } from \"../i18n\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nimport { SendBackwardIcon, BringToFrontIcon, SendToBackIcon, BringForwardIcon, } from \"../components/icons\";\r\nexport const actionSendBackward = register({\r\n    name: \"sendBackward\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveOneLeft(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.sendBackward\",\r\n    keyPriority: 40,\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] &&\r\n        !event.shiftKey &&\r\n        event.code === CODES.BRACKET_LEFT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={() => updateData(null)} title={`${t(\"labels.sendBackward\")} — ${getShortcutKey(\"CtrlOrCmd+[\")}`}>\r\n      <SendBackwardIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\nexport const actionBringForward = register({\r\n    name: \"bringForward\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveOneRight(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.bringForward\",\r\n    keyPriority: 40,\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] &&\r\n        !event.shiftKey &&\r\n        event.code === CODES.BRACKET_RIGHT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={() => updateData(null)} title={`${t(\"labels.bringForward\")} — ${getShortcutKey(\"CtrlOrCmd+]\")}`}>\r\n      <BringForwardIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\nexport const actionSendToBack = register({\r\n    name: \"sendToBack\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveAllLeft(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.sendToBack\",\r\n    keyTest: (event) => isDarwin\r\n        ? event[KEYS.CTRL_OR_CMD] &&\r\n            event.altKey &&\r\n            event.code === CODES.BRACKET_LEFT\r\n        : event[KEYS.CTRL_OR_CMD] &&\r\n            event.shiftKey &&\r\n            event.code === CODES.BRACKET_LEFT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={() => updateData(null)} title={`${t(\"labels.sendToBack\")} — ${isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+[\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+[\")}`}>\r\n      <SendToBackIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\nexport const actionBringToFront = register({\r\n    name: \"bringToFront\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveAllRight(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.bringToFront\",\r\n    keyTest: (event) => isDarwin\r\n        ? event[KEYS.CTRL_OR_CMD] &&\r\n            event.altKey &&\r\n            event.code === CODES.BRACKET_RIGHT\r\n        : event[KEYS.CTRL_OR_CMD] &&\r\n            event.shiftKey &&\r\n            event.code === CODES.BRACKET_RIGHT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={(event) => updateData(null)} title={`${t(\"labels.bringToFront\")} — ${isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+]\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+]\")}`}>\r\n      <BringToFrontIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\n","import { KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { selectGroupsForSelectedElements } from \"../groups\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nexport const actionSelectAll = register({\r\n    name: \"selectAll\",\r\n    perform: (elements, appState) => {\r\n        if (appState.editingLinearElement) {\r\n            return false;\r\n        }\r\n        return {\r\n            appState: selectGroupsForSelectedElements({\r\n                ...appState,\r\n                editingGroupId: null,\r\n                selectedElementIds: elements.reduce((map, element) => {\r\n                    if (!element.isDeleted) {\r\n                        map[element.id] = true;\r\n                    }\r\n                    return map;\r\n                }, {}),\r\n            }, getNonDeletedElements(elements)),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.selectAll\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.key === KEYS.A,\r\n});\r\n","import { KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { duplicateElement, getNonDeletedElements } from \"../element\";\r\nimport { isSomeElementSelected } from \"../scene\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { clone } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { mutateElement } from \"../element/mutateElement\";\r\nimport { selectGroupsForSelectedElements, getSelectedGroupForElement, getElementsInGroup, } from \"../groups\";\r\nimport { fixBindingsAfterDuplication } from \"../element/binding\";\r\nimport { GRID_SIZE } from \"../constants\";\r\nexport const actionDuplicateSelection = register({\r\n    name: \"duplicateSelection\",\r\n    perform: (elements, appState) => {\r\n        // duplicate point if selected while editing multi-point element\r\n        if (appState.editingLinearElement) {\r\n            const { activePointIndex, elementId } = appState.editingLinearElement;\r\n            const element = LinearElementEditor.getElement(elementId);\r\n            if (!element || activePointIndex === null) {\r\n                return false;\r\n            }\r\n            const { points } = element;\r\n            const selectedPoint = points[activePointIndex];\r\n            const nextPoint = points[activePointIndex + 1];\r\n            mutateElement(element, {\r\n                points: [\r\n                    ...points.slice(0, activePointIndex + 1),\r\n                    nextPoint\r\n                        ? [\r\n                            (selectedPoint[0] + nextPoint[0]) / 2,\r\n                            (selectedPoint[1] + nextPoint[1]) / 2,\r\n                        ]\r\n                        : [selectedPoint[0] + 30, selectedPoint[1] + 30],\r\n                    ...points.slice(activePointIndex + 1),\r\n                ],\r\n            });\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    editingLinearElement: {\r\n                        ...appState.editingLinearElement,\r\n                        activePointIndex: activePointIndex + 1,\r\n                    },\r\n                },\r\n                elements,\r\n                commitToHistory: true,\r\n            };\r\n        }\r\n        return {\r\n            ...duplicateElements(elements, appState),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.duplicateSelection\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.key === KEYS.D,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton type=\"button\" icon={clone} title={`${t(\"labels.duplicateSelection\")} — ${getShortcutKey(\"CtrlOrCmd+D\")}`} aria-label={t(\"labels.duplicateSelection\")} onClick={() => updateData(null)} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nconst duplicateElements = (elements, appState) => {\r\n    const groupIdMap = new Map();\r\n    const newElements = [];\r\n    const oldElements = [];\r\n    const oldIdToDuplicatedId = new Map();\r\n    const duplicateAndOffsetElement = (element) => {\r\n        const newElement = duplicateElement(appState.editingGroupId, groupIdMap, element, {\r\n            x: element.x + GRID_SIZE / 2,\r\n            y: element.y + GRID_SIZE / 2,\r\n        });\r\n        oldIdToDuplicatedId.set(element.id, newElement.id);\r\n        oldElements.push(element);\r\n        newElements.push(newElement);\r\n        return newElement;\r\n    };\r\n    const finalElements = [];\r\n    let index = 0;\r\n    while (index < elements.length) {\r\n        const element = elements[index];\r\n        if (appState.selectedElementIds[element.id]) {\r\n            if (element.groupIds.length) {\r\n                const groupId = getSelectedGroupForElement(appState, element);\r\n                // if group selected, duplicate it atomically\r\n                if (groupId) {\r\n                    const groupElements = getElementsInGroup(elements, groupId);\r\n                    finalElements.push(...groupElements, ...groupElements.map((element) => duplicateAndOffsetElement(element)));\r\n                    index = index + groupElements.length;\r\n                    continue;\r\n                }\r\n            }\r\n            finalElements.push(element, duplicateAndOffsetElement(element));\r\n        }\r\n        else {\r\n            finalElements.push(element);\r\n        }\r\n        index++;\r\n    }\r\n    fixBindingsAfterDuplication(finalElements, oldElements, oldIdToDuplicatedId);\r\n    return {\r\n        elements: finalElements,\r\n        appState: selectGroupsForSelectedElements({\r\n            ...appState,\r\n            selectedGroupIds: {},\r\n            selectedElementIds: newElements.reduce((acc, element) => {\r\n                acc[element.id] = true;\r\n                return acc;\r\n            }, {}),\r\n        }, getNonDeletedElements(finalElements)),\r\n    };\r\n};\r\n","import clsx from \"clsx\";\r\n// TODO: It might be \"clever\" to add option.icon to the existing component <ButtonSelect />\r\nexport const ButtonIconSelect = ({ options, value, onChange, group, }) => (<div className=\"buttonList buttonListIcon\">\r\n    {options.map((option) => (<label key={option.text} className={clsx({ active: value === option.value })} title={option.text}>\r\n        <input type=\"radio\" name={group} onChange={() => onChange(option.value)} checked={value === option.value}/>\r\n        {option.icon}\r\n      </label>))}\r\n  </div>);\r\n","import React, { useLayoutEffect, useRef, useEffect } from \"react\";\r\nimport \"./Popover.scss\";\r\nimport { unstable_batchedUpdates } from \"react-dom\";\r\nexport const Popover = ({\r\n  children,\r\n  left,\r\n  top,\r\n  onCloseRequest,\r\n  fitInViewport = false,\r\n}) => {\r\n  const popoverRef = useRef(null);\r\n  // ensure the popover doesn't overflow the viewport\r\n  useLayoutEffect(() => {\r\n    if (fitInViewport && popoverRef.current) {\r\n      const element = popoverRef.current;\r\n      const { x, y, width, height } = element.getBoundingClientRect();\r\n      const viewportWidth = window.innerWidth;\r\n      if (x + width > viewportWidth) {\r\n        element.style.left = `${viewportWidth - width}px`;\r\n      }\r\n      const viewportHeight = window.innerHeight;\r\n      if (y + height > viewportHeight) {\r\n        element.style.top = `${viewportHeight - height}px`;\r\n      }\r\n    }\r\n  }, [fitInViewport]);\r\n  useEffect(() => {\r\n    if (onCloseRequest) {\r\n      const handler = (event) => {\r\n        if (!popoverRef.current?.contains(event.target)) {\r\n          unstable_batchedUpdates(() => onCloseRequest(event));\r\n        }\r\n      };\r\n      document.addEventListener(\"click\", handler, false);\r\n      return () => document.removeEventListener(\"click\", handler, false);\r\n    }\r\n  }, [onCloseRequest]);\r\n  return (\r\n    <div className=\"popover\" style={{ top, left }} ref={popoverRef}>\r\n      {children}\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Popover } from \"./Popover\";\r\nimport { isTransparent } from \"../utils\";\r\nimport \"./ColorPicker.scss\";\r\nimport { isArrowKey, KEYS } from \"../keys\";\r\nimport { t, getLanguage } from \"../i18n\";\r\nimport { isWritableElement } from \"../utils\";\r\nimport colors from \"../colors\";\r\nconst isValidColor = (color) => {\r\n  const style = new Option().style;\r\n  style.color = color;\r\n  return !!style.color;\r\n};\r\nconst getColor = (color) => {\r\n  if (isTransparent(color)) {\r\n    return color;\r\n  }\r\n  return isValidColor(color)\r\n    ? color\r\n    : isValidColor(`#${color}`)\r\n    ? `#${color}`\r\n    : null;\r\n};\r\n// This is a narrow reimplementation of the awesome react-color Twitter component\r\n// https://github.com/casesandberg/react-color/blob/master/src/components/twitter/Twitter.js\r\n// Unfortunately, we can't detect keyboard layout in the browser. So this will\r\n// only work well for QWERTY but not AZERTY or others...\r\nconst keyBindings = [\r\n  [\"1\", \"2\", \"3\", \"4\", \"5\"],\r\n  [\"q\", \"w\", \"e\", \"r\", \"t\"],\r\n  [\"a\", \"s\", \"d\", \"f\", \"g\"],\r\n].flat();\r\nconst Picker = ({\r\n  colors,\r\n  color,\r\n  onChange,\r\n  onClose,\r\n  label,\r\n  showInput = true,\r\n  type,\r\n}) => {\r\n  const firstItem = React.useRef();\r\n  const activeItem = React.useRef();\r\n  const gallery = React.useRef();\r\n  const colorInput = React.useRef();\r\n  React.useEffect(() => {\r\n    // After the component is first mounted focus on first input\r\n    if (activeItem.current) {\r\n      activeItem.current.focus();\r\n    } else if (colorInput.current) {\r\n      colorInput.current.focus();\r\n    } else if (gallery.current) {\r\n      gallery.current.focus();\r\n    }\r\n  }, []);\r\n  const handleKeyDown = (event) => {\r\n    if (event.key === KEYS.TAB) {\r\n      const { activeElement } = document;\r\n      if (event.shiftKey) {\r\n        if (activeElement === firstItem.current) {\r\n          colorInput.current?.focus();\r\n          event.preventDefault();\r\n        }\r\n      } else if (activeElement === colorInput.current) {\r\n        firstItem.current?.focus();\r\n        event.preventDefault();\r\n      }\r\n    } else if (isArrowKey(event.key)) {\r\n      const { activeElement } = document;\r\n      const isRTL = getLanguage().rtl;\r\n      const index = Array.prototype.indexOf.call(\r\n        gallery.current.children,\r\n        activeElement\r\n      );\r\n      if (index !== -1) {\r\n        const length = gallery.current.children.length - (showInput ? 1 : 0);\r\n        const nextIndex =\r\n          event.key === (isRTL ? KEYS.ARROW_LEFT : KEYS.ARROW_RIGHT)\r\n            ? (index + 1) % length\r\n            : event.key === (isRTL ? KEYS.ARROW_RIGHT : KEYS.ARROW_LEFT)\r\n            ? (length + index - 1) % length\r\n            : event.key === KEYS.ARROW_DOWN\r\n            ? (index + 5) % length\r\n            : event.key === KEYS.ARROW_UP\r\n            ? (length + index - 5) % length\r\n            : index;\r\n        gallery.current.children[nextIndex].focus();\r\n      }\r\n      event.preventDefault();\r\n    } else if (\r\n      keyBindings.includes(event.key.toLowerCase()) &&\r\n      !isWritableElement(event.target)\r\n    ) {\r\n      const index = keyBindings.indexOf(event.key.toLowerCase());\r\n      gallery.current.children[index].focus();\r\n      event.preventDefault();\r\n    } else if (event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) {\r\n      event.preventDefault();\r\n      onClose();\r\n    }\r\n    event.nativeEvent.stopImmediatePropagation();\r\n    event.stopPropagation();\r\n  };\r\n  return (\r\n    <div\r\n      className={`color-picker color-picker-type-${type}`}\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-label={t(\"labels.colorPicker\")}\r\n      onKeyDown={handleKeyDown}\r\n    >\r\n      <div className=\"color-picker-triangle color-picker-triangle-shadow\"></div>\r\n      <div className=\"color-picker-triangle\"></div>\r\n      <div\r\n        className=\"color-picker-content\"\r\n        ref={(el) => {\r\n          if (el) {\r\n            gallery.current = el;\r\n          }\r\n        }}\r\n        tabIndex={0}\r\n      >\r\n        {colors.map((_color, i) => {\r\n          const _colorWithoutHash = _color.replace(\"#\", \"\");\r\n          return (\r\n            <button\r\n              className={`${_color} color-picker-swatch`}\r\n              onClick={(event) => {\r\n                event.currentTarget.focus();\r\n                console.log(event.currentTarget);\r\n                onChange(_color);\r\n              }}\r\n              title={`${t(`colors.${_colorWithoutHash}`)}${\r\n                !isTransparent(_color) ? ` (${_color})` : \"\"\r\n              } — ${keyBindings[i].toUpperCase()}`}\r\n              aria-label={t(`colors.${_colorWithoutHash}`)}\r\n              aria-keyshortcuts={keyBindings[i]}\r\n              style={{ color: _color }}\r\n              key={_color}\r\n              ref={(el) => {\r\n                if (el && i === 0) {\r\n                  firstItem.current = el;\r\n                }\r\n                if (el && _color === color) {\r\n                  activeItem.current = el;\r\n                }\r\n              }}\r\n              onFocus={() => {\r\n                onChange(_color);\r\n              }}\r\n            >\r\n              {isTransparent(_color) ? (\r\n                <div className=\"color-picker-transparent\"></div>\r\n              ) : undefined}\r\n              <span className={`${_color} color-picker-keybinding`}>\r\n                {keyBindings[i]}\r\n              </span>\r\n            </button>\r\n          );\r\n        })}\r\n        {showInput && (\r\n          <ColorInput\r\n            color={color}\r\n            label={label}\r\n            onChange={(color) => {\r\n              onChange(color);\r\n            }}\r\n            ref={colorInput}\r\n          />\r\n        )}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\nconst ColorInput = React.forwardRef(({ color, onChange, label }, ref) => {\r\n  const [innerValue, setInnerValue] = React.useState(color);\r\n  const inputRef = React.useRef(null);\r\n  React.useEffect(() => {\r\n    setInnerValue(color);\r\n  }, [color]);\r\n  React.useImperativeHandle(ref, () => inputRef.current);\r\n  const changeColor = React.useCallback(\r\n    (inputValue) => {\r\n      const value = inputValue.toLowerCase();\r\n      const color = getColor(value);\r\n      if (color) {\r\n        onChange(color);\r\n      }\r\n      setInnerValue(value);\r\n    },\r\n    [onChange]\r\n  );\r\n  return (\r\n    <label className=\"color-input-container\">\r\n      <div className=\"color-picker-hash\">#</div>\r\n      <input\r\n        spellCheck={false}\r\n        className=\"color-picker-input\"\r\n        aria-label={label}\r\n        onChange={(event) => changeColor(event.target.value)}\r\n        value={(innerValue || \"\").replace(/^#/, \"\")}\r\n        onBlur={() => setInnerValue(color)}\r\n        ref={inputRef}\r\n      />\r\n    </label>\r\n  );\r\n});\r\nexport const ColorPicker = ({\r\n  type,\r\n  color,\r\n  onChange,\r\n  label,\r\n  isActive,\r\n  setActive,\r\n}) => {\r\n  const pickerButton = React.useRef(null);\r\n  return (\r\n    <div>\r\n      <div className=\"color-picker-control-container\">\r\n        <button\r\n          className={`${type} color-picker-label-swatch`}\r\n          aria-label={label}\r\n          style={color ? { \"--swatch-color\": color } : undefined}\r\n          onClick={() => setActive(!isActive)}\r\n          ref={pickerButton}\r\n        />\r\n        <ColorInput\r\n          color={color}\r\n          label={label}\r\n          onChange={(color) => {\r\n            onChange(color);\r\n          }}\r\n        />\r\n      </div>\r\n      <React.Suspense fallback=\"\">\r\n        {isActive ? (\r\n          <Popover\r\n            onCloseRequest={(event) =>\r\n              event.target !== pickerButton.current && setActive(false)\r\n            }\r\n          >\r\n            <Picker\r\n              colors={colors[type]}\r\n              color={color || null}\r\n              onChange={(changedColor) => {\r\n                onChange(changedColor);\r\n              }}\r\n              onClose={() => {\r\n                setActive(false);\r\n                pickerButton.current?.focus();\r\n              }}\r\n              label={label}\r\n              showInput={false}\r\n              type={type}\r\n            />\r\n          </Popover>\r\n        ) : null}\r\n      </React.Suspense>\r\n    </div>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport { Popover } from \"./Popover\";\r\nimport \"./IconPicker.scss\";\r\nimport { isArrowKey, KEYS } from \"../keys\";\r\nimport { getLanguage } from \"../i18n\";\r\nfunction Picker({ options, value, label, onChange, onClose }) {\r\n  const rFirstItem = React.useRef();\r\n  const rActiveItem = React.useRef();\r\n  const rGallery = React.useRef(null);\r\n  React.useEffect(() => {\r\n    // After the component is first mounted focus on first input\r\n    if (rActiveItem.current) {\r\n      rActiveItem.current.focus();\r\n    } else if (rGallery.current) {\r\n      rGallery.current.focus();\r\n    }\r\n  }, []);\r\n  const handleKeyDown = (event) => {\r\n    const pressedOption = options.find(\r\n      (option) => option.keyBinding === event.key.toLowerCase()\r\n    );\r\n    if (!(event.metaKey || event.altKey || event.ctrlKey) && pressedOption) {\r\n      // Keybinding navigation\r\n      const index = options.indexOf(pressedOption);\r\n      rGallery.current.children[index].focus();\r\n      event.preventDefault();\r\n    } else if (event.key === KEYS.TAB) {\r\n      // Tab navigation cycle through options. If the user tabs\r\n      // away from the picker, close the picker. We need to use\r\n      // a timeout here to let the stack clear before checking.\r\n      setTimeout(() => {\r\n        const active = rActiveItem.current;\r\n        const docActive = document.activeElement;\r\n        if (active !== docActive) {\r\n          onClose();\r\n        }\r\n      }, 0);\r\n    } else if (isArrowKey(event.key)) {\r\n      // Arrow navigation\r\n      const { activeElement } = document;\r\n      const isRTL = getLanguage().rtl;\r\n      const index = Array.prototype.indexOf.call(\r\n        rGallery.current.children,\r\n        activeElement\r\n      );\r\n      if (index !== -1) {\r\n        const length = options.length;\r\n        let nextIndex = index;\r\n        switch (event.key) {\r\n          // Select the next option\r\n          case isRTL ? KEYS.ARROW_LEFT : KEYS.ARROW_RIGHT:\r\n          case KEYS.ARROW_DOWN: {\r\n            nextIndex = (index + 1) % length;\r\n            break;\r\n          }\r\n          // Select the previous option\r\n          case isRTL ? KEYS.ARROW_RIGHT : KEYS.ARROW_LEFT:\r\n          case KEYS.ARROW_UP: {\r\n            nextIndex = (length + index - 1) % length;\r\n            break;\r\n          }\r\n        }\r\n        rGallery.current.children[nextIndex].focus();\r\n      }\r\n      event.preventDefault();\r\n    } else if (event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) {\r\n      // Close on escape or enter\r\n      event.preventDefault();\r\n      onClose();\r\n    }\r\n    event.nativeEvent.stopImmediatePropagation();\r\n    event.stopPropagation();\r\n  };\r\n  return (\r\n    <div\r\n      className={`picker`}\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      aria-label={label}\r\n      onKeyDown={handleKeyDown}\r\n    >\r\n      <div className=\"picker-content\" ref={rGallery}>\r\n        {options.map((option, i) => (\r\n          <button\r\n            className=\"picker-option\"\r\n            onClick={(event) => {\r\n              event.currentTarget.focus();\r\n              onChange(option.value);\r\n            }}\r\n            title={`${option.text} — ${option.keyBinding.toUpperCase()}`}\r\n            aria-label={option.text || \"none\"}\r\n            aria-keyshortcuts={option.keyBinding}\r\n            key={option.text}\r\n            ref={(el) => {\r\n              if (el && i === 0) {\r\n                rFirstItem.current = el;\r\n              }\r\n              if (el && option.value === value) {\r\n                rActiveItem.current = el;\r\n              }\r\n            }}\r\n            onFocus={() => {\r\n              onChange(option.value);\r\n            }}\r\n          >\r\n            {option.icon}\r\n            <span className=\"picker-keybinding\">{option.keyBinding}</span>\r\n          </button>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\nexport function IconPicker({ value, label, options, onChange, group = \"\" }) {\r\n  const [isActive, setActive] = React.useState(false);\r\n  const rPickerButton = React.useRef(null);\r\n  const isRTL = getLanguage().rtl;\r\n  return (\r\n    <label className={\"picker-container\"}>\r\n      <button\r\n        name={group}\r\n        className={isActive ? \"active\" : \"\"}\r\n        aria-label={label}\r\n        onClick={() => setActive(!isActive)}\r\n        ref={rPickerButton}\r\n      >\r\n        {options.find((option) => option.value === value)?.icon}\r\n      </button>\r\n      <React.Suspense fallback=\"\">\r\n        {isActive ? (\r\n          <>\r\n            <Popover\r\n              onCloseRequest={(event) =>\r\n                event.target !== rPickerButton.current && setActive(false)\r\n              }\r\n              {...(isRTL ? { right: 5.5 } : { left: -5.5 })}\r\n            >\r\n              <Picker\r\n                options={options}\r\n                value={value}\r\n                label={label}\r\n                onChange={onChange}\r\n                onClose={() => {\r\n                  setActive(false);\r\n                  rPickerButton.current?.focus();\r\n                }}\r\n              />\r\n            </Popover>\r\n            <div className=\"picker-triangle\" />\r\n          </>\r\n        ) : null}\r\n      </React.Suspense>\r\n    </label>\r\n  );\r\n}\r\n","import { ButtonIconSelect } from \"../components/ButtonIconSelect\";\r\nimport { ColorPicker } from \"../components/ColorPicker\";\r\nimport { IconPicker } from \"../components/IconPicker\";\r\nimport { ArrowheadArrowIcon, ArrowheadBarIcon, ArrowheadDotIcon, ArrowheadTriangleIcon, ArrowheadNoneIcon, EdgeRoundIcon, EdgeSharpIcon, FillCrossHatchIcon, FillHachureIcon, FillSolidIcon, FontFamilyCodeIcon, FontFamilyHandDrawnIcon, FontFamilyNormalIcon, FontSizeExtraLargeIcon, FontSizeLargeIcon, FontSizeMediumIcon, FontSizeSmallIcon, SloppinessArchitectIcon, SloppinessArtistIcon, SloppinessCartoonistIcon, StrokeStyleDashedIcon, StrokeStyleDottedIcon, StrokeStyleSolidIcon, StrokeWidthIcon, TextAlignCenterIcon, TextAlignLeftIcon, TextAlignRightIcon, } from \"../components/icons\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_FONT_SIZE, FONT_FAMILY, } from \"../constants\";\r\nimport { getNonDeletedElements, isTextElement, redrawTextBoundingBox, } from \"../element\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { isLinearElement, isLinearElementType } from \"../element/typeChecks\";\r\nimport { getLanguage, t } from \"../i18n\";\r\nimport { randomInteger } from \"../random\";\r\nimport { canChangeSharpness, canHaveArrowheads, getCommonAttributeOfSelectedElements, getTargetElements, isSomeElementSelected, } from \"../scene\";\r\nimport { hasStrokeColor } from \"../scene/comparisons\";\r\nimport { register } from \"./register\";\r\nconst changeProperty = (elements, appState, callback) => {\r\n    return elements.map((element) => {\r\n        if (appState.selectedElementIds[element.id] ||\r\n            element.id === appState.editingElement?.id) {\r\n            return callback(element);\r\n        }\r\n        return element;\r\n    });\r\n};\r\nconst getFormValue = function (elements, appState, getAttribute, defaultValue) {\r\n    const editingElement = appState.editingElement;\r\n    const nonDeletedElements = getNonDeletedElements(elements);\r\n    return ((editingElement && getAttribute(editingElement)) ??\r\n        (isSomeElementSelected(nonDeletedElements, appState)\r\n            ? getCommonAttributeOfSelectedElements(nonDeletedElements, appState, getAttribute)\r\n            : defaultValue) ??\r\n        null);\r\n};\r\nexport const actionChangeStrokeColor = register({\r\n    name: \"changeStrokeColor\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            ...(value.currentItemStrokeColor && {\r\n                elements: changeProperty(elements, appState, (el) => {\r\n                    return hasStrokeColor(el.type)\r\n                        ? newElementWith(el, {\r\n                            strokeColor: value.currentItemStrokeColor,\r\n                        })\r\n                        : el;\r\n                }),\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                ...value,\r\n            },\r\n            commitToHistory: !!value.currentItemStrokeColor,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<>\r\n      <h3 aria-hidden=\"true\">{t(\"labels.stroke\")}</h3>\r\n      <ColorPicker type=\"elementStroke\" label={t(\"labels.stroke\")} color={getFormValue(elements, appState, (element) => element.strokeColor, appState.currentItemStrokeColor)} onChange={(color) => updateData({ currentItemStrokeColor: color })} isActive={appState.openPopup === \"strokeColorPicker\"} setActive={(active) => updateData({ openPopup: active ? \"strokeColorPicker\" : null })}/>\r\n    </>),\r\n});\r\nexport const actionChangeBackgroundColor = register({\r\n    name: \"changeBackgroundColor\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            ...(value.currentItemBackgroundColor && {\r\n                elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                    backgroundColor: value.currentItemBackgroundColor,\r\n                })),\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                ...value,\r\n            },\r\n            commitToHistory: !!value.currentItemBackgroundColor,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<>\r\n      <h3 aria-hidden=\"true\">{t(\"labels.background\")}</h3>\r\n      <ColorPicker type=\"elementBackground\" label={t(\"labels.background\")} color={getFormValue(elements, appState, (element) => element.backgroundColor, appState.currentItemBackgroundColor)} onChange={(color) => updateData({ currentItemBackgroundColor: color })} isActive={appState.openPopup === \"backgroundColorPicker\"} setActive={(active) => updateData({ openPopup: active ? \"backgroundColorPicker\" : null })}/>\r\n    </>),\r\n});\r\nexport const actionChangeFillStyle = register({\r\n    name: \"changeFillStyle\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                fillStyle: value,\r\n            })),\r\n            appState: { ...appState, currentItemFillStyle: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.fill\")}</legend>\r\n      <ButtonIconSelect options={[\r\n            {\r\n                value: \"hachure\",\r\n                text: t(\"labels.hachure\"),\r\n                icon: <FillHachureIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"cross-hatch\",\r\n                text: t(\"labels.crossHatch\"),\r\n                icon: <FillCrossHatchIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"solid\",\r\n                text: t(\"labels.solid\"),\r\n                icon: <FillSolidIcon theme={appState.theme}/>,\r\n            },\r\n        ]} group=\"fill\" value={getFormValue(elements, appState, (element) => element.fillStyle, appState.currentItemFillStyle)} onChange={(value) => {\r\n            updateData(value);\r\n        }}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeStrokeWidth = register({\r\n    name: \"changeStrokeWidth\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                strokeWidth: value,\r\n            })),\r\n            appState: { ...appState, currentItemStrokeWidth: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.strokeWidth\")}</legend>\r\n      <ButtonIconSelect group=\"stroke-width\" options={[\r\n            {\r\n                value: 1,\r\n                text: t(\"labels.thin\"),\r\n                icon: <StrokeWidthIcon theme={appState.theme} strokeWidth={2}/>,\r\n            },\r\n            {\r\n                value: 2,\r\n                text: t(\"labels.bold\"),\r\n                icon: <StrokeWidthIcon theme={appState.theme} strokeWidth={6}/>,\r\n            },\r\n            {\r\n                value: 4,\r\n                text: t(\"labels.extraBold\"),\r\n                icon: <StrokeWidthIcon theme={appState.theme} strokeWidth={10}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.strokeWidth, appState.currentItemStrokeWidth)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeSloppiness = register({\r\n    name: \"changeSloppiness\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                seed: randomInteger(),\r\n                roughness: value,\r\n            })),\r\n            appState: { ...appState, currentItemRoughness: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.sloppiness\")}</legend>\r\n      <ButtonIconSelect group=\"sloppiness\" options={[\r\n            {\r\n                value: 0,\r\n                text: t(\"labels.architect\"),\r\n                icon: <SloppinessArchitectIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 1,\r\n                text: t(\"labels.artist\"),\r\n                icon: <SloppinessArtistIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 2,\r\n                text: t(\"labels.cartoonist\"),\r\n                icon: <SloppinessCartoonistIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.roughness, appState.currentItemRoughness)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeStrokeStyle = register({\r\n    name: \"changeStrokeStyle\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                strokeStyle: value,\r\n            })),\r\n            appState: { ...appState, currentItemStrokeStyle: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.strokeStyle\")}</legend>\r\n      <ButtonIconSelect group=\"strokeStyle\" options={[\r\n            {\r\n                value: \"solid\",\r\n                text: t(\"labels.strokeStyle_solid\"),\r\n                icon: <StrokeStyleSolidIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"dashed\",\r\n                text: t(\"labels.strokeStyle_dashed\"),\r\n                icon: <StrokeStyleDashedIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"dotted\",\r\n                text: t(\"labels.strokeStyle_dotted\"),\r\n                icon: <StrokeStyleDottedIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.strokeStyle, appState.currentItemStrokeStyle)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeOpacity = register({\r\n    name: \"changeOpacity\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                opacity: value,\r\n            })),\r\n            appState: { ...appState, currentItemOpacity: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<label className=\"control-label\">\r\n      {t(\"labels.opacity\")}\r\n      <input type=\"range\" min=\"0\" max=\"100\" step=\"10\" onChange={(event) => updateData(+event.target.value)} onWheel={(event) => {\r\n            event.stopPropagation();\r\n            const target = event.target;\r\n            const STEP = 10;\r\n            const MAX = 100;\r\n            const MIN = 0;\r\n            const value = +target.value;\r\n            if (event.deltaY < 0 && value < MAX) {\r\n                updateData(value + STEP);\r\n            }\r\n            else if (event.deltaY > 0 && value > MIN) {\r\n                updateData(value - STEP);\r\n            }\r\n        }} value={getFormValue(elements, appState, (element) => element.opacity, appState.currentItemOpacity) ?? undefined}/>\r\n    </label>),\r\n});\r\nexport const actionChangeFontSize = register({\r\n    name: \"changeFontSize\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isTextElement(el)) {\r\n                    const element = newElementWith(el, {\r\n                        fontSize: value,\r\n                    });\r\n                    redrawTextBoundingBox(element);\r\n                    return element;\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                currentItemFontSize: value,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.fontSize\")}</legend>\r\n      <ButtonIconSelect group=\"font-size\" options={[\r\n            {\r\n                value: 16,\r\n                text: t(\"labels.small\"),\r\n                icon: <FontSizeSmallIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 20,\r\n                text: t(\"labels.medium\"),\r\n                icon: <FontSizeMediumIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 28,\r\n                text: t(\"labels.large\"),\r\n                icon: <FontSizeLargeIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 36,\r\n                text: t(\"labels.veryLarge\"),\r\n                icon: <FontSizeExtraLargeIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => isTextElement(element) && element.fontSize, appState.currentItemFontSize || DEFAULT_FONT_SIZE)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeFontFamily = register({\r\n    name: \"changeFontFamily\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isTextElement(el)) {\r\n                    const element = newElementWith(el, {\r\n                        fontFamily: value,\r\n                    });\r\n                    redrawTextBoundingBox(element);\r\n                    return element;\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                currentItemFontFamily: value,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => {\r\n        const options = [\r\n            {\r\n                value: FONT_FAMILY.Virgil,\r\n                text: t(\"labels.handDrawn\"),\r\n                icon: <FontFamilyHandDrawnIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: FONT_FAMILY.Helvetica,\r\n                text: t(\"labels.normal\"),\r\n                icon: <FontFamilyNormalIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: FONT_FAMILY.Cascadia,\r\n                text: t(\"labels.code\"),\r\n                icon: <FontFamilyCodeIcon theme={appState.theme}/>,\r\n            },\r\n        ];\r\n        return (<fieldset>\r\n        <legend>{t(\"labels.fontFamily\")}</legend>\r\n        <ButtonIconSelect group=\"font-family\" options={options} value={getFormValue(elements, appState, (element) => isTextElement(element) && element.fontFamily, appState.currentItemFontFamily || DEFAULT_FONT_FAMILY)} onChange={(value) => updateData(value)}/>\r\n      </fieldset>);\r\n    },\r\n});\r\nexport const actionChangeTextAlign = register({\r\n    name: \"changeTextAlign\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isTextElement(el)) {\r\n                    const element = newElementWith(el, {\r\n                        textAlign: value,\r\n                    });\r\n                    redrawTextBoundingBox(element);\r\n                    return element;\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                currentItemTextAlign: value,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.textAlign\")}</legend>\r\n      <ButtonIconSelect group=\"text-align\" options={[\r\n            {\r\n                value: \"left\",\r\n                text: t(\"labels.left\"),\r\n                icon: <TextAlignLeftIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"center\",\r\n                text: t(\"labels.center\"),\r\n                icon: <TextAlignCenterIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"right\",\r\n                text: t(\"labels.right\"),\r\n                icon: <TextAlignRightIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => isTextElement(element) && element.textAlign, appState.currentItemTextAlign)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeSharpness = register({\r\n    name: \"changeSharpness\",\r\n    perform: (elements, appState, value) => {\r\n        const targetElements = getTargetElements(getNonDeletedElements(elements), appState);\r\n        const shouldUpdateForNonLinearElements = targetElements.length\r\n            ? targetElements.every((el) => !isLinearElement(el))\r\n            : !isLinearElementType(appState.elementType);\r\n        const shouldUpdateForLinearElements = targetElements.length\r\n            ? targetElements.every(isLinearElement)\r\n            : isLinearElementType(appState.elementType);\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                strokeSharpness: value,\r\n            })),\r\n            appState: {\r\n                ...appState,\r\n                currentItemStrokeSharpness: shouldUpdateForNonLinearElements\r\n                    ? value\r\n                    : appState.currentItemStrokeSharpness,\r\n                currentItemLinearStrokeSharpness: shouldUpdateForLinearElements\r\n                    ? value\r\n                    : appState.currentItemLinearStrokeSharpness,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.edges\")}</legend>\r\n      <ButtonIconSelect group=\"edges\" options={[\r\n            {\r\n                value: \"sharp\",\r\n                text: t(\"labels.sharp\"),\r\n                icon: <EdgeSharpIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"round\",\r\n                text: t(\"labels.round\"),\r\n                icon: <EdgeRoundIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.strokeSharpness, (canChangeSharpness(appState.elementType) &&\r\n            (isLinearElementType(appState.elementType)\r\n                ? appState.currentItemLinearStrokeSharpness\r\n                : appState.currentItemStrokeSharpness)) ||\r\n            null)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeArrowhead = register({\r\n    name: \"changeArrowhead\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isLinearElement(el)) {\r\n                    const { position, type } = value;\r\n                    if (position === \"start\") {\r\n                        const element = newElementWith(el, {\r\n                            startArrowhead: type,\r\n                        });\r\n                        return element;\r\n                    }\r\n                    else if (position === \"end\") {\r\n                        const element = newElementWith(el, {\r\n                            endArrowhead: type,\r\n                        });\r\n                        return element;\r\n                    }\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                [value.position === \"start\"\r\n                    ? \"currentItemStartArrowhead\"\r\n                    : \"currentItemEndArrowhead\"]: value.type,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => {\r\n        const isRTL = getLanguage().rtl;\r\n        return (<fieldset>\r\n        <legend>{t(\"labels.arrowheads\")}</legend>\r\n        <div className=\"iconSelectList\">\r\n          <IconPicker label=\"arrowhead_start\" options={[\r\n                {\r\n                    value: null,\r\n                    text: t(\"labels.arrowhead_none\"),\r\n                    icon: <ArrowheadNoneIcon theme={appState.theme}/>,\r\n                    keyBinding: \"q\",\r\n                },\r\n                {\r\n                    value: \"arrow\",\r\n                    text: t(\"labels.arrowhead_arrow\"),\r\n                    icon: (<ArrowheadArrowIcon theme={appState.theme} flip={!isRTL}/>),\r\n                    keyBinding: \"w\",\r\n                },\r\n                {\r\n                    value: \"bar\",\r\n                    text: t(\"labels.arrowhead_bar\"),\r\n                    icon: <ArrowheadBarIcon theme={appState.theme} flip={!isRTL}/>,\r\n                    keyBinding: \"e\",\r\n                },\r\n                {\r\n                    value: \"dot\",\r\n                    text: t(\"labels.arrowhead_dot\"),\r\n                    icon: <ArrowheadDotIcon theme={appState.theme} flip={!isRTL}/>,\r\n                    keyBinding: \"r\",\r\n                },\r\n                {\r\n                    value: \"triangle\",\r\n                    text: t(\"labels.arrowhead_triangle\"),\r\n                    icon: (<ArrowheadTriangleIcon theme={appState.theme} flip={!isRTL}/>),\r\n                    keyBinding: \"t\",\r\n                },\r\n            ]} value={getFormValue(elements, appState, (element) => isLinearElement(element) && canHaveArrowheads(element.type)\r\n                ? element.startArrowhead\r\n                : appState.currentItemStartArrowhead, appState.currentItemStartArrowhead)} onChange={(value) => updateData({ position: \"start\", type: value })}/>\r\n          <IconPicker label=\"arrowhead_end\" group=\"arrowheads\" options={[\r\n                {\r\n                    value: null,\r\n                    text: t(\"labels.arrowhead_none\"),\r\n                    keyBinding: \"q\",\r\n                    icon: <ArrowheadNoneIcon theme={appState.theme}/>,\r\n                },\r\n                {\r\n                    value: \"arrow\",\r\n                    text: t(\"labels.arrowhead_arrow\"),\r\n                    keyBinding: \"w\",\r\n                    icon: (<ArrowheadArrowIcon theme={appState.theme} flip={isRTL}/>),\r\n                },\r\n                {\r\n                    value: \"bar\",\r\n                    text: t(\"labels.arrowhead_bar\"),\r\n                    keyBinding: \"e\",\r\n                    icon: <ArrowheadBarIcon theme={appState.theme} flip={isRTL}/>,\r\n                },\r\n                {\r\n                    value: \"dot\",\r\n                    text: t(\"labels.arrowhead_dot\"),\r\n                    keyBinding: \"r\",\r\n                    icon: <ArrowheadDotIcon theme={appState.theme} flip={isRTL}/>,\r\n                },\r\n                {\r\n                    value: \"triangle\",\r\n                    text: t(\"labels.arrowhead_triangle\"),\r\n                    icon: (<ArrowheadTriangleIcon theme={appState.theme} flip={isRTL}/>),\r\n                    keyBinding: \"t\",\r\n                },\r\n            ]} value={getFormValue(elements, appState, (element) => isLinearElement(element) && canHaveArrowheads(element.type)\r\n                ? element.endArrowhead\r\n                : appState.currentItemEndArrowhead, appState.currentItemEndArrowhead)} onChange={(value) => updateData({ position: \"end\", type: value })}/>\r\n        </div>\r\n      </fieldset>);\r\n    },\r\n});\r\n","export var UserIdleState;\r\n(function (UserIdleState) {\r\n    UserIdleState[\"ACTIVE\"] = \"active\";\r\n    UserIdleState[\"AWAY\"] = \"away\";\r\n    UserIdleState[\"IDLE\"] = \"idle\";\r\n})(UserIdleState || (UserIdleState = {}));\r\n","import \"./ToolIcon.scss\";\r\nimport { t } from \"../i18n\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { THEME } from \"../constants\";\r\n// We chose to use only explicit toggle and not a third option for system value,\r\n// but this could be added in the future.\r\nexport const DarkModeToggle = (props) => {\r\n    const title = props.title ||\r\n        (props.value === \"dark\" ? t(\"buttons.lightMode\") : t(\"buttons.darkMode\"));\r\n    return (<ToolButton type=\"icon\" icon={props.value === THEME.LIGHT ? ICONS.MOON : ICONS.SUN} title={title} aria-label={title} onClick={() => props.onChange(props.value === THEME.DARK ? THEME.LIGHT : THEME.DARK)} data-testid=\"toggle-dark-mode\"/>);\r\n};\r\nconst ICONS = {\r\n    SUN: (<svg width=\"512\" height=\"512\" className=\"rtl-mirror\" viewBox=\"0 0 512 512\">\r\n      <path fill=\"currentColor\" d=\"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z\"></path>\r\n    </svg>),\r\n    MOON: (<svg width=\"512\" height=\"512\" className=\"rtl-mirror\" viewBox=\"0 0 512 512\">\r\n      <path fill=\"currentColor\" d=\"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z\"></path>\r\n    </svg>),\r\n};\r\n","import \"./Tooltip.scss\";\r\nimport React, { useEffect } from \"react\";\r\nconst getTooltipDiv = () => {\r\n    const existingDiv = document.querySelector(\".excalidraw-tooltip\");\r\n    if (existingDiv) {\r\n        return existingDiv;\r\n    }\r\n    const div = document.createElement(\"div\");\r\n    document.body.appendChild(div);\r\n    div.classList.add(\"excalidraw-tooltip\");\r\n    return div;\r\n};\r\nconst updateTooltip = (item, tooltip, label, long) => {\r\n    tooltip.classList.add(\"excalidraw-tooltip--visible\");\r\n    tooltip.style.minWidth = long ? \"50ch\" : \"10ch\";\r\n    tooltip.style.maxWidth = long ? \"50ch\" : \"15ch\";\r\n    tooltip.textContent = label;\r\n    const { x: itemX, bottom: itemBottom, top: itemTop, width: itemWidth, } = item.getBoundingClientRect();\r\n    const { width: labelWidth, height: labelHeight } = tooltip.getBoundingClientRect();\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n    const margin = 5;\r\n    const left = itemX + itemWidth / 2 - labelWidth / 2;\r\n    const offsetLeft = left + labelWidth >= viewportWidth ? left + labelWidth - viewportWidth : 0;\r\n    const top = itemBottom + margin;\r\n    const offsetTop = top + labelHeight >= viewportHeight\r\n        ? itemBottom - itemTop + labelHeight + margin * 2\r\n        : 0;\r\n    Object.assign(tooltip.style, {\r\n        top: `${top - offsetTop}px`,\r\n        left: `${left - offsetLeft}px`,\r\n    });\r\n};\r\nexport const Tooltip = ({ children, label, long = false }) => {\r\n    useEffect(() => {\r\n        return () => getTooltipDiv().classList.remove(\"excalidraw-tooltip--visible\");\r\n    }, []);\r\n    return (<div className=\"excalidraw-tooltip-wrapper\" onPointerEnter={(event) => updateTooltip(event.currentTarget, getTooltipDiv(), label, long)} onPointerLeave={() => getTooltipDiv().classList.remove(\"excalidraw-tooltip--visible\")}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import { useState } from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"./App\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { trash } from \"./icons\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport \"./ClearCanvas.scss\";\r\nconst ClearCanvas = ({ onConfirm }) => {\r\n    const [showDialog, setShowDialog] = useState(false);\r\n    const toggleDialog = () => {\r\n        setShowDialog(!showDialog);\r\n    };\r\n    return (<>\r\n      <ToolButton type=\"button\" icon={trash} title={t(\"buttons.clearReset\")} aria-label={t(\"buttons.clearReset\")} showAriaLabel={useIsMobile()} onClick={toggleDialog} data-testid=\"clear-canvas-button\"/>\r\n\r\n      {showDialog && (<Dialog onCloseRequest={toggleDialog} title={t(\"clearCanvasDialog.title\")} className=\"clear-canvas\" small={true}>\r\n          <>\r\n            <p className=\"clear-canvas__content\"> {t(\"alerts.clearReset\")}</p>\r\n            <div className=\"clear-canvas-buttons\">\r\n              <ToolButton type=\"button\" title={t(\"buttons.clear\")} aria-label={t(\"buttons.clear\")} label={t(\"buttons.clear\")} onClick={() => {\r\n                onConfirm();\r\n                toggleDialog();\r\n            }} data-testid=\"confirm-clear-canvas-button\" className=\"clear-canvas--confirm\"/>\r\n              <ToolButton type=\"button\" title={t(\"buttons.cancel\")} aria-label={t(\"buttons.cancel\")} label={t(\"buttons.cancel\")} onClick={toggleDialog} data-testid=\"cancel-clear-canvas-button\" className=\"clear-canvas--cancel\"/>\r\n            </div>\r\n          </>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\nexport default ClearCanvas;\r\n","import { ColorPicker } from \"../components/ColorPicker\";\r\nimport { zoomIn, zoomOut } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { DarkModeToggle } from \"../components/DarkModeToggle\";\r\nimport { THEME, ZOOM_STEP } from \"../constants\";\r\nimport { getCommonBounds, getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nimport { getNormalizedZoom, getSelectedElements } from \"../scene\";\r\nimport { centerScrollOn } from \"../scene/scroll\";\r\nimport { getNewZoom } from \"../scene/zoom\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nimport { Tooltip } from \"../components/Tooltip\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport ClearCanvas from \"../components/ClearCanvas\";\r\nexport const actionChangeViewBackgroundColor = register({\r\n    name: \"changeViewBackgroundColor\",\r\n    perform: (_, appState, value) => {\r\n        return {\r\n            appState: { ...appState, ...value },\r\n            commitToHistory: !!value.viewBackgroundColor,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => {\r\n        return (<div style={{ position: \"relative\" }}>\r\n        <ColorPicker label={t(\"labels.canvasBackground\")} type=\"canvasBackground\" color={appState.viewBackgroundColor} onChange={(color) => updateData({ viewBackgroundColor: color })} isActive={appState.openPopup === \"canvasColorPicker\"} setActive={(active) => updateData({ openPopup: active ? \"canvasColorPicker\" : null })} data-testid=\"canvas-background-picker\"/>\r\n      </div>);\r\n    },\r\n});\r\nexport const actionClearCanvas = register({\r\n    name: \"clearCanvas\",\r\n    perform: (elements, appState, _, app) => {\r\n        app.imageCache.clear();\r\n        return {\r\n            elements: elements.map((element) => newElementWith(element, { isDeleted: true })),\r\n            appState: {\r\n                ...getDefaultAppState(),\r\n                files: {},\r\n                theme: appState.theme,\r\n                elementLocked: appState.elementLocked,\r\n                exportBackground: appState.exportBackground,\r\n                exportEmbedScene: appState.exportEmbedScene,\r\n                gridSize: appState.gridSize,\r\n                showStats: appState.showStats,\r\n                pasteDialog: appState.pasteDialog,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => <ClearCanvas onConfirm={updateData}/>,\r\n});\r\nexport const actionZoomIn = register({\r\n    name: \"zoomIn\",\r\n    perform: (_elements, appState) => {\r\n        const zoom = getNewZoom(getNormalizedZoom(appState.zoom.value + ZOOM_STEP), appState.zoom, { left: appState.offsetLeft, top: appState.offsetTop }, { x: appState.width / 2, y: appState.height / 2 });\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zoom,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => (<ToolButton type=\"button\" icon={zoomIn} title={`${t(\"buttons.zoomIn\")} — ${getShortcutKey(\"CtrlOrCmd++\")}`} aria-label={t(\"buttons.zoomIn\")} onClick={() => {\r\n            updateData(null);\r\n        }} size=\"small\"/>),\r\n    keyTest: (event) => (event.code === CODES.EQUAL || event.code === CODES.NUM_ADD) &&\r\n        (event[KEYS.CTRL_OR_CMD] || event.shiftKey),\r\n});\r\nexport const actionZoomOut = register({\r\n    name: \"zoomOut\",\r\n    perform: (_elements, appState) => {\r\n        const zoom = getNewZoom(getNormalizedZoom(appState.zoom.value - ZOOM_STEP), appState.zoom, { left: appState.offsetLeft, top: appState.offsetTop }, { x: appState.width / 2, y: appState.height / 2 });\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zoom,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => (<ToolButton type=\"button\" icon={zoomOut} title={`${t(\"buttons.zoomOut\")} — ${getShortcutKey(\"CtrlOrCmd+-\")}`} aria-label={t(\"buttons.zoomOut\")} onClick={() => {\r\n            updateData(null);\r\n        }} size=\"small\"/>),\r\n    keyTest: (event) => (event.code === CODES.MINUS || event.code === CODES.NUM_SUBTRACT) &&\r\n        (event[KEYS.CTRL_OR_CMD] || event.shiftKey),\r\n});\r\nexport const actionResetZoom = register({\r\n    name: \"resetZoom\",\r\n    perform: (_elements, appState) => {\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zoom: getNewZoom(1, appState.zoom, { left: appState.offsetLeft, top: appState.offsetTop }, {\r\n                    x: appState.width / 2,\r\n                    y: appState.height / 2,\r\n                }),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData, appState }) => (<Tooltip label={t(\"buttons.resetZoom\")}>\r\n      <ToolButton type=\"button\" className=\"reset-zoom-button\" title={t(\"buttons.resetZoom\")} aria-label={t(\"buttons.resetZoom\")} onClick={() => {\r\n            updateData(null);\r\n        }} size=\"small\">\r\n        {(appState.zoom.value * 100).toFixed(0)}%\r\n      </ToolButton>\r\n    </Tooltip>),\r\n    keyTest: (event) => (event.code === CODES.ZERO || event.code === CODES.NUM_ZERO) &&\r\n        (event[KEYS.CTRL_OR_CMD] || event.shiftKey),\r\n});\r\nconst zoomValueToFitBoundsOnViewport = (bounds, viewportDimensions) => {\r\n    const [x1, y1, x2, y2] = bounds;\r\n    const commonBoundsWidth = x2 - x1;\r\n    const zoomValueForWidth = viewportDimensions.width / commonBoundsWidth;\r\n    const commonBoundsHeight = y2 - y1;\r\n    const zoomValueForHeight = viewportDimensions.height / commonBoundsHeight;\r\n    const smallestZoomValue = Math.min(zoomValueForWidth, zoomValueForHeight);\r\n    const zoomAdjustedToSteps = Math.floor(smallestZoomValue / ZOOM_STEP) * ZOOM_STEP;\r\n    const clampedZoomValueToFitElements = Math.min(Math.max(zoomAdjustedToSteps, ZOOM_STEP), 1);\r\n    return clampedZoomValueToFitElements;\r\n};\r\nconst zoomToFitElements = (elements, appState, zoomToSelection) => {\r\n    const nonDeletedElements = getNonDeletedElements(elements);\r\n    const selectedElements = getSelectedElements(nonDeletedElements, appState);\r\n    const commonBounds = zoomToSelection && selectedElements.length > 0\r\n        ? getCommonBounds(selectedElements)\r\n        : getCommonBounds(nonDeletedElements);\r\n    const zoomValue = zoomValueToFitBoundsOnViewport(commonBounds, {\r\n        width: appState.width,\r\n        height: appState.height,\r\n    });\r\n    const newZoom = getNewZoom(zoomValue, appState.zoom, {\r\n        left: appState.offsetLeft,\r\n        top: appState.offsetTop,\r\n    });\r\n    const [x1, y1, x2, y2] = commonBounds;\r\n    const centerX = (x1 + x2) / 2;\r\n    const centerY = (y1 + y2) / 2;\r\n    return {\r\n        appState: {\r\n            ...appState,\r\n            ...centerScrollOn({\r\n                scenePoint: { x: centerX, y: centerY },\r\n                viewportDimensions: {\r\n                    width: appState.width,\r\n                    height: appState.height,\r\n                },\r\n                zoom: newZoom,\r\n            }),\r\n            zoom: newZoom,\r\n        },\r\n        commitToHistory: false,\r\n    };\r\n};\r\nexport const actionZoomToSelected = register({\r\n    name: \"zoomToSelection\",\r\n    perform: (elements, appState) => zoomToFitElements(elements, appState, true),\r\n    keyTest: (event) => event.code === CODES.TWO &&\r\n        event.shiftKey &&\r\n        !event.altKey &&\r\n        !event[KEYS.CTRL_OR_CMD],\r\n});\r\nexport const actionZoomToFit = register({\r\n    name: \"zoomToFit\",\r\n    perform: (elements, appState) => zoomToFitElements(elements, appState, false),\r\n    keyTest: (event) => event.code === CODES.ONE &&\r\n        event.shiftKey &&\r\n        !event.altKey &&\r\n        !event[KEYS.CTRL_OR_CMD],\r\n});\r\nexport const actionToggleTheme = register({\r\n    name: \"toggleTheme\",\r\n    perform: (_, appState, value) => {\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                theme: value || (appState.theme === THEME.LIGHT ? THEME.DARK : THEME.LIGHT),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<div style={{ marginInlineStart: \"0.25rem\" }}>\r\n      <DarkModeToggle value={appState.theme} onChange={(theme) => {\r\n            updateData(theme);\r\n        }}/>\r\n    </div>),\r\n    keyTest: (event) => event.altKey && event.shiftKey && event.code === CODES.D,\r\n});\r\n","import { KEYS } from \"../keys\";\r\nimport { isInvisiblySmallElement } from \"../element\";\r\nimport { resetCursor } from \"../utils\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { done } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport { register } from \"./register\";\r\nimport { mutateElement } from \"../element/mutateElement\";\r\nimport { isPathALoop } from \"../math\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { maybeBindLinearElement, bindOrUnbindLinearElement, } from \"../element/binding\";\r\nimport { isBindingElement } from \"../element/typeChecks\";\r\nexport const actionFinalize = register({\r\n    name: \"finalize\",\r\n    perform: (elements, appState, _, { canvas, focusContainer }) => {\r\n        if (appState.editingLinearElement) {\r\n            const { elementId, startBindingElement, endBindingElement } = appState.editingLinearElement;\r\n            const element = LinearElementEditor.getElement(elementId);\r\n            if (element) {\r\n                if (isBindingElement(element)) {\r\n                    bindOrUnbindLinearElement(element, startBindingElement, endBindingElement);\r\n                }\r\n                return {\r\n                    elements: element.points.length < 2 || isInvisiblySmallElement(element)\r\n                        ? elements.filter((el) => el.id !== element.id)\r\n                        : undefined,\r\n                    appState: {\r\n                        ...appState,\r\n                        editingLinearElement: null,\r\n                    },\r\n                    commitToHistory: true,\r\n                };\r\n            }\r\n        }\r\n        let newElements = elements;\r\n        if (appState.pendingImageElement) {\r\n            mutateElement(appState.pendingImageElement, { isDeleted: true }, false);\r\n        }\r\n        if (window.document.activeElement instanceof HTMLElement) {\r\n            focusContainer();\r\n        }\r\n        const multiPointElement = appState.multiElement\r\n            ? appState.multiElement\r\n            : appState.editingElement?.type === \"freedraw\"\r\n                ? appState.editingElement\r\n                : null;\r\n        if (multiPointElement) {\r\n            // pen and mouse have hover\r\n            if (multiPointElement.type !== \"freedraw\" &&\r\n                appState.lastPointerDownWith !== \"touch\") {\r\n                const { points, lastCommittedPoint } = multiPointElement;\r\n                if (!lastCommittedPoint ||\r\n                    points[points.length - 1] !== lastCommittedPoint) {\r\n                    mutateElement(multiPointElement, {\r\n                        points: multiPointElement.points.slice(0, -1),\r\n                    });\r\n                }\r\n            }\r\n            if (isInvisiblySmallElement(multiPointElement)) {\r\n                newElements = newElements.slice(0, -1);\r\n            }\r\n            // If the multi point line closes the loop,\r\n            // set the last point to first point.\r\n            // This ensures that loop remains closed at different scales.\r\n            const isLoop = isPathALoop(multiPointElement.points, appState.zoom.value);\r\n            if (multiPointElement.type === \"line\" ||\r\n                multiPointElement.type === \"freedraw\") {\r\n                if (isLoop) {\r\n                    const linePoints = multiPointElement.points;\r\n                    const firstPoint = linePoints[0];\r\n                    mutateElement(multiPointElement, {\r\n                        points: linePoints.map((point, index) => index === linePoints.length - 1\r\n                            ? [firstPoint[0], firstPoint[1]]\r\n                            : point),\r\n                    });\r\n                }\r\n            }\r\n            if (isBindingElement(multiPointElement) &&\r\n                !isLoop &&\r\n                multiPointElement.points.length > 1) {\r\n                const [x, y] = LinearElementEditor.getPointAtIndexGlobalCoordinates(multiPointElement, -1);\r\n                maybeBindLinearElement(multiPointElement, appState, Scene.getScene(multiPointElement), { x, y });\r\n            }\r\n            if (!appState.elementLocked && appState.elementType !== \"freedraw\") {\r\n                appState.selectedElementIds[multiPointElement.id] = true;\r\n            }\r\n        }\r\n        if ((!appState.elementLocked && appState.elementType !== \"freedraw\") ||\r\n            !multiPointElement) {\r\n            resetCursor(canvas);\r\n        }\r\n        return {\r\n            elements: newElements,\r\n            appState: {\r\n                ...appState,\r\n                elementType: (appState.elementLocked || appState.elementType === \"freedraw\") &&\r\n                    multiPointElement\r\n                    ? appState.elementType\r\n                    : \"selection\",\r\n                draggingElement: null,\r\n                multiElement: null,\r\n                editingElement: null,\r\n                startBoundElement: null,\r\n                suggestedBindings: [],\r\n                selectedElementIds: multiPointElement &&\r\n                    !appState.elementLocked &&\r\n                    appState.elementType !== \"freedraw\"\r\n                    ? {\r\n                        ...appState.selectedElementIds,\r\n                        [multiPointElement.id]: true,\r\n                    }\r\n                    : appState.selectedElementIds,\r\n                pendingImageElement: null,\r\n            },\r\n            commitToHistory: appState.elementType === \"freedraw\",\r\n        };\r\n    },\r\n    keyTest: (event, appState) => (event.key === KEYS.ESCAPE &&\r\n        (appState.editingLinearElement !== null ||\r\n            (!appState.draggingElement && appState.multiElement === null))) ||\r\n        ((event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) &&\r\n            appState.multiElement !== null),\r\n    PanelComponent: ({ appState, updateData }) => (<ToolButton type=\"button\" icon={done} title={t(\"buttons.done\")} aria-label={t(\"buttons.done\")} onClick={updateData} visible={appState.multiElement != null}/>),\r\n});\r\n","import \"./TextInput.scss\";\r\nimport React, { useState } from \"react\";\r\nimport { focusNearestParent } from \"../utils\";\r\nimport \"./ProjectName.scss\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nexport const ProjectName = (props) => {\r\n    const { id } = useExcalidrawContainer();\r\n    const [fileName, setFileName] = useState(props.value);\r\n    const handleBlur = (event) => {\r\n        focusNearestParent(event.target);\r\n        const value = event.target.value;\r\n        if (value !== props.value) {\r\n            props.onChange(value);\r\n        }\r\n    };\r\n    const handleKeyDown = (event) => {\r\n        if (event.key === \"Enter\") {\r\n            event.preventDefault();\r\n            if (event.nativeEvent.isComposing || event.keyCode === 229) {\r\n                return;\r\n            }\r\n            event.currentTarget.blur();\r\n        }\r\n    };\r\n    return (<div className=\"ProjectName\">\r\n      <label className=\"ProjectName-label\" htmlFor=\"filename\">\r\n        {`${props.label}${props.isNameEditable ? \"\" : \":\"}`}\r\n      </label>\r\n      {props.isNameEditable ? (<input className=\"TextInput\" onBlur={handleBlur} onKeyDown={handleKeyDown} id={`${id}-filename`} value={fileName} onChange={(event) => setFileName(event.target.value)}/>) : (<span className=\"TextInput TextInput--readonly\" id={`${id}-filename`}>\r\n          {props.value}\r\n        </span>)}\r\n    </div>);\r\n};\r\n","/**\r\n * https://stackoverflow.com/a/3368118\r\n * Draws a rounded rectangle using the current state of the canvas.\r\n * @param {CanvasRenderingContext2D} context\r\n * @param {Number} x The top left x coordinate\r\n * @param {Number} y The top left y coordinate\r\n * @param {Number} width The width of the rectangle\r\n * @param {Number} height The height of the rectangle\r\n * @param {Number} radius The corner radius\r\n */\r\nexport const roundRect = (context, x, y, width, height, radius) => {\r\n    context.beginPath();\r\n    context.moveTo(x + radius, y);\r\n    context.lineTo(x + width - radius, y);\r\n    context.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n    context.lineTo(x + width, y + height - radius);\r\n    context.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n    context.lineTo(x + radius, y + height);\r\n    context.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n    context.lineTo(x, y + radius);\r\n    context.quadraticCurveTo(x, y, x + radius, y);\r\n    context.closePath();\r\n    context.fill();\r\n    context.stroke();\r\n};\r\n","import colors from \"./colors\";\r\nexport const getClientColors = (clientId, appState) => {\r\n    if (appState?.collaborators) {\r\n        const currentUser = appState.collaborators.get(clientId);\r\n        if (currentUser?.color) {\r\n            return currentUser.color;\r\n        }\r\n    }\r\n    // Naive way of getting an integer out of the clientId\r\n    const sum = clientId.split(\"\").reduce((a, str) => a + str.charCodeAt(0), 0);\r\n    // Skip transparent background.\r\n    const backgrounds = colors.elementBackground.slice(1);\r\n    const strokes = colors.elementStroke.slice(1);\r\n    return {\r\n        background: backgrounds[sum % backgrounds.length],\r\n        stroke: strokes[sum % strokes.length],\r\n    };\r\n};\r\nexport const getClientInitials = (username) => {\r\n    if (!username) {\r\n        return \"?\";\r\n    }\r\n    const names = username.trim().split(\" \");\r\n    if (names.length < 2) {\r\n        return names[0].substring(0, 2).toUpperCase();\r\n    }\r\n    const firstName = names[0];\r\n    const lastName = names[names.length - 1];\r\n    return (firstName[0] + lastName[0]).toUpperCase();\r\n};\r\n","import oc from \"open-color\";\r\nimport {\r\n  getElementAbsoluteCoords,\r\n  OMIT_SIDES_FOR_MULTIPLE_ELEMENTS,\r\n  getTransformHandlesFromCoords,\r\n  getTransformHandles,\r\n  getElementBounds,\r\n  getCommonBounds,\r\n} from \"../element\";\r\nimport { roundRect } from \"./roundRect\";\r\nimport {\r\n  getScrollBars,\r\n  SCROLLBAR_COLOR,\r\n  SCROLLBAR_WIDTH,\r\n} from \"../scene/scrollbars\";\r\nimport { getSelectedElements } from \"../scene/selection\";\r\nimport { renderElement, renderElementToSvg } from \"./renderElement\";\r\nimport { getClientColors } from \"../clients\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport {\r\n  isSelectedViaGroup,\r\n  getSelectedGroupIds,\r\n  getElementsInGroup,\r\n} from \"../groups\";\r\nimport { maxBindingGap } from \"../element/collision\";\r\nimport { isBindingEnabled } from \"../element/binding\";\r\nimport { viewportCoordsToSceneCoords, supportsEmoji } from \"../utils\";\r\nimport { UserIdleState } from \"../types\";\r\nimport { THEME_FILTER } from \"../constants\";\r\nconst hasEmojiSupport = supportsEmoji();\r\nconst strokeRectWithRotation = (\r\n  context,\r\n  x,\r\n  y,\r\n  width,\r\n  height,\r\n  cx,\r\n  cy,\r\n  angle,\r\n  fill = false\r\n) => {\r\n  context.save();\r\n  context.translate(cx, cy);\r\n  context.rotate(angle);\r\n  if (fill) {\r\n    context.fillRect(x - cx, y - cy, width, height);\r\n  }\r\n  context.strokeRect(x - cx, y - cy, width, height);\r\n  context.restore();\r\n};\r\nconst strokeDiamondWithRotation = (context, width, height, cx, cy, angle) => {\r\n  context.save();\r\n  context.translate(cx, cy);\r\n  context.rotate(angle);\r\n  context.beginPath();\r\n  context.moveTo(0, height / 2);\r\n  context.lineTo(width / 2, 0);\r\n  context.lineTo(0, -height / 2);\r\n  context.lineTo(-width / 2, 0);\r\n  context.closePath();\r\n  context.stroke();\r\n  context.restore();\r\n};\r\nconst strokeEllipseWithRotation = (context, width, height, cx, cy, angle) => {\r\n  context.beginPath();\r\n  context.ellipse(cx, cy, width / 2, height / 2, angle, 0, Math.PI * 2);\r\n  context.stroke();\r\n};\r\nconst fillCircle = (context, cx, cy, radius) => {\r\n  context.beginPath();\r\n  context.arc(cx, cy, radius, 0, Math.PI * 2);\r\n  context.fill();\r\n  context.stroke();\r\n};\r\nconst strokeGrid = (context, gridSize, offsetX, offsetY, width, height) => {\r\n  context.save();\r\n  context.strokeStyle = \"rgba(0,0,0,0.1)\";\r\n  context.beginPath();\r\n  for (let x = offsetX; x < offsetX + width + gridSize * 2; x += gridSize) {\r\n    context.moveTo(x, offsetY - gridSize);\r\n    context.lineTo(x, offsetY + height + gridSize * 2);\r\n  }\r\n  for (let y = offsetY; y < offsetY + height + gridSize * 2; y += gridSize) {\r\n    context.moveTo(offsetX - gridSize, y);\r\n    context.lineTo(offsetX + width + gridSize * 2, y);\r\n  }\r\n  context.stroke();\r\n  context.restore();\r\n};\r\nconst renderLinearPointHandles = (context, appState, sceneState, element) => {\r\n  context.save();\r\n  context.translate(sceneState.scrollX, sceneState.scrollY);\r\n  context.lineWidth = 1 / sceneState.zoom.value;\r\n  LinearElementEditor.getPointsGlobalCoordinates(element).forEach(\r\n    (point, idx) => {\r\n      context.strokeStyle = \"red\";\r\n      context.setLineDash([]);\r\n      context.fillStyle =\r\n        appState.editingLinearElement?.activePointIndex === idx\r\n          ? \"rgba(255, 127, 127, 0.9)\"\r\n          : \"rgba(255, 255, 255, 0.9)\";\r\n      const { POINT_HANDLE_SIZE } = LinearElementEditor;\r\n      fillCircle(\r\n        context,\r\n        point[0],\r\n        point[1],\r\n        POINT_HANDLE_SIZE / 2 / sceneState.zoom.value\r\n      );\r\n    }\r\n  );\r\n  context.restore();\r\n};\r\nexport const renderScene = (\r\n  elements,\r\n  appState,\r\n  selectionElement,\r\n  scale,\r\n  rc,\r\n  canvas,\r\n  sceneState,\r\n  // extra options passed to the renderer\r\n  {\r\n    renderScrollbars = true,\r\n    renderSelection = true,\r\n    // Whether to employ render optimizations to improve performance.\r\n    // Should not be turned on for export operations and similar, because it\r\n    // doesn't guarantee pixel-perfect output.\r\n    renderOptimizations = false,\r\n    renderGrid = true,\r\n    /** when exporting the behavior is slightly different (e.g. we can't use\r\n    CSS filters) */\r\n    isExport = false,\r\n  } = {}\r\n) => {\r\n  if (canvas === null) {\r\n    return { atLeastOneVisibleElement: false };\r\n  }\r\n  const context = canvas.getContext(\"2d\");\r\n  context.setTransform(1, 0, 0, 1, 0, 0);\r\n  context.save();\r\n  context.scale(scale, scale);\r\n  // When doing calculations based on canvas width we should used normalized one\r\n  const normalizedCanvasWidth = canvas.width / scale;\r\n  const normalizedCanvasHeight = canvas.height / scale;\r\n//   if (isExport && sceneState.theme === \"dark\") {\r\n//     context.filter = THEME_FILTER;\r\n//   }\r\n  sceneState.viewBackgroundColor = \"transparent\"\r\n  // Paint background\r\n  if (typeof sceneState.viewBackgroundColor === \"string\") {\r\n    const hasTransparence =\r\n      sceneState.viewBackgroundColor === \"transparent\" ||\r\n      sceneState.viewBackgroundColor.length === 5 || // #RGBA\r\n      sceneState.viewBackgroundColor.length === 9 || // #RRGGBBA\r\n      /(hsla|rgba)\\(/.test(sceneState.viewBackgroundColor);\r\n    if (hasTransparence) {\r\n      context.clearRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\r\n    }\r\n    context.save();\r\n    context.fillStyle = sceneState.viewBackgroundColor;\r\n    context.fillRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\r\n    context.restore();\r\n  } else {\r\n    context.clearRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\r\n  }\r\n  // Apply zoom\r\n  const zoomTranslationX = sceneState.zoom.translation.x;\r\n  const zoomTranslationY = sceneState.zoom.translation.y;\r\n  context.save();\r\n  context.translate(zoomTranslationX, zoomTranslationY);\r\n  context.scale(sceneState.zoom.value, sceneState.zoom.value);\r\n  // Grid\r\n  if (renderGrid && appState.gridSize) {\r\n    strokeGrid(\r\n      context,\r\n      appState.gridSize,\r\n      -Math.ceil(zoomTranslationX / sceneState.zoom.value / appState.gridSize) *\r\n        appState.gridSize +\r\n        (sceneState.scrollX % appState.gridSize),\r\n      -Math.ceil(zoomTranslationY / sceneState.zoom.value / appState.gridSize) *\r\n        appState.gridSize +\r\n        (sceneState.scrollY % appState.gridSize),\r\n      normalizedCanvasWidth / sceneState.zoom.value,\r\n      normalizedCanvasHeight / sceneState.zoom.value\r\n    );\r\n  }\r\n  // Paint visible elements\r\n  const visibleElements = elements.filter((element) =>\r\n    isVisibleElement(element, normalizedCanvasWidth, normalizedCanvasHeight, {\r\n      zoom: sceneState.zoom,\r\n      offsetLeft: appState.offsetLeft,\r\n      offsetTop: appState.offsetTop,\r\n      scrollX: sceneState.scrollX,\r\n      scrollY: sceneState.scrollY,\r\n    })\r\n  );\r\n  visibleElements.forEach((element) => {\r\n    try {\r\n      renderElement(element, rc, context, renderOptimizations, sceneState);\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  });\r\n  if (appState.editingLinearElement) {\r\n    const element = LinearElementEditor.getElement(\r\n      appState.editingLinearElement.elementId\r\n    );\r\n    if (element) {\r\n      renderLinearPointHandles(context, appState, sceneState, element);\r\n    }\r\n  }\r\n  // Paint selection element\r\n  if (selectionElement) {\r\n    try {\r\n      renderElement(\r\n        selectionElement,\r\n        rc,\r\n        context,\r\n        renderOptimizations,\r\n        sceneState\r\n      );\r\n    } catch (error) {\r\n      console.error(error);\r\n    }\r\n  }\r\n  if (isBindingEnabled(appState)) {\r\n    appState.suggestedBindings\r\n      .filter((binding) => binding != null)\r\n      .forEach((suggestedBinding) => {\r\n        renderBindingHighlight(context, sceneState, suggestedBinding);\r\n      });\r\n  }\r\n  // Paint selected elements\r\n  if (\r\n    renderSelection &&\r\n    !appState.multiElement &&\r\n    !appState.editingLinearElement\r\n  ) {\r\n    const selections = elements.reduce((acc, element) => {\r\n      const selectionColors = [];\r\n      // local user\r\n      if (\r\n        appState.selectedElementIds[element.id] &&\r\n        !isSelectedViaGroup(appState, element)\r\n      ) {\r\n        selectionColors.push(oc.black);\r\n      }\r\n      // remote users\r\n      if (sceneState.remoteSelectedElementIds[element.id]) {\r\n        selectionColors.push(\r\n          ...sceneState.remoteSelectedElementIds[element.id].map((socketId) => {\r\n            const { background } = getClientColors(socketId, appState);\r\n            return background;\r\n          })\r\n        );\r\n      }\r\n      if (selectionColors.length) {\r\n        const [elementX1, elementY1, elementX2, elementY2] =\r\n          getElementAbsoluteCoords(element);\r\n        acc.push({\r\n          angle: element.angle,\r\n          elementX1,\r\n          elementY1,\r\n          elementX2,\r\n          elementY2,\r\n          selectionColors,\r\n        });\r\n      }\r\n      return acc;\r\n    }, []);\r\n    const addSelectionForGroupId = (groupId) => {\r\n      const groupElements = getElementsInGroup(elements, groupId);\r\n      const [elementX1, elementY1, elementX2, elementY2] =\r\n        getCommonBounds(groupElements);\r\n      selections.push({\r\n        angle: 0,\r\n        elementX1,\r\n        elementX2,\r\n        elementY1,\r\n        elementY2,\r\n        selectionColors: [oc.black],\r\n      });\r\n    };\r\n    for (const groupId of getSelectedGroupIds(appState)) {\r\n      // TODO: support multiplayer selected group IDs\r\n      addSelectionForGroupId(groupId);\r\n    }\r\n    if (appState.editingGroupId) {\r\n      addSelectionForGroupId(appState.editingGroupId);\r\n    }\r\n    selections.forEach((selection) =>\r\n      renderSelectionBorder(context, sceneState, selection)\r\n    );\r\n    const locallySelectedElements = getSelectedElements(elements, appState);\r\n    // Paint resize transformHandles\r\n    context.save();\r\n    context.translate(sceneState.scrollX, sceneState.scrollY);\r\n    if (locallySelectedElements.length === 1) {\r\n      context.fillStyle = oc.white;\r\n      const transformHandles = getTransformHandles(\r\n        locallySelectedElements[0],\r\n        sceneState.zoom,\r\n        \"mouse\"\r\n      );\r\n      if (!appState.viewModeEnabled) {\r\n        renderTransformHandles(\r\n          context,\r\n          sceneState,\r\n          transformHandles,\r\n          locallySelectedElements[0].angle\r\n        );\r\n      }\r\n    } else if (locallySelectedElements.length > 1 && !appState.isRotating) {\r\n      const dashedLinePadding = 4 / sceneState.zoom.value;\r\n      context.fillStyle = oc.white;\r\n      const [x1, y1, x2, y2] = getCommonBounds(locallySelectedElements);\r\n      const initialLineDash = context.getLineDash();\r\n      context.setLineDash([2 / sceneState.zoom.value]);\r\n      const lineWidth = context.lineWidth;\r\n      context.lineWidth = 1 / sceneState.zoom.value;\r\n      strokeRectWithRotation(\r\n        context,\r\n        x1 - dashedLinePadding,\r\n        y1 - dashedLinePadding,\r\n        x2 - x1 + dashedLinePadding * 2,\r\n        y2 - y1 + dashedLinePadding * 2,\r\n        (x1 + x2) / 2,\r\n        (y1 + y2) / 2,\r\n        0\r\n      );\r\n      context.lineWidth = lineWidth;\r\n      context.setLineDash(initialLineDash);\r\n      const transformHandles = getTransformHandlesFromCoords(\r\n        [x1, y1, x2, y2],\r\n        0,\r\n        sceneState.zoom,\r\n        \"mouse\",\r\n        OMIT_SIDES_FOR_MULTIPLE_ELEMENTS\r\n      );\r\n      renderTransformHandles(context, sceneState, transformHandles, 0);\r\n    }\r\n    context.restore();\r\n  }\r\n  // Reset zoom\r\n  context.restore();\r\n  // Paint remote pointers\r\n  for (const clientId in sceneState.remotePointerViewportCoords) {\r\n    let { x, y } = sceneState.remotePointerViewportCoords[clientId];\r\n    x -= appState.offsetLeft;\r\n    y -= appState.offsetTop;\r\n    const width = 9;\r\n    const height = 14;\r\n    const isOutOfBounds =\r\n      x < 0 ||\r\n      x > normalizedCanvasWidth - width ||\r\n      y < 0 ||\r\n      y > normalizedCanvasHeight - height;\r\n    x = Math.max(x, 0);\r\n    x = Math.min(x, normalizedCanvasWidth - width);\r\n    y = Math.max(y, 0);\r\n    y = Math.min(y, normalizedCanvasHeight - height);\r\n    const { background, stroke } = getClientColors(clientId, appState);\r\n    context.save();\r\n    context.strokeStyle = stroke;\r\n    context.fillStyle = background;\r\n    const userState = sceneState.remotePointerUserStates[clientId];\r\n    if (isOutOfBounds || userState === UserIdleState.AWAY) {\r\n      context.globalAlpha = 0.48;\r\n    }\r\n    if (\r\n      sceneState.remotePointerButton &&\r\n      sceneState.remotePointerButton[clientId] === \"down\"\r\n    ) {\r\n      context.beginPath();\r\n      context.arc(x, y, 15, 0, 2 * Math.PI, false);\r\n      context.lineWidth = 3;\r\n      context.strokeStyle = \"#ffffff88\";\r\n      context.stroke();\r\n      context.closePath();\r\n      context.beginPath();\r\n      context.arc(x, y, 15, 0, 2 * Math.PI, false);\r\n      context.lineWidth = 1;\r\n      context.strokeStyle = stroke;\r\n      context.stroke();\r\n      context.closePath();\r\n    }\r\n    context.beginPath();\r\n    context.moveTo(x, y);\r\n    context.lineTo(x + 1, y + 14);\r\n    context.lineTo(x + 4, y + 9);\r\n    context.lineTo(x + 9, y + 10);\r\n    context.lineTo(x, y);\r\n    context.fill();\r\n    context.stroke();\r\n    const username = sceneState.remotePointerUsernames[clientId];\r\n    let idleState = \"\";\r\n    if (userState === UserIdleState.AWAY) {\r\n      idleState = hasEmojiSupport ? \"⚫️\" : ` (${UserIdleState.AWAY})`;\r\n    } else if (userState === UserIdleState.IDLE) {\r\n      idleState = hasEmojiSupport ? \"💤\" : ` (${UserIdleState.IDLE})`;\r\n    } else if (userState === UserIdleState.ACTIVE) {\r\n      idleState = hasEmojiSupport ? \"🟢\" : \"\";\r\n    }\r\n    const usernameAndIdleState = `${\r\n      username ? `${username} ` : \"\"\r\n    }${idleState}`;\r\n    if (!isOutOfBounds && usernameAndIdleState) {\r\n      const offsetX = x + width;\r\n      const offsetY = y + height;\r\n      const paddingHorizontal = 4;\r\n      const paddingVertical = 4;\r\n      const measure = context.measureText(usernameAndIdleState);\r\n      const measureHeight =\r\n        measure.actualBoundingBoxDescent + measure.actualBoundingBoxAscent;\r\n      // Border\r\n      context.fillStyle = stroke;\r\n      context.fillRect(\r\n        offsetX - 1,\r\n        offsetY - 1,\r\n        measure.width + 2 * paddingHorizontal + 2,\r\n        measureHeight + 2 * paddingVertical + 2\r\n      );\r\n      // Background\r\n      context.fillStyle = background;\r\n      context.fillRect(\r\n        offsetX,\r\n        offsetY,\r\n        measure.width + 2 * paddingHorizontal,\r\n        measureHeight + 2 * paddingVertical\r\n      );\r\n      context.fillStyle = oc.white;\r\n      context.fillText(\r\n        usernameAndIdleState,\r\n        offsetX + paddingHorizontal,\r\n        offsetY + paddingVertical + measure.actualBoundingBoxAscent\r\n      );\r\n    }\r\n    context.restore();\r\n    context.closePath();\r\n  }\r\n  // Paint scrollbars\r\n  let scrollBars;\r\n  if (renderScrollbars) {\r\n    scrollBars = getScrollBars(\r\n      elements,\r\n      normalizedCanvasWidth,\r\n      normalizedCanvasHeight,\r\n      sceneState\r\n    );\r\n    context.save();\r\n    context.fillStyle = SCROLLBAR_COLOR;\r\n    context.strokeStyle = \"rgba(255,255,255,0.8)\";\r\n    [scrollBars.horizontal, scrollBars.vertical].forEach((scrollBar) => {\r\n      if (scrollBar) {\r\n        roundRect(\r\n          context,\r\n          scrollBar.x,\r\n          scrollBar.y,\r\n          scrollBar.width,\r\n          scrollBar.height,\r\n          SCROLLBAR_WIDTH / 2\r\n        );\r\n      }\r\n    });\r\n    context.restore();\r\n  }\r\n  context.restore();\r\n  return { atLeastOneVisibleElement: visibleElements.length > 0, scrollBars };\r\n};\r\nconst renderTransformHandles = (\r\n  context,\r\n  sceneState,\r\n  transformHandles,\r\n  angle\r\n) => {\r\n  Object.keys(transformHandles).forEach((key) => {\r\n    const transformHandle = transformHandles[key];\r\n    if (transformHandle !== undefined) {\r\n      context.save();\r\n      context.lineWidth = 1 / sceneState.zoom.value;\r\n      if (key === \"rotation\") {\r\n        fillCircle(\r\n          context,\r\n          transformHandle[0] + transformHandle[2] / 2,\r\n          transformHandle[1] + transformHandle[3] / 2,\r\n          transformHandle[2] / 2\r\n        );\r\n      } else {\r\n        strokeRectWithRotation(\r\n          context,\r\n          transformHandle[0],\r\n          transformHandle[1],\r\n          transformHandle[2],\r\n          transformHandle[3],\r\n          transformHandle[0] + transformHandle[2] / 2,\r\n          transformHandle[1] + transformHandle[3] / 2,\r\n          angle,\r\n          true\r\n        );\r\n      }\r\n      context.restore();\r\n    }\r\n  });\r\n};\r\nconst renderSelectionBorder = (context, sceneState, elementProperties) => {\r\n  const { angle, elementX1, elementY1, elementX2, elementY2, selectionColors } =\r\n    elementProperties;\r\n  const elementWidth = elementX2 - elementX1;\r\n  const elementHeight = elementY2 - elementY1;\r\n  const dashedLinePadding = 4 / sceneState.zoom.value;\r\n  const dashWidth = 8 / sceneState.zoom.value;\r\n  const spaceWidth = 4 / sceneState.zoom.value;\r\n  context.save();\r\n  context.translate(sceneState.scrollX, sceneState.scrollY);\r\n  context.lineWidth = 1 / sceneState.zoom.value;\r\n  const count = selectionColors.length;\r\n  for (let index = 0; index < count; ++index) {\r\n    context.strokeStyle = selectionColors[index];\r\n    context.setLineDash([\r\n      dashWidth,\r\n      spaceWidth + (dashWidth + spaceWidth) * (count - 1),\r\n    ]);\r\n    context.lineDashOffset = (dashWidth + spaceWidth) * index;\r\n    strokeRectWithRotation(\r\n      context,\r\n      elementX1 - dashedLinePadding,\r\n      elementY1 - dashedLinePadding,\r\n      elementWidth + dashedLinePadding * 2,\r\n      elementHeight + dashedLinePadding * 2,\r\n      elementX1 + elementWidth / 2,\r\n      elementY1 + elementHeight / 2,\r\n      angle\r\n    );\r\n  }\r\n  context.restore();\r\n};\r\nconst renderBindingHighlight = (context, sceneState, suggestedBinding) => {\r\n  const renderHighlight = Array.isArray(suggestedBinding)\r\n    ? renderBindingHighlightForSuggestedPointBinding\r\n    : renderBindingHighlightForBindableElement;\r\n  context.save();\r\n  context.translate(sceneState.scrollX, sceneState.scrollY);\r\n  renderHighlight(context, suggestedBinding);\r\n  context.restore();\r\n};\r\nconst renderBindingHighlightForBindableElement = (context, element) => {\r\n  const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n  const width = x2 - x1;\r\n  const height = y2 - y1;\r\n  const threshold = maxBindingGap(element, width, height);\r\n  // So that we don't overlap the element itself\r\n  const strokeOffset = 4;\r\n  context.strokeStyle = \"rgba(0,0,0,.05)\";\r\n  context.lineWidth = threshold - strokeOffset;\r\n  const padding = strokeOffset / 2 + threshold / 2;\r\n  switch (element.type) {\r\n    case \"rectangle\":\r\n    case \"text\":\r\n      strokeRectWithRotation(\r\n        context,\r\n        x1 - padding,\r\n        y1 - padding,\r\n        width + padding * 2,\r\n        height + padding * 2,\r\n        x1 + width / 2,\r\n        y1 + height / 2,\r\n        element.angle\r\n      );\r\n      break;\r\n    case \"diamond\":\r\n      const side = Math.hypot(width, height);\r\n      const wPadding = (padding * side) / height;\r\n      const hPadding = (padding * side) / width;\r\n      strokeDiamondWithRotation(\r\n        context,\r\n        width + wPadding * 2,\r\n        height + hPadding * 2,\r\n        x1 + width / 2,\r\n        y1 + height / 2,\r\n        element.angle\r\n      );\r\n      break;\r\n    case \"ellipse\":\r\n      strokeEllipseWithRotation(\r\n        context,\r\n        width + padding * 2,\r\n        height + padding * 2,\r\n        x1 + width / 2,\r\n        y1 + height / 2,\r\n        element.angle\r\n      );\r\n      break;\r\n  }\r\n};\r\nconst renderBindingHighlightForSuggestedPointBinding = (\r\n  context,\r\n  suggestedBinding\r\n) => {\r\n  const [element, startOrEnd, bindableElement] = suggestedBinding;\r\n  const threshold = maxBindingGap(\r\n    bindableElement,\r\n    bindableElement.width,\r\n    bindableElement.height\r\n  );\r\n  context.strokeStyle = \"rgba(0,0,0,0)\";\r\n  context.fillStyle = \"rgba(0,0,0,.05)\";\r\n  const pointIndices =\r\n    startOrEnd === \"both\" ? [0, -1] : startOrEnd === \"start\" ? [0] : [-1];\r\n  pointIndices.forEach((index) => {\r\n    const [x, y] = LinearElementEditor.getPointAtIndexGlobalCoordinates(\r\n      element,\r\n      index\r\n    );\r\n    fillCircle(context, x, y, threshold);\r\n  });\r\n};\r\nconst isVisibleElement = (\r\n  element,\r\n  canvasWidth,\r\n  canvasHeight,\r\n  viewTransformations\r\n) => {\r\n  const [x1, y1, x2, y2] = getElementBounds(element); // scene coordinates\r\n  const topLeftSceneCoords = viewportCoordsToSceneCoords(\r\n    {\r\n      clientX: viewTransformations.offsetLeft,\r\n      clientY: viewTransformations.offsetTop,\r\n    },\r\n    viewTransformations\r\n  );\r\n  const bottomRightSceneCoords = viewportCoordsToSceneCoords(\r\n    {\r\n      clientX: viewTransformations.offsetLeft + canvasWidth,\r\n      clientY: viewTransformations.offsetTop + canvasHeight,\r\n    },\r\n    viewTransformations\r\n  );\r\n  return (\r\n    topLeftSceneCoords.x <= x2 &&\r\n    topLeftSceneCoords.y <= y2 &&\r\n    bottomRightSceneCoords.x >= x1 &&\r\n    bottomRightSceneCoords.y >= y1\r\n  );\r\n};\r\n// This should be only called for exporting purposes\r\nexport const renderSceneToSvg = (\r\n  elements,\r\n  rsvg,\r\n  svgRoot,\r\n  files,\r\n  { offsetX = 0, offsetY = 0 } = {}\r\n) => {\r\n  if (!svgRoot) {\r\n    return;\r\n  }\r\n  // render elements\r\n  elements.forEach((element) => {\r\n    if (!element.isDeleted) {\r\n      try {\r\n        renderElementToSvg(\r\n          element,\r\n          rsvg,\r\n          svgRoot,\r\n          files,\r\n          element.x + offsetX,\r\n          element.y + offsetY\r\n        );\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    }\r\n  });\r\n};\r\n","import { fileOpen as _fileOpen, fileSave as _fileSave, supported as nativeFileSystemSupported, } from \"browser-fs-access\";\r\nimport { EVENT, MIME_TYPES } from \"../constants\";\r\nimport { AbortError } from \"../errors\";\r\nimport { debounce } from \"../utils\";\r\nconst INPUT_CHANGE_INTERVAL_MS = 500;\r\nexport const fileOpen = (opts) => {\r\n    const mimeTypes = opts.extensions?.reduce((mimeTypes, type) => {\r\n        mimeTypes.push(MIME_TYPES[type]);\r\n        return mimeTypes;\r\n    }, []);\r\n    const extensions = opts.extensions?.reduce((acc, ext) => {\r\n        if (ext === \"jpg\") {\r\n            return acc.concat(\".jpg\", \".jpeg\");\r\n        }\r\n        return acc.concat(`.${ext}`);\r\n    }, []);\r\n    return _fileOpen({\r\n        description: opts.description,\r\n        extensions,\r\n        mimeTypes,\r\n        multiple: opts.multiple ?? false,\r\n        legacySetup: (resolve, reject, input) => {\r\n            const scheduleRejection = debounce(reject, INPUT_CHANGE_INTERVAL_MS);\r\n            const focusHandler = () => {\r\n                checkForFile();\r\n                document.addEventListener(EVENT.KEYUP, scheduleRejection);\r\n                document.addEventListener(EVENT.POINTER_UP, scheduleRejection);\r\n                scheduleRejection();\r\n            };\r\n            const checkForFile = () => {\r\n                // this hack might not work when expecting multiple files\r\n                if (input.files?.length) {\r\n                    const ret = opts.multiple ? [...input.files] : input.files[0];\r\n                    resolve(ret);\r\n                }\r\n            };\r\n            requestAnimationFrame(() => {\r\n                window.addEventListener(EVENT.FOCUS, focusHandler);\r\n            });\r\n            const interval = window.setInterval(() => {\r\n                checkForFile();\r\n            }, INPUT_CHANGE_INTERVAL_MS);\r\n            return (rejectPromise) => {\r\n                clearInterval(interval);\r\n                scheduleRejection.cancel();\r\n                window.removeEventListener(EVENT.FOCUS, focusHandler);\r\n                document.removeEventListener(EVENT.KEYUP, scheduleRejection);\r\n                document.removeEventListener(EVENT.POINTER_UP, scheduleRejection);\r\n                if (rejectPromise) {\r\n                    // so that something is shown in console if we need to debug this\r\n                    console.warn(\"Opening the file was canceled (legacy-fs).\");\r\n                    rejectPromise(new AbortError());\r\n                }\r\n            };\r\n        },\r\n    });\r\n};\r\nexport const fileSave = (blob, opts) => {\r\n    return _fileSave(blob, {\r\n        fileName: `${opts.name}.${opts.extension}`,\r\n        description: opts.description,\r\n        extensions: [`.${opts.extension}`],\r\n    }, opts.fileHandle);\r\n};\r\nexport { nativeFileSystemSupported };\r\n","import { getElementMap, getNormalizedDimensions, isInvisiblySmallElement, } from \"../element\";\r\nimport { isLinearElementType } from \"../element/typeChecks\";\r\nimport { randomId } from \"../random\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_TEXT_ALIGN, DEFAULT_VERTICAL_ALIGN, FONT_FAMILY, } from \"../constants\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { bumpVersion } from \"../element/mutateElement\";\r\nexport const AllowedExcalidrawElementTypes = {\r\n    selection: true,\r\n    text: true,\r\n    rectangle: true,\r\n    diamond: true,\r\n    ellipse: true,\r\n    line: true,\r\n    image: true,\r\n    arrow: true,\r\n    freedraw: true,\r\n};\r\nconst getFontFamilyByName = (fontFamilyName) => {\r\n    if (Object.keys(FONT_FAMILY).includes(fontFamilyName)) {\r\n        return FONT_FAMILY[fontFamilyName];\r\n    }\r\n    return DEFAULT_FONT_FAMILY;\r\n};\r\nconst restoreElementWithProperties = (element, extra) => {\r\n    const base = {\r\n        type: extra.type || element.type,\r\n        // all elements must have version > 0 so getSceneVersion() will pick up\r\n        // newly added elements\r\n        version: element.version || 1,\r\n        versionNonce: element.versionNonce ?? 0,\r\n        isDeleted: element.isDeleted ?? false,\r\n        id: element.id || randomId(),\r\n        fillStyle: element.fillStyle || \"hachure\",\r\n        strokeWidth: element.strokeWidth || 1,\r\n        strokeStyle: element.strokeStyle ?? \"solid\",\r\n        roughness: element.roughness ?? 1,\r\n        opacity: element.opacity == null ? 100 : element.opacity,\r\n        angle: element.angle || 0,\r\n        x: extra.x ?? element.x ?? 0,\r\n        y: extra.y ?? element.y ?? 0,\r\n        strokeColor: element.strokeColor,\r\n        backgroundColor: element.backgroundColor,\r\n        width: element.width || 0,\r\n        height: element.height || 0,\r\n        seed: element.seed ?? 1,\r\n        groupIds: element.groupIds ?? [],\r\n        strokeSharpness: element.strokeSharpness ??\r\n            (isLinearElementType(element.type) ? \"round\" : \"sharp\"),\r\n        boundElementIds: element.boundElementIds ?? [],\r\n    };\r\n    return {\r\n        ...base,\r\n        ...getNormalizedDimensions(base),\r\n        ...extra,\r\n    };\r\n};\r\nconst restoreElement = (element) => {\r\n    switch (element.type) {\r\n        case \"text\":\r\n            let fontSize = element.fontSize;\r\n            let fontFamily = element.fontFamily;\r\n            if (\"font\" in element) {\r\n                const [fontPx, _fontFamily] = element.font.split(\" \");\r\n                fontSize = parseInt(fontPx, 10);\r\n                fontFamily = getFontFamilyByName(_fontFamily);\r\n            }\r\n            return restoreElementWithProperties(element, {\r\n                fontSize,\r\n                fontFamily,\r\n                text: element.text ?? \"\",\r\n                baseline: element.baseline,\r\n                textAlign: element.textAlign || DEFAULT_TEXT_ALIGN,\r\n                verticalAlign: element.verticalAlign || DEFAULT_VERTICAL_ALIGN,\r\n            });\r\n        case \"freedraw\": {\r\n            return restoreElementWithProperties(element, {\r\n                points: element.points,\r\n                lastCommittedPoint: null,\r\n                simulatePressure: element.simulatePressure,\r\n                pressures: element.pressures,\r\n            });\r\n        }\r\n        case \"image\":\r\n            return restoreElementWithProperties(element, {\r\n                status: element.status || \"pending\",\r\n                fileId: element.fileId,\r\n                scale: element.scale || [1, 1],\r\n            });\r\n        case \"line\":\r\n        // @ts-ignore LEGACY type\r\n        // eslint-disable-next-line no-fallthrough\r\n        case \"draw\":\r\n        case \"arrow\": {\r\n            const { startArrowhead = null, endArrowhead = element.type === \"arrow\" ? \"arrow\" : null, } = element;\r\n            let x = element.x;\r\n            let y = element.y;\r\n            let points = // migrate old arrow model to new one\r\n             !Array.isArray(element.points) || element.points.length < 2\r\n                ? [\r\n                    [0, 0],\r\n                    [element.width, element.height],\r\n                ]\r\n                : element.points;\r\n            if (points[0][0] !== 0 || points[0][1] !== 0) {\r\n                ({ points, x, y } = LinearElementEditor.getNormalizedPoints(element));\r\n            }\r\n            return restoreElementWithProperties(element, {\r\n                type: element.type === \"draw\"\r\n                    ? \"line\"\r\n                    : element.type,\r\n                startBinding: element.startBinding,\r\n                endBinding: element.endBinding,\r\n                lastCommittedPoint: null,\r\n                startArrowhead,\r\n                endArrowhead,\r\n                points,\r\n                x,\r\n                y,\r\n            });\r\n        }\r\n        // generic elements\r\n        case \"ellipse\":\r\n            return restoreElementWithProperties(element, {});\r\n        case \"rectangle\":\r\n            return restoreElementWithProperties(element, {});\r\n        case \"diamond\":\r\n            return restoreElementWithProperties(element, {});\r\n        // Don't use default case so as to catch a missing an element type case.\r\n        // We also don't want to throw, but instead return void so we filter\r\n        // out these unsupported elements from the restored array.\r\n    }\r\n};\r\nexport const restoreElements = (elements, \r\n/** NOTE doesn't serve for reconciliation */\r\nlocalElements) => {\r\n    const localElementsMap = localElements ? getElementMap(localElements) : null;\r\n    return (elements || []).reduce((elements, element) => {\r\n        // filtering out selection, which is legacy, no longer kept in elements,\r\n        // and causing issues if retained\r\n        if (element.type !== \"selection\" && !isInvisiblySmallElement(element)) {\r\n            let migratedElement = restoreElement(element);\r\n            if (migratedElement) {\r\n                const localElement = localElementsMap?.[element.id];\r\n                if (localElement && localElement.version > migratedElement.version) {\r\n                    migratedElement = bumpVersion(migratedElement, localElement.version);\r\n                }\r\n                elements.push(migratedElement);\r\n            }\r\n        }\r\n        return elements;\r\n    }, []);\r\n};\r\nexport const restoreAppState = (appState, localAppState) => {\r\n    appState = appState || {};\r\n    const defaultAppState = getDefaultAppState();\r\n    const nextAppState = {};\r\n    for (const [key, defaultValue] of Object.entries(defaultAppState)) {\r\n        const suppliedValue = appState[key];\r\n        const localValue = localAppState ? localAppState[key] : undefined;\r\n        nextAppState[key] =\r\n            suppliedValue !== undefined\r\n                ? suppliedValue\r\n                : localValue !== undefined\r\n                    ? localValue\r\n                    : defaultValue;\r\n    }\r\n    return {\r\n        ...nextAppState,\r\n        elementType: AllowedExcalidrawElementTypes[nextAppState.elementType]\r\n            ? nextAppState.elementType\r\n            : \"selection\",\r\n        // Migrates from previous version where appState.zoom was a number\r\n        zoom: typeof appState.zoom === \"number\"\r\n            ? {\r\n                value: appState.zoom,\r\n                translation: defaultAppState.zoom.translation,\r\n            }\r\n            : appState.zoom || defaultAppState.zoom,\r\n    };\r\n};\r\nexport const restore = (data, \r\n/**\r\n * Local AppState (`this.state` or initial state from localStorage) so that we\r\n * don't overwrite local state with default values (when values not\r\n * explicitly specified).\r\n * Supply `null` if you can't get access to it.\r\n */\r\nlocalAppState, localElements) => {\r\n    return {\r\n        elements: restoreElements(data?.elements, localElements),\r\n        appState: restoreAppState(data?.appState, localAppState || null),\r\n        files: data?.files || {},\r\n    };\r\n};\r\n","import { nanoid } from \"nanoid\";\r\nimport { cleanAppStateForExport } from \"../appState\";\r\nimport { ALLOWED_IMAGE_MIME_TYPES, EXPORT_DATA_TYPES, MIME_TYPES, } from \"../constants\";\r\nimport { clearElementsForExport } from \"../element\";\r\nimport { CanvasError } from \"../errors\";\r\nimport { t } from \"../i18n\";\r\nimport { calculateScrollCenter } from \"../scene\";\r\nimport { isValidExcalidrawData } from \"./json\";\r\nimport { restore } from \"./restore\";\r\nconst parseFileContents = async (blob) => {\r\n    let contents;\r\n    if (blob.type === MIME_TYPES.png) {\r\n        try {\r\n            return await (await import(/* webpackChunkName: \"image\" */ \"./image\")).decodePngMetadata(blob);\r\n        }\r\n        catch (error) {\r\n            if (error.message === \"INVALID\") {\r\n                throw new DOMException(t(\"alerts.imageDoesNotContainScene\"), \"EncodingError\");\r\n            }\r\n            else {\r\n                throw new DOMException(t(\"alerts.cannotRestoreFromImage\"), \"EncodingError\");\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        if (\"text\" in Blob) {\r\n            contents = await blob.text();\r\n        }\r\n        else {\r\n            contents = await new Promise((resolve) => {\r\n                const reader = new FileReader();\r\n                reader.readAsText(blob, \"utf8\");\r\n                reader.onloadend = () => {\r\n                    if (reader.readyState === FileReader.DONE) {\r\n                        resolve(reader.result);\r\n                    }\r\n                };\r\n            });\r\n        }\r\n        if (blob.type === MIME_TYPES.svg) {\r\n            try {\r\n                return await (await import(/* webpackChunkName: \"image\" */ \"./image\")).decodeSvgMetadata({\r\n                    svg: contents,\r\n                });\r\n            }\r\n            catch (error) {\r\n                if (error.message === \"INVALID\") {\r\n                    throw new DOMException(t(\"alerts.imageDoesNotContainScene\"), \"EncodingError\");\r\n                }\r\n                else {\r\n                    throw new DOMException(t(\"alerts.cannotRestoreFromImage\"), \"EncodingError\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return contents;\r\n};\r\nexport const getMimeType = (blob) => {\r\n    let name;\r\n    if (typeof blob === \"string\") {\r\n        name = blob;\r\n    }\r\n    else {\r\n        if (blob.type) {\r\n            return blob.type;\r\n        }\r\n        name = blob.name || \"\";\r\n    }\r\n    if (/\\.(excalidraw|json)$/.test(name)) {\r\n        return MIME_TYPES.json;\r\n    }\r\n    else if (/\\.png$/.test(name)) {\r\n        return MIME_TYPES.png;\r\n    }\r\n    else if (/\\.jpe?g$/.test(name)) {\r\n        return MIME_TYPES.jpg;\r\n    }\r\n    else if (/\\.svg$/.test(name)) {\r\n        return MIME_TYPES.svg;\r\n    }\r\n    return \"\";\r\n};\r\nexport const getFileHandleType = (handle) => {\r\n    if (!handle) {\r\n        return null;\r\n    }\r\n    return handle.name.match(/\\.(json|excalidraw|png|svg)$/)?.[1] || null;\r\n};\r\nexport const isImageFileHandleType = (type) => {\r\n    return type === \"png\" || type === \"svg\";\r\n};\r\nexport const isImageFileHandle = (handle) => {\r\n    const type = getFileHandleType(handle);\r\n    return type === \"png\" || type === \"svg\";\r\n};\r\nexport const isSupportedImageFile = (blob) => {\r\n    const { type } = blob || {};\r\n    return (!!type && ALLOWED_IMAGE_MIME_TYPES.includes(type));\r\n};\r\nexport const loadFromBlob = async (blob, \r\n/** @see restore.localAppState */\r\nlocalAppState, localElements) => {\r\n    const contents = await parseFileContents(blob);\r\n    try {\r\n        const data = JSON.parse(contents);\r\n        if (!isValidExcalidrawData(data)) {\r\n            throw new Error(t(\"alerts.couldNotLoadInvalidFile\"));\r\n        }\r\n        const result = restore({\r\n            elements: clearElementsForExport(data.elements || []),\r\n            appState: {\r\n                theme: localAppState?.theme,\r\n                fileHandle: blob.handle || null,\r\n                ...cleanAppStateForExport(data.appState || {}),\r\n                ...(localAppState\r\n                    ? calculateScrollCenter(data.elements || [], localAppState, null)\r\n                    : {}),\r\n            },\r\n            files: data.files,\r\n        }, localAppState, localElements);\r\n        return result;\r\n    }\r\n    catch (error) {\r\n        console.error(error.message);\r\n        throw new Error(t(\"alerts.couldNotLoadInvalidFile\"));\r\n    }\r\n};\r\nexport const loadLibraryFromBlob = async (blob) => {\r\n    const contents = await parseFileContents(blob);\r\n    const data = JSON.parse(contents);\r\n    if (data.type !== EXPORT_DATA_TYPES.excalidrawLibrary) {\r\n        throw new Error(t(\"alerts.couldNotLoadInvalidFile\"));\r\n    }\r\n    return data;\r\n};\r\nexport const canvasToBlob = async (canvas) => {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            canvas.toBlob((blob) => {\r\n                if (!blob) {\r\n                    return reject(new CanvasError(t(\"canvasError.canvasTooBig\"), \"CANVAS_POSSIBLY_TOO_BIG\"));\r\n                }\r\n                resolve(blob);\r\n            });\r\n        }\r\n        catch (error) {\r\n            reject(error);\r\n        }\r\n    });\r\n};\r\n/** generates SHA-1 digest from supplied file (if not supported, falls back\r\n    to a 40-char base64 random id) */\r\nexport const generateIdFromFile = async (file) => {\r\n    let id;\r\n    try {\r\n        const hashBuffer = await window.crypto.subtle.digest(\"SHA-1\", await file.arrayBuffer());\r\n        id =\r\n            // convert buffer to byte array\r\n            Array.from(new Uint8Array(hashBuffer))\r\n                // convert to hex string\r\n                .map((byte) => byte.toString(16).padStart(2, \"0\"))\r\n                .join(\"\");\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        // length 40 to align with the HEX length of SHA-1 (which is 160 bit)\r\n        id = nanoid(40);\r\n    }\r\n    return id;\r\n};\r\nexport const getDataURL = async (file) => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = () => {\r\n            const dataURL = reader.result;\r\n            resolve(dataURL);\r\n        };\r\n        reader.onerror = (error) => reject(error);\r\n        reader.readAsDataURL(file);\r\n    });\r\n};\r\nexport const dataURLToFile = (dataURL, filename = \"\") => {\r\n    const dataIndexStart = dataURL.indexOf(\",\");\r\n    const byteString = atob(dataURL.slice(dataIndexStart + 1));\r\n    const mimeType = dataURL.slice(0, dataIndexStart).split(\":\")[1].split(\";\")[0];\r\n    const ab = new ArrayBuffer(byteString.length);\r\n    const ia = new Uint8Array(ab);\r\n    for (let i = 0; i < byteString.length; i++) {\r\n        ia[i] = byteString.charCodeAt(i);\r\n    }\r\n    return new File([ab], filename, { type: mimeType });\r\n};\r\nexport const resizeImageFile = async (file, maxWidthOrHeight) => {\r\n    // SVG files shouldn't a can't be resized\r\n    if (file.type === MIME_TYPES.svg) {\r\n        return file;\r\n    }\r\n    const [pica, imageBlobReduce] = await Promise.all([\r\n        import(\"pica\").then((res) => res.default),\r\n        // a wrapper for pica for better API\r\n        import(\"image-blob-reduce\").then((res) => res.default),\r\n    ]);\r\n    // CRA's minification settings break pica in WebWorkers, so let's disable\r\n    // them for now\r\n    // https://github.com/nodeca/image-blob-reduce/issues/21#issuecomment-757365513\r\n    const reduce = imageBlobReduce({\r\n        pica: pica({ features: [\"js\", \"wasm\"] }),\r\n    });\r\n    const fileType = file.type;\r\n    if (!isSupportedImageFile(file)) {\r\n        throw new Error(t(\"errors.unsupportedFileType\"));\r\n    }\r\n    return new File([await reduce.toBlob(file, { max: maxWidthOrHeight })], file.name, { type: fileType });\r\n};\r\nexport const SVGStringToFile = (SVGString, filename = \"\") => {\r\n    return new File([new TextEncoder().encode(SVGString)], filename, {\r\n        type: MIME_TYPES.svg,\r\n    });\r\n};\r\n","import { fileOpen, fileSave } from \"./filesystem\";\r\nimport { cleanAppStateForExport, clearAppStateForDatabase } from \"../appState\";\r\nimport { EXPORT_DATA_TYPES, EXPORT_SOURCE, MIME_TYPES } from \"../constants\";\r\nimport { clearElementsForDatabase, clearElementsForExport } from \"../element\";\r\nimport { isImageFileHandle, loadFromBlob } from \"./blob\";\r\n/**\r\n * Strips out files which are only referenced by deleted elements\r\n */\r\nconst filterOutDeletedFiles = (elements, files) => {\r\n    const nextFiles = {};\r\n    for (const element of elements) {\r\n        if (!element.isDeleted &&\r\n            \"fileId\" in element &&\r\n            element.fileId &&\r\n            files[element.fileId]) {\r\n            nextFiles[element.fileId] = files[element.fileId];\r\n        }\r\n    }\r\n    return nextFiles;\r\n};\r\nexport const serializeAsJSON = (elements, appState, files, type) => {\r\n    const data = {\r\n        type: EXPORT_DATA_TYPES.excalidraw,\r\n        version: 2,\r\n        source: EXPORT_SOURCE,\r\n        elements: type === \"local\"\r\n            ? clearElementsForExport(elements)\r\n            : clearElementsForDatabase(elements),\r\n        appState: type === \"local\"\r\n            ? cleanAppStateForExport(appState)\r\n            : clearAppStateForDatabase(appState),\r\n        files: type === \"local\"\r\n            ? filterOutDeletedFiles(elements, files)\r\n            : // will be stripped from JSON\r\n                undefined,\r\n    };\r\n    return JSON.stringify(data, null, 2);\r\n};\r\nexport const saveAsJSON = async (elements, appState, files) => {\r\n    const serialized = serializeAsJSON(elements, appState, files, \"local\");\r\n    const blob = new Blob([serialized], {\r\n        type: MIME_TYPES.excalidraw,\r\n    });\r\n    const fileHandle = await fileSave(blob, {\r\n        name: appState.name,\r\n        extension: \"excalidraw\",\r\n        description: \"Excalidraw file\",\r\n        fileHandle: isImageFileHandle(appState.fileHandle)\r\n            ? null\r\n            : appState.fileHandle,\r\n    });\r\n    return { fileHandle };\r\n};\r\nexport const loadFromJSON = async (localAppState, localElements) => {\r\n    const blob = await fileOpen({\r\n        description: \"Excalidraw files\",\r\n        // ToDo: Be over-permissive until https://bugs.webkit.org/show_bug.cgi?id=34442\r\n        // gets resolved. Else, iOS users cannot open `.excalidraw` files.\r\n        // extensions: [\"json\", \"excalidraw\", \"png\", \"svg\"],\r\n    });\r\n    return loadFromBlob(blob, localAppState, localElements);\r\n};\r\nexport const isValidExcalidrawData = (data) => {\r\n    return (data?.type === EXPORT_DATA_TYPES.excalidraw &&\r\n        (!data.elements ||\r\n            (Array.isArray(data.elements) &&\r\n                (!data.appState || typeof data.appState === \"object\"))));\r\n};\r\nexport const isValidLibrary = (json) => {\r\n    return (typeof json === \"object\" &&\r\n        json &&\r\n        json.type === EXPORT_DATA_TYPES.excalidrawLibrary &&\r\n        json.version === 1);\r\n};\r\nexport const saveLibraryAsJSON = async (library) => {\r\n    const libraryItems = await library.loadLibrary();\r\n    const data = {\r\n        type: EXPORT_DATA_TYPES.excalidrawLibrary,\r\n        version: 1,\r\n        source: EXPORT_SOURCE,\r\n        library: libraryItems,\r\n    };\r\n    const serialized = JSON.stringify(data, null, 2);\r\n    await fileSave(new Blob([serialized], {\r\n        type: MIME_TYPES.excalidrawlib,\r\n    }), {\r\n        name: \"library\",\r\n        extension: \"excalidrawlib\",\r\n        description: \"Excalidraw library file\",\r\n    });\r\n};\r\nexport const importLibraryFromJSON = async (library) => {\r\n    const blob = await fileOpen({\r\n        description: \"Excalidraw library files\",\r\n        // ToDo: Be over-permissive until https://bugs.webkit.org/show_bug.cgi?id=34442\r\n        // gets resolved. Else, iOS users cannot open `.excalidraw` files.\r\n        /*\r\n        extensions: [\".json\", \".excalidrawlib\"],\r\n        */\r\n    });\r\n    await library.importLibrary(blob);\r\n};\r\n","// -----------------------------------------------------------------------------\r\n// ExcalidrawImageElement & related helpers\r\n// -----------------------------------------------------------------------------\r\nimport { MIME_TYPES, SVG_NS } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { isInitializedImageElement } from \"./typeChecks\";\r\nexport const loadHTMLImageElement = (dataURL) => {\r\n    return new Promise((resolve, reject) => {\r\n        const image = new Image();\r\n        image.onload = () => {\r\n            resolve(image);\r\n        };\r\n        image.onerror = (error) => {\r\n            reject(error);\r\n        };\r\n        image.src = dataURL;\r\n    });\r\n};\r\n/** NOTE: updates cache even if already populated with given image. Thus,\r\n * you should filter out the images upstream if you want to optimize this. */\r\nexport const updateImageCache = async ({ fileIds, files, imageCache, }) => {\r\n    const updatedFiles = new Map();\r\n    const erroredFiles = new Map();\r\n    await Promise.all(fileIds.reduce((promises, fileId) => {\r\n        const fileData = files[fileId];\r\n        if (fileData && !updatedFiles.has(fileId)) {\r\n            updatedFiles.set(fileId, true);\r\n            return promises.concat((async () => {\r\n                try {\r\n                    if (fileData.mimeType === MIME_TYPES.binary) {\r\n                        throw new Error(\"Only images can be added to ImageCache\");\r\n                    }\r\n                    const imagePromise = loadHTMLImageElement(fileData.dataURL);\r\n                    const data = {\r\n                        image: imagePromise,\r\n                        mimeType: fileData.mimeType,\r\n                    };\r\n                    // store the promise immediately to indicate there's an in-progress\r\n                    // initialization\r\n                    imageCache.set(fileId, data);\r\n                    const image = await imagePromise;\r\n                    imageCache.set(fileId, { ...data, image });\r\n                }\r\n                catch (error) {\r\n                    erroredFiles.set(fileId, true);\r\n                }\r\n            })());\r\n        }\r\n        return promises;\r\n    }, []));\r\n    return {\r\n        imageCache,\r\n        /** includes errored files because they cache was updated nonetheless */\r\n        updatedFiles,\r\n        /** files that failed when creating HTMLImageElement */\r\n        erroredFiles,\r\n    };\r\n};\r\nexport const getInitializedImageElements = (elements) => elements.filter((element) => isInitializedImageElement(element));\r\nexport const isHTMLSVGElement = (node) => {\r\n    // lower-casing due to XML/HTML convention differences\r\n    // https://johnresig.com/blog/nodename-case-sensitivity\r\n    return node?.nodeName.toLowerCase() === \"svg\";\r\n};\r\nexport const normalizeSVG = async (SVGString) => {\r\n    const doc = new DOMParser().parseFromString(SVGString, MIME_TYPES.svg);\r\n    const svg = doc.querySelector(\"svg\");\r\n    const errorNode = doc.querySelector(\"parsererror\");\r\n    if (errorNode || !isHTMLSVGElement(svg)) {\r\n        throw new Error(t(\"errors.invalidSVGString\"));\r\n    }\r\n    else {\r\n        if (!svg.hasAttribute(\"xmlns\")) {\r\n            svg.setAttribute(\"xmlns\", SVG_NS);\r\n        }\r\n        return svg.outerHTML;\r\n    }\r\n};\r\n","import rough from \"roughjs/bin/rough\";\r\nimport { getCommonBounds } from \"../element/bounds\";\r\nimport { renderScene, renderSceneToSvg } from \"../renderer/renderScene\";\r\nimport { distance } from \"../utils\";\r\nimport { DEFAULT_EXPORT_PADDING, SVG_NS, THEME_FILTER } from \"../constants\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { serializeAsJSON } from \"../data/json\";\r\nimport { getInitializedImageElements, updateImageCache, } from \"../element/image\";\r\nexport const SVG_EXPORT_TAG = `<!-- svg-source:excalidraw -->`;\r\nexport const exportToCanvas = async (elements, appState, files, { exportBackground, exportPadding = DEFAULT_EXPORT_PADDING, viewBackgroundColor, }, createCanvas = (width, height) => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = width * appState.exportScale;\r\n    canvas.height = height * appState.exportScale;\r\n    return { canvas, scale: appState.exportScale };\r\n}) => {\r\n    const [minX, minY, width, height] = getCanvasSize(elements, exportPadding);\r\n    const { canvas, scale = 1 } = createCanvas(width, height);\r\n    const defaultAppState = getDefaultAppState();\r\n    const { imageCache } = await updateImageCache({\r\n        imageCache: new Map(),\r\n        fileIds: getInitializedImageElements(elements).map((element) => element.fileId),\r\n        files,\r\n    });\r\n    renderScene(elements, appState, null, scale, rough.canvas(canvas), canvas, {\r\n        viewBackgroundColor: exportBackground ? viewBackgroundColor : null,\r\n        scrollX: -minX + exportPadding,\r\n        scrollY: -minY + exportPadding,\r\n        zoom: defaultAppState.zoom,\r\n        remotePointerViewportCoords: {},\r\n        remoteSelectedElementIds: {},\r\n        shouldCacheIgnoreZoom: false,\r\n        remotePointerUsernames: {},\r\n        remotePointerUserStates: {},\r\n        theme: appState.exportWithDarkMode ? \"dark\" : \"light\",\r\n        imageCache,\r\n    }, {\r\n        renderScrollbars: false,\r\n        renderSelection: false,\r\n        renderOptimizations: true,\r\n        renderGrid: false,\r\n        isExport: true,\r\n    });\r\n    return canvas;\r\n};\r\nexport const exportToSvg = async (elements, appState, files) => {\r\n    const { exportPadding = DEFAULT_EXPORT_PADDING, viewBackgroundColor, exportScale = 1, exportEmbedScene, } = appState;\r\n    let metadata = \"\";\r\n    if (exportEmbedScene) {\r\n        try {\r\n            metadata = await (await import(/* webpackChunkName: \"image\" */ \"../../../src/ChalkBoard/data/image\")).encodeSvgMetadata({\r\n                text: serializeAsJSON(elements, appState, files || {}, \"local\"),\r\n            });\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n    }\r\n    const [minX, minY, width, height] = getCanvasSize(elements, exportPadding);\r\n    // initialze SVG root\r\n    const svgRoot = document.createElementNS(SVG_NS, \"svg\");\r\n    svgRoot.setAttribute(\"version\", \"1.1\");\r\n    svgRoot.setAttribute(\"xmlns\", SVG_NS);\r\n    svgRoot.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\r\n    svgRoot.setAttribute(\"width\", `${width * exportScale}`);\r\n    svgRoot.setAttribute(\"height\", `${height * exportScale}`);\r\n    if (appState.exportWithDarkMode) {\r\n        svgRoot.setAttribute(\"filter\", THEME_FILTER);\r\n    }\r\n    svgRoot.innerHTML = `\r\n  ${SVG_EXPORT_TAG}\r\n  ${metadata}\r\n  <defs>\r\n    <style>\r\n      @font-face {\r\n        font-family: \"Virgil\";\r\n        src: url(\"https://excalidraw.com/Virgil.woff2\");\r\n      }\r\n      @font-face {\r\n        font-family: \"Cascadia\";\r\n        src: url(\"https://excalidraw.com/Cascadia.woff2\");\r\n      }\r\n    </style>\r\n  </defs>\r\n  `;\r\n    // render background rect\r\n    if (appState.exportBackground && viewBackgroundColor) {\r\n        const rect = svgRoot.ownerDocument.createElementNS(SVG_NS, \"rect\");\r\n        rect.setAttribute(\"x\", \"0\");\r\n        rect.setAttribute(\"y\", \"0\");\r\n        rect.setAttribute(\"width\", `${width}`);\r\n        rect.setAttribute(\"height\", `${height}`);\r\n        rect.setAttribute(\"fill\", viewBackgroundColor);\r\n        svgRoot.appendChild(rect);\r\n    }\r\n    const rsvg = rough.svg(svgRoot);\r\n    renderSceneToSvg(elements, rsvg, svgRoot, files || {}, {\r\n        offsetX: -minX + exportPadding,\r\n        offsetY: -minY + exportPadding,\r\n    });\r\n    return svgRoot;\r\n};\r\n// calculate smallest area to fit the contents in\r\nconst getCanvasSize = (elements, exportPadding) => {\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n    const width = distance(minX, maxX) + exportPadding * 2;\r\n    const height = distance(minY, maxY) + exportPadding + exportPadding;\r\n    return [minX, minY, width, height];\r\n};\r\nexport const getExportSize = (elements, exportPadding, scale) => {\r\n    const [, , width, height] = getCanvasSize(elements, exportPadding).map((dimension) => Math.trunc(dimension * scale));\r\n    return [width, height];\r\n};\r\n","import colors from \"./colors\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_FONT_SIZE, ENV } from \"./constants\";\r\nimport { newElement, newLinearElement, newTextElement } from \"./element\";\r\nimport { randomId } from \"./random\";\r\nconst BAR_WIDTH = 32;\r\nconst BAR_GAP = 12;\r\nconst BAR_HEIGHT = 256;\r\nconst GRID_OPACITY = 50;\r\nexport const NOT_SPREADSHEET = \"NOT_SPREADSHEET\";\r\nexport const VALID_SPREADSHEET = \"VALID_SPREADSHEET\";\r\nconst tryParseNumber = (s) => {\r\n    const match = /^[$€£¥₩]?([0-9,]+(\\.[0-9]+)?)$/.exec(s);\r\n    if (!match) {\r\n        return null;\r\n    }\r\n    return parseFloat(match[1].replace(/,/g, \"\"));\r\n};\r\nconst isNumericColumn = (lines, columnIndex) => lines.slice(1).every((line) => tryParseNumber(line[columnIndex]) !== null);\r\nconst tryParseCells = (cells) => {\r\n    const numCols = cells[0].length;\r\n    if (numCols > 2) {\r\n        return { type: NOT_SPREADSHEET, reason: \"More than 2 columns\" };\r\n    }\r\n    if (numCols === 1) {\r\n        if (!isNumericColumn(cells, 0)) {\r\n            return { type: NOT_SPREADSHEET, reason: \"Value is not numeric\" };\r\n        }\r\n        const hasHeader = tryParseNumber(cells[0][0]) === null;\r\n        const values = (hasHeader ? cells.slice(1) : cells).map((line) => tryParseNumber(line[0]));\r\n        if (values.length < 2) {\r\n            return { type: NOT_SPREADSHEET, reason: \"Less than two rows\" };\r\n        }\r\n        return {\r\n            type: VALID_SPREADSHEET,\r\n            spreadsheet: {\r\n                title: hasHeader ? cells[0][0] : null,\r\n                labels: null,\r\n                values: values,\r\n            },\r\n        };\r\n    }\r\n    const valueColumnIndex = isNumericColumn(cells, 0) ? 0 : 1;\r\n    if (!isNumericColumn(cells, valueColumnIndex)) {\r\n        return { type: NOT_SPREADSHEET, reason: \"Value is not numeric\" };\r\n    }\r\n    const labelColumnIndex = (valueColumnIndex + 1) % 2;\r\n    const hasHeader = tryParseNumber(cells[0][valueColumnIndex]) === null;\r\n    const rows = hasHeader ? cells.slice(1) : cells;\r\n    if (rows.length < 2) {\r\n        return { type: NOT_SPREADSHEET, reason: \"Less than 2 rows\" };\r\n    }\r\n    return {\r\n        type: VALID_SPREADSHEET,\r\n        spreadsheet: {\r\n            title: hasHeader ? cells[0][valueColumnIndex] : null,\r\n            labels: rows.map((row) => row[labelColumnIndex]),\r\n            values: rows.map((row) => tryParseNumber(row[valueColumnIndex])),\r\n        },\r\n    };\r\n};\r\nconst transposeCells = (cells) => {\r\n    const nextCells = [];\r\n    for (let col = 0; col < cells[0].length; col++) {\r\n        const nextCellRow = [];\r\n        for (let row = 0; row < cells.length; row++) {\r\n            nextCellRow.push(cells[row][col]);\r\n        }\r\n        nextCells.push(nextCellRow);\r\n    }\r\n    return nextCells;\r\n};\r\nexport const tryParseSpreadsheet = (text) => {\r\n    // Copy/paste from excel, spreadhseets, tsv, csv.\r\n    // For now we only accept 2 columns with an optional header\r\n    // Check for tab separated values\r\n    let lines = text\r\n        .trim()\r\n        .split(\"\\n\")\r\n        .map((line) => line.trim().split(\"\\t\"));\r\n    // Check for comma separated files\r\n    if (lines.length && lines[0].length !== 2) {\r\n        lines = text\r\n            .trim()\r\n            .split(\"\\n\")\r\n            .map((line) => line.trim().split(\",\"));\r\n    }\r\n    if (lines.length === 0) {\r\n        return { type: NOT_SPREADSHEET, reason: \"No values\" };\r\n    }\r\n    const numColsFirstLine = lines[0].length;\r\n    const isSpreadsheet = lines.every((line) => line.length === numColsFirstLine);\r\n    if (!isSpreadsheet) {\r\n        return {\r\n            type: NOT_SPREADSHEET,\r\n            reason: \"All rows don't have same number of columns\",\r\n        };\r\n    }\r\n    const result = tryParseCells(lines);\r\n    if (result.type !== VALID_SPREADSHEET) {\r\n        const transposedResults = tryParseCells(transposeCells(lines));\r\n        if (transposedResults.type === VALID_SPREADSHEET) {\r\n            return transposedResults;\r\n        }\r\n    }\r\n    return result;\r\n};\r\nconst bgColors = colors.elementBackground.slice(2, colors.elementBackground.length);\r\n// Put all the common properties here so when the whole chart is selected\r\n// the properties dialog shows the correct selected values\r\nconst commonProps = {\r\n    fillStyle: \"hachure\",\r\n    fontFamily: DEFAULT_FONT_FAMILY,\r\n    fontSize: DEFAULT_FONT_SIZE,\r\n    opacity: 100,\r\n    roughness: 1,\r\n    strokeColor: colors.elementStroke[0],\r\n    strokeSharpness: \"sharp\",\r\n    strokeStyle: \"solid\",\r\n    strokeWidth: 1,\r\n    verticalAlign: \"middle\",\r\n};\r\nconst getChartDimentions = (spreadsheet) => {\r\n    const chartWidth = (BAR_WIDTH + BAR_GAP) * spreadsheet.values.length + BAR_GAP;\r\n    const chartHeight = BAR_HEIGHT + BAR_GAP * 2;\r\n    return { chartWidth, chartHeight };\r\n};\r\nconst chartXLabels = (spreadsheet, x, y, groupId, backgroundColor) => {\r\n    return (spreadsheet.labels?.map((label, index) => {\r\n        return newTextElement({\r\n            groupIds: [groupId],\r\n            backgroundColor,\r\n            ...commonProps,\r\n            text: label.length > 8 ? `${label.slice(0, 5)}...` : label,\r\n            x: x + index * (BAR_WIDTH + BAR_GAP) + BAR_GAP * 2,\r\n            y: y + BAR_GAP / 2,\r\n            width: BAR_WIDTH,\r\n            angle: 5.87,\r\n            fontSize: 16,\r\n            textAlign: \"center\",\r\n            verticalAlign: \"top\",\r\n        });\r\n    }) || []);\r\n};\r\nconst chartYLabels = (spreadsheet, x, y, groupId, backgroundColor) => {\r\n    const minYLabel = newTextElement({\r\n        groupIds: [groupId],\r\n        backgroundColor,\r\n        ...commonProps,\r\n        x: x - BAR_GAP,\r\n        y: y - BAR_GAP,\r\n        text: \"0\",\r\n        textAlign: \"right\",\r\n    });\r\n    const maxYLabel = newTextElement({\r\n        groupIds: [groupId],\r\n        backgroundColor,\r\n        ...commonProps,\r\n        x: x - BAR_GAP,\r\n        y: y - BAR_HEIGHT - minYLabel.height / 2,\r\n        text: Math.max(...spreadsheet.values).toLocaleString(),\r\n        textAlign: \"right\",\r\n    });\r\n    return [minYLabel, maxYLabel];\r\n};\r\nconst chartLines = (spreadsheet, x, y, groupId, backgroundColor) => {\r\n    const { chartWidth, chartHeight } = getChartDimentions(spreadsheet);\r\n    const xLine = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x,\r\n        y,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        width: chartWidth,\r\n        points: [\r\n            [0, 0],\r\n            [chartWidth, 0],\r\n        ],\r\n    });\r\n    const yLine = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x,\r\n        y,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        height: chartHeight,\r\n        points: [\r\n            [0, 0],\r\n            [0, -chartHeight],\r\n        ],\r\n    });\r\n    const maxLine = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x,\r\n        y: y - BAR_HEIGHT - BAR_GAP,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        strokeStyle: \"dotted\",\r\n        width: chartWidth,\r\n        opacity: GRID_OPACITY,\r\n        points: [\r\n            [0, 0],\r\n            [chartWidth, 0],\r\n        ],\r\n    });\r\n    return [xLine, yLine, maxLine];\r\n};\r\n// For the maths behind it https://excalidraw.com/#json=6320864370884608,O_5xfD-Agh32tytHpRJx1g\r\nconst chartBaseElements = (spreadsheet, x, y, groupId, backgroundColor, debug) => {\r\n    const { chartWidth, chartHeight } = getChartDimentions(spreadsheet);\r\n    const title = spreadsheet.title\r\n        ? newTextElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            text: spreadsheet.title,\r\n            x: x + chartWidth / 2,\r\n            y: y - BAR_HEIGHT - BAR_GAP * 2 - DEFAULT_FONT_SIZE,\r\n            strokeSharpness: \"sharp\",\r\n            strokeStyle: \"solid\",\r\n            textAlign: \"center\",\r\n        })\r\n        : null;\r\n    const debugRect = debug\r\n        ? newElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            type: \"rectangle\",\r\n            x,\r\n            y: y - chartHeight,\r\n            width: chartWidth,\r\n            height: chartHeight,\r\n            strokeColor: colors.elementStroke[0],\r\n            fillStyle: \"solid\",\r\n            opacity: 6,\r\n        })\r\n        : null;\r\n    return [\r\n        ...(debugRect ? [debugRect] : []),\r\n        ...(title ? [title] : []),\r\n        ...chartXLabels(spreadsheet, x, y, groupId, backgroundColor),\r\n        ...chartYLabels(spreadsheet, x, y, groupId, backgroundColor),\r\n        ...chartLines(spreadsheet, x, y, groupId, backgroundColor),\r\n    ];\r\n};\r\nconst chartTypeBar = (spreadsheet, x, y) => {\r\n    const max = Math.max(...spreadsheet.values);\r\n    const groupId = randomId();\r\n    const backgroundColor = bgColors[Math.floor(Math.random() * bgColors.length)];\r\n    const bars = spreadsheet.values.map((value, index) => {\r\n        const barHeight = (value / max) * BAR_HEIGHT;\r\n        return newElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            type: \"rectangle\",\r\n            x: x + index * (BAR_WIDTH + BAR_GAP) + BAR_GAP,\r\n            y: y - barHeight - BAR_GAP,\r\n            width: BAR_WIDTH,\r\n            height: barHeight,\r\n        });\r\n    });\r\n    return [\r\n        ...bars,\r\n        ...chartBaseElements(spreadsheet, x, y, groupId, backgroundColor, process.env.NODE_ENV === ENV.DEVELOPMENT),\r\n    ];\r\n};\r\nconst chartTypeLine = (spreadsheet, x, y) => {\r\n    const max = Math.max(...spreadsheet.values);\r\n    const groupId = randomId();\r\n    const backgroundColor = bgColors[Math.floor(Math.random() * bgColors.length)];\r\n    let index = 0;\r\n    const points = [];\r\n    for (const value of spreadsheet.values) {\r\n        const cx = index * (BAR_WIDTH + BAR_GAP);\r\n        const cy = -(value / max) * BAR_HEIGHT;\r\n        points.push([cx, cy]);\r\n        index++;\r\n    }\r\n    const maxX = Math.max(...points.map((element) => element[0]));\r\n    const maxY = Math.max(...points.map((element) => element[1]));\r\n    const minX = Math.min(...points.map((element) => element[0]));\r\n    const minY = Math.min(...points.map((element) => element[1]));\r\n    const line = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x: x + BAR_GAP + BAR_WIDTH / 2,\r\n        y: y - BAR_GAP,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        height: maxY - minY,\r\n        width: maxX - minX,\r\n        strokeWidth: 2,\r\n        points: points,\r\n    });\r\n    const dots = spreadsheet.values.map((value, index) => {\r\n        const cx = index * (BAR_WIDTH + BAR_GAP) + BAR_GAP / 2;\r\n        const cy = -(value / max) * BAR_HEIGHT + BAR_GAP / 2;\r\n        return newElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            fillStyle: \"solid\",\r\n            strokeWidth: 2,\r\n            type: \"ellipse\",\r\n            x: x + cx + BAR_WIDTH / 2,\r\n            y: y + cy - BAR_GAP * 2,\r\n            width: BAR_GAP,\r\n            height: BAR_GAP,\r\n        });\r\n    });\r\n    const lines = spreadsheet.values.map((value, index) => {\r\n        const cx = index * (BAR_WIDTH + BAR_GAP) + BAR_GAP / 2;\r\n        const cy = (value / max) * BAR_HEIGHT + BAR_GAP / 2 + BAR_GAP;\r\n        return newLinearElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            type: \"line\",\r\n            x: x + cx + BAR_WIDTH / 2 + BAR_GAP / 2,\r\n            y: y - cy,\r\n            startArrowhead: null,\r\n            endArrowhead: null,\r\n            height: cy,\r\n            strokeStyle: \"dotted\",\r\n            opacity: GRID_OPACITY,\r\n            points: [\r\n                [0, 0],\r\n                [0, cy],\r\n            ],\r\n        });\r\n    });\r\n    return [\r\n        ...chartBaseElements(spreadsheet, x, y, groupId, backgroundColor, process.env.NODE_ENV === ENV.DEVELOPMENT),\r\n        line,\r\n        ...lines,\r\n        ...dots,\r\n    ];\r\n};\r\nexport const renderSpreadsheet = (chartType, spreadsheet, x, y) => {\r\n    if (chartType === \"line\") {\r\n        return chartTypeLine(spreadsheet, x, y);\r\n    }\r\n    return chartTypeBar(spreadsheet, x, y);\r\n};\r\n","import { getSelectedElements } from \"./scene\";\r\nimport { SVG_EXPORT_TAG } from \"./scene/export\";\r\nimport { tryParseSpreadsheet, VALID_SPREADSHEET } from \"./charts\";\r\nimport { EXPORT_DATA_TYPES, MIME_TYPES } from \"./constants\";\r\nimport { isInitializedImageElement } from \"./element/typeChecks\";\r\nlet CLIPBOARD = \"\";\r\nlet PREFER_APP_CLIPBOARD = false;\r\nexport const probablySupportsClipboardReadText = \"clipboard\" in navigator && \"readText\" in navigator.clipboard;\r\nexport const probablySupportsClipboardWriteText = \"clipboard\" in navigator && \"writeText\" in navigator.clipboard;\r\nexport const probablySupportsClipboardBlob = \"clipboard\" in navigator &&\r\n    \"write\" in navigator.clipboard &&\r\n    \"ClipboardItem\" in window &&\r\n    \"toBlob\" in HTMLCanvasElement.prototype;\r\nconst clipboardContainsElements = (contents) => {\r\n    if ([\r\n        EXPORT_DATA_TYPES.excalidraw,\r\n        EXPORT_DATA_TYPES.excalidrawClipboard,\r\n    ].includes(contents?.type) &&\r\n        Array.isArray(contents.elements)) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nexport const copyToClipboard = async (elements, appState, files) => {\r\n    const selectedElements = getSelectedElements(elements, appState);\r\n    const contents = {\r\n        type: EXPORT_DATA_TYPES.excalidrawClipboard,\r\n        elements: selectedElements,\r\n        files: selectedElements.reduce((acc, element) => {\r\n            if (isInitializedImageElement(element) && files[element.fileId]) {\r\n                acc[element.fileId] = files[element.fileId];\r\n            }\r\n            return acc;\r\n        }, {}),\r\n    };\r\n    const json = JSON.stringify(contents);\r\n    CLIPBOARD = json;\r\n    try {\r\n        PREFER_APP_CLIPBOARD = false;\r\n        await copyTextToSystemClipboard(json);\r\n    }\r\n    catch (error) {\r\n        PREFER_APP_CLIPBOARD = true;\r\n        console.error(error);\r\n    }\r\n};\r\nconst getAppClipboard = () => {\r\n    if (!CLIPBOARD) {\r\n        return {};\r\n    }\r\n    try {\r\n        return JSON.parse(CLIPBOARD);\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        return {};\r\n    }\r\n};\r\nconst parsePotentialSpreadsheet = (text) => {\r\n    const result = tryParseSpreadsheet(text);\r\n    if (result.type === VALID_SPREADSHEET) {\r\n        return { spreadsheet: result.spreadsheet };\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Retrieves content from system clipboard (either from ClipboardEvent or\r\n *  via async clipboard API if supported)\r\n */\r\nconst getSystemClipboard = async (event) => {\r\n    try {\r\n        const text = event\r\n            ? event.clipboardData?.getData(\"text/plain\").trim()\r\n            : probablySupportsClipboardReadText &&\r\n                (await navigator.clipboard.readText());\r\n        return text || \"\";\r\n    }\r\n    catch {\r\n        return \"\";\r\n    }\r\n};\r\n/**\r\n * Attemps to parse clipboard. Prefers system clipboard.\r\n */\r\nexport const parseClipboard = async (event) => {\r\n    const systemClipboard = await getSystemClipboard(event);\r\n    // if system clipboard empty, couldn't be resolved, or contains previously\r\n    // copied excalidraw scene as SVG, fall back to previously copied excalidraw\r\n    // elements\r\n    if (!systemClipboard || systemClipboard.includes(SVG_EXPORT_TAG)) {\r\n        return getAppClipboard();\r\n    }\r\n    // if system clipboard contains spreadsheet, use it even though it's\r\n    // technically possible it's staler than in-app clipboard\r\n    const spreadsheetResult = parsePotentialSpreadsheet(systemClipboard);\r\n    if (spreadsheetResult) {\r\n        return spreadsheetResult;\r\n    }\r\n    const appClipboardData = getAppClipboard();\r\n    try {\r\n        const systemClipboardData = JSON.parse(systemClipboard);\r\n        if (clipboardContainsElements(systemClipboardData)) {\r\n            return {\r\n                elements: systemClipboardData.elements,\r\n                files: systemClipboardData.files,\r\n            };\r\n        }\r\n        return appClipboardData;\r\n    }\r\n    catch {\r\n        // system clipboard doesn't contain excalidraw elements → return plaintext\r\n        // unless we set a flag to prefer in-app clipboard because browser didn't\r\n        // support storing to system clipboard on copy\r\n        return PREFER_APP_CLIPBOARD && appClipboardData.elements\r\n            ? appClipboardData\r\n            : { text: systemClipboard };\r\n    }\r\n};\r\nexport const copyBlobToClipboardAsPng = async (blob) => {\r\n    await navigator.clipboard.write([\r\n        new window.ClipboardItem({ [MIME_TYPES.png]: blob }),\r\n    ]);\r\n};\r\nexport const copyTextToSystemClipboard = async (text) => {\r\n    let copied = false;\r\n    if (probablySupportsClipboardWriteText) {\r\n        try {\r\n            // NOTE: doesn't work on FF on non-HTTPS domains, or when document\r\n            // not focused\r\n            await navigator.clipboard.writeText(text || \"\");\r\n            copied = true;\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n    }\r\n    // Note that execCommand doesn't allow copying empty strings, so if we're\r\n    // clearing clipboard using this API, we must copy at least an empty char\r\n    if (!copied && !copyTextViaExecCommand(text || \" \")) {\r\n        throw new Error(\"couldn't copy\");\r\n    }\r\n};\r\n// adapted from https://github.com/zenorocha/clipboard.js/blob/ce79f170aa655c408b6aab33c9472e8e4fa52e19/src/clipboard-action.js#L48\r\nconst copyTextViaExecCommand = (text) => {\r\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\";\r\n    const textarea = document.createElement(\"textarea\");\r\n    textarea.style.border = \"0\";\r\n    textarea.style.padding = \"0\";\r\n    textarea.style.margin = \"0\";\r\n    textarea.style.position = \"absolute\";\r\n    textarea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\";\r\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop;\r\n    textarea.style.top = `${yPosition}px`;\r\n    // Prevent zooming on iOS\r\n    textarea.style.fontSize = \"12pt\";\r\n    textarea.setAttribute(\"readonly\", \"\");\r\n    textarea.value = text;\r\n    document.body.appendChild(textarea);\r\n    let success = false;\r\n    try {\r\n        textarea.select();\r\n        textarea.setSelectionRange(0, textarea.value.length);\r\n        success = document.execCommand(\"copy\");\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n    }\r\n    textarea.remove();\r\n    return success;\r\n};\r\n","import { copyBlobToClipboardAsPng, copyTextToSystemClipboard, } from \"../clipboard\";\r\nimport { DEFAULT_EXPORT_PADDING, MIME_TYPES } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { exportToCanvas, exportToSvg } from \"../scene/export\";\r\nimport { canvasToBlob } from \"./blob\";\r\nimport { fileSave } from \"./filesystem\";\r\nimport { serializeAsJSON } from \"./json\";\r\nexport { loadFromBlob } from \"./blob\";\r\nexport { loadFromJSON, saveAsJSON } from \"./json\";\r\nexport const exportCanvas = async (type, elements, appState, files, { exportBackground, exportPadding = DEFAULT_EXPORT_PADDING, viewBackgroundColor, name, fileHandle = null, }) => {\r\n    if (elements.length === 0) {\r\n        throw new Error(t(\"alerts.cannotExportEmptyCanvas\"));\r\n    }\r\n    if (type === \"svg\" || type === \"clipboard-svg\") {\r\n        const tempSvg = await exportToSvg(elements, {\r\n            exportBackground,\r\n            exportWithDarkMode: appState.exportWithDarkMode,\r\n            viewBackgroundColor,\r\n            exportPadding,\r\n            exportScale: appState.exportScale,\r\n            exportEmbedScene: appState.exportEmbedScene && type === \"svg\",\r\n        }, files);\r\n        if (type === \"svg\") {\r\n            return await fileSave(new Blob([tempSvg.outerHTML], { type: MIME_TYPES.svg }), {\r\n                name,\r\n                extension: \"svg\",\r\n                fileHandle,\r\n            });\r\n        }\r\n        else if (type === \"clipboard-svg\") {\r\n            await copyTextToSystemClipboard(tempSvg.outerHTML);\r\n            return;\r\n        }\r\n    }\r\n    const tempCanvas = await exportToCanvas(elements, appState, files, {\r\n        exportBackground,\r\n        viewBackgroundColor,\r\n        exportPadding,\r\n    });\r\n    tempCanvas.style.display = \"none\";\r\n    document.body.appendChild(tempCanvas);\r\n    let blob = await canvasToBlob(tempCanvas);\r\n    tempCanvas.remove();\r\n    if (type === \"png\") {\r\n        if (appState.exportEmbedScene) {\r\n            blob = await (await import(/* webpackChunkName: \"image\" */ \"./image\")).encodePngMetadata({\r\n                blob,\r\n                metadata: serializeAsJSON(elements, appState, files, \"local\"),\r\n            });\r\n        }\r\n        return await fileSave(blob, {\r\n            name,\r\n            extension: \"png\",\r\n            fileHandle,\r\n        });\r\n    }\r\n    else if (type === \"clipboard\") {\r\n        try {\r\n            await copyBlobToClipboardAsPng(blob);\r\n        }\r\n        catch (error) {\r\n            if (error.name === \"CANVAS_POSSIBLY_TOO_BIG\") {\r\n                throw error;\r\n            }\r\n            throw new Error(t(\"alerts.couldNotCopyToClipboard\"));\r\n        }\r\n    }\r\n};\r\n","import { exportCanvas } from \".\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { getFileHandleType, isImageFileHandleType } from \"./blob\";\r\nexport const resaveAsImageWithScene = async (elements, appState, files) => {\r\n    const { exportBackground, viewBackgroundColor, name, fileHandle } = appState;\r\n    const fileHandleType = getFileHandleType(fileHandle);\r\n    if (!fileHandle || !isImageFileHandleType(fileHandleType)) {\r\n        throw new Error(\"fileHandle should exist and should be of type svg or png when resaving\");\r\n    }\r\n    appState = {\r\n        ...appState,\r\n        exportEmbedScene: true,\r\n    };\r\n    await exportCanvas(fileHandleType, getNonDeletedElements(elements), appState, files, {\r\n        exportBackground,\r\n        viewBackgroundColor,\r\n        name,\r\n        fileHandle,\r\n    });\r\n    return { fileHandle };\r\n};\r\n","import React from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { checkIcon } from \"./icons\";\r\nimport \"./CheckboxItem.scss\";\r\nexport const CheckboxItem = ({ children, checked, onChange }) => {\r\n    return (<div className={clsx(\"Checkbox\", { \"is-checked\": checked })} onClick={(event) => {\r\n            onChange(!checked);\r\n            event.currentTarget.querySelector(\".Checkbox-box\").focus();\r\n        }}>\r\n      <button className=\"Checkbox-box\" role=\"checkbox\" aria-checked={checked}>\r\n        {checkIcon}\r\n      </button>\r\n      <div className=\"Checkbox-label\">{children}</div>\r\n    </div>);\r\n};\r\n","import \"./Stack.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nconst RowStack = ({ children, gap, align, justifyContent, className, style, }) => {\r\n    return (<div className={clsx(\"Stack Stack_horizontal\", className)} style={{\r\n            \"--gap\": gap,\r\n            alignItems: align,\r\n            justifyContent,\r\n            ...style,\r\n        }}>\r\n      {children}\r\n    </div>);\r\n};\r\nconst ColStack = ({ children, gap, align, justifyContent, className, }) => {\r\n    return (<div className={clsx(\"Stack Stack_vertical\", className)} style={{\r\n            \"--gap\": gap,\r\n            justifyItems: align,\r\n            justifyContent,\r\n        }}>\r\n      {children}\r\n    </div>);\r\n};\r\nexport default {\r\n    Row: RowStack,\r\n    Col: ColStack,\r\n};\r\n","import Stack from \"../components/Stack\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { save, file } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport \"./ActiveFile.scss\";\r\nexport const ActiveFile = ({ fileName, onSave }) => (<Stack.Row className=\"ActiveFile\" gap={1} align=\"center\">\r\n    <span className=\"ActiveFile__fileName\">\r\n      {file}\r\n      <span>{fileName}</span>\r\n    </span>\r\n    <ToolButton type=\"icon\" icon={save} title={t(\"buttons.save\")} aria-label={t(\"buttons.save\")} onClick={onSave} data-testid=\"save-button\"/>\r\n  </Stack.Row>);\r\n","import { trackEvent } from \"../analytics\";\r\nimport { load, questionCircle, saveAs } from \"../components/icons\";\r\nimport { ProjectName } from \"../components/ProjectName\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport \"../components/ToolIcon.scss\";\r\nimport { Tooltip } from \"../components/Tooltip\";\r\nimport { DarkModeToggle } from \"../components/DarkModeToggle\";\r\nimport { loadFromJSON, saveAsJSON } from \"../data\";\r\nimport { resaveAsImageWithScene } from \"../data/resave\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { CheckboxItem } from \"../components/CheckboxItem\";\r\nimport { getExportSize } from \"../scene/export\";\r\nimport { DEFAULT_EXPORT_PADDING, EXPORT_SCALES, THEME } from \"../constants\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { ActiveFile } from \"../components/ActiveFile\";\r\nimport { isImageFileHandle } from \"../data/blob\";\r\nimport { nativeFileSystemSupported } from \"../data/filesystem\";\r\nexport const actionChangeProjectName = register({\r\n    name: \"changeProjectName\",\r\n    perform: (_elements, appState, value) => {\r\n        trackEvent(\"change\", \"title\");\r\n        return { appState: { ...appState, name: value }, commitToHistory: false };\r\n    },\r\n    PanelComponent: ({ appState, updateData, appProps }) => (<ProjectName label={t(\"labels.fileTitle\")} value={appState.name || \"Unnamed\"} onChange={(name) => updateData(name)} isNameEditable={typeof appProps.name === \"undefined\" && !appState.viewModeEnabled}/>),\r\n});\r\nexport const actionChangeExportScale = register({\r\n    name: \"changeExportScale\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportScale: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements: allElements, appState, updateData }) => {\r\n        const elements = getNonDeletedElements(allElements);\r\n        const exportSelected = isSomeElementSelected(elements, appState);\r\n        const exportedElements = exportSelected\r\n            ? getSelectedElements(elements, appState)\r\n            : elements;\r\n        return (<>\r\n        {EXPORT_SCALES.map((s) => {\r\n                const [width, height] = getExportSize(exportedElements, DEFAULT_EXPORT_PADDING, s);\r\n                const scaleButtonTitle = `${t(\"buttons.scale\")} ${s}x (${width}x${height})`;\r\n                return (<ToolButton key={s} size=\"small\" type=\"radio\" icon={`${s}x`} name=\"export-canvas-scale\" title={scaleButtonTitle} aria-label={scaleButtonTitle} id=\"export-canvas-scale\" checked={s === appState.exportScale} onChange={() => updateData(s)}/>);\r\n            })}\r\n      </>);\r\n    },\r\n});\r\nexport const actionChangeExportBackground = register({\r\n    name: \"changeExportBackground\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportBackground: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<CheckboxItem checked={appState.exportBackground} onChange={(checked) => updateData(checked)}>\r\n      {t(\"labels.withBackground\")}\r\n    </CheckboxItem>),\r\n});\r\nexport const actionChangeExportEmbedScene = register({\r\n    name: \"changeExportEmbedScene\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportEmbedScene: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<CheckboxItem checked={appState.exportEmbedScene} onChange={(checked) => updateData(checked)}>\r\n      {t(\"labels.exportEmbedScene\")}\r\n      <Tooltip label={t(\"labels.exportEmbedScene_details\")} long={true}>\r\n        <div className=\"chalkboard-tooltip-icon\">{questionCircle}</div>\r\n      </Tooltip>\r\n    </CheckboxItem>),\r\n});\r\nexport const actionSaveToActiveFile = register({\r\n    name: \"saveToActiveFile\",\r\n    perform: async (elements, appState, value, app) => {\r\n        const fileHandleExists = !!appState.fileHandle;\r\n        try {\r\n            const { fileHandle } = isImageFileHandle(appState.fileHandle)\r\n                ? await resaveAsImageWithScene(elements, appState, app.files)\r\n                : await saveAsJSON(elements, appState, app.files);\r\n            return {\r\n                commitToHistory: false,\r\n                appState: {\r\n                    ...appState,\r\n                    fileHandle,\r\n                    toastMessage: fileHandleExists\r\n                        ? fileHandle?.name\r\n                            ? t(\"toast.fileSavedToFilename\").replace(\"{filename}\", `\"${fileHandle.name}\"`)\r\n                            : t(\"toast.fileSaved\")\r\n                        : null,\r\n                },\r\n            };\r\n        }\r\n        catch (error) {\r\n            if (error?.name !== \"AbortError\") {\r\n                console.error(error);\r\n            }\r\n            return { commitToHistory: false };\r\n        }\r\n    },\r\n    keyTest: (event) => event.key === KEYS.S && event[KEYS.CTRL_OR_CMD] && !event.shiftKey,\r\n    PanelComponent: ({ updateData, appState }) => (<ActiveFile onSave={() => updateData(null)} fileName={appState.fileHandle?.name}/>),\r\n});\r\nexport const actionSaveFileToDisk = register({\r\n    name: \"saveFileToDisk\",\r\n    perform: async (elements, appState, value, app) => {\r\n        try {\r\n            const { fileHandle } = await saveAsJSON(elements, {\r\n                ...appState,\r\n                fileHandle: null,\r\n            }, app.files);\r\n            return { commitToHistory: false, appState: { ...appState, fileHandle } };\r\n        }\r\n        catch (error) {\r\n            if (error?.name !== \"AbortError\") {\r\n                console.error(error);\r\n            }\r\n            return { commitToHistory: false };\r\n        }\r\n    },\r\n    keyTest: (event) => event.key === KEYS.S && event.shiftKey && event[KEYS.CTRL_OR_CMD],\r\n    PanelComponent: ({ updateData }) => (<ToolButton type=\"button\" icon={saveAs} title={t(\"buttons.saveAs\")} aria-label={t(\"buttons.saveAs\")} showAriaLabel={useIsMobile()} hidden={!nativeFileSystemSupported} onClick={() => updateData(null)} data-testid=\"save-as-button\"/>),\r\n});\r\nexport const actionLoadScene = register({\r\n    name: \"loadScene\",\r\n    perform: async (elements, appState, _, app) => {\r\n        try {\r\n            const { elements: loadedElements, appState: loadedAppState, files, } = await loadFromJSON(appState, elements);\r\n            return {\r\n                elements: loadedElements,\r\n                appState: loadedAppState,\r\n                files,\r\n                commitToHistory: true,\r\n            };\r\n        }\r\n        catch (error) {\r\n            if (error?.name === \"AbortError\") {\r\n                return false;\r\n            }\r\n            return {\r\n                elements,\r\n                appState: { ...appState, errorMessage: error.message },\r\n                files: app.files,\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.key === KEYS.O,\r\n    PanelComponent: ({ updateData, appState }) => (<ToolButton type=\"button\" icon={load} title={t(\"buttons.load\")} aria-label={t(\"buttons.load\")} showAriaLabel={useIsMobile()} onClick={updateData} data-testid=\"load-button\"/>),\r\n});\r\nexport const actionExportWithDarkMode = register({\r\n    name: \"exportWithDarkMode\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportWithDarkMode: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<div style={{\r\n            display: \"flex\",\r\n            justifyContent: \"flex-end\",\r\n            marginTop: \"-45px\",\r\n            marginBottom: \"10px\",\r\n        }}>\r\n      <DarkModeToggle value={appState.exportWithDarkMode ? THEME.DARK : THEME.LIGHT} onChange={(theme) => {\r\n            updateData(theme === THEME.DARK);\r\n        }} title={t(\"labels.toggleExportColorScheme\")}/>\r\n    </div>),\r\n});\r\n","import { isTextElement, isExcalidrawElement, redrawTextBoundingBox, } from \"../element\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nimport { t } from \"../i18n\";\r\nimport { register } from \"./register\";\r\nimport { mutateElement, newElementWith } from \"../element/mutateElement\";\r\nimport { DEFAULT_FONT_SIZE, DEFAULT_FONT_FAMILY, DEFAULT_TEXT_ALIGN, } from \"../constants\";\r\n// `copiedStyles` is exported only for tests.\r\nexport let copiedStyles = \"{}\";\r\nexport const actionCopyStyles = register({\r\n    name: \"copyStyles\",\r\n    perform: (elements, appState) => {\r\n        const element = elements.find((el) => appState.selectedElementIds[el.id]);\r\n        if (element) {\r\n            copiedStyles = JSON.stringify(element);\r\n        }\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                toastMessage: t(\"toast.copyStyles\"),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.copyStyles\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.C,\r\n});\r\nexport const actionPasteStyles = register({\r\n    name: \"pasteStyles\",\r\n    perform: (elements, appState) => {\r\n        const pastedElement = JSON.parse(copiedStyles);\r\n        if (!isExcalidrawElement(pastedElement)) {\r\n            return { elements, commitToHistory: false };\r\n        }\r\n        return {\r\n            elements: elements.map((element) => {\r\n                if (appState.selectedElementIds[element.id]) {\r\n                    const newElement = newElementWith(element, {\r\n                        backgroundColor: pastedElement?.backgroundColor,\r\n                        strokeWidth: pastedElement?.strokeWidth,\r\n                        strokeColor: pastedElement?.strokeColor,\r\n                        strokeStyle: pastedElement?.strokeStyle,\r\n                        fillStyle: pastedElement?.fillStyle,\r\n                        opacity: pastedElement?.opacity,\r\n                        roughness: pastedElement?.roughness,\r\n                    });\r\n                    if (isTextElement(newElement)) {\r\n                        mutateElement(newElement, {\r\n                            fontSize: pastedElement?.fontSize || DEFAULT_FONT_SIZE,\r\n                            fontFamily: pastedElement?.fontFamily || DEFAULT_FONT_FAMILY,\r\n                            textAlign: pastedElement?.textAlign || DEFAULT_TEXT_ALIGN,\r\n                        });\r\n                        redrawTextBoundingBox(newElement);\r\n                    }\r\n                    return newElement;\r\n                }\r\n                return element;\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.pasteStyles\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.V,\r\n});\r\n","import { questionCircle } from \"../components/icons\";\r\nexport const HelpIcon = (props) => (<button className=\"help-icon\" onClick={props.onClick} type=\"button\" title={`${props.title} — ?`} aria-label={props.title}>\r\n    {questionCircle}\r\n  </button>);\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { t } from \"../i18n\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nimport { UngroupIcon, GroupIcon } from \"../components/icons\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getSelectedGroupIds, selectGroup, selectGroupsForSelectedElements, getElementsInGroup, addToGroup, removeFromSelectedGroups, isElementInGroup, } from \"../groups\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { randomId } from \"../random\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nconst allElementsInSameGroup = (elements) => {\r\n    if (elements.length >= 2) {\r\n        const groupIds = elements[0].groupIds;\r\n        for (const groupId of groupIds) {\r\n            if (elements.reduce((acc, element) => acc && isElementInGroup(element, groupId), true)) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n};\r\nconst enableActionGroup = (elements, appState) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    return (selectedElements.length >= 2 && !allElementsInSameGroup(selectedElements));\r\n};\r\nexport const actionGroup = register({\r\n    name: \"group\",\r\n    perform: (elements, appState) => {\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        if (selectedElements.length < 2) {\r\n            // nothing to group\r\n            return { appState, elements, commitToHistory: false };\r\n        }\r\n        // if everything is already grouped into 1 group, there is nothing to do\r\n        const selectedGroupIds = getSelectedGroupIds(appState);\r\n        if (selectedGroupIds.length === 1) {\r\n            const selectedGroupId = selectedGroupIds[0];\r\n            const elementIdsInGroup = new Set(getElementsInGroup(elements, selectedGroupId).map((element) => element.id));\r\n            const selectedElementIds = new Set(selectedElements.map((element) => element.id));\r\n            const combinedSet = new Set([\r\n                ...Array.from(elementIdsInGroup),\r\n                ...Array.from(selectedElementIds),\r\n            ]);\r\n            if (combinedSet.size === elementIdsInGroup.size) {\r\n                // no incremental ids in the selected ids\r\n                return { appState, elements, commitToHistory: false };\r\n            }\r\n        }\r\n        const newGroupId = randomId();\r\n        const updatedElements = elements.map((element) => {\r\n            if (!appState.selectedElementIds[element.id]) {\r\n                return element;\r\n            }\r\n            return newElementWith(element, {\r\n                groupIds: addToGroup(element.groupIds, newGroupId, appState.editingGroupId),\r\n            });\r\n        });\r\n        // keep the z order within the group the same, but move them\r\n        // to the z order of the highest element in the layer stack\r\n        const elementsInGroup = getElementsInGroup(updatedElements, newGroupId);\r\n        const lastElementInGroup = elementsInGroup[elementsInGroup.length - 1];\r\n        const lastGroupElementIndex = updatedElements.lastIndexOf(lastElementInGroup);\r\n        const elementsAfterGroup = updatedElements.slice(lastGroupElementIndex + 1);\r\n        const elementsBeforeGroup = updatedElements\r\n            .slice(0, lastGroupElementIndex)\r\n            .filter((updatedElement) => !isElementInGroup(updatedElement, newGroupId));\r\n        const updatedElementsInOrder = [\r\n            ...elementsBeforeGroup,\r\n            ...elementsInGroup,\r\n            ...elementsAfterGroup,\r\n        ];\r\n        return {\r\n            appState: selectGroup(newGroupId, { ...appState, selectedGroupIds: {} }, getNonDeletedElements(updatedElementsInOrder)),\r\n            elements: updatedElementsInOrder,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.group\",\r\n    contextItemPredicate: (elements, appState) => enableActionGroup(elements, appState),\r\n    keyTest: (event) => !event.shiftKey && event[KEYS.CTRL_OR_CMD] && event.code === CODES.G,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<GroupIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.group\")} — ${getShortcutKey(\"CtrlOrCmd+G\")}`} aria-label={t(\"labels.group\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}></ToolButton>),\r\n});\r\nexport const actionUngroup = register({\r\n    name: \"ungroup\",\r\n    perform: (elements, appState) => {\r\n        const groupIds = getSelectedGroupIds(appState);\r\n        if (groupIds.length === 0) {\r\n            return { appState, elements, commitToHistory: false };\r\n        }\r\n        const nextElements = elements.map((element) => {\r\n            const nextGroupIds = removeFromSelectedGroups(element.groupIds, appState.selectedGroupIds);\r\n            if (nextGroupIds.length === element.groupIds.length) {\r\n                return element;\r\n            }\r\n            return newElementWith(element, {\r\n                groupIds: nextGroupIds,\r\n            });\r\n        });\r\n        return {\r\n            appState: selectGroupsForSelectedElements({ ...appState, selectedGroupIds: {} }, getNonDeletedElements(nextElements)),\r\n            elements: nextElements,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.shiftKey && event[KEYS.CTRL_OR_CMD] && event.code === CODES.G,\r\n    contextItemLabel: \"labels.ungroup\",\r\n    contextItemPredicate: (elements, appState) => getSelectedGroupIds(appState).length > 0,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton type=\"button\" hidden={getSelectedGroupIds(appState).length === 0} icon={<UngroupIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.ungroup\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+G\")}`} aria-label={t(\"labels.ungroup\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}></ToolButton>),\r\n});\r\n","import { menu, palette } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { t } from \"../i18n\";\r\nimport { showSelectedShapeActions, getNonDeletedElements } from \"../element\";\r\nimport { register } from \"./register\";\r\nimport { allowFullScreen, exitFullScreen, isFullScreen } from \"../utils\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nimport { HelpIcon } from \"../components/HelpIcon\";\r\nexport const actionToggleCanvasMenu = register({\r\n    name: \"toggleCanvasMenu\",\r\n    perform: (_, appState) => ({\r\n        appState: {\r\n            ...appState,\r\n            openMenu: appState.openMenu === \"canvas\" ? null : \"canvas\",\r\n        },\r\n        commitToHistory: false,\r\n    }),\r\n    PanelComponent: ({ appState, updateData }) => (<ToolButton type=\"button\" icon={menu} aria-label={t(\"buttons.menu\")} onClick={updateData} selected={appState.openMenu === \"canvas\"}/>),\r\n});\r\nexport const actionToggleEditMenu = register({\r\n    name: \"toggleEditMenu\",\r\n    perform: (_elements, appState) => ({\r\n        appState: {\r\n            ...appState,\r\n            openMenu: appState.openMenu === \"shape\" ? null : \"shape\",\r\n        },\r\n        commitToHistory: false,\r\n    }),\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton visible={showSelectedShapeActions(appState, getNonDeletedElements(elements))} type=\"button\" icon={palette} aria-label={t(\"buttons.edit\")} onClick={updateData} selected={appState.openMenu === \"shape\"}/>),\r\n});\r\nexport const actionFullScreen = register({\r\n    name: \"toggleFullScreen\",\r\n    perform: () => {\r\n        if (!isFullScreen()) {\r\n            allowFullScreen();\r\n        }\r\n        if (isFullScreen()) {\r\n            exitFullScreen();\r\n        }\r\n        return {\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    keyTest: (event) => event.code === CODES.F && !event[KEYS.CTRL_OR_CMD],\r\n});\r\nexport const actionShortcuts = register({\r\n    name: \"toggleShortcuts\",\r\n    perform: (_elements, appState, _, { focusContainer }) => {\r\n        if (appState.showHelpDialog) {\r\n            focusContainer();\r\n        }\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                showHelpDialog: !appState.showHelpDialog,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => (<HelpIcon title={t(\"helpDialog.title\")} onClick={updateData}/>),\r\n    keyTest: (event) => event.key === KEYS.QUESTION_MARK,\r\n});\r\n","import \"./Avatar.scss\";\r\nimport React from \"react\";\r\nexport const Avatar = ({ children, color, border, onClick }) => (<div className=\"Avatar\" style={{ background: color, border: `1px solid ${border}` }} onClick={onClick}>\r\n    {children}\r\n  </div>);\r\n","import { register } from \"./register\";\r\nimport { getSelectedElements } from \"../scene\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { deepCopyElement } from \"../element/newElement\";\r\nexport const actionAddToLibrary = register({\r\n    name: \"addToLibrary\",\r\n    perform: (elements, appState, _, app) => {\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        app.library.loadLibrary().then((items) => {\r\n            app.library.saveLibrary([\r\n                ...items,\r\n                selectedElements.map(deepCopyElement),\r\n            ]);\r\n        });\r\n        return false;\r\n    },\r\n    contextItemLabel: \"labels.addToLibrary\",\r\n});\r\n","import { getClientColors, getClientInitials } from \"../clients\";\r\nimport { Avatar } from \"../components/Avatar\";\r\nimport { centerScrollOn } from \"../scene/scroll\";\r\nimport { register } from \"./register\";\r\nexport const actionGoToCollaborator = register({\r\n    name: \"goToCollaborator\",\r\n    perform: (_elements, appState, value) => {\r\n        const point = value;\r\n        if (!point) {\r\n            return { appState, commitToHistory: false };\r\n        }\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                ...centerScrollOn({\r\n                    scenePoint: point,\r\n                    viewportDimensions: {\r\n                        width: appState.width,\r\n                        height: appState.height,\r\n                    },\r\n                    zoom: appState.zoom,\r\n                }),\r\n                // Close mobile menu\r\n                openMenu: appState.openMenu === \"canvas\" ? null : appState.openMenu,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData, data }) => {\r\n        const clientId = data?.id;\r\n        if (!clientId) {\r\n            return null;\r\n        }\r\n        const collaborator = appState.collaborators.get(clientId);\r\n        if (!collaborator) {\r\n            return null;\r\n        }\r\n        const { background, stroke } = getClientColors(clientId, appState);\r\n        const shortName = getClientInitials(collaborator.username);\r\n        return (<Avatar color={background} border={stroke} onClick={() => updateData(collaborator.pointer)}>\r\n        {shortName}\r\n      </Avatar>);\r\n    },\r\n});\r\n","import { newElementWith } from \"./element/mutateElement\";\r\nimport { getCommonBounds } from \"./element\";\r\nexport const alignElements = (selectedElements, alignment) => {\r\n    const groups = getMaximumGroups(selectedElements);\r\n    const selectionBoundingBox = getCommonBoundingBox(selectedElements);\r\n    return groups.flatMap((group) => {\r\n        const translation = calculateTranslation(group, selectionBoundingBox, alignment);\r\n        return group.map((element) => newElementWith(element, {\r\n            x: element.x + translation.x,\r\n            y: element.y + translation.y,\r\n        }));\r\n    });\r\n};\r\nexport const getMaximumGroups = (elements) => {\r\n    const groups = new Map();\r\n    elements.forEach((element) => {\r\n        const groupId = element.groupIds.length === 0\r\n            ? element.id\r\n            : element.groupIds[element.groupIds.length - 1];\r\n        const currentGroupMembers = groups.get(groupId) || [];\r\n        groups.set(groupId, [...currentGroupMembers, element]);\r\n    });\r\n    return Array.from(groups.values());\r\n};\r\nconst calculateTranslation = (group, selectionBoundingBox, { axis, position }) => {\r\n    const groupBoundingBox = getCommonBoundingBox(group);\r\n    const [min, max] = axis === \"x\" ? [\"minX\", \"maxX\"] : [\"minY\", \"maxY\"];\r\n    const noTranslation = { x: 0, y: 0 };\r\n    if (position === \"start\") {\r\n        return {\r\n            ...noTranslation,\r\n            [axis]: selectionBoundingBox[min] - groupBoundingBox[min],\r\n        };\r\n    }\r\n    else if (position === \"end\") {\r\n        return {\r\n            ...noTranslation,\r\n            [axis]: selectionBoundingBox[max] - groupBoundingBox[max],\r\n        };\r\n    } // else if (position === \"center\") {\r\n    return {\r\n        ...noTranslation,\r\n        [axis]: (selectionBoundingBox[min] + selectionBoundingBox[max]) / 2 -\r\n            (groupBoundingBox[min] + groupBoundingBox[max]) / 2,\r\n    };\r\n};\r\nconst getCommonBoundingBox = (elements) => {\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n    return { minX, minY, maxX, maxY };\r\n};\r\n","import { alignElements } from \"../align\";\r\nimport { AlignBottomIcon, AlignLeftIcon, AlignRightIcon, AlignTopIcon, CenterHorizontallyIcon, CenterVerticallyIcon, } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { getElementMap, getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { KEYS } from \"../keys\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nconst enableActionGroup = (elements, appState) => getSelectedElements(getNonDeletedElements(elements), appState).length > 1;\r\nconst alignSelectedElements = (elements, appState, alignment) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    const updatedElements = alignElements(selectedElements, alignment);\r\n    const updatedElementsMap = getElementMap(updatedElements);\r\n    return elements.map((element) => updatedElementsMap[element.id] || element);\r\n};\r\nexport const actionAlignTop = register({\r\n    name: \"alignTop\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"start\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_UP,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignTopIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignTop\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Up\")}`} aria-label={t(\"labels.alignTop\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignBottom = register({\r\n    name: \"alignBottom\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"end\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_DOWN,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignBottomIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignBottom\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Down\")}`} aria-label={t(\"labels.alignBottom\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignLeft = register({\r\n    name: \"alignLeft\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"start\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_LEFT,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignLeftIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignLeft\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Left\")}`} aria-label={t(\"labels.alignLeft\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignRight = register({\r\n    name: \"alignRight\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"end\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_RIGHT,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignRightIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignRight\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Right\")}`} aria-label={t(\"labels.alignRight\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignVerticallyCentered = register({\r\n    name: \"alignVerticallyCentered\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"center\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<CenterVerticallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={t(\"labels.centerVertically\")} aria-label={t(\"labels.centerVertically\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignHorizontallyCentered = register({\r\n    name: \"alignHorizontallyCentered\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"center\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<CenterHorizontallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={t(\"labels.centerHorizontally\")} aria-label={t(\"labels.centerHorizontally\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\n","import { newElementWith } from \"./element/mutateElement\";\r\nimport { getCommonBounds } from \"./element\";\r\nexport const distributeElements = (selectedElements, distribution) => {\r\n    const [start, mid, end, extent] = distribution.axis === \"x\"\r\n        ? [\"minX\", \"midX\", \"maxX\", \"width\"]\r\n        : [\"minY\", \"midY\", \"maxY\", \"height\"];\r\n    const bounds = getCommonBoundingBox(selectedElements);\r\n    const groups = getMaximumGroups(selectedElements)\r\n        .map((group) => [group, getCommonBoundingBox(group)])\r\n        .sort((a, b) => a[1][mid] - b[1][mid]);\r\n    let span = 0;\r\n    for (const group of groups) {\r\n        span += group[1][extent];\r\n    }\r\n    const step = (bounds[extent] - span) / (groups.length - 1);\r\n    if (step < 0) {\r\n        // If we have a negative step, we'll need to distribute from centers\r\n        // rather than from gaps. Buckle up, this is a weird one.\r\n        // Get indices of boxes that define start and end of our bounding box\r\n        const index0 = groups.findIndex((g) => g[1][start] === bounds[start]);\r\n        const index1 = groups.findIndex((g) => g[1][end] === bounds[end]);\r\n        // Get our step, based on the distance between the center points of our\r\n        // start and end boxes\r\n        const step = (groups[index1][1][mid] - groups[index0][1][mid]) / (groups.length - 1);\r\n        let pos = groups[index0][1][mid];\r\n        return groups.flatMap(([group, box], index) => {\r\n            const translation = {\r\n                x: 0,\r\n                y: 0,\r\n            };\r\n            // Don't move our start and end boxes\r\n            if (index !== index0 && index !== index1) {\r\n                pos += step;\r\n                translation[distribution.axis] = pos - box[mid];\r\n            }\r\n            return group.map((element) => newElementWith(element, {\r\n                x: element.x + translation.x,\r\n                y: element.y + translation.y,\r\n            }));\r\n        });\r\n    }\r\n    // Distribute from gaps\r\n    let pos = bounds[start];\r\n    return groups.flatMap(([group, box]) => {\r\n        const translation = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        translation[distribution.axis] = pos - box[start];\r\n        pos += step;\r\n        pos += box[extent];\r\n        return group.map((element) => newElementWith(element, {\r\n            x: element.x + translation.x,\r\n            y: element.y + translation.y,\r\n        }));\r\n    });\r\n};\r\nexport const getMaximumGroups = (elements) => {\r\n    const groups = new Map();\r\n    elements.forEach((element) => {\r\n        const groupId = element.groupIds.length === 0\r\n            ? element.id\r\n            : element.groupIds[element.groupIds.length - 1];\r\n        const currentGroupMembers = groups.get(groupId) || [];\r\n        groups.set(groupId, [...currentGroupMembers, element]);\r\n    });\r\n    return Array.from(groups.values());\r\n};\r\nconst getCommonBoundingBox = (elements) => {\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n    return {\r\n        minX,\r\n        minY,\r\n        maxX,\r\n        maxY,\r\n        width: maxX - minX,\r\n        height: maxY - minY,\r\n        midX: (minX + maxX) / 2,\r\n        midY: (minY + maxY) / 2,\r\n    };\r\n};\r\n","import { DistributeHorizontallyIcon, DistributeVerticallyIcon, } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { distributeElements } from \"../disitrubte\";\r\nimport { getElementMap, getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { CODES } from \"../keys\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nconst enableActionGroup = (elements, appState) => getSelectedElements(getNonDeletedElements(elements), appState).length > 1;\r\nconst distributeSelectedElements = (elements, appState, distribution) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    const updatedElements = distributeElements(selectedElements, distribution);\r\n    const updatedElementsMap = getElementMap(updatedElements);\r\n    return elements.map((element) => updatedElementsMap[element.id] || element);\r\n};\r\nexport const distributeHorizontally = register({\r\n    name: \"distributeHorizontally\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: distributeSelectedElements(elements, appState, {\r\n                space: \"between\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.altKey && event.code === CODES.H,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<DistributeHorizontallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.distributeHorizontally\")} — ${getShortcutKey(\"Alt+H\")}`} aria-label={t(\"labels.distributeHorizontally\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const distributeVertically = register({\r\n    name: \"distributeVertically\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: distributeSelectedElements(elements, appState, {\r\n                space: \"between\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.altKey && event.code === CODES.V,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<DistributeVerticallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.distributeVertically\")} — ${getShortcutKey(\"Alt+V\")}`} aria-label={t(\"labels.distributeVertically\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\n","import { register } from \"./register\";\r\nimport { getSelectedElements } from \"../scene\";\r\nimport { getElementMap, getNonDeletedElements } from \"../element\";\r\nimport { mutateElement } from \"../element/mutateElement\";\r\nimport { normalizeAngle, resizeSingleElement } from \"../element/resizeElements\";\r\nimport { getTransformHandles } from \"../element/transformHandles\";\r\nimport { isFreeDrawElement, isLinearElement } from \"../element/typeChecks\";\r\nimport { updateBoundElements } from \"../element/binding\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nconst enableActionFlipHorizontal = (elements, appState) => {\r\n    const eligibleElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    return eligibleElements.length === 1 && eligibleElements[0].type !== \"text\";\r\n};\r\nconst enableActionFlipVertical = (elements, appState) => {\r\n    const eligibleElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    return eligibleElements.length === 1;\r\n};\r\nexport const actionFlipHorizontal = register({\r\n    name: \"flipHorizontal\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: flipSelectedElements(elements, appState, \"horizontal\"),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.shiftKey && event.code === \"KeyH\",\r\n    contextItemLabel: \"labels.flipHorizontal\",\r\n    contextItemPredicate: (elements, appState) => enableActionFlipHorizontal(elements, appState),\r\n});\r\nexport const actionFlipVertical = register({\r\n    name: \"flipVertical\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: flipSelectedElements(elements, appState, \"vertical\"),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.shiftKey && event.code === \"KeyV\",\r\n    contextItemLabel: \"labels.flipVertical\",\r\n    contextItemPredicate: (elements, appState) => enableActionFlipVertical(elements, appState),\r\n});\r\nconst flipSelectedElements = (elements, appState, flipDirection) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    // remove once we allow for groups of elements to be flipped\r\n    if (selectedElements.length > 1) {\r\n        return elements;\r\n    }\r\n    const updatedElements = flipElements(selectedElements, appState, flipDirection);\r\n    const updatedElementsMap = getElementMap(updatedElements);\r\n    return elements.map((element) => updatedElementsMap[element.id] || element);\r\n};\r\nconst flipElements = (elements, appState, flipDirection) => {\r\n    elements.forEach((element) => {\r\n        flipElement(element, appState);\r\n        // If vertical flip, rotate an extra 180\r\n        if (flipDirection === \"vertical\") {\r\n            rotateElement(element, Math.PI);\r\n        }\r\n    });\r\n    return elements;\r\n};\r\nconst flipElement = (element, appState) => {\r\n    const originalX = element.x;\r\n    const originalY = element.y;\r\n    const width = element.width;\r\n    const height = element.height;\r\n    const originalAngle = normalizeAngle(element.angle);\r\n    let finalOffsetX = 0;\r\n    if (isLinearElement(element) || isFreeDrawElement(element)) {\r\n        finalOffsetX =\r\n            element.points.reduce((max, point) => Math.max(max, point[0]), 0) * 2 -\r\n                element.width;\r\n    }\r\n    // Rotate back to zero, if necessary\r\n    mutateElement(element, {\r\n        angle: normalizeAngle(0),\r\n    });\r\n    // Flip unrotated by pulling TransformHandle to opposite side\r\n    const transformHandles = getTransformHandles(element, appState.zoom);\r\n    let usingNWHandle = true;\r\n    let newNCoordsX = 0;\r\n    let nHandle = transformHandles.nw;\r\n    if (!nHandle) {\r\n        // Use ne handle instead\r\n        usingNWHandle = false;\r\n        nHandle = transformHandles.ne;\r\n        if (!nHandle) {\r\n            mutateElement(element, {\r\n                angle: originalAngle,\r\n            });\r\n            return;\r\n        }\r\n    }\r\n    if (isLinearElement(element)) {\r\n        for (let i = 1; i < element.points.length; i++) {\r\n            LinearElementEditor.movePoint(element, i, [\r\n                -element.points[i][0],\r\n                element.points[i][1],\r\n            ]);\r\n        }\r\n        LinearElementEditor.normalizePoints(element);\r\n    }\r\n    else {\r\n        // calculate new x-coord for transformation\r\n        newNCoordsX = usingNWHandle ? element.x + 2 * width : element.x - 2 * width;\r\n        resizeSingleElement(element, true, element, usingNWHandle ? \"nw\" : \"ne\", false, newNCoordsX, nHandle[1]);\r\n        // fix the size to account for handle sizes\r\n        mutateElement(element, {\r\n            width,\r\n            height,\r\n        });\r\n    }\r\n    // Rotate by (360 degrees - original angle)\r\n    let angle = normalizeAngle(2 * Math.PI - originalAngle);\r\n    if (angle < 0) {\r\n        // check, probably unnecessary\r\n        angle = normalizeAngle(angle + 2 * Math.PI);\r\n    }\r\n    mutateElement(element, {\r\n        angle,\r\n    });\r\n    // Move back to original spot to appear \"flipped in place\"\r\n    mutateElement(element, {\r\n        x: originalX + finalOffsetX,\r\n        y: originalY,\r\n    });\r\n    updateBoundElements(element);\r\n};\r\nconst rotateElement = (element, rotationAngle) => {\r\n    const originalX = element.x;\r\n    const originalY = element.y;\r\n    let angle = normalizeAngle(element.angle + rotationAngle);\r\n    if (angle < 0) {\r\n        // check, probably unnecessary\r\n        angle = normalizeAngle(2 * Math.PI + angle);\r\n    }\r\n    mutateElement(element, {\r\n        angle,\r\n    });\r\n    // Move back to original spot\r\n    mutateElement(element, {\r\n        x: originalX,\r\n        y: originalY,\r\n    });\r\n};\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { copyToClipboard } from \"../clipboard\";\r\nimport { actionDeleteSelected } from \"./actionDeleteSelected\";\r\nimport { getSelectedElements } from \"../scene/selection\";\r\nimport { exportCanvas } from \"../data/index\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nexport const actionCopy = register({\r\n    name: \"copy\",\r\n    perform: (elements, appState, _, app) => {\r\n        copyToClipboard(getNonDeletedElements(elements), appState, app.files);\r\n        return {\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.copy\",\r\n    // don't supply a shortcut since we handle this conditionally via onCopy event\r\n    keyTest: undefined,\r\n});\r\nexport const actionCut = register({\r\n    name: \"cut\",\r\n    perform: (elements, appState, data, app) => {\r\n        actionCopy.perform(elements, appState, data, app);\r\n        return actionDeleteSelected.perform(elements, appState, data, app);\r\n    },\r\n    contextItemLabel: \"labels.cut\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.code === CODES.X,\r\n});\r\nexport const actionCopyAsSvg = register({\r\n    name: \"copyAsSvg\",\r\n    perform: async (elements, appState, _data, app) => {\r\n        if (!app.canvas) {\r\n            return {\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        try {\r\n            await exportCanvas(\"clipboard-svg\", selectedElements.length\r\n                ? selectedElements\r\n                : getNonDeletedElements(elements), appState, app.files, appState);\r\n            return {\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    errorMessage: error.message,\r\n                },\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n    },\r\n    contextItemLabel: \"labels.copyAsSvg\",\r\n});\r\nexport const actionCopyAsPng = register({\r\n    name: \"copyAsPng\",\r\n    perform: async (elements, appState, _data, app) => {\r\n        if (!app.canvas) {\r\n            return {\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        try {\r\n            await exportCanvas(\"clipboard\", selectedElements.length\r\n                ? selectedElements\r\n                : getNonDeletedElements(elements), appState, app.files, appState);\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    toastMessage: t(\"toast.copyToClipboardAsPng\", {\r\n                        exportSelection: selectedElements.length\r\n                            ? t(\"toast.selection\")\r\n                            : t(\"toast.canvas\"),\r\n                        exportColorScheme: appState.exportWithDarkMode\r\n                            ? t(\"buttons.darkMode\")\r\n                            : t(\"buttons.lightMode\"),\r\n                    }),\r\n                },\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    errorMessage: error.message,\r\n                },\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n    },\r\n    contextItemLabel: \"labels.copyAsPng\",\r\n    keyTest: (event) => event.code === CODES.C && event.altKey && event.shiftKey,\r\n});\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { GRID_SIZE } from \"../constants\";\r\nimport { trackEvent } from \"../analytics\";\r\nexport const actionToggleGridMode = register({\r\n    name: \"gridMode\",\r\n    perform(elements, appState) {\r\n        trackEvent(\"view\", \"mode\", \"grid\");\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                gridSize: this.checked(appState) ? null : GRID_SIZE,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.gridSize !== null,\r\n    contextItemLabel: \"labels.showGrid\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.code === CODES.QUOTE,\r\n});\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { trackEvent } from \"../analytics\";\r\nexport const actionToggleZenMode = register({\r\n    name: \"zenMode\",\r\n    perform(elements, appState) {\r\n        trackEvent(\"view\", \"mode\", \"zen\");\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zenModeEnabled: !this.checked(appState),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.zenModeEnabled,\r\n    contextItemLabel: \"buttons.zenMode\",\r\n    keyTest: (event) => !event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.Z,\r\n});\r\n","import { register } from \"./register\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nexport const actionToggleStats = register({\r\n    name: \"stats\",\r\n    perform(elements, appState) {\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                showStats: !this.checked(appState),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.showStats,\r\n    contextItemLabel: \"stats.title\",\r\n    keyTest: (event) => !event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.SLASH,\r\n});\r\n","import { undo, redo } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { t } from \"../i18n\";\r\nimport { isWindows, KEYS } from \"../keys\";\r\nimport { getElementMap } from \"../element\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\r\nconst writeData = (prevElements, appState, updater) => {\r\n    const commitToHistory = false;\r\n    if (!appState.multiElement &&\r\n        !appState.resizingElement &&\r\n        !appState.editingElement &&\r\n        !appState.draggingElement) {\r\n        const data = updater();\r\n        if (data === null) {\r\n            return { commitToHistory };\r\n        }\r\n        const prevElementMap = getElementMap(prevElements);\r\n        const nextElements = data.elements;\r\n        const nextElementMap = getElementMap(nextElements);\r\n        const deletedElements = prevElements.filter((prevElement) => !nextElementMap.hasOwnProperty(prevElement.id));\r\n        const elements = nextElements\r\n            .map((nextElement) => newElementWith(prevElementMap[nextElement.id] || nextElement, nextElement))\r\n            .concat(deletedElements.map((prevElement) => newElementWith(prevElement, { isDeleted: true })));\r\n        fixBindingsAfterDeletion(elements, deletedElements);\r\n        return {\r\n            elements,\r\n            appState: { ...appState, ...data.appState },\r\n            commitToHistory,\r\n            syncHistory: true,\r\n        };\r\n    }\r\n    return { commitToHistory };\r\n};\r\nexport const createUndoAction = (history) => ({\r\n    name: \"undo\",\r\n    perform: (elements, appState) => writeData(elements, appState, () => history.undoOnce()),\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] &&\r\n        event.key.toLowerCase() === KEYS.Z &&\r\n        !event.shiftKey,\r\n    PanelComponent: ({ updateData, data }) => (<ToolButton type=\"button\" icon={undo} aria-label={t(\"buttons.undo\")} onClick={updateData} size={data?.size || \"medium\"}/>),\r\n    commitToHistory: () => false,\r\n});\r\nexport const createRedoAction = (history) => ({\r\n    name: \"redo\",\r\n    perform: (elements, appState) => writeData(elements, appState, () => history.redoOnce()),\r\n    keyTest: (event) => (event[KEYS.CTRL_OR_CMD] &&\r\n        event.shiftKey &&\r\n        event.key.toLowerCase() === KEYS.Z) ||\r\n        (isWindows && event.ctrlKey && !event.shiftKey && event.key === KEYS.Y),\r\n    PanelComponent: ({ updateData, data }) => (<ToolButton type=\"button\" icon={redo} aria-label={t(\"buttons.redo\")} onClick={updateData} size={data?.size || \"medium\"}/>),\r\n    commitToHistory: () => false,\r\n});\r\n","import React from \"react\";\r\nimport { MODES } from \"../constants\";\r\nexport class ActionManager {\r\n    constructor(updater, getAppState, getElementsIncludingDeleted, app) {\r\n        this.actions = {};\r\n        /**\r\n         * @param data additional data sent to the PanelComponent\r\n         */\r\n        this.renderAction = (name, data) => {\r\n            const canvasActions = this.app.props.UIOptions.canvasActions;\r\n            if (this.actions[name] &&\r\n                \"PanelComponent\" in this.actions[name] &&\r\n                (name in canvasActions\r\n                    ? canvasActions[name]\r\n                    : true)) {\r\n                const action = this.actions[name];\r\n                const PanelComponent = action.PanelComponent;\r\n                const updateData = (formState) => {\r\n                    this.updater(action.perform(this.getElementsIncludingDeleted(), this.getAppState(), formState, this.app));\r\n                };\r\n                return (<PanelComponent elements={this.getElementsIncludingDeleted()} appState={this.getAppState()} updateData={updateData} appProps={this.app.props} data={data}/>);\r\n            }\r\n            return null;\r\n        };\r\n        this.updater = (actionResult) => {\r\n            if (actionResult && \"then\" in actionResult) {\r\n                actionResult.then((actionResult) => {\r\n                    return updater(actionResult);\r\n                });\r\n            }\r\n            else {\r\n                return updater(actionResult);\r\n            }\r\n        };\r\n        this.getAppState = getAppState;\r\n        this.getElementsIncludingDeleted = getElementsIncludingDeleted;\r\n        this.app = app;\r\n    }\r\n    registerAction(action) {\r\n        this.actions[action.name] = action;\r\n    }\r\n    registerAll(actions) {\r\n        actions.forEach((action) => this.registerAction(action));\r\n    }\r\n    handleKeyDown(event) {\r\n        const canvasActions = this.app.props.UIOptions.canvasActions;\r\n        const data = Object.values(this.actions)\r\n            .sort((a, b) => (b.keyPriority || 0) - (a.keyPriority || 0))\r\n            .filter((action) => (action.name in canvasActions\r\n            ? canvasActions[action.name]\r\n            : true) &&\r\n            action.keyTest &&\r\n            action.keyTest(event, this.getAppState(), this.getElementsIncludingDeleted()));\r\n        if (data.length === 0) {\r\n            return false;\r\n        }\r\n        const { viewModeEnabled } = this.getAppState();\r\n        if (viewModeEnabled) {\r\n            if (!Object.values(MODES).includes(data[0].name)) {\r\n                return false;\r\n            }\r\n        }\r\n        event.preventDefault();\r\n        this.updater(data[0].perform(this.getElementsIncludingDeleted(), this.getAppState(), null, this.app));\r\n        return true;\r\n    }\r\n    executeAction(action) {\r\n        this.updater(action.perform(this.getElementsIncludingDeleted(), this.getAppState(), null, this.app));\r\n    }\r\n}\r\n","import { loadLibraryFromBlob } from \"./blob\";\r\nimport { restoreElements } from \"./restore\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nclass Library {\r\n    constructor(app) {\r\n        this.libraryCache = null;\r\n        this.resetLibrary = async () => {\r\n            await this.app.props.onLibraryChange?.([]);\r\n            this.libraryCache = [];\r\n        };\r\n        this.restoreLibraryItem = (libraryItem) => {\r\n            const elements = getNonDeletedElements(restoreElements(libraryItem, null));\r\n            return elements.length ? elements : null;\r\n        };\r\n        this.loadLibrary = () => {\r\n            return new Promise(async (resolve) => {\r\n                if (this.libraryCache) {\r\n                    return resolve(JSON.parse(JSON.stringify(this.libraryCache)));\r\n                }\r\n                try {\r\n                    const libraryItems = this.app.libraryItemsFromStorage;\r\n                    if (!libraryItems) {\r\n                        return resolve([]);\r\n                    }\r\n                    const items = libraryItems.reduce((acc, item) => {\r\n                        const restoredItem = this.restoreLibraryItem(item);\r\n                        if (restoredItem) {\r\n                            acc.push(item);\r\n                        }\r\n                        return acc;\r\n                    }, []);\r\n                    // clone to ensure we don't mutate the cached library elements in the app\r\n                    this.libraryCache = JSON.parse(JSON.stringify(items));\r\n                    resolve(items);\r\n                }\r\n                catch (error) {\r\n                    console.error(error);\r\n                    resolve([]);\r\n                }\r\n            });\r\n        };\r\n        this.saveLibrary = async (items) => {\r\n            const prevLibraryItems = this.libraryCache;\r\n            try {\r\n                const serializedItems = JSON.stringify(items);\r\n                // cache optimistically so that the app has access to the latest\r\n                // immediately\r\n                this.libraryCache = JSON.parse(serializedItems);\r\n                await this.app.props.onLibraryChange?.(items);\r\n            }\r\n            catch (error) {\r\n                this.libraryCache = prevLibraryItems;\r\n                throw error;\r\n            }\r\n        };\r\n        this.app = app;\r\n    }\r\n    /** imports library (currently merges, removing duplicates) */\r\n    async importLibrary(blob) {\r\n        const libraryFile = await loadLibraryFromBlob(blob);\r\n        if (!libraryFile || !libraryFile.library) {\r\n            return;\r\n        }\r\n        /**\r\n         * checks if library item does not exist already in current library\r\n         */\r\n        const isUniqueitem = (existingLibraryItems, targetLibraryItem) => {\r\n            return !existingLibraryItems.find((libraryItem) => {\r\n                if (libraryItem.length !== targetLibraryItem.length) {\r\n                    return false;\r\n                }\r\n                // detect z-index difference by checking the excalidraw elements\r\n                // are in order\r\n                return libraryItem.every((libItemExcalidrawItem, idx) => {\r\n                    return (libItemExcalidrawItem.id === targetLibraryItem[idx].id &&\r\n                        libItemExcalidrawItem.versionNonce ===\r\n                            targetLibraryItem[idx].versionNonce);\r\n                });\r\n            });\r\n        };\r\n        const existingLibraryItems = await this.loadLibrary();\r\n        const filtered = libraryFile.library.reduce((acc, libraryItem) => {\r\n            const restoredItem = this.restoreLibraryItem(libraryItem);\r\n            if (restoredItem && isUniqueitem(existingLibraryItems, restoredItem)) {\r\n                acc.push(restoredItem);\r\n            }\r\n            return acc;\r\n        }, []);\r\n        await this.saveLibrary([...existingLibraryItems, ...filtered]);\r\n    }\r\n}\r\nexport default Library;\r\n","export const getCenter = (pointers) => {\r\n    const allCoords = Array.from(pointers.values());\r\n    return {\r\n        x: sum(allCoords, (coords) => coords.x) / allCoords.length,\r\n        y: sum(allCoords, (coords) => coords.y) / allCoords.length,\r\n    };\r\n};\r\nexport const getDistance = ([a, b]) => Math.hypot(a.x - b.x, a.y - b.y);\r\nconst sum = (array, mapper) => array.reduce((acc, item) => acc + mapper(item), 0);\r\n","import { isLinearElement } from \"./element/typeChecks\";\r\nimport { deepCopyElement } from \"./element/newElement\";\r\nconst clearAppStatePropertiesForHistory = (appState) => {\r\n    return {\r\n        selectedElementIds: appState.selectedElementIds,\r\n        selectedGroupIds: appState.selectedGroupIds,\r\n        viewBackgroundColor: appState.viewBackgroundColor,\r\n        editingLinearElement: appState.editingLinearElement,\r\n        editingGroupId: appState.editingGroupId,\r\n        name: appState.name,\r\n    };\r\n};\r\nclass History {\r\n    constructor() {\r\n        this.elementCache = new Map();\r\n        this.recording = true;\r\n        this.stateHistory = [];\r\n        this.redoStack = [];\r\n        this.lastEntry = null;\r\n        this.generateEntry = (appState, elements) => this.dehydrateHistoryEntry({\r\n            appState: clearAppStatePropertiesForHistory(appState),\r\n            elements: elements.reduce((elements, element) => {\r\n                if (isLinearElement(element) &&\r\n                    appState.multiElement &&\r\n                    appState.multiElement.id === element.id) {\r\n                    // don't store multi-point arrow if still has only one point\r\n                    if (appState.multiElement &&\r\n                        appState.multiElement.id === element.id &&\r\n                        element.points.length < 2) {\r\n                        return elements;\r\n                    }\r\n                    elements.push({\r\n                        ...element,\r\n                        // don't store last point if not committed\r\n                        points: element.lastCommittedPoint !==\r\n                            element.points[element.points.length - 1]\r\n                            ? element.points.slice(0, -1)\r\n                            : element.points,\r\n                    });\r\n                }\r\n                else {\r\n                    elements.push(element);\r\n                }\r\n                return elements;\r\n            }, []),\r\n        });\r\n    }\r\n    hydrateHistoryEntry({ appState, elements, }) {\r\n        return {\r\n            appState: JSON.parse(appState),\r\n            elements: elements.map((dehydratedExcalidrawElement) => {\r\n                const element = this.elementCache\r\n                    .get(dehydratedExcalidrawElement.id)\r\n                    ?.get(dehydratedExcalidrawElement.versionNonce);\r\n                if (!element) {\r\n                    throw new Error(`Element not found: ${dehydratedExcalidrawElement.id}:${dehydratedExcalidrawElement.versionNonce}`);\r\n                }\r\n                return element;\r\n            }),\r\n        };\r\n    }\r\n    dehydrateHistoryEntry({ appState, elements, }) {\r\n        return {\r\n            appState: JSON.stringify(appState),\r\n            elements: elements.map((element) => {\r\n                if (!this.elementCache.has(element.id)) {\r\n                    this.elementCache.set(element.id, new Map());\r\n                }\r\n                const versions = this.elementCache.get(element.id);\r\n                if (!versions.has(element.versionNonce)) {\r\n                    versions.set(element.versionNonce, deepCopyElement(element));\r\n                }\r\n                return {\r\n                    id: element.id,\r\n                    versionNonce: element.versionNonce,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n    getSnapshotForTest() {\r\n        return {\r\n            recording: this.recording,\r\n            stateHistory: this.stateHistory.map((dehydratedHistoryEntry) => this.hydrateHistoryEntry(dehydratedHistoryEntry)),\r\n            redoStack: this.redoStack.map((dehydratedHistoryEntry) => this.hydrateHistoryEntry(dehydratedHistoryEntry)),\r\n        };\r\n    }\r\n    clear() {\r\n        this.stateHistory.length = 0;\r\n        this.redoStack.length = 0;\r\n        this.lastEntry = null;\r\n        this.elementCache.clear();\r\n    }\r\n    shouldCreateEntry(nextEntry) {\r\n        const { lastEntry } = this;\r\n        if (!lastEntry) {\r\n            return true;\r\n        }\r\n        if (nextEntry.elements.length !== lastEntry.elements.length) {\r\n            return true;\r\n        }\r\n        // loop from right to left as changes are likelier to happen on new elements\r\n        for (let i = nextEntry.elements.length - 1; i > -1; i--) {\r\n            const prev = nextEntry.elements[i];\r\n            const next = lastEntry.elements[i];\r\n            if (!prev ||\r\n                !next ||\r\n                prev.id !== next.id ||\r\n                prev.versionNonce !== next.versionNonce) {\r\n                return true;\r\n            }\r\n        }\r\n        // note: this is safe because entry's appState is guaranteed no excess props\r\n        let key;\r\n        for (key in nextEntry.appState) {\r\n            if (key === \"editingLinearElement\") {\r\n                if (nextEntry.appState[key]?.elementId ===\r\n                    lastEntry.appState[key]?.elementId) {\r\n                    continue;\r\n                }\r\n            }\r\n            if (key === \"selectedElementIds\" || key === \"selectedGroupIds\") {\r\n                continue;\r\n            }\r\n            if (nextEntry.appState[key] !== lastEntry.appState[key]) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    pushEntry(appState, elements) {\r\n        const newEntryDehydrated = this.generateEntry(appState, elements);\r\n        const newEntry = this.hydrateHistoryEntry(newEntryDehydrated);\r\n        if (newEntry) {\r\n            if (!this.shouldCreateEntry(newEntry)) {\r\n                return;\r\n            }\r\n            this.stateHistory.push(newEntryDehydrated);\r\n            this.lastEntry = newEntry;\r\n            // As a new entry was pushed, we invalidate the redo stack\r\n            this.clearRedoStack();\r\n        }\r\n    }\r\n    clearRedoStack() {\r\n        this.redoStack.splice(0, this.redoStack.length);\r\n    }\r\n    redoOnce() {\r\n        if (this.redoStack.length === 0) {\r\n            return null;\r\n        }\r\n        const entryToRestore = this.redoStack.pop();\r\n        if (entryToRestore !== undefined) {\r\n            this.stateHistory.push(entryToRestore);\r\n            return this.hydrateHistoryEntry(entryToRestore);\r\n        }\r\n        return null;\r\n    }\r\n    undoOnce() {\r\n        if (this.stateHistory.length === 1) {\r\n            return null;\r\n        }\r\n        const currentEntry = this.stateHistory.pop();\r\n        const entryToRestore = this.stateHistory[this.stateHistory.length - 1];\r\n        if (currentEntry !== undefined) {\r\n            this.redoStack.push(currentEntry);\r\n            return this.hydrateHistoryEntry(entryToRestore);\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * Updates history's `lastEntry` to latest app state. This is necessary\r\n     *  when doing undo/redo which itself doesn't commit to history, but updates\r\n     *  app state in a way that would break `shouldCreateEntry` which relies on\r\n     *  `lastEntry` to reflect last comittable history state.\r\n     * We can't update `lastEntry` from within history when calling undo/redo\r\n     *  because the action potentially mutates appState/elements before storing\r\n     *  it.\r\n     */\r\n    setCurrentState(appState, elements) {\r\n        this.lastEntry = this.hydrateHistoryEntry(this.generateEntry(appState, elements));\r\n    }\r\n    // Suspicious that this is called so many places. Seems error-prone.\r\n    resumeRecording() {\r\n        this.recording = true;\r\n    }\r\n    record(state, elements) {\r\n        if (this.recording) {\r\n            this.pushEntry(state, elements);\r\n            this.recording = false;\r\n        }\r\n    }\r\n}\r\nexport default History;\r\n","import { KEYS } from \"./keys\";\r\n// We inline font-awesome icons in order to save on js size rather than including the font awesome react library\r\nexport const SHAPES = [\r\n    {\r\n        icon: (\r\n        // fa-mouse-pointer\r\n        <svg viewBox=\"0 0 320 512\" className=\"\">\r\n        <path d=\"M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z\"/>\r\n      </svg>),\r\n        value: \"selection\",\r\n        key: KEYS.V,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-square\r\n        <svg viewBox=\"0 0 448 512\">\r\n        <path d=\"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z\"/>\r\n      </svg>),\r\n        value: \"rectangle\",\r\n        key: KEYS.R,\r\n    },\r\n    {\r\n        icon: (\r\n        // custom\r\n        <svg viewBox=\"0 0 223.646 223.646\">\r\n        <path d=\"M111.823 0L16.622 111.823 111.823 223.646 207.025 111.823z\"/>\r\n      </svg>),\r\n        value: \"diamond\",\r\n        key: KEYS.D,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-circle\r\n        <svg viewBox=\"0 0 512 512\">\r\n        <path d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z\"/>\r\n      </svg>),\r\n        value: \"ellipse\",\r\n        key: KEYS.E,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-long-arrow-alt-right\r\n        <svg viewBox=\"0 0 448 512\" className=\"rtl-mirror\">\r\n        <path d=\"M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z\"/>\r\n      </svg>),\r\n        value: \"arrow\",\r\n        key: KEYS.A,\r\n    },\r\n    {\r\n        icon: (\r\n        // custom\r\n        <svg viewBox=\"0 0 6 6\">\r\n        <line x1=\"0\" y1=\"3\" x2=\"6\" y2=\"3\" stroke=\"currentColor\" strokeLinecap=\"round\"/>\r\n      </svg>),\r\n        value: \"line\",\r\n        key: [KEYS.P, KEYS.L],\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-pencil\r\n        <svg viewBox=\"0 0 512 512\">\r\n        <path fill=\"currentColor\" d=\"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z\"></path>\r\n      </svg>),\r\n        value: \"freedraw\",\r\n        key: KEYS.X,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-font\r\n        <svg viewBox=\"0 0 448 512\">\r\n        <path d=\"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z\"/>\r\n      </svg>),\r\n        value: \"text\",\r\n        key: KEYS.T,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-image\r\n        <svg viewBox=\"0 0 512 512\">\r\n        <path fill=\"currentColor\" d=\"M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 336H54a6 6 0 0 1-6-6V118a6 6 0 0 1 6-6h404a6 6 0 0 1 6 6v276a6 6 0 0 1-6 6zM128 152c-22.091 0-40 17.909-40 40s17.909 40 40 40 40-17.909 40-40-17.909-40-40-40zM96 352h320v-80l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L192 304l-39.515-39.515c-4.686-4.686-12.284-4.686-16.971 0L96 304v48z\"></path>\r\n      </svg>),\r\n        value: \"image\",\r\n        key: null,\r\n    },\r\n];\r\nexport const findShapeByKey = (key) => {\r\n    const shape = SHAPES.find((shape, index) => {\r\n        return (key === (index + 1).toString() ||\r\n            (shape.key &&\r\n                (typeof shape.key === \"string\"\r\n                    ? shape.key === key\r\n                    : shape.key.includes(key))));\r\n    });\r\n    return shape?.value || null;\r\n};\r\n","import { t } from \"../i18n\";\r\nimport { isDarwin } from \"../keys\";\r\nimport { getShortcutKey } from \"../utils\";\r\nconst shortcutMap = {\r\n    cut: [getShortcutKey(\"CtrlOrCmd+X\")],\r\n    copy: [getShortcutKey(\"CtrlOrCmd+C\")],\r\n    paste: [getShortcutKey(\"CtrlOrCmd+V\")],\r\n    copyStyles: [getShortcutKey(\"CtrlOrCmd+Alt+C\")],\r\n    pasteStyles: [getShortcutKey(\"CtrlOrCmd+Alt+V\")],\r\n    selectAll: [getShortcutKey(\"CtrlOrCmd+A\")],\r\n    deleteSelectedElements: [getShortcutKey(\"Del\")],\r\n    duplicateSelection: [\r\n        getShortcutKey(\"CtrlOrCmd+D\"),\r\n        getShortcutKey(`Alt+${t(\"helpDialog.drag\")}`),\r\n    ],\r\n    sendBackward: [getShortcutKey(\"CtrlOrCmd+[\")],\r\n    bringForward: [getShortcutKey(\"CtrlOrCmd+]\")],\r\n    sendToBack: [\r\n        isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+[\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+[\"),\r\n    ],\r\n    bringToFront: [\r\n        isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+]\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+]\"),\r\n    ],\r\n    copyAsPng: [getShortcutKey(\"Shift+Alt+C\")],\r\n    copyAsSvg: [],\r\n    group: [getShortcutKey(\"CtrlOrCmd+G\")],\r\n    ungroup: [getShortcutKey(\"CtrlOrCmd+Shift+G\")],\r\n    gridMode: [getShortcutKey(\"CtrlOrCmd+'\")],\r\n    zenMode: [getShortcutKey(\"Alt+Z\")],\r\n    stats: [getShortcutKey(\"Alt+/\")],\r\n    addToLibrary: [],\r\n    flipHorizontal: [getShortcutKey(\"Shift+H\")],\r\n    flipVertical: [getShortcutKey(\"Shift+V\")],\r\n    viewMode: [getShortcutKey(\"Alt+R\")],\r\n};\r\nexport const getShortcutFromShortcutName = (name) => {\r\n    const shortcuts = shortcutMap[name];\r\n    // if multiple shortcuts availiable, take the first one\r\n    return shortcuts && shortcuts.length > 0 ? shortcuts[0] : \"\";\r\n};\r\n","import { render, unmountComponentAtNode } from \"react-dom\";\r\nimport clsx from \"clsx\";\r\nimport { Popover } from \"./Popover\";\r\nimport { t } from \"../i18n\";\r\nimport \"./ContextMenu.scss\";\r\nimport { getShortcutFromShortcutName, } from \"../actions/shortcuts\";\r\nconst ContextMenu = ({ options, onCloseRequest, top, left, actionManager, appState, }) => {\r\n    return (<Popover onCloseRequest={onCloseRequest} top={top} left={left} fitInViewport={true}>\r\n      <ul className=\"context-menu\" onContextMenu={(event) => event.preventDefault()}>\r\n        {options.map((option, idx) => {\r\n            if (option === \"separator\") {\r\n                return <hr key={idx} className=\"context-menu-option-separator\"/>;\r\n            }\r\n            const actionName = option.name;\r\n            const label = option.contextItemLabel\r\n                ? t(option.contextItemLabel)\r\n                : \"\";\r\n            return (<li key={idx} data-testid={actionName} onClick={onCloseRequest}>\r\n              <button className={clsx(\"context-menu-option\", {\r\n                    dangerous: actionName === \"deleteSelectedElements\",\r\n                    checkmark: option.checked?.(appState),\r\n                })} onClick={() => actionManager.executeAction(option)}>\r\n                <div className=\"context-menu-option__label\">{label}</div>\r\n                <kbd className=\"context-menu-option__shortcut\">\r\n                  {actionName\r\n                    ? getShortcutFromShortcutName(actionName)\r\n                    : \"\"}\r\n                </kbd>\r\n              </button>\r\n            </li>);\r\n        })}\r\n      </ul>\r\n    </Popover>);\r\n};\r\nconst contextMenuNodeByContainer = new WeakMap();\r\nconst getContextMenuNode = (container) => {\r\n    let contextMenuNode = contextMenuNodeByContainer.get(container);\r\n    if (contextMenuNode) {\r\n        return contextMenuNode;\r\n    }\r\n    contextMenuNode = document.createElement(\"div\");\r\n    container\r\n        .querySelector(\".excalidraw-contextMenuContainer\")\r\n        .appendChild(contextMenuNode);\r\n    contextMenuNodeByContainer.set(container, contextMenuNode);\r\n    return contextMenuNode;\r\n};\r\nconst handleClose = (container) => {\r\n    const contextMenuNode = contextMenuNodeByContainer.get(container);\r\n    if (contextMenuNode) {\r\n        unmountComponentAtNode(contextMenuNode);\r\n        contextMenuNode.remove();\r\n        contextMenuNodeByContainer.delete(container);\r\n    }\r\n};\r\nexport default {\r\n    push(params) {\r\n        const options = Array.of();\r\n        params.options.forEach((option) => {\r\n            if (option) {\r\n                options.push(option);\r\n            }\r\n        });\r\n        if (options.length) {\r\n            render(<ContextMenu top={params.top} left={params.left} options={options} onCloseRequest={() => handleClose(params.container)} actionManager={params.actionManager} appState={params.appState}/>, getContextMenuNode(params.container));\r\n        }\r\n    },\r\n};\r\n","import React from \"react\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { canChangeSharpness, canHaveArrowheads, getTargetElements, hasBackground, hasStrokeStyle, hasStrokeWidth, hasText, } from \"../scene\";\r\nimport { SHAPES } from \"../shapes\";\r\nimport { capitalizeString, isTransparent, setCursorForShape } from \"../utils\";\r\nimport Stack from \"./Stack\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { hasStrokeColor } from \"../scene/comparisons\";\r\nexport const SelectedShapeActions = ({ appState, elements, renderAction, elementType, }) => {\r\n    const targetElements = getTargetElements(getNonDeletedElements(elements), appState);\r\n    const isEditing = Boolean(appState.editingElement);\r\n    const isMobile = useIsMobile();\r\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\";\r\n    const showFillIcons = hasBackground(elementType) ||\r\n        targetElements.some((element) => hasBackground(element.type) && !isTransparent(element.backgroundColor));\r\n    const showChangeBackgroundIcons = hasBackground(elementType) ||\r\n        targetElements.some((element) => hasBackground(element.type));\r\n    let commonSelectedType = targetElements[0]?.type || null;\r\n    for (const element of targetElements) {\r\n        if (element.type !== commonSelectedType) {\r\n            commonSelectedType = null;\r\n            break;\r\n        }\r\n    }\r\n    return (<div className=\"panelColumn\">\r\n      {((hasStrokeColor(elementType) &&\r\n            elementType !== \"image\" &&\r\n            commonSelectedType !== \"image\") ||\r\n            targetElements.some((element) => hasStrokeColor(element.type))) &&\r\n            renderAction(\"changeStrokeColor\")}\r\n      {showChangeBackgroundIcons && renderAction(\"changeBackgroundColor\")}\r\n      {showFillIcons && renderAction(\"changeFillStyle\")}\r\n\r\n      {(hasStrokeWidth(elementType) ||\r\n            targetElements.some((element) => hasStrokeWidth(element.type))) &&\r\n            renderAction(\"changeStrokeWidth\")}\r\n\r\n      {(elementType === \"freedraw\" ||\r\n            targetElements.some((element) => element.type === \"freedraw\")) &&\r\n            renderAction(\"changeStrokeShape\")}\r\n\r\n      {(hasStrokeStyle(elementType) ||\r\n            targetElements.some((element) => hasStrokeStyle(element.type))) && (<>\r\n          {renderAction(\"changeStrokeStyle\")}\r\n          {renderAction(\"changeSloppiness\")}\r\n        </>)}\r\n\r\n      {(canChangeSharpness(elementType) ||\r\n            targetElements.some((element) => canChangeSharpness(element.type))) && (<>{renderAction(\"changeSharpness\")}</>)}\r\n\r\n      {(hasText(elementType) ||\r\n            targetElements.some((element) => hasText(element.type))) && (<>\r\n          {renderAction(\"changeFontSize\")}\r\n\r\n          {renderAction(\"changeFontFamily\")}\r\n\r\n          {renderAction(\"changeTextAlign\")}\r\n        </>)}\r\n\r\n      {(canHaveArrowheads(elementType) ||\r\n            targetElements.some((element) => canHaveArrowheads(element.type))) && (<>{renderAction(\"changeArrowhead\")}</>)}\r\n\r\n      {renderAction(\"changeOpacity\")}\r\n\r\n      <fieldset>\r\n        <legend>{t(\"labels.layers\")}</legend>\r\n        <div className=\"buttonList\">\r\n          {renderAction(\"sendToBack\")}\r\n          {renderAction(\"sendBackward\")}\r\n          {renderAction(\"bringToFront\")}\r\n          {renderAction(\"bringForward\")}\r\n        </div>\r\n      </fieldset>\r\n\r\n      {targetElements.length > 1 && (<fieldset>\r\n          <legend>{t(\"labels.align\")}</legend>\r\n          <div className=\"buttonList\">\r\n            {\r\n            // swap this order for RTL so the button positions always match their action\r\n            // (i.e. the leftmost button aligns left)\r\n            }\r\n            {isRTL ? (<>\r\n                {renderAction(\"alignRight\")}\r\n                {renderAction(\"alignHorizontallyCentered\")}\r\n                {renderAction(\"alignLeft\")}\r\n              </>) : (<>\r\n                {renderAction(\"alignLeft\")}\r\n                {renderAction(\"alignHorizontallyCentered\")}\r\n                {renderAction(\"alignRight\")}\r\n              </>)}\r\n            {targetElements.length > 2 &&\r\n                renderAction(\"distributeHorizontally\")}\r\n            <div className=\"iconRow\">\r\n              {renderAction(\"alignTop\")}\r\n              {renderAction(\"alignVerticallyCentered\")}\r\n              {renderAction(\"alignBottom\")}\r\n              {targetElements.length > 2 &&\r\n                renderAction(\"distributeVertically\")}\r\n            </div>\r\n          </div>\r\n        </fieldset>)}\r\n      {!isMobile && !isEditing && targetElements.length > 0 && (<fieldset>\r\n          <legend>{t(\"labels.actions\")}</legend>\r\n          <div className=\"buttonList\">\r\n            {renderAction(\"duplicateSelection\")}\r\n            {renderAction(\"deleteSelectedElements\")}\r\n            {renderAction(\"group\")}\r\n            {renderAction(\"ungroup\")}\r\n          </div>\r\n        </fieldset>)}\r\n    </div>);\r\n};\r\nexport const ShapesSwitcher = ({ canvas, elementType, setAppState, onImageAction, }) => (<>\r\n    {SHAPES.map(({ value, icon, key }, index) => {\r\n        const label = t(`toolBar.${value}`);\r\n        const letter = key && (typeof key === \"string\" ? key : key[0]);\r\n        const shortcut = letter\r\n            ? `${capitalizeString(letter)} ${t(\"helpDialog.or\")} ${index + 1}`\r\n            : `${index + 1}`;\r\n        return (<ToolButton className=\"Shape\" key={value} type=\"radio\" icon={icon} checked={elementType === value} name=\"editor-current-shape\" title={`${capitalizeString(label)} — ${shortcut}`} keyBindingLabel={`${index + 1}`} aria-label={capitalizeString(label)} aria-keyshortcuts={shortcut} data-testid={value} onChange={({ pointerType }) => {\r\n                setAppState({\r\n                    elementType: value,\r\n                    multiElement: null,\r\n                    selectedElementIds: {},\r\n                });\r\n                setCursorForShape(canvas, value);\r\n                if (value === \"image\") {\r\n                    onImageAction({ pointerType });\r\n                }\r\n            }}/>);\r\n    })}\r\n  </>);\r\nexport const ZoomActions = ({ renderAction, zoom, }) => (<Stack.Col gap={1}>\r\n    <Stack.Row gap={1} align=\"center\">\r\n      {renderAction(\"zoomOut\")}\r\n      {renderAction(\"zoomIn\")}\r\n      {renderAction(\"resetZoom\")}\r\n    </Stack.Row>\r\n  </Stack.Col>);\r\n","import React from \"react\";\r\nexport const BackgroundPickerAndDarkModeToggle = ({ appState, setAppState, actionManager, showThemeBtn, }) => (<div style={{ display: \"flex\" }}>\r\n    {actionManager.renderAction(\"changeViewBackgroundColor\")}\r\n    {showThemeBtn && actionManager.renderAction(\"toggleTheme\")}\r\n  </div>);\r\n","import clsx from \"clsx\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { users } from \"./icons\";\r\nimport \"./CollabButton.scss\";\r\nconst CollabButton = ({ isCollaborating, collaboratorCount, onClick, }) => {\r\n    return (<>\r\n      {/* <ToolButton className={clsx(\"CollabButton\", {\r\n            \"is-collaborating\": isCollaborating,\r\n        })} onClick={onClick} icon={users} type=\"button\" title={t(\"labels.liveCollaboration\")} aria-label={t(\"labels.liveCollaboration\")} showAriaLabel={useIsMobile()}>\r\n        {collaboratorCount > 0 && (<div className=\"CollabButton-collaborators\">{collaboratorCount}</div>)}\r\n      </ToolButton> */}\r\n    </>);\r\n};\r\nexport default CollabButton;\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { render, unmountComponentAtNode } from \"react-dom\";\r\nimport { probablySupportsClipboardBlob } from \"../clipboard\";\r\nimport { canvasToBlob } from \"../data/blob\";\r\nimport { CanvasError } from \"../errors\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"./App\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { exportToCanvas } from \"../scene/export\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { clipboard, exportImage } from \"./icons\";\r\nimport Stack from \"./Stack\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport \"./ExportDialog.scss\";\r\nimport OpenColor from \"open-color\";\r\nimport { CheckboxItem } from \"./CheckboxItem\";\r\nimport { DEFAULT_EXPORT_PADDING } from \"../constants\";\r\nimport { nativeFileSystemSupported } from \"../data/filesystem\";\r\nconst supportsContextFilters = \"filter\" in document.createElement(\"canvas\").getContext(\"2d\");\r\nexport const ErrorCanvasPreview = () => {\r\n    return (<div>\r\n      <h3>{t(\"canvasError.cannotShowPreview\")}</h3>\r\n      <p>\r\n        <span>{t(\"canvasError.canvasTooBig\")}</span>\r\n      </p>\r\n      <em>({t(\"canvasError.canvasTooBigTip\")})</em>\r\n    </div>);\r\n};\r\nconst renderPreview = (content, previewNode) => {\r\n    unmountComponentAtNode(previewNode);\r\n    previewNode.innerHTML = \"\";\r\n    if (content instanceof HTMLCanvasElement) {\r\n        previewNode.appendChild(content);\r\n    }\r\n    else {\r\n        render(<ErrorCanvasPreview />, previewNode);\r\n    }\r\n};\r\nconst ExportButton = ({ children, title, onClick, color, shade = 6 }) => {\r\n    return (<button className=\"ExportDialog-imageExportButton\" style={{\r\n            [\"--button-color\"]: OpenColor[color][shade],\r\n            [\"--button-color-darker\"]: OpenColor[color][shade + 1],\r\n            [\"--button-color-darkest\"]: OpenColor[color][shade + 2],\r\n        }} title={title} aria-label={title} onClick={onClick}>\r\n      {children}\r\n    </button>);\r\n};\r\nconst ImageExportModal = ({ elements, appState, files, exportPadding = DEFAULT_EXPORT_PADDING, actionManager, onExportToPng, onExportToSvg, onExportToClipboard, }) => {\r\n    const someElementIsSelected = isSomeElementSelected(elements, appState);\r\n    const [exportSelected, setExportSelected] = useState(someElementIsSelected);\r\n    const previewRef = useRef(null);\r\n    const { exportBackground, viewBackgroundColor } = appState;\r\n    const exportedElements = exportSelected\r\n        ? getSelectedElements(elements, appState)\r\n        : elements;\r\n    useEffect(() => {\r\n        setExportSelected(someElementIsSelected);\r\n    }, [someElementIsSelected]);\r\n    useEffect(() => {\r\n        const previewNode = previewRef.current;\r\n        if (!previewNode) {\r\n            return;\r\n        }\r\n        exportToCanvas(exportedElements, appState, files, {\r\n            exportBackground,\r\n            viewBackgroundColor,\r\n            exportPadding,\r\n        })\r\n            .then((canvas) => {\r\n            // if converting to blob fails, there's some problem that will\r\n            // likely prevent preview and export (e.g. canvas too big)\r\n            return canvasToBlob(canvas).then(() => {\r\n                renderPreview(canvas, previewNode);\r\n            });\r\n        })\r\n            .catch((error) => {\r\n            console.error(error);\r\n            renderPreview(new CanvasError(), previewNode);\r\n        });\r\n    }, [\r\n        appState,\r\n        files,\r\n        exportedElements,\r\n        exportBackground,\r\n        exportPadding,\r\n        viewBackgroundColor,\r\n    ]);\r\n    return (<div className=\"ExportDialog\">\r\n      <div className=\"ExportDialog__preview\" ref={previewRef}/>\r\n      {supportsContextFilters &&\r\n            actionManager.renderAction(\"exportWithDarkMode\")}\r\n      <div style={{ display: \"grid\", gridTemplateColumns: \"1fr\" }}>\r\n        <div style={{\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"repeat(auto-fit, minmax(190px, 1fr))\",\r\n            // dunno why this is needed, but when the items wrap it creates\r\n            // an overflow\r\n            overflow: \"hidden\",\r\n        }}>\r\n          {actionManager.renderAction(\"changeExportBackground\")}\r\n          {someElementIsSelected && (<CheckboxItem checked={exportSelected} onChange={(checked) => setExportSelected(checked)}>\r\n              {t(\"labels.onlySelected\")}\r\n            </CheckboxItem>)}\r\n          {actionManager.renderAction(\"changeExportEmbedScene\")}\r\n        </div>\r\n      </div>\r\n      <div style={{ display: \"flex\", alignItems: \"center\", marginTop: \".6em\" }}>\r\n        <Stack.Row gap={2}>\r\n          {actionManager.renderAction(\"changeExportScale\")}\r\n        </Stack.Row>\r\n        <p style={{ marginLeft: \"1em\", userSelect: \"none\" }}>Scale</p>\r\n      </div>\r\n      <div style={{\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            justifyContent: \"center\",\r\n            margin: \".6em 0\",\r\n        }}>\r\n        {!nativeFileSystemSupported &&\r\n            actionManager.renderAction(\"changeProjectName\")}\r\n      </div>\r\n      <Stack.Row gap={2} justifyContent=\"center\" style={{ margin: \"2em 0\" }}>\r\n        <ExportButton color=\"indigo\" title={t(\"buttons.exportToPng\")} aria-label={t(\"buttons.exportToPng\")} onClick={() => onExportToPng(exportedElements)}>\r\n          PNG\r\n        </ExportButton>\r\n        <ExportButton color=\"red\" title={t(\"buttons.exportToSvg\")} aria-label={t(\"buttons.exportToSvg\")} onClick={() => onExportToSvg(exportedElements)}>\r\n          SVG\r\n        </ExportButton>\r\n        {probablySupportsClipboardBlob && (<ExportButton title={t(\"buttons.copyPngToClipboard\")} onClick={() => onExportToClipboard(exportedElements)} color=\"gray\" shade={7}>\r\n            {clipboard}\r\n          </ExportButton>)}\r\n      </Stack.Row>\r\n    </div>);\r\n};\r\nexport const ImageExportDialog = ({ elements, appState, files, exportPadding = DEFAULT_EXPORT_PADDING, actionManager, onExportToPng, onExportToSvg, onExportToClipboard, }) => {\r\n    const [modalIsShown, setModalIsShown] = useState(false);\r\n    const handleClose = React.useCallback(() => {\r\n        setModalIsShown(false);\r\n    }, []);\r\n    return (<>\r\n      <ToolButton onClick={() => {\r\n            setModalIsShown(true);\r\n        }} data-testid=\"image-export-button\" icon={exportImage} type=\"button\" aria-label={t(\"buttons.exportImage\")} showAriaLabel={useIsMobile()} title={t(\"buttons.exportImage\")}/>\r\n      {modalIsShown && (<Dialog onCloseRequest={handleClose} title={t(\"buttons.exportImage\")}>\r\n          <ImageExportModal elements={elements} appState={appState} files={files} exportPadding={exportPadding} actionManager={actionManager} onExportToPng={onExportToPng} onExportToSvg={onExportToSvg} onExportToClipboard={onExportToClipboard} onCloseRequest={handleClose}/>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\n","import \"./FixedSideContainer.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nexport const FixedSideContainer = ({ children, side, className, }) => (<div className={clsx(\"FixedSideContainer\", `FixedSideContainer_side_${side}`, className)}>\r\n    {children}\r\n  </div>);\r\n","import { t } from \"../i18n\";\r\nimport { getSelectedElements } from \"../scene\";\r\nimport \"./HintViewer.scss\";\r\nimport {\r\n  isImageElement,\r\n  isLinearElement,\r\n  isTextElement,\r\n} from \"../element/typeChecks\";\r\nimport { getShortcutKey } from \"../utils\";\r\nconst getHints = ({ appState, elements, isMobile }) => {\r\n  const { elementType, isResizing, isRotating, lastPointerDownWith } = appState;\r\n  const multiMode = appState.multiElement !== null;\r\n  if (elementType === \"arrow\" || elementType === \"line\") {\r\n    if (!multiMode) {\r\n      return t(\"hints.linearElement\");\r\n    }\r\n    return t(\"hints.linearElementMulti\");\r\n  }\r\n  if (elementType === \"freedraw\") {\r\n    return t(\"hints.freeDraw\");\r\n  }\r\n  if (elementType === \"text\") {\r\n    return t(\"hints.text\");\r\n  }\r\n  if (appState.elementType === \"image\" && appState.pendingImageElement) {\r\n    return t(\"hints.placeImage\");\r\n  }\r\n  const selectedElements = getSelectedElements(elements, appState);\r\n  if (\r\n    isResizing &&\r\n    lastPointerDownWith === \"mouse\" &&\r\n    selectedElements.length === 1\r\n  ) {\r\n    const targetElement = selectedElements[0];\r\n    if (isLinearElement(targetElement) && targetElement.points.length === 2) {\r\n      return t(\"hints.lockAngle\");\r\n    }\r\n    return isImageElement(targetElement)\r\n      ? t(\"hints.resizeImage\")\r\n      : t(\"hints.resize\");\r\n  }\r\n  if (isRotating && lastPointerDownWith === \"mouse\") {\r\n    return t(\"hints.rotate\");\r\n  }\r\n  if (selectedElements.length === 1 && isLinearElement(selectedElements[0])) {\r\n    if (appState.editingLinearElement) {\r\n      return appState.editingLinearElement.activePointIndex\r\n        ? t(\"hints.lineEditor_pointSelected\")\r\n        : t(\"hints.lineEditor_nothingSelected\");\r\n    }\r\n    return t(\"hints.lineEditor_info\");\r\n  }\r\n  if (selectedElements.length === 1 && isTextElement(selectedElements[0])) {\r\n    return t(\"hints.text_selected\");\r\n  }\r\n  if (appState.editingElement && isTextElement(appState.editingElement)) {\r\n    return t(\"hints.text_editing\");\r\n  }\r\n  if (elementType === \"selection\" && !selectedElements.length && !isMobile) {\r\n    return t(\"hints.canvasPanning\");\r\n  }\r\n  return null;\r\n};\r\nexport const HintViewer = ({ appState, elements, isMobile }) => {\r\n  let hint = getHints({\r\n    appState,\r\n    elements,\r\n    isMobile,\r\n  });\r\n  if (!hint) {\r\n    return null;\r\n  }\r\n  hint = getShortcutKey(hint);\r\n  return (\r\n    <div className=\"HintViewer\">\r\n      <span>{hint}</span>\r\n    </div>\r\n  );\r\n};\r\n","import \"./Island.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nexport const Island = React.forwardRef(({ children, padding, className, style }, ref) => (<div className={clsx(\"Island\", className)} style={{ \"--padding\": padding, ...style }} ref={ref}>\r\n      {children}\r\n    </div>));\r\n","import clsx from \"clsx\";\r\nimport oc from \"open-color\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { close } from \"../components/icons\";\r\nimport { MIME_TYPES } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { exportToSvg } from \"../scene/export\";\r\nimport \"./LibraryUnit.scss\";\r\n// fa-plus\r\nconst PLUS_ICON = (<svg viewBox=\"0 0 1792 1792\">\r\n    <path fill=\"currentColor\" d=\"M1600 736v192q0 40-28 68t-68 28h-416v416q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-416h-416q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h416v-416q0-40 28-68t68-28h192q40 0 68 28t28 68v416h416q40 0 68 28t28 68z\"/>\r\n  </svg>);\r\nexport const LibraryUnit = ({ elements, files, pendingElements, onRemoveFromLibrary, onClick, }) => {\r\n    const ref = useRef(null);\r\n    useEffect(() => {\r\n        const node = ref.current;\r\n        if (!node) {\r\n            return;\r\n        }\r\n        (async () => {\r\n            const elementsToRender = elements || pendingElements;\r\n            if (!elementsToRender) {\r\n                return;\r\n            }\r\n            const svg = await exportToSvg(elementsToRender, {\r\n                exportBackground: false,\r\n                viewBackgroundColor: oc.white,\r\n            }, files);\r\n            node.innerHTML = svg.outerHTML;\r\n        })();\r\n        return () => {\r\n            node.innerHTML = \"\";\r\n        };\r\n    }, [elements, pendingElements, files]);\r\n    const [isHovered, setIsHovered] = useState(false);\r\n    const isMobile = useIsMobile();\r\n    const adder = (isHovered || isMobile) && pendingElements && (<div className=\"library-unit__adder\">{PLUS_ICON}</div>);\r\n    return (<>\r\n        <div className={clsx(\"library-unit\", {\r\n            \"library-unit__active\": elements || pendingElements,\r\n        })} onMouseEnter={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}>\r\n      <div className={clsx(\"library-unit__dragger\", {\r\n            \"library-unit__pulse\": !!pendingElements,\r\n        })} ref={ref} draggable={!!elements} onClick={!!elements || !!pendingElements ? onClick : undefined} onDragStart={(event) => {\r\n            setIsHovered(false);\r\n            event.dataTransfer.setData(MIME_TYPES.excalidrawlib, JSON.stringify(elements));\r\n        }}/>\r\n      {adder}\r\n      {elements && (isHovered || isMobile) && (<button className=\"library-unit__removeFromLibrary\" aria-label={t(\"labels.removeFromLibrary\")} onClick={onRemoveFromLibrary}>\r\n          {close}\r\n        </button>)}\r\n    </div>\r\n    </>);\r\n};\r\n","import { t } from \"../i18n\";\r\nexport const LoadingMessage = () => {\r\n    // !! KEEP THIS IN SYNC WITH index.html !!\r\n    return (<div className=\"LoadingMessage\">\r\n      <span>{t(\"labels.loadingScene\")}</span>\r\n    </div>);\r\n};\r\n","import \"./ToolIcon.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nconst DEFAULT_SIZE = \"medium\";\r\nconst ICONS = {\r\n    CHECKED: (<svg width=\"1792\" height=\"1792\" viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <path d=\"M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z\"/>\r\n    </svg>),\r\n    UNCHECKED: (<svg width=\"1792\" height=\"1792\" viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\" className=\"unlocked-icon rtl-mirror\">\r\n      <path d=\"M1728 576v256q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45v-256q0-106-75-181t-181-75-181 75-75 181v192h96q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h672v-192q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5z\"/>\r\n    </svg>),\r\n};\r\nexport const LockButton = (props) => {\r\n    return (<label className={clsx(\"ToolIcon ToolIcon__lock ToolIcon_type_floating zen-mode-visibility\", `ToolIcon_size_${DEFAULT_SIZE}`, {\r\n            \"zen-mode-visibility--hidden\": props.zenModeEnabled,\r\n        })} title={`${props.title} — Q`}>\r\n      <input className=\"ToolIcon_type_checkbox\" type=\"checkbox\" name={props.name} onChange={props.onChange} checked={props.checked} aria-label={props.title}/>\r\n      <div className=\"ToolIcon__icon\">\r\n        {props.checked ? ICONS.CHECKED : ICONS.UNCHECKED}\r\n      </div>\r\n    </label>);\r\n};\r\n","import React from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nexport const Section = ({ heading, children, ...props }) => {\r\n    const { id } = useExcalidrawContainer();\r\n    const header = (<h2 className=\"visually-hidden\" id={`${id}-${heading}-title`}>\r\n      {t(`headings.${heading}`)}\r\n    </h2>);\r\n    return (<section {...props} aria-labelledby={`${id}-${heading}-title`}>\r\n      {typeof children === \"function\" ? (children(header)) : (<>\r\n          {header}\r\n          {children}\r\n        </>)}\r\n    </section>);\r\n};\r\n","import \"./UserList.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nexport const UserList = ({ children, className, mobile }) => {\r\n    return (<div className={clsx(\"UserList\", className, { UserList_mobile: mobile })}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import React from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { t } from \"../i18n\";\r\nimport { capitalizeString } from \"../utils\";\r\nconst LIBRARY_ICON = (<svg viewBox=\"0 0 576 512\">\r\n    <path fill=\"currentColor\" d=\"M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z\"></path>\r\n  </svg>);\r\nexport const LibraryButton = ({ appState, setAppState }) => {\r\n    return (<label className={clsx(\"ToolIcon ToolIcon_type_floating ToolIcon__library zen-mode-visibility\", `ToolIcon_size_medium`, {\r\n            \"zen-mode-visibility--hidden\": appState.zenModeEnabled,\r\n        })} title={`${capitalizeString(t(\"toolBar.library\"))} — 0`} style={{ marginInlineStart: \"var(--space-factor)\" }}>\r\n      <input className=\"ToolIcon_type_checkbox\" type=\"checkbox\" name=\"editor-library\" onChange={(event) => {\r\n            setAppState({ isLibraryOpen: event.target.checked });\r\n        }} checked={appState.isLibraryOpen} aria-label={capitalizeString(t(\"toolBar.library\"))} aria-keyshortcuts=\"0\"/>\r\n      <div className=\"ToolIcon__icon\">{LIBRARY_ICON}</div>\r\n    </label>);\r\n};\r\n","import React from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport Stack from \"./Stack\";\r\nimport { showSelectedShapeActions } from \"../element\";\r\nimport { FixedSideContainer } from \"./FixedSideContainer\";\r\nimport { Island } from \"./Island\";\r\nimport { HintViewer } from \"./HintViewer\";\r\nimport { calculateScrollCenter } from \"../scene\";\r\nimport { SelectedShapeActions, ShapesSwitcher } from \"./Actions\";\r\nimport { Section } from \"./Section\";\r\nimport CollabButton from \"./CollabButton\";\r\nimport { SCROLLBAR_WIDTH, SCROLLBAR_MARGIN } from \"../scene/scrollbars\";\r\nimport { LockButton } from \"./LockButton\";\r\nimport { UserList } from \"./UserList\";\r\nimport { BackgroundPickerAndDarkModeToggle } from \"./BackgroundPickerAndDarkModeToggle\";\r\nimport { LibraryButton } from \"./LibraryButton\";\r\nexport const MobileMenu = ({\r\n  appState,\r\n  elements,\r\n  libraryMenu,\r\n  actionManager,\r\n  renderJSONExportDialog,\r\n  renderImageExportDialog,\r\n  setAppState,\r\n  onCollabButtonClick,\r\n  onLockToggle,\r\n  canvas,\r\n  isCollaborating,\r\n  renderCustomFooter,\r\n  viewModeEnabled,\r\n  showThemeBtn,\r\n  onImageAction,\r\n  renderTopRightUI,\r\n}) => {\r\n  const renderToolbar = () => {\r\n    return (\r\n      <FixedSideContainer side=\"top\" className=\"App-top-bar\">\r\n        <Section heading=\"shapes\">\r\n          {(heading) => (\r\n            <Stack.Col gap={4} align=\"center\">\r\n              <Stack.Row gap={1}>\r\n                <Island padding={1}>\r\n                  {heading}\r\n                  <Stack.Row gap={1}>\r\n                    <ShapesSwitcher\r\n                      canvas={canvas}\r\n                      elementType={appState.elementType}\r\n                      setAppState={setAppState}\r\n                      onImageAction={({ pointerType }) => {\r\n                        onImageAction({\r\n                          insertOnCanvasDirectly: pointerType !== \"mouse\",\r\n                        });\r\n                      }}\r\n                    />\r\n                  </Stack.Row>\r\n                </Island>\r\n                {renderTopRightUI && renderTopRightUI(true, appState)}\r\n                <LockButton\r\n                  checked={appState.elementLocked}\r\n                  onChange={onLockToggle}\r\n                  title={t(\"toolBar.lock\")}\r\n                />\r\n                <LibraryButton appState={appState} setAppState={setAppState} />\r\n              </Stack.Row>\r\n              {libraryMenu}\r\n            </Stack.Col>\r\n          )}\r\n        </Section>\r\n        <HintViewer appState={appState} elements={elements} isMobile={true} />\r\n      </FixedSideContainer>\r\n    );\r\n  };\r\n  const renderAppToolbar = () => {\r\n    if (viewModeEnabled) {\r\n      return (\r\n        <div className=\"App-toolbar-content\">\r\n          {actionManager.renderAction(\"toggleCanvasMenu\")}\r\n        </div>\r\n      );\r\n    }\r\n    return (\r\n      <div className=\"App-toolbar-content\">\r\n        {actionManager.renderAction(\"toggleCanvasMenu\")}\r\n        {actionManager.renderAction(\"toggleEditMenu\")}\r\n        {actionManager.renderAction(\"undo\")}\r\n        {actionManager.renderAction(\"redo\")}\r\n        {actionManager.renderAction(\r\n          appState.multiElement ? \"finalize\" : \"duplicateSelection\"\r\n        )}\r\n        {actionManager.renderAction(\"deleteSelectedElements\")}\r\n      </div>\r\n    );\r\n  };\r\n  const renderCanvasActions = () => {\r\n    if (viewModeEnabled) {\r\n      return (\r\n        <>\r\n          {renderJSONExportDialog()}\r\n          {renderImageExportDialog()}\r\n        </>\r\n      );\r\n    }\r\n    return (\r\n      <>\r\n        {actionManager.renderAction(\"clearCanvas\")}\r\n        {actionManager.renderAction(\"loadScene\")}\r\n        {renderJSONExportDialog()}\r\n        {renderImageExportDialog()}\r\n        {onCollabButtonClick && (\r\n          <CollabButton\r\n            isCollaborating={isCollaborating}\r\n            collaboratorCount={appState.collaborators.size}\r\n            onClick={onCollabButtonClick}\r\n          />\r\n        )}\r\n        {\r\n          <BackgroundPickerAndDarkModeToggle\r\n            actionManager={actionManager}\r\n            appState={appState}\r\n            setAppState={setAppState}\r\n            showThemeBtn={showThemeBtn}\r\n          />\r\n        }\r\n      </>\r\n    );\r\n  };\r\n  return (\r\n    <>\r\n      {!viewModeEnabled && renderToolbar()}\r\n      <div\r\n        className=\"App-bottom-bar\"\r\n        style={{\r\n          marginBottom: SCROLLBAR_WIDTH + SCROLLBAR_MARGIN * 2,\r\n          marginLeft: SCROLLBAR_WIDTH + SCROLLBAR_MARGIN * 2,\r\n          marginRight: SCROLLBAR_WIDTH + SCROLLBAR_MARGIN * 2,\r\n        }}\r\n      >\r\n        <Island padding={0}>\r\n          {appState.openMenu === \"canvas\" ? (\r\n            <Section className=\"App-mobile-menu\" heading=\"canvasActions\">\r\n              <div className=\"panelColumn\">\r\n                <Stack.Col gap={4}>\r\n                  {renderCanvasActions()}\r\n                  {renderCustomFooter?.(true, appState)}\r\n                  {appState.collaborators.size > 0 && (\r\n                    <fieldset>\r\n                      <legend>{t(\"labels.collaborators\")}</legend>\r\n                      <UserList mobile>\r\n                        {Array.from(appState.collaborators)\r\n                          // Collaborator is either not initialized or is actually the current user.\r\n                          .filter(\r\n                            ([_, client]) => Object.keys(client).length !== 0\r\n                          )\r\n                          .map(([clientId, client]) => (\r\n                            <React.Fragment key={clientId}>\r\n                              {actionManager.renderAction(\"goToCollaborator\", {\r\n                                id: clientId,\r\n                              })}\r\n                            </React.Fragment>\r\n                          ))}\r\n                      </UserList>\r\n                    </fieldset>\r\n                  )}\r\n                </Stack.Col>\r\n              </div>\r\n            </Section>\r\n          ) : appState.openMenu === \"shape\" &&\r\n            !viewModeEnabled &&\r\n            showSelectedShapeActions(appState, elements) ? (\r\n            <Section className=\"App-mobile-menu\" heading=\"selectedShapeActions\">\r\n              <SelectedShapeActions\r\n                appState={appState}\r\n                elements={elements}\r\n                renderAction={actionManager.renderAction}\r\n                elementType={appState.elementType}\r\n              />\r\n            </Section>\r\n          ) : null}\r\n          <footer className=\"App-toolbar\">\r\n            {renderAppToolbar()}\r\n            {appState.scrolledOutside && !appState.openMenu && (\r\n              <button\r\n                className=\"scroll-back-to-content\"\r\n                onClick={() => {\r\n                  setAppState({\r\n                    ...calculateScrollCenter(elements, appState, canvas),\r\n                  });\r\n                }}\r\n              >\r\n                {t(\"buttons.scrollBackToContent\")}\r\n              </button>\r\n            )}\r\n          </footer>\r\n        </Island>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n","import oc from \"open-color\";\r\nimport React, { useLayoutEffect, useRef, useState } from \"react\";\r\nimport { trackEvent } from \"../analytics\";\r\nimport { renderSpreadsheet } from \"../charts\";\r\nimport { t } from \"../i18n\";\r\nimport { exportToSvg } from \"../scene/export\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport \"./PasteChartDialog.scss\";\r\nconst ChartPreviewBtn = (props) => {\r\n    const previewRef = useRef(null);\r\n    const [chartElements, setChartElements] = useState(null);\r\n    useLayoutEffect(() => {\r\n        if (!props.spreadsheet) {\r\n            return;\r\n        }\r\n        const elements = renderSpreadsheet(props.chartType, props.spreadsheet, 0, 0);\r\n        setChartElements(elements);\r\n        let svg;\r\n        const previewNode = previewRef.current;\r\n        (async () => {\r\n            svg = await exportToSvg(elements, {\r\n                exportBackground: false,\r\n                viewBackgroundColor: oc.white,\r\n            }, null);\r\n            previewNode.appendChild(svg);\r\n            if (props.selected) {\r\n                previewNode.parentNode.focus();\r\n            }\r\n        })();\r\n        return () => {\r\n            previewNode.removeChild(svg);\r\n        };\r\n    }, [props.spreadsheet, props.chartType, props.selected]);\r\n    return (<button className=\"ChartPreview\" onClick={() => {\r\n            if (chartElements) {\r\n                props.onClick(props.chartType, chartElements);\r\n            }\r\n        }}>\r\n      <div ref={previewRef}/>\r\n    </button>);\r\n};\r\nexport const PasteChartDialog = ({ setAppState, appState, onClose, onInsertChart, }) => {\r\n    const handleClose = React.useCallback(() => {\r\n        if (onClose) {\r\n            onClose();\r\n        }\r\n    }, [onClose]);\r\n    const handleChartClick = (chartType, elements) => {\r\n        onInsertChart(elements);\r\n        trackEvent(\"magic\", \"chart\", chartType);\r\n        setAppState({\r\n            currentChartType: chartType,\r\n            pasteDialog: {\r\n                shown: false,\r\n                data: null,\r\n            },\r\n        });\r\n    };\r\n    return (<Dialog small onCloseRequest={handleClose} title={t(\"labels.pasteCharts\")} className={\"PasteChartDialog\"} autofocus={false}>\r\n      <div className={\"container\"}>\r\n        <ChartPreviewBtn chartType=\"bar\" spreadsheet={appState.pasteDialog.data} selected={appState.currentChartType === \"bar\"} onClick={handleChartClick}/>\r\n        <ChartPreviewBtn chartType=\"line\" spreadsheet={appState.pasteDialog.data} selected={appState.currentChartType === \"line\"} onClick={handleChartClick}/>\r\n      </div>\r\n    </Dialog>);\r\n};\r\n","import React from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { isDarwin, isWindows } from \"../keys\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport \"./HelpDialog.scss\";\r\n\r\nconst Section = (props) => (<>\r\n    <h3>{props.title}</h3>\r\n    {props.children}\r\n  </>);\r\nconst Columns = (props) => (<div style={{\r\n        display: \"flex\",\r\n        flexDirection: \"row\",\r\n        flexWrap: \"wrap\",\r\n        justifyContent: \"space-between\",\r\n    }}>\r\n    {props.children}\r\n  </div>);\r\nconst Column = (props) => (<div style={{ width: \"49%\" }}>{props.children}</div>);\r\nconst ShortcutIsland = (props) => (<div className=\"HelpDialog--island\">\r\n    <h3 className=\"HelpDialog--island-title\">{props.caption}</h3>\r\n    {props.children}\r\n  </div>);\r\nconst Shortcut = (props) => {\r\n    return (<div className=\"HelpDialog--shortcut\">\r\n      <div style={{\r\n            display: \"flex\",\r\n            margin: \"0\",\r\n            padding: \"4px 8px\",\r\n            alignItems: \"center\",\r\n        }}>\r\n        <div style={{\r\n            lineHeight: 1.4,\r\n        }}>\r\n          {props.label}\r\n        </div>\r\n        <div style={{\r\n            display: \"flex\",\r\n            flex: \"0 0 auto\",\r\n            justifyContent: \"flex-end\",\r\n            marginInlineStart: \"auto\",\r\n            minWidth: \"30%\",\r\n        }}>\r\n          {props.shortcuts.map((shortcut, index) => (<React.Fragment key={index}>\r\n              <ShortcutKey>{shortcut}</ShortcutKey>\r\n              {props.isOr &&\r\n                index !== props.shortcuts.length - 1 &&\r\n                t(\"helpDialog.or\")}\r\n            </React.Fragment>))}\r\n        </div>\r\n      </div>\r\n    </div>);\r\n};\r\nShortcut.defaultProps = {\r\n    isOr: true,\r\n};\r\nconst ShortcutKey = (props) => (<kbd className=\"HelpDialog--key\" {...props}/>);\r\nexport const HelpDialog = ({ onClose }) => {\r\n    const handleClose = React.useCallback(() => {\r\n        if (onClose) {\r\n            onClose();\r\n        }\r\n    }, [onClose]);\r\n    return (<>\r\n      <Dialog onCloseRequest={handleClose} title={t(\"helpDialog.title\")} className={\"HelpDialog\"}>\r\n        <Section title={t(\"helpDialog.shortcuts\")}>\r\n          <Columns>\r\n            <Column>\r\n              <ShortcutIsland caption={t(\"helpDialog.shapes\")}>\r\n                <Shortcut label={t(\"toolBar.selection\")} shortcuts={[\"V\", \"1\"]}/>\r\n                <Shortcut label={t(\"toolBar.rectangle\")} shortcuts={[\"R\", \"2\"]}/>\r\n                <Shortcut label={t(\"toolBar.diamond\")} shortcuts={[\"D\", \"3\"]}/>\r\n                <Shortcut label={t(\"toolBar.ellipse\")} shortcuts={[\"E\", \"4\"]}/>\r\n                <Shortcut label={t(\"toolBar.arrow\")} shortcuts={[\"A\", \"5\"]}/>\r\n                <Shortcut label={t(\"toolBar.line\")} shortcuts={[\"P\", \"6\"]}/>\r\n                <Shortcut label={t(\"toolBar.freedraw\")} shortcuts={[\"Shift+P\", \"7\"]}/>\r\n                <Shortcut label={t(\"toolBar.text\")} shortcuts={[\"T\", \"8\"]}/>\r\n                <Shortcut label={t(\"toolBar.image\")} shortcuts={[\"9\"]}/>\r\n                <Shortcut label={t(\"toolBar.library\")} shortcuts={[\"0\"]}/>\r\n                <Shortcut label={t(\"helpDialog.editSelectedShape\")} shortcuts={[\r\n            getShortcutKey(\"Enter\"),\r\n            t(\"helpDialog.doubleClick\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"helpDialog.textNewLine\")} shortcuts={[\r\n            getShortcutKey(\"Enter\"),\r\n            getShortcutKey(\"Shift+Enter\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"helpDialog.textFinish\")} shortcuts={[\r\n            getShortcutKey(\"Esc\"),\r\n            getShortcutKey(\"CtrlOrCmd+Enter\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"helpDialog.curvedArrow\")} shortcuts={[\r\n            \"A\",\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n        ]} isOr={false}/>\r\n                <Shortcut label={t(\"helpDialog.curvedLine\")} shortcuts={[\r\n            \"L\",\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n        ]} isOr={false}/>\r\n                <Shortcut label={t(\"toolBar.lock\")} shortcuts={[\"Q\"]}/>\r\n                <Shortcut label={t(\"helpDialog.preventBinding\")} shortcuts={[getShortcutKey(\"CtrlOrCmd\")]}/>\r\n              </ShortcutIsland>\r\n              <ShortcutIsland caption={t(\"helpDialog.view\")}>\r\n                <Shortcut label={t(\"buttons.zoomIn\")} shortcuts={[getShortcutKey(\"CtrlOrCmd++\")]}/>\r\n                <Shortcut label={t(\"buttons.zoomOut\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+-\")]}/>\r\n                <Shortcut label={t(\"buttons.resetZoom\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+0\")]}/>\r\n                <Shortcut label={t(\"helpDialog.zoomToFit\")} shortcuts={[\"Shift+1\"]}/>\r\n                <Shortcut label={t(\"helpDialog.zoomToSelection\")} shortcuts={[\"Shift+2\"]}/>\r\n                <Shortcut label={t(\"buttons.fullScreen\")} shortcuts={[\"F\"]}/>\r\n                <Shortcut label={t(\"buttons.zenMode\")} shortcuts={[getShortcutKey(\"Alt+Z\")]}/>\r\n                <Shortcut label={t(\"labels.showGrid\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+'\")]}/>\r\n                <Shortcut label={t(\"labels.viewMode\")} shortcuts={[getShortcutKey(\"Alt+R\")]}/>\r\n                <Shortcut label={t(\"labels.toggleTheme\")} shortcuts={[getShortcutKey(\"Alt+Shift+D\")]}/>\r\n                <Shortcut label={t(\"stats.title\")} shortcuts={[getShortcutKey(\"Alt+/\")]}/>\r\n              </ShortcutIsland>\r\n            </Column>\r\n            <Column>\r\n              <ShortcutIsland caption={t(\"helpDialog.editor\")}>\r\n                <Shortcut label={t(\"labels.selectAll\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+A\")]}/>\r\n                <Shortcut label={t(\"labels.multiSelect\")} shortcuts={[getShortcutKey(`Shift+${t(\"helpDialog.click\")}`)]}/>\r\n                <Shortcut label={t(\"labels.moveCanvas\")} shortcuts={[\r\n            getShortcutKey(`Space+${t(\"helpDialog.drag\")}`),\r\n            getShortcutKey(`Wheel+${t(\"helpDialog.drag\")}`),\r\n        ]} isOr={true}/>\r\n                <Shortcut label={t(\"labels.cut\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+X\")]}/>\r\n                <Shortcut label={t(\"labels.copy\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+C\")]}/>\r\n                <Shortcut label={t(\"labels.paste\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+V\")]}/>\r\n                <Shortcut label={t(\"labels.copyAsPng\")} shortcuts={[getShortcutKey(\"Shift+Alt+C\")]}/>\r\n                <Shortcut label={t(\"labels.copyStyles\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Alt+C\")]}/>\r\n                <Shortcut label={t(\"labels.pasteStyles\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Alt+V\")]}/>\r\n                <Shortcut label={t(\"labels.delete\")} shortcuts={[getShortcutKey(\"Del\")]}/>\r\n                <Shortcut label={t(\"labels.sendToBack\")} shortcuts={[\r\n            isDarwin\r\n                ? getShortcutKey(\"CtrlOrCmd+Alt+[\")\r\n                : getShortcutKey(\"CtrlOrCmd+Shift+[\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"labels.bringToFront\")} shortcuts={[\r\n            isDarwin\r\n                ? getShortcutKey(\"CtrlOrCmd+Alt+]\")\r\n                : getShortcutKey(\"CtrlOrCmd+Shift+]\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"labels.sendBackward\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+[\")]}/>\r\n                <Shortcut label={t(\"labels.bringForward\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+]\")]}/>\r\n                <Shortcut label={t(\"labels.alignTop\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Up\")]}/>\r\n                <Shortcut label={t(\"labels.alignBottom\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Down\")]}/>\r\n                <Shortcut label={t(\"labels.alignLeft\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Left\")]}/>\r\n                <Shortcut label={t(\"labels.alignRight\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Right\")]}/>\r\n                <Shortcut label={t(\"labels.duplicateSelection\")} shortcuts={[\r\n            getShortcutKey(\"CtrlOrCmd+D\"),\r\n            getShortcutKey(`Alt+${t(\"helpDialog.drag\")}`),\r\n        ]}/>\r\n                <Shortcut label={t(\"buttons.undo\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Z\")]}/>\r\n                <Shortcut label={t(\"buttons.redo\")} shortcuts={isWindows\r\n            ? [\r\n                getShortcutKey(\"CtrlOrCmd+Y\"),\r\n                getShortcutKey(\"CtrlOrCmd+Shift+Z\"),\r\n            ]\r\n            : [getShortcutKey(\"CtrlOrCmd+Shift+Z\")]}/>\r\n                <Shortcut label={t(\"labels.group\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+G\")]}/>\r\n                <Shortcut label={t(\"labels.ungroup\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+G\")]}/>\r\n                <Shortcut label={t(\"labels.flipHorizontal\")} shortcuts={[getShortcutKey(\"Shift+H\")]}/>\r\n                <Shortcut label={t(\"labels.flipVertical\")} shortcuts={[getShortcutKey(\"Shift+V\")]}/>\r\n                <Shortcut label={t(\"labels.showStroke\")} shortcuts={[getShortcutKey(\"S\")]}/>\r\n                <Shortcut label={t(\"labels.showBackground\")} shortcuts={[getShortcutKey(\"G\")]}/>\r\n              </ShortcutIsland>\r\n            </Column>\r\n          </Columns>\r\n        </Section>\r\n      </Dialog>\r\n    </>);\r\n};\r\n","import OpenColor from \"open-color\";\r\nimport \"./Card.scss\";\r\nexport const Card = ({ children, color }) => {\r\n    return (<div className=\"Card\" style={{\r\n            [\"--card-color\"]: OpenColor[color][7],\r\n            [\"--card-color-darker\"]: OpenColor[color][8],\r\n            [\"--card-color-darkest\"]: OpenColor[color][9],\r\n        }}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"./App\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { exportFile, exportToFileIcon, link } from \"./icons\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { actionSaveFileToDisk } from \"../actions/actionExport\";\r\nimport { Card } from \"./Card\";\r\nimport \"./ExportDialog.scss\";\r\nimport { nativeFileSystemSupported } from \"../data/filesystem\";\r\nconst JSONExportModal = ({ elements, appState, files, actionManager, exportOpts, canvas, }) => {\r\n    const { onExportToBackend } = exportOpts;\r\n    return (<div className=\"ExportDialog ExportDialog--json\">\r\n      <div className=\"ExportDialog-cards\">\r\n        {exportOpts.saveFileToDisk && (<Card color=\"lime\">\r\n            <div className=\"Card-icon\">{exportToFileIcon}</div>\r\n            <h2>{t(\"exportDialog.disk_title\")}</h2>\r\n            <div className=\"Card-details\">\r\n              {t(\"exportDialog.disk_details\")}\r\n              {!nativeFileSystemSupported &&\r\n                actionManager.renderAction(\"changeProjectName\")}\r\n            </div>\r\n            <ToolButton className=\"Card-button\" type=\"button\" title={t(\"exportDialog.disk_button\")} aria-label={t(\"exportDialog.disk_button\")} showAriaLabel={true} onClick={() => {\r\n                actionManager.executeAction(actionSaveFileToDisk);\r\n            }}/>\r\n          </Card>)}\r\n        {onExportToBackend && (<Card color=\"pink\">\r\n            <div className=\"Card-icon\">{link}</div>\r\n            <h2>{t(\"exportDialog.link_title\")}</h2>\r\n            <div className=\"Card-details\">{t(\"exportDialog.link_details\")}</div>\r\n            <ToolButton className=\"Card-button\" type=\"button\" title={t(\"exportDialog.link_button\")} aria-label={t(\"exportDialog.link_button\")} showAriaLabel={true} onClick={() => onExportToBackend(elements, appState, files, canvas)}/>\r\n          </Card>)}\r\n        {exportOpts.renderCustomUI &&\r\n            exportOpts.renderCustomUI(elements, appState, files, canvas)}\r\n      </div>\r\n    </div>);\r\n};\r\nexport const JSONExportDialog = ({ elements, appState, files, actionManager, exportOpts, canvas, }) => {\r\n    const [modalIsShown, setModalIsShown] = useState(false);\r\n    const handleClose = React.useCallback(() => {\r\n        setModalIsShown(false);\r\n    }, []);\r\n    return (<>\r\n      <ToolButton onClick={() => {\r\n            setModalIsShown(true);\r\n        }} data-testid=\"json-export-button\" icon={exportFile} type=\"button\" aria-label={t(\"buttons.export\")} showAriaLabel={useIsMobile()} title={t(\"buttons.export\")}/>\r\n      {modalIsShown && (<Dialog onCloseRequest={handleClose} title={t(\"buttons.export\")}>\r\n          <JSONExportModal elements={elements} appState={appState} files={files} actionManager={actionManager} onCloseRequest={handleClose} exportOpts={exportOpts} canvas={canvas}/>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\n","import clsx from \"clsx\";\r\nimport React, { useCallback, useEffect, useRef, useState } from \"react\";\r\nimport { CLASSES } from \"../constants\";\r\nimport { exportCanvas } from \"../data\";\r\nimport Libraries from '../../savedLib/savedLib.json'\r\nimport { importLibraryFromJSON, saveLibraryAsJSON } from \"../data/json\";\r\nimport { isTextElement, showSelectedShapeActions } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { calculateScrollCenter, getSelectedElements } from \"../scene\";\r\nimport { muteFSAbortError } from \"../utils\";\r\nimport { SelectedShapeActions, ShapesSwitcher, ZoomActions } from \"./Actions\";\r\nimport { BackgroundPickerAndDarkModeToggle } from \"./BackgroundPickerAndDarkModeToggle\";\r\nimport CollabButton from \"./CollabButton\";\r\nimport { ErrorDialog } from \"./ErrorDialog\";\r\nimport { ImageExportDialog } from \"./ImageExportDialog\";\r\nimport { FixedSideContainer } from \"./FixedSideContainer\";\r\nimport { HintViewer } from \"./HintViewer\";\r\nimport { exportFile, load, trash } from \"./icons\";\r\nimport { Island } from \"./Island\";\r\nimport \"./LayerUI.scss\";\r\nimport { LibraryUnit } from \"./LibraryUnit\";\r\nimport { LoadingMessage } from \"./LoadingMessage\";\r\nimport { LockButton } from \"./LockButton\";\r\nimport { MobileMenu } from \"./MobileMenu\";\r\nimport { PasteChartDialog } from \"./PasteChartDialog\";\r\nimport { Section } from \"./Section\";\r\nimport { HelpDialog } from \"./HelpDialog\";\r\nimport Stack from \"./Stack\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { Tooltip } from \"./Tooltip\";\r\nimport { UserList } from \"./UserList\";\r\nimport { JSONExportDialog } from \"./JSONExportDialog\";\r\nimport { LibraryButton } from \"./LibraryButton\";\r\nimport { isImageFileHandle } from \"../data/blob\";\r\nconst useOnClickOutside = (ref, cb) => {\r\n  useEffect(() => {\r\n    const listener = (event) => {\r\n      if (!ref.current) {\r\n        return;\r\n      }\r\n      if (\r\n        event.target instanceof Element &&\r\n        (ref.current.contains(event.target) ||\r\n          !document.body.contains(event.target))\r\n      ) {\r\n        return;\r\n      }\r\n      cb(event);\r\n    };\r\n    document.addEventListener(\"pointerdown\", listener, false);\r\n    return () => {\r\n      document.removeEventListener(\"pointerdown\", listener);\r\n    };\r\n  }, [ref, cb]);\r\n};\r\nconst LibraryMenuItems = ({\r\n  libraryItems,\r\n  onRemoveFromLibrary,\r\n  onAddToLibrary,\r\n  onInsertShape,\r\n  pendingElements,\r\n  theme,\r\n  setAppState,\r\n  setLibraryItems,\r\n  libraryReturnUrl,\r\n  focusContainer,\r\n  library,\r\n  files,\r\n  id,\r\n}) => {\r\n  const isMobile = useIsMobile();\r\n  const numCells = libraryItems.length + (pendingElements.length > 0 ? 1 : 0);\r\n  const CELLS_PER_ROW = isMobile ? 4 : 6;\r\n  const numRows = Math.max(1, Math.ceil(numCells / CELLS_PER_ROW));\r\n  const rows = [];\r\n  let addedPendingElements = false;\r\n  const referrer =\r\n    libraryReturnUrl || window.location.origin + window.location.pathname;\r\n  rows.push(\r\n    <div className=\"layer-ui__library-header\" key=\"library-header\">\r\n      <ToolButton\r\n        key=\"import\"\r\n        type=\"button\"\r\n        title={t(\"buttons.load\")}\r\n        aria-label={t(\"buttons.load\")}\r\n        icon={load}\r\n        onClick={() => {\r\n          importLibraryFromJSON(library)\r\n            .then(() => {\r\n              // Close and then open to get the libraries updated\r\n              setAppState({ isLibraryOpen: false });\r\n              setAppState({ isLibraryOpen: true });\r\n            })\r\n            .catch(muteFSAbortError)\r\n            .catch((error) => {\r\n              setAppState({ errorMessage: error.message });\r\n            });\r\n        }}\r\n      />\r\n      {!!libraryItems.length && (\r\n        <>\r\n          <ToolButton\r\n            key=\"export\"\r\n            type=\"button\"\r\n            title={t(\"buttons.export\")}\r\n            aria-label={t(\"buttons.export\")}\r\n            icon={exportFile}\r\n            onClick={() => {\r\n              saveLibraryAsJSON(library)\r\n                .catch(muteFSAbortError)\r\n                .catch((error) => {\r\n                  setAppState({ errorMessage: error.message });\r\n                });\r\n            }}\r\n          />\r\n          <ToolButton\r\n            key=\"reset\"\r\n            type=\"button\"\r\n            title={t(\"buttons.resetLibrary\")}\r\n            aria-label={t(\"buttons.resetLibrary\")}\r\n            icon={trash}\r\n            onClick={() => {\r\n              if (window.confirm(t(\"alerts.resetLibrary\"))) {\r\n                library.resetLibrary();\r\n                setLibraryItems([]);\r\n                focusContainer();\r\n              }\r\n            }}\r\n          />\r\n        </>\r\n      )}\r\n      {/* <a\r\n        href={`https://libraries.excalidraw.com?target=${\r\n          window.name || \"_blank\"\r\n        }&referrer=${referrer}&useHash=true&token=${id}&theme=${theme}`}\r\n        target=\"_excalidraw_libraries\"\r\n      >\r\n        {t(\"labels.libraries\")}\r\n      </a> */}\r\n    </div>\r\n  );\r\n  for (let row = 0; row < numRows; row++) {\r\n    const y = CELLS_PER_ROW * row;\r\n    const children = [];\r\n    for (let x = 0; x < CELLS_PER_ROW; x++) {\r\n      const shouldAddPendingElements =\r\n        pendingElements.length > 0 &&\r\n        !addedPendingElements &&\r\n        y + x >= libraryItems.length;\r\n      addedPendingElements = addedPendingElements || shouldAddPendingElements;\r\n      children.push(\r\n        <Stack.Col key={x}>\r\n          <LibraryUnit\r\n            elements={libraryItems[y + x]}\r\n            files={files}\r\n            pendingElements={\r\n              shouldAddPendingElements ? pendingElements : undefined\r\n            }\r\n            onRemoveFromLibrary={onRemoveFromLibrary.bind(null, y + x)}\r\n            onClick={\r\n              shouldAddPendingElements\r\n                ? onAddToLibrary.bind(null, pendingElements)\r\n                : onInsertShape.bind(null, libraryItems[y + x])\r\n            }\r\n          />\r\n        </Stack.Col>\r\n      );\r\n    }\r\n    rows.push(\r\n      <Stack.Row align=\"center\" gap={1} key={row}>\r\n        {children}\r\n      </Stack.Row>\r\n    );\r\n  }\r\n  return (\r\n    <Stack.Col align=\"start\" gap={1} className=\"layer-ui__library-items\">\r\n      {rows}\r\n    </Stack.Col>\r\n  );\r\n};\r\nconst LibraryMenu = ({\r\n  onClickOutside,\r\n  onInsertShape,\r\n  pendingElements,\r\n  onAddToLibrary,\r\n  theme,\r\n  setAppState,\r\n  files,\r\n  libraryReturnUrl,\r\n  focusContainer,\r\n  library,\r\n  id,\r\n}) => {\r\n  const ref = useRef(null);\r\n  useOnClickOutside(ref, (event) => {\r\n    // If click on the library icon, do nothing.\r\n    if (event.target.closest(\".ToolIcon_type_button__library\")) {\r\n      return;\r\n    }\r\n    onClickOutside(event);\r\n  });\r\n  const [libraryItems, setLibraryItems] = useState([]);\r\n  const [loadingState, setIsLoading] = useState(\"preloading\");\r\n  const loadingTimerRef = useRef(null);\r\n  useEffect(() => {\r\n    Promise.race([\r\n      new Promise((resolve) => {\r\n        loadingTimerRef.current = window.setTimeout(() => {\r\n          resolve(\"loading\");\r\n        }, 100);\r\n      }),\r\n      //console.log(Libraries.library),\r\n      setLibraryItems(Libraries.library),\r\n      setIsLoading(\"ready\")\r\n      // library.loadLibrary().then((items) => {\r\n      //   console.log(items)\r\n      //   console.log(Libraries.library)\r\n      //   setLibraryItems(Libraries.library);\r\n      //   setIsLoading(\"ready\");\r\n      // }),\r\n    ]).then((data) => {\r\n      if (data === \"loading\") {\r\n        setIsLoading(\"loading\");\r\n      }\r\n    });\r\n    return () => {\r\n      clearTimeout(loadingTimerRef.current);\r\n    };\r\n  }, [library]);\r\n  const removeFromLibrary = useCallback(\r\n    async (indexToRemove) => {\r\n      const items = await library.loadLibrary();\r\n      const nextItems = items.filter((_, index) => index !== indexToRemove);\r\n      library.saveLibrary(nextItems).catch((error) => {\r\n        setLibraryItems(items);\r\n        setAppState({ errorMessage: t(\"alerts.errorRemovingFromLibrary\") });\r\n      });\r\n      setLibraryItems(nextItems);\r\n    },\r\n    [library, setAppState]\r\n  );\r\n  const addToLibrary = useCallback(\r\n    async (elements) => {\r\n      if (elements.some((element) => element.type === \"image\")) {\r\n        return setAppState({\r\n          errorMessage: \"Support for adding images to the library coming soon!\",\r\n        });\r\n      }\r\n      const items = await library.loadLibrary();\r\n      const nextItems = [...items, elements];\r\n      onAddToLibrary();\r\n      library.saveLibrary(nextItems).catch((error) => {\r\n        setLibraryItems(items);\r\n        setAppState({ errorMessage: t(\"alerts.errorAddingToLibrary\") });\r\n      });\r\n      setLibraryItems(nextItems);\r\n    },\r\n    [onAddToLibrary, library, setAppState]\r\n  );\r\n  return loadingState === \"preloading\" ? null : (\r\n    <Island padding={1} ref={ref} className=\"layer-ui__library\">\r\n      {loadingState === \"loading\" ? (\r\n        <div className=\"layer-ui__library-message\">\r\n          {t(\"labels.libraryLoadingMessage\")}\r\n        </div>\r\n      ) : (\r\n        <LibraryMenuItems\r\n          libraryItems={libraryItems}\r\n          onRemoveFromLibrary={removeFromLibrary}\r\n          onAddToLibrary={addToLibrary}\r\n          onInsertShape={onInsertShape}\r\n          pendingElements={pendingElements}\r\n          setAppState={setAppState}\r\n          setLibraryItems={setLibraryItems}\r\n          libraryReturnUrl={libraryReturnUrl}\r\n          focusContainer={focusContainer}\r\n          library={library}\r\n          theme={theme}\r\n          files={files}\r\n          id={id}\r\n        />\r\n      )}\r\n    </Island>\r\n  );\r\n};\r\nconst LayerUI = ({\r\n  actionManager,\r\n  appState,\r\n  files,\r\n  setAppState,\r\n  canvas,\r\n  elements,\r\n  onCollabButtonClick,\r\n  onLockToggle,\r\n  onInsertElements,\r\n  zenModeEnabled,\r\n  showExitZenModeBtn,\r\n  showThemeBtn,\r\n  toggleZenMode,\r\n  isCollaborating,\r\n  renderTopRightUI,\r\n  renderCustomFooter,\r\n  viewModeEnabled,\r\n  libraryReturnUrl,\r\n  UIOptions,\r\n  focusContainer,\r\n  library,\r\n  id,\r\n  onImageAction,\r\n}) => {\r\n  const isMobile = useIsMobile();\r\n  const renderJSONExportDialog = () => {\r\n    if (!UIOptions.canvasActions.export) {\r\n      return null;\r\n    }\r\n    return (\r\n      <JSONExportDialog\r\n        elements={elements}\r\n        appState={appState}\r\n        files={files}\r\n        actionManager={actionManager}\r\n        exportOpts={UIOptions.canvasActions.export}\r\n        canvas={canvas}\r\n      />\r\n    );\r\n  };\r\n  const renderImageExportDialog = () => {\r\n    if (!UIOptions.canvasActions.saveAsImage) {\r\n      return null;\r\n    }\r\n    const createExporter = (type) => async (exportedElements) => {\r\n      const fileHandle = await exportCanvas(\r\n        type,\r\n        exportedElements,\r\n        appState,\r\n        files,\r\n        {\r\n          exportBackground: appState.exportBackground,\r\n          name: appState.name,\r\n          viewBackgroundColor: appState.viewBackgroundColor,\r\n        }\r\n      )\r\n        .catch(muteFSAbortError)\r\n        .catch((error) => {\r\n          console.error(error);\r\n          setAppState({ errorMessage: error.message });\r\n        });\r\n      if (\r\n        appState.exportEmbedScene &&\r\n        fileHandle &&\r\n        isImageFileHandle(fileHandle)\r\n      ) {\r\n        setAppState({ fileHandle });\r\n      }\r\n    };\r\n    return (\r\n      <ImageExportDialog\r\n        elements={elements}\r\n        appState={appState}\r\n        files={files}\r\n        actionManager={actionManager}\r\n        onExportToPng={createExporter(\"png\")}\r\n        onExportToSvg={createExporter(\"svg\")}\r\n        onExportToClipboard={createExporter(\"clipboard\")}\r\n      />\r\n    );\r\n  };\r\n  const Separator = () => {\r\n    return <div style={{ width: \".625em\" }} />;\r\n  };\r\n  const renderViewModeCanvasActions = () => {\r\n    return (\r\n      <Section\r\n        heading=\"canvasActions\"\r\n        className={clsx(\"zen-mode-transition\", {\r\n          \"transition-left\": zenModeEnabled,\r\n        })}\r\n      >\r\n        {/* the zIndex ensures this menu has higher stacking order,\r\n             see https://github.com/excalidraw/excalidraw/pull/1445 */}\r\n        <Island padding={2} style={{ zIndex: 1 }}>\r\n          <Stack.Col gap={4}>\r\n            <Stack.Row gap={1} justifyContent=\"space-between\">\r\n              {renderJSONExportDialog()}\r\n              {renderImageExportDialog()}\r\n            </Stack.Row>\r\n          </Stack.Col>\r\n        </Island>\r\n      </Section>\r\n    );\r\n  };\r\n  const renderCanvasActions = () => (\r\n    <Section\r\n      heading=\"canvasActions\"\r\n      className={clsx(\"zen-mode-transition\", {\r\n        \"transition-left\": zenModeEnabled,\r\n      })}\r\n    >\r\n      {/* the zIndex ensures this menu has higher stacking order,\r\n           see https://github.com/excalidraw/excalidraw/pull/1445 */}\r\n      <Island padding={2} style={{ zIndex: 1 }}>\r\n        <Stack.Col gap={4}>\r\n          <Stack.Row gap={1} justifyContent=\"space-between\">\r\n            {actionManager.renderAction(\"clearCanvas\")}\r\n            <Separator />\r\n            {actionManager.renderAction(\"loadScene\")}\r\n            {renderJSONExportDialog()}\r\n            {renderImageExportDialog()}\r\n            <Separator />\r\n            {onCollabButtonClick && (\r\n              <CollabButton\r\n                isCollaborating={isCollaborating}\r\n                collaboratorCount={appState.collaborators.size}\r\n                onClick={onCollabButtonClick}\r\n              />\r\n            )}\r\n          </Stack.Row>\r\n          <BackgroundPickerAndDarkModeToggle\r\n            actionManager={actionManager}\r\n            appState={appState}\r\n            setAppState={setAppState}\r\n            showThemeBtn={showThemeBtn}\r\n          />\r\n          {appState.fileHandle && (\r\n            <>{actionManager.renderAction(\"saveToActiveFile\")}</>\r\n          )}\r\n        </Stack.Col>\r\n      </Island>\r\n    </Section>\r\n  );\r\n  const renderSelectedShapeActions = () => (\r\n    <Section\r\n      heading=\"selectedShapeActions\"\r\n      className={clsx(\"zen-mode-transition\", {\r\n        \"transition-left\": zenModeEnabled,\r\n      })}\r\n    >\r\n      <Island\r\n        className={CLASSES.SHAPE_ACTIONS_MENU}\r\n        padding={2}\r\n        style={{\r\n          // we want to make sure this doesn't overflow so substracting 200\r\n          // which is approximately height of zoom footer and top left menu items with some buffer\r\n          // if active file name is displayed, subtracting 248 to account for its height\r\n          maxHeight: `${appState.height - (appState.fileHandle ? 248 : 200)}px`,\r\n        }}\r\n      >\r\n        <SelectedShapeActions\r\n          appState={appState}\r\n          elements={elements}\r\n          renderAction={actionManager.renderAction}\r\n          elementType={appState.elementType}\r\n        />\r\n      </Island>\r\n    </Section>\r\n  );\r\n  const closeLibrary = useCallback(\r\n    (event) => {\r\n      setAppState({ isLibraryOpen: false });\r\n    },\r\n    [setAppState]\r\n  );\r\n  const deselectItems = useCallback(() => {\r\n    setAppState({\r\n      selectedElementIds: {},\r\n      selectedGroupIds: {},\r\n    });\r\n  }, [setAppState]);\r\n  const libraryMenu = appState.isLibraryOpen ? (\r\n    <LibraryMenu\r\n      pendingElements={getSelectedElements(elements, appState)}\r\n      onClickOutside={closeLibrary}\r\n      onInsertShape={onInsertElements}\r\n      onAddToLibrary={deselectItems}\r\n      setAppState={setAppState}\r\n      libraryReturnUrl={libraryReturnUrl}\r\n      focusContainer={focusContainer}\r\n      library={library}\r\n      theme={appState.theme}\r\n      files={files}\r\n      id={id}\r\n    />\r\n  ) : null;\r\n\r\n  const renderTopUI = () => {\r\n    const shouldRenderSelectedShapeActions = showSelectedShapeActions(\r\n      appState,\r\n      elements\r\n    );\r\n    return(\r\n      <div className = \"FixedSideContainer\">\r\n        \r\n        <Stack.Col\r\n            gap={4}\r\n            className={clsx({ \"disable-pointerEvents\": zenModeEnabled })}\r\n          >\r\n            {viewModeEnabled\r\n              ? renderViewModeCanvasActions()\r\n              : renderCanvasActions()}\r\n            \r\n          </Stack.Col>\r\n           {/* <HintViewer\r\n                        appState={appState}\r\n                        elements={elements}\r\n                        isMobile={isMobile}\r\n                      />\r\n           {shouldRenderSelectedShapeActions && renderSelectedShapeActions()} */}\r\n          \r\n      </div >\r\n    )\r\n  }\r\n  const renderFixedSideContainer = () => {\r\n\r\n    return (\r\n      <FixedSideContainer side=\"left\">\r\n        <div className=\"App-menu App-menu_left\">\r\n          \r\n          {!viewModeEnabled && (\r\n            <Section heading=\"shapes\">\r\n              {(heading) => (\r\n                <Stack.Row gap={4} align=\"start\">\r\n                  <Stack.Col gap={1}>\r\n                    <LockButton\r\n                      zenModeEnabled={zenModeEnabled}\r\n                      checked={appState.elementLocked}\r\n                      onChange={onLockToggle}\r\n                      title={t(\"toolBar.lock\")}\r\n                    />\r\n                    <Island\r\n                      padding={1}\r\n                      className={clsx({ \"zen-mode\": zenModeEnabled })}\r\n                    >\r\n                      \r\n                      {heading}\r\n                      <Stack.Col gap={1}>\r\n                        <ShapesSwitcher\r\n                          canvas={canvas}\r\n                          elementType={appState.elementType}\r\n                          setAppState={setAppState}\r\n                          onImageAction={({ pointerType }) => {\r\n                            onImageAction({\r\n                              insertOnCanvasDirectly: pointerType !== \"mouse\",\r\n                            });\r\n                          }}\r\n                        />\r\n                      </Stack.Col>\r\n                    </Island>\r\n                    <LibraryButton\r\n                      appState={appState}\r\n                      setAppState={setAppState}\r\n                    />\r\n                  </Stack.Col>\r\n                  {libraryMenu}\r\n                </Stack.Row>\r\n              )}\r\n            </Section>\r\n          )}\r\n          <div\r\n            className={clsx(\r\n              \"layer-ui__wrapper__top-right zen-mode-transition\",\r\n              {\r\n                \"transition-right\": zenModeEnabled,\r\n              }\r\n            )}\r\n          >\r\n            <UserList>\r\n              {appState.collaborators.size > 0 &&\r\n                Array.from(appState.collaborators)\r\n                  // Collaborator is either not initialized or is actually the current user.\r\n                  .filter(([_, client]) => Object.keys(client).length !== 0)\r\n                  .map(([clientId, client]) => (\r\n                    <Tooltip\r\n                      label={client.username || \"Unknown user\"}\r\n                      key={clientId}\r\n                    >\r\n                      {actionManager.renderAction(\"goToCollaborator\", {\r\n                        id: clientId,\r\n                      })}\r\n                    </Tooltip>\r\n                  ))}\r\n            </UserList>\r\n            {renderTopRightUI?.(isMobile, appState)}\r\n          </div>\r\n        </div>\r\n      </FixedSideContainer>\r\n    );\r\n  };\r\n  const renderBottomAppMenu = () => {\r\n    return (\r\n      <footer\r\n        role=\"contentinfo\"\r\n        className=\"layer-ui__wrapper__footer App-menu App-menu_bottom\"\r\n      >\r\n        <div\r\n          className={clsx(\r\n            \"layer-ui__wrapper__footer-left zen-mode-transition\",\r\n            {\r\n              \"layer-ui__wrapper__footer-left--transition-left\": zenModeEnabled,\r\n            }\r\n          )}\r\n        >\r\n          <Stack.Col gap={2}>\r\n            <Section heading=\"canvasActions\">\r\n              <Island padding={1}>\r\n                <ZoomActions\r\n                  renderAction={actionManager.renderAction}\r\n                  zoom={appState.zoom}\r\n                />\r\n              </Island>\r\n              {!viewModeEnabled && (\r\n                <div\r\n                  className={clsx(\"undo-redo-buttons zen-mode-transition\", {\r\n                    \"layer-ui__wrapper__footer-left--transition-bottom\":\r\n                      zenModeEnabled,\r\n                  })}\r\n                >\r\n                  {actionManager.renderAction(\"undo\", { size: \"small\" })}\r\n                  {actionManager.renderAction(\"redo\", { size: \"small\" })}\r\n                </div>\r\n              )}\r\n            </Section>\r\n          </Stack.Col>\r\n        </div>\r\n        <div\r\n          className={clsx(\r\n            \"layer-ui__wrapper__footer-center zen-mode-transition\",\r\n            {\r\n              \"layer-ui__wrapper__footer-left--transition-bottom\":\r\n                zenModeEnabled,\r\n            }\r\n          )}\r\n        >\r\n          {renderCustomFooter?.(false, appState)}\r\n        </div>\r\n        <div\r\n          className={clsx(\r\n            \"layer-ui__wrapper__footer-right zen-mode-transition\",\r\n            {\r\n              \"transition-right disable-pointerEvents\": zenModeEnabled,\r\n            }\r\n          )}\r\n        >\r\n          {actionManager.renderAction(\"toggleShortcuts\")}\r\n        </div>\r\n        <button\r\n          className={clsx(\"disable-zen-mode\", {\r\n            \"disable-zen-mode--visible\": showExitZenModeBtn,\r\n          })}\r\n          onClick={toggleZenMode}\r\n        >\r\n          {t(\"buttons.exitZenMode\")}\r\n        </button>\r\n      </footer>\r\n    );\r\n  };\r\n  const dialogs = (\r\n    <>\r\n      {appState.isLoading && <LoadingMessage />}\r\n      {appState.errorMessage && (\r\n        <ErrorDialog\r\n          message={appState.errorMessage}\r\n          onClose={() => setAppState({ errorMessage: null })}\r\n        />\r\n      )}\r\n      {appState.showHelpDialog && (\r\n        <HelpDialog\r\n          onClose={() => {\r\n            setAppState({ showHelpDialog: false });\r\n          }}\r\n        />\r\n      )}\r\n      {appState.pasteDialog.shown && (\r\n        <PasteChartDialog\r\n          setAppState={setAppState}\r\n          appState={appState}\r\n          onInsertChart={onInsertElements}\r\n          onClose={() =>\r\n            setAppState({\r\n              pasteDialog: { shown: false, data: null },\r\n            })\r\n          }\r\n        />\r\n      )}\r\n    </>\r\n  );\r\n  return isMobile ? (\r\n    <>\r\n      {dialogs}\r\n      <MobileMenu\r\n        appState={appState}\r\n        elements={elements}\r\n        actionManager={actionManager}\r\n        libraryMenu={libraryMenu}\r\n        renderJSONExportDialog={renderJSONExportDialog}\r\n        renderImageExportDialog={renderImageExportDialog}\r\n        setAppState={setAppState}\r\n        onCollabButtonClick={onCollabButtonClick}\r\n        onLockToggle={onLockToggle}\r\n        canvas={canvas}\r\n        isCollaborating={isCollaborating}\r\n        renderCustomFooter={renderCustomFooter}\r\n        viewModeEnabled={viewModeEnabled}\r\n        showThemeBtn={showThemeBtn}\r\n        onImageAction={onImageAction}\r\n        renderTopRightUI={renderTopRightUI}\r\n      />\r\n    </>\r\n  ) : (\r\n    <div\r\n      className={clsx(\"layer-ui__wrapper\", {\r\n        \"disable-pointerEvents\":\r\n          appState.draggingElement ||\r\n          appState.resizingElement ||\r\n          (appState.editingElement && !isTextElement(appState.editingElement)),\r\n      })}\r\n    >\r\n      {dialogs}\r\n      {renderTopUI()}\r\n      {renderFixedSideContainer()}\r\n      {renderBottomAppMenu()}\r\n      {appState.scrolledOutside && (\r\n        <button\r\n          className=\"scroll-back-to-content\"\r\n          onClick={() => {\r\n            setAppState({\r\n              ...calculateScrollCenter(elements, appState, canvas),\r\n            });\r\n          }}\r\n        >\r\n          {t(\"buttons.scrollBackToContent\")}\r\n        </button>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\nconst areEqual = (prev, next) => {\r\n  const getNecessaryObj = (appState) => {\r\n    const {\r\n      suggestedBindings,\r\n      startBoundElement: boundElement,\r\n      ...ret\r\n    } = appState;\r\n    return ret;\r\n  };\r\n  const prevAppState = getNecessaryObj(prev.appState);\r\n  const nextAppState = getNecessaryObj(next.appState);\r\n  const keys = Object.keys(prevAppState);\r\n  return (\r\n    prev.renderCustomFooter === next.renderCustomFooter &&\r\n    prev.langCode === next.langCode &&\r\n    prev.elements === next.elements &&\r\n    prev.files === next.files &&\r\n    keys.every((key) => prevAppState[key] === nextAppState[key])\r\n  );\r\n};\r\nexport default React.memo(LayerUI, areEqual);\r\n","import React from \"react\";\r\nimport { getCommonBounds } from \"../element/bounds\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { getTargetElements } from \"../scene\";\r\nimport { close } from \"./icons\";\r\nimport { Island } from \"./Island\";\r\nimport \"./Stats.scss\";\r\nexport const Stats = (props) => {\r\n    const isMobile = useIsMobile();\r\n    const boundingBox = getCommonBounds(props.elements);\r\n    const selectedElements = getTargetElements(props.elements, props.appState);\r\n    const selectedBoundingBox = getCommonBounds(selectedElements);\r\n    if (isMobile && props.appState.openMenu) {\r\n        return null;\r\n    }\r\n    return (<div className=\"Stats\">\r\n      <Island padding={2}>\r\n        <div className=\"close\" onClick={props.onClose}>\r\n          {close}\r\n        </div>\r\n        <h3>{t(\"stats.title\")}</h3>\r\n        <table>\r\n          <tbody>\r\n            <tr>\r\n              <th colSpan={2}>{t(\"stats.scene\")}</th>\r\n            </tr>\r\n            <tr>\r\n              <td>{t(\"stats.elements\")}</td>\r\n              <td>{props.elements.length}</td>\r\n            </tr>\r\n            <tr>\r\n              <td>{t(\"stats.width\")}</td>\r\n              <td>{Math.round(boundingBox[2]) - Math.round(boundingBox[0])}</td>\r\n            </tr>\r\n            <tr>\r\n              <td>{t(\"stats.height\")}</td>\r\n              <td>{Math.round(boundingBox[3]) - Math.round(boundingBox[1])}</td>\r\n            </tr>\r\n\r\n            {selectedElements.length === 1 && (<tr>\r\n                <th colSpan={2}>{t(\"stats.element\")}</th>\r\n              </tr>)}\r\n\r\n            {selectedElements.length > 1 && (<>\r\n                <tr>\r\n                  <th colSpan={2}>{t(\"stats.selected\")}</th>\r\n                </tr>\r\n                <tr>\r\n                  <td>{t(\"stats.elements\")}</td>\r\n                  <td>{selectedElements.length}</td>\r\n                </tr>\r\n              </>)}\r\n            {selectedElements.length > 0 && (<>\r\n                <tr>\r\n                  <td>{\"x\"}</td>\r\n                  <td>{Math.round(selectedBoundingBox[0])}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>{\"y\"}</td>\r\n                  <td>{Math.round(selectedBoundingBox[1])}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>{t(\"stats.width\")}</td>\r\n                  <td>\r\n                    {Math.round(selectedBoundingBox[2] - selectedBoundingBox[0])}\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <td>{t(\"stats.height\")}</td>\r\n                  <td>\r\n                    {Math.round(selectedBoundingBox[3] - selectedBoundingBox[1])}\r\n                  </td>\r\n                </tr>\r\n              </>)}\r\n            {selectedElements.length === 1 && (<tr>\r\n                <td>{t(\"stats.angle\")}</td>\r\n                <td>\r\n                  {`${Math.round((selectedElements[0].angle * 180) / Math.PI)}°`}\r\n                </td>\r\n              </tr>)}\r\n            {props.renderCustomStats?.(props.elements, props.appState)}\r\n          </tbody>\r\n        </table>\r\n      </Island>\r\n    </div>);\r\n};\r\n","import { useCallback, useEffect, useRef } from \"react\";\r\nimport { TOAST_TIMEOUT } from \"../constants\";\r\nimport \"./Toast.scss\";\r\nexport const Toast = ({ message, clearToast, }) => {\r\n    const timerRef = useRef(0);\r\n    const scheduleTimeout = useCallback(() => (timerRef.current = window.setTimeout(() => clearToast(), TOAST_TIMEOUT)), [clearToast]);\r\n    useEffect(() => {\r\n        scheduleTimeout();\r\n        return () => clearTimeout(timerRef.current);\r\n    }, [scheduleTimeout, message]);\r\n    return (<div className=\"Toast\" onMouseEnter={() => clearTimeout(timerRef?.current)} onMouseLeave={scheduleTimeout}>\r\n      <p className=\"Toast__message\">{message}</p>\r\n    </div>);\r\n};\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { trackEvent } from \"../analytics\";\r\nexport const actionToggleViewMode = register({\r\n    name: \"viewMode\",\r\n    perform(elements, appState) {\r\n        trackEvent(\"view\", \"mode\", \"view\");\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                viewModeEnabled: !this.checked(appState),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.viewModeEnabled,\r\n    contextItemLabel: \"labels.viewMode\",\r\n    keyTest: (event) => !event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.R,\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport rough from \"roughjs/bin/rough\";\r\nimport clsx from \"clsx\";\r\nimport { nanoid } from \"nanoid\";\r\nimport {\r\n  actionAddToLibrary,\r\n  actionBringForward,\r\n  actionBringToFront,\r\n  actionCopy,\r\n  actionCopyAsPng,\r\n  actionCopyAsSvg,\r\n  actionCopyStyles,\r\n  actionCut,\r\n  actionDeleteSelected,\r\n  actionDuplicateSelection,\r\n  actionFinalize,\r\n  actionFlipHorizontal,\r\n  actionFlipVertical,\r\n  actionGroup,\r\n  actionPasteStyles,\r\n  actionSelectAll,\r\n  actionSendBackward,\r\n  actionSendToBack,\r\n  actionToggleGridMode,\r\n  actionToggleStats,\r\n  actionToggleZenMode,\r\n  actionUngroup,\r\n} from \"../actions\";\r\nimport { createRedoAction, createUndoAction } from \"../actions/actionHistory\";\r\nimport { ActionManager } from \"../actions/manager\";\r\nimport { actions } from \"../actions/register\";\r\nimport { trackEvent } from \"../analytics\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport {\r\n  copyToClipboard,\r\n  parseClipboard,\r\n  probablySupportsClipboardBlob,\r\n  probablySupportsClipboardWriteText,\r\n} from \"../clipboard\";\r\nimport {\r\n  APP_NAME,\r\n  CURSOR_TYPE,\r\n  DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT,\r\n  DEFAULT_UI_OPTIONS,\r\n  DEFAULT_VERTICAL_ALIGN,\r\n  DRAGGING_THRESHOLD,\r\n  ELEMENT_SHIFT_TRANSLATE_AMOUNT,\r\n  ELEMENT_TRANSLATE_AMOUNT,\r\n  ENV,\r\n  EVENT,\r\n  GRID_SIZE,\r\n  IMAGE_RENDER_TIMEOUT,\r\n  LINE_CONFIRM_THRESHOLD,\r\n  MAX_ALLOWED_FILE_BYTES,\r\n  MIME_TYPES,\r\n  MQ_MAX_HEIGHT_LANDSCAPE,\r\n  MQ_MAX_WIDTH_LANDSCAPE,\r\n  MQ_MAX_WIDTH_PORTRAIT,\r\n  POINTER_BUTTON,\r\n  SCROLL_TIMEOUT,\r\n  TAP_TWICE_TIMEOUT,\r\n  TEXT_TO_CENTER_SNAP_THRESHOLD,\r\n  THEME,\r\n  TOUCH_CTX_MENU_TIMEOUT,\r\n  URL_HASH_KEYS,\r\n  URL_QUERY_KEYS,\r\n  ZOOM_STEP,\r\n} from \"../constants\";\r\nimport { loadFromBlob } from \"../data\";\r\nimport { isValidLibrary } from \"../data/json\";\r\nimport Library from \"../data/library\";\r\nimport { restore, restoreElements } from \"../data/restore\";\r\nimport {\r\n  dragNewElement,\r\n  dragSelectedElements,\r\n  duplicateElement,\r\n  getCommonBounds,\r\n  getCursorForResizingElement,\r\n  getDragOffsetXY,\r\n  getElementWithTransformHandleType,\r\n  getNormalizedDimensions,\r\n  getPerfectElementSize,\r\n  getResizeArrowDirection,\r\n  getResizeOffsetXY,\r\n  getTransformHandleTypeFromCoords,\r\n  hitTest,\r\n  isHittingElementBoundingBoxWithoutHittingElement,\r\n  isInvisiblySmallElement,\r\n  isNonDeletedElement,\r\n  isTextElement,\r\n  newElement,\r\n  newLinearElement,\r\n  newTextElement,\r\n  newImageElement,\r\n  textWysiwyg,\r\n  transformElements,\r\n  updateTextElement,\r\n} from \"../element\";\r\nimport {\r\n  bindOrUnbindSelectedElements,\r\n  fixBindingsAfterDeletion,\r\n  fixBindingsAfterDuplication,\r\n  getEligibleElementsForBinding,\r\n  getHoveredElementForBinding,\r\n  isBindingEnabled,\r\n  isLinearElementSimpleAndAlreadyBound,\r\n  maybeBindLinearElement,\r\n  shouldEnableBindingForPointerEvent,\r\n  unbindLinearElements,\r\n  updateBoundElements,\r\n} from \"../element/binding\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport {\r\n  bumpVersion,\r\n  mutateElement,\r\n  newElementWith,\r\n} from \"../element/mutateElement\";\r\nimport { deepCopyElement, newFreeDrawElement } from \"../element/newElement\";\r\nimport {\r\n  isBindingElement,\r\n  isBindingElementType,\r\n  isImageElement,\r\n  isInitializedImageElement,\r\n  isLinearElement,\r\n  isLinearElementType,\r\n} from \"../element/typeChecks\";\r\nimport { getCenter, getDistance } from \"../gesture\";\r\nimport {\r\n  editGroupForSelectedElement,\r\n  getElementsInGroup,\r\n  getSelectedGroupIdForElement,\r\n  getSelectedGroupIds,\r\n  isElementInGroup,\r\n  isSelectedViaGroup,\r\n  selectGroupsForSelectedElements,\r\n} from \"../groups\";\r\nimport History from \"../history\";\r\nimport { defaultLang, getLanguage, languages, setLanguage, t } from \"../i18n\";\r\nimport {\r\n  CODES,\r\n  shouldResizeFromCenter,\r\n  shouldMaintainAspectRatio,\r\n  shouldRotateWithDiscreteAngle,\r\n  isArrowKey,\r\n  KEYS,\r\n} from \"../keys\";\r\nimport { distance2d, getGridPoint, isPathALoop } from \"../math\";\r\nimport { renderScene } from \"../renderer\";\r\nimport { invalidateShapeForElement } from \"../renderer/renderElement\";\r\nimport {\r\n  calculateScrollCenter,\r\n  getElementContainingPosition,\r\n  getElementsAtPosition,\r\n  getElementsWithinSelection,\r\n  getNormalizedZoom,\r\n  getSelectedElements,\r\n  hasBackground,\r\n  isOverScrollBars,\r\n  isSomeElementSelected,\r\n} from \"../scene\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { getNewZoom } from \"../scene/zoom\";\r\nimport { findShapeByKey } from \"../shapes\";\r\nimport {\r\n  debounce,\r\n  distance,\r\n  getNearestScrollableContainer,\r\n  isInputLike,\r\n  isToolIcon,\r\n  isWritableElement,\r\n  resetCursor,\r\n  resolvablePromise,\r\n  sceneCoordsToViewportCoords,\r\n  setCursor,\r\n  setCursorForShape,\r\n  tupleToCoors,\r\n  viewportCoordsToSceneCoords,\r\n  withBatchedUpdates,\r\n} from \"../utils\";\r\nimport ContextMenu from \"./ContextMenu\";\r\nimport LayerUI from \"./LayerUI\";\r\nimport { Stats } from \"./Stats\";\r\nimport { Toast } from \"./Toast\";\r\nimport { actionToggleViewMode } from \"../actions/actionToggleViewMode\";\r\nimport {\r\n  dataURLToFile,\r\n  generateIdFromFile,\r\n  getDataURL,\r\n  isSupportedImageFile,\r\n  resizeImageFile,\r\n  SVGStringToFile,\r\n} from \"../data/blob\";\r\nimport {\r\n  getInitializedImageElements,\r\n  loadHTMLImageElement,\r\n  normalizeSVG,\r\n  updateImageCache as _updateImageCache,\r\n} from \"../element/image\";\r\nimport throttle from \"lodash.throttle\";\r\nimport { fileOpen, nativeFileSystemSupported } from \"../data/filesystem\";\r\nconst IsMobileContext = React.createContext(false);\r\nexport const useIsMobile = () => useContext(IsMobileContext);\r\n\r\nconst ExcalidrawContainerContext = React.createContext({\r\n  container: null,\r\n  id: null,\r\n});\r\n\r\nexport const useExcalidrawContainer = () =>\r\n  useContext(ExcalidrawContainerContext);\r\n\r\nlet didTapTwice = false;\r\nlet tappedTwiceTimer = 0;\r\nlet cursorX = 0;\r\nlet cursorY = 0;\r\nlet isHoldingSpace = false;\r\nlet isPanning = false;\r\nlet isDraggingScrollBar = false;\r\nlet currentScrollBars = { horizontal: null, vertical: null };\r\nlet touchTimeout = 0;\r\nlet invalidateContextMenu = false;\r\nlet lastPointerUp = null;\r\n\r\nconst gesture = {\r\n  pointers: new Map(),\r\n  lastCenter: null,\r\n  initialDistance: null,\r\n  initialScale: null,\r\n};\r\n\r\nclass App extends React.Component {\r\n\r\n  constructor(props) {\r\n\r\n    super(props);\r\n    this.canvas = null;\r\n    this.rc = null;\r\n    this.unmounted = false;\r\n    this.isMobile = false;\r\n    this.trusted = false\r\n    this.excalidrawContainerRef = React.createRef();\r\n    this.files = {};\r\n    this.imageCache = new Map();\r\n    \r\n\r\n    //why do we need to focus the excali container?\r\n    this.focusContainer = () => {\r\n      if (this.props.autoFocus) {\r\n        this.excalidrawContainerRef.current?.focus();\r\n      }\r\n    };\r\n    \r\n    //class scene\r\n    this.getSceneElementsIncludingDeleted = () => {\r\n      return this.scene.getElementsIncludingDeleted();\r\n    };\r\n    \r\n    this.getSceneElements = () => {\r\n      return this.scene.getElements();\r\n    };\r\n\r\n    this.syncActionResult = withBatchedUpdates((actionResult) => {\r\n      if (this.unmounted || actionResult === false) {\r\n        return;\r\n      }\r\n      let editingElement = null;\r\n      if (actionResult.elements) {\r\n        actionResult.elements.forEach((element) => {\r\n          if (\r\n            this.state.editingElement?.id === element.id &&\r\n            this.state.editingElement !== element &&\r\n            isNonDeletedElement(element)\r\n          ) {\r\n            editingElement = element;\r\n          }\r\n        });\r\n        this.scene.replaceAllElements(actionResult.elements);\r\n        if (actionResult.commitToHistory) {\r\n          this.history.resumeRecording();\r\n        }\r\n      }\r\n      if (actionResult.files) {\r\n        this.files = actionResult.replaceFiles\r\n          ? actionResult.files\r\n          : { ...this.files, ...actionResult.files };\r\n        this.addNewImagesToImageCache();\r\n      }\r\n      if (actionResult.appState || editingElement) {\r\n        if (actionResult.commitToHistory) {\r\n          this.history.resumeRecording();\r\n        }\r\n        let viewModeEnabled = actionResult?.appState?.viewModeEnabled || false;\r\n        let zenModeEnabled = actionResult?.appState?.zenModeEnabled || false;\r\n        let gridSize = actionResult?.appState?.gridSize || null;\r\n        let theme = actionResult?.appState?.theme || THEME.LIGHT;\r\n        let name = actionResult?.appState?.name ?? this.state.name;\r\n        if (typeof this.props.viewModeEnabled !== \"undefined\") {\r\n          viewModeEnabled = this.props.viewModeEnabled;\r\n        }\r\n        if (typeof this.props.zenModeEnabled !== \"undefined\") {\r\n          zenModeEnabled = this.props.zenModeEnabled;\r\n        }\r\n        if (typeof this.props.gridModeEnabled !== \"undefined\") {\r\n          gridSize = this.props.gridModeEnabled ? GRID_SIZE : null;\r\n        }\r\n        if (typeof this.props.theme !== \"undefined\") {\r\n          theme = this.props.theme;\r\n        }\r\n        if (typeof this.props.name !== \"undefined\") {\r\n          name = this.props.name;\r\n        }\r\n        this.setState(\r\n          (state) => {\r\n            // using Object.assign instead of spread to fool TS 4.2.2+ into\r\n            // regarding the resulting type as not containing undefined\r\n            // (which the following expression will never contain)\r\n            return Object.assign(actionResult.appState || {}, {\r\n              editingElement:\r\n                editingElement || actionResult.appState?.editingElement || null,\r\n              viewModeEnabled,\r\n              zenModeEnabled,\r\n              gridSize,\r\n              theme,\r\n              name,\r\n            });\r\n          },\r\n          () => {\r\n            if (actionResult.syncHistory) {\r\n              this.history.setCurrentState(\r\n                this.state,\r\n                this.scene.getElementsIncludingDeleted()\r\n              );\r\n            }\r\n          }\r\n        );\r\n      }\r\n    });\r\n\r\n    // Lifecycle\r\n    this.onBlur = withBatchedUpdates(() => {\r\n      isHoldingSpace = false;\r\n      this.setState({ isBindingEnabled: true });\r\n    });\r\n\r\n    this.onUnload = () => {\r\n      this.onBlur();\r\n    };\r\n\r\n    this.disableEvent = (event) => {\r\n      event.preventDefault();\r\n    };\r\n\r\n    this.onFontLoaded = () => {\r\n      this.scene.getElementsIncludingDeleted().forEach((element) => {\r\n        if (isTextElement(element)) {\r\n          invalidateShapeForElement(element);\r\n        }\r\n      });\r\n      this.onSceneUpdated();\r\n    };\r\n\r\n    this.importLibraryFromUrl = async (url, token) => {\r\n      if (window.location.hash.includes(URL_HASH_KEYS.addLibrary)) {\r\n        const hash = new URLSearchParams(window.location.hash.slice(1));\r\n        hash.delete(URL_HASH_KEYS.addLibrary);\r\n        window.history.replaceState({}, APP_NAME, `#${hash.toString()}`);\r\n      } else if (window.location.search.includes(URL_QUERY_KEYS.addLibrary)) {\r\n        const query = new URLSearchParams(window.location.search);\r\n        query.delete(URL_QUERY_KEYS.addLibrary);\r\n        window.history.replaceState({}, APP_NAME, `?${query.toString()}`);\r\n      }\r\n      try {\r\n        const request = await fetch(decodeURIComponent(url));\r\n        const blob = await request.blob();\r\n        const json = JSON.parse(await blob.text());\r\n        if (!isValidLibrary(json)) {\r\n          throw new Error();\r\n        }\r\n        if (\r\n          token === this.id ||\r\n          window.confirm(\r\n            t(\"alerts.confirmAddLibrary\", { numShapes: json.library.length })\r\n          )\r\n        ) {\r\n          await this.library.importLibrary(blob);\r\n          // hack to rerender the library items after import\r\n          if (this.state.isLibraryOpen) {\r\n            this.setState({ isLibraryOpen: false });\r\n          }\r\n          this.setState({ isLibraryOpen: true });\r\n        }\r\n      } catch (error) {\r\n        window.alert(t(\"alerts.errorLoadingLibrary\"));\r\n        console.error(error);\r\n      } finally {\r\n        this.focusContainer();\r\n      }\r\n    };\r\n\r\n    this.resetHistory = () => {\r\n      this.history.clear();\r\n    };\r\n    /**\r\n     * Resets scene & history.\r\n     * ! Do not use to clear scene user action !\r\n     */\r\n    this.resetScene = withBatchedUpdates((opts) => {\r\n      this.scene.replaceAllElements([]);\r\n      this.setState((state) => ({\r\n        ...getDefaultAppState(),\r\n        isLoading: opts?.resetLoadingState ? false : state.isLoading,\r\n        theme: this.state.theme,\r\n      }));\r\n      this.resetHistory();\r\n    });\r\n    this.initializeScene = async () => {\r\n      if (\"launchQueue\" in window && \"LaunchParams\" in window) {\r\n        window.launchQueue.setConsumer(async (launchParams) => {\r\n          if (!launchParams.files.length) {\r\n            return;\r\n          }\r\n          const fileHandle = launchParams.files[0];\r\n          const blob = await fileHandle.getFile();\r\n          blob.handle = fileHandle;\r\n          loadFromBlob(\r\n            blob,\r\n            this.state,\r\n            this.scene.getElementsIncludingDeleted()\r\n          )\r\n            .then((scene) => {\r\n              this.syncActionResult({\r\n                ...scene,\r\n                appState: {\r\n                  ...(scene.appState || this.state),\r\n                  isLoading: false,\r\n                },\r\n                commitToHistory: true,\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              this.setState({ isLoading: false, errorMessage: error.message });\r\n            });\r\n        });\r\n      }\r\n      if (!this.state.isLoading) {\r\n        this.setState({ isLoading: true });\r\n      }\r\n      let initialData = null;\r\n      try {\r\n        initialData = (await this.props.initialData) || null;\r\n        if (initialData?.libraryItems) {\r\n          this.libraryItemsFromStorage = initialData.libraryItems;\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        initialData = {\r\n          appState: {\r\n            errorMessage:\r\n              error.message ||\r\n              \"Encountered an error during importing or restoring scene data\",\r\n          },\r\n        };\r\n      }\r\n      const scene = restore(initialData, null, null);\r\n      scene.appState = {\r\n        ...scene.appState,\r\n        elementType:\r\n          scene.appState.elementType === \"image\"\r\n            ? \"selection\"\r\n            : scene.appState.elementType,\r\n        isLoading: false,\r\n      };\r\n      if (initialData?.scrollToContent) {\r\n        scene.appState = {\r\n          ...scene.appState,\r\n          ...calculateScrollCenter(\r\n            scene.elements,\r\n            {\r\n              ...scene.appState,\r\n              width: this.state.width,\r\n              height: this.state.height,\r\n              offsetTop: this.state.offsetTop,\r\n              offsetLeft: this.state.offsetLeft,\r\n            },\r\n            null\r\n          ),\r\n        };\r\n      }\r\n      this.resetHistory();\r\n      this.syncActionResult({\r\n        ...scene,\r\n        commitToHistory: true,\r\n      });\r\n      const libraryUrl =\r\n        // current\r\n        new URLSearchParams(window.location.hash.slice(1)).get(\r\n          URL_HASH_KEYS.addLibrary\r\n        ) ||\r\n        // legacy, kept for compat reasons\r\n        new URLSearchParams(window.location.search).get(\r\n          URL_QUERY_KEYS.addLibrary\r\n        );\r\n      if (libraryUrl) {\r\n        await this.importLibraryFromUrl(libraryUrl);\r\n      }\r\n    };\r\n    this.onResize = withBatchedUpdates(() => {\r\n      this.scene\r\n        .getElementsIncludingDeleted()\r\n        .forEach((element) => invalidateShapeForElement(element));\r\n      this.setState({});\r\n    });\r\n    this.onScroll = debounce(() => {\r\n      const { offsetTop, offsetLeft } = this.getCanvasOffsets();\r\n      this.setState((state) => {\r\n        if (state.offsetLeft === offsetLeft && state.offsetTop === offsetTop) {\r\n          return null;\r\n        }\r\n        return { offsetTop, offsetLeft };\r\n      });\r\n    }, SCROLL_TIMEOUT);\r\n    // Copy/paste\r\n    this.onCut = withBatchedUpdates((event) => {\r\n      const isExcalidrawActive = this.excalidrawContainerRef.current?.contains(\r\n        document.activeElement\r\n      );\r\n      if (!isExcalidrawActive || isWritableElement(event.target)) {\r\n        return;\r\n      }\r\n      this.cutAll();\r\n      event.preventDefault();\r\n    });\r\n    this.onCopy = withBatchedUpdates((event) => {\r\n      const isExcalidrawActive = this.excalidrawContainerRef.current?.contains(\r\n        document.activeElement\r\n      );\r\n      if (!isExcalidrawActive || isWritableElement(event.target)) {\r\n        return;\r\n      }\r\n      this.copyAll();\r\n      event.preventDefault();\r\n    });\r\n    this.cutAll = () => {\r\n      this.copyAll();\r\n      this.actionManager.executeAction(actionDeleteSelected);\r\n    };\r\n    this.copyAll = () => {\r\n      copyToClipboard(this.scene.getElements(), this.state, this.files);\r\n    };\r\n    this.onTapStart = (event) => {\r\n      if (!didTapTwice) {\r\n        didTapTwice = true;\r\n        clearTimeout(tappedTwiceTimer);\r\n        tappedTwiceTimer = window.setTimeout(\r\n          App.resetTapTwice,\r\n          TAP_TWICE_TIMEOUT\r\n        );\r\n        return;\r\n      }\r\n      // insert text only if we tapped twice with a single finger\r\n      // event.touches.length === 1 will also prevent inserting text when user's zooming\r\n      if (didTapTwice && event.touches.length === 1) {\r\n        const [touch] = event.touches;\r\n        // @ts-ignore\r\n        this.handleCanvasDoubleClick({\r\n          clientX: touch.clientX,\r\n          clientY: touch.clientY,\r\n        });\r\n        didTapTwice = false;\r\n        clearTimeout(tappedTwiceTimer);\r\n      }\r\n      event.preventDefault();\r\n      if (event.touches.length === 2) {\r\n        this.setState({\r\n          selectedElementIds: {},\r\n        });\r\n      }\r\n    };\r\n    this.onTapEnd = (event) => {\r\n      if (event.touches.length > 0) {\r\n        this.setState({\r\n          previousSelectedElementIds: {},\r\n          selectedElementIds: this.state.previousSelectedElementIds,\r\n        });\r\n      }\r\n    };\r\n    this.pasteFromClipboard = withBatchedUpdates(async (event) => {\r\n      // #686\r\n      const target = document.activeElement;\r\n      const isExcalidrawActive =\r\n        this.excalidrawContainerRef.current?.contains(target);\r\n      if (!isExcalidrawActive) {\r\n        return;\r\n      }\r\n      const elementUnderCursor = document.elementFromPoint(cursorX, cursorY);\r\n      if (\r\n        // if no ClipboardEvent supplied, assume we're pasting via contextMenu\r\n        // thus these checks don't make sense\r\n        event &&\r\n        (!(elementUnderCursor instanceof HTMLCanvasElement) ||\r\n          isWritableElement(target))\r\n      ) {\r\n        return;\r\n      }\r\n      // must be called in the same frame (thus before any awaits) as the paste\r\n      // event else some browsers (FF...) will clear the clipboardData\r\n      // (something something security)\r\n      let file = event?.clipboardData?.files[0];\r\n      const data = await parseClipboard(event);\r\n      if (!file && data.text) {\r\n        const string = data.text.trim();\r\n        if (string.startsWith(\"<svg\") && string.endsWith(\"</svg>\")) {\r\n          // ignore SVG validation/normalization which will be done during image\r\n          // initialization\r\n          file = SVGStringToFile(string);\r\n        }\r\n      }\r\n      if (isSupportedImageFile(file)) {\r\n        const { x: sceneX, y: sceneY } = viewportCoordsToSceneCoords(\r\n          { clientX: cursorX, clientY: cursorY },\r\n          this.state\r\n        );\r\n        const imageElement = this.createImageElement({ sceneX, sceneY });\r\n        this.insertImageElement(imageElement, file);\r\n        this.initializeImageDimensions(imageElement);\r\n        this.setState({ selectedElementIds: { [imageElement.id]: true } });\r\n        return;\r\n      }\r\n      if (this.props.onPaste) {\r\n        try {\r\n          if ((await this.props.onPaste(data, event)) === false) {\r\n            return;\r\n          }\r\n        } catch (error) {\r\n          console.error(error);\r\n        }\r\n      }\r\n      if (data.errorMessage) {\r\n        this.setState({ errorMessage: data.errorMessage });\r\n      } else if (data.spreadsheet) {\r\n        this.setState({\r\n          pasteDialog: {\r\n            data: data.spreadsheet,\r\n            shown: true,\r\n          },\r\n        });\r\n      } else if (data.elements) {\r\n        this.addElementsFromPasteOrLibrary({\r\n          elements: data.elements,\r\n          files: data.files || null,\r\n          position: \"cursor\",\r\n        });\r\n      } else if (data.text) {\r\n        this.addTextFromPaste(data.text);\r\n      }\r\n      this.selectShapeTool(\"selection\");\r\n      event?.preventDefault();\r\n    });\r\n    this.addElementsFromPasteOrLibrary = (opts) => {\r\n      const elements = restoreElements(opts.elements, null);\r\n      const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n      const elementsCenterX = distance(minX, maxX) / 2;\r\n      const elementsCenterY = distance(minY, maxY) / 2;\r\n      const clientX =\r\n        typeof opts.position === \"object\"\r\n          ? opts.position.clientX\r\n          : opts.position === \"cursor\"\r\n          ? cursorX\r\n          : this.state.width / 2 + this.state.offsetLeft;\r\n      const clientY =\r\n        typeof opts.position === \"object\"\r\n          ? opts.position.clientY\r\n          : opts.position === \"cursor\"\r\n          ? cursorY\r\n          : this.state.height / 2 + this.state.offsetTop;\r\n      const { x, y } = viewportCoordsToSceneCoords(\r\n        { clientX, clientY },\r\n        this.state\r\n      );\r\n      const dx = x - elementsCenterX;\r\n      const dy = y - elementsCenterY;\r\n      const groupIdMap = new Map();\r\n      const [gridX, gridY] = getGridPoint(dx, dy, this.state.gridSize);\r\n      const oldIdToDuplicatedId = new Map();\r\n      const newElements = elements.map((element) => {\r\n        const newElement = duplicateElement(\r\n          this.state.editingGroupId,\r\n          groupIdMap,\r\n          element,\r\n          {\r\n            x: element.x + gridX - minX,\r\n            y: element.y + gridY - minY,\r\n          }\r\n        );\r\n        oldIdToDuplicatedId.set(element.id, newElement.id);\r\n        return newElement;\r\n      });\r\n      const nextElements = [\r\n        ...this.scene.getElementsIncludingDeleted(),\r\n        ...newElements,\r\n      ];\r\n      fixBindingsAfterDuplication(nextElements, elements, oldIdToDuplicatedId);\r\n      if (opts.files) {\r\n        this.files = { ...this.files, ...opts.files };\r\n      }\r\n      this.scene.replaceAllElements(nextElements);\r\n      this.history.resumeRecording();\r\n      this.setState(\r\n        selectGroupsForSelectedElements(\r\n          {\r\n            ...this.state,\r\n            isLibraryOpen: false,\r\n            selectedElementIds: newElements.reduce((map, element) => {\r\n              map[element.id] = true;\r\n              return map;\r\n            }, {}),\r\n            selectedGroupIds: {},\r\n          },\r\n          this.scene.getElements()\r\n        ),\r\n        () => {\r\n          if (opts.files) {\r\n            this.addNewImagesToImageCache();\r\n          }\r\n        }\r\n      );\r\n      this.selectShapeTool(\"selection\");\r\n    };\r\n    // Collaboration\r\n    this.setAppState = (obj) => {\r\n      this.setState(obj);\r\n    };\r\n    this.removePointer = (event) => {\r\n      // remove touch handler for context menu on touch devices\r\n      if (event.pointerType === \"touch\" && touchTimeout) {\r\n        clearTimeout(touchTimeout);\r\n        touchTimeout = 0;\r\n        invalidateContextMenu = false;\r\n      }\r\n      gesture.pointers.delete(event.pointerId);\r\n    };\r\n    this.toggleLock = () => {\r\n      this.setState((prevState) => {\r\n        return {\r\n          elementLocked: !prevState.elementLocked,\r\n          elementType: prevState.elementLocked\r\n            ? \"selection\"\r\n            : prevState.elementType,\r\n        };\r\n      });\r\n    };\r\n    this.toggleZenMode = () => {\r\n      this.actionManager.executeAction(actionToggleZenMode);\r\n    };\r\n    this.toggleStats = () => {\r\n      if (!this.state.showStats) {\r\n        trackEvent(\"dialog\", \"stats\");\r\n      }\r\n      this.actionManager.executeAction(actionToggleStats);\r\n    };\r\n    this.scrollToContent = (target = this.scene.getElements()) => {\r\n      this.setState({\r\n        ...calculateScrollCenter(\r\n          Array.isArray(target) ? target : [target],\r\n          this.state,\r\n          this.canvas\r\n        ),\r\n      });\r\n    };\r\n    this.clearToast = () => {\r\n      this.setState({ toastMessage: null });\r\n    };\r\n    this.setToastMessage = (toastMessage) => {\r\n      this.setState({ toastMessage });\r\n    };\r\n    this.restoreFileFromShare = async () => {\r\n      try {\r\n        const webShareTargetCache = await caches.open(\"web-share-target\");\r\n        const file = await webShareTargetCache.match(\"shared-file\");\r\n        if (file) {\r\n          const blob = await file.blob();\r\n          this.loadFileToCanvas(blob);\r\n          await webShareTargetCache.delete(\"shared-file\");\r\n          window.history.replaceState(null, APP_NAME, window.location.pathname);\r\n        }\r\n      } catch (error) {\r\n        this.setState({ errorMessage: error.message });\r\n      }\r\n    };\r\n    /** adds supplied files to existing files in the appState */\r\n    this.addFiles = withBatchedUpdates((files) => {\r\n      const filesMap = files.reduce((acc, fileData) => {\r\n        acc.set(fileData.id, fileData);\r\n        return acc;\r\n      }, new Map());\r\n      this.files = { ...this.files, ...Object.fromEntries(filesMap) };\r\n      // bump versions for elements that reference added files so that\r\n      // we/host apps can detect the change, and invalidate the image & shape\r\n      // cache\r\n      this.scene.getElements().forEach((element) => {\r\n        if (\r\n          isInitializedImageElement(element) &&\r\n          filesMap.has(element.fileId)\r\n        ) {\r\n          this.imageCache.delete(element.fileId);\r\n          invalidateShapeForElement(element);\r\n          bumpVersion(element);\r\n        }\r\n      });\r\n      this.scene.informMutation();\r\n      this.addNewImagesToImageCache();\r\n    });\r\n    this.updateScene = withBatchedUpdates((sceneData) => {\r\n      if (sceneData.commitToHistory) {\r\n        this.history.resumeRecording();\r\n      }\r\n      if (sceneData.appState) {\r\n        this.setState(sceneData.appState);\r\n      }\r\n      if (sceneData.elements) {\r\n        this.scene.replaceAllElements(sceneData.elements);\r\n      }\r\n      if (sceneData.collaborators) {\r\n        this.setState({ collaborators: sceneData.collaborators });\r\n      }\r\n    });\r\n    this.onSceneUpdated = () => {\r\n      this.setState({});\r\n    };\r\n    this.updateCurrentCursorPosition = withBatchedUpdates((event) => {\r\n      cursorX = event.clientX;\r\n      cursorY = event.clientY;\r\n    });\r\n    // Input handling\r\n    this.onKeyDown = withBatchedUpdates((event) => {\r\n      // normalize `event.key` when CapsLock is pressed #2372\r\n      if (\r\n        \"Proxy\" in window &&\r\n        ((!event.shiftKey && /^[A-Z]$/.test(event.key)) ||\r\n          (event.shiftKey && /^[a-z]$/.test(event.key)))\r\n      ) {\r\n        event = new Proxy(event, {\r\n          get(ev, prop) {\r\n            const value = ev[prop];\r\n            if (typeof value === \"function\") {\r\n              // fix for Proxies hijacking `this`\r\n              return value.bind(ev);\r\n            }\r\n            return prop === \"key\"\r\n              ? // CapsLock inverts capitalization based on ShiftKey, so invert\r\n                // it back\r\n                event.shiftKey\r\n                ? ev.key.toUpperCase()\r\n                : ev.key.toLowerCase()\r\n              : value;\r\n          },\r\n        });\r\n      }\r\n      if (\r\n        (isWritableElement(event.target) && event.key !== KEYS.ESCAPE) ||\r\n        // case: using arrows to move between buttons\r\n        (isArrowKey(event.key) && isInputLike(event.target))\r\n      ) {\r\n        return;\r\n      }\r\n      if (event.key === KEYS.QUESTION_MARK) {\r\n        this.setState({\r\n          showHelpDialog: true,\r\n        });\r\n      }\r\n      if (this.actionManager.handleKeyDown(event)) {\r\n        return;\r\n      }\r\n      if (this.state.viewModeEnabled) {\r\n        return;\r\n      }\r\n      if (event[KEYS.CTRL_OR_CMD] && this.state.isBindingEnabled) {\r\n        this.setState({ isBindingEnabled: false });\r\n      }\r\n      if (event.code === CODES.ZERO) {\r\n        this.setState({ isLibraryOpen: !this.state.isLibraryOpen });\r\n      }\r\n      if (isArrowKey(event.key)) {\r\n        const step =\r\n          (this.state.gridSize &&\r\n            (event.shiftKey\r\n              ? ELEMENT_TRANSLATE_AMOUNT\r\n              : this.state.gridSize)) ||\r\n          (event.shiftKey\r\n            ? ELEMENT_SHIFT_TRANSLATE_AMOUNT\r\n            : ELEMENT_TRANSLATE_AMOUNT);\r\n        const selectedElements = this.scene\r\n          .getElements()\r\n          .filter((element) => this.state.selectedElementIds[element.id]);\r\n        let offsetX = 0;\r\n        let offsetY = 0;\r\n        if (event.key === KEYS.ARROW_LEFT) {\r\n          offsetX = -step;\r\n        } else if (event.key === KEYS.ARROW_RIGHT) {\r\n          offsetX = step;\r\n        } else if (event.key === KEYS.ARROW_UP) {\r\n          offsetY = -step;\r\n        } else if (event.key === KEYS.ARROW_DOWN) {\r\n          offsetY = step;\r\n        }\r\n        selectedElements.forEach((element) => {\r\n          mutateElement(element, {\r\n            x: element.x + offsetX,\r\n            y: element.y + offsetY,\r\n          });\r\n          updateBoundElements(element, {\r\n            simultaneouslyUpdated: selectedElements,\r\n          });\r\n        });\r\n        this.maybeSuggestBindingForAll(selectedElements);\r\n        event.preventDefault();\r\n      } else if (event.key === KEYS.ENTER) {\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        if (\r\n          selectedElements.length === 1 &&\r\n          isLinearElement(selectedElements[0])\r\n        ) {\r\n          if (\r\n            !this.state.editingLinearElement ||\r\n            this.state.editingLinearElement.elementId !== selectedElements[0].id\r\n          ) {\r\n            this.history.resumeRecording();\r\n            this.setState({\r\n              editingLinearElement: new LinearElementEditor(\r\n                selectedElements[0],\r\n                this.scene\r\n              ),\r\n            });\r\n          }\r\n        } else if (\r\n          selectedElements.length === 1 &&\r\n          !isLinearElement(selectedElements[0])\r\n        ) {\r\n          const selectedElement = selectedElements[0];\r\n          this.startTextEditing({\r\n            sceneX: selectedElement.x + selectedElement.width / 2,\r\n            sceneY: selectedElement.y + selectedElement.height / 2,\r\n          });\r\n          event.preventDefault();\r\n          return;\r\n        }\r\n      } else if (\r\n        !event.ctrlKey &&\r\n        !event.altKey &&\r\n        !event.metaKey &&\r\n        this.state.draggingElement === null\r\n      ) {\r\n        const shape = findShapeByKey(event.key);\r\n        if (shape) {\r\n          this.selectShapeTool(shape);\r\n        } else if (event.key === KEYS.Q) {\r\n          this.toggleLock();\r\n        }\r\n      }\r\n      if (event.key === KEYS.SPACE && gesture.pointers.size === 0) {\r\n        isHoldingSpace = true;\r\n        setCursor(this.canvas, CURSOR_TYPE.GRABBING);\r\n      }\r\n      if (event.key === KEYS.G || event.key === KEYS.S) {\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        if (\r\n          this.state.elementType === \"selection\" &&\r\n          !selectedElements.length\r\n        ) {\r\n          return;\r\n        }\r\n        if (\r\n          event.key === KEYS.G &&\r\n          (hasBackground(this.state.elementType) ||\r\n            selectedElements.some((element) => hasBackground(element.type)))\r\n        ) {\r\n          this.setState({ openPopup: \"backgroundColorPicker\" });\r\n        }\r\n        if (event.key === KEYS.S) {\r\n          this.setState({ openPopup: \"strokeColorPicker\" });\r\n        }\r\n      }\r\n    });\r\n    this.onKeyUp = withBatchedUpdates((event) => {\r\n      if (event.key === KEYS.SPACE) {\r\n        if (this.state.viewModeEnabled) {\r\n          setCursor(this.canvas, CURSOR_TYPE.GRAB);\r\n        } else if (this.state.elementType === \"selection\") {\r\n          resetCursor(this.canvas);\r\n        } else {\r\n          setCursorForShape(this.canvas, this.state.elementType);\r\n          this.setState({\r\n            selectedElementIds: {},\r\n            selectedGroupIds: {},\r\n            editingGroupId: null,\r\n          });\r\n        }\r\n        isHoldingSpace = false;\r\n      }\r\n      if (!event[KEYS.CTRL_OR_CMD] && !this.state.isBindingEnabled) {\r\n        this.setState({ isBindingEnabled: true });\r\n      }\r\n      if (isArrowKey(event.key)) {\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        isBindingEnabled(this.state)\r\n          ? bindOrUnbindSelectedElements(selectedElements)\r\n          : unbindLinearElements(selectedElements);\r\n        this.setState({ suggestedBindings: [] });\r\n      }\r\n    });\r\n    this.onGestureStart = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      this.setState({\r\n        selectedElementIds: {},\r\n      });\r\n      gesture.initialScale = this.state.zoom.value;\r\n    });\r\n    this.onGestureChange = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      // onGestureChange only has zoom factor but not the center.\r\n      // If we're on iPad or iPhone, then we recognize multi-touch and will\r\n      // zoom in at the right location on the touchMove handler already.\r\n      // On Macbook, we don't have those events so will zoom in at the\r\n      // current location instead.\r\n      if (gesture.pointers.size === 2) {\r\n        return;\r\n      }\r\n      const initialScale = gesture.initialScale;\r\n      if (initialScale) {\r\n        this.setState(({ zoom, offsetLeft, offsetTop }) => ({\r\n          zoom: getNewZoom(\r\n            getNormalizedZoom(initialScale * event.scale),\r\n            zoom,\r\n            { left: offsetLeft, top: offsetTop },\r\n            { x: cursorX, y: cursorY }\r\n          ),\r\n        }));\r\n      }\r\n    });\r\n    this.onGestureEnd = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      this.setState({\r\n        previousSelectedElementIds: {},\r\n        selectedElementIds: this.state.previousSelectedElementIds,\r\n      });\r\n      gesture.initialScale = null;\r\n    });\r\n    this.startTextEditing = ({\r\n      sceneX,\r\n      sceneY,\r\n      insertAtParentCenter = true,\r\n    }) => {\r\n      const existingTextElement = this.getTextElementAtPosition(sceneX, sceneY);\r\n      const parentCenterPosition =\r\n        insertAtParentCenter &&\r\n        this.getTextWysiwygSnappedToCenterPosition(\r\n          sceneX,\r\n          sceneY,\r\n          this.state,\r\n          this.canvas,\r\n          window.devicePixelRatio\r\n        );\r\n      const element = existingTextElement\r\n        ? existingTextElement\r\n        : newTextElement({\r\n            x: parentCenterPosition\r\n              ? parentCenterPosition.elementCenterX\r\n              : sceneX,\r\n            y: parentCenterPosition\r\n              ? parentCenterPosition.elementCenterY\r\n              : sceneY,\r\n            strokeColor: this.state.currentItemStrokeColor,\r\n            backgroundColor: this.state.currentItemBackgroundColor,\r\n            fillStyle: this.state.currentItemFillStyle,\r\n            strokeWidth: this.state.currentItemStrokeWidth,\r\n            strokeStyle: this.state.currentItemStrokeStyle,\r\n            roughness: this.state.currentItemRoughness,\r\n            opacity: this.state.currentItemOpacity,\r\n            strokeSharpness: this.state.currentItemStrokeSharpness,\r\n            text: \"\",\r\n            fontSize: this.state.currentItemFontSize,\r\n            fontFamily: this.state.currentItemFontFamily,\r\n            textAlign: parentCenterPosition\r\n              ? \"center\"\r\n              : this.state.currentItemTextAlign,\r\n            verticalAlign: parentCenterPosition\r\n              ? \"middle\"\r\n              : DEFAULT_VERTICAL_ALIGN,\r\n          });\r\n      this.setState({ editingElement: element });\r\n      if (existingTextElement) {\r\n        // if text element is no longer centered to a container, reset\r\n        // verticalAlign to default because it's currently internal-only\r\n        if (!parentCenterPosition || element.textAlign !== \"center\") {\r\n          mutateElement(element, { verticalAlign: DEFAULT_VERTICAL_ALIGN });\r\n        }\r\n      } else {\r\n        this.scene.replaceAllElements([\r\n          ...this.scene.getElementsIncludingDeleted(),\r\n          element,\r\n        ]);\r\n        // case: creating new text not centered to parent elemenent → offset Y\r\n        // so that the text is centered to cursor position\r\n        if (!parentCenterPosition) {\r\n          mutateElement(element, {\r\n            y: element.y - element.baseline / 2,\r\n          });\r\n        }\r\n      }\r\n      this.setState({\r\n        editingElement: element,\r\n      });\r\n      this.handleTextWysiwyg(element, {\r\n        isExistingElement: !!existingTextElement,\r\n      });\r\n    };\r\n    this.handleCanvasDoubleClick = (event) => {\r\n      // case: double-clicking with arrow/line tool selected would both create\r\n      // text and enter multiElement mode\r\n      if (this.state.multiElement) {\r\n        return;\r\n      }\r\n      // we should only be able to double click when mode is selection\r\n      if (this.state.elementType !== \"selection\") {\r\n        return;\r\n      }\r\n      const selectedElements = getSelectedElements(\r\n        this.scene.getElements(),\r\n        this.state\r\n      );\r\n      if (\r\n        selectedElements.length === 1 &&\r\n        isLinearElement(selectedElements[0])\r\n      ) {\r\n        if (\r\n          !this.state.editingLinearElement ||\r\n          this.state.editingLinearElement.elementId !== selectedElements[0].id\r\n        ) {\r\n          this.history.resumeRecording();\r\n          this.setState({\r\n            editingLinearElement: new LinearElementEditor(\r\n              selectedElements[0],\r\n              this.scene\r\n            ),\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      resetCursor(this.canvas);\r\n      const { x: sceneX, y: sceneY } = viewportCoordsToSceneCoords(\r\n        event,\r\n        this.state\r\n      );\r\n      const selectedGroupIds = getSelectedGroupIds(this.state);\r\n      if (selectedGroupIds.length > 0) {\r\n        const hitElement = this.getElementAtPosition(sceneX, sceneY);\r\n        const selectedGroupId =\r\n          hitElement &&\r\n          getSelectedGroupIdForElement(hitElement, this.state.selectedGroupIds);\r\n        if (selectedGroupId) {\r\n          this.setState((prevState) =>\r\n            selectGroupsForSelectedElements(\r\n              {\r\n                ...prevState,\r\n                editingGroupId: selectedGroupId,\r\n                selectedElementIds: { [hitElement.id]: true },\r\n                selectedGroupIds: {},\r\n              },\r\n              this.scene.getElements()\r\n            )\r\n          );\r\n          return;\r\n        }\r\n      }\r\n      resetCursor(this.canvas);\r\n      if (!event[KEYS.CTRL_OR_CMD] && !this.state.viewModeEnabled) {\r\n        this.startTextEditing({\r\n          sceneX,\r\n          sceneY,\r\n          insertAtParentCenter: !event.altKey,\r\n        });\r\n      }\r\n    };\r\n    this.handleCanvasPointerMove = (event) => {\r\n      this.savePointer(event.clientX, event.clientY, this.state.cursorButton);\r\n      if (gesture.pointers.has(event.pointerId)) {\r\n        gesture.pointers.set(event.pointerId, {\r\n          x: event.clientX,\r\n          y: event.clientY,\r\n        });\r\n      }\r\n      const initialScale = gesture.initialScale;\r\n      if (\r\n        gesture.pointers.size === 2 &&\r\n        gesture.lastCenter &&\r\n        initialScale &&\r\n        gesture.initialDistance\r\n      ) {\r\n        const center = getCenter(gesture.pointers);\r\n        const deltaX = center.x - gesture.lastCenter.x;\r\n        const deltaY = center.y - gesture.lastCenter.y;\r\n        gesture.lastCenter = center;\r\n        const distance = getDistance(Array.from(gesture.pointers.values()));\r\n        const scaleFactor = distance / gesture.initialDistance;\r\n        this.setState(({ zoom, scrollX, scrollY, offsetLeft, offsetTop }) => ({\r\n          scrollX: scrollX + deltaX / zoom.value,\r\n          scrollY: scrollY + deltaY / zoom.value,\r\n          zoom: getNewZoom(\r\n            getNormalizedZoom(initialScale * scaleFactor),\r\n            zoom,\r\n            { left: offsetLeft, top: offsetTop },\r\n            center\r\n          ),\r\n          shouldCacheIgnoreZoom: true,\r\n        }));\r\n        this.resetShouldCacheIgnoreZoomDebounced();\r\n      } else {\r\n        gesture.lastCenter =\r\n          gesture.initialDistance =\r\n          gesture.initialScale =\r\n            null;\r\n      }\r\n      if (isHoldingSpace || isPanning || isDraggingScrollBar) {\r\n        return;\r\n      }\r\n      const isPointerOverScrollBars = isOverScrollBars(\r\n        currentScrollBars,\r\n        event.clientX - this.state.offsetLeft,\r\n        event.clientY - this.state.offsetTop\r\n      );\r\n      const isOverScrollBar = isPointerOverScrollBars.isOverEither;\r\n      if (!this.state.draggingElement && !this.state.multiElement) {\r\n        if (isOverScrollBar) {\r\n          resetCursor(this.canvas);\r\n        } else {\r\n          setCursorForShape(this.canvas, this.state.elementType);\r\n        }\r\n      }\r\n      const scenePointer = viewportCoordsToSceneCoords(event, this.state);\r\n      const { x: scenePointerX, y: scenePointerY } = scenePointer;\r\n      if (\r\n        this.state.editingLinearElement &&\r\n        !this.state.editingLinearElement.isDragging\r\n      ) {\r\n        const editingLinearElement = LinearElementEditor.handlePointerMove(\r\n          event,\r\n          scenePointerX,\r\n          scenePointerY,\r\n          this.state.editingLinearElement,\r\n          this.state.gridSize\r\n        );\r\n        if (editingLinearElement !== this.state.editingLinearElement) {\r\n          this.setState({ editingLinearElement });\r\n        }\r\n        if (editingLinearElement.lastUncommittedPoint != null) {\r\n          this.maybeSuggestBindingAtCursor(scenePointer);\r\n        } else {\r\n          this.setState({ suggestedBindings: [] });\r\n        }\r\n      }\r\n      if (isBindingElementType(this.state.elementType)) {\r\n        // Hovering with a selected tool or creating new linear element via click\r\n        // and point\r\n        const { draggingElement } = this.state;\r\n        if (isBindingElement(draggingElement)) {\r\n          this.maybeSuggestBindingForLinearElementAtCursor(\r\n            draggingElement,\r\n            \"end\",\r\n            scenePointer,\r\n            this.state.startBoundElement\r\n          );\r\n        } else {\r\n          this.maybeSuggestBindingAtCursor(scenePointer);\r\n        }\r\n      }\r\n      if (this.state.multiElement) {\r\n        const { multiElement } = this.state;\r\n        const { x: rx, y: ry } = multiElement;\r\n        const { points, lastCommittedPoint } = multiElement;\r\n        const lastPoint = points[points.length - 1];\r\n        setCursorForShape(this.canvas, this.state.elementType);\r\n        if (lastPoint === lastCommittedPoint) {\r\n          // if we haven't yet created a temp point and we're beyond commit-zone\r\n          // threshold, add a point\r\n          if (\r\n            distance2d(\r\n              scenePointerX - rx,\r\n              scenePointerY - ry,\r\n              lastPoint[0],\r\n              lastPoint[1]\r\n            ) >= LINE_CONFIRM_THRESHOLD\r\n          ) {\r\n            mutateElement(multiElement, {\r\n              points: [...points, [scenePointerX - rx, scenePointerY - ry]],\r\n            });\r\n          } else {\r\n            setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n            // in this branch, we're inside the commit zone, and no uncommitted\r\n            // point exists. Thus do nothing (don't add/remove points).\r\n          }\r\n        } else if (\r\n          points.length > 2 &&\r\n          lastCommittedPoint &&\r\n          distance2d(\r\n            scenePointerX - rx,\r\n            scenePointerY - ry,\r\n            lastCommittedPoint[0],\r\n            lastCommittedPoint[1]\r\n          ) < LINE_CONFIRM_THRESHOLD\r\n        ) {\r\n          setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n          mutateElement(multiElement, {\r\n            points: points.slice(0, -1),\r\n          });\r\n        } else {\r\n          if (isPathALoop(points, this.state.zoom.value)) {\r\n            setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n          }\r\n          // update last uncommitted point\r\n          mutateElement(multiElement, {\r\n            points: [\r\n              ...points.slice(0, -1),\r\n              [scenePointerX - rx, scenePointerY - ry],\r\n            ],\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      const hasDeselectedButton = Boolean(event.buttons);\r\n      if (\r\n        hasDeselectedButton ||\r\n        (this.state.elementType !== \"selection\" &&\r\n          this.state.elementType !== \"text\")\r\n      ) {\r\n        return;\r\n      }\r\n      const elements = this.scene.getElements();\r\n      const selectedElements = getSelectedElements(elements, this.state);\r\n      if (\r\n        selectedElements.length === 1 &&\r\n        !isOverScrollBar &&\r\n        !this.state.editingLinearElement\r\n      ) {\r\n        const elementWithTransformHandleType =\r\n          getElementWithTransformHandleType(\r\n            elements,\r\n            this.state,\r\n            scenePointerX,\r\n            scenePointerY,\r\n            this.state.zoom,\r\n            event.pointerType\r\n          );\r\n        if (\r\n          elementWithTransformHandleType &&\r\n          elementWithTransformHandleType.transformHandleType\r\n        ) {\r\n          setCursor(\r\n            this.canvas,\r\n            getCursorForResizingElement(elementWithTransformHandleType)\r\n          );\r\n          return;\r\n        }\r\n      } else if (selectedElements.length > 1 && !isOverScrollBar) {\r\n        const transformHandleType = getTransformHandleTypeFromCoords(\r\n          getCommonBounds(selectedElements),\r\n          scenePointerX,\r\n          scenePointerY,\r\n          this.state.zoom,\r\n          event.pointerType\r\n        );\r\n        if (transformHandleType) {\r\n          setCursor(\r\n            this.canvas,\r\n            getCursorForResizingElement({\r\n              transformHandleType,\r\n            })\r\n          );\r\n          return;\r\n        }\r\n      }\r\n      const hitElement = this.getElementAtPosition(\r\n        scenePointer.x,\r\n        scenePointer.y\r\n      );\r\n      if (this.state.elementType === \"text\") {\r\n        setCursor(\r\n          this.canvas,\r\n          isTextElement(hitElement) ? CURSOR_TYPE.TEXT : CURSOR_TYPE.CROSSHAIR\r\n        );\r\n      } else if (this.state.viewModeEnabled) {\r\n        setCursor(this.canvas, CURSOR_TYPE.GRAB);\r\n      } else if (isOverScrollBar) {\r\n        setCursor(this.canvas, CURSOR_TYPE.AUTO);\r\n      } else if (\r\n        // if using cmd/ctrl, we're not dragging\r\n        !event[KEYS.CTRL_OR_CMD] &&\r\n        (hitElement ||\r\n          this.isHittingCommonBoundingBoxOfSelectedElements(\r\n            scenePointer,\r\n            selectedElements\r\n          ))\r\n      ) {\r\n        setCursor(this.canvas, CURSOR_TYPE.MOVE);\r\n      } else {\r\n        setCursor(this.canvas, CURSOR_TYPE.AUTO);\r\n      }\r\n    };\r\n    // set touch moving for mobile context menu\r\n    this.handleTouchMove = (event) => {\r\n      invalidateContextMenu = true;\r\n    };\r\n    this.handleCanvasPointerDown = (event) => {\r\n      if(event.isTrusted === this.state.trusted){\r\n        console.log(this.state.trusted)\r\n              // remove any active selection when we start to interact with canvas\r\n      // (mainly, we care about removing selection outside the component which\r\n      //  would prevent our copy handling otherwise)\r\n      const selection = document.getSelection();\r\n      if (selection?.anchorNode) {\r\n        selection.removeAllRanges();\r\n      }\r\n      this.maybeOpenContextMenuAfterPointerDownOnTouchDevices(event);\r\n      this.maybeCleanupAfterMissingPointerUp(event);\r\n      if (isPanning) {\r\n        return;\r\n      }\r\n      this.setState({\r\n        lastPointerDownWith: event.pointerType,\r\n        cursorButton: \"down\",\r\n      });\r\n      this.savePointer(event.clientX, event.clientY, \"down\");\r\n      if (this.handleCanvasPanUsingWheelOrSpaceDrag(event)) {\r\n        return;\r\n      }\r\n      // only handle left mouse button or touch\r\n      if (\r\n        event.button !== POINTER_BUTTON.MAIN &&\r\n        event.button !== POINTER_BUTTON.TOUCH\r\n      ) {\r\n        return;\r\n      }\r\n      this.updateGestureOnPointerDown(event);\r\n      // don't select while panning\r\n      if (gesture.pointers.size > 1) {\r\n        return;\r\n      }\r\n      // State for the duration of a pointer interaction, which starts with a\r\n      // pointerDown event, ends with a pointerUp event (or another pointerDown)\r\n      const pointerDownState = this.initialPointerDownState(event);\r\n      if (this.handleDraggingScrollBar(event, pointerDownState)) {\r\n        return;\r\n      }\r\n      this.clearSelectionIfNotUsingSelection();\r\n      this.updateBindingEnabledOnPointerMove(event);\r\n      if (this.handleSelectionOnPointerDown(event, pointerDownState)) {\r\n        return;\r\n      }\r\n      if (this.state.elementType === \"text\") {\r\n        this.handleTextOnPointerDown(event, pointerDownState);\r\n        return;\r\n      } else if (\r\n        this.state.elementType === \"arrow\" ||\r\n        this.state.elementType === \"line\"\r\n      ) {\r\n        this.handleLinearElementOnPointerDown(\r\n          event,\r\n          this.state.elementType,\r\n          pointerDownState\r\n        );\r\n      } else if (this.state.elementType === \"image\") {\r\n        // reset image preview on pointerdown\r\n        setCursor(this.canvas, CURSOR_TYPE.CROSSHAIR);\r\n        if (!this.state.pendingImageElement) {\r\n          return;\r\n        }\r\n        this.setState({\r\n          draggingElement: this.state.pendingImageElement,\r\n          editingElement: this.state.pendingImageElement,\r\n          pendingImageElement: null,\r\n          multiElement: null,\r\n        });\r\n        const { x, y } = viewportCoordsToSceneCoords(event, this.state);\r\n        mutateElement(this.state.pendingImageElement, {\r\n          x,\r\n          y,\r\n        });\r\n      } else if (this.state.elementType === \"freedraw\") {\r\n        this.handleFreeDrawElementOnPointerDown(\r\n          event,\r\n          this.state.elementType,\r\n          pointerDownState\r\n        );\r\n      } else {\r\n        this.createGenericElementOnPointerDown(\r\n          this.state.elementType,\r\n          pointerDownState\r\n        );\r\n      }\r\n      const onPointerMove =\r\n        this.onPointerMoveFromPointerDownHandler(pointerDownState);\r\n      const onPointerUp =\r\n        this.onPointerUpFromPointerDownHandler(pointerDownState);\r\n      const onKeyDown = this.onKeyDownFromPointerDownHandler(pointerDownState);\r\n      const onKeyUp = this.onKeyUpFromPointerDownHandler(pointerDownState);\r\n      lastPointerUp = onPointerUp;\r\n      if (!this.state.viewModeEnabled) {\r\n        window.addEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n        window.addEventListener(EVENT.POINTER_UP, onPointerUp);\r\n        window.addEventListener(EVENT.KEYDOWN, onKeyDown);\r\n        window.addEventListener(EVENT.KEYUP, onKeyUp);\r\n        pointerDownState.eventListeners.onMove = onPointerMove;\r\n        pointerDownState.eventListeners.onUp = onPointerUp;\r\n        pointerDownState.eventListeners.onKeyUp = onKeyUp;\r\n        pointerDownState.eventListeners.onKeyDown = onKeyDown;\r\n      }\r\n      }\r\n    };\r\n    this.maybeOpenContextMenuAfterPointerDownOnTouchDevices = (event) => {\r\n      // deal with opening context menu on touch devices\r\n      if (event.pointerType === \"touch\") {\r\n        invalidateContextMenu = false;\r\n        if (touchTimeout) {\r\n          // If there's already a touchTimeout, this means that there's another\r\n          // touch down and we are doing another touch, so we shouldn't open the\r\n          // context menu.\r\n          invalidateContextMenu = true;\r\n        } else {\r\n          // open the context menu with the first touch's clientX and clientY\r\n          // if the touch is not moving\r\n          touchTimeout = window.setTimeout(() => {\r\n            touchTimeout = 0;\r\n            if (!invalidateContextMenu) {\r\n              this.handleCanvasContextMenu(event);\r\n            }\r\n          }, TOUCH_CTX_MENU_TIMEOUT);\r\n        }\r\n      }\r\n    };\r\n    // Returns whether the event is a panning\r\n    this.handleCanvasPanUsingWheelOrSpaceDrag = (event) => {\r\n      if (\r\n        !(\r\n          gesture.pointers.size === 0 &&\r\n          (event.button === POINTER_BUTTON.WHEEL ||\r\n            (event.button === POINTER_BUTTON.MAIN && isHoldingSpace) ||\r\n            this.state.viewModeEnabled)\r\n        )\r\n      ) {\r\n        return false;\r\n      }\r\n      isPanning = true;\r\n      let nextPastePrevented = false;\r\n      const isLinux = /Linux/.test(window.navigator.platform);\r\n      setCursor(this.canvas, CURSOR_TYPE.GRABBING);\r\n      let { clientX: lastX, clientY: lastY } = event;\r\n      const onPointerMove = withBatchedUpdates((event) => {\r\n        const deltaX = lastX - event.clientX;\r\n        const deltaY = lastY - event.clientY;\r\n        lastX = event.clientX;\r\n        lastY = event.clientY;\r\n        /*\r\n         * Prevent paste event if we move while middle clicking on Linux.\r\n         * See issue #1383.\r\n         */\r\n        if (\r\n          isLinux &&\r\n          !nextPastePrevented &&\r\n          (Math.abs(deltaX) > 1 || Math.abs(deltaY) > 1)\r\n        ) {\r\n          nextPastePrevented = true;\r\n          /* Prevent the next paste event */\r\n          const preventNextPaste = (event) => {\r\n            document.body.removeEventListener(EVENT.PASTE, preventNextPaste);\r\n            event.stopPropagation();\r\n          };\r\n          /*\r\n           * Reenable next paste in case of disabled middle click paste for\r\n           * any reason:\r\n           * - rigth click paste\r\n           * - empty clipboard\r\n           */\r\n          const enableNextPaste = () => {\r\n            setTimeout(() => {\r\n              document.body.removeEventListener(EVENT.PASTE, preventNextPaste);\r\n              window.removeEventListener(EVENT.POINTER_UP, enableNextPaste);\r\n            }, 100);\r\n          };\r\n          document.body.addEventListener(EVENT.PASTE, preventNextPaste);\r\n          window.addEventListener(EVENT.POINTER_UP, enableNextPaste);\r\n        }\r\n        this.setState({\r\n          scrollX: this.state.scrollX - deltaX / this.state.zoom.value,\r\n          scrollY: this.state.scrollY - deltaY / this.state.zoom.value,\r\n        });\r\n      });\r\n      const teardown = withBatchedUpdates(\r\n        (lastPointerUp = () => {\r\n          lastPointerUp = null;\r\n          isPanning = false;\r\n          if (!isHoldingSpace) {\r\n            if (this.state.viewModeEnabled) {\r\n              setCursor(this.canvas, CURSOR_TYPE.GRAB);\r\n            } else {\r\n              setCursorForShape(this.canvas, this.state.elementType);\r\n            }\r\n          }\r\n          this.setState({\r\n            cursorButton: \"up\",\r\n          });\r\n          this.savePointer(event.clientX, event.clientY, \"up\");\r\n          window.removeEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n          window.removeEventListener(EVENT.POINTER_UP, teardown);\r\n          window.removeEventListener(EVENT.BLUR, teardown);\r\n        })\r\n      );\r\n      window.addEventListener(EVENT.BLUR, teardown);\r\n      window.addEventListener(EVENT.POINTER_MOVE, onPointerMove, {\r\n        passive: true,\r\n      });\r\n      window.addEventListener(EVENT.POINTER_UP, teardown);\r\n      return true;\r\n    };\r\n    this.clearSelectionIfNotUsingSelection = () => {\r\n      if (this.state.elementType !== \"selection\") {\r\n        this.setState({\r\n          selectedElementIds: {},\r\n          selectedGroupIds: {},\r\n          editingGroupId: null,\r\n        });\r\n      }\r\n    };\r\n    /**\r\n     * @returns whether the pointer event has been completely handled\r\n     */\r\n    this.handleSelectionOnPointerDown = (event, pointerDownState) => {\r\n      if (this.state.elementType === \"selection\") {\r\n        const elements = this.scene.getElements();\r\n        const selectedElements = getSelectedElements(elements, this.state);\r\n        if (selectedElements.length === 1 && !this.state.editingLinearElement) {\r\n          const elementWithTransformHandleType =\r\n            getElementWithTransformHandleType(\r\n              elements,\r\n              this.state,\r\n              pointerDownState.origin.x,\r\n              pointerDownState.origin.y,\r\n              this.state.zoom,\r\n              event.pointerType\r\n            );\r\n          if (elementWithTransformHandleType != null) {\r\n            this.setState({\r\n              resizingElement: elementWithTransformHandleType.element,\r\n            });\r\n            pointerDownState.resize.handleType =\r\n              elementWithTransformHandleType.transformHandleType;\r\n          }\r\n        } else if (selectedElements.length > 1) {\r\n          pointerDownState.resize.handleType = getTransformHandleTypeFromCoords(\r\n            getCommonBounds(selectedElements),\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y,\r\n            this.state.zoom,\r\n            event.pointerType\r\n          );\r\n        }\r\n        if (pointerDownState.resize.handleType) {\r\n          setCursor(\r\n            this.canvas,\r\n            getCursorForResizingElement({\r\n              transformHandleType: pointerDownState.resize.handleType,\r\n            })\r\n          );\r\n          pointerDownState.resize.isResizing = true;\r\n          pointerDownState.resize.offset = tupleToCoors(\r\n            getResizeOffsetXY(\r\n              pointerDownState.resize.handleType,\r\n              selectedElements,\r\n              pointerDownState.origin.x,\r\n              pointerDownState.origin.y\r\n            )\r\n          );\r\n          if (\r\n            selectedElements.length === 1 &&\r\n            isLinearElement(selectedElements[0]) &&\r\n            selectedElements[0].points.length === 2\r\n          ) {\r\n            pointerDownState.resize.arrowDirection = getResizeArrowDirection(\r\n              pointerDownState.resize.handleType,\r\n              selectedElements[0]\r\n            );\r\n          }\r\n        } else {\r\n          if (this.state.editingLinearElement) {\r\n            const ret = LinearElementEditor.handlePointerDown(\r\n              event,\r\n              this.state,\r\n              (appState) => this.setState(appState),\r\n              this.history,\r\n              pointerDownState.origin\r\n            );\r\n            if (ret.hitElement) {\r\n              pointerDownState.hit.element = ret.hitElement;\r\n            }\r\n            if (ret.didAddPoint) {\r\n              return true;\r\n            }\r\n          }\r\n          // hitElement may already be set above, so check first\r\n          pointerDownState.hit.element =\r\n            pointerDownState.hit.element ??\r\n            this.getElementAtPosition(\r\n              pointerDownState.origin.x,\r\n              pointerDownState.origin.y\r\n            );\r\n          // For overlapped elements one position may hit\r\n          // multiple elements\r\n          pointerDownState.hit.allHitElements = this.getElementsAtPosition(\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          );\r\n          const hitElement = pointerDownState.hit.element;\r\n          const someHitElementIsSelected =\r\n            pointerDownState.hit.allHitElements.some((element) =>\r\n              this.isASelectedElement(element)\r\n            );\r\n          if (\r\n            (hitElement === null || !someHitElementIsSelected) &&\r\n            !event.shiftKey &&\r\n            !pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements\r\n          ) {\r\n            this.clearSelection(hitElement);\r\n          }\r\n          // If we click on something\r\n          if (hitElement != null) {\r\n            // on CMD/CTRL, drill down to hit element regardless of groups etc.\r\n            if (event[KEYS.CTRL_OR_CMD]) {\r\n              if (!this.state.selectedElementIds[hitElement.id]) {\r\n                pointerDownState.hit.wasAddedToSelection = true;\r\n              }\r\n              this.setState((prevState) => ({\r\n                ...editGroupForSelectedElement(prevState, hitElement),\r\n                previousSelectedElementIds: this.state.selectedElementIds,\r\n              }));\r\n              // mark as not completely handled so as to allow dragging etc.\r\n              return false;\r\n            }\r\n            // deselect if item is selected\r\n            // if shift is not clicked, this will always return true\r\n            // otherwise, it will trigger selection based on current\r\n            // state of the box\r\n            if (!this.state.selectedElementIds[hitElement.id]) {\r\n              // if we are currently editing a group, exiting editing mode and deselect the group.\r\n              if (\r\n                this.state.editingGroupId &&\r\n                !isElementInGroup(hitElement, this.state.editingGroupId)\r\n              ) {\r\n                this.setState({\r\n                  selectedElementIds: {},\r\n                  selectedGroupIds: {},\r\n                  editingGroupId: null,\r\n                });\r\n              }\r\n              // Add hit element to selection. At this point if we're not holding\r\n              // SHIFT the previously selected element(s) were deselected above\r\n              // (make sure you use setState updater to use latest state)\r\n              if (\r\n                !someHitElementIsSelected &&\r\n                !pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements\r\n              ) {\r\n                this.setState((prevState) => {\r\n                  return selectGroupsForSelectedElements(\r\n                    {\r\n                      ...prevState,\r\n                      selectedElementIds: {\r\n                        ...prevState.selectedElementIds,\r\n                        [hitElement.id]: true,\r\n                      },\r\n                    },\r\n                    this.scene.getElements()\r\n                  );\r\n                });\r\n                pointerDownState.hit.wasAddedToSelection = true;\r\n              }\r\n            }\r\n          }\r\n          this.setState({\r\n            previousSelectedElementIds: this.state.selectedElementIds,\r\n          });\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n\r\n    this.handleTextOnPointerDown = (event, pointerDownState) => {\r\n      // if we're currently still editing text, clicking outside\r\n      // should only finalize it, not create another (irrespective\r\n      // of state.elementLocked)\r\n      if (this.state.editingElement?.type === \"text\") {\r\n        return;\r\n      }\r\n      this.startTextEditing({\r\n        sceneX: pointerDownState.origin.x,\r\n        sceneY: pointerDownState.origin.y,\r\n        insertAtParentCenter: !event.altKey,\r\n      });\r\n      resetCursor(this.canvas);\r\n      if (!this.state.elementLocked) {\r\n        this.setState({\r\n          elementType: \"selection\",\r\n        });\r\n      }\r\n    };\r\n\r\n    this.handleFreeDrawElementOnPointerDown = (\r\n      event,\r\n      elementType,\r\n      pointerDownState\r\n    ) => {\r\n      // Begin a mark capture. This does not have to update state yet.\r\n      const [gridX, gridY] = getGridPoint(\r\n        pointerDownState.origin.x,\r\n        pointerDownState.origin.y,\r\n        null\r\n      );\r\n      const element = newFreeDrawElement({\r\n        type: elementType,\r\n        x: gridX,\r\n        y: gridY,\r\n        strokeColor: this.state.currentItemStrokeColor,\r\n        backgroundColor: this.state.currentItemBackgroundColor,\r\n        fillStyle: this.state.currentItemFillStyle,\r\n        strokeWidth: this.state.currentItemStrokeWidth,\r\n        strokeStyle: this.state.currentItemStrokeStyle,\r\n        roughness: this.state.currentItemRoughness,\r\n        opacity: this.state.currentItemOpacity,\r\n        strokeSharpness: this.state.currentItemLinearStrokeSharpness,\r\n        simulatePressure: event.pressure === 0.5,\r\n      });\r\n      this.setState((prevState) => ({\r\n        selectedElementIds: {\r\n          ...prevState.selectedElementIds,\r\n          [element.id]: false,\r\n        },\r\n      }));\r\n      const pressures = element.simulatePressure\r\n        ? element.pressures\r\n        : [...element.pressures, event.pressure];\r\n      mutateElement(element, {\r\n        points: [[0, 0]],\r\n        pressures,\r\n      });\r\n      const boundElement = getHoveredElementForBinding(\r\n        pointerDownState.origin,\r\n        this.scene\r\n      );\r\n      this.scene.replaceAllElements([\r\n        ...this.scene.getElementsIncludingDeleted(),\r\n        element,\r\n      ]);\r\n      this.setState({\r\n        draggingElement: element,\r\n        editingElement: element,\r\n        startBoundElement: boundElement,\r\n        suggestedBindings: [],\r\n      });\r\n    };\r\n\r\n    this.createImageElement = ({ sceneX, sceneY }) => {\r\n      const [gridX, gridY] = getGridPoint(sceneX, sceneY, this.state.gridSize);\r\n      const element = newImageElement({\r\n        type: \"image\",\r\n        x: gridX,\r\n        y: gridY,\r\n        strokeColor: this.state.currentItemStrokeColor,\r\n        backgroundColor: this.state.currentItemBackgroundColor,\r\n        fillStyle: this.state.currentItemFillStyle,\r\n        strokeWidth: this.state.currentItemStrokeWidth,\r\n        strokeStyle: this.state.currentItemStrokeStyle,\r\n        roughness: this.state.currentItemRoughness,\r\n        opacity: this.state.currentItemOpacity,\r\n        strokeSharpness: this.state.currentItemLinearStrokeSharpness,\r\n      });\r\n      return element;\r\n    };\r\n\r\n    this.handleLinearElementOnPointerDown = (\r\n      event,\r\n      elementType,\r\n      pointerDownState\r\n    ) => {\r\n      if (this.state.multiElement) {\r\n        const { multiElement } = this.state;\r\n        // finalize if completing a loop\r\n        if (\r\n          multiElement.type === \"line\" &&\r\n          isPathALoop(multiElement.points, this.state.zoom.value)\r\n        ) {\r\n          mutateElement(multiElement, {\r\n            lastCommittedPoint:\r\n              multiElement.points[multiElement.points.length - 1],\r\n          });\r\n          this.actionManager.executeAction(actionFinalize);\r\n          return;\r\n        }\r\n        const { x: rx, y: ry, lastCommittedPoint } = multiElement;\r\n        // clicking inside commit zone → finalize arrow\r\n        if (\r\n          multiElement.points.length > 1 &&\r\n          lastCommittedPoint &&\r\n          distance2d(\r\n            pointerDownState.origin.x - rx,\r\n            pointerDownState.origin.y - ry,\r\n            lastCommittedPoint[0],\r\n            lastCommittedPoint[1]\r\n          ) < LINE_CONFIRM_THRESHOLD\r\n        ) {\r\n          this.actionManager.executeAction(actionFinalize);\r\n          return;\r\n        }\r\n        this.setState((prevState) => ({\r\n          selectedElementIds: {\r\n            ...prevState.selectedElementIds,\r\n            [multiElement.id]: true,\r\n          },\r\n        }));\r\n        // clicking outside commit zone → update reference for last committed\r\n        // point\r\n        mutateElement(multiElement, {\r\n          lastCommittedPoint:\r\n            multiElement.points[multiElement.points.length - 1],\r\n        });\r\n        setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n      } else {\r\n        const [gridX, gridY] = getGridPoint(\r\n          pointerDownState.origin.x,\r\n          pointerDownState.origin.y,\r\n          this.state.gridSize\r\n        );\r\n        /* If arrow is pre-arrowheads, it will have undefined for both start and end arrowheads.\r\n                If so, we want it to be null for start and \"arrow\" for end. If the linear item is not\r\n                an arrow, we want it to be null for both. Otherwise, we want it to use the\r\n                values from appState. */\r\n        const { currentItemStartArrowhead, currentItemEndArrowhead } =\r\n          this.state;\r\n        const [startArrowhead, endArrowhead] =\r\n          elementType === \"arrow\"\r\n            ? [currentItemStartArrowhead, currentItemEndArrowhead]\r\n            : [null, null];\r\n        const element = newLinearElement({\r\n          type: elementType,\r\n          x: gridX,\r\n          y: gridY,\r\n          strokeColor: this.state.currentItemStrokeColor,\r\n          backgroundColor: this.state.currentItemBackgroundColor,\r\n          fillStyle: this.state.currentItemFillStyle,\r\n          strokeWidth: this.state.currentItemStrokeWidth,\r\n          strokeStyle: this.state.currentItemStrokeStyle,\r\n          roughness: this.state.currentItemRoughness,\r\n          opacity: this.state.currentItemOpacity,\r\n          strokeSharpness: this.state.currentItemLinearStrokeSharpness,\r\n          startArrowhead,\r\n          endArrowhead,\r\n        });\r\n        this.setState((prevState) => ({\r\n          selectedElementIds: {\r\n            ...prevState.selectedElementIds,\r\n            [element.id]: false,\r\n          },\r\n        }));\r\n        mutateElement(element, {\r\n          points: [...element.points, [0, 0]],\r\n        });\r\n        const boundElement = getHoveredElementForBinding(\r\n          pointerDownState.origin,\r\n          this.scene\r\n        );\r\n        this.scene.replaceAllElements([\r\n          ...this.scene.getElementsIncludingDeleted(),\r\n          element,\r\n        ]);\r\n        this.setState({\r\n          draggingElement: element,\r\n          editingElement: element,\r\n          startBoundElement: boundElement,\r\n          suggestedBindings: [],\r\n        });\r\n      }\r\n    };\r\n\r\n    this.createGenericElementOnPointerDown = (\r\n      elementType,\r\n      pointerDownState\r\n    ) => {\r\n      const [gridX, gridY] = getGridPoint(\r\n        pointerDownState.origin.x,\r\n        pointerDownState.origin.y,\r\n        this.state.gridSize\r\n      );\r\n      const element = newElement({\r\n        type: elementType,\r\n        x: gridX,\r\n        y: gridY,\r\n        strokeColor: this.state.currentItemStrokeColor,\r\n        backgroundColor: this.state.currentItemBackgroundColor,\r\n        fillStyle: this.state.currentItemFillStyle,\r\n        strokeWidth: this.state.currentItemStrokeWidth,\r\n        strokeStyle: this.state.currentItemStrokeStyle,\r\n        roughness: this.state.currentItemRoughness,\r\n        opacity: this.state.currentItemOpacity,\r\n        strokeSharpness: this.state.currentItemStrokeSharpness,\r\n      });\r\n      if (element.type === \"selection\") {\r\n        this.setState({\r\n          selectionElement: element,\r\n          draggingElement: element,\r\n        });\r\n      } else {\r\n        this.scene.replaceAllElements([\r\n          ...this.scene.getElementsIncludingDeleted(),\r\n          element,\r\n        ]);\r\n        this.setState({\r\n          multiElement: null,\r\n          draggingElement: element,\r\n          editingElement: element,\r\n        });\r\n      }\r\n    };\r\n\r\n    this.initializeImage = async ({\r\n      imageFile,\r\n      imageElement: _imageElement,\r\n      showCursorImagePreview = false,\r\n    }) => {\r\n      // at this point this should be guaranteed image file, but we do this check\r\n      // to satisfy TS down the line\r\n      if (!isSupportedImageFile(imageFile)) {\r\n        throw new Error(t(\"errors.unsupportedFileType\"));\r\n      }\r\n      const mimeType = imageFile.type;\r\n      setCursor(this.canvas, \"wait\");\r\n      if (mimeType === MIME_TYPES.svg) {\r\n        try {\r\n          imageFile = SVGStringToFile(\r\n            await normalizeSVG(await imageFile.text()),\r\n            imageFile.name\r\n          );\r\n        } catch (error) {\r\n          console.warn(error);\r\n          throw new Error(t(\"errors.svgImageInsertError\"));\r\n        }\r\n      }\r\n      // generate image id (by default the file digest) before any\r\n      // resizing/compression takes place to keep it more portable\r\n      const fileId = await (this.props.generateIdForFile?.(imageFile) ||\r\n        generateIdFromFile(imageFile));\r\n      if (!fileId) {\r\n        console.warn(\r\n          \"Couldn't generate file id or the supplied `generateIdForFile` didn't resolve to one.\"\r\n        );\r\n        throw new Error(t(\"errors.imageInsertError\"));\r\n      }\r\n      const existingFileData = this.files[fileId];\r\n      if (!existingFileData?.dataURL) {\r\n        try {\r\n          imageFile = await resizeImageFile(\r\n            imageFile,\r\n            DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT\r\n          );\r\n        } catch (error) {\r\n          console.error(\r\n            \"error trying to resing image file on insertion\",\r\n            error\r\n          );\r\n        }\r\n        if (imageFile.size > MAX_ALLOWED_FILE_BYTES) {\r\n          throw new Error(\r\n            t(\"errors.fileTooBig\", {\r\n              maxSize: `${Math.trunc(MAX_ALLOWED_FILE_BYTES / 1024 / 1024)}MB`,\r\n            })\r\n          );\r\n        }\r\n      }\r\n      if (showCursorImagePreview) {\r\n        const dataURL = this.files[fileId]?.dataURL;\r\n        // optimization so that we don't unnecessarily resize the original\r\n        // full-size file for cursor preview\r\n        // (it's much faster to convert the resized dataURL to File)\r\n        const resizedFile = dataURL && dataURLToFile(dataURL);\r\n        this.setImagePreviewCursor(resizedFile || imageFile);\r\n      }\r\n      const dataURL =\r\n        this.files[fileId]?.dataURL || (await getDataURL(imageFile));\r\n      const imageElement = mutateElement(\r\n        _imageElement,\r\n        {\r\n          fileId,\r\n        },\r\n        false\r\n      );\r\n      return new Promise(async (resolve, reject) => {\r\n        try {\r\n          this.files = {\r\n            ...this.files,\r\n            [fileId]: {\r\n              mimeType,\r\n              id: fileId,\r\n              dataURL,\r\n              created: Date.now(),\r\n            },\r\n          };\r\n          const cachedImageData = this.imageCache.get(fileId);\r\n          if (!cachedImageData) {\r\n            this.addNewImagesToImageCache();\r\n            await this.updateImageCache([imageElement]);\r\n          }\r\n          if (cachedImageData?.image instanceof Promise) {\r\n            await cachedImageData.image;\r\n          }\r\n          if (\r\n            this.state.pendingImageElement?.id !== imageElement.id &&\r\n            this.state.draggingElement?.id !== imageElement.id\r\n          ) {\r\n            this.initializeImageDimensions(imageElement, true);\r\n          }\r\n          resolve(imageElement);\r\n        } catch (error) {\r\n          console.error(error);\r\n          reject(new Error(t(\"errors.imageInsertError\")));\r\n        } finally {\r\n          if (!showCursorImagePreview) {\r\n            resetCursor(this.canvas);\r\n          }\r\n        }\r\n      });\r\n    };\r\n    /**\r\n     * inserts image into elements array and rerenders\r\n     */\r\n    this.insertImageElement = async (\r\n      imageElement,\r\n      imageFile,\r\n      showCursorImagePreview\r\n    ) => {\r\n      this.scene.replaceAllElements([\r\n        ...this.scene.getElementsIncludingDeleted(),\r\n        imageElement,\r\n      ]);\r\n      try {\r\n        await this.initializeImage({\r\n          imageFile,\r\n          imageElement,\r\n          showCursorImagePreview,\r\n        });\r\n      } catch (error) {\r\n        mutateElement(imageElement, {\r\n          isDeleted: true,\r\n        });\r\n        this.actionManager.executeAction(actionFinalize);\r\n        this.setState({\r\n          errorMessage: error.message || t(\"errors.imageInsertError\"),\r\n        });\r\n      }\r\n    };\r\n    this.setImagePreviewCursor = async (imageFile) => {\r\n      // mustn't be larger than 128 px\r\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Basic_User_Interface/Using_URL_values_for_the_cursor_property\r\n      const cursorImageSizePx = 96;\r\n      const imagePreview = await resizeImageFile(imageFile, cursorImageSizePx);\r\n      let previewDataURL = await getDataURL(imagePreview);\r\n      // SVG cannot be resized via `resizeImageFile` so we resize by rendering to\r\n      // a small canvas\r\n      if (imageFile.type === MIME_TYPES.svg) {\r\n        const img = await loadHTMLImageElement(previewDataURL);\r\n        let height = Math.min(img.height, cursorImageSizePx);\r\n        let width = height * (img.width / img.height);\r\n        if (width > cursorImageSizePx) {\r\n          width = cursorImageSizePx;\r\n          height = width * (img.height / img.width);\r\n        }\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.height = height;\r\n        canvas.width = width;\r\n        const context = canvas.getContext(\"2d\");\r\n        context.drawImage(img, 0, 0, width, height);\r\n        previewDataURL = canvas.toDataURL(MIME_TYPES.svg);\r\n      }\r\n      if (this.state.pendingImageElement) {\r\n        setCursor(this.canvas, `url(${previewDataURL}) 4 4, auto`);\r\n      }\r\n    };\r\n    this.onImageAction = async (\r\n      { insertOnCanvasDirectly } = { insertOnCanvasDirectly: false }\r\n    ) => {\r\n      try {\r\n        const clientX = this.state.width / 2 + this.state.offsetLeft;\r\n        const clientY = this.state.height / 2 + this.state.offsetTop;\r\n        const { x, y } = viewportCoordsToSceneCoords(\r\n          { clientX, clientY },\r\n          this.state\r\n        );\r\n        const imageFile = await fileOpen({\r\n          description: \"Image\",\r\n          extensions: [\"jpg\", \"png\", \"svg\", \"gif\"],\r\n        });\r\n        const imageElement = this.createImageElement({\r\n          sceneX: x,\r\n          sceneY: y,\r\n        });\r\n        if (insertOnCanvasDirectly) {\r\n          this.insertImageElement(imageElement, imageFile);\r\n          this.initializeImageDimensions(imageElement);\r\n          this.setState(\r\n            {\r\n              selectedElementIds: { [imageElement.id]: true },\r\n            },\r\n            () => {\r\n              this.actionManager.executeAction(actionFinalize);\r\n            }\r\n          );\r\n        } else {\r\n          this.setState(\r\n            {\r\n              pendingImageElement: imageElement,\r\n            },\r\n            () => {\r\n              this.insertImageElement(\r\n                imageElement,\r\n                imageFile,\r\n                /* showCursorImagePreview */ true\r\n              );\r\n            }\r\n          );\r\n        }\r\n      } catch (error) {\r\n        if (error.name !== \"AbortError\") {\r\n          console.error(error);\r\n        }\r\n        this.setState(\r\n          {\r\n            pendingImageElement: null,\r\n            editingElement: null,\r\n            elementType: \"selection\",\r\n          },\r\n          () => {\r\n            this.actionManager.executeAction(actionFinalize);\r\n          }\r\n        );\r\n      }\r\n    };\r\n    this.initializeImageDimensions = (\r\n      imageElement,\r\n      forceNaturalSize = false\r\n    ) => {\r\n      const image =\r\n        isInitializedImageElement(imageElement) &&\r\n        this.imageCache.get(imageElement.fileId)?.image;\r\n      if (!image || image instanceof Promise) {\r\n        if (\r\n          imageElement.width < DRAGGING_THRESHOLD / this.state.zoom.value &&\r\n          imageElement.height < DRAGGING_THRESHOLD / this.state.zoom.value\r\n        ) {\r\n          const placeholderSize = 100 / this.state.zoom.value;\r\n          mutateElement(imageElement, {\r\n            x: imageElement.x - placeholderSize / 2,\r\n            y: imageElement.y - placeholderSize / 2,\r\n            width: placeholderSize,\r\n            height: placeholderSize,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        forceNaturalSize ||\r\n        // if user-created bounding box is below threshold, assume the\r\n        // intention was to click instead of drag, and use the image's\r\n        // intrinsic size\r\n        (imageElement.width < DRAGGING_THRESHOLD / this.state.zoom.value &&\r\n          imageElement.height < DRAGGING_THRESHOLD / this.state.zoom.value)\r\n      ) {\r\n        const minHeight = Math.max(this.state.height - 120, 160);\r\n        // max 65% of canvas height, clamped to <300px, vh - 120px>\r\n        const maxHeight = Math.min(\r\n          minHeight,\r\n          Math.floor(this.state.height * 0.5) / this.state.zoom.value\r\n        );\r\n        const height = Math.min(image.naturalHeight, maxHeight);\r\n        const width = height * (image.naturalWidth / image.naturalHeight);\r\n        // add current imageElement width/height to account for previous centering\r\n        // of the placholder image\r\n        const x = imageElement.x + imageElement.width / 2 - width / 2;\r\n        const y = imageElement.y + imageElement.height / 2 - height / 2;\r\n        mutateElement(imageElement, { x, y, width, height });\r\n      }\r\n    };\r\n    /** updates image cache, refreshing updated elements and/or setting status\r\n            to error for images that fail during <img> element creation */\r\n    this.updateImageCache = async (elements, files = this.files) => {\r\n      const { updatedFiles, erroredFiles } = await _updateImageCache({\r\n        imageCache: this.imageCache,\r\n        fileIds: elements.map((element) => element.fileId),\r\n        files,\r\n      });\r\n      if (updatedFiles.size || erroredFiles.size) {\r\n        for (const element of elements) {\r\n          if (updatedFiles.has(element.fileId)) {\r\n            invalidateShapeForElement(element);\r\n          }\r\n        }\r\n      }\r\n      if (erroredFiles.size) {\r\n        this.scene.replaceAllElements(\r\n          this.scene.getElementsIncludingDeleted().map((element) => {\r\n            if (\r\n              isInitializedImageElement(element) &&\r\n              erroredFiles.has(element.fileId)\r\n            ) {\r\n              return newElementWith(element, {\r\n                status: \"error\",\r\n              });\r\n            }\r\n            return element;\r\n          })\r\n        );\r\n      }\r\n      return { updatedFiles, erroredFiles };\r\n    };\r\n    /** adds new images to imageCache and re-renders if needed */\r\n    this.addNewImagesToImageCache = async (\r\n      imageElements = getInitializedImageElements(this.scene.getElements()),\r\n      files = this.files\r\n    ) => {\r\n      const uncachedImageElements = imageElements.filter(\r\n        (element) => !element.isDeleted && !this.imageCache.has(element.fileId)\r\n      );\r\n      if (uncachedImageElements.length) {\r\n        const { updatedFiles } = await this.updateImageCache(\r\n          uncachedImageElements,\r\n          files\r\n        );\r\n        if (updatedFiles.size) {\r\n          this.scene.informMutation();\r\n        }\r\n      }\r\n    };\r\n    /** generally you should use `addNewImagesToImageCache()` directly if you need\r\n     *  to render new images. This is just a failsafe  */\r\n    this.scheduleImageRefresh = throttle(() => {\r\n      this.addNewImagesToImageCache();\r\n    }, IMAGE_RENDER_TIMEOUT);\r\n    this.updateBindingEnabledOnPointerMove = (event) => {\r\n      const shouldEnableBinding = shouldEnableBindingForPointerEvent(event);\r\n      if (this.state.isBindingEnabled !== shouldEnableBinding) {\r\n        this.setState({ isBindingEnabled: shouldEnableBinding });\r\n      }\r\n    };\r\n    this.maybeSuggestBindingAtCursor = (pointerCoords) => {\r\n      const hoveredBindableElement = getHoveredElementForBinding(\r\n        pointerCoords,\r\n        this.scene\r\n      );\r\n      this.setState({\r\n        suggestedBindings:\r\n          hoveredBindableElement != null ? [hoveredBindableElement] : [],\r\n      });\r\n    };\r\n    this.maybeSuggestBindingForLinearElementAtCursor = (\r\n      linearElement,\r\n      startOrEnd,\r\n      pointerCoords,\r\n      // During line creation the start binding hasn't been written yet\r\n      // into `linearElement`\r\n      oppositeBindingBoundElement\r\n    ) => {\r\n      const hoveredBindableElement = getHoveredElementForBinding(\r\n        pointerCoords,\r\n        this.scene\r\n      );\r\n      this.setState({\r\n        suggestedBindings:\r\n          hoveredBindableElement != null &&\r\n          !isLinearElementSimpleAndAlreadyBound(\r\n            linearElement,\r\n            oppositeBindingBoundElement?.id,\r\n            hoveredBindableElement\r\n          )\r\n            ? [hoveredBindableElement]\r\n            : [],\r\n      });\r\n    };\r\n    this.handleCanvasRef = (canvas) => {\r\n      // canvas is null when unmounting\r\n      if (canvas !== null) {\r\n        this.canvas = canvas;\r\n        this.rc = rough.canvas(this.canvas);\r\n        this.canvas.addEventListener(EVENT.WHEEL, this.handleWheel, {\r\n          passive: false,\r\n        });\r\n        this.canvas.addEventListener(EVENT.TOUCH_START, this.onTapStart);\r\n        this.canvas.addEventListener(EVENT.TOUCH_END, this.onTapEnd);\r\n      } else {\r\n        this.canvas?.removeEventListener(EVENT.WHEEL, this.handleWheel);\r\n        this.canvas?.removeEventListener(EVENT.TOUCH_START, this.onTapStart);\r\n        this.canvas?.removeEventListener(EVENT.TOUCH_END, this.onTapEnd);\r\n      }\r\n    };\r\n    this.handleAppOnDrop = async (event) => {\r\n      try {\r\n        const file = event.dataTransfer.files[0];\r\n        if (isSupportedImageFile(file)) {\r\n          // first attempt to decode scene from the image if it's embedded\r\n          // ---------------------------------------------------------------------\r\n          if (file?.type === MIME_TYPES.png || file?.type === MIME_TYPES.svg) {\r\n            try {\r\n              if (nativeFileSystemSupported) {\r\n                try {\r\n                  // This will only work as of Chrome 86,\r\n                  // but can be safely ignored on older releases.\r\n                  const item = event.dataTransfer.items[0];\r\n                  file.handle = await item.getAsFileSystemHandle();\r\n                } catch (error) {\r\n                  console.warn(error.name, error.message);\r\n                }\r\n              }\r\n              const scene = await loadFromBlob(\r\n                file,\r\n                this.state,\r\n                this.scene.getElementsIncludingDeleted()\r\n              );\r\n              this.syncActionResult({\r\n                ...scene,\r\n                appState: {\r\n                  ...(scene.appState || this.state),\r\n                  isLoading: false,\r\n                },\r\n                replaceFiles: true,\r\n                commitToHistory: true,\r\n              });\r\n              return;\r\n            } catch (error) {\r\n              if (error.name !== \"EncodingError\") {\r\n                throw error;\r\n              }\r\n            }\r\n          }\r\n          // if no scene is embedded or we fail for whatever reason, fall back\r\n          // to importing as regular image\r\n          // ---------------------------------------------------------------------\r\n          const { x: sceneX, y: sceneY } = viewportCoordsToSceneCoords(\r\n            event,\r\n            this.state\r\n          );\r\n          const imageElement = this.createImageElement({ sceneX, sceneY });\r\n          this.insertImageElement(imageElement, file);\r\n          this.initializeImageDimensions(imageElement);\r\n          this.setState({ selectedElementIds: { [imageElement.id]: true } });\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        return this.setState({\r\n          isLoading: false,\r\n          errorMessage: error.message,\r\n        });\r\n      }\r\n      const libraryShapes = event.dataTransfer.getData(\r\n        MIME_TYPES.excalidrawlib\r\n      );\r\n      if (libraryShapes !== \"\") {\r\n        this.addElementsFromPasteOrLibrary({\r\n          elements: JSON.parse(libraryShapes),\r\n          position: event,\r\n          files: null,\r\n        });\r\n        return;\r\n      }\r\n      const file = event.dataTransfer?.files[0];\r\n      if (\r\n        file?.type === MIME_TYPES.excalidrawlib ||\r\n        file?.name?.endsWith(\".excalidrawlib\")\r\n      ) {\r\n        this.library\r\n          .importLibrary(file)\r\n          .then(() => {\r\n            // Close and then open to get the libraries updated\r\n            this.setState({ isLibraryOpen: false });\r\n            this.setState({ isLibraryOpen: true });\r\n          })\r\n          .catch((error) =>\r\n            this.setState({ isLoading: false, errorMessage: error.message })\r\n          );\r\n        // default: assume an Excalidraw file regardless of extension/MimeType\r\n      } else {\r\n        this.setState({ isLoading: true });\r\n        if (nativeFileSystemSupported) {\r\n          try {\r\n            // This will only work as of Chrome 86,\r\n            // but can be safely ignored on older releases.\r\n            const item = event.dataTransfer.items[0];\r\n            file.handle = await item.getAsFileSystemHandle();\r\n          } catch (error) {\r\n            console.warn(error.name, error.message);\r\n          }\r\n        }\r\n        await this.loadFileToCanvas(file);\r\n      }\r\n    };\r\n    this.loadFileToCanvas = (file) => {\r\n      loadFromBlob(file, this.state, this.scene.getElementsIncludingDeleted())\r\n        .then((scene) => {\r\n          this.syncActionResult({\r\n            ...scene,\r\n            appState: {\r\n              ...(scene.appState || this.state),\r\n              isLoading: false,\r\n            },\r\n            replaceFiles: true,\r\n            commitToHistory: true,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          this.setState({ isLoading: false, errorMessage: error.message });\r\n        });\r\n    };\r\n    this.handleCanvasContextMenu = (event) => {\r\n      event.preventDefault();\r\n      const { x, y } = viewportCoordsToSceneCoords(event, this.state);\r\n      const element = this.getElementAtPosition(x, y, { preferSelected: true });\r\n      const type = element ? \"element\" : \"canvas\";\r\n      const container = this.excalidrawContainerRef.current;\r\n      const { top: offsetTop, left: offsetLeft } =\r\n        container.getBoundingClientRect();\r\n      const left = event.clientX - offsetLeft;\r\n      const top = event.clientY - offsetTop;\r\n      if (element && !this.state.selectedElementIds[element.id]) {\r\n        this.setState({ selectedElementIds: { [element.id]: true } }, () => {\r\n          this._openContextMenu({ top, left }, type);\r\n        });\r\n      } else {\r\n        this._openContextMenu({ top, left }, type);\r\n      }\r\n    };\r\n    this.maybeDragNewGenericElement = (pointerDownState, event) => {\r\n      const draggingElement = this.state.draggingElement;\r\n      const pointerCoords = pointerDownState.lastCoords;\r\n      if (!draggingElement) {\r\n        return;\r\n      }\r\n      if (draggingElement.type === \"selection\") {\r\n        dragNewElement(\r\n          draggingElement,\r\n          this.state.elementType,\r\n          pointerDownState.origin.x,\r\n          pointerDownState.origin.y,\r\n          pointerCoords.x,\r\n          pointerCoords.y,\r\n          distance(pointerDownState.origin.x, pointerCoords.x),\r\n          distance(pointerDownState.origin.y, pointerCoords.y),\r\n          shouldMaintainAspectRatio(event),\r\n          shouldResizeFromCenter(event)\r\n        );\r\n      } else {\r\n        const [gridX, gridY] = getGridPoint(\r\n          pointerCoords.x,\r\n          pointerCoords.y,\r\n          this.state.gridSize\r\n        );\r\n        const image =\r\n          isInitializedImageElement(draggingElement) &&\r\n          this.imageCache.get(draggingElement.fileId)?.image;\r\n        const aspectRatio =\r\n          image && !(image instanceof Promise)\r\n            ? image.width / image.height\r\n            : null;\r\n        dragNewElement(\r\n          draggingElement,\r\n          this.state.elementType,\r\n          pointerDownState.originInGrid.x,\r\n          pointerDownState.originInGrid.y,\r\n          gridX,\r\n          gridY,\r\n          distance(pointerDownState.originInGrid.x, gridX),\r\n          distance(pointerDownState.originInGrid.y, gridY),\r\n          isImageElement(draggingElement)\r\n            ? !shouldMaintainAspectRatio(event)\r\n            : shouldMaintainAspectRatio(event),\r\n          shouldResizeFromCenter(event),\r\n          aspectRatio\r\n        );\r\n        this.maybeSuggestBindingForAll([draggingElement]);\r\n      }\r\n    };\r\n    this.maybeHandleResize = (pointerDownState, event) => {\r\n      const selectedElements = getSelectedElements(\r\n        this.scene.getElements(),\r\n        this.state\r\n      );\r\n      const transformHandleType = pointerDownState.resize.handleType;\r\n      this.setState({\r\n        // TODO: rename this state field to \"isScaling\" to distinguish\r\n        // it from the generic \"isResizing\" which includes scaling and\r\n        // rotating\r\n        isResizing: transformHandleType && transformHandleType !== \"rotation\",\r\n        isRotating: transformHandleType === \"rotation\",\r\n      });\r\n      const pointerCoords = pointerDownState.lastCoords;\r\n      const [resizeX, resizeY] = getGridPoint(\r\n        pointerCoords.x - pointerDownState.resize.offset.x,\r\n        pointerCoords.y - pointerDownState.resize.offset.y,\r\n        this.state.gridSize\r\n      );\r\n      if (\r\n        transformElements(\r\n          pointerDownState,\r\n          transformHandleType,\r\n          selectedElements,\r\n          pointerDownState.resize.arrowDirection,\r\n          shouldRotateWithDiscreteAngle(event),\r\n          shouldResizeFromCenter(event),\r\n          selectedElements.length === 1 && isImageElement(selectedElements[0])\r\n            ? !shouldMaintainAspectRatio(event)\r\n            : shouldMaintainAspectRatio(event),\r\n          resizeX,\r\n          resizeY,\r\n          pointerDownState.resize.center.x,\r\n          pointerDownState.resize.center.y\r\n        )\r\n      ) {\r\n        this.maybeSuggestBindingForAll(selectedElements);\r\n        return true;\r\n      }\r\n      return false;\r\n    };\r\n    /** @private use this.handleCanvasContextMenu */\r\n    this._openContextMenu = ({ left, top }, type) => {\r\n      const maybeGroupAction = actionGroup.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const maybeUngroupAction = actionUngroup.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const maybeFlipHorizontal = actionFlipHorizontal.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const maybeFlipVertical = actionFlipVertical.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const separator = \"separator\";\r\n      const elements = this.scene.getElements();\r\n      const options = [];\r\n      if (probablySupportsClipboardBlob && elements.length > 0) {\r\n        options.push(actionCopyAsPng);\r\n      }\r\n      if (probablySupportsClipboardWriteText && elements.length > 0) {\r\n        options.push(actionCopyAsSvg);\r\n      }\r\n      if (type === \"canvas\") {\r\n        const viewModeOptions = [\r\n          ...options,\r\n          typeof this.props.gridModeEnabled === \"undefined\" &&\r\n            actionToggleGridMode,\r\n          typeof this.props.zenModeEnabled === \"undefined\" &&\r\n            actionToggleZenMode,\r\n          typeof this.props.viewModeEnabled === \"undefined\" &&\r\n            actionToggleViewMode,\r\n          actionToggleStats,\r\n        ];\r\n        if (this.state.viewModeEnabled) {\r\n          ContextMenu.push({\r\n            options: viewModeOptions,\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        } else {\r\n          ContextMenu.push({\r\n            options: [\r\n              this.isMobile &&\r\n                navigator.clipboard && {\r\n                  name: \"paste\",\r\n                  perform: (elements, appStates) => {\r\n                    this.pasteFromClipboard(null);\r\n                    return {\r\n                      commitToHistory: false,\r\n                    };\r\n                  },\r\n                  contextItemLabel: \"labels.paste\",\r\n                },\r\n              this.isMobile && navigator.clipboard && separator,\r\n              probablySupportsClipboardBlob &&\r\n                elements.length > 0 &&\r\n                actionCopyAsPng,\r\n              probablySupportsClipboardWriteText &&\r\n                elements.length > 0 &&\r\n                actionCopyAsSvg,\r\n              ((probablySupportsClipboardBlob && elements.length > 0) ||\r\n                (probablySupportsClipboardWriteText && elements.length > 0)) &&\r\n                separator,\r\n              actionSelectAll,\r\n              separator,\r\n              typeof this.props.gridModeEnabled === \"undefined\" &&\r\n                actionToggleGridMode,\r\n              typeof this.props.zenModeEnabled === \"undefined\" &&\r\n                actionToggleZenMode,\r\n              typeof this.props.viewModeEnabled === \"undefined\" &&\r\n                actionToggleViewMode,\r\n              actionToggleStats,\r\n            ],\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        }\r\n      } else if (type === \"element\") {\r\n        if (this.state.viewModeEnabled) {\r\n          ContextMenu.push({\r\n            options: [navigator.clipboard && actionCopy, ...options],\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        } else {\r\n          ContextMenu.push({\r\n            options: [\r\n              this.isMobile && actionCut,\r\n              this.isMobile && navigator.clipboard && actionCopy,\r\n              this.isMobile &&\r\n                navigator.clipboard && {\r\n                  name: \"paste\",\r\n                  perform: (elements, appStates) => {\r\n                    this.pasteFromClipboard(null);\r\n                    return {\r\n                      commitToHistory: false,\r\n                    };\r\n                  },\r\n                  contextItemLabel: \"labels.paste\",\r\n                },\r\n              this.isMobile && separator,\r\n              ...options,\r\n              separator,\r\n              actionCopyStyles,\r\n              actionPasteStyles,\r\n              separator,\r\n              maybeGroupAction && actionGroup,\r\n              maybeUngroupAction && actionUngroup,\r\n              (maybeGroupAction || maybeUngroupAction) && separator,\r\n              actionAddToLibrary,\r\n              separator,\r\n              actionSendBackward,\r\n              actionBringForward,\r\n              actionSendToBack,\r\n              actionBringToFront,\r\n              separator,\r\n              maybeFlipHorizontal && actionFlipHorizontal,\r\n              maybeFlipVertical && actionFlipVertical,\r\n              (maybeFlipHorizontal || maybeFlipVertical) && separator,\r\n              actionDuplicateSelection,\r\n              actionDeleteSelected,\r\n            ],\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        }\r\n      }\r\n    };\r\n    this.handleWheel = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      if (isPanning) {\r\n        return;\r\n      }\r\n      const { deltaX, deltaY } = event;\r\n      const { selectedElementIds, previousSelectedElementIds } = this.state;\r\n      // note that event.ctrlKey is necessary to handle pinch zooming\r\n      if (event.metaKey || event.ctrlKey) {\r\n        const sign = Math.sign(deltaY);\r\n        const MAX_STEP = 10;\r\n        let delta = Math.abs(deltaY);\r\n        if (delta > MAX_STEP) {\r\n          delta = MAX_STEP;\r\n        }\r\n        delta *= sign;\r\n        if (Object.keys(previousSelectedElementIds).length !== 0) {\r\n          setTimeout(() => {\r\n            this.setState({\r\n              selectedElementIds: previousSelectedElementIds,\r\n              previousSelectedElementIds: {},\r\n            });\r\n          }, 1000);\r\n        }\r\n        let newZoom = this.state.zoom.value - delta / 100;\r\n        // increase zoom steps the more zoomed-in we are (applies to >100% only)\r\n        newZoom += Math.log10(Math.max(1, this.state.zoom.value)) * -sign;\r\n        // round to nearest step\r\n        newZoom = Math.round(newZoom * ZOOM_STEP * 100) / (ZOOM_STEP * 100);\r\n        this.setState(({ zoom, offsetLeft, offsetTop }) => ({\r\n          zoom: getNewZoom(\r\n            getNormalizedZoom(newZoom),\r\n            zoom,\r\n            { left: offsetLeft, top: offsetTop },\r\n            {\r\n              x: cursorX,\r\n              y: cursorY,\r\n            }\r\n          ),\r\n          selectedElementIds: {},\r\n          previousSelectedElementIds:\r\n            Object.keys(selectedElementIds).length !== 0\r\n              ? selectedElementIds\r\n              : previousSelectedElementIds,\r\n          shouldCacheIgnoreZoom: true,\r\n        }));\r\n        this.resetShouldCacheIgnoreZoomDebounced();\r\n        return;\r\n      }\r\n      // scroll horizontally when shift pressed\r\n      if (event.shiftKey) {\r\n        this.setState(({ zoom, scrollX }) => ({\r\n          // on Mac, shift+wheel tends to result in deltaX\r\n          scrollX: scrollX - (deltaY || deltaX) / zoom.value,\r\n        }));\r\n        return;\r\n      }\r\n      this.setState(({ zoom, scrollX, scrollY }) => ({\r\n        scrollX: scrollX - deltaX / zoom.value,\r\n        scrollY: scrollY - deltaY / zoom.value,\r\n      }));\r\n    });\r\n    this.savePointer = (x, y, button) => {\r\n      if (!x || !y) {\r\n        return;\r\n      }\r\n      const pointer = viewportCoordsToSceneCoords(\r\n        { clientX: x, clientY: y },\r\n        this.state\r\n      );\r\n      if (isNaN(pointer.x) || isNaN(pointer.y)) {\r\n        // sometimes the pointer goes off screen\r\n      }\r\n      this.props.onPointerUpdate?.({\r\n        pointer,\r\n        button,\r\n        pointersMap: gesture.pointers,\r\n      });\r\n    };\r\n    this.resetShouldCacheIgnoreZoomDebounced = debounce(() => {\r\n      if (!this.unmounted) {\r\n        this.setState({ shouldCacheIgnoreZoom: false });\r\n      }\r\n    }, 300);\r\n    this.updateDOMRect = (cb) => {\r\n      if (this.excalidrawContainerRef?.current) {\r\n        const excalidrawContainer = this.excalidrawContainerRef.current;\r\n        const {\r\n          width,\r\n          height,\r\n          left: offsetLeft,\r\n          top: offsetTop,\r\n        } = excalidrawContainer.getBoundingClientRect();\r\n        const {\r\n          width: currentWidth,\r\n          height: currentHeight,\r\n          offsetTop: currentOffsetTop,\r\n          offsetLeft: currentOffsetLeft,\r\n        } = this.state;\r\n        if (\r\n          width === currentWidth &&\r\n          height === currentHeight &&\r\n          offsetLeft === currentOffsetLeft &&\r\n          offsetTop === currentOffsetTop\r\n        ) {\r\n          if (cb) {\r\n            cb();\r\n          }\r\n          return;\r\n        }\r\n        this.setState(\r\n          {\r\n            width,\r\n            height,\r\n            offsetLeft,\r\n            offsetTop,\r\n          },\r\n          () => {\r\n            cb && cb();\r\n          }\r\n        );\r\n      }\r\n    };\r\n    this.refresh = () => {\r\n      this.setState({ ...this.getCanvasOffsets() });\r\n    };\r\n    const defaultAppState = getDefaultAppState();\r\n    const {\r\n      excalidrawRef,\r\n      viewModeEnabled = false,\r\n      zenModeEnabled = false,\r\n      gridModeEnabled = false,\r\n      theme = defaultAppState.theme,\r\n      name = defaultAppState.name,\r\n    } = props;\r\n    this.state = {\r\n      ...defaultAppState,\r\n      theme,\r\n      isLoading: true,\r\n      trusted:true,\r\n      ...this.getCanvasOffsets(),\r\n      viewModeEnabled,\r\n      zenModeEnabled,\r\n      gridSize: gridModeEnabled ? GRID_SIZE : null,\r\n      name,\r\n      width: window.innerWidth,\r\n      height: window.innerHeight,\r\n    };\r\n    this.id = nanoid();\r\n    if (excalidrawRef) {\r\n      const readyPromise =\r\n        (\"current\" in excalidrawRef && excalidrawRef.current?.readyPromise) ||\r\n        resolvablePromise();\r\n      const api = {\r\n        ready: true,\r\n        readyPromise,\r\n        updateScene: this.updateScene,\r\n        addFiles: this.addFiles,\r\n        resetScene: this.resetScene,\r\n        getSceneElementsIncludingDeleted: this.getSceneElementsIncludingDeleted,\r\n        history: {\r\n          clear: this.resetHistory,\r\n        },\r\n        scrollToContent: this.scrollToContent,\r\n        getSceneElements: this.getSceneElements,\r\n        getAppState: () => this.state,\r\n        getFiles: () => this.files,\r\n        refresh: this.refresh,\r\n        importLibrary: this.importLibraryFromUrl,\r\n        setToastMessage: this.setToastMessage,\r\n        id: this.id,\r\n      };\r\n      if (typeof excalidrawRef === \"function\") {\r\n        excalidrawRef(api);\r\n      } else {\r\n        excalidrawRef.current = api;\r\n      }\r\n      readyPromise.resolve(api);\r\n    }\r\n    this.excalidrawContainerValue = {\r\n      container: this.excalidrawContainerRef.current,\r\n      id: this.id,\r\n    };\r\n    this.scene = new Scene();\r\n    this.library = new Library(this);\r\n    this.history = new History();\r\n    this.actionManager = new ActionManager(\r\n      this.syncActionResult,\r\n      () => this.state,\r\n      () => this.scene.getElementsIncludingDeleted(),\r\n      this\r\n    );\r\n    this.actionManager.registerAll(actions);\r\n    this.actionManager.registerAction(createUndoAction(this.history));\r\n    this.actionManager.registerAction(createRedoAction(this.history));\r\n    console.log(this.state)\r\n  }\r\n\r\n  renderCanvas() {\r\n    const canvasScale = window.devicePixelRatio;\r\n    const {\r\n      width: canvasDOMWidth,\r\n      height: canvasDOMHeight,\r\n      viewModeEnabled,\r\n    } = this.state;\r\n    const canvasWidth = canvasDOMWidth * canvasScale;\r\n    const canvasHeight = canvasDOMHeight * canvasScale;\r\n    if (viewModeEnabled) {\r\n      return (\r\n        <canvas\r\n          className=\"excalidraw__canvas\"\r\n          style={{\r\n            width: canvasDOMWidth,\r\n            height: canvasDOMHeight,\r\n            cursor: CURSOR_TYPE.GRAB,\r\n          }}\r\n          width={canvasWidth}\r\n          height={canvasHeight}\r\n          ref={this.handleCanvasRef}\r\n          onContextMenu={this.handleCanvasContextMenu}\r\n          onPointerMove={this.handleCanvasPointerMove}\r\n          onPointerUp={this.removePointer}\r\n          onPointerCancel={this.removePointer}\r\n          onTouchMove={this.handleTouchMove}\r\n          onPointerDown={this.handleCanvasPointerDown}\r\n        >\r\n          {t(\"labels.drawingCanvas\")}\r\n        </canvas>\r\n      );\r\n    }\r\n    return (\r\n      <canvas\r\n        className=\"excalidraw__canvas\"\r\n        style={{\r\n          width: canvasDOMWidth,\r\n          height: canvasDOMHeight,\r\n        }}\r\n        width={canvasWidth}\r\n        height={canvasHeight}\r\n        ref={this.handleCanvasRef}\r\n        onContextMenu={this.handleCanvasContextMenu}\r\n        onPointerDown={this.handleCanvasPointerDown}\r\n        onDoubleClick={this.handleCanvasDoubleClick}\r\n        onPointerMove={this.handleCanvasPointerMove}\r\n        onPointerUp={this.removePointer}\r\n        onPointerCancel={this.removePointer}\r\n        onTouchMove={this.handleTouchMove}\r\n      >\r\n        {t(\"labels.drawingCanvas\")}\r\n      </canvas>\r\n    );\r\n  }\r\n\r\n  render() {\r\n    const { zenModeEnabled, viewModeEnabled } = this.state;\r\n    const {\r\n      onCollabButtonClick,\r\n      renderTopRightUI,\r\n      renderFooter,\r\n      renderCustomStats,\r\n    } = this.props;\r\n    return (\r\n      <div\r\n        className={clsx(\"excalidraw excalidraw-container\", {\r\n          \"excalidraw--view-mode\": viewModeEnabled,\r\n          \"excalidraw--mobile\": this.isMobile,\r\n        })}\r\n        ref={this.excalidrawContainerRef}\r\n        onDrop={this.handleAppOnDrop}\r\n        tabIndex={0}\r\n        onKeyDown={\r\n          this.props.handleKeyboardGlobally ? undefined : this.onKeyDown\r\n        }\r\n      >\r\n        <ExcalidrawContainerContext.Provider\r\n          value={this.excalidrawContainerValue}\r\n        >\r\n          <IsMobileContext.Provider value={this.isMobile}>\r\n            <LayerUI\r\n              canvas={this.canvas}\r\n              appState={this.state}\r\n              files={this.files}\r\n              setAppState={this.setAppState}\r\n              actionManager={this.actionManager}\r\n              elements={this.scene.getElements()}\r\n              onCollabButtonClick={onCollabButtonClick}\r\n              onLockToggle={this.toggleLock}\r\n              onInsertElements={(elements) =>\r\n                this.addElementsFromPasteOrLibrary({\r\n                  elements,\r\n                  position: \"center\",\r\n                  files: null,\r\n                })\r\n              }\r\n              zenModeEnabled={zenModeEnabled}\r\n              toggleZenMode={this.toggleZenMode}\r\n              langCode={getLanguage().code}\r\n              isCollaborating={this.props.isCollaborating || false}\r\n              renderTopRightUI={renderTopRightUI}\r\n              renderCustomFooter={renderFooter}\r\n              viewModeEnabled={viewModeEnabled}\r\n              showExitZenModeBtn={\r\n                typeof this.props?.zenModeEnabled === \"undefined\" &&\r\n                zenModeEnabled\r\n              }\r\n              showThemeBtn={\r\n                typeof this.props?.theme === \"undefined\" &&\r\n                this.props.UIOptions.canvasActions.theme\r\n              }\r\n              libraryReturnUrl={this.props.libraryReturnUrl}\r\n              UIOptions={this.props.UIOptions}\r\n              focusContainer={this.focusContainer}\r\n              library={this.library}\r\n              id={this.id}\r\n              onImageAction={this.onImageAction}\r\n            />\r\n            <div className=\"excalidraw-textEditorContainer\" />\r\n            <div className=\"excalidraw-contextMenuContainer\" />\r\n            {this.state.showStats && (\r\n              <Stats\r\n                appState={this.state}\r\n                setAppState={this.setAppState}\r\n                elements={this.scene.getElements()}\r\n                onClose={this.toggleStats}\r\n                renderCustomStats={renderCustomStats}\r\n              />\r\n            )}\r\n            {this.state.toastMessage !== null && (\r\n              <Toast\r\n                message={this.state.toastMessage}\r\n                clearToast={this.clearToast}\r\n              />\r\n            )}\r\n            <main>{this.renderCanvas()}</main>\r\n          </IsMobileContext.Provider>\r\n        </ExcalidrawContainerContext.Provider>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  async componentDidMount() {\r\n    this.excalidrawContainerValue.container =\r\n      this.excalidrawContainerRef.current;\r\n    if (\r\n      process.env.NODE_ENV === ENV.TEST ||\r\n      process.env.NODE_ENV === ENV.DEVELOPMENT\r\n    ) {\r\n      const setState = this.setState.bind(this);\r\n      Object.defineProperties(window.h, {\r\n        state: {\r\n          configurable: true,\r\n          get: () => {\r\n            return this.state;\r\n          },\r\n        },\r\n        setState: {\r\n          configurable: true,\r\n          value: (...args) => {\r\n            return this.setState(...args);\r\n          },\r\n        },\r\n        app: {\r\n          configurable: true,\r\n          value: this,\r\n        },\r\n        history: {\r\n          configurable: true,\r\n          value: this.history,\r\n        },\r\n      });\r\n    }\r\n    this.scene.addCallback(this.onSceneUpdated);\r\n    this.addEventListeners();\r\n    if (this.excalidrawContainerRef.current) {\r\n      this.focusContainer();\r\n    }\r\n    if (\"ResizeObserver\" in window && this.excalidrawContainerRef?.current) {\r\n      this.resizeObserver = new ResizeObserver(() => {\r\n        // compute isMobile state\r\n        // ---------------------------------------------------------------------\r\n        const { width, height } =\r\n          this.excalidrawContainerRef.current.getBoundingClientRect();\r\n        this.isMobile =\r\n          width < MQ_MAX_WIDTH_PORTRAIT ||\r\n          (height < MQ_MAX_HEIGHT_LANDSCAPE && width < MQ_MAX_WIDTH_LANDSCAPE);\r\n        // refresh offsets\r\n        // ---------------------------------------------------------------------\r\n        this.updateDOMRect();\r\n      });\r\n      this.resizeObserver?.observe(this.excalidrawContainerRef.current);\r\n    } else if (window.matchMedia) {\r\n      const mediaQuery = window.matchMedia(\r\n        `(max-width: ${MQ_MAX_WIDTH_PORTRAIT}px), (max-height: ${MQ_MAX_HEIGHT_LANDSCAPE}px) and (max-width: ${MQ_MAX_WIDTH_LANDSCAPE}px)`\r\n      );\r\n      const handler = () => (this.isMobile = mediaQuery.matches);\r\n      mediaQuery.addListener(handler);\r\n      this.detachIsMobileMqHandler = () => mediaQuery.removeListener(handler);\r\n    }\r\n    const searchParams = new URLSearchParams(window.location.search.slice(1));\r\n    if (searchParams.has(\"web-share-target\")) {\r\n      // Obtain a file that was shared via the Web Share Target API.\r\n      this.restoreFileFromShare();\r\n    } else {\r\n      this.updateDOMRect(this.initializeScene);\r\n    }\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    this.files = {};\r\n    this.imageCache.clear();\r\n    this.resizeObserver?.disconnect();\r\n    this.unmounted = true;\r\n    this.removeEventListeners();\r\n    this.scene.destroy();\r\n    clearTimeout(touchTimeout);\r\n    touchTimeout = 0;\r\n  }\r\n\r\n  removeEventListeners() {\r\n    document.removeEventListener(EVENT.POINTER_UP, this.removePointer);\r\n    document.removeEventListener(EVENT.COPY, this.onCopy);\r\n    document.removeEventListener(EVENT.PASTE, this.pasteFromClipboard);\r\n    document.removeEventListener(EVENT.CUT, this.onCut);\r\n    this.nearestScrollableContainer?.removeEventListener(\r\n      EVENT.SCROLL,\r\n      this.onScroll\r\n    );\r\n    document.removeEventListener(EVENT.KEYDOWN, this.onKeyDown, false);\r\n    document.removeEventListener(\r\n      EVENT.MOUSE_MOVE,\r\n      this.updateCurrentCursorPosition,\r\n      false\r\n    );\r\n    document.removeEventListener(EVENT.KEYUP, this.onKeyUp);\r\n    window.removeEventListener(EVENT.RESIZE, this.onResize, false);\r\n    window.removeEventListener(EVENT.UNLOAD, this.onUnload, false);\r\n    window.removeEventListener(EVENT.BLUR, this.onBlur, false);\r\n    window.removeEventListener(EVENT.DRAG_OVER, this.disableEvent, false);\r\n    window.removeEventListener(EVENT.DROP, this.disableEvent, false);\r\n    document.removeEventListener(\r\n      EVENT.GESTURE_START,\r\n      this.onGestureStart,\r\n      false\r\n    );\r\n    document.removeEventListener(\r\n      EVENT.GESTURE_CHANGE,\r\n      this.onGestureChange,\r\n      false\r\n    );\r\n    document.removeEventListener(EVENT.GESTURE_END, this.onGestureEnd, false);\r\n    this.detachIsMobileMqHandler?.();\r\n  }\r\n\r\n  addEventListeners() {\r\n    this.removeEventListeners();\r\n    document.addEventListener(EVENT.POINTER_UP, this.removePointer); // #3553\r\n    document.addEventListener(EVENT.COPY, this.onCopy);\r\n    document.addEventListener(\"status\", (e) => {\r\n      this.state.trusted = e.detail.status\r\n    })\r\n    if (this.props.handleKeyboardGlobally) {\r\n      document.addEventListener(EVENT.KEYDOWN, this.onKeyDown, false);\r\n    }\r\n    document.addEventListener(EVENT.KEYUP, this.onKeyUp, { passive: true });\r\n    document.addEventListener(\r\n      EVENT.MOUSE_MOVE,\r\n      this.updateCurrentCursorPosition\r\n    );\r\n    // rerender text elements on font load to fix #637 && #1553\r\n    document.fonts?.addEventListener?.(\"loadingdone\", this.onFontLoaded);\r\n    // Safari-only desktop pinch zoom\r\n    document.addEventListener(EVENT.GESTURE_START, this.onGestureStart, false);\r\n    document.addEventListener(\r\n      EVENT.GESTURE_CHANGE,\r\n      this.onGestureChange,\r\n      false\r\n    );\r\n    document.addEventListener(EVENT.GESTURE_END, this.onGestureEnd, false);\r\n    if (this.state.viewModeEnabled) {\r\n      return;\r\n    }\r\n    document.addEventListener(EVENT.PASTE, this.pasteFromClipboard);\r\n    document.addEventListener(EVENT.CUT, this.onCut);\r\n    if (this.props.detectScroll) {\r\n      this.nearestScrollableContainer = getNearestScrollableContainer(\r\n        this.excalidrawContainerRef.current\r\n      );\r\n      this.nearestScrollableContainer.addEventListener(\r\n        EVENT.SCROLL,\r\n        this.onScroll\r\n      );\r\n    }\r\n    window.addEventListener(EVENT.RESIZE, this.onResize, false);\r\n    window.addEventListener(EVENT.UNLOAD, this.onUnload, false);\r\n    window.addEventListener(EVENT.BLUR, this.onBlur, false);\r\n    window.addEventListener(EVENT.DRAG_OVER, this.disableEvent, false);\r\n    window.addEventListener(EVENT.DROP, this.disableEvent, false);\r\n  }\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevProps.langCode !== this.props.langCode) {\r\n      this.updateLanguage();\r\n    }\r\n    if (prevProps.viewModeEnabled !== this.props.viewModeEnabled) {\r\n      this.setState({ viewModeEnabled: !!this.props.viewModeEnabled });\r\n    }\r\n    if (prevState.viewModeEnabled !== this.state.viewModeEnabled) {\r\n      this.addEventListeners();\r\n      this.deselectElements();\r\n    }\r\n    if (prevProps.zenModeEnabled !== this.props.zenModeEnabled) {\r\n      this.setState({ zenModeEnabled: !!this.props.zenModeEnabled });\r\n    }\r\n    if (prevProps.theme !== this.props.theme && this.props.theme) {\r\n      this.setState({ theme: this.props.theme });\r\n    }\r\n    if (prevProps.gridModeEnabled !== this.props.gridModeEnabled) {\r\n      this.setState({\r\n        gridSize: this.props.gridModeEnabled ? GRID_SIZE : null,\r\n      });\r\n    }\r\n    if (this.props.name && prevProps.name !== this.props.name) {\r\n      this.setState({\r\n        name: this.props.name,\r\n      });\r\n    }\r\n    this.excalidrawContainerRef.current?.classList.toggle(\r\n      \"theme--dark\",\r\n      this.state.theme === \"dark\"\r\n    );\r\n    if (\r\n      this.state.editingLinearElement &&\r\n      !this.state.selectedElementIds[this.state.editingLinearElement.elementId]\r\n    ) {\r\n      // defer so that the commitToHistory flag isn't reset via current update\r\n      setTimeout(() => {\r\n        this.actionManager.executeAction(actionFinalize);\r\n      });\r\n    }\r\n    const { multiElement } = prevState;\r\n    if (\r\n      prevState.elementType !== this.state.elementType &&\r\n      multiElement != null &&\r\n      isBindingEnabled(this.state) &&\r\n      isBindingElement(multiElement)\r\n    ) {\r\n      maybeBindLinearElement(\r\n        multiElement,\r\n        this.state,\r\n        this.scene,\r\n        tupleToCoors(\r\n          LinearElementEditor.getPointAtIndexGlobalCoordinates(multiElement, -1)\r\n        )\r\n      );\r\n    }\r\n    const cursorButton = {};\r\n    const pointerViewportCoords = {};\r\n    const remoteSelectedElementIds = {};\r\n    const pointerUsernames = {};\r\n    const pointerUserStates = {};\r\n    this.state.collaborators.forEach((user, socketId) => {\r\n      if (user.selectedElementIds) {\r\n        for (const id of Object.keys(user.selectedElementIds)) {\r\n          if (!(id in remoteSelectedElementIds)) {\r\n            remoteSelectedElementIds[id] = [];\r\n          }\r\n          remoteSelectedElementIds[id].push(socketId);\r\n        }\r\n      }\r\n      if (!user.pointer) {\r\n        return;\r\n      }\r\n      if (user.username) {\r\n        pointerUsernames[socketId] = user.username;\r\n      }\r\n      if (user.userState) {\r\n        pointerUserStates[socketId] = user.userState;\r\n      }\r\n      pointerViewportCoords[socketId] = sceneCoordsToViewportCoords(\r\n        {\r\n          sceneX: user.pointer.x,\r\n          sceneY: user.pointer.y,\r\n        },\r\n        this.state\r\n      );\r\n      cursorButton[socketId] = user.button;\r\n    });\r\n    const renderingElements = this.scene.getElements().filter((element) => {\r\n      if (isImageElement(element)) {\r\n        if (\r\n          // not placed on canvas yet (but in elements array)\r\n          this.state.pendingImageElement &&\r\n          element.id === this.state.pendingImageElement.id\r\n        ) {\r\n          return false;\r\n        }\r\n      }\r\n      // don't render text element that's being currently edited (it's\r\n      // rendered on remote only)\r\n      return (\r\n        !this.state.editingElement ||\r\n        this.state.editingElement.type !== \"text\" ||\r\n        element.id !== this.state.editingElement.id\r\n      );\r\n    });\r\n    const { atLeastOneVisibleElement, scrollBars } = renderScene(\r\n      renderingElements,\r\n      this.state,\r\n      this.state.selectionElement,\r\n      window.devicePixelRatio,\r\n      this.rc,\r\n      this.canvas,\r\n      {\r\n        scrollX: this.state.scrollX,\r\n        scrollY: this.state.scrollY,\r\n        viewBackgroundColor: this.state.viewBackgroundColor,\r\n        zoom: this.state.zoom,\r\n        remotePointerViewportCoords: pointerViewportCoords,\r\n        remotePointerButton: cursorButton,\r\n        remoteSelectedElementIds,\r\n        remotePointerUsernames: pointerUsernames,\r\n        remotePointerUserStates: pointerUserStates,\r\n        shouldCacheIgnoreZoom: this.state.shouldCacheIgnoreZoom,\r\n        theme: this.state.theme,\r\n        imageCache: this.imageCache,\r\n      },\r\n      {\r\n        renderOptimizations: true,\r\n        renderScrollbars: !this.isMobile,\r\n      }\r\n    );\r\n    if (scrollBars) {\r\n      currentScrollBars = scrollBars;\r\n    }\r\n    const scrolledOutside =\r\n      // hide when editing text\r\n      this.state.editingElement?.type === \"text\"\r\n        ? false\r\n        : !atLeastOneVisibleElement && renderingElements.length > 0;\r\n    if (this.state.scrolledOutside !== scrolledOutside) {\r\n      this.setState({ scrolledOutside });\r\n    }\r\n    this.history.record(this.state, this.scene.getElementsIncludingDeleted());\r\n    this.scheduleImageRefresh();\r\n    // Do not notify consumers if we're still loading the scene. Among other\r\n    // potential issues, this fixes a case where the tab isn't focused during\r\n    // init, which would trigger onChange with empty elements, which would then\r\n    // override whatever is in localStorage currently.\r\n    if (!this.state.isLoading) {\r\n      this.props.onChange?.(\r\n        this.scene.getElementsIncludingDeleted(),\r\n        this.state,\r\n        this.files\r\n      );\r\n    }\r\n  }\r\n\r\n  static resetTapTwice() {\r\n    didTapTwice = false;\r\n  }\r\n\r\n  addTextFromPaste(text) {\r\n    const { x, y } = viewportCoordsToSceneCoords(\r\n      { clientX: cursorX, clientY: cursorY },\r\n      this.state\r\n    );\r\n    const element = newTextElement({\r\n      x,\r\n      y,\r\n      strokeColor: this.state.currentItemStrokeColor,\r\n      backgroundColor: this.state.currentItemBackgroundColor,\r\n      fillStyle: this.state.currentItemFillStyle,\r\n      strokeWidth: this.state.currentItemStrokeWidth,\r\n      strokeStyle: this.state.currentItemStrokeStyle,\r\n      roughness: this.state.currentItemRoughness,\r\n      opacity: this.state.currentItemOpacity,\r\n      strokeSharpness: this.state.currentItemStrokeSharpness,\r\n      text,\r\n      fontSize: this.state.currentItemFontSize,\r\n      fontFamily: this.state.currentItemFontFamily,\r\n      textAlign: this.state.currentItemTextAlign,\r\n      verticalAlign: DEFAULT_VERTICAL_ALIGN,\r\n    });\r\n    this.scene.replaceAllElements([\r\n      ...this.scene.getElementsIncludingDeleted(),\r\n      element,\r\n    ]);\r\n    this.setState({ selectedElementIds: { [element.id]: true } });\r\n    this.history.resumeRecording();\r\n  }\r\n\r\n  selectShapeTool(elementType) {\r\n    if (!isHoldingSpace) {\r\n      setCursorForShape(this.canvas, elementType);\r\n    }\r\n    if (isToolIcon(document.activeElement)) {\r\n      this.focusContainer();\r\n    }\r\n    if (!isLinearElementType(elementType)) {\r\n      this.setState({ suggestedBindings: [] });\r\n    }\r\n    if (elementType === \"image\") {\r\n      this.onImageAction();\r\n    }\r\n    if (elementType !== \"selection\") {\r\n      this.setState({\r\n        elementType,\r\n        selectedElementIds: {},\r\n        selectedGroupIds: {},\r\n        editingGroupId: null,\r\n      });\r\n    } else {\r\n      this.setState({ elementType });\r\n    }\r\n  }\r\n\r\n  handleTextWysiwyg(element, { isExistingElement = false }) {\r\n    const updateElement = (text, isDeleted = false) => {\r\n      this.scene.replaceAllElements([\r\n        ...this.scene.getElementsIncludingDeleted().map((_element) => {\r\n          if (_element.id === element.id && isTextElement(_element)) {\r\n            return updateTextElement(_element, {\r\n              text,\r\n              isDeleted,\r\n            });\r\n          }\r\n          return _element;\r\n        }),\r\n      ]);\r\n    };\r\n    textWysiwyg({\r\n      id: element.id,\r\n      appState: this.state,\r\n      canvas: this.canvas,\r\n      getViewportCoords: (x, y) => {\r\n        const { x: viewportX, y: viewportY } = sceneCoordsToViewportCoords(\r\n          {\r\n            sceneX: x,\r\n            sceneY: y,\r\n          },\r\n          this.state\r\n        );\r\n        return [\r\n          viewportX - this.state.offsetLeft,\r\n          viewportY - this.state.offsetTop,\r\n        ];\r\n      },\r\n      onChange: withBatchedUpdates((text) => {\r\n        updateElement(text);\r\n        if (isNonDeletedElement(element)) {\r\n          updateBoundElements(element);\r\n        }\r\n      }),\r\n      onSubmit: withBatchedUpdates(({ text, viaKeyboard }) => {\r\n        const isDeleted = !text.trim();\r\n        updateElement(text, isDeleted);\r\n        // select the created text element only if submitting via keyboard\r\n        // (when submitting via click it should act as signal to deselect)\r\n        if (!isDeleted && viaKeyboard) {\r\n          this.setState((prevState) => ({\r\n            selectedElementIds: {\r\n              ...prevState.selectedElementIds,\r\n              [element.id]: true,\r\n            },\r\n          }));\r\n        }\r\n        if (isDeleted) {\r\n          fixBindingsAfterDeletion(this.scene.getElements(), [element]);\r\n        }\r\n        if (!isDeleted || isExistingElement) {\r\n          this.history.resumeRecording();\r\n        }\r\n        this.setState({\r\n          draggingElement: null,\r\n          editingElement: null,\r\n        });\r\n        if (this.state.elementLocked) {\r\n          setCursorForShape(this.canvas, this.state.elementType);\r\n        }\r\n        this.focusContainer();\r\n      }),\r\n      element,\r\n      excalidrawContainer: this.excalidrawContainerRef.current,\r\n    });\r\n    // deselect all other elements when inserting text\r\n    this.deselectElements();\r\n    // do an initial update to re-initialize element position since we were\r\n    // modifying element's x/y for sake of editor (case: syncing to remote)\r\n    updateElement(element.text);\r\n  }\r\n\r\n  deselectElements() {\r\n    this.setState({\r\n      selectedElementIds: {},\r\n      selectedGroupIds: {},\r\n      editingGroupId: null,\r\n    });\r\n  }\r\n\r\n  getTextElementAtPosition(x, y) {\r\n    const element = this.getElementAtPosition(x, y);\r\n    if (element && isTextElement(element) && !element.isDeleted) {\r\n      return element;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getElementAtPosition(x, y, opts) {\r\n    const allHitElements = this.getElementsAtPosition(x, y);\r\n    if (allHitElements.length > 1) {\r\n      if (opts?.preferSelected) {\r\n        for (let index = allHitElements.length - 1; index > -1; index--) {\r\n          if (this.state.selectedElementIds[allHitElements[index].id]) {\r\n            return allHitElements[index];\r\n          }\r\n        }\r\n      }\r\n      const elementWithHighestZIndex =\r\n        allHitElements[allHitElements.length - 1];\r\n      // If we're hitting element with highest z-index only on its bounding box\r\n      // while also hitting other element figure, the latter should be considered.\r\n      return isHittingElementBoundingBoxWithoutHittingElement(\r\n        elementWithHighestZIndex,\r\n        this.state,\r\n        x,\r\n        y\r\n      )\r\n        ? allHitElements[allHitElements.length - 2]\r\n        : elementWithHighestZIndex;\r\n    }\r\n    if (allHitElements.length === 1) {\r\n      return allHitElements[0];\r\n    }\r\n    return null;\r\n  }\r\n\r\n  getElementsAtPosition(x, y) {\r\n    return getElementsAtPosition(this.scene.getElements(), (element) =>\r\n      hitTest(element, this.state, x, y)\r\n    );\r\n  }\r\n\r\n  maybeCleanupAfterMissingPointerUp(event) {\r\n    if (lastPointerUp !== null) {\r\n      // Unfortunately, sometimes we don't get a pointerup after a pointerdown,\r\n      // this can happen when a contextual menu or alert is triggered. In order to avoid\r\n      // being in a weird state, we clean up on the next pointerdown\r\n      lastPointerUp(event);\r\n    }\r\n  }\r\n\r\n  updateGestureOnPointerDown(event) {\r\n    gesture.pointers.set(event.pointerId, {\r\n      x: event.clientX,\r\n      y: event.clientY,\r\n    });\r\n    if (gesture.pointers.size === 2) {\r\n      gesture.lastCenter = getCenter(gesture.pointers);\r\n      gesture.initialScale = this.state.zoom.value;\r\n      gesture.initialDistance = getDistance(\r\n        Array.from(gesture.pointers.values())\r\n      );\r\n    }\r\n  }\r\n\r\n  initialPointerDownState(event) {\r\n    const origin = viewportCoordsToSceneCoords(event, this.state);\r\n    const selectedElements = getSelectedElements(\r\n      this.scene.getElements(),\r\n      this.state\r\n    );\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(selectedElements);\r\n    return {\r\n      origin,\r\n      withCmdOrCtrl: event[KEYS.CTRL_OR_CMD],\r\n      originInGrid: tupleToCoors(\r\n        getGridPoint(origin.x, origin.y, this.state.gridSize)\r\n      ),\r\n      scrollbars: isOverScrollBars(\r\n        currentScrollBars,\r\n        event.clientX - this.state.offsetLeft,\r\n        event.clientY - this.state.offsetTop\r\n      ),\r\n      // we need to duplicate because we'll be updating this state\r\n      lastCoords: { ...origin },\r\n      originalElements: this.scene.getElements().reduce((acc, element) => {\r\n        acc.set(element.id, deepCopyElement(element));\r\n        return acc;\r\n      }, new Map()),\r\n      resize: {\r\n        handleType: false,\r\n        isResizing: false,\r\n        offset: { x: 0, y: 0 },\r\n        arrowDirection: \"origin\",\r\n        center: { x: (maxX + minX) / 2, y: (maxY + minY) / 2 },\r\n      },\r\n      hit: {\r\n        element: null,\r\n        allHitElements: [],\r\n        wasAddedToSelection: false,\r\n        hasBeenDuplicated: false,\r\n        hasHitCommonBoundingBoxOfSelectedElements:\r\n          this.isHittingCommonBoundingBoxOfSelectedElements(\r\n            origin,\r\n            selectedElements\r\n          ),\r\n      },\r\n      drag: {\r\n        hasOccurred: false,\r\n        offset: null,\r\n      },\r\n      eventListeners: {\r\n        onMove: null,\r\n        onUp: null,\r\n        onKeyUp: null,\r\n        onKeyDown: null,\r\n      },\r\n    };\r\n  }\r\n\r\n  // Returns whether the event is a dragging a scrollbar\r\n  handleDraggingScrollBar(event, pointerDownState) {\r\n    if (\r\n      !(pointerDownState.scrollbars.isOverEither && !this.state.multiElement)\r\n    ) {\r\n      return false;\r\n    }\r\n    isDraggingScrollBar = true;\r\n    pointerDownState.lastCoords.x = event.clientX;\r\n    pointerDownState.lastCoords.y = event.clientY;\r\n    const onPointerMove = withBatchedUpdates((event) => {\r\n      const target = event.target;\r\n      if (!(target instanceof HTMLElement)) {\r\n        return;\r\n      }\r\n      this.handlePointerMoveOverScrollbars(event, pointerDownState);\r\n    });\r\n    const onPointerUp = withBatchedUpdates(() => {\r\n      isDraggingScrollBar = false;\r\n      setCursorForShape(this.canvas, this.state.elementType);\r\n      lastPointerUp = null;\r\n      this.setState({\r\n        cursorButton: \"up\",\r\n      });\r\n      this.savePointer(event.clientX, event.clientY, \"up\");\r\n      window.removeEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n      window.removeEventListener(EVENT.POINTER_UP, onPointerUp);\r\n    });\r\n    lastPointerUp = onPointerUp;\r\n    window.addEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n    window.addEventListener(EVENT.POINTER_UP, onPointerUp);\r\n    return true;\r\n  }\r\n\r\n  isASelectedElement(hitElement) {\r\n    return hitElement != null && this.state.selectedElementIds[hitElement.id];\r\n  }\r\n\r\n  isHittingCommonBoundingBoxOfSelectedElements(point, selectedElements) {\r\n    if (selectedElements.length < 2) {\r\n      return false;\r\n    }\r\n    // How many pixels off the shape boundary we still consider a hit\r\n    const threshold = 10 / this.state.zoom.value;\r\n    const [x1, y1, x2, y2] = getCommonBounds(selectedElements);\r\n    return (\r\n      point.x > x1 - threshold &&\r\n      point.x < x2 + threshold &&\r\n      point.y > y1 - threshold &&\r\n      point.y < y2 + threshold\r\n    );\r\n  }\r\n\r\n  onKeyDownFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((event) => {\r\n      if (this.maybeHandleResize(pointerDownState, event)) {\r\n        return;\r\n      }\r\n      this.maybeDragNewGenericElement(pointerDownState, event);\r\n    });\r\n  }\r\n\r\n  onKeyUpFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((event) => {\r\n      // Prevents focus from escaping excalidraw tab\r\n      event.key === KEYS.ALT && event.preventDefault();\r\n      if (this.maybeHandleResize(pointerDownState, event)) {\r\n        return;\r\n      }\r\n      this.maybeDragNewGenericElement(pointerDownState, event);\r\n    });\r\n  }\r\n\r\n  onPointerMoveFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((event) => {\r\n      if(event.isTrusted === this.state.trusted){\r\n              // We need to initialize dragOffsetXY only after we've updated\r\n      // `state.selectedElementIds` on pointerDown. Doing it here in pointerMove\r\n      // event handler should hopefully ensure we're already working with\r\n      // the updated state.\r\n      if (pointerDownState.drag.offset === null) {\r\n        pointerDownState.drag.offset = tupleToCoors(\r\n          getDragOffsetXY(\r\n            getSelectedElements(this.scene.getElements(), this.state),\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          )\r\n        );\r\n      }\r\n      const target = event.target;\r\n      if (!(target instanceof HTMLElement)) {\r\n        return;\r\n      }\r\n      if (this.handlePointerMoveOverScrollbars(event, pointerDownState)) {\r\n        return;\r\n      }\r\n      const pointerCoords = viewportCoordsToSceneCoords(event, this.state);\r\n      const [gridX, gridY] = getGridPoint(\r\n        pointerCoords.x,\r\n        pointerCoords.y,\r\n        this.state.gridSize\r\n      );\r\n      // for arrows/lines, don't start dragging until a given threshold\r\n      // to ensure we don't create a 2-point arrow by mistake when\r\n      // user clicks mouse in a way that it moves a tiny bit (thus\r\n      // triggering pointermove)\r\n      if (\r\n        !pointerDownState.drag.hasOccurred &&\r\n        (this.state.elementType === \"arrow\" ||\r\n          this.state.elementType === \"line\")\r\n      ) {\r\n        if (\r\n          distance2d(\r\n            pointerCoords.x,\r\n            pointerCoords.y,\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          ) < DRAGGING_THRESHOLD\r\n        ) {\r\n          return;\r\n        }\r\n      }\r\n      if (pointerDownState.resize.isResizing) {\r\n        pointerDownState.lastCoords.x = pointerCoords.x;\r\n        pointerDownState.lastCoords.y = pointerCoords.y;\r\n        if (this.maybeHandleResize(pointerDownState, event)) {\r\n          return true;\r\n        }\r\n      }\r\n      if (this.state.editingLinearElement) {\r\n        const didDrag = LinearElementEditor.handlePointDragging(\r\n          this.state,\r\n          (appState) => this.setState(appState),\r\n          pointerCoords.x,\r\n          pointerCoords.y,\r\n          (element, startOrEnd) => {\r\n            this.maybeSuggestBindingForLinearElementAtCursor(\r\n              element,\r\n              startOrEnd,\r\n              pointerCoords\r\n            );\r\n          }\r\n        );\r\n        if (didDrag) {\r\n          pointerDownState.lastCoords.x = pointerCoords.x;\r\n          pointerDownState.lastCoords.y = pointerCoords.y;\r\n          return;\r\n        }\r\n      }\r\n      const hasHitASelectedElement = pointerDownState.hit.allHitElements.some(\r\n        (element) => this.isASelectedElement(element)\r\n      );\r\n      if (\r\n        hasHitASelectedElement ||\r\n        pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements\r\n      ) {\r\n        // Marking that click was used for dragging to check\r\n        // if elements should be deselected on pointerup\r\n        pointerDownState.drag.hasOccurred = true;\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        // prevent dragging even if we're no longer holding cmd/ctrl otherwise\r\n        // it would have weird results (stuff jumping all over the screen)\r\n        if (selectedElements.length > 0 && !pointerDownState.withCmdOrCtrl) {\r\n          const [dragX, dragY] = getGridPoint(\r\n            pointerCoords.x - pointerDownState.drag.offset.x,\r\n            pointerCoords.y - pointerDownState.drag.offset.y,\r\n            this.state.gridSize\r\n          );\r\n          const [dragDistanceX, dragDistanceY] = [\r\n            Math.abs(pointerCoords.x - pointerDownState.origin.x),\r\n            Math.abs(pointerCoords.y - pointerDownState.origin.y),\r\n          ];\r\n          // We only drag in one direction if shift is pressed\r\n          const lockDirection = event.shiftKey;\r\n          dragSelectedElements(\r\n            pointerDownState,\r\n            selectedElements,\r\n            dragX,\r\n            dragY,\r\n            this.scene,\r\n            lockDirection,\r\n            dragDistanceX,\r\n            dragDistanceY\r\n          );\r\n          this.maybeSuggestBindingForAll(selectedElements);\r\n          // We duplicate the selected element if alt is pressed on pointer move\r\n          if (event.altKey && !pointerDownState.hit.hasBeenDuplicated) {\r\n            // Move the currently selected elements to the top of the z index stack, and\r\n            // put the duplicates where the selected elements used to be.\r\n            // (the origin point where the dragging started)\r\n            pointerDownState.hit.hasBeenDuplicated = true;\r\n            const nextElements = [];\r\n            const elementsToAppend = [];\r\n            const groupIdMap = new Map();\r\n            const oldIdToDuplicatedId = new Map();\r\n            const hitElement = pointerDownState.hit.element;\r\n            for (const element of this.scene.getElementsIncludingDeleted()) {\r\n              if (\r\n                this.state.selectedElementIds[element.id] ||\r\n                // case: the state.selectedElementIds might not have been\r\n                // updated yet by the time this mousemove event is fired\r\n                (element.id === hitElement?.id &&\r\n                  pointerDownState.hit.wasAddedToSelection)\r\n              ) {\r\n                const duplicatedElement = duplicateElement(\r\n                  this.state.editingGroupId,\r\n                  groupIdMap,\r\n                  element\r\n                );\r\n                const [originDragX, originDragY] = getGridPoint(\r\n                  pointerDownState.origin.x - pointerDownState.drag.offset.x,\r\n                  pointerDownState.origin.y - pointerDownState.drag.offset.y,\r\n                  this.state.gridSize\r\n                );\r\n                mutateElement(duplicatedElement, {\r\n                  x: duplicatedElement.x + (originDragX - dragX),\r\n                  y: duplicatedElement.y + (originDragY - dragY),\r\n                });\r\n                nextElements.push(duplicatedElement);\r\n                elementsToAppend.push(element);\r\n                oldIdToDuplicatedId.set(element.id, duplicatedElement.id);\r\n              } else {\r\n                nextElements.push(element);\r\n              }\r\n            }\r\n            const nextSceneElements = [...nextElements, ...elementsToAppend];\r\n            fixBindingsAfterDuplication(\r\n              nextSceneElements,\r\n              elementsToAppend,\r\n              oldIdToDuplicatedId,\r\n              \"duplicatesServeAsOld\"\r\n            );\r\n            this.scene.replaceAllElements(nextSceneElements);\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      // It is very important to read this.state within each move event,\r\n      // otherwise we would read a stale one!\r\n      const draggingElement = this.state.draggingElement;\r\n      if (!draggingElement) {\r\n        return;\r\n      }\r\n      if (draggingElement.type === \"freedraw\") {\r\n        const points = draggingElement.points;\r\n        const dx = pointerCoords.x - draggingElement.x;\r\n        const dy = pointerCoords.y - draggingElement.y;\r\n        const pressures = draggingElement.simulatePressure\r\n          ? draggingElement.pressures\r\n          : [...draggingElement.pressures, event.pressure];\r\n        mutateElement(draggingElement, {\r\n          points: [...points, [dx, dy]],\r\n          pressures,\r\n        });\r\n      } else if (isLinearElement(draggingElement)) {\r\n        pointerDownState.drag.hasOccurred = true;\r\n        const points = draggingElement.points;\r\n        let dx = gridX - draggingElement.x;\r\n        let dy = gridY - draggingElement.y;\r\n        if (shouldRotateWithDiscreteAngle(event) && points.length === 2) {\r\n          ({ width: dx, height: dy } = getPerfectElementSize(\r\n            this.state.elementType,\r\n            dx,\r\n            dy\r\n          ));\r\n        }\r\n        if (points.length === 1) {\r\n          mutateElement(draggingElement, { points: [...points, [dx, dy]] });\r\n        } else if (points.length > 1) {\r\n          mutateElement(draggingElement, {\r\n            points: [...points.slice(0, -1), [dx, dy]],\r\n          });\r\n        }\r\n        if (isBindingElement(draggingElement)) {\r\n          // When creating a linear element by dragging\r\n          this.maybeSuggestBindingForLinearElementAtCursor(\r\n            draggingElement,\r\n            \"end\",\r\n            pointerCoords,\r\n            this.state.startBoundElement\r\n          );\r\n        }\r\n      } else {\r\n        pointerDownState.lastCoords.x = pointerCoords.x;\r\n        pointerDownState.lastCoords.y = pointerCoords.y;\r\n        this.maybeDragNewGenericElement(pointerDownState, event);\r\n      }\r\n      if (this.state.elementType === \"selection\") {\r\n        const elements = this.scene.getElements();\r\n        if (!event.shiftKey && isSomeElementSelected(elements, this.state)) {\r\n          if (pointerDownState.withCmdOrCtrl && pointerDownState.hit.element) {\r\n            this.setState((prevState) =>\r\n              selectGroupsForSelectedElements(\r\n                {\r\n                  ...prevState,\r\n                  selectedElementIds: {\r\n                    [pointerDownState.hit.element.id]: true,\r\n                  },\r\n                },\r\n                this.scene.getElements()\r\n              )\r\n            );\r\n          } else {\r\n            this.setState({\r\n              selectedElementIds: {},\r\n              selectedGroupIds: {},\r\n              editingGroupId: null,\r\n            });\r\n          }\r\n        }\r\n        const elementsWithinSelection = getElementsWithinSelection(\r\n          elements,\r\n          draggingElement\r\n        );\r\n        this.setState((prevState) =>\r\n          selectGroupsForSelectedElements(\r\n            {\r\n              ...prevState,\r\n              selectedElementIds: {\r\n                ...prevState.selectedElementIds,\r\n                ...elementsWithinSelection.reduce((map, element) => {\r\n                  map[element.id] = true;\r\n                  return map;\r\n                }, {}),\r\n                ...(pointerDownState.hit.element\r\n                  ? {\r\n                      // if using ctrl/cmd, select the hitElement only if we\r\n                      // haven't box-selected anything else\r\n                      [pointerDownState.hit.element.id]:\r\n                        !elementsWithinSelection.length,\r\n                    }\r\n                  : null),\r\n              },\r\n            },\r\n            this.scene.getElements()\r\n          )\r\n        );\r\n      }\r\n      }\r\n    });\r\n  }\r\n\r\n  // Returns whether the pointer move happened over either scrollbar\r\n  handlePointerMoveOverScrollbars(event, pointerDownState) {\r\n    if (pointerDownState.scrollbars.isOverHorizontal) {\r\n      const x = event.clientX;\r\n      const dx = x - pointerDownState.lastCoords.x;\r\n      this.setState({\r\n        scrollX: this.state.scrollX - dx / this.state.zoom.value,\r\n      });\r\n      pointerDownState.lastCoords.x = x;\r\n      return true;\r\n    }\r\n    if (pointerDownState.scrollbars.isOverVertical) {\r\n      const y = event.clientY;\r\n      const dy = y - pointerDownState.lastCoords.y;\r\n      this.setState({\r\n        scrollY: this.state.scrollY - dy / this.state.zoom.value,\r\n      });\r\n      pointerDownState.lastCoords.y = y;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  onPointerUpFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((childEvent) => {\r\n      const {\r\n        draggingElement,\r\n        resizingElement,\r\n        multiElement,\r\n        elementType,\r\n        elementLocked,\r\n        isResizing,\r\n        isRotating,\r\n      } = this.state;\r\n      this.setState({\r\n        isResizing: false,\r\n        isRotating: false,\r\n        resizingElement: null,\r\n        selectionElement: null,\r\n        cursorButton: \"up\",\r\n        // text elements are reset on finalize, and resetting on pointerup\r\n        // may cause issues with double taps\r\n        editingElement:\r\n          multiElement || isTextElement(this.state.editingElement)\r\n            ? this.state.editingElement\r\n            : null,\r\n      });\r\n      this.savePointer(childEvent.clientX, childEvent.clientY, \"up\");\r\n      // Handle end of dragging a point of a linear element, might close a loop\r\n      // and sets binding element\r\n      if (this.state.editingLinearElement) {\r\n        const editingLinearElement = LinearElementEditor.handlePointerUp(\r\n          childEvent,\r\n          this.state.editingLinearElement,\r\n          this.state\r\n        );\r\n        if (editingLinearElement !== this.state.editingLinearElement) {\r\n          this.setState({\r\n            editingLinearElement,\r\n            suggestedBindings: [],\r\n          });\r\n        }\r\n      }\r\n      lastPointerUp = null;\r\n      window.removeEventListener(\r\n        EVENT.POINTER_MOVE,\r\n        pointerDownState.eventListeners.onMove\r\n      );\r\n      window.removeEventListener(\r\n        EVENT.POINTER_UP,\r\n        pointerDownState.eventListeners.onUp\r\n      );\r\n      window.removeEventListener(\r\n        EVENT.KEYDOWN,\r\n        pointerDownState.eventListeners.onKeyDown\r\n      );\r\n      window.removeEventListener(\r\n        EVENT.KEYUP,\r\n        pointerDownState.eventListeners.onKeyUp\r\n      );\r\n      if (this.state.pendingImageElement) {\r\n        this.setState({ pendingImageElement: null });\r\n      }\r\n      if (draggingElement?.type === \"freedraw\") {\r\n        const pointerCoords = viewportCoordsToSceneCoords(\r\n          childEvent,\r\n          this.state\r\n        );\r\n        const points = draggingElement.points;\r\n        let dx = pointerCoords.x - draggingElement.x;\r\n        let dy = pointerCoords.y - draggingElement.y;\r\n        // Allows dots to avoid being flagged as infinitely small\r\n        if (dx === points[0][0] && dy === points[0][1]) {\r\n          dy += 0.0001;\r\n          dx += 0.0001;\r\n        }\r\n        const pressures = draggingElement.simulatePressure\r\n          ? []\r\n          : [...draggingElement.pressures, childEvent.pressure];\r\n        mutateElement(draggingElement, {\r\n          points: [...points, [dx, dy]],\r\n          pressures,\r\n          lastCommittedPoint: [dx, dy],\r\n        });\r\n        this.actionManager.executeAction(actionFinalize);\r\n        return;\r\n      }\r\n      if (isImageElement(draggingElement)) {\r\n        const imageElement = draggingElement;\r\n        try {\r\n          this.initializeImageDimensions(imageElement);\r\n          this.setState(\r\n            { selectedElementIds: { [imageElement.id]: true } },\r\n            () => {\r\n              this.actionManager.executeAction(actionFinalize);\r\n            }\r\n          );\r\n        } catch (error) {\r\n          console.error(error);\r\n          this.scene.replaceAllElements(\r\n            this.scene\r\n              .getElementsIncludingDeleted()\r\n              .filter((el) => el.id !== imageElement.id)\r\n          );\r\n          this.actionManager.executeAction(actionFinalize);\r\n        }\r\n        return;\r\n      }\r\n      if (isLinearElement(draggingElement)) {\r\n        if (draggingElement.points.length > 1) {\r\n          this.history.resumeRecording();\r\n        }\r\n        const pointerCoords = viewportCoordsToSceneCoords(\r\n          childEvent,\r\n          this.state\r\n        );\r\n        if (\r\n          !pointerDownState.drag.hasOccurred &&\r\n          draggingElement &&\r\n          !multiElement\r\n        ) {\r\n          mutateElement(draggingElement, {\r\n            points: [\r\n              ...draggingElement.points,\r\n              [\r\n                pointerCoords.x - draggingElement.x,\r\n                pointerCoords.y - draggingElement.y,\r\n              ],\r\n            ],\r\n          });\r\n          this.setState({\r\n            multiElement: draggingElement,\r\n            editingElement: this.state.draggingElement,\r\n          });\r\n        } else if (pointerDownState.drag.hasOccurred && !multiElement) {\r\n          if (\r\n            isBindingEnabled(this.state) &&\r\n            isBindingElement(draggingElement)\r\n          ) {\r\n            maybeBindLinearElement(\r\n              draggingElement,\r\n              this.state,\r\n              this.scene,\r\n              pointerCoords\r\n            );\r\n          }\r\n          this.setState({ suggestedBindings: [], startBoundElement: null });\r\n          if (!elementLocked) {\r\n            resetCursor(this.canvas);\r\n            this.setState((prevState) => ({\r\n              draggingElement: null,\r\n              elementType: \"selection\",\r\n              selectedElementIds: {\r\n                ...prevState.selectedElementIds,\r\n                [this.state.draggingElement.id]: true,\r\n              },\r\n            }));\r\n          } else {\r\n            this.setState((prevState) => ({\r\n              draggingElement: null,\r\n              selectedElementIds: {\r\n                ...prevState.selectedElementIds,\r\n                [this.state.draggingElement.id]: true,\r\n              },\r\n            }));\r\n          }\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        elementType !== \"selection\" &&\r\n        draggingElement &&\r\n        isInvisiblySmallElement(draggingElement)\r\n      ) {\r\n        // remove invisible element which was added in onPointerDown\r\n        this.scene.replaceAllElements(\r\n          this.scene.getElementsIncludingDeleted().slice(0, -1)\r\n        );\r\n        this.setState({\r\n          draggingElement: null,\r\n        });\r\n        return;\r\n      }\r\n      if (draggingElement) {\r\n        mutateElement(\r\n          draggingElement,\r\n          getNormalizedDimensions(draggingElement)\r\n        );\r\n      }\r\n      if (resizingElement) {\r\n        this.history.resumeRecording();\r\n      }\r\n      if (resizingElement && isInvisiblySmallElement(resizingElement)) {\r\n        this.scene.replaceAllElements(\r\n          this.scene\r\n            .getElementsIncludingDeleted()\r\n            .filter((el) => el.id !== resizingElement.id)\r\n        );\r\n      }\r\n      // Code below handles selection when element(s) weren't\r\n      // drag or added to selection on pointer down phase.\r\n      const hitElement = pointerDownState.hit.element;\r\n      if (\r\n        hitElement &&\r\n        !pointerDownState.drag.hasOccurred &&\r\n        !pointerDownState.hit.wasAddedToSelection\r\n      ) {\r\n        if (childEvent.shiftKey) {\r\n          if (this.state.selectedElementIds[hitElement.id]) {\r\n            if (isSelectedViaGroup(this.state, hitElement)) {\r\n              // We want to unselect all groups hitElement is part of\r\n              // as well as all elements that are part of the groups\r\n              // hitElement is part of\r\n              const idsOfSelectedElementsThatAreInGroups = hitElement.groupIds\r\n                .flatMap((groupId) =>\r\n                  getElementsInGroup(this.scene.getElements(), groupId)\r\n                )\r\n                .map((element) => ({ [element.id]: false }))\r\n                .reduce((prevId, acc) => ({ ...prevId, ...acc }), {});\r\n              this.setState((_prevState) => ({\r\n                selectedGroupIds: {\r\n                  ..._prevState.selectedElementIds,\r\n                  ...hitElement.groupIds\r\n                    .map((gId) => ({ [gId]: false }))\r\n                    .reduce((prev, acc) => ({ ...prev, ...acc }), {}),\r\n                },\r\n                selectedElementIds: {\r\n                  ..._prevState.selectedElementIds,\r\n                  ...idsOfSelectedElementsThatAreInGroups,\r\n                },\r\n              }));\r\n            } else {\r\n              // remove element from selection while\r\n              // keeping prev elements selected\r\n              this.setState((prevState) =>\r\n                selectGroupsForSelectedElements(\r\n                  {\r\n                    ...prevState,\r\n                    selectedElementIds: {\r\n                      ...prevState.selectedElementIds,\r\n                      [hitElement.id]: false,\r\n                    },\r\n                  },\r\n                  this.scene.getElements()\r\n                )\r\n              );\r\n            }\r\n          } else {\r\n            // add element to selection while\r\n            // keeping prev elements selected\r\n            this.setState((_prevState) => ({\r\n              selectedElementIds: {\r\n                ..._prevState.selectedElementIds,\r\n                [hitElement.id]: true,\r\n              },\r\n            }));\r\n          }\r\n        } else {\r\n          this.setState((prevState) => ({\r\n            ...selectGroupsForSelectedElements(\r\n              {\r\n                ...prevState,\r\n                selectedElementIds: { [hitElement.id]: true },\r\n              },\r\n              this.scene.getElements()\r\n            ),\r\n          }));\r\n        }\r\n      }\r\n      if (\r\n        !this.state.editingLinearElement &&\r\n        !pointerDownState.drag.hasOccurred &&\r\n        !this.state.isResizing &&\r\n        ((hitElement &&\r\n          isHittingElementBoundingBoxWithoutHittingElement(\r\n            hitElement,\r\n            this.state,\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          )) ||\r\n          (!hitElement &&\r\n            pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements))\r\n      ) {\r\n        // Deselect selected elements\r\n        this.setState({\r\n          selectedElementIds: {},\r\n          selectedGroupIds: {},\r\n          editingGroupId: null,\r\n        });\r\n        return;\r\n      }\r\n      if (!elementLocked && elementType !== \"freedraw\" && draggingElement) {\r\n        this.setState((prevState) => ({\r\n          selectedElementIds: {\r\n            ...prevState.selectedElementIds,\r\n            [draggingElement.id]: true,\r\n          },\r\n        }));\r\n      }\r\n      if (\r\n        elementType !== \"selection\" ||\r\n        isSomeElementSelected(this.scene.getElements(), this.state)\r\n      ) {\r\n        this.history.resumeRecording();\r\n      }\r\n      if (pointerDownState.drag.hasOccurred || isResizing || isRotating) {\r\n        (isBindingEnabled(this.state)\r\n          ? bindOrUnbindSelectedElements\r\n          : unbindLinearElements)(\r\n          getSelectedElements(this.scene.getElements(), this.state)\r\n        );\r\n      }\r\n      if (!elementLocked && elementType !== \"freedraw\") {\r\n        resetCursor(this.canvas);\r\n        this.setState({\r\n          draggingElement: null,\r\n          suggestedBindings: [],\r\n          elementType: \"selection\",\r\n        });\r\n      } else {\r\n        this.setState({\r\n          draggingElement: null,\r\n          suggestedBindings: [],\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  maybeSuggestBindingForAll(selectedElements) {\r\n    const suggestedBindings = getEligibleElementsForBinding(selectedElements);\r\n    this.setState({ suggestedBindings });\r\n  }\r\n\r\n  clearSelection(hitElement) {\r\n    this.setState((prevState) => ({\r\n      selectedElementIds: {},\r\n      selectedGroupIds: {},\r\n      // Continue editing the same group if the user selected a different\r\n      // element from it\r\n      editingGroupId:\r\n        prevState.editingGroupId &&\r\n        hitElement != null &&\r\n        isElementInGroup(hitElement, prevState.editingGroupId)\r\n          ? prevState.editingGroupId\r\n          : null,\r\n    }));\r\n    this.setState({\r\n      selectedElementIds: {},\r\n      previousSelectedElementIds: this.state.selectedElementIds,\r\n    });\r\n  }\r\n\r\n  getTextWysiwygSnappedToCenterPosition(x, y, appState, canvas, scale) {\r\n    const elementClickedInside = getElementContainingPosition(\r\n      this.scene\r\n        .getElementsIncludingDeleted()\r\n        .filter((element) => !isTextElement(element)),\r\n      x,\r\n      y\r\n    );\r\n    if (elementClickedInside) {\r\n      const elementCenterX =\r\n        elementClickedInside.x + elementClickedInside.width / 2;\r\n      const elementCenterY =\r\n        elementClickedInside.y + elementClickedInside.height / 2;\r\n      const distanceToCenter = Math.hypot(\r\n        x - elementCenterX,\r\n        y - elementCenterY\r\n      );\r\n      const isSnappedToCenter =\r\n        distanceToCenter < TEXT_TO_CENTER_SNAP_THRESHOLD;\r\n      if (isSnappedToCenter) {\r\n        const { x: viewportX, y: viewportY } = sceneCoordsToViewportCoords(\r\n          { sceneX: elementCenterX, sceneY: elementCenterY },\r\n          appState\r\n        );\r\n        return { viewportX, viewportY, elementCenterX, elementCenterY };\r\n      }\r\n    }\r\n  }\r\n\r\n  getCanvasOffsets() {\r\n    if (this.excalidrawContainerRef?.current) {\r\n      const excalidrawContainer = this.excalidrawContainerRef.current;\r\n      const { left, top } = excalidrawContainer.getBoundingClientRect();\r\n      return {\r\n        offsetLeft: left,\r\n        offsetTop: top,\r\n      };\r\n    }\r\n    return {\r\n      offsetLeft: 0,\r\n      offsetTop: 0,\r\n    };\r\n  }\r\n\r\n  async updateLanguage() {\r\n    const currentLang =\r\n      languages.find((lang) => lang.code === this.props.langCode) ||\r\n      defaultLang;\r\n    await setLanguage(currentLang);\r\n    this.setAppState({});\r\n  }\r\n}\r\nApp.defaultProps = {\r\n  // needed for tests to pass since we directly render App in many tests\r\n  UIOptions: DEFAULT_UI_OPTIONS,\r\n};\r\nif (\r\n  process.env.NODE_ENV === ENV.TEST ||\r\n  process.env.NODE_ENV === ENV.DEVELOPMENT\r\n) {\r\n  window.h = window.h || {};\r\n  Object.defineProperties(window.h, {\r\n    elements: {\r\n      configurable: true,\r\n      get() {\r\n        return this.app.scene.getElementsIncludingDeleted();\r\n      },\r\n      set(elements) {\r\n        return this.app.scene.replaceAllElements(elements);\r\n      },\r\n    },\r\n  });\r\n}\r\nexport default App;\r\n","// time constants (ms)\r\nexport const SAVE_TO_LOCAL_STORAGE_TIMEOUT = 300;\r\nexport const INITIAL_SCENE_UPDATE_TIMEOUT = 5000;\r\nexport const FILE_UPLOAD_TIMEOUT = 300;\r\nexport const LOAD_IMAGES_TIMEOUT = 500;\r\nexport const SYNC_FULL_SCENE_INTERVAL_MS = 20000;\r\nexport const FILE_UPLOAD_MAX_BYTES = 3 * 1024 * 1024; // 3 MiB\r\n// 1 year (https://stackoverflow.com/a/25201898/927631)\r\nexport const FILE_CACHE_MAX_AGE_SEC = 31536000;\r\nexport const BROADCAST = {\r\n    SERVER_VOLATILE: \"server-volatile-broadcast\",\r\n    SERVER: \"server-broadcast\",\r\n};\r\nexport var SCENE;\r\n(function (SCENE) {\r\n    SCENE[\"INIT\"] = \"SCENE_INIT\";\r\n    SCENE[\"UPDATE\"] = \"SCENE_UPDATE\";\r\n})(SCENE || (SCENE = {}));\r\nexport const FIREBASE_STORAGE_PREFIXES = {\r\n    shareLinkFiles: `/files/shareLinks`,\r\n    collabFiles: `/files/rooms`,\r\n};\r\n","import \"./Modal.scss\";\r\nimport React, { useState, useLayoutEffect, useRef } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport clsx from \"clsx\";\r\nimport { KEYS } from \"../keys\";\r\nimport { useExcalidrawContainer, useIsMobile } from \"./App\";\r\nimport { THEME } from \"../constants\";\r\nexport const Modal = (props) => {\r\n    const { theme = THEME.LIGHT } = props;\r\n    const modalRoot = useBodyRoot(theme);\r\n    if (!modalRoot) {\r\n        return null;\r\n    }\r\n    const handleKeydown = (event) => {\r\n        if (event.key === KEYS.ESCAPE) {\r\n            event.nativeEvent.stopImmediatePropagation();\r\n            event.stopPropagation();\r\n            props.onCloseRequest();\r\n        }\r\n    };\r\n    return createPortal(<div className={clsx(\"Modal\", props.className)} role=\"dialog\" aria-modal=\"true\" onKeyDown={handleKeydown} aria-labelledby={props.labelledBy}>\r\n      <div className=\"Modal__background\" onClick={props.onCloseRequest}></div>\r\n      <div className=\"Modal__content\" style={{ \"--max-width\": `${props.maxWidth}px` }} tabIndex={0}>\r\n        {props.children}\r\n      </div>\r\n    </div>, modalRoot);\r\n};\r\nconst useBodyRoot = (theme) => {\r\n    const [div, setDiv] = useState(null);\r\n    const isMobile = useIsMobile();\r\n    const isMobileRef = useRef(isMobile);\r\n    isMobileRef.current = isMobile;\r\n    const { container: excalidrawContainer } = useExcalidrawContainer();\r\n    useLayoutEffect(() => {\r\n        if (div) {\r\n            div.classList.toggle(\"excalidraw--mobile\", isMobile);\r\n        }\r\n    }, [div, isMobile]);\r\n    useLayoutEffect(() => {\r\n        const isDarkTheme = !!excalidrawContainer?.classList.contains(\"theme--dark\") ||\r\n            theme === \"dark\";\r\n        const div = document.createElement(\"div\");\r\n        div.classList.add(\"excalidraw\", \"excalidraw-modal-container\");\r\n        div.classList.toggle(\"excalidraw--mobile\", isMobileRef.current);\r\n        if (isDarkTheme) {\r\n            div.classList.add(\"theme--dark\");\r\n            div.classList.add(\"theme--dark-background-none\");\r\n        }\r\n        document.body.appendChild(div);\r\n        setDiv(div);\r\n        return () => {\r\n            document.body.removeChild(div);\r\n        };\r\n    }, [excalidrawContainer, theme]);\r\n    return div;\r\n};\r\n","import clsx from \"clsx\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useCallbackRefState } from \"../hooks/useCallbackRefState\";\r\nimport { t } from \"../i18n\";\r\nimport { useExcalidrawContainer, useIsMobile } from \"../components/App\";\r\nimport { KEYS } from \"../keys\";\r\nimport \"./Dialog.scss\";\r\nimport { back, close } from \"./icons\";\r\nimport { Island } from \"./Island\";\r\nimport { Modal } from \"./Modal\";\r\nexport const Dialog = (props) => {\r\n    const [islandNode, setIslandNode] = useCallbackRefState();\r\n    const [lastActiveElement] = useState(document.activeElement);\r\n    const { id } = useExcalidrawContainer();\r\n    useEffect(() => {\r\n        if (!islandNode) {\r\n            return;\r\n        }\r\n        const focusableElements = queryFocusableElements(islandNode);\r\n        if (focusableElements.length > 0 && props.autofocus !== false) {\r\n            // If there's an element other than close, focus it.\r\n            (focusableElements[1] || focusableElements[0]).focus();\r\n        }\r\n        const handleKeyDown = (event) => {\r\n            if (event.key === KEYS.TAB) {\r\n                const focusableElements = queryFocusableElements(islandNode);\r\n                const { activeElement } = document;\r\n                const currentIndex = focusableElements.findIndex((element) => element === activeElement);\r\n                if (currentIndex === 0 && event.shiftKey) {\r\n                    focusableElements[focusableElements.length - 1].focus();\r\n                    event.preventDefault();\r\n                }\r\n                else if (currentIndex === focusableElements.length - 1 &&\r\n                    !event.shiftKey) {\r\n                    focusableElements[0].focus();\r\n                    event.preventDefault();\r\n                }\r\n            }\r\n        };\r\n        islandNode.addEventListener(\"keydown\", handleKeyDown);\r\n        return () => islandNode.removeEventListener(\"keydown\", handleKeyDown);\r\n    }, [islandNode, props.autofocus]);\r\n    const queryFocusableElements = (node) => {\r\n        const focusableElements = node.querySelectorAll(\"button, a, input, select, textarea, div[tabindex]\");\r\n        return focusableElements ? Array.from(focusableElements) : [];\r\n    };\r\n    const onClose = () => {\r\n        lastActiveElement.focus();\r\n        props.onCloseRequest();\r\n    };\r\n    return (<Modal className={clsx(\"Dialog\", props.className)} labelledBy=\"dialog-title\" maxWidth={props.small ? 550 : 800} onCloseRequest={onClose} theme={props.theme}>\r\n      <Island ref={setIslandNode}>\r\n        <h2 id={`${id}-dialog-title`} className=\"Dialog__title\">\r\n          <span className=\"Dialog__titleContent\">{props.title}</span>\r\n          <button className=\"Modal__close\" onClick={onClose} aria-label={t(\"buttons.close\")}>\r\n            {useIsMobile() ? back : close}\r\n          </button>\r\n        </h2>\r\n        <div className=\"Dialog__content\">{props.children}</div>\r\n      </Island>\r\n    </Modal>);\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nexport const ErrorDialog = ({ message, onClose }) => {\r\n  const [modalIsShown, setModalIsShown] = useState(!!message);\r\n  const { container: excalidrawContainer } = useExcalidrawContainer();\r\n  const handleClose = React.useCallback(() => {\r\n    setModalIsShown(false);\r\n    if (onClose) {\r\n      onClose();\r\n    }\r\n    // TODO: Fix the A11y issues so this is never needed since we should always focus on last active element\r\n    excalidrawContainer?.focus();\r\n  }, [onClose, excalidrawContainer]);\r\n  return (\r\n    <>\r\n      {modalIsShown && (\r\n        <Dialog\r\n          small\r\n          onCloseRequest={handleClose}\r\n          title={t(\"errorDialog.title\")}\r\n        >\r\n          <div style={{ whiteSpace: \"pre-wrap\" }}>{message}</div>\r\n        </Dialog>\r\n      )}\r\n    </>\r\n  );\r\n};\r\n","import React from \"react\";\r\nimport * as Sentry from \"@sentry/browser\";\r\nimport { t } from \"../i18n\";\r\nexport class TopErrorBoundary extends React.Component {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.state = {\r\n            hasError: false,\r\n            sentryEventId: \"\",\r\n            localStorage: \"\",\r\n        };\r\n    }\r\n    render() {\r\n        return this.state.hasError ? this.errorSplash() : this.props.children;\r\n    }\r\n    componentDidCatch(error, errorInfo) {\r\n        const _localStorage = {};\r\n        for (const [key, value] of Object.entries({ ...localStorage })) {\r\n            try {\r\n                _localStorage[key] = JSON.parse(value);\r\n            }\r\n            catch (error) {\r\n                _localStorage[key] = value;\r\n            }\r\n        }\r\n        Sentry.withScope((scope) => {\r\n            scope.setExtras(errorInfo);\r\n            const eventId = Sentry.captureException(error);\r\n            this.setState((state) => ({\r\n                hasError: true,\r\n                sentryEventId: eventId,\r\n                localStorage: JSON.stringify(_localStorage),\r\n            }));\r\n        });\r\n    }\r\n    selectTextArea(event) {\r\n        if (event.target !== document.activeElement) {\r\n            event.preventDefault();\r\n            event.target.select();\r\n        }\r\n    }\r\n    async createGithubIssue() {\r\n        let body = \"\";\r\n        try {\r\n            const templateStrFn = (await import(\r\n            /* webpackChunkName: \"bug-issue-template\" */ \"../bug-issue-template\")).default;\r\n            body = encodeURIComponent(templateStrFn(this.state.sentryEventId));\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n        window.open(`https://github.com/excalidraw/excalidraw/issues/new?body=${body}`);\r\n    }\r\n    errorSplash() {\r\n        return (<div className=\"ErrorSplash excalidraw\">\r\n        <div className=\"ErrorSplash-messageContainer\">\r\n          <div className=\"ErrorSplash-paragraph bigger align-center\">\r\n            {t(\"errorSplash.headingMain_pre\")}\r\n            <button onClick={() => window.location.reload()}>\r\n              {t(\"errorSplash.headingMain_button\")}\r\n            </button>\r\n          </div>\r\n          <div className=\"ErrorSplash-paragraph align-center\">\r\n            {t(\"errorSplash.clearCanvasMessage\")}\r\n            <button onClick={() => {\r\n                try {\r\n                    localStorage.clear();\r\n                    window.location.reload();\r\n                }\r\n                catch (error) {\r\n                    console.error(error);\r\n                }\r\n            }}>\r\n              {t(\"errorSplash.clearCanvasMessage_button\")}\r\n            </button>\r\n            <br />\r\n            <div className=\"smaller\">\r\n              <span role=\"img\" aria-label=\"warning\">\r\n                ⚠️\r\n              </span>\r\n              {t(\"errorSplash.clearCanvasCaveat\")}\r\n              <span role=\"img\" aria-hidden=\"true\">\r\n                ⚠️\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ErrorSplash-paragraph\">\r\n              {t(\"errorSplash.trackedToSentry_pre\")}\r\n              {this.state.sentryEventId}\r\n              {t(\"errorSplash.trackedToSentry_post\")}\r\n            </div>\r\n            <div className=\"ErrorSplash-paragraph\">\r\n              {t(\"errorSplash.openIssueMessage_pre\")}\r\n              <button onClick={() => this.createGithubIssue()}>\r\n                {t(\"errorSplash.openIssueMessage_button\")}\r\n              </button>\r\n              {t(\"errorSplash.openIssueMessage_post\")}\r\n            </div>\r\n            <div className=\"ErrorSplash-paragraph\">\r\n              <div className=\"ErrorSplash-details\">\r\n                <label>{t(\"errorSplash.sceneContent\")}</label>\r\n                <textarea rows={5} onPointerDown={this.selectTextArea} readOnly={true} value={this.state.localStorage}/>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>);\r\n    }\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { LoadingMessage } from \"./LoadingMessage\";\r\nimport { defaultLang, languages, setLanguage } from \"../i18n\";\r\nexport const InitializeApp = (props) => {\r\n  const [loading, setLoading] = useState(true);\r\n  useEffect(() => {\r\n    const updateLang = async () => {\r\n      await setLanguage(currentLang);\r\n    };\r\n    const currentLang =\r\n      languages.find((lang) => lang.code === props.langCode) || defaultLang;\r\n    updateLang();\r\n    setLoading(false);\r\n  }, [props.langCode]);\r\n  return loading ? <LoadingMessage /> : props.children;\r\n};\r\n","import React, { useEffect, forwardRef } from \"react\";\r\nimport { InitializeApp } from \"../../components/InitializeApp\";\r\nimport App from \"../../components/App\";\r\nimport \"../../css/app.scss\";\r\nimport \"../../css/styles.scss\";\r\nimport { defaultLang } from \"../../i18n\";\r\nimport { DEFAULT_UI_OPTIONS } from \"../../constants\";\r\nconst Excalidraw = (props) => {\r\n    const { onChange, initialData, excalidrawRef, onCollabButtonClick, isCollaborating, onPointerUpdate, renderTopRightUI, renderFooter, langCode = defaultLang.code, viewModeEnabled, zenModeEnabled, gridModeEnabled, libraryReturnUrl, theme, name, renderCustomStats, onPaste, detectScroll = true, handleKeyboardGlobally = false, onLibraryChange, autoFocus = false, generateIdForFile, } = props;\r\n    const canvasActions = props.UIOptions?.canvasActions;\r\n    const UIOptions = {\r\n        canvasActions: {\r\n            ...DEFAULT_UI_OPTIONS.canvasActions,\r\n            ...canvasActions,\r\n        },\r\n    };\r\n    if (canvasActions?.export) {\r\n        UIOptions.canvasActions.export.saveFileToDisk =\r\n            canvasActions.export?.saveFileToDisk ??\r\n                DEFAULT_UI_OPTIONS.canvasActions.export.saveFileToDisk;\r\n    }\r\n    useEffect(() => {\r\n        // Block pinch-zooming on iOS outside of the content area\r\n        const handleTouchMove = (event) => {\r\n            // @ts-ignore\r\n            if (typeof event.scale === \"number\" && event.scale !== 1) {\r\n                event.preventDefault();\r\n            }\r\n        };\r\n        document.addEventListener(\"touchmove\", handleTouchMove, {\r\n            passive: false,\r\n        });\r\n        return () => {\r\n            document.removeEventListener(\"touchmove\", handleTouchMove);\r\n        };\r\n    }, []);\r\n    return (<InitializeApp langCode={langCode}>\r\n      <App onChange={onChange} initialData={initialData} excalidrawRef={excalidrawRef} onCollabButtonClick={onCollabButtonClick} isCollaborating={isCollaborating} onPointerUpdate={onPointerUpdate} renderTopRightUI={renderTopRightUI} renderFooter={renderFooter} langCode={langCode} viewModeEnabled={viewModeEnabled} zenModeEnabled={zenModeEnabled} gridModeEnabled={gridModeEnabled} libraryReturnUrl={libraryReturnUrl} theme={theme} name={name} renderCustomStats={renderCustomStats} UIOptions={UIOptions} onPaste={onPaste} detectScroll={detectScroll} handleKeyboardGlobally={handleKeyboardGlobally} onLibraryChange={onLibraryChange} autoFocus={autoFocus} generateIdForFile={generateIdForFile}/>\r\n    </InitializeApp>);\r\n};\r\nconst areEqual = (prevProps, nextProps) => {\r\n    const { initialData: prevInitialData, UIOptions: prevUIOptions = {}, ...prev } = prevProps;\r\n    const { initialData: nextInitialData, UIOptions: nextUIOptions = {}, ...next } = nextProps;\r\n    // comparing UIOptions\r\n    const prevUIOptionsKeys = Object.keys(prevUIOptions);\r\n    const nextUIOptionsKeys = Object.keys(nextUIOptions);\r\n    if (prevUIOptionsKeys.length !== nextUIOptionsKeys.length) {\r\n        return false;\r\n    }\r\n    const isUIOptionsSame = prevUIOptionsKeys.every((key) => {\r\n        if (key === \"canvasActions\") {\r\n            const canvasOptionKeys = Object.keys(prevUIOptions.canvasActions);\r\n            canvasOptionKeys.every((key) => {\r\n                if (key === \"export\" &&\r\n                    prevUIOptions?.canvasActions?.export &&\r\n                    nextUIOptions?.canvasActions?.export) {\r\n                    return (prevUIOptions.canvasActions.export.saveFileToDisk ===\r\n                        nextUIOptions.canvasActions.export.saveFileToDisk);\r\n                }\r\n                return (prevUIOptions?.canvasActions?.[key] ===\r\n                    nextUIOptions?.canvasActions?.[key]);\r\n            });\r\n        }\r\n        return true;\r\n    });\r\n    const prevKeys = Object.keys(prevProps);\r\n    const nextKeys = Object.keys(nextProps);\r\n    return (isUIOptionsSame &&\r\n        prevKeys.length === nextKeys.length &&\r\n        prevKeys.every((key) => prev[key] === next[key]));\r\n};\r\nconst forwardedRefComp = forwardRef((props, ref) => <Excalidraw {...props} excalidrawRef={ref}/>);\r\nexport default React.memo(forwardedRefComp, areEqual);\r\nexport { getSceneVersion, getElementMap, isInvisiblySmallElement, getNonDeletedElements, } from \"../../element\";\r\nexport { defaultLang, languages } from \"../../i18n\";\r\nexport { restore, restoreAppState, restoreElements } from \"../../data/restore\";\r\nexport { exportToCanvas, exportToBlob, exportToSvg, serializeAsJSON, loadLibraryFromBlob, loadFromBlob, getFreeDrawSvgPath, } from \"../../packages/utils\";\r\nexport { isLinearElement } from \"../../element/typeChecks\";\r\nexport { FONT_FAMILY, THEME } from \"../../constants\";\r\nexport { mutateElement, newElementWith, bumpVersion, } from \"../../element/mutateElement\";\r\n","import { compressData } from \"../../data/encode\";\r\nimport { newElementWith } from \"../../element/mutateElement\";\r\nimport { isInitializedImageElement } from \"../../element/typeChecks\";\r\nimport { t } from \"../../i18n\";\r\nexport class FileManager {\r\n    constructor({ getFiles, saveFiles, }) {\r\n        /** files being fetched */\r\n        this.fetchingFiles = new Map();\r\n        /** files being saved */\r\n        this.savingFiles = new Map();\r\n        /* files already saved to persistent storage */\r\n        this.savedFiles = new Map();\r\n        this.erroredFiles = new Map();\r\n        /**\r\n         * returns whether file is already saved or being processed\r\n         */\r\n        this.isFileHandled = (id) => {\r\n            return (this.savedFiles.has(id) ||\r\n                this.fetchingFiles.has(id) ||\r\n                this.savingFiles.has(id) ||\r\n                this.erroredFiles.has(id));\r\n        };\r\n        this.isFileSaved = (id) => {\r\n            return this.savedFiles.has(id);\r\n        };\r\n        this.saveFiles = async ({ elements, files, }) => {\r\n            const addedFiles = new Map();\r\n            for (const element of elements) {\r\n                if (isInitializedImageElement(element) &&\r\n                    files[element.fileId] &&\r\n                    !this.isFileHandled(element.fileId)) {\r\n                    addedFiles.set(element.fileId, files[element.fileId]);\r\n                    this.savingFiles.set(element.fileId, true);\r\n                }\r\n            }\r\n            try {\r\n                const { savedFiles, erroredFiles } = await this._saveFiles({\r\n                    addedFiles,\r\n                });\r\n                for (const [fileId] of savedFiles) {\r\n                    this.savedFiles.set(fileId, true);\r\n                }\r\n                return {\r\n                    savedFiles,\r\n                    erroredFiles,\r\n                };\r\n            }\r\n            finally {\r\n                for (const [fileId] of addedFiles) {\r\n                    this.savingFiles.delete(fileId);\r\n                }\r\n            }\r\n        };\r\n        this.getFiles = async (ids) => {\r\n            if (!ids.length) {\r\n                return {\r\n                    loadedFiles: [],\r\n                    erroredFiles: new Map(),\r\n                };\r\n            }\r\n            for (const id of ids) {\r\n                this.fetchingFiles.set(id, true);\r\n            }\r\n            try {\r\n                const { loadedFiles, erroredFiles } = await this._getFiles(ids);\r\n                for (const file of loadedFiles) {\r\n                    this.savedFiles.set(file.id, true);\r\n                }\r\n                for (const [fileId] of erroredFiles) {\r\n                    this.erroredFiles.set(fileId, true);\r\n                }\r\n                return { loadedFiles, erroredFiles };\r\n            }\r\n            finally {\r\n                for (const id of ids) {\r\n                    this.fetchingFiles.delete(id);\r\n                }\r\n            }\r\n        };\r\n        /** a file element prevents unload only if it's being saved regardless of\r\n         *  its `status`. This ensures that elements who for any reason haven't\r\n         *  beed set to `saved` status don't prevent unload in future sessions.\r\n         *  Technically we should prevent unload when the origin client haven't\r\n         *  yet saved the `status` update to storage, but that should be taken care\r\n         *  of during regular beforeUnload unsaved files check.\r\n         */\r\n        this.shouldPreventUnload = (elements) => {\r\n            return elements.some((element) => {\r\n                return (isInitializedImageElement(element) &&\r\n                    !element.isDeleted &&\r\n                    this.savingFiles.has(element.fileId));\r\n            });\r\n        };\r\n        /**\r\n         * helper to determine if image element status needs updating\r\n         */\r\n        this.shouldUpdateImageElementStatus = (element) => {\r\n            return (isInitializedImageElement(element) &&\r\n                this.isFileSaved(element.fileId) &&\r\n                element.status === \"pending\");\r\n        };\r\n        this._getFiles = getFiles;\r\n        this._saveFiles = saveFiles;\r\n    }\r\n    reset() {\r\n        this.fetchingFiles.clear();\r\n        this.savingFiles.clear();\r\n        this.savedFiles.clear();\r\n        this.erroredFiles.clear();\r\n    }\r\n}\r\nexport const encodeFilesForUpload = async ({ files, maxBytes, encryptionKey, }) => {\r\n    const processedFiles = [];\r\n    for (const [id, fileData] of files) {\r\n        const buffer = new TextEncoder().encode(fileData.dataURL);\r\n        const encodedFile = await compressData(buffer, {\r\n            encryptionKey,\r\n            metadata: {\r\n                id,\r\n                mimeType: fileData.mimeType,\r\n                created: Date.now(),\r\n            },\r\n        });\r\n        if (buffer.byteLength > maxBytes) {\r\n            throw new Error(t(\"errors.fileTooBig\", {\r\n                maxSize: `${Math.trunc(maxBytes / 1024 / 1024)}MB`,\r\n            }));\r\n        }\r\n        processedFiles.push({\r\n            id,\r\n            buffer: encodedFile,\r\n        });\r\n    }\r\n    return processedFiles;\r\n};\r\nexport const updateStaleImageStatuses = (params) => {\r\n    if (!params.erroredFiles.size) {\r\n        return;\r\n    }\r\n    params.excalidrawAPI.updateScene({\r\n        elements: params.excalidrawAPI\r\n            .getSceneElementsIncludingDeleted()\r\n            .map((element) => {\r\n            if (isInitializedImageElement(element) &&\r\n                params.erroredFiles.has(element.fileId)) {\r\n                return newElementWith(element, {\r\n                    status: \"error\",\r\n                });\r\n            }\r\n            return element;\r\n        }),\r\n    });\r\n};\r\n","import { getSceneVersion } from \"../../element\";\r\nimport { restoreElements } from \"../../data/restore\";\r\nimport { FILE_CACHE_MAX_AGE_SEC } from \"../app_constants\";\r\nimport { decompressData } from \"../../data/encode\";\r\nimport { getImportedKey, createIV } from \"../../data/encryption\";\r\nimport { MIME_TYPES } from \"../../constants\";\r\n// private\r\n// -----------------------------------------------------------------------------\r\nconst FIREBASE_CONFIG = JSON.parse(process.env.REACT_APP_FIREBASE_CONFIG);\r\nlet firebasePromise = null;\r\nlet firestorePromise = null;\r\nlet firebaseStoragePromise = null;\r\nlet isFirebaseInitialized = false;\r\nconst _loadFirebase = async () => {\r\n    const firebase = (await import(/* webpackChunkName: \"firebase\" */ \"firebase/app\")).default;\r\n    if (!isFirebaseInitialized) {\r\n        try {\r\n            firebase.initializeApp(FIREBASE_CONFIG);\r\n        }\r\n        catch (error) {\r\n            // trying initialize again throws. Usually this is harmless, and happens\r\n            // mainly in dev (HMR)\r\n            if (error.code === \"app/duplicate-app\") {\r\n                console.warn(error.name, error.code);\r\n            }\r\n            else {\r\n                throw error;\r\n            }\r\n        }\r\n        isFirebaseInitialized = true;\r\n    }\r\n    return firebase;\r\n};\r\nconst _getFirebase = async () => {\r\n    if (!firebasePromise) {\r\n        firebasePromise = _loadFirebase();\r\n    }\r\n    return firebasePromise;\r\n};\r\n// -----------------------------------------------------------------------------\r\nconst loadFirestore = async () => {\r\n    const firebase = await _getFirebase();\r\n    if (!firestorePromise) {\r\n        firestorePromise = import(\r\n        /* webpackChunkName: \"firestore\" */ \"firebase/firestore\");\r\n    }\r\n    if (firestorePromise !== true) {\r\n        await firestorePromise;\r\n        firestorePromise = true;\r\n    }\r\n    return firebase;\r\n};\r\nexport const loadFirebaseStorage = async () => {\r\n    const firebase = await _getFirebase();\r\n    if (!firebaseStoragePromise) {\r\n        firebaseStoragePromise = import(\r\n        /* webpackChunkName: \"storage\" */ \"firebase/storage\");\r\n    }\r\n    if (firebaseStoragePromise !== true) {\r\n        await firebaseStoragePromise;\r\n        firebaseStoragePromise = true;\r\n    }\r\n    return firebase;\r\n};\r\nconst encryptElements = async (key, elements) => {\r\n    const importedKey = await getImportedKey(key, \"encrypt\");\r\n    const iv = createIV();\r\n    const json = JSON.stringify(elements);\r\n    const encoded = new TextEncoder().encode(json);\r\n    const ciphertext = await window.crypto.subtle.encrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, importedKey, encoded);\r\n    return { ciphertext, iv };\r\n};\r\nconst decryptElements = async (key, iv, ciphertext) => {\r\n    const importedKey = await getImportedKey(key, \"decrypt\");\r\n    const decrypted = await window.crypto.subtle.decrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, importedKey, ciphertext);\r\n    const decodedData = new TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));\r\n    return JSON.parse(decodedData);\r\n};\r\nconst firebaseSceneVersionCache = new WeakMap();\r\nexport const isSavedToFirebase = (portal, elements) => {\r\n    if (portal.socket && portal.roomId && portal.roomKey) {\r\n        const sceneVersion = getSceneVersion(elements);\r\n        return firebaseSceneVersionCache.get(portal.socket) === sceneVersion;\r\n    }\r\n    // if no room exists, consider the room saved so that we don't unnecessarily\r\n    // prevent unload (there's nothing we could do at that point anyway)\r\n    return true;\r\n};\r\nexport const saveFilesToFirebase = async ({ prefix, files, }) => {\r\n    const firebase = await loadFirebaseStorage();\r\n    const erroredFiles = new Map();\r\n    const savedFiles = new Map();\r\n    await Promise.all(files.map(async ({ id, buffer }) => {\r\n        try {\r\n            await firebase\r\n                .storage()\r\n                .ref(`${prefix}/${id}`)\r\n                .put(new Blob([buffer], {\r\n                type: MIME_TYPES.binary,\r\n            }), {\r\n                cacheControl: `public, max-age=${FILE_CACHE_MAX_AGE_SEC}`,\r\n            });\r\n            savedFiles.set(id, true);\r\n        }\r\n        catch (error) {\r\n            erroredFiles.set(id, true);\r\n        }\r\n    }));\r\n    return { savedFiles, erroredFiles };\r\n};\r\nexport const saveToFirebase = async (portal, elements) => {\r\n    const { roomId, roomKey, socket } = portal;\r\n    if (\r\n    // if no room exists, consider the room saved because there's nothing we can\r\n    // do at this point\r\n    !roomId ||\r\n        !roomKey ||\r\n        !socket ||\r\n        isSavedToFirebase(portal, elements)) {\r\n        return true;\r\n    }\r\n    const firebase = await loadFirestore();\r\n    const sceneVersion = getSceneVersion(elements);\r\n    const { ciphertext, iv } = await encryptElements(roomKey, elements);\r\n    const nextDocData = {\r\n        sceneVersion,\r\n        ciphertext: firebase.firestore.Blob.fromUint8Array(new Uint8Array(ciphertext)),\r\n        iv: firebase.firestore.Blob.fromUint8Array(iv),\r\n    };\r\n    const db = firebase.firestore();\r\n    const docRef = db.collection(\"scenes\").doc(roomId);\r\n    const didUpdate = await db.runTransaction(async (transaction) => {\r\n        const doc = await transaction.get(docRef);\r\n        if (!doc.exists) {\r\n            transaction.set(docRef, nextDocData);\r\n            return true;\r\n        }\r\n        const prevDocData = doc.data();\r\n        if (prevDocData.sceneVersion >= nextDocData.sceneVersion) {\r\n            return false;\r\n        }\r\n        transaction.update(docRef, nextDocData);\r\n        return true;\r\n    });\r\n    if (didUpdate) {\r\n        firebaseSceneVersionCache.set(socket, sceneVersion);\r\n    }\r\n    return didUpdate;\r\n};\r\nexport const loadFromFirebase = async (roomId, roomKey, socket) => {\r\n    const firebase = await loadFirestore();\r\n    const db = firebase.firestore();\r\n    const docRef = db.collection(\"scenes\").doc(roomId);\r\n    const doc = await docRef.get();\r\n    if (!doc.exists) {\r\n        return null;\r\n    }\r\n    const storedScene = doc.data();\r\n    const ciphertext = storedScene.ciphertext.toUint8Array();\r\n    const iv = storedScene.iv.toUint8Array();\r\n    const elements = await decryptElements(roomKey, iv, ciphertext);\r\n    if (socket) {\r\n        firebaseSceneVersionCache.set(socket, getSceneVersion(elements));\r\n    }\r\n    return restoreElements(elements, null);\r\n};\r\nexport const loadFilesFromFirebase = async (prefix, decryptionKey, filesIds) => {\r\n    const loadedFiles = [];\r\n    const erroredFiles = new Map();\r\n    await Promise.all([...new Set(filesIds)].map(async (id) => {\r\n        try {\r\n            const url = `https://firebasestorage.googleapis.com/v0/b/${FIREBASE_CONFIG.storageBucket}/o/${encodeURIComponent(prefix.replace(/^\\//, \"\"))}%2F${id}`;\r\n            const response = await fetch(`${url}?alt=media`);\r\n            if (response.status < 400) {\r\n                const arrayBuffer = await response.arrayBuffer();\r\n                const { data, metadata } = await decompressData(new Uint8Array(arrayBuffer), {\r\n                    decryptionKey,\r\n                });\r\n                const dataURL = new TextDecoder().decode(data);\r\n                loadedFiles.push({\r\n                    mimeType: metadata.mimeType || MIME_TYPES.binary,\r\n                    id,\r\n                    dataURL,\r\n                    created: metadata?.created || Date.now(),\r\n                });\r\n            }\r\n            else {\r\n                erroredFiles.set(id, true);\r\n            }\r\n        }\r\n        catch (error) {\r\n            erroredFiles.set(id, true);\r\n            console.error(error);\r\n        }\r\n    }));\r\n    return { loadedFiles, erroredFiles };\r\n};\r\n","import { createIV, generateEncryptionKey, getImportedKey, IV_LENGTH_BYTES, } from \"../../data/encryption\";\r\nimport { serializeAsJSON } from \"../../data/json\";\r\nimport { restore } from \"../../data/restore\";\r\nimport { isInitializedImageElement } from \"../../element/typeChecks\";\r\nimport { t } from \"../../i18n\";\r\nimport { FILE_UPLOAD_MAX_BYTES } from \"../app_constants\";\r\nimport { encodeFilesForUpload } from \"./FileManager\";\r\nimport { saveFilesToFirebase } from \"./firebase\";\r\nconst byteToHex = (byte) => `0${byte.toString(16)}`.slice(-2);\r\nconst BACKEND_V2_GET = process.env.REACT_APP_BACKEND_V2_GET_URL;\r\nconst BACKEND_V2_POST = process.env.REACT_APP_BACKEND_V2_POST_URL;\r\nconst generateRandomID = async () => {\r\n    const arr = new Uint8Array(10);\r\n    window.crypto.getRandomValues(arr);\r\n    return Array.from(arr, byteToHex).join(\"\");\r\n};\r\nexport const SOCKET_SERVER = process.env.REACT_APP_SOCKET_SERVER_URL;\r\nexport const encryptAESGEM = async (data, key) => {\r\n    const importedKey = await getImportedKey(key, \"encrypt\");\r\n    const iv = createIV();\r\n    return {\r\n        data: await window.crypto.subtle.encrypt({\r\n            name: \"AES-GCM\",\r\n            iv,\r\n        }, importedKey, data),\r\n        iv,\r\n    };\r\n};\r\nexport const decryptAESGEM = async (data, key, iv) => {\r\n    try {\r\n        const importedKey = await getImportedKey(key, \"decrypt\");\r\n        const decrypted = await window.crypto.subtle.decrypt({\r\n            name: \"AES-GCM\",\r\n            iv,\r\n        }, importedKey, data);\r\n        const decodedData = new TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));\r\n        return JSON.parse(decodedData);\r\n    }\r\n    catch (error) {\r\n        window.alert(t(\"alerts.decryptFailed\"));\r\n        console.error(error);\r\n    }\r\n    return {\r\n        type: \"INVALID_RESPONSE\",\r\n    };\r\n};\r\nexport const getCollaborationLinkData = (link) => {\r\n    const hash = new URL(link).hash;\r\n    const match = hash.match(/^#room=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);\r\n    if (match && match[2].length !== 22) {\r\n        window.alert(t(\"alerts.invalidEncryptionKey\"));\r\n        return null;\r\n    }\r\n    return match ? { roomId: match[1], roomKey: match[2] } : null;\r\n};\r\nexport const generateCollaborationLinkData = async () => {\r\n    const roomId = await generateRandomID();\r\n    const roomKey = await generateEncryptionKey();\r\n    if (!roomKey) {\r\n        throw new Error(\"Couldn't generate room key\");\r\n    }\r\n    return { roomId, roomKey };\r\n};\r\nexport const getCollaborationLink = (data) => {\r\n    return `${window.location.origin}${window.location.pathname}#room=${data.roomId},${data.roomKey}`;\r\n};\r\nexport const decryptImported = async (iv, encrypted, privateKey) => {\r\n    const key = await getImportedKey(privateKey, \"decrypt\");\r\n    return window.crypto.subtle.decrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, key, encrypted);\r\n};\r\nconst importFromBackend = async (id, privateKey) => {\r\n    try {\r\n        const response = await fetch(`${BACKEND_V2_GET}${id}`);\r\n        if (!response.ok) {\r\n            window.alert(t(\"alerts.importBackendFailed\"));\r\n            return {};\r\n        }\r\n        const buffer = await response.arrayBuffer();\r\n        let decrypted;\r\n        try {\r\n            // Buffer should contain both the IV (fixed length) and encrypted data\r\n            const iv = buffer.slice(0, IV_LENGTH_BYTES);\r\n            const encrypted = buffer.slice(IV_LENGTH_BYTES, buffer.byteLength);\r\n            decrypted = await decryptImported(iv, encrypted, privateKey);\r\n        }\r\n        catch (error) {\r\n            // Fixed IV (old format, backward compatibility)\r\n            const fixedIv = new Uint8Array(IV_LENGTH_BYTES);\r\n            decrypted = await decryptImported(fixedIv, buffer, privateKey);\r\n        }\r\n        // We need to convert the decrypted array buffer to a string\r\n        const string = new window.TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));\r\n        const data = JSON.parse(string);\r\n        return {\r\n            elements: data.elements || null,\r\n            appState: data.appState || null,\r\n        };\r\n    }\r\n    catch (error) {\r\n        window.alert(t(\"alerts.importBackendFailed\"));\r\n        console.error(error);\r\n        return {};\r\n    }\r\n};\r\nexport const loadScene = async (id, privateKey, \r\n// Supply local state even if importing from backend to ensure we restore\r\n// localStorage user settings which we do not persist on server.\r\n// Non-optional so we don't forget to pass it even if `undefined`.\r\nlocalDataState) => {\r\n    let data;\r\n    if (id != null && privateKey != null) {\r\n        // the private key is used to decrypt the content from the server, take\r\n        // extra care not to leak it\r\n        data = restore(await importFromBackend(id, privateKey), localDataState?.appState, localDataState?.elements);\r\n    }\r\n    else {\r\n        data = restore(localDataState || null, null, null);\r\n    }\r\n    return {\r\n        elements: data.elements,\r\n        appState: data.appState,\r\n        // note: this will always be empty because we're not storing files\r\n        // in the scene database/localStorage, and instead fetch them async\r\n        // from a different database\r\n        files: data.files,\r\n        commitToHistory: false,\r\n    };\r\n};\r\nexport const exportToBackend = async (elements, appState, files) => {\r\n    const json = serializeAsJSON(elements, appState, files, \"database\");\r\n    const encoded = new TextEncoder().encode(json);\r\n    const cryptoKey = await window.crypto.subtle.generateKey({\r\n        name: \"AES-GCM\",\r\n        length: 128,\r\n    }, true, // extractable\r\n    [\"encrypt\", \"decrypt\"]);\r\n    const iv = createIV();\r\n    // We use symmetric encryption. AES-GCM is the recommended algorithm and\r\n    // includes checks that the ciphertext has not been modified by an attacker.\r\n    const encrypted = await window.crypto.subtle.encrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, cryptoKey, encoded);\r\n    // Concatenate IV with encrypted data (IV does not have to be secret).\r\n    const payloadBlob = new Blob([iv.buffer, encrypted]);\r\n    const payload = await new Response(payloadBlob).arrayBuffer();\r\n    // We use jwk encoding to be able to extract just the base64 encoded key.\r\n    // We will hardcode the rest of the attributes when importing back the key.\r\n    const exportedKey = await window.crypto.subtle.exportKey(\"jwk\", cryptoKey);\r\n    try {\r\n        const filesMap = new Map();\r\n        for (const element of elements) {\r\n            if (isInitializedImageElement(element) && files[element.fileId]) {\r\n                filesMap.set(element.fileId, files[element.fileId]);\r\n            }\r\n        }\r\n        const encryptionKey = exportedKey.k;\r\n        const filesToUpload = await encodeFilesForUpload({\r\n            files: filesMap,\r\n            encryptionKey,\r\n            maxBytes: FILE_UPLOAD_MAX_BYTES,\r\n        });\r\n        const response = await fetch(BACKEND_V2_POST, {\r\n            method: \"POST\",\r\n            body: payload,\r\n        });\r\n        const json = await response.json();\r\n        if (json.id) {\r\n            const url = new URL(window.location.href);\r\n            // We need to store the key (and less importantly the id) as hash instead\r\n            // of queryParam in order to never send it to the server\r\n            url.hash = `json=${json.id},${encryptionKey}`;\r\n            const urlString = url.toString();\r\n            await saveFilesToFirebase({\r\n                prefix: `/files/shareLinks/${json.id}`,\r\n                files: filesToUpload,\r\n            });\r\n            window.prompt(`🔒${t(\"alerts.uploadedSecurly\")}`, urlString);\r\n        }\r\n        else if (json.error_class === \"RequestTooLargeError\") {\r\n            window.alert(t(\"alerts.couldNotCreateShareableLinkTooBig\"));\r\n        }\r\n        else {\r\n            window.alert(t(\"alerts.couldNotCreateShareableLink\"));\r\n        }\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        window.alert(t(\"alerts.couldNotCreateShareableLink\"));\r\n    }\r\n};\r\n","import { clearAppStateForLocalStorage, getDefaultAppState, } from \"../../appState\";\r\nimport { clearElementsForLocalStorage } from \"../../element\";\r\nimport { STORAGE_KEYS as APP_STORAGE_KEYS } from \"../../constants\";\r\nexport const STORAGE_KEYS = {\r\n    LOCAL_STORAGE_ELEMENTS: \"chalkboard\",\r\n    LOCAL_STORAGE_APP_STATE: \"chalkboard-state\",\r\n    LOCAL_STORAGE_COLLAB: \"chalkboard-collab\",\r\n    LOCAL_STORAGE_KEY_COLLAB_FORCE_FLAG: \"collabLinkForceLoadFlag\",\r\n};\r\nexport const saveUsernameToLocalStorage = (username) => {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB, JSON.stringify({ username }));\r\n    }\r\n    catch (error) {\r\n        // Unable to access window.localStorage\r\n        console.error(error);\r\n    }\r\n};\r\nexport const importUsernameFromLocalStorage = () => {\r\n    try {\r\n        const data = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\r\n        if (data) {\r\n            return JSON.parse(data).username;\r\n        }\r\n    }\r\n    catch (error) {\r\n        // Unable to access localStorage\r\n        console.error(error);\r\n    }\r\n    return null;\r\n};\r\nexport const saveToLocalStorage = (elements, appState) => {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS, JSON.stringify(clearElementsForLocalStorage(elements)));\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE, JSON.stringify(clearAppStateForLocalStorage(appState)));\r\n    }\r\n    catch (error) {\r\n        // Unable to access window.localStorage\r\n        console.error(error);\r\n    }\r\n};\r\nexport const importFromLocalStorage = () => {\r\n    let savedElements = null;\r\n    let savedState = null;\r\n    try {\r\n        savedElements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\r\n        savedState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\r\n    }\r\n    catch (error) {\r\n        // Unable to access localStorage\r\n        console.error(error);\r\n    }\r\n    let elements = [];\r\n    if (savedElements) {\r\n        try {\r\n            elements = clearElementsForLocalStorage(JSON.parse(savedElements));\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            // Do nothing because elements array is already empty\r\n        }\r\n    }\r\n    let appState = null;\r\n    if (savedState) {\r\n        try {\r\n            appState = {\r\n                ...getDefaultAppState(),\r\n                ...clearAppStateForLocalStorage(JSON.parse(savedState)),\r\n            };\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            // Do nothing because appState is already null\r\n        }\r\n    }\r\n    return { elements, appState };\r\n};\r\nexport const getElementsStorageSize = () => {\r\n    try {\r\n        const elements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\r\n        const elementsSize = elements?.length || 0;\r\n        return elementsSize;\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        return 0;\r\n    }\r\n};\r\nexport const getTotalStorageSize = () => {\r\n    try {\r\n        const appState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\r\n        const collab = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\r\n        const library = localStorage.getItem(APP_STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\r\n        const appStateSize = appState?.length || 0;\r\n        const collabSize = collab?.length || 0;\r\n        const librarySize = library?.length || 0;\r\n        return appStateSize + collabSize + librarySize + getElementsStorageSize();\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        return 0;\r\n    }\r\n};\r\n","import { encryptAESGEM, } from \"../data\";\r\nimport { BROADCAST, FILE_UPLOAD_TIMEOUT, SCENE } from \"../app_constants\";\r\nimport { trackEvent } from \"../../analytics\";\r\nimport { throttle } from \"lodash\";\r\nimport { newElementWith } from \"../../element/mutateElement\";\r\nclass Portal {\r\n    constructor(collab) {\r\n        this.socket = null;\r\n        this.socketInitialized = false; // we don't want the socket to emit any updates until it is fully initialized\r\n        this.roomId = null;\r\n        this.roomKey = null;\r\n        this.broadcastedElementVersions = new Map();\r\n        this.queueFileUpload = throttle(async () => {\r\n            try {\r\n                await this.collab.fileManager.saveFiles({\r\n                    elements: this.collab.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                    files: this.collab.excalidrawAPI.getFiles(),\r\n                });\r\n            }\r\n            catch (error) {\r\n                if (error.name !== \"AbortError\") {\r\n                    this.collab.excalidrawAPI.updateScene({\r\n                        appState: {\r\n                            errorMessage: error.message,\r\n                        },\r\n                    });\r\n                }\r\n            }\r\n            this.collab.excalidrawAPI.updateScene({\r\n                elements: this.collab.excalidrawAPI\r\n                    .getSceneElementsIncludingDeleted()\r\n                    .map((element) => {\r\n                    if (this.collab.fileManager.shouldUpdateImageElementStatus(element)) {\r\n                        // this will signal collaborators to pull image data from server\r\n                        // (using mutation instead of newElementWith otherwise it'd break\r\n                        // in-progress dragging)\r\n                        return newElementWith(element, { status: \"saved\" });\r\n                    }\r\n                    return element;\r\n                }),\r\n            });\r\n        }, FILE_UPLOAD_TIMEOUT);\r\n        this.broadcastScene = async (sceneType, allElements, syncAll) => {\r\n            if (sceneType === SCENE.INIT && !syncAll) {\r\n                throw new Error(\"syncAll must be true when sending SCENE.INIT\");\r\n            }\r\n            // sync out only the elements we think we need to to save bandwidth.\r\n            // periodically we'll resync the whole thing to make sure no one diverges\r\n            // due to a dropped message (server goes down etc).\r\n            const syncableElements = allElements.reduce((acc, element, idx, elements) => {\r\n                if ((syncAll ||\r\n                    !this.broadcastedElementVersions.has(element.id) ||\r\n                    element.version >\r\n                        this.broadcastedElementVersions.get(element.id)) &&\r\n                    this.collab.isSyncableElement(element)) {\r\n                    acc.push({\r\n                        ...element,\r\n                        // z-index info for the reconciler\r\n                        parent: idx === 0 ? \"^\" : elements[idx - 1]?.id,\r\n                    });\r\n                }\r\n                return acc;\r\n            }, []);\r\n            const data = {\r\n                type: sceneType,\r\n                payload: {\r\n                    elements: syncableElements,\r\n                },\r\n            };\r\n            for (const syncableElement of syncableElements) {\r\n                this.broadcastedElementVersions.set(syncableElement.id, syncableElement.version);\r\n            }\r\n            const broadcastPromise = this._broadcastSocketData(data);\r\n            this.queueFileUpload();\r\n            if (syncAll && this.collab.isCollaborating) {\r\n                await Promise.all([\r\n                    broadcastPromise,\r\n                    this.collab.saveCollabRoomToFirebase(syncableElements),\r\n                ]);\r\n            }\r\n            else {\r\n                await broadcastPromise;\r\n            }\r\n        };\r\n        this.broadcastIdleChange = (userState) => {\r\n            if (this.socket?.id) {\r\n                const data = {\r\n                    type: \"IDLE_STATUS\",\r\n                    payload: {\r\n                        socketId: this.socket.id,\r\n                        userState,\r\n                        username: this.collab.state.username,\r\n                    },\r\n                };\r\n                return this._broadcastSocketData(data, true);\r\n            }\r\n        };\r\n        this.broadcastMouseLocation = (payload) => {\r\n            if (this.socket?.id) {\r\n                const data = {\r\n                    type: \"MOUSE_LOCATION\",\r\n                    payload: {\r\n                        socketId: this.socket.id,\r\n                        pointer: payload.pointer,\r\n                        button: payload.button || \"up\",\r\n                        selectedElementIds: this.collab.excalidrawAPI.getAppState().selectedElementIds,\r\n                        username: this.collab.state.username,\r\n                    },\r\n                };\r\n                return this._broadcastSocketData(data, true);\r\n            }\r\n        };\r\n        this.collab = collab;\r\n    }\r\n    open(socket, id, key) {\r\n        this.socket = socket;\r\n        this.roomId = id;\r\n        this.roomKey = key;\r\n        // Initialize socket listeners\r\n        this.socket.on(\"init-room\", () => {\r\n            if (this.socket) {\r\n                this.socket.emit(\"join-room\", this.roomId);\r\n                trackEvent(\"share\", \"room joined\");\r\n            }\r\n        });\r\n        this.socket.on(\"new-user\", async (_socketId) => {\r\n            this.broadcastScene(SCENE.INIT, this.collab.getSceneElementsIncludingDeleted(), \r\n            /* syncAll */ true);\r\n        });\r\n        this.socket.on(\"room-user-change\", (clients) => {\r\n            this.collab.setCollaborators(clients);\r\n        });\r\n    }\r\n    close() {\r\n        if (!this.socket) {\r\n            return;\r\n        }\r\n        this.queueFileUpload.flush();\r\n        this.socket.close();\r\n        this.socket = null;\r\n        this.roomId = null;\r\n        this.roomKey = null;\r\n        this.socketInitialized = false;\r\n        this.broadcastedElementVersions = new Map();\r\n    }\r\n    isOpen() {\r\n        return !!(this.socketInitialized &&\r\n            this.socket &&\r\n            this.roomId &&\r\n            this.roomKey);\r\n    }\r\n    async _broadcastSocketData(data, volatile = false) {\r\n        if (this.isOpen()) {\r\n            const json = JSON.stringify(data);\r\n            const encoded = new TextEncoder().encode(json);\r\n            const encrypted = await encryptAESGEM(encoded, this.roomKey);\r\n            this.socket?.emit(volatile ? BROADCAST.SERVER_VOLATILE : BROADCAST.SERVER, this.roomId, encrypted.data, encrypted.iv);\r\n        }\r\n    }\r\n}\r\nexport default Portal;\r\n","import React, { useRef } from \"react\";\r\nimport { copyTextToSystemClipboard } from \"../../clipboard\";\r\nimport { Dialog } from \"../../components/Dialog\";\r\nimport { clipboard, start, stop, share, shareIOS, shareWindows, } from \"../../components/icons\";\r\nimport { ToolButton } from \"../../components/ToolButton\";\r\nimport { t } from \"../../i18n\";\r\nimport \"./RoomDialog.scss\";\r\nimport Stack from \"../../components/Stack\";\r\nconst getShareIcon = () => {\r\n    const navigator = window.navigator;\r\n    const isAppleBrowser = /Apple/.test(navigator.vendor);\r\n    const isWindowsBrowser = navigator.appVersion.indexOf(\"Win\") !== -1;\r\n    if (isAppleBrowser) {\r\n        return shareIOS;\r\n    }\r\n    else if (isWindowsBrowser) {\r\n        return shareWindows;\r\n    }\r\n    return share;\r\n};\r\nconst RoomDialog = ({ handleClose, activeRoomLink, username, onUsernameChange, onRoomCreate, onRoomDestroy, setErrorMessage, theme, }) => {\r\n    const roomLinkInput = useRef(null);\r\n    const copyRoomLink = async () => {\r\n        try {\r\n            await copyTextToSystemClipboard(activeRoomLink);\r\n        }\r\n        catch (error) {\r\n            setErrorMessage(error.message);\r\n        }\r\n        if (roomLinkInput.current) {\r\n            roomLinkInput.current.select();\r\n        }\r\n    };\r\n    const shareRoomLink = async () => {\r\n        try {\r\n            await navigator.share({\r\n                title: t(\"roomDialog.shareTitle\"),\r\n                text: t(\"roomDialog.shareTitle\"),\r\n                url: activeRoomLink,\r\n            });\r\n        }\r\n        catch (error) {\r\n            // Just ignore.\r\n        }\r\n    };\r\n    const selectInput = (event) => {\r\n        if (event.target !== document.activeElement) {\r\n            event.preventDefault();\r\n            event.target.select();\r\n        }\r\n    };\r\n    const renderRoomDialog = () => {\r\n        return (<div className=\"RoomDialog-modal\">\r\n        {!activeRoomLink && (<>\r\n            <p>{t(\"roomDialog.desc_intro\")}</p>\r\n            <p>{`🔒 ${t(\"roomDialog.desc_privacy\")}`}</p>\r\n            <div className=\"RoomDialog-sessionStartButtonContainer\">\r\n              <ToolButton className=\"RoomDialog-startSession\" type=\"button\" icon={start} title={t(\"roomDialog.button_startSession\")} aria-label={t(\"roomDialog.button_startSession\")} showAriaLabel={true} onClick={onRoomCreate}/>\r\n            </div>\r\n          </>)}\r\n        {activeRoomLink && (<>\r\n            <p>{t(\"roomDialog.desc_inProgressIntro\")}</p>\r\n            <p>{t(\"roomDialog.desc_shareLink\")}</p>\r\n            <div className=\"RoomDialog-linkContainer\">\r\n              <Stack.Row gap={2}>\r\n                {\"share\" in navigator ? (<ToolButton type=\"button\" icon={getShareIcon()} title={t(\"labels.share\")} aria-label={t(\"labels.share\")} onClick={shareRoomLink}/>) : null}\r\n                <ToolButton type=\"button\" icon={clipboard} title={t(\"labels.copy\")} aria-label={t(\"labels.copy\")} onClick={copyRoomLink}/>\r\n              </Stack.Row>\r\n              <input value={activeRoomLink} readOnly={true} className=\"RoomDialog-link\" ref={roomLinkInput} onPointerDown={selectInput}/>\r\n            </div>\r\n            <div className=\"RoomDialog-usernameContainer\">\r\n              <label className=\"RoomDialog-usernameLabel\" htmlFor=\"username\">\r\n                {t(\"labels.yourName\")}\r\n              </label>\r\n              <input id=\"username\" value={username || \"\"} className=\"RoomDialog-username TextInput\" onChange={(event) => onUsernameChange(event.target.value)} onKeyPress={(event) => event.key === \"Enter\" && handleClose()}/>\r\n            </div>\r\n            <p>\r\n              <span role=\"img\" aria-hidden=\"true\" className=\"RoomDialog-emoji\">\r\n                {\"🔒\"}\r\n              </span>{\" \"}\r\n              {t(\"roomDialog.desc_privacy\")}\r\n            </p>\r\n            <p>{t(\"roomDialog.desc_exitSession\")}</p>\r\n            <div className=\"RoomDialog-sessionStartButtonContainer\">\r\n              <ToolButton className=\"RoomDialog-stopSession\" type=\"button\" icon={stop} title={t(\"roomDialog.button_stopSession\")} aria-label={t(\"roomDialog.button_stopSession\")} showAriaLabel={true} onClick={onRoomDestroy}/>\r\n            </div>\r\n          </>)}\r\n      </div>);\r\n    };\r\n    return (<Dialog small onCloseRequest={handleClose} title={t(\"labels.liveCollaboration\")} theme={theme}>\r\n      {renderRoomDialog()}\r\n    </Dialog>);\r\n};\r\nexport default RoomDialog;\r\n","const shouldDiscardRemoteElement = (localAppState, local, remote) => {\r\n    if (local &&\r\n        // local element is being edited\r\n        (local.id === localAppState.editingElement?.id ||\r\n            local.id === localAppState.resizingElement?.id ||\r\n            local.id === localAppState.draggingElement?.id ||\r\n            // local element is newer\r\n            local.version > remote.version ||\r\n            // resolve conflicting edits deterministically by taking the one with\r\n            // the lowest versionNonce\r\n            (local.version === remote.version &&\r\n                local.versionNonce < remote.versionNonce))) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nconst getElementsMapWithIndex = (elements) => elements.reduce((acc, element, idx) => {\r\n    acc[element.id] = [element, idx];\r\n    return acc;\r\n}, {});\r\nexport const reconcileElements = (localElements, remoteElements, localAppState) => {\r\n    const localElementsData = getElementsMapWithIndex(localElements);\r\n    const reconciledElements = localElements.slice();\r\n    const duplicates = new WeakMap();\r\n    let cursor = 0;\r\n    let offset = 0;\r\n    let remoteElementIdx = -1;\r\n    for (const remoteElement of remoteElements) {\r\n        remoteElementIdx++;\r\n        const local = localElementsData[remoteElement.id];\r\n        if (shouldDiscardRemoteElement(localAppState, local?.[0], remoteElement)) {\r\n            if (remoteElement.parent) {\r\n                delete remoteElement.parent;\r\n            }\r\n            continue;\r\n        }\r\n        if (local) {\r\n            // mark for removal since it'll be replaced with the remote element\r\n            duplicates.set(local[0], true);\r\n        }\r\n        // parent may not be defined in case the remote client is running an older\r\n        // excalidraw version\r\n        const parent = remoteElement.parent || remoteElements[remoteElementIdx - 1]?.id || null;\r\n        if (parent != null) {\r\n            delete remoteElement.parent;\r\n            // ^ indicates the element is the first in elements array\r\n            if (parent === \"^\") {\r\n                offset++;\r\n                if (cursor === 0) {\r\n                    reconciledElements.unshift(remoteElement);\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        cursor - offset,\r\n                    ];\r\n                }\r\n                else {\r\n                    reconciledElements.splice(cursor + 1, 0, remoteElement);\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        cursor + 1 - offset,\r\n                    ];\r\n                    cursor++;\r\n                }\r\n            }\r\n            else {\r\n                let idx = localElementsData[parent]\r\n                    ? localElementsData[parent][1]\r\n                    : null;\r\n                if (idx != null) {\r\n                    idx += offset;\r\n                }\r\n                if (idx != null && idx >= cursor) {\r\n                    reconciledElements.splice(idx + 1, 0, remoteElement);\r\n                    offset++;\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        idx + 1 - offset,\r\n                    ];\r\n                    cursor = idx + 1;\r\n                }\r\n                else if (idx != null) {\r\n                    reconciledElements.splice(cursor + 1, 0, remoteElement);\r\n                    offset++;\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        cursor + 1 - offset,\r\n                    ];\r\n                    cursor++;\r\n                }\r\n                else {\r\n                    reconciledElements.push(remoteElement);\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        reconciledElements.length - 1 - offset,\r\n                    ];\r\n                }\r\n            }\r\n            // no parent z-index information, local element exists → replace in place\r\n        }\r\n        else if (local) {\r\n            reconciledElements[local[1]] = remoteElement;\r\n            localElementsData[remoteElement.id] = [remoteElement, local[1]];\r\n            // otherwise push to the end\r\n        }\r\n        else {\r\n            reconciledElements.push(remoteElement);\r\n            localElementsData[remoteElement.id] = [\r\n                remoteElement,\r\n                reconciledElements.length - 1 - offset,\r\n            ];\r\n        }\r\n    }\r\n    const ret = reconciledElements.filter((element) => !duplicates.has(element));\r\n    return ret;\r\n};\r\n","import throttle from \"lodash.throttle\";\r\nimport { PureComponent } from \"react\";\r\nimport { ErrorDialog } from \"../../components/ErrorDialog\";\r\nimport { APP_NAME, ENV, EVENT } from \"../../constants\";\r\nimport { getSceneVersion } from \"../../packages/excalidraw/index\";\r\nimport {\r\n  preventUnload,\r\n  resolvablePromise,\r\n  withBatchedUpdates,\r\n} from \"../../utils\";\r\nimport {\r\n  FILE_UPLOAD_MAX_BYTES,\r\n  FIREBASE_STORAGE_PREFIXES,\r\n  INITIAL_SCENE_UPDATE_TIMEOUT,\r\n  LOAD_IMAGES_TIMEOUT,\r\n  SCENE,\r\n  SYNC_FULL_SCENE_INTERVAL_MS,\r\n} from \"../app_constants\";\r\nimport {\r\n  decryptAESGEM,\r\n  generateCollaborationLinkData,\r\n  getCollaborationLink,\r\n  SOCKET_SERVER,\r\n} from \"../data\";\r\nimport {\r\n  isSavedToFirebase,\r\n  loadFilesFromFirebase,\r\n  loadFromFirebase,\r\n  saveFilesToFirebase,\r\n  saveToFirebase,\r\n} from \"../data/firebase\";\r\nimport {\r\n  importUsernameFromLocalStorage,\r\n  saveUsernameToLocalStorage,\r\n  STORAGE_KEYS,\r\n} from \"../data/localStorage\";\r\nimport Portal from \"./Portal\";\r\nimport RoomDialog from \"./RoomDialog\";\r\nimport { createInverseContext } from \"../../createInverseContext\";\r\nimport { t } from \"../../i18n\";\r\nimport { UserIdleState } from \"../../types\";\r\nimport { IDLE_THRESHOLD, ACTIVE_THRESHOLD } from \"../../constants\";\r\nimport { trackEvent } from \"../../analytics\";\r\nimport { isInvisiblySmallElement } from \"../../element\";\r\nimport {\r\n  encodeFilesForUpload,\r\n  FileManager,\r\n  updateStaleImageStatuses,\r\n} from \"../data/FileManager\";\r\nimport { AbortError } from \"../../errors\";\r\nimport {\r\n  isImageElement,\r\n  isInitializedImageElement,\r\n} from \"../../element/typeChecks\";\r\nimport { newElementWith } from \"../../element/mutateElement\";\r\nimport { reconcileElements as _reconcileElements } from \"./reconciliation\";\r\nconst {\r\n  Context: CollabContext,\r\n  Consumer: CollabContextConsumer,\r\n  Provider: CollabContextProvider,\r\n} = createInverseContext({ api: null });\r\nexport { CollabContext, CollabContextConsumer };\r\nclass CollabWrapper extends PureComponent {\r\n  constructor(props) {\r\n    super(props);\r\n    this.isCollaborating = false;\r\n    this.lastBroadcastedOrReceivedSceneVersion = -1;\r\n    this.collaborators = new Map();\r\n    this.onUnload = () => {\r\n      this.destroySocketClient({ isUnload: true });\r\n    };\r\n    this.beforeUnload = withBatchedUpdates((event) => {\r\n      const syncableElements = this.getSyncableElements(\r\n        this.getSceneElementsIncludingDeleted()\r\n      );\r\n      if (\r\n        this.isCollaborating &&\r\n        (this.fileManager.shouldPreventUnload(syncableElements) ||\r\n          !isSavedToFirebase(this.portal, syncableElements))\r\n      ) {\r\n        // this won't run in time if user decides to leave the site, but\r\n        //  the purpose is to run in immediately after user decides to stay\r\n        this.saveCollabRoomToFirebase(syncableElements);\r\n        preventUnload(event);\r\n      }\r\n      if (this.isCollaborating || this.portal.roomId) {\r\n        try {\r\n          localStorage?.setItem(\r\n            STORAGE_KEYS.LOCAL_STORAGE_KEY_COLLAB_FORCE_FLAG,\r\n            JSON.stringify({\r\n              timestamp: Date.now(),\r\n              room: this.portal.roomId,\r\n            })\r\n          );\r\n        } catch {}\r\n      }\r\n    });\r\n    this.saveCollabRoomToFirebase = async (\r\n      syncableElements = this.getSyncableElements(\r\n        this.excalidrawAPI.getSceneElementsIncludingDeleted()\r\n      )\r\n    ) => {\r\n      try {\r\n        await saveToFirebase(this.portal, syncableElements);\r\n      } catch (error) {\r\n        console.error(error);\r\n      }\r\n    };\r\n    this.openPortal = async () => {\r\n      trackEvent(\"share\", \"room creation\");\r\n      return this.initializeSocketClient(null);\r\n    };\r\n    this.closePortal = () => {\r\n      this.queueBroadcastAllElements.cancel();\r\n      this.loadImageFiles.cancel();\r\n      this.saveCollabRoomToFirebase();\r\n      if (window.confirm(t(\"alerts.collabStopOverridePrompt\"))) {\r\n        window.history.pushState({}, APP_NAME, window.location.origin);\r\n        this.destroySocketClient();\r\n        trackEvent(\"share\", \"room closed\");\r\n        this.props.onRoomClose?.();\r\n        const elements = this.excalidrawAPI\r\n          .getSceneElementsIncludingDeleted()\r\n          .map((element) => {\r\n            if (isImageElement(element) && element.status === \"saved\") {\r\n              return newElementWith(element, { status: \"pending\" });\r\n            }\r\n            return element;\r\n          });\r\n        this.excalidrawAPI.updateScene({\r\n          elements,\r\n          commitToHistory: false,\r\n        });\r\n      }\r\n    };\r\n    this.destroySocketClient = (opts) => {\r\n      if (!opts?.isUnload) {\r\n        this.collaborators = new Map();\r\n        this.excalidrawAPI.updateScene({\r\n          collaborators: this.collaborators,\r\n        });\r\n        this.setState({\r\n          activeRoomLink: \"\",\r\n        });\r\n        this.isCollaborating = false;\r\n      }\r\n      this.lastBroadcastedOrReceivedSceneVersion = -1;\r\n      this.portal.close();\r\n      this.fileManager.reset();\r\n    };\r\n    this.fetchImageFilesFromFirebase = async (scene) => {\r\n      const unfetchedImages = scene.elements\r\n        .filter((element) => {\r\n          return (\r\n            isInitializedImageElement(element) &&\r\n            !this.fileManager.isFileHandled(element.fileId) &&\r\n            !element.isDeleted &&\r\n            element.status === \"saved\"\r\n          );\r\n        })\r\n        .map((element) => element.fileId);\r\n      return await this.fileManager.getFiles(unfetchedImages);\r\n    };\r\n    this.initializeSocketClient = async (existingRoomLinkData) => {\r\n      if (this.portal.socket) {\r\n        return null;\r\n      }\r\n      let roomId;\r\n      let roomKey;\r\n      if (existingRoomLinkData) {\r\n        ({ roomId, roomKey } = existingRoomLinkData);\r\n      } else {\r\n        ({ roomId, roomKey } = await generateCollaborationLinkData());\r\n        window.history.pushState(\r\n          {},\r\n          APP_NAME,\r\n          getCollaborationLink({ roomId, roomKey })\r\n        );\r\n      }\r\n      const scenePromise = resolvablePromise();\r\n      this.isCollaborating = true;\r\n      const { default: socketIOClient } = await import(\r\n        /* webpackChunkName: \"socketIoClient\" */ \"socket.io-client\"\r\n      );\r\n      this.portal.open(socketIOClient(SOCKET_SERVER), roomId, roomKey);\r\n      if (existingRoomLinkData) {\r\n        this.excalidrawAPI.resetScene();\r\n        try {\r\n          const elements = await loadFromFirebase(\r\n            roomId,\r\n            roomKey,\r\n            this.portal.socket\r\n          );\r\n          if (elements) {\r\n            scenePromise.resolve({\r\n              elements,\r\n              scrollToContent: true,\r\n            });\r\n          }\r\n        } catch (error) {\r\n          // log the error and move on. other peers will sync us the scene.\r\n          console.error(error);\r\n        }\r\n      } else {\r\n        const elements = this.excalidrawAPI\r\n          .getSceneElements()\r\n          .map((element) => {\r\n            if (isImageElement(element) && element.status === \"saved\") {\r\n              return newElementWith(element, { status: \"pending\" });\r\n            }\r\n            return element;\r\n          });\r\n        // remove deleted elements from elements array & history to ensure we don't\r\n        // expose potentially sensitive user data in case user manually deletes\r\n        // existing elements (or clears scene), which would otherwise be persisted\r\n        // to database even if deleted before creating the room.\r\n        this.excalidrawAPI.history.clear();\r\n        this.excalidrawAPI.updateScene({\r\n          elements,\r\n          commitToHistory: true,\r\n        });\r\n        this.broadcastElements(elements);\r\n        const syncableElements = this.getSyncableElements(elements);\r\n        this.saveCollabRoomToFirebase(syncableElements);\r\n      }\r\n      // fallback in case you're not alone in the room but still don't receive\r\n      // initial SCENE_UPDATE message\r\n      this.socketInitializationTimer = window.setTimeout(() => {\r\n        this.initializeSocket();\r\n        scenePromise.resolve(null);\r\n      }, INITIAL_SCENE_UPDATE_TIMEOUT);\r\n      // All socket listeners are moving to Portal\r\n      this.portal.socket.on(\"client-broadcast\", async (encryptedData, iv) => {\r\n        if (!this.portal.roomKey) {\r\n          return;\r\n        }\r\n        const decryptedData = await decryptAESGEM(\r\n          encryptedData,\r\n          this.portal.roomKey,\r\n          iv\r\n        );\r\n        switch (decryptedData.type) {\r\n          case \"INVALID_RESPONSE\":\r\n            return;\r\n          case SCENE.INIT: {\r\n            if (!this.portal.socketInitialized) {\r\n              this.initializeSocket();\r\n              const remoteElements = decryptedData.payload.elements;\r\n              const reconciledElements = this.reconcileElements(remoteElements);\r\n              this.handleRemoteSceneUpdate(reconciledElements, {\r\n                init: true,\r\n              });\r\n              // noop if already resolved via init from firebase\r\n              scenePromise.resolve({\r\n                elements: reconciledElements,\r\n                scrollToContent: true,\r\n              });\r\n            }\r\n            break;\r\n          }\r\n          case SCENE.UPDATE:\r\n            this.handleRemoteSceneUpdate(\r\n              this.reconcileElements(decryptedData.payload.elements)\r\n            );\r\n            break;\r\n          case \"MOUSE_LOCATION\": {\r\n            const { pointer, button, username, selectedElementIds } =\r\n              decryptedData.payload;\r\n            const socketId =\r\n              decryptedData.payload.socketId ||\r\n              // @ts-ignore legacy, see #2094 (#2097)\r\n              decryptedData.payload.socketID;\r\n            const collaborators = new Map(this.collaborators);\r\n            const user = collaborators.get(socketId) || {};\r\n            user.pointer = pointer;\r\n            user.button = button;\r\n            user.selectedElementIds = selectedElementIds;\r\n            user.username = username;\r\n            collaborators.set(socketId, user);\r\n            this.excalidrawAPI.updateScene({\r\n              collaborators,\r\n            });\r\n            break;\r\n          }\r\n          case \"IDLE_STATUS\": {\r\n            const { userState, socketId, username } = decryptedData.payload;\r\n            const collaborators = new Map(this.collaborators);\r\n            const user = collaborators.get(socketId) || {};\r\n            user.userState = userState;\r\n            user.username = username;\r\n            this.excalidrawAPI.updateScene({\r\n              collaborators,\r\n            });\r\n            break;\r\n          }\r\n        }\r\n      });\r\n      this.portal.socket.on(\"first-in-room\", () => {\r\n        if (this.portal.socket) {\r\n          this.portal.socket.off(\"first-in-room\");\r\n        }\r\n        this.initializeSocket();\r\n        scenePromise.resolve(null);\r\n      });\r\n      this.initializeIdleDetector();\r\n      this.setState({\r\n        activeRoomLink: window.location.href,\r\n      });\r\n      return scenePromise;\r\n    };\r\n    this.initializeSocket = () => {\r\n      this.portal.socketInitialized = true;\r\n      clearTimeout(this.socketInitializationTimer);\r\n    };\r\n    this.reconcileElements = (remoteElements) => {\r\n      const localElements = this.getSceneElementsIncludingDeleted();\r\n      const appState = this.excalidrawAPI.getAppState();\r\n      const reconciledElements = _reconcileElements(\r\n        localElements,\r\n        remoteElements,\r\n        appState\r\n      );\r\n      // Avoid broadcasting to the rest of the collaborators the scene\r\n      // we just received!\r\n      // Note: this needs to be set before updating the scene as it\r\n      // synchronously calls render.\r\n      this.setLastBroadcastedOrReceivedSceneVersion(\r\n        getSceneVersion(reconciledElements)\r\n      );\r\n      return reconciledElements;\r\n    };\r\n    this.loadImageFiles = throttle(async () => {\r\n      const { loadedFiles, erroredFiles } =\r\n        await this.fetchImageFilesFromFirebase({\r\n          elements: this.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n        });\r\n      this.excalidrawAPI.addFiles(loadedFiles);\r\n      updateStaleImageStatuses({\r\n        excalidrawAPI: this.excalidrawAPI,\r\n        erroredFiles,\r\n        elements: this.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n      });\r\n    }, LOAD_IMAGES_TIMEOUT);\r\n    this.handleRemoteSceneUpdate = (elements, { init = false } = {}) => {\r\n      this.excalidrawAPI.updateScene({\r\n        elements,\r\n        commitToHistory: !!init,\r\n      });\r\n      // We haven't yet implemented multiplayer undo functionality, so we clear the undo stack\r\n      // when we receive any messages from another peer. This UX can be pretty rough -- if you\r\n      // undo, a user makes a change, and then try to redo, your element(s) will be lost. However,\r\n      // right now we think this is the right tradeoff.\r\n      this.excalidrawAPI.history.clear();\r\n      this.loadImageFiles();\r\n    };\r\n    this.onPointerMove = () => {\r\n      if (this.idleTimeoutId) {\r\n        window.clearTimeout(this.idleTimeoutId);\r\n        this.idleTimeoutId = null;\r\n      }\r\n      this.idleTimeoutId = window.setTimeout(this.reportIdle, IDLE_THRESHOLD);\r\n      if (!this.activeIntervalId) {\r\n        this.activeIntervalId = window.setInterval(\r\n          this.reportActive,\r\n          ACTIVE_THRESHOLD\r\n        );\r\n      }\r\n    };\r\n    this.onVisibilityChange = () => {\r\n      if (document.hidden) {\r\n        if (this.idleTimeoutId) {\r\n          window.clearTimeout(this.idleTimeoutId);\r\n          this.idleTimeoutId = null;\r\n        }\r\n        if (this.activeIntervalId) {\r\n          window.clearInterval(this.activeIntervalId);\r\n          this.activeIntervalId = null;\r\n        }\r\n        this.onIdleStateChange(UserIdleState.AWAY);\r\n      } else {\r\n        this.idleTimeoutId = window.setTimeout(this.reportIdle, IDLE_THRESHOLD);\r\n        this.activeIntervalId = window.setInterval(\r\n          this.reportActive,\r\n          ACTIVE_THRESHOLD\r\n        );\r\n        this.onIdleStateChange(UserIdleState.ACTIVE);\r\n      }\r\n    };\r\n    this.reportIdle = () => {\r\n      this.onIdleStateChange(UserIdleState.IDLE);\r\n      if (this.activeIntervalId) {\r\n        window.clearInterval(this.activeIntervalId);\r\n        this.activeIntervalId = null;\r\n      }\r\n    };\r\n    this.reportActive = () => {\r\n      this.onIdleStateChange(UserIdleState.ACTIVE);\r\n    };\r\n    this.initializeIdleDetector = () => {\r\n      document.addEventListener(EVENT.POINTER_MOVE, this.onPointerMove);\r\n      document.addEventListener(\r\n        EVENT.VISIBILITY_CHANGE,\r\n        this.onVisibilityChange\r\n      );\r\n    };\r\n    this.setLastBroadcastedOrReceivedSceneVersion = (version) => {\r\n      this.lastBroadcastedOrReceivedSceneVersion = version;\r\n    };\r\n    this.getLastBroadcastedOrReceivedSceneVersion = () => {\r\n      return this.lastBroadcastedOrReceivedSceneVersion;\r\n    };\r\n    this.getSceneElementsIncludingDeleted = () => {\r\n      return this.excalidrawAPI.getSceneElementsIncludingDeleted();\r\n    };\r\n    this.onPointerUpdate = (payload) => {\r\n      payload.pointersMap.size < 2 &&\r\n        this.portal.socket &&\r\n        this.portal.broadcastMouseLocation(payload);\r\n    };\r\n    this.onIdleStateChange = (userState) => {\r\n      this.setState({ userState });\r\n      this.portal.broadcastIdleChange(userState);\r\n    };\r\n    this.broadcastElements = (elements) => {\r\n      if (\r\n        getSceneVersion(elements) >\r\n        this.getLastBroadcastedOrReceivedSceneVersion()\r\n      ) {\r\n        this.portal.broadcastScene(SCENE.UPDATE, elements, false);\r\n        this.lastBroadcastedOrReceivedSceneVersion = getSceneVersion(elements);\r\n        this.queueBroadcastAllElements();\r\n      }\r\n    };\r\n    this.queueBroadcastAllElements = throttle(() => {\r\n      this.portal.broadcastScene(\r\n        SCENE.UPDATE,\r\n        this.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n        true\r\n      );\r\n      const currentVersion = this.getLastBroadcastedOrReceivedSceneVersion();\r\n      const newVersion = Math.max(\r\n        currentVersion,\r\n        getSceneVersion(this.getSceneElementsIncludingDeleted())\r\n      );\r\n      this.setLastBroadcastedOrReceivedSceneVersion(newVersion);\r\n    }, SYNC_FULL_SCENE_INTERVAL_MS);\r\n    this.handleClose = () => {\r\n      this.setState({ modalIsShown: false });\r\n    };\r\n    this.onUsernameChange = (username) => {\r\n      this.setState({ username });\r\n      saveUsernameToLocalStorage(username);\r\n    };\r\n    this.onCollabButtonClick = () => {\r\n      this.setState({\r\n        modalIsShown: true,\r\n      });\r\n    };\r\n    this.isSyncableElement = (element) => {\r\n      return element.isDeleted || !isInvisiblySmallElement(element);\r\n    };\r\n    this.getSyncableElements = (elements) =>\r\n      elements.filter((element) => this.isSyncableElement(element));\r\n    /** PRIVATE. Use `this.getContextValue()` instead. */\r\n    this.contextValue = null;\r\n    /** Getter of context value. Returned object is stable. */\r\n    this.getContextValue = () => {\r\n      if (!this.contextValue) {\r\n        this.contextValue = {};\r\n      }\r\n      this.contextValue.isCollaborating = () => this.isCollaborating;\r\n      this.contextValue.username = this.state.username;\r\n      this.contextValue.onPointerUpdate = this.onPointerUpdate;\r\n      this.contextValue.initializeSocketClient = this.initializeSocketClient;\r\n      this.contextValue.onCollabButtonClick = this.onCollabButtonClick;\r\n      this.contextValue.broadcastElements = this.broadcastElements;\r\n      this.contextValue.fetchImageFilesFromFirebase =\r\n        this.fetchImageFilesFromFirebase;\r\n      return this.contextValue;\r\n    };\r\n    this.state = {\r\n      modalIsShown: false,\r\n      errorMessage: \"\",\r\n      username: importUsernameFromLocalStorage() || \"\",\r\n      userState: UserIdleState.ACTIVE,\r\n      activeRoomLink: \"\",\r\n    };\r\n    this.portal = new Portal(this);\r\n    this.fileManager = new FileManager({\r\n      getFiles: async (fileIds) => {\r\n        const { roomId, roomKey } = this.portal;\r\n        if (!roomId || !roomKey) {\r\n          throw new AbortError();\r\n        }\r\n        return loadFilesFromFirebase(`files/rooms/${roomId}`, roomKey, fileIds);\r\n      },\r\n      saveFiles: async ({ addedFiles }) => {\r\n        const { roomId, roomKey } = this.portal;\r\n        if (!roomId || !roomKey) {\r\n          throw new AbortError();\r\n        }\r\n        return saveFilesToFirebase({\r\n          prefix: `${FIREBASE_STORAGE_PREFIXES.collabFiles}/${roomId}`,\r\n          files: await encodeFilesForUpload({\r\n            files: addedFiles,\r\n            encryptionKey: roomKey,\r\n            maxBytes: FILE_UPLOAD_MAX_BYTES,\r\n          }),\r\n        });\r\n      },\r\n    });\r\n    this.excalidrawAPI = props.excalidrawAPI;\r\n    this.activeIntervalId = null;\r\n    this.idleTimeoutId = null;\r\n  }\r\n  componentDidMount() {\r\n    window.addEventListener(EVENT.BEFORE_UNLOAD, this.beforeUnload);\r\n    window.addEventListener(EVENT.UNLOAD, this.onUnload);\r\n    if (\r\n      process.env.NODE_ENV === ENV.TEST ||\r\n      process.env.NODE_ENV === ENV.DEVELOPMENT\r\n    ) {\r\n      window.collab = window.collab || {};\r\n      Object.defineProperties(window, {\r\n        collab: {\r\n          configurable: true,\r\n          value: this,\r\n        },\r\n      });\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    window.removeEventListener(EVENT.BEFORE_UNLOAD, this.beforeUnload);\r\n    window.removeEventListener(EVENT.UNLOAD, this.onUnload);\r\n    window.removeEventListener(EVENT.POINTER_MOVE, this.onPointerMove);\r\n    window.removeEventListener(\r\n      EVENT.VISIBILITY_CHANGE,\r\n      this.onVisibilityChange\r\n    );\r\n    if (this.activeIntervalId) {\r\n      window.clearInterval(this.activeIntervalId);\r\n      this.activeIntervalId = null;\r\n    }\r\n    if (this.idleTimeoutId) {\r\n      window.clearTimeout(this.idleTimeoutId);\r\n      this.idleTimeoutId = null;\r\n    }\r\n  }\r\n  setCollaborators(sockets) {\r\n    this.setState((state) => {\r\n      const collaborators = new Map();\r\n      for (const socketId of sockets) {\r\n        if (this.collaborators.has(socketId)) {\r\n          collaborators.set(socketId, this.collaborators.get(socketId));\r\n        } else {\r\n          collaborators.set(socketId, {});\r\n        }\r\n      }\r\n      this.collaborators = collaborators;\r\n      this.excalidrawAPI.updateScene({ collaborators });\r\n    });\r\n  }\r\n  render() {\r\n    const { modalIsShown, username, errorMessage, activeRoomLink } = this.state;\r\n    return (\r\n      <>\r\n        {modalIsShown && (\r\n          <RoomDialog\r\n            handleClose={this.handleClose}\r\n            activeRoomLink={activeRoomLink}\r\n            username={username}\r\n            onUsernameChange={this.onUsernameChange}\r\n            onRoomCreate={this.openPortal}\r\n            onRoomDestroy={this.closePortal}\r\n            setErrorMessage={(errorMessage) => {\r\n              this.setState({ errorMessage });\r\n            }}\r\n            theme={this.excalidrawAPI.getAppState().theme}\r\n          />\r\n        )}\r\n        {errorMessage && (\r\n          <ErrorDialog\r\n            message={errorMessage}\r\n            onClose={() => this.setState({ errorMessage: \"\" })}\r\n          />\r\n        )}\r\n        <CollabContextProvider\r\n          value={{\r\n            api: this.getContextValue(),\r\n          }}\r\n        />\r\n      </>\r\n    );\r\n  }\r\n}\r\nif (\r\n  process.env.NODE_ENV === ENV.TEST ||\r\n  process.env.NODE_ENV === ENV.DEVELOPMENT\r\n) {\r\n  window.collab = window.collab || {};\r\n}\r\nexport default CollabWrapper;\r\n","import React from \"react\";\r\nexport const createInverseContext = (initialValue) => {\r\n    const Context = React.createContext(initialValue);\r\n    class InverseConsumer extends React.Component {\r\n        constructor(props) {\r\n            super(props);\r\n            this.state = { value: initialValue };\r\n            Context._updateProviderValue = (value) => this.setState({ value });\r\n        }\r\n        render() {\r\n            return (<Context.Provider value={this.state.value}>\r\n          {this.props.children}\r\n        </Context.Provider>);\r\n        }\r\n    }\r\n    class InverseProvider extends React.Component {\r\n        componentDidMount() {\r\n            Context._updateProviderValue?.(this.props.value);\r\n        }\r\n        componentDidUpdate() {\r\n            Context._updateProviderValue?.(this.props.value);\r\n        }\r\n        render() {\r\n            return <Context.Consumer>{() => this.props.children}</Context.Consumer>;\r\n        }\r\n    }\r\n    return {\r\n        Context,\r\n        Consumer: InverseConsumer,\r\n        Provider: InverseProvider,\r\n    };\r\n};\r\n","import { useEffect, useState } from \"react\";\r\nimport { debounce, getVersion, nFormatter } from \"../utils\";\r\nimport { getElementsStorageSize, getTotalStorageSize, } from \"./data/localStorage\";\r\nimport { DEFAULT_VERSION } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { copyTextToSystemClipboard } from \"../clipboard\";\r\nconst STORAGE_SIZE_TIMEOUT = 500;\r\nconst getStorageSizes = debounce((cb) => {\r\n    cb({\r\n        scene: getElementsStorageSize(),\r\n        total: getTotalStorageSize(),\r\n    });\r\n}, STORAGE_SIZE_TIMEOUT);\r\nconst CustomStats = (props) => {\r\n    const [storageSizes, setStorageSizes] = useState({\r\n        scene: 0,\r\n        total: 0,\r\n    });\r\n    useEffect(() => {\r\n        getStorageSizes((sizes) => {\r\n            setStorageSizes(sizes);\r\n        });\r\n    });\r\n    useEffect(() => () => getStorageSizes.cancel(), []);\r\n    const version = getVersion();\r\n    let hash;\r\n    let timestamp;\r\n    if (version !== DEFAULT_VERSION) {\r\n        timestamp = version.slice(0, 16).replace(\"T\", \" \");\r\n        hash = version.slice(21);\r\n    }\r\n    else {\r\n        timestamp = t(\"stats.versionNotAvailable\");\r\n    }\r\n    return (<>\r\n      <tr>\r\n        <th colSpan={2}>{t(\"stats.storage\")}</th>\r\n      </tr>\r\n      <tr>\r\n        <td>{t(\"stats.scene\")}</td>\r\n        <td>{nFormatter(storageSizes.scene, 1)}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{t(\"stats.total\")}</td>\r\n        <td>{nFormatter(storageSizes.total, 1)}</td>\r\n      </tr>\r\n      <tr>\r\n        <th colSpan={2}>{t(\"stats.version\")}</th>\r\n      </tr>\r\n      <tr>\r\n        <td colSpan={2} style={{ textAlign: \"center\", cursor: \"pointer\" }} onClick={async () => {\r\n            try {\r\n                await copyTextToSystemClipboard(getVersion());\r\n                props.setToastMessage(t(\"toast.copyToClipboard\"));\r\n            }\r\n            catch { }\r\n        }} title={t(\"stats.versionCopy\")}>\r\n          {timestamp}\r\n          <br />\r\n          {hash}\r\n        </td>\r\n      </tr>\r\n    </>);\r\n};\r\nexport default CustomStats;\r\n","import { createIcon } from \"../../components/icons\";\r\nexport const excalidrawPlusIcon = createIcon(<>\r\n    <path d=\"M72.652 63.598c-1.368.91-1.191 2.833-.953 4.572.702 5.104.47 5.323 1.073 7.016.649 1.826.433 2.553-.08 3.292-.406.588-1.207 1.371-1.906 1.516-.98.204-2.967.01-3.922-.246-.643-.174-1.292-.94-1.598-1.53-.389-.751-1.256-1.951-.694-3.593.56-1.64 1.325-5.374 1.363-6.108.098-1.904.02-3.934-1.085-5.014-1.104-1.082-3.941-1.055-5.739-1.038-1.723.017-3.583 1.207-5.045 1.141-1.343-.061-2.939-.686-3.728-1.536-.79-.852-1.082-2.469-1.007-3.57.074-1.1.726-2.398 1.454-3.033.727-.635 1.91-.867 2.909-.777 1.472.13 4.1 1.342 5.928 1.564 1.67.203 4.016.501 5.04-.227 1.021-.73 1.048-2.717 1.094-4.145.07-2.063-1.021-6.528-.683-8.23.22-1.098 1.709-1.696 2.717-1.979 1.007-.282 2.521-.125 3.328.285.788.398 1.499 1.29 1.516 2.173.031 1.68-1.209 5.66-1.322 7.905-.058 1.133-.61 3.124.482 3.764 1.264.74 2.95 1.778 7.1.673 1.765-.47 3.157-.689 4.62-.622 1.342.06 2.939.685 3.728 1.536.787.85 1.08 2.468 1.006 3.568-.074 1.101-.726 2.4-1.454 3.035-.727.634-1.908.866-2.908.777-1.473-.13-3.164-.68-4.88-1.248-2.526-.835-5.176-.708-6.354.079z\" fill=\"currentColor\"/>\r\n    <path d=\"M51.396 25.807c0 .237-.285.474-.617.474-.284 0-1.09 1.328-1.708 2.941-1.897 4.934-20.873 42.46-20.92 41.273 0-.616-.285-1.043-.76-1.043-.664 0-.759.38-.474 2.23.284 2.134.095 2.609-6.642 15.702-3.795 7.448-7.875 15.228-9.06 17.316-1.234 2.182-2.183 4.554-2.278 5.55-.142 1.708.047 1.945 4.175 5.503 2.372 2.088 5.408 4.697 6.736 5.883 5.978 5.456 8.777 7.638 9.536 7.496 1.138-.19 18.739-18.644 18.786-19.688 0-.475-.854-7.685-1.898-16.035-1.802-14.232-3.51-30.884-3.32-32.497.142-.996-.57-6.024-1.092-8.207-.426-1.708-.237-2.42 3.179-10.2 1.992-4.601 4.602-10.247 5.74-12.524 1.091-2.277 2.04-4.27 2.04-4.412 0-.142-.332-.237-.711-.237-.38 0-.712.19-.712.475zM40.485 61.245c.522 3.32 1.565 11.29 2.324 17.695 1.47 11.765 3.179 24.811 3.653 28.132.285 1.66.095 1.992-2.989 5.408-5.36 6.025-11.053 11.955-12.998 13.473l-1.803 1.423-9.25-8.634c-8.54-7.875-9.252-8.681-8.73-9.63.285-.522 2.704-4.934 5.361-9.773 2.657-4.839 6.167-11.29 7.78-14.327 1.66-3.084 3.179-5.74 3.463-5.882.332-.19.427 4.601.332 14.8-.19 15.23-.142 15.277 1.376 14.945.19 0 .332-7.686.332-17.031V74.86l4.981-9.963c2.752-5.503 5.03-9.915 5.124-9.867.095.047.57 2.846 1.044 6.215zM20.228 3.842c-3.51 2.799-8.919 7.543-13.189 11.623l-3.368 3.178.617 4.175c.332 2.277.949 6.736 1.328 9.867.427 3.132.854 6.073.996 6.5.19.57 0 .854-.521.854-.902 0-.95-.237 1.518 7.59.901 2.989 1.755 5.74 1.85 6.025.095.332.474.474.901.332.427-.19.664-.57.522-.901-.142-.38.095-.76.474-.902.522-.19.475-.569-.332-1.945-1.28-2.134-4.554-20.352-4.744-26.234-.142-4.175-.142-4.222 1.613-6.594 1.708-2.325 5.646-5.835 11.718-10.295 1.708-1.28 3.416-2.704 3.89-3.178.712-.854 1.044-.617 7.021 5.74 3.463 3.653 7.306 7.4 8.54 8.35l2.277 1.707-1.756 3.7c-.948 1.993-4.791 9.678-8.586 16.984-7.923 15.37-6.31 13.9-15.513 14.043l-5.978.047-1.992 2.277c-2.088 2.42-2.372 3.32-1.376 4.839.38.522.664 1.376.664 1.898 0 .854.332.996 2.23 1.09 1.186.048 2.277.19 2.42.333.142.142.331 3.083.474 6.547l.19 6.262-3.179 6.831c-5.266 11.386-7.353 16.604-7.353 18.312 0 .901.19 1.66.38 1.66.474 0 .474-.047 19.782-40.324 8.966-18.691 17.458-36.292 18.881-39.185 1.423-2.894 2.704-5.55 2.799-5.93.095-.427-3.178-3.7-8.397-8.303-4.696-4.174-8.824-7.97-9.203-8.396-1.091-1.329-2.704-.902-5.598 1.423zm-2.372 62.147c-.38.996-1.376 3.083-2.183 4.649-1.328 2.656-1.47 2.751-1.802 1.66-.19-.664-.332-2.61-.38-4.364-.047-3.464-.142-3.416 3.843-3.653l1.28-.048-.758 1.756zm3.985-7.59c-2.183 4.221-2.277 4.269-8.255 4.553-5.266.285-5.36.238-5.36-.759 0-.569-.19-1.328-.428-1.708-.284-.426-.094-1.186.57-2.23l1.043-1.612h4.744c2.61-.048 5.598-.237 6.642-.427 1.044-.19 1.945-.285 2.04-.237.095.047-.38 1.138-.996 2.42zm-.19-43.266c-.854.616-1.091 1.233-1.091 2.799 0 1.85.142 2.134 1.423 2.656 1.28.522 1.613.475 3.084-.522 1.945-1.328 1.992-1.66.569-3.795-1.234-1.85-2.467-2.182-3.985-1.138z\" fill=\"currentColor\"/>\r\n    <path d=\"M50.141 24.917c.352-.615 1.06-1.085 1.967-1.085.804 0 1.477.34 1.734.597.342.342.477.74.477 1.14 0 .089-.006.305-.119.612-.168.461-1.056 2.337-2.08 4.471-1.131 2.264-3.724 7.875-5.708 12.457-1.671 3.806-2.558 5.881-2.97 7.216-.301.975-.279 1.406-.123 2.032.558 2.33 1.27 7.704 1.122 8.73-.187 1.596 1.537 18.06 3.32 32.136 1.056 8.446 1.91 15.74 1.91 16.22l-.002.07c-.009.184-.087.607-.447 1.14-.506.747-1.932 2.414-3.805 4.476-4.242 4.672-10.806 11.46-13.673 14.059-.682.617-1.199 1.023-1.472 1.182a1.872 1.872 0 01-.612.236c-.41.077-1.225-.015-2.35-.737-1.495-.959-4.19-3.217-8.46-7.114-1.327-1.184-4.36-3.79-6.718-5.865-1.712-1.476-2.767-2.405-3.411-3.096-.677-.727-.994-1.291-1.16-1.839-.165-.544-.18-1.09-.117-1.847.104-1.1 1.103-3.737 2.466-6.15 1.182-2.08 5.247-9.833 9.031-17.26 3.34-6.491 5.06-9.853 5.906-11.859.677-1.603.696-2.113.587-2.93-.18-1.168-.195-1.884-.111-2.308.1-.511.321-.851.58-1.1.346-.331.813-.55 1.488-.55.199 0 .391.024.574.07 4.068-7.268 18.093-35.143 19.705-39.334.585-1.53 1.353-2.823 1.794-3.288.228-.24.462-.39.677-.482zM38.72 59.573a448.835 448.835 0 00-3.06 5.995l-4.823 9.646v16.63c0 8.501-.124 15.643-.287 16.987-.142 1.166-1.002 1.462-1.384 1.526l.16-.017c-.671.147-1.214.135-1.647-.047-.495-.209-1.058-.629-1.33-1.813-.332-1.439-.336-5.202-.22-14.563.04-4.272.047-7.59.016-9.984-.33.582-.666 1.188-.986 1.783-1.615 3.04-5.13 9.5-7.79 14.345-2.383 4.34-4.576 8.338-5.207 9.493.131.186.356.489.61.77 1.165 1.287 3.451 3.428 7.667 7.316l8.316 7.76.798-.63c1.917-1.495 7.517-7.35 12.808-13.295.898-.995 1.544-1.72 2-2.29.37-.464.594-.76.675-1.06.067-.247.004-.478-.051-.8l-.007-.041c-.475-3.324-2.184-16.382-3.657-28.168-.757-6.384-1.797-14.328-2.317-17.639l-.004-.023c-.089-.635-.185-1.272-.28-1.881zM19.289 2.67c1.673-1.343 3-2.096 4.04-2.364 1.537-.394 2.687.004 3.621 1.119.396.44 4.46 4.165 9.071 8.264 4.274 3.769 7.265 6.676 8.244 7.909.69.868.68 1.598.625 1.844-.002.013-.006.026-.009.038-.1.398-1.416 3.195-2.908 6.228-1.423 2.893-9.912 20.488-18.875 39.173C7.581 97.252 4.465 103.75 3.6 105.058c-.497.751-.885.854-1.111.924a1.729 1.729 0 01-.526.076c-.42 0-.964-.148-1.368-.767-.223-.342-.511-1.288-.511-2.394 0-.606.19-1.592.67-3.03.955-2.866 3.1-7.864 6.821-15.911l3.03-6.513-.178-5.89a153.908 153.908 0 00-.33-5.346c-.352-.041-.773-.081-1.14-.096-.98-.049-1.616-.131-2.03-.261-.645-.204-1.016-.535-1.267-.928-.221-.348-.358-.79-.358-1.4 0-.282-.173-.735-.377-1.016l-.04-.059c-.621-.945-.859-1.757-.79-2.608.085-1.023.72-2.222 2.283-4.034l1.607-1.836c-.218-.687-.996-3.199-1.807-5.89-1.558-4.942-2.122-6.841-2.152-7.56-.034-.83.282-1.245.57-1.51a1.53 1.53 0 01.406-.265c-.217-1.235-.55-3.498-.875-5.878a488.89 488.89 0 00-1.323-9.829l-.617-4.175a1.5 1.5 0 01.455-1.31l3.361-3.172c4.301-4.11 9.749-8.888 13.287-11.709zm-3.879 71.31c-.31.283-.612.394-.858.441a1.547 1.547 0 01-1.04-.132l.103 3.418v.018l1.795-3.746zm12.426 1.473a23.55 23.55 0 01-.225.553 43.912 43.912 0 01-.763 1.686c.328-.11.65-.094.966.015l.022.008v-2.262zm1.524-3.996l-.032.037a1.575 1.575 0 01-.862.5c.042.411.057.798 0 1.25l.894-1.787zM16.286 65.87c-.566.056-1.034.117-1.267.149-.014.118-.03.275-.035.408-.012.4-.001.889.007 1.466.006.237.014.477.024.716.49-.997.97-2.02 1.271-2.739zm4.486-3.076a4.31 4.31 0 01-.88.654c.136.22.21.469.22.721l.281-.585.38-.79zm-.299-5.017c-1.381.168-3.98.324-6.29.365h-3.956l-.594.92c-.19.298-.36.7-.429.874.215.444.399 1.073.478 1.666h.014c.771.012 1.964-.048 3.819-.148 2.63-.125 3.979-.11 4.898-.616.326-.18.561-.453.817-.83.374-.551.75-1.276 1.243-2.23zm4.52-3.77a6.345 6.345 0 01-1.098.892c.156.141.3.333.383.595l.714-1.487zm15.241-3.122c-.47.934-.941 1.866-1.41 2.789.6-.264 1.192-.034 1.288.014.079.04.308.15.517.425a27.335 27.335 0 00-.224-1.044c-.185-.74-.289-1.336-.17-2.184zM24.148 5.38c-.758.673-2.198 1.856-3.649 2.944-5.896 4.33-9.738 7.717-11.4 9.978-.594.803-.97 1.279-1.177 1.801-.316.802-.217 1.685-.143 3.852.132 4.065 1.762 14.092 3.157 20.466.555 2.535 1.023 4.46 1.383 5.059.528.9.771 1.5.842 1.889.088.484.016.86-.118 1.167a1.86 1.86 0 01-.27.446l2.687-.021c1.825-.028 3.22.008 4.349-.038.897-.038 1.587-.111 2.187-.396.71-.336 1.26-.968 1.948-2.018 1.313-2.003 2.904-5.314 5.721-10.782 3.785-7.286 7.618-14.95 8.563-16.935l1.23-2.593-1.311-.984c-1.258-.967-5.182-4.782-8.717-8.51-2.604-2.769-4.52-4.608-5.282-5.325zm-11.86 47.181l-.001-.003-.026-.064.027.067zm-1.503-1.764l.059-.024a1.07 1.07 0 00-.059.024zm42.106-24.884l-.002.022.001-.009.001-.013zm.003-.035l.002-.071-.002.071zM20.773 13.917c-1.241.896-1.713 1.74-1.713 4.015 0 1.663.252 2.444.727 3.002.334.391.822.714 1.63 1.043.743.303 1.275.437 1.771.44.735.005 1.457-.254 2.72-1.109 1.495-1.02 2.072-1.825 2.19-2.615.111-.744-.188-1.715-1.214-3.254-.872-1.307-1.805-2.006-2.727-2.266-1.036-.292-2.15-.105-3.356.723l-.028.02zm4.263 4.285c-.128-.242-.375-.69-.648-1.099-.4-.598-.691-1.03-1.123-1.056-.24-.015-.473.123-.744.308-.461.337-.461.721-.461 1.577 0 .417.04.883.058 1.064.1.052.282.142.431.203.283.115.47.216.66.218.084 0 .152-.057.255-.113.215-.115.46-.275.757-.476.311-.213.632-.472.815-.626zM19.293 2.669l-.005.003.005-.003z\" fill=\"currentColor\"/>\r\n  </>, { width: 89, height: 131, style: { transform: \"translateX(4px)\" } });\r\n","import React from \"react\";\r\nimport { Card } from \"../../components/Card\";\r\nimport { ToolButton } from \"../../components/ToolButton\";\r\nimport { serializeAsJSON } from \"../../data/json\";\r\nimport { loadFirebaseStorage, saveFilesToFirebase } from \"../data/firebase\";\r\nimport { nanoid } from \"nanoid\";\r\nimport { t } from \"../../i18n\";\r\nimport { excalidrawPlusIcon } from \"./icons\";\r\nimport { encryptData, generateEncryptionKey } from \"../../data/encryption\";\r\nimport { isInitializedImageElement } from \"../../element/typeChecks\";\r\nimport { FILE_UPLOAD_MAX_BYTES } from \"../app_constants\";\r\nimport { encodeFilesForUpload } from \"../data/FileManager\";\r\nimport { MIME_TYPES } from \"../../constants\";\r\nconst exportToExcalidrawPlus = async (elements, appState, files) => {\r\n    const firebase = await loadFirebaseStorage();\r\n    const id = `${nanoid(12)}`;\r\n    const encryptionKey = (await generateEncryptionKey());\r\n    const encryptedData = await encryptData(encryptionKey, serializeAsJSON(elements, appState, files, \"database\"));\r\n    const blob = new Blob([encryptedData.iv, new Uint8Array(encryptedData.encryptedBuffer)], {\r\n        type: MIME_TYPES.binary,\r\n    });\r\n    await firebase\r\n        .storage()\r\n        .ref(`/migrations/scenes/${id}`)\r\n        .put(blob, {\r\n        customMetadata: {\r\n            data: JSON.stringify({ version: 2, name: appState.name }),\r\n            created: Date.now().toString(),\r\n        },\r\n    });\r\n    const filesMap = new Map();\r\n    for (const element of elements) {\r\n        if (isInitializedImageElement(element) && files[element.fileId]) {\r\n            filesMap.set(element.fileId, files[element.fileId]);\r\n        }\r\n    }\r\n    if (filesMap.size) {\r\n        const filesToUpload = await encodeFilesForUpload({\r\n            files: filesMap,\r\n            encryptionKey,\r\n            maxBytes: FILE_UPLOAD_MAX_BYTES,\r\n        });\r\n        await saveFilesToFirebase({\r\n            prefix: `/migrations/files/scenes/${id}`,\r\n            files: filesToUpload,\r\n        });\r\n    }\r\n    window.open(`https://plus.excalidraw.com/import?excalidraw=${id},${encryptionKey}`);\r\n};\r\nexport const ExportToExcalidrawPlus = ({ elements, appState, files, onError }) => {\r\n    return (<Card color=\"indigo\">\r\n      <div className=\"Card-icon\">{excalidrawPlusIcon}</div>\r\n      <h2>Excalidraw+</h2>\r\n      <div className=\"Card-details\">\r\n        {t(\"exportDialog.excalidrawplus_description\")}\r\n      </div>\r\n      <ToolButton className=\"Card-button\" type=\"button\" title={t(\"exportDialog.excalidrawplus_button\")} aria-label={t(\"exportDialog.excalidrawplus_button\")} showAriaLabel={true} onClick={async () => {\r\n            try {\r\n                await exportToExcalidrawPlus(elements, appState, files);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n                if (error.name !== \"AbortError\") {\r\n                    onError(new Error(t(\"exportDialog.excalidrawplus_exportError\")));\r\n                }\r\n            }\r\n        }}/>\r\n    </Card>);\r\n};\r\n","import LanguageDetector from \"i18next-browser-languagedetector\";\r\nimport { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { trackEvent } from \"../analytics\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { ErrorDialog } from \"../components/ErrorDialog\";\r\nimport { TopErrorBoundary } from \"../components/TopErrorBoundary\";\r\nimport { APP_NAME, EVENT, STORAGE_KEYS, TITLE_TIMEOUT, URL_HASH_KEYS, VERSION_TIMEOUT, } from \"../constants\";\r\nimport { loadFromBlob } from \"../data/blob\";\r\nimport { useCallbackRefState } from \"../hooks/useCallbackRefState\";\r\nimport { t } from \"../i18n\";\r\nimport Excalidraw, { defaultLang, languages, } from \"../packages/excalidraw/index\";\r\nimport { debounce, getVersion, preventUnload, resolvablePromise, } from \"../utils\";\r\nimport { FIREBASE_STORAGE_PREFIXES, SAVE_TO_LOCAL_STORAGE_TIMEOUT, } from \"./app_constants\";\r\nimport CollabWrapper, { CollabContext, CollabContextConsumer, } from \"./collab/CollabWrapper\";\r\nimport { exportToBackend, getCollaborationLinkData, loadScene } from \"./data\";\r\nimport { importFromLocalStorage, saveToLocalStorage, } from \"./data/localStorage\";\r\nimport CustomStats from \"./CustomStats\";\r\nimport { restoreAppState } from \"../data/restore\";\r\nimport { Tooltip } from \"../components/Tooltip\";\r\nimport { shield } from \"../components/icons\";\r\nimport \"./index.scss\";\r\nimport { ExportToExcalidrawPlus } from \"./components/ExportToExcalidrawPlus\";\r\nimport { getMany, set, del, keys, createStore } from \"idb-keyval\";\r\nimport { FileManager, updateStaleImageStatuses } from \"./data/FileManager\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { isInitializedImageElement } from \"../element/typeChecks\";\r\nimport { loadFilesFromFirebase } from \"./data/firebase\";\r\nconst filesStore = createStore(\"files-db\", \"files-store\");\r\nconst clearObsoleteFilesFromIndexedDB = async (opts) => {\r\n    const allIds = await keys(filesStore);\r\n    for (const id of allIds) {\r\n        if (!opts.currentFileIds.includes(id)) {\r\n            del(id, filesStore);\r\n        }\r\n    }\r\n};\r\nconst localFileStorage = new FileManager({\r\n    getFiles(ids) {\r\n        return getMany(ids, filesStore).then((filesData) => {\r\n            const loadedFiles = [];\r\n            const erroredFiles = new Map();\r\n            filesData.forEach((data, index) => {\r\n                const id = ids[index];\r\n                if (data) {\r\n                    loadedFiles.push(data);\r\n                }\r\n                else {\r\n                    erroredFiles.set(id, true);\r\n                }\r\n            });\r\n            return { loadedFiles, erroredFiles };\r\n        });\r\n    },\r\n    async saveFiles({ addedFiles }) {\r\n        const savedFiles = new Map();\r\n        const erroredFiles = new Map();\r\n        await Promise.all([...addedFiles].map(async ([id, fileData]) => {\r\n            try {\r\n                await set(id, fileData, filesStore);\r\n                savedFiles.set(id, true);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n                erroredFiles.set(id, true);\r\n            }\r\n        }));\r\n        return { savedFiles, erroredFiles };\r\n    },\r\n});\r\nconst languageDetector = new LanguageDetector();\r\nlanguageDetector.init({\r\n    languageUtils: {\r\n        formatLanguageCode: (langCode) => langCode,\r\n        isWhitelisted: () => true,\r\n    },\r\n    checkWhitelist: false,\r\n});\r\nconst saveDebounced = debounce(async (elements, appState, files, onFilesSaved) => {\r\n    saveToLocalStorage(elements, appState);\r\n    await localFileStorage.saveFiles({\r\n        elements,\r\n        files,\r\n    });\r\n    onFilesSaved();\r\n}, SAVE_TO_LOCAL_STORAGE_TIMEOUT);\r\nconst onBlur = () => {\r\n    saveDebounced.flush();\r\n};\r\nconst initializeScene = async (opts) => {\r\n    const searchParams = new URLSearchParams(window.location.search);\r\n    const id = searchParams.get(\"id\");\r\n    const jsonBackendMatch = window.location.hash.match(/^#json=([0-9]+),([a-zA-Z0-9_-]+)$/);\r\n    const externalUrlMatch = window.location.hash.match(/^#url=(.*)$/);\r\n    const localDataState = null;\r\n    let scene = await loadScene(null, null, localDataState);\r\n    let roomLinkData = getCollaborationLinkData(window.location.href);\r\n    const isExternalScene = !!(id || jsonBackendMatch || roomLinkData);\r\n    if (isExternalScene) {\r\n        if (\r\n        // don't prompt if scene is empty\r\n        !scene.elements.length ||\r\n            // don't prompt for collab scenes because we don't override local storage\r\n            roomLinkData ||\r\n            // otherwise, prompt whether user wants to override current scene\r\n            window.confirm(t(\"alerts.loadSceneOverridePrompt\"))) {\r\n            if (jsonBackendMatch) {\r\n                scene = await loadScene(jsonBackendMatch[1], jsonBackendMatch[2], localDataState);\r\n            }\r\n            scene.scrollToContent = true;\r\n            if (!roomLinkData) {\r\n                window.history.replaceState({}, APP_NAME, window.location.origin);\r\n            }\r\n        }\r\n        else {\r\n            // https://github.com/excalidraw/excalidraw/issues/1919\r\n            if (document.hidden) {\r\n                return new Promise((resolve, reject) => {\r\n                    window.addEventListener(\"focus\", () => initializeScene(opts).then(resolve).catch(reject), {\r\n                        once: true,\r\n                    });\r\n                });\r\n            }\r\n            roomLinkData = null;\r\n            window.history.replaceState({}, APP_NAME, window.location.origin);\r\n        }\r\n    }\r\n    else if (externalUrlMatch) {\r\n        window.history.replaceState({}, APP_NAME, window.location.origin);\r\n        const url = externalUrlMatch[1];\r\n        try {\r\n            const request = await fetch(window.decodeURIComponent(url));\r\n            const data = await loadFromBlob(await request.blob(), null, null);\r\n            if (!scene.elements.length ||\r\n                window.confirm(t(\"alerts.loadSceneOverridePrompt\"))) {\r\n                return { scene: data, isExternalScene };\r\n            }\r\n        }\r\n        catch (error) {\r\n            return {\r\n                scene: {\r\n                    appState: {\r\n                        errorMessage: t(\"alerts.invalidSceneUrl\"),\r\n                    },\r\n                },\r\n                isExternalScene,\r\n            };\r\n        }\r\n    }\r\n    if (roomLinkData) {\r\n        return {\r\n            scene: await opts.collabAPI.initializeSocketClient(roomLinkData),\r\n            isExternalScene: true,\r\n            id: roomLinkData.roomId,\r\n            key: roomLinkData.roomKey,\r\n        };\r\n    }\r\n    else if (scene) {\r\n        return isExternalScene && jsonBackendMatch\r\n            ? {\r\n                scene,\r\n                isExternalScene,\r\n                id: jsonBackendMatch[1],\r\n                key: jsonBackendMatch[2],\r\n            }\r\n            : { scene, isExternalScene: false };\r\n    }\r\n    return { scene: null, isExternalScene: false };\r\n};\r\n\r\nconst ExcalidrawWrapper = () => {\r\n    const [errorMessage, setErrorMessage] = useState(\"\");\r\n    let currentLangCode = languageDetector.detect() || defaultLang.code;\r\n    if (Array.isArray(currentLangCode)) {\r\n        currentLangCode = currentLangCode[0];\r\n    }\r\n    const [langCode, setLangCode] = useState(currentLangCode);\r\n    // initial state\r\n    // ---------------------------------------------------------------------------\r\n    const initialStatePromiseRef = useRef({ promise: null });\r\n    if (!initialStatePromiseRef.current.promise) {\r\n        initialStatePromiseRef.current.promise =\r\n            resolvablePromise();\r\n    }\r\n    useEffect(() => {\r\n        // Delayed so that the app has a time to load the latest SW\r\n        setTimeout(() => {\r\n            trackEvent(\"load\", \"version\", getVersion());\r\n        }, VERSION_TIMEOUT);\r\n    }, []);\r\n    const [excalidrawAPI, excalidrawRefCallback] = useCallbackRefState();\r\n    const collabAPI = useContext(CollabContext)?.api;\r\n    useEffect(() => {\r\n        if (!collabAPI || !excalidrawAPI) {\r\n            return;\r\n        }\r\n        const loadImages = (data, isInitialLoad = false) => {\r\n            if (!data.scene) {\r\n                return;\r\n            }\r\n            if (collabAPI.isCollaborating()) {\r\n                if (data.scene.elements) {\r\n                    collabAPI\r\n                        .fetchImageFilesFromFirebase({\r\n                        elements: data.scene.elements,\r\n                    })\r\n                        .then(({ loadedFiles, erroredFiles }) => {\r\n                        excalidrawAPI.addFiles(loadedFiles);\r\n                        updateStaleImageStatuses({\r\n                            excalidrawAPI,\r\n                            erroredFiles,\r\n                            elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                const fileIds = data.scene.elements?.reduce((acc, element) => {\r\n                    if (isInitializedImageElement(element)) {\r\n                        return acc.concat(element.fileId);\r\n                    }\r\n                    return acc;\r\n                }, []) || [];\r\n                if (data.isExternalScene) {\r\n                    loadFilesFromFirebase(`${FIREBASE_STORAGE_PREFIXES.shareLinkFiles}/${data.id}`, data.key, fileIds).then(({ loadedFiles, erroredFiles }) => {\r\n                        excalidrawAPI.addFiles(loadedFiles);\r\n                        updateStaleImageStatuses({\r\n                            excalidrawAPI,\r\n                            erroredFiles,\r\n                            elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                        });\r\n                    });\r\n                }\r\n                else if (isInitialLoad) {\r\n                    if (fileIds.length) {\r\n                        localFileStorage\r\n                            .getFiles(fileIds)\r\n                            .then(({ loadedFiles, erroredFiles }) => {\r\n                            if (loadedFiles.length) {\r\n                                excalidrawAPI.addFiles(loadedFiles);\r\n                            }\r\n                            updateStaleImageStatuses({\r\n                                excalidrawAPI,\r\n                                erroredFiles,\r\n                                elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                            });\r\n                        });\r\n                    }\r\n                    // on fresh load, clear unused files from IDB (from previous\r\n                    // session)\r\n                    clearObsoleteFilesFromIndexedDB({ currentFileIds: fileIds });\r\n                }\r\n            }\r\n            try {\r\n                data.scene.libraryItems =\r\n                    JSON.parse(localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY)) || [];\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n        initializeScene({ collabAPI }).then((data) => {\r\n            loadImages(data, /* isInitialLoad */ true);\r\n            initialStatePromiseRef.current.promise.resolve(data.scene);\r\n        });\r\n        const onHashChange = (event) => {\r\n            event.preventDefault();\r\n            const hash = new URLSearchParams(window.location.hash.slice(1));\r\n            const libraryUrl = hash.get(URL_HASH_KEYS.addLibrary);\r\n            if (libraryUrl) {\r\n                // If hash changed and it contains library url, import it and replace\r\n                // the url to its previous state (important in case of collaboration\r\n                // and similar).\r\n                // Using history API won't trigger another hashchange.\r\n                window.history.replaceState({}, \"\", event.oldURL);\r\n                excalidrawAPI.importLibrary(libraryUrl, hash.get(\"token\"));\r\n            }\r\n            else {\r\n                initializeScene({ collabAPI }).then((data) => {\r\n                    loadImages(data);\r\n                    if (data.scene) {\r\n                        excalidrawAPI.updateScene({\r\n                            ...data.scene,\r\n                            appState: restoreAppState(data.scene.appState, null),\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        const titleTimeout = setTimeout(() => (document.title = APP_NAME), TITLE_TIMEOUT);\r\n        window.addEventListener(EVENT.HASHCHANGE, onHashChange, false);\r\n        window.addEventListener(EVENT.UNLOAD, onBlur, false);\r\n        window.addEventListener(EVENT.BLUR, onBlur, false);\r\n        return () => {\r\n            window.removeEventListener(EVENT.HASHCHANGE, onHashChange, false);\r\n            window.removeEventListener(EVENT.UNLOAD, onBlur, false);\r\n            window.removeEventListener(EVENT.BLUR, onBlur, false);\r\n            clearTimeout(titleTimeout);\r\n        };\r\n    }, [collabAPI, excalidrawAPI]);\r\n    useEffect(() => {\r\n        const unloadHandler = (event) => {\r\n            saveDebounced.flush();\r\n            if (excalidrawAPI &&\r\n                localFileStorage.shouldPreventUnload(excalidrawAPI.getSceneElements())) {\r\n                preventUnload(event);\r\n            }\r\n        };\r\n        window.addEventListener(EVENT.BEFORE_UNLOAD, unloadHandler);\r\n        return () => {\r\n            window.removeEventListener(EVENT.BEFORE_UNLOAD, unloadHandler);\r\n        };\r\n    }, [excalidrawAPI]);\r\n    useEffect(() => {\r\n        languageDetector.cacheUserLanguage(langCode);\r\n    }, [langCode]);\r\n    const onChange = (elements, appState, files) => {\r\n        if (collabAPI?.isCollaborating()) {\r\n            collabAPI.broadcastElements(elements);\r\n        }\r\n        else {\r\n            saveDebounced(elements, appState, files, () => {\r\n                if (excalidrawAPI) {\r\n                    let didChange = false;\r\n                    let pendingImageElement = appState.pendingImageElement;\r\n                    const elements = excalidrawAPI\r\n                        .getSceneElementsIncludingDeleted()\r\n                        .map((element) => {\r\n                        if (localFileStorage.shouldUpdateImageElementStatus(element)) {\r\n                            didChange = true;\r\n                            const newEl = newElementWith(element, { status: \"saved\" });\r\n                            if (pendingImageElement === element) {\r\n                                pendingImageElement = newEl;\r\n                            }\r\n                            return newEl;\r\n                        }\r\n                        return element;\r\n                    });\r\n                    if (didChange) {\r\n                        excalidrawAPI.updateScene({\r\n                            elements,\r\n                            appState: {\r\n                                pendingImageElement,\r\n                            },\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    const onExportToBackend = async (exportedElements, appState, files, canvas) => {\r\n        if (exportedElements.length === 0) {\r\n            return window.alert(t(\"alerts.cannotExportEmptyCanvas\"));\r\n        }\r\n        if (canvas) {\r\n            try {\r\n                await exportToBackend(exportedElements, {\r\n                    ...appState,\r\n                    viewBackgroundColor: appState.exportBackground\r\n                        ? appState.viewBackgroundColor\r\n                        : getDefaultAppState().viewBackgroundColor,\r\n                }, files);\r\n            }\r\n            catch (error) {\r\n                if (error.name !== \"AbortError\") {\r\n                    const { width, height } = canvas;\r\n                    console.error(error, { width, height });\r\n                    setErrorMessage(error.message);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    const renderTopRightUI = useCallback((isMobile, appState) => {\r\n        if (isMobile) {\r\n            return null;\r\n        }\r\n        return (<div style={{\r\n                width: \"24ch\",\r\n                fontSize: \"0.7em\",\r\n                textAlign: \"center\",\r\n            }}>\r\n          {/* <GitHubCorner theme={appState.theme} dir={document.dir} /> */}\r\n          {/* FIXME remove after 2021-05-20 */}\r\n        </div>);\r\n    }, []);\r\n    const renderFooter = useCallback((isMobile) => {\r\n        const renderEncryptedIcon = () => (<a className=\"encrypted-icon tooltip\" href=\"https://blog.excalidraw.com/end-to-end-encryption/\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label={t(\"encrypted.link\")}>\r\n          <Tooltip label={t(\"encrypted.tooltip\")} long={true}>\r\n            {shield}\r\n          </Tooltip>\r\n        </a>);\r\n        if (isMobile) {\r\n            const isTinyDevice = window.innerWidth < 362;\r\n            return (<div style={{\r\n                    display: \"flex\",\r\n                    flexDirection: isTinyDevice ? \"column\" : \"row\",\r\n                }}>\r\n            <fieldset>\r\n              <legend>{t(\"labels.language\")}</legend>\r\n            </fieldset>\r\n            {/* FIXME remove after 2021-05-20 */}\r\n            <div style={{\r\n                    width: \"24ch\",\r\n                    fontSize: \"0.7em\",\r\n                    textAlign: \"center\",\r\n                    marginTop: isTinyDevice ? 16 : undefined,\r\n                    marginLeft: \"auto\",\r\n                    marginRight: isTinyDevice ? \"auto\" : undefined,\r\n                    padding: \"4px 2px\",\r\n                    border: \"1px dashed #aaa\",\r\n                    borderRadius: 12,\r\n                }}>\r\n              \r\n            </div>\r\n          </div>);\r\n        }\r\n        return (<>\r\n          {renderEncryptedIcon()}\r\n        </>);\r\n    }, [langCode]);\r\n    const renderCustomStats = () => {\r\n        return (<CustomStats setToastMessage={(message) => excalidrawAPI.setToastMessage(message)}/>);\r\n    };\r\n    const onLibraryChange = async (items) => {\r\n        if (!items.length) {\r\n            localStorage.removeItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\r\n            return;\r\n        }\r\n        const serializedItems = JSON.stringify(items);\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY, serializedItems);\r\n    };\r\n    const onRoomClose = useCallback(() => {\r\n        localFileStorage.reset();\r\n    }, []);\r\n    return (<>\r\n      <Excalidraw ref={excalidrawRefCallback} onChange={onChange} initialData={initialStatePromiseRef.current.promise} onCollabButtonClick={collabAPI?.onCollabButtonClick} isCollaborating={collabAPI?.isCollaborating()} onPointerUpdate={collabAPI?.onPointerUpdate} UIOptions={{\r\n            canvasActions: {\r\n                export: {\r\n                    onExportToBackend,\r\n                    renderCustomUI: (elements, appState, files) => {\r\n                        return (<ExportToExcalidrawPlus elements={elements} appState={appState} files={files} onError={(error) => {\r\n                                excalidrawAPI?.updateScene({\r\n                                    appState: {\r\n                                        errorMessage: error.message,\r\n                                    },\r\n                                });\r\n                            }}/>);\r\n                    },\r\n                },\r\n            },\r\n        }} renderTopRightUI={renderTopRightUI} renderFooter={renderFooter} langCode={langCode} renderCustomStats={renderCustomStats} detectScroll={false} handleKeyboardGlobally={true} onLibraryChange={onLibraryChange} autoFocus={true}/>\r\n      {excalidrawAPI && (<CollabWrapper excalidrawAPI={excalidrawAPI} onRoomClose={onRoomClose}/>)}\r\n      {errorMessage && (<ErrorDialog message={errorMessage} onClose={() => setErrorMessage(\"\")}/>)}\r\n    </>);\r\n};\r\nconst ExcalidrawApp = () => {\r\n    return (<TopErrorBoundary>\r\n      <CollabContextConsumer>\r\n        <ExcalidrawWrapper />\r\n      </CollabContextConsumer>\r\n    </TopErrorBoundary>);\r\n};\r\nexport default ExcalidrawApp;\r\n","import * as Sentry from \"@sentry/browser\";\r\nimport * as SentryIntegrations from \"@sentry/integrations\";\r\nconst SentryEnvHostnameMap = {\r\n    \"excalidraw.com\": \"production\",\r\n    \"vercel.app\": \"staging\",\r\n};\r\nconst REACT_APP_DISABLE_SENTRY = process.env.REACT_APP_DISABLE_SENTRY === \"true\";\r\n// Disable Sentry locally or inside the Docker to avoid noise/respect privacy\r\nconst onlineEnv = !REACT_APP_DISABLE_SENTRY &&\r\n    Object.keys(SentryEnvHostnameMap).find((item) => window.location.hostname.indexOf(item) >= 0);\r\nSentry.init({\r\n    dsn: onlineEnv\r\n        ? \"https://7bfc596a5bf945eda6b660d3015a5460@sentry.io/5179260\"\r\n        : undefined,\r\n    environment: onlineEnv ? SentryEnvHostnameMap[onlineEnv] : undefined,\r\n    release: process.env.REACT_APP_GIT_SHA,\r\n    ignoreErrors: [\r\n        \"undefined is not an object (evaluating 'window.__pad.performLoop')\", // Only happens on Safari, but spams our servers. Doesn't break anything\r\n    ],\r\n    integrations: [\r\n        new SentryIntegrations.CaptureConsole({\r\n            levels: [\"error\"],\r\n        }),\r\n    ],\r\n    beforeSend(event) {\r\n        if (event.request?.url) {\r\n            event.request.url = event.request.url.replace(/#.*$/, \"\");\r\n        }\r\n        return event;\r\n    },\r\n});\r\n","import ChalkBoard from \"./excalidraw-app\";\r\n\r\nimport \"./excalidraw-app/sentry\";\r\nwindow.__EXCALIDRAW_SHA__ = process.env.REACT_APP_GIT_SHA;\r\n\r\nexport default ChalkBoard","const someJSCodeExample = `\r\n\"use strict\"\r\n\t\tvar stage = {\r\n\t\t\tw:1280,\r\n\t\t\th:720\r\n\t\t}\r\n\r\n\t\tvar _pexcanvas = document.getElementById(\"canvas\");\r\n\t\t_pexcanvas.width = stage.w;\r\n\t\t_pexcanvas.height = stage.h;\r\n\t\tvar ctx = _pexcanvas.getContext(\"2d\");\r\n\r\n\r\n\r\n\r\n\t\tvar pointer = {\r\n\t\t\tx:stage.w/2,\r\n\t\t\ty:stage.h/4\r\n\t\t}\r\n\r\n\t\tvar scale = 1;\r\n\t\tvar portrait = true;\r\n\t\tvar loffset = 0;\r\n\t\tvar toffset = 0;\r\n\t\tvar mxpos = 0;\r\n\t\tvar mypos = 0;\r\n\r\n\r\n// ------------------------------------------------------------------------------- Gamy\r\n\r\nvar againprog = 0;\r\n\r\nvar healthprog = 0;\r\n\r\n\r\nfunction newGame() {\r\n\tscore = 0;\r\n\thealth = 100;\r\n\tenemies=[];\r\n\tenemies.push(new Enemy());\r\n\tenemies.push(new Enemy());\r\n\tenemies.push(new Enemy());\r\n\tagainprog = 0;\r\n}\r\n\r\n\r\n\r\nfunction drawHeart(x,y,w) {\r\n\tctx.beginPath();\r\n\tctx.arc(x-w/4, y, w/4, 0.75*Math.PI,0);\r\n\tctx.arc(x+w/4, y, w/4, 1*Math.PI, 2.25*Math.PI);\r\n\tctx.lineTo(x,y+w/1.5);\r\n\tctx.closePath();\r\n\tctx.fill();\r\n}\r\n\r\n\r\nvar Cannon = function(x,y,tx,ty) {\r\n\tthis.x = x;\r\n\tthis.y = y;\r\n\tthis.tx = tx;\r\n\tthis.ty = ty;\r\n\tthis.r = 10;\r\n}\r\n\r\nvar cannons = [];\r\n\r\nvar gameover = false;\r\n\r\ncannons.push(new Cannon(stage.w,stage.h,stage.w/2,stage.h/2));\r\n\r\nvar firetm = 0;\r\nvar fireact = true;\r\n\r\nvar health = 100;\r\nvar score = 0;\r\n\r\n\r\nvar arm = {x:stage.w,y:stage.h};\r\nvar arm2 = {x:0,y:stage.h};\r\nvar danger = false;\r\nvar dangera = 0;\r\n\r\n\r\n\r\nvar Enemy = function() {\r\n\tthis.x = stage.w/2;\r\n\tthis.y = stage.h/2;\r\n\tthis.r = 10;\r\n\tthis.tx = Math.floor(Math.random()*stage.w);\r\n\tthis.ty = Math.floor(Math.random()*stage.h);\r\n\tthis.des = false;\r\n\tthis.eyeX = 0.4;\r\n\tthis.eyeY = 0.25;\r\n\tthis.eyeR = 0.25;\r\n\tthis.sp = 50;\r\n\tthis.spl = 1.4;\r\n\tthis.op=1;\r\n\tthis.danger = false;\r\n\tthis.nuked = false;\r\n}\r\n\r\nvar enemies = [];\r\n// for (var i = 0; i < 10; i++) {\r\n// \tenemies[i] = new Enemy();\r\n// }\r\n\t\tenemies.push(new Enemy());\r\n\t\tenemies.push(new Enemy());\r\n\t\tenemies.push(new Enemy());\r\n\r\nvar entm = 0;\r\nvar ga =0;\r\n\r\nvar steptime = 0;\r\n\r\n\r\nvar Star = function() {\r\n\tthis.a = Math.random()*Math.PI*2;\r\n\tthis.v = 3+Math.random()*5;\r\n\tthis.x = stage.w/2;\r\n\tthis.y = stage.h/2;\r\n\tthis.r = 0.2;\r\n}\r\n\r\nvar Power = function() {\r\n\tthis.type = Math.floor(Math.random()*2)+1;\r\n\tthis.a = Math.random()*Math.PI*2;\r\n\tthis.v = 3+Math.random()*5;\r\n\tthis.x = stage.w/2;\r\n\tthis.y = stage.h/2;\r\n\tthis.r = 0.2;\r\n\tthis.dis = false;\r\n\tthis.op = 1;\r\n}\r\n\r\n\r\nvar powers = [];\r\nvar powertm = 0;\r\nvar powermax = Math.random()*800+300;\r\n// powermax = 10;\r\n\r\nvar stars = [];\r\n\r\nfor (var i =0;i<200;i++) {\r\n\tstars[i] = new Star();\r\n\tvar st = stars[i];\r\n\tvar move = Math.random()*400;\r\n\r\n\tst.x += Math.sin(st.a)*move;\r\n\tst.y += Math.cos(st.a)*move;\r\n\r\n\r\n}\r\n\r\n// powers.push(new Power());\r\n\r\n\r\n\r\nfunction enginestep() {\r\n\tsteptime = Date.now();\r\n\tctx.clearRect(0,0,stage.w,stage.h);\r\n\t\r\n\tctx.fillStyle = \"#ffffff\";\r\n\r\n\t\r\n\tfor (var i = 0; i < stars.length; i++) {\r\n\t\tvar st = stars[i];\r\n\r\n\t\tst.x += Math.sin(st.a)*st.v;\r\n\t\tst.y += Math.cos(st.a)*st.v;\r\n\t\tst.r += st.v/200;\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.arc(st.x,st.y, st.r, 2*Math.PI, 0);\r\n\t\tctx.fill();\r\n\r\n\t\tif (st.x>stage.w||st.x<0||st.y<0||st.y>stage.h) {\r\n\t\t\tstars[i] = new Star();\r\n\t\t}\r\n\t}\r\n\tif (!gameover) {\r\n\t\tdanger = false;\r\n\r\n\r\n\t\tpowertm++;\r\n\t\tif (powertm>powermax) {\r\n\t\t\tpowers.push(new Power());\r\n\t\t\tpowertm = 0;\r\n\t\t\tpowermax = Math.random()*1200+600;\r\n\t\t\t// powermax = 10;\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\t\tfor (var i = 0; i < powers.length; i++) {\r\n\t\t\tvar st = powers[i];\r\n\r\n\t\t\tif (!st.des) {\r\n\t\t\t\tst.x += Math.sin(st.a)*st.v/1.5;\r\n\t\t\t\tst.y += Math.cos(st.a)*st.v/1.5;\r\n\t\t\t\tst.r += st.v/15;\r\n\t\t\t} else {\r\n\t\t\t\tst.r *=1.1;\r\n\t\t\t\tif (st.type==1) {\r\n\t\t\t\tst.op += (0-st.op)/10;\r\n\t\t\t} else {\r\n\t\t\t\tst.op += (0-st.op)/20;\r\n\r\n\t\t\t}\r\n\t\t\t\tst.x += (stage.w/2-st.x)/10;\r\n\t\t\t\tst.y += (stage.h/2-st.y)/10;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t\r\n\t\t\tif (st.type ==1) {\r\n\t\t\t\tctx.fillStyle = \"rgba(255,0,0,\"+st.op+\")\";\r\n\r\n\t\t\t\tdrawHeart(st.x,st.y-st.r/4, st.r*2);\r\n\r\n\t\t\t} else {\r\n\t\t\t\tctx.fillStyle = \"rgba(255,255,0,\"+st.op+\")\";\r\n\t\t\t\tctx.strokeStyle = \"rgba(255,255,0,\"+st.op+\")\";\r\n\t\t\t\tctx.lineWidth = st.r/10;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(st.x,st.y, st.r, 2*Math.PI, 0);\r\n\t\t\t\tctx.stroke();\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.15, 2*Math.PI, 0);\r\n\t\t\t\tctx.fill();\r\n\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.85, 1.67*Math.PI, 2*Math.PI);\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.25, 2*Math.PI, 1.67*Math.PI,true);\r\n\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\r\n\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.85, 3*Math.PI, 3.33*Math.PI);\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.25, 3.33*Math.PI,3*Math.PI, true);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.85, 2.33*Math.PI, 2.67*Math.PI);\r\n\t\t\t\tctx.arc(st.x,st.y, st.r*0.25, 2.67*Math.PI,2.33*Math.PI, true);\r\n\t\t\t\tctx.lineTo(st.x,st.y);\r\n\t\t\t\tctx.closePath();\r\n\t\t\t\tctx.fill();\r\n\r\n\t\t\t}\r\n\t\t\tif (st.x>stage.w||st.x<0||st.y<0||st.y>stage.h||st.r>stage.w/2) {\r\n\t\t\t\tpowers.splice(i,1);\r\n\t\t\t\tif (st.type == 2&&st.r>stage.w/2) {\r\n\t\t\t\t\tfor (var e = 0; e < enemies.length; e++) {\r\n\t\t\t\t\t\tenemies[e].des = true;\r\n\t\t\t\t\t\tenemies[e].nuked = true;\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\ti--;\r\n\t\t\t}\r\n\r\n\r\n\t\t}\r\n\r\n\t\tentm++;\r\n\t\tif (enemies.length<10&&entm>300) {\r\n\t\t\tentm=0;\r\n\t\t\tenemies.push(new Enemy());\r\n\r\n\t\t}\r\n\r\n\t\t\tctx.lineWidth = 2;\r\n\t\tfor (var i = 0; i < enemies.length; i++) {\r\n\t\t\tvar en = enemies[i];\r\n\t\t\tif (!en.danger) {\r\n\t\t\t\tctx.strokeStyle = \"rgba(0,255,255,\"+en.op*2+\")\";\r\n\t\t\t} else {\r\n\t\t\t\thealth -= 0.01;\r\n\t\t\t\tctx.strokeStyle = \"rgba(255,0,0,\"+en.op*2+\")\";\r\n\t\t\t\tdanger = true;\r\n\t\t\t}\r\n\r\n\r\n\r\n\r\n\t\t\tif (!en.des) {\r\n\r\n\t\t\t\tif (en.danger) {\r\n\t\t\t\t\tvar randx = Math.floor(Math.random()*4)-2;\r\n\t\t\t\t\tvar randy = Math.floor(Math.random()*4)-2;\r\n\r\n\t\t\t\t\ten.x = en.tx+randx;\r\n\t\t\t\t\ten.y = en.ty+randy;\r\n\t\t\t\t} else {\r\n\t\t\t\t\ten.x += (en.tx-en.x)/100;\r\n\t\t\t\t\ten.y += (en.ty-en.y)/100;\r\n\t\t\t\t\tvar randx = 0;\r\n\t\t\t\t\tvar randy = 0;\r\n\t\t\t\t}\r\n\r\n\t\t\t\ten.r += (50-en.r)/100;\r\n\t\t\t\tif (Math.abs(50-en.r)<2&&!en.danger) {\r\n\t\t\t\t\ten.tx=en.x;\r\n\t\t\t\t\ten.ty=en.y;\r\n\t\t\t\t\ten.danger=true;\r\n\t\t\t\t}\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x-en.r*en.eyeX,en.y-en.r*en.eyeY, en.r*en.eyeR, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x+en.r*en.eyeX,en.y-en.r*en.eyeY, en.r*en.eyeR, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x,en.y+en.r/4, en.r/3, 2*Math.PI, Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x,en.y, en.r, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t} else {\r\n\r\n\t\t\t\ten.eyeR += (0.5-en.eyeR)/5;\r\n\t\t\t\ten.op += (0-en.op)/5;\r\n\t\t\t\t// en.sp += (5-en.sp)/20;\r\n\t\t\t\ten.r += (100-en.r)/20;\r\n\t\t\t\ten.spl += (2.5-en.spl)/5;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x-en.r*en.eyeX,en.y-en.r*en.eyeY, en.r*en.eyeR, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x+en.r*en.eyeX,en.y-en.r*en.eyeY, en.r*en.eyeR, 0, 2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.arc(en.x,en.y+en.r/2, en.r*en.eyeR, Math.PI,2*Math.PI);\r\n\t\t\t\tctx.stroke();\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(en.x,en.y, en.r, 0, 2*Math.PI);\r\n\t\t\tctx.stroke();\r\n\t\t\t}\r\n\r\n\t\t\t//spikes\r\n\t\t\tfor (var s = 0; s < 12; s++) {\r\n\t\t\t\tvar a = (Math.PI*2/12)*s+ga;\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tctx.moveTo(en.x+Math.sin(a)*en.r,en.y+Math.cos(a)*en.r);\r\n\t\t\t\tctx.lineTo(en.x+Math.sin(a)*en.r*1.2,en.y+Math.cos(a)*en.r*1.2);\r\n\t\t\t\tctx.lineTo(en.x+Math.sin(a+Math.PI/en.sp)*en.r*en.spl,en.y+Math.cos(a+Math.PI/en.sp)*en.r*en.spl);\r\n\t\t\t\tctx.lineTo(en.x+Math.sin(a-Math.PI/en.sp)*en.r*en.spl,en.y+Math.cos(a-Math.PI/en.sp)*en.r*en.spl);\r\n\t\t\t\tctx.lineTo(en.x+Math.sin(a)*en.r*1.2,en.y+Math.cos(a)*en.r*1.2);\r\n\t\t\t\tctx.stroke();\r\n\t\t\t\t// ctx.fill();\r\n\t\t\t}\r\n\r\n\t\t\tif (Math.abs(0.5-en.eyeR)<0.01) {\r\n\t\t\t\tvar rand = Math.floor(Math.random()*2);\r\n\t\t\t\tif (enemies[i].nuked&&rand==1) {\r\n\t\t\t\tenemies.splice(i,1);\r\n\r\n\t\t\t\t} else {\r\n\t\t\t\tenemies[i] = new Enemy();\r\n\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t    if (danger) {\r\n\t    \tdangera += 0.05+(100-health)/1000;\r\n\t    \tif (dangera>=Math.PI) {\r\n\t    \t\tdangera=0;\r\n\t    \t}\r\n\t    \tctx.fillStyle='rgba(255,0,0,'+(1-Math.sin(dangera))/4+')';\r\n\t\t\tctx.fillRect(0,0,stage.w,stage.h);\r\n\t\t\tif (health<10) {\r\n\t\t    \tctx.fillStyle='rgba(255,255,0,'+(Math.sin(dangera))+')';\r\n\t\t    \tctx.strokeStyle='rgba(255,255,0,'+(Math.sin(dangera))+')';\r\n\r\n\t\t\t    ctx.lineWidth = 10;\r\n\t\t\t    ctx.beginPath();\r\n\t\t\t    ctx.lineJoin = 'round';\r\n\t\t\t    ctx.moveTo(stage.w/2,stage.h/4);\r\n\t\t\t    ctx.lineTo(stage.w/2+stage.h/7,stage.h/2);\r\n\t\t\t    ctx.lineTo(stage.w/2-stage.h/7,stage.h/2);\r\n\t\t\t    ctx.closePath();\r\n\t\t\t    ctx.stroke();\r\n\r\n\t\t\t    ctx.font = \"bold 130px arial\";\r\n\t\t\t    ctx.textAlign = \"center\"; \r\n\t\t\t    ctx.textBaseline = \"middle\"; \r\n\t\t\t    ctx.fillText(\"!\",stage.w/2,stage.h/2.5);\r\n\r\n\t\t\t    ctx.font = \"bold 50px arial\";\r\n\t\t\t    ctx.fillText(\"LOW HEALTH\",stage.w/2,stage.h*0.6);\r\n\t\t\t}\r\n\t    } else {\r\n\t    \tdangera = 0;\r\n\t    }\r\n\r\n\t    healthprog += (health-healthprog)/5;\r\n\t    ctx.fillStyle='#00ffff';\r\n\t    ctx.font = \"30px arial\";\r\n\t    ctx.textAlign = \"left\"; \r\n\t    ctx.textBaseline = \"middle\"; \r\n\t    ctx.fillText(\"Health: \",20,40);\r\n\r\n\t    ctx.fillText(\"Score: \"+score,stage.w-200,40);\r\n\t    // ctx.fillText(\"Step:   \"+(Date.now()-steptime),20,120);\r\n\t    if (health>30) {\r\n\t    \tctx.fillStyle='rgba(0,255,255,0.8)';\r\n\t\t} else {\r\n\t    \tctx.fillStyle='rgba(255,0,0,0.8)';\r\n\t\t}\r\n\t\tctx.lineWidth = 2;\r\n\t    ctx.fillRect(130,25,healthprog*3,30);\r\n\t    ctx.strokeStyle = \"#00ffff\";\r\n\t    ctx.strokeRect(130,25,300,30);\r\n\t    \r\n\t    if (health<0) {\r\n\t    \tgameover = true;\r\n\t    }\r\n\r\n\t} else {\t\r\n\r\n\r\n\t    ctx.fillStyle='rgba(0,255,255,0.3)';\r\n\t    ctx.fillRect((stage.w-220)/2,stage.h*0.65-25,againprog,50);\r\n\r\n    \tctx.fillStyle='#00ffff';\r\n\t    ctx.font = \"bold 130px arial\";\r\n\t    ctx.textAlign = \"center\"; \r\n\t    ctx.textBaseline = \"middle\"; \r\n\t    ctx.fillText(\"GAME OVER\",stage.w/2,stage.h/3);\r\n\t    ctx.font = \"bold 50px arial\";\r\n\t    ctx.fillText(\"SCORE: \"+score,stage.w/2,stage.h/2);\r\n\r\n\t    ctx.font = \"bold 30px arial\";\r\n\r\n\t    ctx.fillText(\"PLAY AGAIN\",stage.w/2,stage.h*0.65);\r\n\t    ctx.strokeRect((stage.w-220)/2,stage.h*0.65-25,220,50);\r\n\r\n\t    againprog += (0-againprog)/50;\r\n\r\n\t}\r\n\r\n\t\tctx.strokeStyle = \"#00ffff\";\r\n\t\tctx.fillStyle = \"#00ffff\";\r\n\t\t\tctx.lineWidth = 2;\r\n\t\tif (fireact) {\r\n\t\t\tfiretm++;\r\n\t\t\tif(firetm>5) {\r\n\r\n\t\t\t\tcannons.push(new Cannon(pointer.x+(stage.w-pointer.x)/2.5,pointer.y+(stage.h-pointer.y)/2.5,pointer.x,pointer.y));\r\n\t\t\t\tcannons.push(new Cannon(pointer.x-(pointer.x)/2.5,pointer.y+(stage.h-pointer.y)/2.5,pointer.x,pointer.y));\r\n\r\n\r\n\t\t\t\tfiretm=0;\r\n\t\t\t}\r\n\r\n\t\t\tarm.x=Math.floor(Math.random()*50)-25+stage.w;\r\n\t\t\tarm.y=Math.floor(Math.random()*50)-25+stage.h;\r\n\t\t\tarm2.x=Math.floor(Math.random()*30)-15;\r\n\t\t\tarm2.y=Math.floor(Math.random()*30)-15+stage.h;\r\n\t\t} else {\r\n\t\t\tarm.x=stage.w;\r\n\t\t\tarm.y=stage.h;\r\n\t\t\tarm2.x=0;\r\n\t\t\tarm2.y=stage.h;\r\n\t\t}\r\n\r\n\r\n\r\n\r\n\r\n\r\n\t\tfor (var i = 0; i < cannons.length; i++) {\r\n\t\t\t\r\n\t\t\tvar can = cannons[i];\r\n\r\n\t\t\tcan.x += (can.tx-can.x)/5;\r\n\t\t\tcan.y += (can.ty-can.y)/5;\r\n\t\t\tcan.r += (0-can.r)/5;\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(can.x,can.y, can.r, 0, 2*Math.PI);\r\n\t\t\tctx.fill();\r\n\r\n\r\n\t\t\tif (can.r<2&&!gameover) {\r\n\t\t\t\tfor (var a = 0; a < enemies.length; a++) {\r\n\t\t\t\t\tvar en = enemies[a];\r\n\t\t\t\t\tvar dx = can.x-en.x;\r\n\t\t\t\t\tvar dy = can.y-en.y;\r\n\t\t\t\t\tvar dis = dx*dx+dy*dy;\r\n\t\t\t\t\tif (dis<en.r*en.r) {\r\n\r\n\t\t\t\t\t\t// enemies.splice(a,1);\r\n\t\t\t\t\t\tif (!enemies[a].des) {\r\n\t\t\t\t\t\tenemies[a].des = true;\r\n\r\n\t\t\t\t\t\tscore+=10;\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t}\r\n\r\n\t\t\tif (can.r<1&&!gameover) {\r\n\t\t\t\tfor (var a = 0; a < powers.length; a++) {\r\n\t\t\t\t\tvar en = powers[a];\r\n\t\t\t\t\tvar dx = can.x-en.x;\r\n\t\t\t\t\tvar dy = can.y-en.y;\r\n\t\t\t\t\tvar dis = dx*dx+dy*dy;\r\n\t\t\t\t\tif (dis<en.r*en.r) {\r\n\r\n\t\t\t\t\t\tif (!en.des) {\r\n\t\t\t\t\t\t\tpowers[a].des = true;\r\n\t\t\t\t\t\t\tif (en.type==1) {\r\n\t\t\t\t\t\t\thealth = 100;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (can.r<1&&gameover) {\r\n\r\n\t\t\t\tif (can.x>(stage.w-220)/2&&can.y>stage.h*0.65-25&&can.x<(stage.w-220)/2+220&&can.y<stage.h*0.65-25+50) {\r\n\r\n\t\t\t\t\tagainprog +=1;\r\n\t\t\t\t\tif (againprog>220) {\r\n\t\t\t\t\t\tnewGame();\r\n\t\t\t\t\t\tgameover = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (Math.abs(can.tx-can.x)<1) {\r\n\r\n\r\n\r\n\r\n\t\t\t\tcannons.splice(i,1);\r\n\t\t\t}\r\n\r\n\r\n\t\t\r\n\t\t}\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(pointer.x-20,pointer.y);\r\n\t\tctx.lineTo(pointer.x+20,pointer.y);\r\n\t\tctx.stroke();\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(pointer.x,pointer.y-20);\r\n\t\tctx.lineTo(pointer.x,pointer.y+20);\r\n\t\tctx.stroke();\r\n\r\n\t\t\tctx.beginPath();\r\n\t\t\tctx.arc(pointer.x,pointer.y, 8, 0, 2*Math.PI);\r\n\t\t\tctx.stroke();\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(pointer.x+(arm.x-pointer.x)/3,pointer.y+(arm.y-pointer.y)/3+10);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/2.5,pointer.y+(arm.y-pointer.y)/2.5+10);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/2,pointer.y+(arm.y-pointer.y)/2+10);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.5,pointer.y+(arm.y-pointer.y)/1.5+50);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.2,pointer.y+(arm.y-pointer.y)/1.2+80);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.1,pointer.y+(arm.y-pointer.y)/1.1+100);\r\n\t\tctx.stroke();\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(pointer.x+(arm.x-pointer.x)/3-10,pointer.y+(arm.y-pointer.y)/3);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/2.5-10,pointer.y+(arm.y-pointer.y)/2.5);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/2-10,pointer.y+(arm.y-pointer.y)/2);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.5-50,pointer.y+(arm.y-pointer.y)/1.5);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.2-80,pointer.y+(arm.y-pointer.y)/1.2);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.1-100,pointer.y+(arm.y-pointer.y)/1.1);\r\n\t\tctx.stroke();\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(pointer.x+(arm.x-pointer.x)/3,pointer.y+(arm.y-pointer.y)/3-10);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/2.5,pointer.y+(arm.y-pointer.y)/2.5-10);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/2,pointer.y+(arm.y-pointer.y)/2-10);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.5,pointer.y+(arm.y-pointer.y)/1.5-50);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.2,pointer.y+(arm.y-pointer.y)/1.2-80);\r\n\t\tctx.lineTo(pointer.x+(arm.x-pointer.x)/1.1,pointer.y+(arm.y-pointer.y)/1.1-100);\r\n\t\tctx.stroke();\r\n\r\n\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(arm2.x+pointer.x-(pointer.x)/3,pointer.y+(arm2.y-pointer.y)/3+10);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/2.5,pointer.y+(arm2.y-pointer.y)/2.5+10);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/2,pointer.y+(arm2.y-pointer.y)/2+10);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.5,pointer.y+(arm2.y-pointer.y)/1.5+50);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.2,pointer.y+(arm2.y-pointer.y)/1.2+80);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.1,pointer.y+(arm2.y-pointer.y)/1.1+100);\r\n\t\tctx.stroke();\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(arm2.x+pointer.x-(pointer.x)/3-10,pointer.y+(arm2.y-pointer.y)/3);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/2.5-10,pointer.y+(arm2.y-pointer.y)/2.5);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/2-10,pointer.y+(arm2.y-pointer.y)/2);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.5-50,pointer.y+(arm2.y-pointer.y)/1.5);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.2-80,pointer.y+(arm2.y-pointer.y)/1.2);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.1-100,pointer.y+(arm2.y-pointer.y)/1.1);\r\n\t\tctx.stroke();\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.moveTo(arm2.x+pointer.x-(pointer.x)/3,pointer.y+(arm2.y-pointer.y)/3-10);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/2.5,pointer.y+(arm2.y-pointer.y)/2.5-10);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/2,pointer.y+(arm2.y-pointer.y)/2-10);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.5,pointer.y+(arm2.y-pointer.y)/1.5-50);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.2,pointer.y+(arm2.y-pointer.y)/1.2-80);\r\n\t\tctx.lineTo(arm2.x+pointer.x-(pointer.x)/1.1,pointer.y+(arm2.y-pointer.y)/1.1-100);\r\n\t\tctx.stroke();\r\n\r\n\r\n\r\n\r\n\t\tctx.beginPath();\r\n\t\tctx.arc(pointer.x+(arm.x-pointer.x)/3,pointer.y+(arm.y-pointer.y)/3, 10, 0, 2*Math.PI);\r\n\t\tctx.arc(pointer.x+(arm.x-pointer.x)/2.5,pointer.y+(arm.y-pointer.y)/2.5, 10, 0, 2*Math.PI);\r\n\t\tctx.arc(pointer.x+(arm.x-pointer.x)/2,pointer.y+(arm.y-pointer.y)/2, 10, 0, 2*Math.PI);\r\n\t\tctx.arc(pointer.x+(arm.x-pointer.x)/1.5,pointer.y+(arm.y-pointer.y)/1.5, 50, 0, 2*Math.PI);\r\n\t\tctx.arc(pointer.x+(arm.x-pointer.x)/1.2,pointer.y+(arm.y-pointer.y)/1.2, 80, 0, 2*Math.PI);\r\n\t\tctx.arc(pointer.x+(arm.x-pointer.x)/1.1,pointer.y+(arm.y-pointer.y)/1.1, 100, 0, 2*Math.PI);\r\n\t\tctx.stroke();\r\n\r\n\t\t\r\n\t\tctx.beginPath();\r\n\t\tctx.arc(arm2.x+pointer.x-(pointer.x/3),pointer.y+(arm2.y-pointer.y)/3, 10, 0, 2*Math.PI);\r\n\t\tctx.arc(arm2.x+pointer.x-(pointer.x/2.5),pointer.y+(arm2.y-pointer.y)/2.5, 10, 0, 2*Math.PI);\r\n\t\tctx.arc(arm2.x+pointer.x-(pointer.x)/2,pointer.y+(arm2.y-pointer.y)/2, 10, 0, 2*Math.PI);\r\n\t\tctx.arc(arm2.x+pointer.x-(pointer.x)/1.5,pointer.y+(arm2.y-pointer.y)/1.5, 50, 0, 2*Math.PI);\r\n\t\tctx.arc(arm2.x+pointer.x-(pointer.x)/1.2,pointer.y+(arm2.y-pointer.y)/1.2, 80, 0, 2*Math.PI);\r\n\t\tctx.arc(arm2.x+pointer.x-(pointer.x)/1.1,pointer.y+(arm2.y-pointer.y)/1.1, 100, 0, 2*Math.PI);\r\n\t\tctx.stroke();\r\n\r\n\r\n    \tctx.fillStyle='#004444';\r\n\t    ctx.font = \"14px arial\";\r\n\t    ctx.textAlign = \"center\"; \r\n\t    ctx.textBaseline = \"middle\"; \r\n\t    ctx.fillText(\"Coronavirus Shooting Game, Designed & Developed by Faisal Jawed\",stage.w/2,stage.h-20);\r\n}\r\n\r\n\r\n\r\n// ------------------------------------------------------------------------------- events\r\n// ------------------------------------------------------------------------------- events\r\n// ------------------------------------------------------------------------------- events\r\n// ------------------------------------------------------------------------------- events\r\n\r\nfunction toggleFullScreen() {\r\n\tvar doc = window.document;\r\n\tvar docEl = doc.documentElement;\r\n\r\n\tvar requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;\r\n\tvar cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;\r\n\r\n\tif(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {\r\n\t\trequestFullScreen.call(docEl);\r\n\r\n\t}\r\n\telse {\r\n\t\tcancelFullScreen.call(doc);\r\n\r\n\t}\r\n}\r\n\r\n\r\nvar ox = 0;\r\nvar oy = 0;\r\nfunction mousestart(e) {\r\n\tmxpos = (e.pageX-loffset)*scale;\r\n\tmypos = (e.pageY-toffset)*scale;\r\n\tpointer.x = mxpos;\r\n\tpointer.y = mypos;\r\n\r\n// fireact = true;\r\n\r\n\r\n\r\n}\r\nfunction mousemove(e) {\r\n\tmxpos = (e.pageX-loffset)*scale;\r\n\tmypos = (e.pageY-toffset)*scale;\r\n\tpointer.x = mxpos;\r\n\tpointer.y = mypos;\r\n\r\n\t// ball.vY += (mxpos-ox)/15*line.d;\r\n\r\n\tox = mxpos;\r\n}\r\n\r\nfunction mouseend(e) {\r\n// fireact = false;\r\n\r\n}\r\n\r\nvar moveX = 0;\r\nvar moveY = 0;\r\nvar moveZ = 0;\r\n\r\n\r\nfunction keydowned(e) {\r\n\t// if (e.keyCode==65) {\r\n\t// \tmoveX = 10;\r\n\t// } else if (e.keyCode==68) {\r\n\t// \tmoveX = -10;\r\n\t// }\r\n\t// if (e.keyCode==83) {\r\n\t// \tmoveY = -10;\r\n\t// } else if (e.keyCode==87) {\r\n\t// \tmoveY = 10;\r\n\t// }\r\n\r\n\t// if (e.keyCode==69) {\r\n\t// \tmoveZ = 10;\r\n\t// } else if (e.keyCode==81) {\r\n\t// \tmoveZ = -10;\r\n\t// }\r\n\t// console.log(e.keyCode);\r\n}\r\n\r\n\r\n\r\nfunction keyuped(e) {\r\n\t// if (e.keyCode==65) {\r\n\t// \tmoveX = 0;\r\n\t// } else if (e.keyCode==68) {\r\n\t// \tmoveX = 0;\r\n\t// }\r\n\t// if (e.keyCode==87) {\r\n\t// \tmoveY = 0;\r\n\t// } else if (e.keyCode==83) {\r\n\t// \tmoveY = 0;\r\n\t// }\r\n\t// if (e.keyCode==81) {\r\n\t// \tmoveZ = 0;\r\n\t// } else if (e.keyCode==69) {\r\n\t// \tmoveZ = 0;\r\n\t// }\r\n\t// console.log(\"u\"+e.keyCode);\r\n}\r\n\r\n\r\n\r\nwindow.addEventListener('mousedown', function(e) {\r\n\tmousestart(e);\r\n}, false);\r\nwindow.addEventListener('mousemove', function(e) {\r\n\tmousemove(e);\r\n}, false);\r\nwindow.addEventListener('mouseup', function(e) {\r\n\tmouseend(e);\r\n}, false);\r\nwindow.addEventListener('touchstart', function(e) {\r\n\te.preventDefault();\r\n\tmousestart(e.touches[0]);\r\n}, false);\r\nwindow.addEventListener('touchmove', function(e) {\r\n\te.preventDefault();\r\n\tmousemove(e.touches[0]);\r\n}, false);\r\nwindow.addEventListener('touchend', function(e) {\r\n\te.preventDefault();\r\n\tmouseend(e.touches[0]);\r\n}, false);\r\n\r\n\r\nwindow.addEventListener('keydown', function(e) {\r\n\tkeydowned(e);\r\n}, false);\r\nwindow.addEventListener('keyup', function(e) {\r\n\tkeyuped(e);\r\n}, false);\r\n\r\n// ------------------------------------------------------------------------ stager\r\n// ------------------------------------------------------------------------ stager\r\n// ------------------------------------------------------------------------ stager\r\n// ------------------------------------------------------------------------ stager\r\nfunction _pexresize() {\r\n\tvar cw = window.innerWidth;\r\n\tvar ch = window.innerHeight;\r\n\tif (cw<=ch*stage.w/stage.h) {\r\n\t\tportrait = true;\r\n\t\tscale = stage.w/cw;\r\n\t\tloffset = 0;\r\n\t\ttoffset = Math.floor(ch-(cw*stage.h/stage.w))/2;\r\n\t\t_pexcanvas.style.width = cw + \"px\";\r\n\t\t_pexcanvas.style.height = Math.floor(cw*stage.h/stage.w) + \"px\";\r\n\t} else {\r\n\t\tscale = stage.h/ch;\r\n\t\tportrait = false;\r\n\t\tloffset = Math.floor(cw-(ch*stage.w/stage.h))/2;\r\n\t\ttoffset = 0;\r\n\t\t_pexcanvas.style.height = ch + \"px\";\r\n\t\t_pexcanvas.style.width = Math.floor(ch*stage.w/stage.h) + \"px\";\r\n\t}\r\n\t_pexcanvas.style.marginLeft = loffset +\"px\";\r\n\t_pexcanvas.style.marginTop = toffset +\"px\";\r\n}\r\n\r\n\r\nwindow.requestAnimFrame = (function(){\r\n\treturn  window.requestAnimationFrame       ||\r\n\twindow.webkitRequestAnimationFrame ||\r\n\twindow.mozRequestAnimationFrame    ||\r\n\twindow.oRequestAnimationFrame      ||\r\n\twindow.msRequestAnimationFrame     ||\r\n\tfunction( callback ){\r\n\t\twindow.setTimeout(callback, 1000 / 60);\r\n\t};})();\r\n\r\n\r\n\r\n\tvar fps = 60;\r\n\r\n\r\n\tvar nfcount = 0;\r\n\r\nfunction animated() {\r\n\trequestAnimFrame(animated);\r\n\tenginestep();\r\n\r\n   \tnfcount++;\r\n    ctx.fillStyle='#00ffff';\r\n    ctx.font = \"12px arial\";\r\n    ctx.textAlign = \"left\"; \r\n    ctx.fillText(\"FPS: \"+Math.floor(fps),10,stage.h-20);\r\n}\r\n\r\n_pexresize();\r\nanimated();\r\n\r\n\r\nfunction countfps() {\r\n\tfps = nfcount;\r\n\tnfcount = 0;\r\n}\r\nsetInterval(countfps,1000);\r\n`;\r\n\r\nconst someCSSCodeExample = `body {background:#111;margin:0;padding:0}\r\ncanvas {background:#000;display:block;cursor: none}\r\n`;\r\n\r\nconst someHTMLCodeExample = `\r\n<html>\r\n<head>\r\n\t<meta charset=\"utf-8\">\r\n\t<meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n\t<title>Coronavirus Shooting </title>\r\n</head>\r\n<body onresize='_pexresize()'>\r\n\t<canvas id='canvas' width='1280' height='720'></canvas>`\r\n\r\nconst someCCodeExample = ``;\r\n\r\nconst someCpp99CodeExample = ``\r\n\r\nconst someCppCodeExample = ``\r\n\r\nconst someCpp14CodeExample = ``\r\n\r\nconst someCpp17CodeExample = ``\r\n\r\nconst somePython2CodeExample = ``\r\n\r\nconst somePython3CodeExample = ``\r\n\r\nconst files = {\r\n  \"script.js\": {\r\n    name: \"script.js\",\r\n    language: \"javascript\",\r\n    value: someJSCodeExample\r\n  },\r\n  \"style.css\": {\r\n    name: \"style.css\",\r\n    language: \"css\",\r\n    value: someCSSCodeExample\r\n  },\r\n  \"index.html\": {\r\n    name: \"index.html\",\r\n    language: \"html\",\r\n    value: someHTMLCodeExample\r\n  },\r\n  \"c\": {\r\n    name: \"main.c\",\r\n    language: \"cpp\",\r\n    value: someCCodeExample\r\n  },\r\n  \"c99\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCpp99CodeExample\r\n  },\r\n  \"cpp\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCppCodeExample\r\n  },\r\n  \"cpp14\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCpp14CodeExample\r\n  },\r\n  \"cpp17\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCpp17CodeExample\r\n  },\r\n  \"python2\": {\r\n    name: \"python\",\r\n    language: \"python\",\r\n    value: somePython2CodeExample\r\n  },\r\n  \"python3\": {\r\n    name: \"python\",\r\n    language: \"python\",\r\n    value: somePython3CodeExample\r\n  }\r\n};\r\n\r\nexport default files;\r\n","import React, { useState, useEffect } from \"react\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { Hook, Console, Unhook } from 'console-feed'\r\nimport Editor from \"@monaco-editor/react\";\r\nimport Split from 'react-split'\r\n\r\nimport {\r\n  js,\r\n  css,\r\n  html,\r\n  setSrcDocs,\r\n} from \"../actions\";\r\nimport files from \"../assets/files\";\r\nimport \"./style.css\";\r\nimport ChalkBoard from \"../ChalkBoard\";\r\n\r\nfunction TextEditor(props) {\r\n  const srcDoc = useSelector((state) => state.srcDocs);\r\n  const [logs, setLogs] = useState([])\r\n  const fileName = useSelector((state) => state.fileName);\r\n  const dispatch = useDispatch();\r\n\r\n  const file = files[fileName];\r\n\r\n  function handleEditorChange(value) {\r\n    file.value = value;\r\n  }\r\n  \r\n  useEffect(() => {\r\n      dispatch(setSrcDocs());\r\n      document.getElementsByClassName(\"code_text\")[0].addEventListener(\"keyup\", function () {\r\n        dispatch(setSrcDocs());\r\n      });\r\n      document.getElementsByClassName(\"closechalkboard\")[0].addEventListener(\"click\", function () {\r\n        document.getElementsByClassName(\"chalkboardweb\")[0].style.display = \"none\"\r\n      })\r\n\r\n      document.getElementsByClassName(\"output\")[0].addEventListener(\"click\", function () {\r\n        document.getElementsByClassName(\"chalkboardweb\")[0].style.display = \"block\"\r\n      }) \r\n    \r\n\r\n      Hook(\r\n        document.getElementsByClassName(\"outputiframe\")[0].contentWindow.console,\r\n        (log) => setLogs((currLogs) => [...currLogs, log]),\r\n        false\r\n      )\r\n      return () => Unhook(document.getElementsByClassName(\"outputiframe\")[0].contentWindow.console)\r\n  },[]);\r\n\r\n  useEffect(() => {\r\n    var frame =\r\n      document.getElementsByClassName(\"outputiframe\")[0].contentDocument;\r\n    \r\n    frame.open();\r\n    frame.write(\"\");\r\n    frame.write(srcDoc);\r\n    frame.close();\r\n    var fra =\r\n      document.getElementsByClassName(\"outputiframe\")[0].contentDocument;\r\n    fra.addEventListener(\"click\", function () {\r\n      console.log(\"clicked!\");\r\n    });\r\n\r\n    fra.addEventListener(\"mousemove\", function () {\r\n      console.log(\"mousemove\");\r\n    });\r\n    \r\n\r\n  });\r\n\r\n\r\n  return (\r\n    <div className=\"text-editor\">\r\n      {/* Sidebar   */}\r\n      <div className=\"editor-sidebar\">\r\n        <div className=\"sidebar-heading\">\r\n          <span id=\"explorer-spam\">Explorer</span>\r\n          <button className=\"sidebar-add-file\">\r\n            {/* <i className = \"fas fa-plus\" style = {{color : \"#fffffe\" }}></i>  */}\r\n          </button>\r\n        </div>\r\n        <div className=\"sidebar-navbutton\">\r\n          <button\r\n            className=\"htmlfile\"\r\n            disabled={fileName === \"index.html\"}\r\n            onClick={() => dispatch(html())}\r\n          >\r\n            <i className=\"fab fa-html5\"></i>{\" \"}\r\n            <span className=\"buttontext html\">{files[\"index.html\"].name} </span>\r\n          </button>\r\n\r\n          <button\r\n            className=\"cssfile\"\r\n            disabled={fileName === \"style.css\"}\r\n            onClick={() => dispatch(css())}\r\n          >\r\n            <i className=\"fab fa-css3-alt\"></i>{\" \"}\r\n            <span className=\"buttontext style\">{files[\"style.css\"].name} </span>\r\n          </button>\r\n\r\n          <button\r\n            className=\"jsfile\"\r\n            disabled={fileName === \"script.js\"}\r\n            onClick={() => dispatch(js())}\r\n          >\r\n            <i className=\"fab fa-js-square\"></i>{\" \"}\r\n            <span className=\"buttontext script\">\r\n              {files[\"script.js\"].name}{\" \"}\r\n            </span>\r\n          </button>\r\n        </div>\r\n        <div className=\"sidebar-footer\">\r\n\r\n          <button\r\n            \r\n            style={{\r\n              color: \"white\",\r\n              backgroundColor: \"green\",\r\n              padding: \"7px\",\r\n              borderRadius: \"5px\",\r\n            }}\r\n            className=\"output\"\r\n          >\r\n            <i className=\"fas fa-chalkboard-teacher\"></i>\r\n            <span\r\n              className=\"outputtext\"\r\n              style={{ color: \"white\", backgroundColor: \"green\" }}\r\n            >\r\n              {\" \"}\r\n              Chalkboard\r\n            </span>\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Editor */}\r\n      <div className=\"editor\">\r\n      <Split\r\n          sizes={[45, 25, 30]}\r\n          direction=\"horizontal\"\r\n          cursor=\"col-resize\"\r\n          className=\"split-flex\"\r\n      >\r\n        <Editor\r\n          height=\"100vh\"\r\n          width=\"47vw\"\r\n          theme=\"vs-light\"\r\n          path={file.name}\r\n          defaultLanguage={file.language}\r\n          defaultValue={file.value}\r\n          saveViewState={true}\r\n          onChange={handleEditorChange}\r\n          cursorSmoothCaretAnimation=\"true\"\r\n          value={file.value}\r\n          className=\"code_text\"\r\n        /> \r\n        \r\n        <iframe\r\n          height=\"100vh\"\r\n       \r\n          src=\"./output/output.html\"\r\n          title=\"output\"\r\n          className=\"outputiframe\"\r\n          frameBorder=\"0\"\r\n        />\r\n         <Console logs={logs} variant=\"light\" />\r\n      </Split>\r\n     \r\n      </div>\r\n\r\n      <div className=\"chalkboardweb\">\r\n          <button className = \"closechalkboard\"><i className=\" fas fa-window-close\"></i></button>\r\n          <ChalkBoard />\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TextEditor;","export const js = () => {\r\n    return {\r\n        type: \"js\"\r\n    };\r\n};\r\n\r\nexport const css = () => {\r\n    return {\r\n        type: \"css\"\r\n    };\r\n};\r\n\r\nexport const html = () => {\r\n    return {\r\n        type: \"html\"\r\n    };\r\n};\r\n\r\nexport const outputModalTrue = () => {\r\n    return {\r\n        type: \"outputtrue\"\r\n    };\r\n};\r\n\r\nexport const outputModalFalse = () => {\r\n    return {\r\n        type: \"outputfalse\"\r\n    };\r\n};\r\n\r\nexport const setSrcDocs = () => {\r\n    return {\r\n        type : \"setSrcdoc\",\r\n    }\r\n}\r\n\r\nexport const c = () => {\r\n    return {\r\n        type : \"c\",\r\n    }\r\n}\r\n\r\nexport const c99 = () => {\r\n    return {\r\n        type : \"c99\",\r\n    }\r\n}\r\n\r\nexport const cpp = () => {\r\n    return {\r\n        type : \"cpp\",\r\n    }\r\n}\r\n\r\nexport const cpp14 = () => {\r\n    return {\r\n        type : \"cpp14\",\r\n    }\r\n}\r\n\r\nexport const cpp17 = () => {\r\n    return {\r\n        type : \"cpp17\",\r\n    }\r\n}\r\n\r\nexport const python2 = () => {\r\n    return {\r\n        type : \"python2\",\r\n    }\r\n}\r\n\r\nexport const python3 = () => {\r\n    return {\r\n        type : \"python3\",\r\n    }\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport Editor from \"@monaco-editor/react\";\r\nimport files from \"../assets/files\";\r\nimport ChalkBoard from \"../ChalkBoard\";\r\nimport ReactModal from \"react-modal\";\r\nimport { c, c99, cpp, cpp14, cpp17, python2, python3 } from \"../actions\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { runCode } from \"../actions/outputAction\";\r\nimport \"./style.css\";\r\nfunction MultiFile(props) {\r\n  const [language, setLanguage] = useState(props.language);\r\n  const [modalActive, setModal] = useState(false);\r\n  const dispatch = useDispatch();\r\n  const [outputValue, setOutputValue] = useState(\"\");\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const file = files[language];\r\n\r\n  function handleEditorChange(value) {\r\n    file.value = value;\r\n  }\r\n\r\n  function handleEditorWillMount(monaco) {\r\n    monaco.editor.defineTheme(\"my-cool-theme\", {\r\n      base: \"vs-dark\",\r\n      inherit: true,\r\n      rules: [],\r\n      colors: { \"editor.background\": \"#293738\" },\r\n    });\r\n  }\r\n\r\n  function handleModal() {\r\n    setModal(true);\r\n  }\r\n\r\n  function handleInput(e) {\r\n    setInputValue(e.target.value);\r\n  }\r\n\r\n  useEffect(() => {\r\n    document\r\n      .getElementsByClassName(\"closechalkboard\")[0]\r\n      .addEventListener(\"click\", function () {\r\n        document.getElementsByClassName(\"chalkboardweb\")[0].style.display =\r\n          \"none\";\r\n      });\r\n\r\n    document\r\n      .getElementsByClassName(\"showModal\")[0]\r\n      .addEventListener(\"click\", function () {\r\n        document.getElementsByClassName(\"chalkboardweb\")[0].style.display =\r\n          \"block\";\r\n      });\r\n  }, []);\r\n\r\n  function handleOutput(e) {\r\n    if (e.isTrusted) {\r\n      const words = file.value.split(\"\\r\");\r\n      let code = \"\";\r\n      for (let i = 0; i < words.length; i++) {\r\n        code = code + words[i];\r\n      }\r\n      dispatch(runCode(language, code, inputValue)).then((e) => {\r\n        setOutputValue(e.data.output);\r\n        const data = {\r\n          output: e.data.output,\r\n        };\r\n        //creating a custom like predefined events like click or mousemove and more\r\n        const event = new CustomEvent(\"output\", { detail: data });\r\n        //dispatching the event in document.documentElement where we listen for it in while recording\r\n        document.documentElement.dispatchEvent(event);\r\n      });\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"multilanguageIde\">\r\n        <div className=\"navbar\">\r\n          <div className=\"editor\">\r\n            <div className=\"navbar\">\r\n              <span className=\"fileName\">\r\n                main\r\n                {language === \"python2\" || language === \"python3\"\r\n                  ? \".py\"\r\n                  : \".cpp\"}\r\n              </span>\r\n              <div className=\"optionButton\">\r\n                <button className=\"showModal\" onClick={handleModal}>\r\n                  <i class=\"fas fa-chalkboard-teacher\"></i>\r\n                </button>\r\n                <button className=\"showCodeOutput\" onClick={handleOutput}>\r\n                  <i class=\"fas fa-play\"></i> Execute\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <Editor\r\n              height=\"95.3vh\"\r\n              width=\"80vw\"\r\n              theme=\"vs-dark\"\r\n              language=\"python\"\r\n              options={{ fontSize: 18, fontWeight: 400, fontFamily: \"cursive\" }}\r\n              onChange={handleEditorChange}\r\n              value={file.value}\r\n              beforeMount={handleEditorWillMount}\r\n            />\r\n          </div>\r\n          <div className=\"inputOutput\">\r\n            <div className=\"inputArea\">\r\n              <h3>Input</h3>\r\n              <textarea\r\n                rows=\"20\"\r\n                cols=\"52\"\r\n                className=\"userInputArea\"\r\n                onChange={handleInput}\r\n                placeholder=\"Enter Input\"\r\n              ></textarea>\r\n            </div>\r\n            <div className=\"outputArea\">\r\n              <h3>Output</h3>\r\n              <textarea\r\n                rows=\"20\"\r\n                cols=\"52\"\r\n                className=\"userOutputArea\"\r\n                value={outputValue}\r\n              ></textarea>\r\n            </div>\r\n          </div>\r\n        </div>\r\n        <div className=\"chalkboardweb\">\r\n          <button className=\"closechalkboard\">\r\n            <i className=\" fas fa-window-close\"></i>\r\n          </button>\r\n          <ChalkBoard />\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default MultiFile;\r\n","import axios from \"axios\";\r\n\r\nconst env = process.env.NODE_ENV; // current environment\r\n\r\nexport const runCode = (language, code, input) => async dispatch => {\r\n    let url\r\n    if(env === \"development\") {\r\n        url = 'http://localhost:5000/'\r\n    }else{\r\n        url = 'https://fierce-reef-05156.herokuapp.com/' \r\n    }\r\n    return await axios.post( url+'api/compile', {\r\n        language: language, \r\n        stdin:input,\r\n        versionIndex: \"0\",\r\n        script:code\r\n    })\r\n}\r\n","import React from 'react';\r\nimport TextEditor from './TextEditor/TextEditor';\r\nimport MultiFile from './MultilanguageEditor/multiFile';\r\n\r\nfunction App(props) {\r\n  console.log(props)\r\n  return (\r\n    <>\r\n    {props.name === \"ide\" ? <TextEditor refresh = {props.refresh}/> :<MultiFile language={props.language} refresh = {props.refresh}/>}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default App;","import React from \"react\";\r\nimport IDE from \"../IDE\";\r\nimport ChalkBoard from \"../ChalkBoard/index\";\r\nimport files from \"../assets/files\";\r\nimport MicRecorder from \"mic-recorder-to-mp3\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\nimport \"firebase/storage\";\r\nimport axios from \"axios\";\r\nimport \"./style.css\";\r\nvar startTime;\r\nexport default function Recorder(props) {\r\n  const name = props.location.state.lectureType;\r\n  const language = props.location.state.languageType;\r\n  console.log(name);\r\n  const Recording = { events: [] };\r\n  var lastMouse = { x: 0, y: 0 };\r\n  var lastKey = \"\";\r\n  let fileName;\r\n  if (name === \"dsa\") {\r\n    fileName = language;\r\n  } else if (name === \"ide\") {\r\n    fileName = \"index.html\";\r\n  }\r\n  let childValue;\r\n  var lastKeyClass = \"\";\r\n\r\n  function callbackFunction(childData) {\r\n    childValue = childData;\r\n    //console.log(childValue)\r\n  }\r\n  // Record each type of event\r\n  const handlers = [\r\n    {\r\n      eventName: \"mouseup\",\r\n      handler: function handleMouseMove(e) {\r\n        Recording.events.push({\r\n          type: \"mouseup\",\r\n          target: e.target.className,\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"mousedown\",\r\n      handler: function handleMouseMove(e) {\r\n        Recording.events.push({\r\n          type: \"mousedown\",\r\n          button: e.button,\r\n          clientX: e.clientX,\r\n          target: e.target.className,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"mousemove\",\r\n      handler: function handleMouseMove(e) {\r\n        lastMouse = { x: e.pageX, y: e.pageY };\r\n        Recording.events.push({\r\n          type: \"mousemove\",\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n          target: lastKeyClass,\r\n          class: e.target.className,\r\n          x: e.pageX,\r\n          fileName: fileName,\r\n          y: e.pageY,\r\n          value: lastKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"dblclick\",\r\n      handler: function handleMouseMove(e) {\r\n        console.log(e);\r\n        Recording.events.push({\r\n          type: \"dblclick\",\r\n          button: e.button,\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n          altKey: e.altKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"click\",\r\n      handler: function handleClick(e) {\r\n        if (\r\n          e.target.className === \"cssfile\" ||\r\n          e.target.className === \"buttontext style\" ||\r\n          e.target.className === \"fab fa-css3-alt\"\r\n        )\r\n          fileName = \"style.css\";\r\n        if (\r\n          e.target.className === \"jsfile\" ||\r\n          e.target.className === \"buttontext script\" ||\r\n          e.target.className === \" fa-js-square\"\r\n        )\r\n          fileName = \"script.js\";\r\n        if (\r\n          e.target.className === \"htmlfile\" ||\r\n          e.target.className === \"buttontext html\" ||\r\n          e.target.className === \"fab fa-html5fab\"\r\n        )\r\n        fileName = \"index.html\";\r\n        console.log(e.target.className);\r\n        Recording.events.push({\r\n          type: \"click\",\r\n          target: e.target.className,\r\n          x: e.pageX,\r\n          fileName: fileName,\r\n          y: e.pageY,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"keyup\",\r\n      handler: function handleKeyPress(e) {\r\n        console.log(files[fileName]);\r\n        if (name === \"ide\" || name === \"dsa\") {\r\n          lastKey = childValue;\r\n          lastKeyClass = e.target.className;\r\n          Recording.events.push({\r\n            type: \"keyup\",\r\n            target: e.target.className,\r\n            x: lastMouse.x,\r\n            y: lastMouse.y,\r\n            fileName: fileName,\r\n            value:\r\n              e.target.className === \"userInputArea\"\r\n                ? e.target.value\r\n                : files[fileName].value,\r\n            keyCode: e.keyCode,\r\n            time: Date.now() - startTime,\r\n          });\r\n        }\r\n      },\r\n    },\r\n    {\r\n      eventName: \"keydown\",\r\n      handler: function handleKeyPress(e) {\r\n        let value = null;\r\n        if(document.getElementsByClassName(\"canvas_text\")[0]) value = document.getElementsByClassName(\"canvas_text\")[0].value;\r\n        Recording.events.push({\r\n          type: \"keydown\",\r\n          key: e.key,\r\n          code: e.code,\r\n          isComposing: e.isComposing,\r\n          shiftKey: e.shiftKey,\r\n          value: value,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    // {\r\n    //   eventName: \"click\",\r\n    //   handler: function handleClick(e) {\r\n    //     if(name === \"dsa\"){\r\n    //       if(language  === \"c\" ||\r\n    //       language === \"c99\" ||\r\n    //       language === \"cpp\" ||\r\n    //       language === \"cpp14\" ||\r\n    //       language === \"cpp17\" ||\r\n    //       language === \"python2\" ||\r\n    //       language === \"python3\"){\r\n    //         fileName = language\r\n    //       }\r\n    //       Recording.events.push({\r\n    //         type: \"click\",\r\n    //         target: e.target.className,\r\n    //         x: e.pageX,\r\n    //         fileName :fileName,\r\n    //         y: e.pageY,\r\n    //         value:files[fileName].value,\r\n    //         time: Date.now() - startTime,\r\n    //       });\r\n    //     }\r\n    //   },\r\n    //   },\r\n    {\r\n      eventName: \"output\",\r\n      handler: function handleChange(e) {\r\n        Recording.events.push({\r\n          type: \"output\",\r\n          target: \"userOutputArea\",\r\n          time: Date.now() - startTime,\r\n          value: e.detail.output,\r\n        });\r\n      },\r\n    },\r\n  ];\r\n\r\n  const Mp3Recorder = new MicRecorder({\r\n    bitRate: 128,\r\n    prefix: \"data:audio/wav;base64,\",\r\n  });\r\n\r\n  function listen(eventName, handler) {\r\n    return document.documentElement.addEventListener(eventName, handler, true);\r\n  }\r\n\r\n  function startRecording() {\r\n    startTime = Date.now();\r\n    Recording.events = [];\r\n    handlers.map((x) => listen(x.eventName, x.handler));\r\n    Mp3Recorder.start()\r\n      .then(() => {\r\n        console.log(\"Started recording\");\r\n      })\r\n      .catch((e) => console.error(e));\r\n  }\r\n\r\n  function removeListener(eventName, handler) {\r\n    return document.documentElement.removeEventListener(\r\n      eventName,\r\n      handler,\r\n      true\r\n    );\r\n  }\r\n\r\n  function handleClick(e) {\r\n    e.preventDefault();\r\n    document.getElementsByClassName(\"record\")[0].style.display = \"none\";\r\n    document.getElementsByClassName(\"stop-record\")[0].style.display = \"block\";\r\n    startRecording();\r\n    console.log(\"The Button was clicked.\");\r\n  }\r\n\r\n  function stopRecording() {\r\n    // stop recording\r\n    handlers.map((x) => removeListener(x.eventName, x.handler));\r\n    localStorage.setItem(\"recording\", JSON.stringify(Recording));\r\n    document.getElementsByClassName(\"stop-record\")[0].style.display = \"none\";\r\n    document.getElementsByClassName(\"record\")[0].style.display = \"block\";\r\n    const recordingString = JSON.stringify(Recording);\r\n    console.log(Recording);\r\n    firebase\r\n      .firestore()\r\n      .collection(\"events\")\r\n      .add({\r\n        recordingString,\r\n        createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n        name: props.location.state.lectureName,\r\n        creator: props.location.state.lectureCreator,\r\n        type: props.location.state.lectureType,\r\n      })\r\n      .then((result) => {\r\n        localStorage.setItem(\"recordingId\", JSON.stringify(result.id));\r\n        firebase\r\n          .firestore()\r\n          .collection(\"recordIndex\")\r\n          .add({\r\n            createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n            name: props.location.state.lectureName,\r\n            type: props.location.state.lectureType,\r\n            creator: props.location.state.lectureCreator,\r\n            language: language,\r\n            id: result.id,\r\n          })\r\n          .then((result) => {\r\n            console.log(\"Recording Tally Saved\");\r\n          });\r\n        console.log(\"Recording Saved\");\r\n        let audioString;\r\n        Mp3Recorder.stop()\r\n          .getMp3()\r\n          .then(([buffer, blob]) => {\r\n            new File(buffer, \"me-at-thevoice.mp3\", {\r\n              type: blob.type,\r\n              lastModified: Date.now(),\r\n            });\r\n            var reader = new FileReader();\r\n            reader.readAsDataURL(blob);\r\n            reader.onloadend = () => {\r\n              audioString = reader.result;\r\n              var storageRef = firebase.storage().ref();\r\n              const id = JSON.parse(localStorage.getItem(\"recordingId\"));\r\n              localStorage.removeItem(\"recordingId\");\r\n              const lectureData = {\r\n                recording: recordingString,\r\n                audio: audioString,\r\n              };\r\n              var audioRef = storageRef.child(id);\r\n              audioRef\r\n                .putString(audioString, \"data_url\")\r\n                .then((snapshot) => {\r\n                  alert(\"Audio saved!\");\r\n                })\r\n                .catch((e) => {\r\n                  console.log(e);\r\n                });\r\n              axios.post(\"http://localhost:5000/savedata\", {\r\n                lectureData,\r\n              });\r\n            };\r\n          })\r\n          .catch((e) => console.log(e));\r\n      });\r\n  }\r\n\r\n  function handleStop(e) {\r\n    e.preventDefault();\r\n    stopRecording();\r\n    console.log(\"Recording Stopped.\");\r\n  }\r\n  //console.log(Recording)\r\n  return (\r\n    <>\r\n      <div className=\"recorder\">\r\n        <div className=\"recorder-button\">\r\n          <i className=\"fas fa-microphone record\" onClick={handleClick}></i>\r\n          <i\r\n            className=\"fas fa-microphone-slash stop-record\"\r\n            onClick={handleStop}\r\n          ></i>\r\n        </div>\r\n        {name === \"dra\" ? (\r\n          <div className=\"chalk\">\r\n            {\" \"}\r\n            <ChalkBoard />{\" \"}\r\n          </div>\r\n        ) : (\r\n          <IDE\r\n            name={name}\r\n            language={language}\r\n            parentCallBack={callbackFunction}\r\n          />\r\n        )}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport IDE from \"../IDE\";\r\nimport files from \"../assets/files\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useParams } from \"react-router\";\r\n\r\nimport {\r\n  js,\r\n  css,\r\n  html,\r\n  outputModalTrue,\r\n  outputModalFalse,\r\n  setSrcDocs,\r\n} from \"../actions\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\nimport \"firebase/storage\";\r\nimport \"./style.css\";\r\nimport ChalkBoard from \"../ChalkBoard/index\";\r\nimport img from \"../assets/Gear-0.2s-200px.png\";\r\n\r\nfunction Preloader() {\r\n  return (\r\n    <div className=\"loader\">\r\n      <div className=\"preloader\">\r\n        <div className=\"load\">\r\n          <img src={img} border=\"0\" />\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default function Video(props) {\r\n  //lecture fetching from firebase and which text editor to open\r\n  const { id, type } = useParams();\r\n  const name = type.slice(0, 3);\r\n  const language = type.slice(3, 10);\r\n\r\n  //TODO needed to reload the text editor\r\n  const [refresh, setRefresh] = useState(\"\");\r\n\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    //TODO naming of var\r\n    const playerBlock = document.getElementsByClassName(\"player-content\")[0];\r\n    const videoPlayer = document.getElementsByClassName(\"videoplayer\")[0];\r\n    const playButton = document.getElementsByClassName(\"playButton\")[0];\r\n    const audioPlayer = document.getElementById(\"audio_player\");\r\n    var startPlay;\r\n    let offsetPlay = 0;\r\n    var i = 0;\r\n    var paused = false;\r\n\r\n    localStorage.setItem(\"lastSessionTimeStamp\", JSON.stringify(offsetPlay));\r\n\r\n    // fetch recording from local storage\r\n    let recording = { events: [] };\r\n\r\n    // fetch from firebase collection\r\n    firebase\r\n      .firestore()\r\n      .collection(\"events\")\r\n      .where(firebase.firestore.FieldPath.documentId(), \"==\", id)\r\n      .get()\r\n      .then((snap) => {\r\n        snap.forEach((doc) => {\r\n          console.log(doc.data());\r\n          recording = JSON.parse(doc.data().recordingString);\r\n        });\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n\r\n    // fetch from cloud storage\r\n    var storageRef = firebase.storage().ref();\r\n    storageRef\r\n      .child(id)\r\n      .getDownloadURL()\r\n      .then((url) => {\r\n        audioPlayer.src = url;\r\n        localStorage.setItem(\"url\", url);\r\n      })\r\n      .catch((e) => {\r\n        console.log(e);\r\n      });\r\n\r\n    //fake cursor for playing, create and append\r\n    const fakeCursor = document.createElement(\"div\");\r\n    fakeCursor.className = \"customCursor\";\r\n    document.getElementById(\"root\").appendChild(fakeCursor);\r\n    fakeCursor.style.display = 'none'\r\n\r\n    function playerPlay() {\r\n      playButton.style.display=\"none\"\r\n      playfunction();\r\n      const data = {\r\n        status:false\r\n      }\r\n      const event = new CustomEvent(\"status\", { detail: data });\r\n      document.dispatchEvent(event);\r\n    }\r\n\r\n    function playerPause() {\r\n      console.log(\"clicked pause\");\r\n      const data = {\r\n        status:true\r\n      }\r\n      const event = new CustomEvent(\"status\", { detail: data });\r\n      document.dispatchEvent(event);\r\n      pausefunction();\r\n    }\r\n\r\n\r\n    //pause/play on spacebar and dispach an event acc\r\n    playerBlock.addEventListener(\"keypress\", (e) => {\r\n      if(e.charCode === 32){\r\n        if(audioPlayer.paused){\r\n          audioPlayer.play()\r\n          playerPlay()\r\n          console.log(\"audio play\")\r\n        }else{\r\n          audioPlayer.pause()\r\n          playerPause()\r\n        }\r\n      }\r\n    });\r\n\r\n    //init player\r\n    audioPlayer.addEventListener(\"canplay\", () => {\r\n      document.getElementsByClassName(\"player-content\")[0].style.display =\r\n        \"block\";\r\n      document.getElementsByClassName(\"loader\")[0].style.display = \"none\";\r\n      console.log(\"loaded\");\r\n    });\r\n\r\n    //TODO\r\n    audioPlayer.addEventListener(\"play\", () => {\r\n      playerPlay()\r\n      console.log(\"audio play\")\r\n    })\r\n    \r\n    //TODO\r\n    audioPlayer.addEventListener(\"pause\", () => {\r\n      playerPause()\r\n    })\r\n    \r\n    audioPlayer.addEventListener(\"ended\", () => {\r\n      pausefunction();\r\n      console.log(\"ended audio\");\r\n    });\r\n\r\n    audioPlayer.addEventListener(\"seeking\", () => {\r\n      fakeCursor.style.display = \"none\";\r\n      pausefunction();\r\n      audioPlayer.pause();\r\n      //returns the time at which the audio is after seeking it\r\n      const curTime = audioPlayer.currentTime;\r\n\r\n      //TODO: Implement binary search or lower bound\r\n      for (let x = 0; x < recording.events.length; x++) {\r\n        if (recording.events[x].time >= curTime * 1000) {\r\n          i = x;\r\n          break;\r\n        }\r\n      }\r\n\r\n      if (recording.events[i].time > curTime * 1000) {\r\n        localStorage.setItem(\"lastSessionTimeStamp\", recording.events[i].time);\r\n      } else {\r\n        localStorage.setItem(\"lastSessionTimeStamp\", curTime * 1000);\r\n      }\r\n    });\r\n\r\n    playButton.addEventListener(\"click\", () => {\r\n      playButton.style.display = \"none\";\r\n      videoPlayer.style.display = \"flex\";\r\n      audioPlayer.play();\r\n      playfunction();\r\n    });\r\n\r\n    function pausefunction() {\r\n      fakeCursor.style.display = \"none\";\r\n      paused = true;\r\n      localStorage.setItem(\"lastSessionTimeStamp\", JSON.stringify(offsetPlay));\r\n    }\r\n\r\n    function playfunction() {\r\n      if (document.getElementsByClassName(\"videoscreen\")[0] != null)\r\n        document.getElementsByClassName(\"videoscreen\")[0].className =\r\n          \"visiblescreen\";\r\n      //append fake cursor when user clicks play button\r\n      fakeCursor.style.display = \"block\";\r\n      startPlay = Date.now();\r\n      paused = false;\r\n      var frames;\r\n      //draw event to play all events in requestAnimationFrames\r\n      function draw() {\r\n        //select an event and check if its empty\r\n        let event = recording.events[i];\r\n        if (!event) {\r\n          return;\r\n        }\r\n\r\n        //must have pause before\r\n        if (localStorage.getItem(\"lastSessionTimeStamp\") !== null) {\r\n          offsetPlay =\r\n            JSON.parse(localStorage.getItem(\"lastSessionTimeStamp\")) +\r\n            Date.now() -\r\n            startPlay;\r\n        } else {\r\n          offsetPlay = (Date.now() - startPlay) * 1;\r\n        }\r\n\r\n        if (event.time <= offsetPlay) {\r\n          //draws event amd matches with listner\r\n          drawEvent(event, fakeCursor);\r\n          i++;\r\n        }\r\n\r\n        if (i >= recording.events.length || paused) {\r\n          clearInterval(frames);\r\n          //  if(i >= (recording.events.length - 1)){\r\n          //    paused = true\r\n          //  }\r\n        }\r\n      }\r\n\r\n      frames = setInterval(() => {\r\n        if (!paused) draw();\r\n      }, 1);\r\n    }\r\n\r\n    function handleButtonEvents(target) {\r\n      switch (target) {\r\n        case \"outputtext\":\r\n          dispatch(setSrcDocs());\r\n          dispatch(outputModalTrue());\r\n          break;\r\n        case \"output\":\r\n          dispatch(setSrcDocs());\r\n          dispatch(outputModalTrue());\r\n          break;\r\n        case \"buttontext output\":\r\n          dispatch(setSrcDocs());\r\n          dispatch(outputModalTrue());\r\n          break;\r\n        case \"fas fa-play\":\r\n          dispatch(setSrcDocs());\r\n          dispatch(outputModalTrue());\r\n          break;\r\n        case \"fas fa-window-close\":\r\n          dispatch(outputModalFalse());\r\n          break;\r\n        case \"style.css\":\r\n          dispatch(css());\r\n          break;\r\n        case \"buttontext style\":\r\n          dispatch(css());\r\n          break;\r\n        case \"index.html\":\r\n          dispatch(html());\r\n          break;\r\n        case \"script.js\":\r\n          dispatch(js());\r\n          break;\r\n        case \"buttontext script\":\r\n          dispatch(js());\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    }\r\n\r\n    function drawEvent(event, fakeCursor) {\r\n      if (event.type === \"mousedown\") {\r\n        let eve = new PointerEvent(\"pointerdown\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: event.button,\r\n          clientX: event.clientX,\r\n          clientY: event.clientY,\r\n          shiftKey: event.shiftKey,\r\n        });\r\n        console.log(event.target);\r\n        if (document.getElementsByClassName(event.target)[0])\r\n          document.getElementsByClassName(event.target)[0].dispatchEvent(eve);\r\n      } else if (event.type === \"mousemove\") {\r\n        // TODO: Add e.buttons too\r\n        let eve = new PointerEvent(\"pointermove\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: event.button,\r\n          clientX: event.clientX,\r\n          clientY: event.clientY,\r\n          shiftKey: event.shiftKey,\r\n        });\r\n\r\n        if (document.getElementsByClassName(event.class)[0]) {\r\n          document.getElementsByClassName(event.class)[0].dispatchEvent(eve);\r\n        }\r\n\r\n        //document.getElementsByClassName(\"cursor\")[0].style.top = JSON.stringify(event.y) + \"px\";\r\n        fakeCursor.style.left = JSON.stringify(event.x) + \"px\";\r\n        fakeCursor.style.top = JSON.stringify(event.y) + \"px\";\r\n        const path = event.target;\r\n        handleButtonEvents(event.fileName);\r\n        var tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n        }\r\n      } else if (event.type === \"mouseup\") {\r\n        let eve = new PointerEvent(\"pointerup\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: event.button,\r\n          clientX: event.clientX,\r\n          clientY: event.clientY,\r\n          shiftKey: event.shiftKey,\r\n        });\r\n        if (document.getElementsByClassName(event.target)[0])\r\n          document.getElementsByClassName(event.target)[0].dispatchEvent(eve);\r\n      } else if (event.type === \"keydown\") {\r\n\r\n        let eve = new KeyboardEvent(\"keydown\", {\r\n          key: event.key,\r\n          shiftKey: event.shiftKey,\r\n          code: event.code,\r\n          isComposing: event.isComposing,\r\n          bubbles: true,\r\n          cancelable: true,\r\n        });\r\n        \r\n        if (document.getElementsByClassName(\"canvas_text\")[0]) {\r\n          // document.getElementsByClassName(\"canvas_text\")[0].dispatchEvent(eve_up);\r\n          document.getElementsByClassName(\"canvas_text\")[0].value = event.value;  \r\n          document.getElementsByClassName(\"canvas_text\")[0].dispatchEvent(eve); \r\n        }\r\n      } else if(event.type === \"dblclick\"){\r\n        let eve = new PointerEvent(\"dblclick\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: event.button,\r\n          clientX: event.clientX,\r\n          clientY: event.clientY,\r\n          shiftKey: event.shiftKey,\r\n        });\r\n        if (document.getElementsByClassName(event.target)[0])\r\n          document.getElementsByClassName(event.target)[0].dispatchEvent(eve);\r\n      }  else if (event.type === \"click\") {\r\n        if (document.getElementsByClassName(event.target)[0] !== undefined) {\r\n          let clickEvent = new MouseEvent(\"click\", {\r\n            pageX: event.x,\r\n            pageY: event.y,\r\n            bubbles: true,\r\n            cancelable: true,\r\n          });\r\n\r\n          document\r\n            .getElementsByClassName(event.target)[0]\r\n            .dispatchEvent(clickEvent);\r\n        }\r\n        if (\r\n          event.target === \"rectangle\" ||\r\n          event.target === \"ellipse\" ||\r\n          event.target === \"arrow\" ||\r\n          event.target === \"selection\"\r\n        )\r\n          document.getElementsByClassName(event.target)[0].click();\r\n        flashClass(fakeCursor, \"click\");\r\n        tar = document.getElementsByClassName(event.target)[0];\r\n        if (tar != null) {\r\n          handleButtonEvents(event.fileName);\r\n          handleButtonEvents(event.target);\r\n          flashClass(tar, \"clicked\");\r\n        }\r\n      } else if (event.type === \"keyup\") {\r\n        const path = event.target;\r\n        tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n          if (path === \"userInputArea\") {\r\n            tar.value = event.value;\r\n          } else {\r\n            files[event.fileName].value = event.value;\r\n            handleButtonEvents(event.fileName);\r\n            setRefresh(event.value);\r\n          }\r\n        }\r\n      } else if (event.type === \"output\") {\r\n        const path = event.target;\r\n        tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n          if (path === \"userOutputArea\") {\r\n            tar.value = event.value;\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    function flashClass(el, className) {\r\n      el.classList.add(className);\r\n      setTimeout(function () {\r\n        el.classList.remove(className);\r\n      }, 200);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <Preloader />\r\n      <div className=\"player-content\">\r\n        <div className=\"videoscreen\">\r\n          {/* <IDE name={name} refresh = {refresh}/> */}\r\n          {name === \"dra\" ? (\r\n            <div className=\"chalk\">\r\n              <ChalkBoard />\r\n            </div>\r\n          ) : (\r\n            <IDE name={name} language={language} refresh={refresh} />\r\n          )}\r\n        </div>\r\n        <div className=\"playButton\">\r\n          <div className=\"container\">\r\n            <a className=\"button button-play\"></a>\r\n          </div>\r\n        </div>\r\n        <div className=\"videoplayer\">\r\n          <audio\r\n            id=\"audio_player\"\r\n            controls=\"controls\"\r\n            controlsList=\"nodownload\"\r\n          ></audio>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","export default \"data:image/png;base64,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\"","import \"./style.css\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\nimport { useEffect } from \"react\";\r\n\r\nexport default function Test() {\r\n  useEffect(() => {\r\n    const firebaseConfig = {\r\n      apiKey: \"AIzaSyAp2cQvNNp8fUKOv6kO_7wR5IsKROCoh14\",\r\n      authDomain: \"engage-6ef42.firebaseapp.com\",\r\n      projectId: \"engage-6ef42\",\r\n      storageBucket: \"engage-6ef42.appspot.com\",\r\n      messagingSenderId: \"27842359842\",\r\n      appId: \"1:27842359842:web:e8f5b15f6a86ac66fa507b\",\r\n      measurementId: \"G-EVEY2DP36T\",\r\n    };\r\n\r\n    if (!firebase.apps.length) {\r\n      firebase.initializeApp(firebaseConfig);\r\n    }\r\n    const firestore = firebase.firestore();\r\n\r\n    const servers = {\r\n      iceServers: [\r\n        {\r\n          urls: [\r\n            \"stun:stun1.l.google.com:19302\",\r\n            \"stun:stun2.l.google.com:19302\",\r\n          ],\r\n        },\r\n      ],\r\n      iceCandidatePoolSize: 10,\r\n    };\r\n\r\n    // Global State\r\n    const pc = new RTCPeerConnection(servers);\r\n    let localStream = null;\r\n    let remoteStream = null;\r\n\r\n    // HTML elements\r\n    const webcamButton = document.getElementById(\"webcamButton\");\r\n    const webcamVideo = document.getElementById(\"webcamVideo\");\r\n    const callButton = document.getElementById(\"callButton\");\r\n    const callInput = document.getElementById(\"callInput\");\r\n    const answerButton = document.getElementById(\"answerButton\");\r\n    const remoteVideo = document.getElementById(\"remoteVideo\");\r\n    const hangupButton = document.getElementById(\"hangupButton\");\r\n\r\n    // 1. Setup media sources\r\n\r\n    webcamButton.onclick = async () => {\r\n      localStream = await navigator.mediaDevices.getUserMedia({\r\n        video: true,\r\n        audio: true,\r\n      });\r\n      remoteStream = new MediaStream();\r\n\r\n      // Push tracks from local stream to peer connection\r\n      localStream.getTracks().forEach((track) => {\r\n        pc.addTrack(track, localStream);\r\n      });\r\n\r\n      // Pull tracks from remote stream, add to video stream\r\n      pc.ontrack = (event) => {\r\n        event.streams[0].getTracks().forEach((track) => {\r\n          remoteStream.addTrack(track);\r\n        });\r\n      };\r\n\r\n      webcamVideo.srcObject = localStream;\r\n      remoteVideo.srcObject = remoteStream;\r\n\r\n      callButton.disabled = false;\r\n      answerButton.disabled = false;\r\n      webcamButton.disabled = true;\r\n    };\r\n\r\n    // 2. Create an offer\r\n    callButton.onclick = async () => {\r\n      // Reference Firestore collections for signaling\r\n      const callDoc = firestore.collection(\"calls\").doc();\r\n      const offerCandidates = callDoc.collection(\"offerCandidates\");\r\n      const answerCandidates = callDoc.collection(\"answerCandidates\");\r\n\r\n      callInput.value = callDoc.id;\r\n\r\n      // Get candidates for caller, save to db\r\n      pc.onicecandidate = (event) => {\r\n        event.candidate && offerCandidates.add(event.candidate.toJSON());\r\n      };\r\n\r\n      // Create offer\r\n      const offerDescription = await pc.createOffer();\r\n      await pc.setLocalDescription(offerDescription);\r\n\r\n      const offer = {\r\n        sdp: offerDescription.sdp,\r\n        type: offerDescription.type,\r\n      };\r\n\r\n      await callDoc.set({ offer });\r\n\r\n      // Listen for remote answer\r\n      callDoc.onSnapshot((snapshot) => {\r\n        const data = snapshot.data();\r\n        if (!pc.currentRemoteDescription && data?.answer) {\r\n          const answerDescription = new RTCSessionDescription(data.answer);\r\n          pc.setRemoteDescription(answerDescription);\r\n        }\r\n      });\r\n\r\n      // When answered, add candidate to peer connection\r\n      answerCandidates.onSnapshot((snapshot) => {\r\n        snapshot.docChanges().forEach((change) => {\r\n          if (change.type === \"added\") {\r\n            const candidate = new RTCIceCandidate(change.doc.data());\r\n            pc.addIceCandidate(candidate);\r\n          }\r\n        });\r\n      });\r\n\r\n      hangupButton.disabled = false;\r\n    };\r\n\r\n    // 3. Answer the call with the unique ID\r\n    answerButton.onclick = async () => {\r\n      const callId = callInput.value;\r\n      const callDoc = firestore.collection(\"calls\").doc(callId);\r\n      const answerCandidates = callDoc.collection(\"answerCandidates\");\r\n      const offerCandidates = callDoc.collection(\"offerCandidates\");\r\n\r\n      pc.onicecandidate = (event) => {\r\n        event.candidate && answerCandidates.add(event.candidate.toJSON());\r\n      };\r\n\r\n      const callData = (await callDoc.get()).data();\r\n\r\n      const offerDescription = callData.offer;\r\n      await pc.setRemoteDescription(\r\n        new RTCSessionDescription(offerDescription)\r\n      );\r\n\r\n      const answerDescription = await pc.createAnswer();\r\n      await pc.setLocalDescription(answerDescription);\r\n\r\n      const answer = {\r\n        type: answerDescription.type,\r\n        sdp: answerDescription.sdp,\r\n      };\r\n\r\n      await callDoc.update({ answer });\r\n\r\n      offerCandidates.onSnapshot((snapshot) => {\r\n        snapshot.docChanges().forEach((change) => {\r\n          console.log(change);\r\n          if (change.type === \"added\") {\r\n            let data = change.doc.data();\r\n            pc.addIceCandidate(new RTCIceCandidate(data));\r\n          }\r\n        });\r\n      });\r\n    };\r\n  }, []);\r\n  return (\r\n    <>\r\n      <h2>1. Start your Webcam</h2>\r\n      <div className=\"videos\">\r\n        <span>\r\n          <h3>Local Stream</h3>\r\n          <video id=\"webcamVideo\" autoPlay playsInline></video>\r\n        </span>\r\n        <span>\r\n          <h3>Remote Stream</h3>\r\n          <video id=\"remoteVideo\" autoPlay playsInline></video>\r\n        </span>\r\n      </div>\r\n\r\n      <button id=\"webcamButton\">Start webcam</button>\r\n      <h2>2. Create a new Call</h2>\r\n      <button id=\"callButton\" disabled>\r\n        Create Call (offer)\r\n      </button>\r\n\r\n      <h2>3. Join a Call</h2>\r\n      <p>Answer the call from a different browser window or device</p>\r\n\r\n      <input id=\"callInput\" />\r\n      <button id=\"answerButton\" disabled>\r\n        Answer\r\n      </button>\r\n\r\n      <h2>4. Hangup</h2>\r\n\r\n      <button id=\"hangupButton\" disabled>\r\n        Hangup\r\n      </button>\r\n    </>\r\n  );\r\n}","import React from \"react\";\r\nimport \"./styles.css\";\r\nimport { Link } from \"react-router-dom\";\r\nimport {motion} from 'framer-motion';\r\nimport { v4 as uuidv4 } from 'uuid';\r\n\r\nfunction UserSection() {\r\n  const classid = uuidv4();\r\n  return (\r\n    <motion.section className = \"usersection\" initial= {{opacity:0, scale: 0.8 }} animate={{opacity:1, scale: 1}} transition= {{duration: 0.2}}>\r\n      \r\n<main className=\"main\">\r\n\t<div className=\"responsive-wrapper\">\r\n\t\t<div className=\"main-header\">\r\n\t\t\t<h1>Engage Proof of Concept Demo</h1>\r\n\t\t</div>\r\n\t\t<div className=\"horizontal-tabs\">\r\n\t\t\t<a href=\"#\" className=\"active\">Applications</a>\r\n\t\t\t<Link to = \"/lectures\">Watch Lectures</Link>\r\n\t\t</div>\r\n\t\t<div className=\"content-header\">\r\n\t\t\t<div className=\"content-header-intro\">\r\n\t\t\t\t<h2>Intergrations and connected apps</h2>\r\n\t\t\t\t<p>Supercharge your Productivity.</p>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"content-header-actions\">\r\n                <a href=\"#\" className=\"us_button\">\r\n\t\t\t\t\t<span>Live Classes</span>\r\n\t\t\t\t</a>\r\n                <Link to = \"/recordform\">\r\n\t\t\t\t<div className=\"us_button\">\r\n\t\t\t\t\t<span>Record A Lecture</span>\r\n\t\t\t\t</div>\r\n                </Link>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t\t<div className=\"content\">\r\n\t\t\t<div className=\"content-panel\">\r\n\t\t\t\t<div className=\"vertical-tabs\">\r\n\t\t\t\t\t<a href=\"#\" className=\"active\">View all</a>\r\n\t\t\t\t\t<a href=\"#\">Teaching tools</a>\r\n\t\t\t\t\t<a href=\"#\">Computer Science</a>\r\n\t\t\t\t\t<a href=\"#\">Chemistry</a>\r\n\t\t\t\t\t<a href=\"#\">Physics</a>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"content-main\">\r\n\t\t\t\t<div className=\"us-card-grid\">\r\n                    <Link to=\"/drawboard\">\r\n\t\t\t\t\t<article className=\"uscard\">\r\n\t\t\t\t\t\t<div className=\"card-header\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<span><img  className = \"us_img\" src=\"https://assets.codepen.io/285131/zeplin.svg\" /></span>\r\n\t\t\t\t\t\t\t\t<h3>Chalk Board</h3>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-body\">\r\n\t\t\t\t\t\t\t<p>Custom ChalkBoard specially designed for teaching, tailored made UI/UX for different subjects</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-footer\">\r\n\t\t\t\t\t\t\t<div>View integration</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</article>\r\n                    </Link>\r\n                    \r\n\t\t\t\t\t<Link to=\"/webd\">\r\n                    <article className=\"uscard\">\r\n\t\t\t\t\t\t<div className=\"card-header\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<span><img className = \"us_img\" src=\"https://assets.codepen.io/285131/zeplin.svg\" /></span>\r\n\t\t\t\t\t\t\t\t<h3>WebD IDE</h3>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-body\">\r\n\t\t\t\t\t\t\t<p>Web Development IDE for beginners, that works on vscode editor</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-footer\">\r\n\t\t\t\t\t\t\t<div>View integration</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</article>\r\n                    </Link>\r\n                    \r\n\t\t\t\t\t<Link to=\"/drawboard\">\r\n                    <article className=\"uscard\">\r\n\t\t\t\t\t\t<div className=\"card-header\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<span><img  className = \"us_img\" src=\"https://assets.codepen.io/285131/zeplin.svg\" /></span>\r\n\t\t\t\t\t\t\t\t<h3>C++ IDE</h3>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-body\">\r\n\t\t\t\t\t\t\t<p>Learn DSA in C++, using the c++ compiler and IDE</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-footer\">\r\n\t\t\t\t\t\t\t<div>View integration</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</article>\r\n                    </Link>\r\n\t\t\t\t\t<Link to=\"/classform\">\r\n                    <article className=\"uscard\">\r\n\t\t\t\t\t\t<div className=\"card-header\">\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<span><img  className = \"us_img\" src=\"https://assets.codepen.io/285131/zeplin.svg\" /></span>\r\n\t\t\t\t\t\t\t\t<h3>Live Classes</h3>\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-body\">\r\n\t\t\t\t\t\t\t<p>Conduct a Live Class Room Session</p>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div className=\"card-footer\">\r\n\t\t\t\t\t\t\t<div>View integration</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</article>\r\n                    </Link>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t</div>\r\n</main>\r\n    </motion.section>\r\n  );\r\n}\r\n\r\nexport default UserSection;\r\n","import React, { useEffect} from 'react'\r\nimport {useHistory} from \"react-router-dom\";\r\nimport { motion } from \"framer-motion\";\r\nimport \"./style.css\"\r\nimport { v4 as uuidv4 } from 'uuid';\r\nfunction RecorderForm() {\r\n    const classid = uuidv4();\r\n    const path = document.location.pathname\r\n    const history = useHistory();\r\n    let lectureName;\r\n    let lectureType;\r\n    let lectureCreator;\r\n    let languageType;\r\n    const navigateToRecorderWeb = () => history.push({\r\n        pathname:'/recorder',\r\n        state:{lectureType, lectureName, lectureCreator, languageType}}\r\n    );\r\n    const navigateToLiveClass = () => history.push({\r\n        pathname:`/emitter/${lectureType+languageType}/${classid}`,\r\n        state:{lectureType, lectureName, lectureCreator, languageType}}\r\n    );\r\n\r\n\r\n    const languageList = {\r\n        \"Python 2\": \"python2\", \r\n        C: \"c\",\r\n        \"C-99\": \"c99\",\r\n        \"C++\": \"cpp\",\r\n        \"C++ 14\": \"cpp14\",\r\n        \"C++ 17\": \"cpp17\",\r\n        \"Python 3\": \"python3\",\r\n      };\r\n    \r\n\r\n    useEffect(() => {\r\n\r\n        const select = document.getElementById(\"language\");\r\n        for (let key in languageList) {\r\n          var option = document.createElement(\"option\");\r\n          option.text = key;\r\n          option.value = languageList[key];\r\n          option.className = languageList[key];\r\n          select.add(option);\r\n        }\r\n\r\n        const type = document.getElementById(\"lectureType\")\r\n        const name = document.getElementById(\"lectureName\")\r\n        const creator = document.getElementById(\"creator\")\r\n        const button = document.getElementById(\"submit\")\r\n\r\n        button.addEventListener(\"click\", () => {\r\n            lectureType = type.value\r\n            lectureName = name.value\r\n            lectureCreator = creator.value\r\n            if(lectureType === \"dsa\"){\r\n                languageType = select.value\r\n            }else{\r\n                languageType = ''\r\n            }\r\n        })\r\n        type.addEventListener(\"change\", (e) =>{\r\n            if(e.target.value === \"dsa\"){\r\n                select.style.display = \"block\"\r\n            }else{\r\n                select.style.display = \"none\"\r\n            }\r\n        })\r\n    },[])\r\n\r\n    return (\r\n        <motion.div  initial= {{opacity:0, scale: 0.8 }} animate={{opacity:1, scale: 1, duration:0.5}} transition= {{type: \"Tween\"}}>\r\n        <form className=\"lectureForm\">\r\n            <input id=\"lectureName\" placeholder=\"Lecture Title\"/>\r\n            <input id=\"creator\" placeholder=\"Creator\"/>\r\n            <select id=\"lectureType\">\r\n                <option value=\"ide\">Web Developerment</option>\r\n                <option value=\"dsa\">DSA</option>\r\n                <option value=\"dra\">Chalk Board</option>\r\n            </select>\r\n            <select name=\"language\" id=\"language\"></select>\r\n            <button type=\"button\" onClick = {path===\"/classform\"?navigateToLiveClass:navigateToRecorderWeb} id=\"submit\">Submit</button>\r\n        </form>\r\n        </motion.div>\r\n    )\r\n}\r\n\r\nexport default RecorderForm","import React, { useEffect, useRef, useState } from \"react\";\r\nimport ChalkBoard from \"../ChalkBoard/index\";\r\nimport files from \"../assets/files\";\r\nimport Peer from \"simple-peer\";\r\nimport * as io from \"socket.io-client\";\r\nimport \"./style.css\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\nimport IDE from \"../IDE\";\r\nimport { useParams } from \"react-router\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAp2cQvNNp8fUKOv6kO_7wR5IsKROCoh14\",\r\n  authDomain: \"engage-6ef42.firebaseapp.com\",\r\n  projectId: \"engage-6ef42\",\r\n  storageBucket: \"engage-6ef42.appspot.com\",\r\n  messagingSenderId: \"27842359842\",\r\n  appId: \"1:27842359842:web:e8f5b15f6a86ac66fa507b\",\r\n  measurementId: \"G-EVEY2DP36T\",\r\n};\r\n\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\nconst firestore = firebase.firestore();\r\n\r\nconst servers = {\r\n  iceServers: [\r\n    {\r\n      urls: [\"stun:stun1.l.google.com:19302\", \"stun:stun2.l.google.com:19302\"],\r\n    },\r\n  ],\r\n  iceCandidatePoolSize: 10,\r\n};\r\n\r\n// Global State\r\nconst pc = new RTCPeerConnection(servers);\r\nlet localStream = null;\r\n\r\nfunction LiveClassEmitter() {\r\n  const { classid, type } = useParams();\r\n  console.log(classid);\r\n  const name = type.slice(0, 3);\r\n  var lastMouse = { x: 0, y: 0 };\r\n  const language = type.slice(3, 10);\r\n  var lastKey = \"\";\r\n  let fileName;\r\n  if (name === \"dsa\") {\r\n    fileName = language;\r\n  } else if (name === \"ide\") {\r\n    fileName = \"index.html\";\r\n  }\r\n  let childValue;\r\n  var lastKeyClass = \"\";\r\n  console.log(\r\n    \"http://localhost:3000/receiver/\" + name + language + \"/\" + classid\r\n  );\r\n  //TODO needed to reload the text editor\r\n  const [refresh, setRefresh] = useState(\"\");\r\n  const socketRef = useRef();\r\n  const [stream, setStream] = useState();\r\n  //while in development mode change document.location.origin to http://localhost:5000\r\n  socketRef.current = io.connect(document.location.origin);\r\n  // Record each type of event\r\n  const myVideo = useRef();\r\n  const userVideo = useRef();\r\n  const connectionRef = useRef();\r\n  useEffect(async () => {\r\n    const webcamVideo = document.getElementById(\"webcamVideo\");\r\n    socketRef.current.emit(\"join-class\", { classid: classid });\r\n    localStream = await navigator.mediaDevices.getUserMedia({\r\n      video: true,\r\n      audio: true,\r\n    });\r\n\r\n    // Push tracks from local stream to peer connection\r\n    localStream.getTracks().forEach((track) => {\r\n      pc.addTrack(track, localStream);\r\n    });\r\n\r\n    webcamVideo.srcObject = localStream;\r\n  }, []);\r\n\r\n  const handlers = [\r\n    {\r\n      eventName: \"mouseup\",\r\n      handler: function handleMouseMove(e) {\r\n        const data = {\r\n          type: \"mouseup\",\r\n          target: e.target.className,\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n        };\r\n        sendData(data);\r\n      },\r\n    },\r\n    {\r\n      eventName: \"mousedown\",\r\n      handler: function handleMouseMove(e) {\r\n        const data = {\r\n          type: \"mousedown\",\r\n          button: e.button,\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n          target: e.target.className,\r\n        };\r\n        sendData(data);\r\n      },\r\n    },\r\n    {\r\n      eventName: \"mousemove\",\r\n      handler: function handleMouseMove(e) {\r\n        const data = {\r\n          type: \"mousemove\",\r\n          button: e.button,\r\n          clientX: e.clientX,\r\n          clientY: e.clientY,\r\n          shiftKey: e.shiftKey,\r\n          target: e.target.className,\r\n        };\r\n        sendData(data);\r\n      },\r\n    },\r\n    {\r\n      eventName: \"click\",\r\n      handler: function handleMouseMove(e) {\r\n        if (\r\n          e.target.className === \"cssfile\" ||\r\n          e.target.className === \"buttontext style\" ||\r\n          e.target.className === \"fab fa-css3-alt\"\r\n        )\r\n          fileName = \"style.css\";\r\n        if (\r\n          e.target.className === \"jsfile\" ||\r\n          e.target.className === \"buttontext script\" ||\r\n          e.target.className === \" fa-js-square\"\r\n        )\r\n          fileName = \"script.js\";\r\n        if (\r\n          e.target.className === \"htmlfile\" ||\r\n          e.target.className === \"buttontext html\" ||\r\n          e.target.className === \"fab fa-html5fab\"\r\n        )\r\n          fileName = \"index.html\";\r\n        console.log(e.target.className);\r\n        const data = {\r\n          type: \"click\",\r\n          target: e.target.className,\r\n          x: e.pageX,\r\n          fileName: fileName,\r\n          y: e.pageY,\r\n        };\r\n        sendData(data);\r\n      },\r\n    },\r\n    {\r\n      eventName: \"keyup\",\r\n      handler: function handleKeyPress(e) {\r\n        console.log(files[fileName]);\r\n        if (name === \"ide\" || name === \"dsa\") {\r\n          lastKey = childValue;\r\n          lastKeyClass = e.target.className;\r\n          const data = {\r\n            type: \"keyup\",\r\n            target: e.target.className,\r\n            x: lastMouse.x,\r\n            y: lastMouse.y,\r\n            fileName: fileName,\r\n            value:\r\n              e.target.className === \"userInputArea\"\r\n                ? e.target.value\r\n                : files[fileName].value,\r\n            keyCode: e.keyCode,\r\n          };\r\n          sendData(data);\r\n        }\r\n      },\r\n    },\r\n    {\r\n      eventName: \"output\",\r\n      handler: function handleChange(e) {\r\n        const data = {\r\n          type: \"output\",\r\n          target: \"userOutputArea\",\r\n          value: e.detail.output,\r\n        };\r\n        sendData(data);\r\n      },\r\n    },\r\n  ];\r\n\r\n  function sendData(data) {\r\n    socketRef.current.emit(\"emitData\", classid, data);\r\n  }\r\n\r\n  function removeListener(eventName, handler) {\r\n    return document.documentElement.removeEventListener(\r\n      eventName,\r\n      handler,\r\n      true\r\n    );\r\n  }\r\n\r\n  function listen(eventName, handler) {\r\n    return document.documentElement.addEventListener(eventName, handler, true);\r\n  }\r\n\r\n  const startLive = async () => {\r\n    // Reference Firestore collections for signaling\r\n    const callDoc = firestore.collection(\"calls\").doc();\r\n    const offerCandidates = callDoc.collection(\"offerCandidates\");\r\n    const answerCandidates = callDoc.collection(\"answerCandidates\");\r\n\r\n    console.log(callDoc.id);\r\n    socketRef.current.emit(\"classid\", {callId:callDoc.id})\r\n\r\n    // Get candidates for caller, save to db\r\n    pc.onicecandidate = (event) => {\r\n      event.candidate && offerCandidates.add(event.candidate.toJSON());\r\n    };\r\n\r\n    // Create offer\r\n    const offerDescription = await pc.createOffer();\r\n    await pc.setLocalDescription(offerDescription);\r\n\r\n    const offer = {\r\n      sdp: offerDescription.sdp,\r\n      type: offerDescription.type,\r\n    };\r\n\r\n    await callDoc.set({ offer });\r\n\r\n    // Listen for remote answer\r\n    callDoc.onSnapshot((snapshot) => {\r\n      const data = snapshot.data();\r\n      if (!pc.currentRemoteDescription && data?.answer) {\r\n        const answerDescription = new RTCSessionDescription(data.answer);\r\n        pc.setRemoteDescription(answerDescription);\r\n      }\r\n    });\r\n\r\n    // When answered, add candidate to peer connection\r\n    answerCandidates.onSnapshot((snapshot) => {\r\n      snapshot.docChanges().forEach((change) => {\r\n        if (change.type === \"added\") {\r\n          const candidate = new RTCIceCandidate(change.doc.data());\r\n          pc.addIceCandidate(candidate);\r\n        }\r\n      });\r\n    });\r\n\r\n    handlers.map((x) => listen(x.eventName, x.handler));\r\n  };\r\n\r\n  function stopLive() {\r\n    handlers.map((x) => removeListener(x.eventName, x.handler));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div style={{ display: \"flex\", flexDirection: \"row-reverse\" }}>\r\n        <div className=\"streamingWindow\">\r\n          <div className=\"buttons\">\r\n            <button className=\"startButton\" onClick={() => startLive()}>\r\n              Start\r\n            </button>\r\n            <button className=\"stopButton\" onClick={() => stopLive()}>\r\n              Stop\r\n            </button>\r\n          </div>\r\n          <video\r\n            playsInline\r\n            muted\r\n            autoPlay\r\n            playsInline\r\n            id=\"webcamVideo\"\r\n            ref={myVideo}\r\n            style={{ width: \"300px\" }}\r\n          />\r\n        </div>\r\n      </div>\r\n      {name === \"dra\" ? (\r\n        <div className=\"chalk\">\r\n          <ChalkBoard />\r\n        </div>\r\n      ) : (\r\n        <IDE name={name} language={language} refresh={refresh} />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default LiveClassEmitter;\r\n","import React, { useEffect, useState, useRef } from \"react\";\r\nimport ChalkBoard from \"../ChalkBoard/index\";\r\nimport Peer from \"simple-peer\";\r\nimport IDE from \"../IDE\";\r\nimport files from \"../assets/files\";\r\nimport firebase from \"firebase/app\";\r\nimport \"firebase/firestore\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport {\r\n  js,\r\n  css,\r\n  html,\r\n  outputModalTrue,\r\n  outputModalFalse,\r\n  setSrcDocs,\r\n} from \"../actions\";\r\nimport * as io from \"socket.io-client\";\r\nimport { useParams } from \"react-router\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAp2cQvNNp8fUKOv6kO_7wR5IsKROCoh14\",\r\n  authDomain: \"engage-6ef42.firebaseapp.com\",\r\n  projectId: \"engage-6ef42\",\r\n  storageBucket: \"engage-6ef42.appspot.com\",\r\n  messagingSenderId: \"27842359842\",\r\n  appId: \"1:27842359842:web:e8f5b15f6a86ac66fa507b\",\r\n  measurementId: \"G-EVEY2DP36T\",\r\n};\r\n\r\nif (!firebase.apps.length) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\nconst firestore = firebase.firestore();\r\n\r\nconst servers = {\r\n  iceServers: [\r\n    {\r\n      urls: [\"stun:stun1.l.google.com:19302\", \"stun:stun2.l.google.com:19302\"],\r\n    },\r\n  ],\r\n  iceCandidatePoolSize: 10,\r\n};\r\n\r\n// Global State\r\nconst pc = new RTCPeerConnection(servers);\r\nlet remoteStream = null;\r\n\r\nfunction LiveClassReceiver() {\r\n  const { classid, type } = useParams();\r\n  const name = type.slice(0, 3);\r\n  const language = type.slice(3, 10);\r\n  const socketRef = useRef();\r\n  const [stream, setStream] = useState();\r\n  const [receivingCall, setReceivingCall] = useState(false);\r\n  const [callerSignal, setCallerSignal] = useState();\r\n  const dispatch = useDispatch();\r\n  //TODO needed to reload the text editor\r\n  const [refresh, setRefresh] = useState(\"\");\r\n  const [answerId, setAnswerId] = useState(\"\");\r\n  const userVideo = useRef();\r\n  //while in development mode change document.location.origin to http://localhost:5000\r\n  socketRef.current = io.connect(document.location.origin);\r\n  function handleButtonEvents(target) {\r\n    switch (target) {\r\n      case \"outputtext\":\r\n        dispatch(setSrcDocs());\r\n        dispatch(outputModalTrue());\r\n        break;\r\n      case \"output\":\r\n        dispatch(setSrcDocs());\r\n        dispatch(outputModalTrue());\r\n        break;\r\n      case \"buttontext output\":\r\n        dispatch(setSrcDocs());\r\n        dispatch(outputModalTrue());\r\n        break;\r\n      case \"fas fa-play\":\r\n        dispatch(setSrcDocs());\r\n        dispatch(outputModalTrue());\r\n        break;\r\n      case \"fas fa-window-close\":\r\n        dispatch(outputModalFalse());\r\n        break;\r\n      case \"style.css\":\r\n        dispatch(css());\r\n        break;\r\n      case \"buttontext style\":\r\n        dispatch(css());\r\n        break;\r\n      case \"index.html\":\r\n        dispatch(html());\r\n        break;\r\n      case \"script.js\":\r\n        dispatch(js());\r\n        break;\r\n      case \"buttontext script\":\r\n        dispatch(js());\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const remoteVideo = document.getElementById(\"remoteVideo\");\r\n    socketRef.current.emit(\"join-class\", { classid: classid });\r\n    remoteStream = new MediaStream();\r\n    pc.ontrack = (event) => {\r\n      event.streams[0].getTracks().forEach((track) => {\r\n        remoteStream.addTrack(track);\r\n      });\r\n    };\r\n    remoteVideo.srcObject = remoteStream;\r\n    const button = document.getElementsByClassName(\"answerButton\")[0];\r\n    socketRef.current.on(\"answerId\", (data) => {\r\n      setAnswerId(data)\r\n    })\r\n    button.style.display = \"none\";\r\n    socketRef.current.on(\"receiveData\", (data) => {\r\n      //console.log(data)\r\n      button.style.display = \"block\";\r\n      const drawStatus = {\r\n        status: false,\r\n      };\r\n      const eve = new CustomEvent(\"status\", { detail: drawStatus });\r\n      document.dispatchEvent(eve);\r\n      if (data.type === \"mousedown\") {\r\n        //console.log(\"mousedown\")\r\n        let eve = new PointerEvent(\"pointerdown\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: data.button,\r\n          clientX: data.clientX,\r\n          clientY: data.clientY,\r\n          shiftKey: data.shiftKey,\r\n        });\r\n\r\n        if (document.getElementsByClassName(data.target)[0])\r\n          document.getElementsByClassName(data.target)[0].dispatchEvent(eve);\r\n      } else if (data.type === \"mousemove\") {\r\n        let eve = new PointerEvent(\"pointermove\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: data.button,\r\n          clientX: data.clientX,\r\n          clientY: data.clientY,\r\n          shiftKey: data.shiftKey,\r\n        });\r\n\r\n        if (document.getElementsByClassName(data.target)[0]) {\r\n          document.getElementsByClassName(data.target)[0].dispatchEvent(eve);\r\n        }\r\n        const path = data.target;\r\n        var tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n        }\r\n      } else if (data.type === \"mouseup\") {\r\n        //console.log(\"mouseup\")\r\n        let eve = new PointerEvent(\"pointerup\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: data.button,\r\n          clientX: data.clientX,\r\n          clientY: data.clientY,\r\n          shiftKey: data.shiftKey,\r\n        });\r\n        if (document.getElementsByClassName(data.target)[0])\r\n          document.getElementsByClassName(data.target)[0].dispatchEvent(eve);\r\n      } else if (data.type === \"click\") {\r\n        if (document.getElementsByClassName(data.target)[0] !== undefined) {\r\n          let clickEvent = new MouseEvent(\"click\", {\r\n            pageX: data.x,\r\n            pageY: data.y,\r\n            bubbles: true,\r\n            cancelable: true,\r\n          });\r\n\r\n          document\r\n            .getElementsByClassName(data.target)[0]\r\n            .dispatchEvent(clickEvent);\r\n        }\r\n        if (\r\n          data.target === \"rectangle\" ||\r\n          data.target === \"ellipse\" ||\r\n          data.target === \"arrow\" ||\r\n          data.target === \"selection\"\r\n        )\r\n          document.getElementsByClassName(data.target)[0].click();\r\n        tar = document.getElementsByClassName(data.target)[0];\r\n        if (tar != null) {\r\n          handleButtonEvents(data.fileName);\r\n          handleButtonEvents(data.target);\r\n        }\r\n      } else if (data.type === \"keyup\") {\r\n        const path = data.target;\r\n        tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n          if (path === \"userInputArea\") {\r\n            tar.value = data.value;\r\n          } else {\r\n            files[data.fileName].value = data.value;\r\n            handleButtonEvents(data.fileName);\r\n            setRefresh(data.value);\r\n          }\r\n        }\r\n      } else if (data.type === \"output\") {\r\n        const path = data.target;\r\n        tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n          if (path === \"userOutputArea\") {\r\n            tar.value = data.value;\r\n          }\r\n        }\r\n      } else if (data.type === \"keydown\") {\r\n        if (document.getElementsByClassName(\"canvas_text\")[0]) {\r\n          document.getElementsByClassName(\"canvas_text\")[0].innerText =\r\n            data.innerText;\r\n        }\r\n      }\r\n    });\r\n\r\n    socketRef.current.on(\"emitStream\", (data) => {\r\n      console.log(data.signalData);\r\n      setCallerSignal(data.signalData);\r\n    });\r\n  }, []);\r\n\r\n  const answerCall = async () => {\r\n    const callId = answerId;\r\n    const callDoc = firestore.collection(\"calls\").doc(callId);\r\n    const answerCandidates = callDoc.collection(\"answerCandidates\");\r\n    const offerCandidates = callDoc.collection(\"offerCandidates\");\r\n\r\n    pc.onicecandidate = (event) => {\r\n      event.candidate && answerCandidates.add(event.candidate.toJSON());\r\n    };\r\n\r\n    const callData = (await callDoc.get()).data();\r\n\r\n    const offerDescription = callData.offer;\r\n    await pc.setRemoteDescription(\r\n      new RTCSessionDescription(offerDescription)\r\n    );\r\n\r\n    const answerDescription = await pc.createAnswer();\r\n    await pc.setLocalDescription(answerDescription);\r\n\r\n    const answer = {\r\n      type: answerDescription.type,\r\n      sdp: answerDescription.sdp,\r\n    };\r\n\r\n    await callDoc.update({ answer });\r\n    \r\n    offerCandidates.onSnapshot((snapshot) => {\r\n      snapshot.docChanges().forEach((change) => {\r\n        console.log(change);\r\n        if (change.type === \"added\") {\r\n          let data = change.doc.data();\r\n          pc.addIceCandidate(new RTCIceCandidate(data));\r\n        }\r\n      });\r\n    });\r\n    // const peer = new Peer({\r\n    //   initiator: false,\r\n    //   trickle: false,\r\n    //   stream: stream\r\n    // })\r\n    // peer.on(\"signal\", (data) => {\r\n    //   socketRef.current.emit(\"answerCall\", {\r\n    //     signalData: data,\r\n    //     classid:classid\r\n    //   })\r\n    // })\r\n    // peer.signal(callerSignal)\r\n    // peer.on(\"stream\", (stream) => {\r\n    //   setStream(stream)\r\n    //   userVideo.current.srcObject = stream\r\n    // })\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <div style={{ display: \"flex\", flexDirection: \"row-reverse\" }}>\r\n        <div\r\n          style={{\r\n            position: \"absolute\",\r\n            zIndex: \"3\",\r\n            display: \"flex\",\r\n            flexDirection: \"column\",\r\n            paddingRight: \"10px\",\r\n          }}\r\n        >\r\n          <button className=\"answerButton\" onClick={() => answerCall()}>\r\n            Answer Call\r\n          </button>\r\n\r\n          <video\r\n            playsInline\r\n            ref={userVideo}\r\n            id=\"remoteVideo\"\r\n            autoPlay\r\n            style={{ width: \"300px\" }}\r\n          />\r\n        </div>\r\n      </div>\r\n      {name === \"dra\" ? (\r\n        <div className=\"chalk\">\r\n          <ChalkBoard />\r\n        </div>\r\n      ) : (\r\n        <IDE name={name} language={language} refresh={refresh} />\r\n      )}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default LiveClassReceiver;\r\n","import React from 'react'\r\nimport { Link } from \"react-router-dom\";\r\nimport { motion } from \"framer-motion\";\r\nimport './styles.css'\r\nfunction Card(props) {\r\n    console.log(props.lectures)\r\n    return (\r\n        <>\r\n            <motion.section  initial= {{opacity:0, scale: 0.8 }} animate={{opacity:1, scale: 1, duration:0.5}} transition= {{type: \"Tween\"}} className=\"hero-section\">\r\n                <div className=\"card-grid\">\r\n                {props.lectures.map((lecture) => {\r\n                    const id = lecture.id;\r\n                    const type = `${lecture.type}${lecture.language}`;\r\n                    return(\r\n                    <div key={lecture.id}>\r\n                        <Link to = {`/player/${type}/${id}`}>\r\n                        <div className=\"card\">\r\n                        <div className=\"card__background\"></div>\r\n                        <div className=\"card__content\">\r\n                            <p className=\"card__category\">{lecture.creator}</p>\r\n                            <h3 className=\"card__heading\">{lecture.name}</h3> \r\n                        </div>\r\n                        </div>\r\n                        </Link>\r\n                    </div>)\r\n                })}\r\n                </div>\r\n            </motion.section>\r\n        </>    \r\n    )\r\n}\r\n\r\nexport default Card","import React , {useEffect, useLayoutEffect, useState} from 'react'\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore'\r\nimport Card from '../Card/card'\r\nfunction Preloader(){\r\n    return(\r\n      <div className = \"loader\">\r\n      <div className =\"preloader\">\r\n      <div className =\"box\">\r\n          <div className =\"box__inner\">\r\n              <div className =\"box__back-flap\"></div>\r\n              <div className =\"box__right-flap\"></div>\r\n              <div className =\"box__front-flap\"></div>\r\n              <div className =\"box__left-flap\"></div>\r\n              <div className =\"box__front\"></div>\r\n          </div>\r\n      </div>\r\n      <div className =\"box\">\r\n          <div className =\"box__inner\">\r\n              <div className =\"box__back-flap\"></div>\r\n              <div className =\"box__right-flap\"></div>\r\n              <div className =\"box__front-flap\"></div>\r\n              <div className =\"box__left-flap\"></div>\r\n              <div className =\"box__front\"></div>\r\n          </div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n  </div>\r\n  </div>\r\n    )\r\n  }\r\nfunction AllLectures() {\r\n    const [lectures, setLectures] = useState('')\r\n    let lecturesArray = []\r\n    const [isLoading, setLoading] = useState(false)\r\n    useEffect(() => {\r\n        firebase.firestore().collection(\"recordIndex\").orderBy(\"createdAt\", 'desc')\r\n        .limit(10).get().then((result) => {\r\n            result.forEach((doc) => {\r\n                lecturesArray.push(doc.data())\r\n            })\r\n            setLectures(lecturesArray)\r\n            setLoading(true)\r\n        })\r\n    }, [])\r\n    return (\r\n        <>\r\n            {isLoading ? <Card lectures={lectures}/>: <Preloader/>}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AllLectures","const filenameReducer = (state = \"index.html\", action) => {\r\n  switch (action.type) {\r\n    case \"js\":\r\n      state = \"script.js\";\r\n      return state;\r\n    case \"css\":\r\n      state = \"style.css\";\r\n      return state;\r\n    case \"html\":\r\n      state = \"index.html\";\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n\r\nconst languageReducer = (state=\"c\", action) => {\r\n  switch(action.type){\r\n    case \"c\":\r\n      state = \"c\";\r\n      return state;\r\n    case \"c99\":\r\n      state = \"c99\";\r\n      return state;\r\n    case \"cpp\":\r\n      state = \"cpp\";\r\n      return state;\r\n    case \"cpp14\":\r\n      state = \"cpp14\";\r\n      return state;\r\n    case \"cpp17\":\r\n      state = \"cpp17\";\r\n      return state;\r\n    case \"python2\":\r\n      state = \"python2\";\r\n      return state;\r\n    case \"python3\":\r\n      state = \"python3\";\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default filenameReducer;\r\n","import files from \"../assets/files\"\r\n\r\nconst outputModalReducer = (state = false, action) => {\r\n\r\n    switch(action.type){\r\n        case \"outputtrue\":\r\n            state = true\r\n            return state\r\n        case \"outputfalse\":\r\n            state = false\r\n            return state\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport const outputSrcReducer = (state = \"\", action) => {\r\n\r\n    switch(action.type){\r\n        case \"setSrcdoc\":\r\n            state = `\r\n            <html>\r\n              <body>${files[\"index.html\"].value}</body>\r\n              <style>${files[\"style.css\"].value}</style>\r\n              <script>${files[\"script.js\"].value}</script>\r\n            </html>\r\n          `\r\n            return state\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default outputModalReducer;","const languageReducer = (state=\"c\", action) => {\r\n    switch(action.type){\r\n      case \"c\":\r\n        state = \"c\";\r\n        return state;\r\n      case \"c99\":\r\n        state = \"c99\";\r\n        return state;\r\n      case \"cpp\":\r\n        state = \"cpp\";\r\n        return state;\r\n      case \"cpp14\":\r\n        state = \"cpp14\";\r\n        return state;\r\n      case \"cpp17\":\r\n        state = \"cpp17\";\r\n        return state;\r\n      case \"python2\":\r\n        state = \"python2\";\r\n        return state;\r\n      case \"python3\":\r\n        state = \"python3\";\r\n        return state;\r\n      default:\r\n        return state;\r\n    }\r\n  }\r\n  \r\n  export default languageReducer;\r\n  ","import filenameReducer from \"./filenameSelection\";\r\nimport outputModalReducer, { outputSrcReducer } from \"./outputModalReducer\";\r\nimport { combineReducers } from \"redux\";\r\nimport languageReducer from \"./languageSelection\";\r\nconst allReducers = combineReducers({\r\n    fileName: filenameReducer,\r\n    outputModal: outputModalReducer,\r\n    srcDocs: outputSrcReducer,\r\n    language:languageReducer\r\n})\r\n\r\nexport default allReducers;\r\n","import { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\r\nimport ChalkBoard from \"./ChalkBoard\";\r\nimport TextEditor from \"./TextEditor/TextEditor\";\r\nimport Recorder from \"./Recorder\";\r\nimport Player from \"./Player\";\r\nimport Test from \"./TestComponent\";\r\nimport UserSection from \"./UserSection\";\r\nimport { createStore, compose, applyMiddleware } from \"redux\";\r\nimport RecorderForm from \"./RecorderForm/recorderForm\";\r\nimport Video from \"./Player\";\r\nimport LiveClassEmitter from \"./LiveClasses/liveClassEmitter\";\r\nimport LiveClassReceiver from \"./LiveClasses/liveClassReceiver\";\r\nimport AllLectures from \"./Lectures/allLectures\";\r\nimport firebase from \"firebase/app\";\r\nimport allReducer from \"./reducers\";\r\nimport thunk from \"redux-thunk\";\r\nimport { Provider } from \"react-redux\";\r\nimport \"./App.css\";\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAp2cQvNNp8fUKOv6kO_7wR5IsKROCoh14\",\r\n  authDomain: \"engage-6ef42.firebaseapp.com\",\r\n  projectId: \"engage-6ef42\",\r\n  storageBucket: \"engage-6ef42.appspot.com\",\r\n  messagingSenderId: \"27842359842\",\r\n  appId: \"1:27842359842:web:e8f5b15f6a86ac66fa507b\",\r\n  measurementId: \"G-EVEY2DP36T\",\r\n};\r\n\r\nif (firebase.apps.length === 0) {\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\nconst middleware = [thunk];\r\n\r\nconst composeEnhancer = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\nconst store = createStore(\r\n  allReducer,\r\n  composeEnhancer(applyMiddleware(...middleware))\r\n);\r\n\r\nfunction App() {\r\n  return (\r\n    <>\r\n      <Provider store={store}>\r\n        <Router>\r\n          <Route exact path=\"/\" component={UserSection} />\r\n          <Route exact path=\"/lectures\" component={AllLectures} />\r\n          <Route exact path=\"/player/:type/:id\" component={Player} />\r\n          <Route path=\"/emitter/:type/:classid\" component={LiveClassEmitter} />\r\n          <Route\r\n            exact\r\n            path=\"/receiver/:type/:classid\"\r\n            component={LiveClassReceiver}\r\n          />\r\n          <Route exact path=\"/drawboard\" component={ChalkBoard} />\r\n          <Route exact path=\"/webd\" component={TextEditor} />\r\n          <Route exact path=\"/recordform\" component={RecorderForm} />\r\n          <Route exact path=\"/classform\" component={RecorderForm} />\r\n          <Route exact path=\"/videoplayer\" component={Video} />\r\n          <Route exact path=\"/test\" component={Test} />\r\n          <Route exact path=\"/recorder\" component={Recorder} ide=\"web\" />\r\n        </Router>\r\n      </Provider>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\n\r\nReactDOM.render(<App />,\r\n  document.getElementById('root')\r\n);\r\n\r\n","import { deflate, inflate } from \"pako\";\r\nimport { encryptData, decryptData } from \"./encryption\";\r\n// -----------------------------------------------------------------------------\r\n// byte (binary) strings\r\n// -----------------------------------------------------------------------------\r\n// fast, Buffer-compatible implem\r\nexport const toByteString = (data) => {\r\n    return new Promise((resolve, reject) => {\r\n        const blob = typeof data === \"string\"\r\n            ? new Blob([new TextEncoder().encode(data)])\r\n            : new Blob([data instanceof Uint8Array ? data : new Uint8Array(data)]);\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n            if (!event.target || typeof event.target.result !== \"string\") {\r\n                return reject(new Error(\"couldn't convert to byte string\"));\r\n            }\r\n            resolve(event.target.result);\r\n        };\r\n        reader.readAsBinaryString(blob);\r\n    });\r\n};\r\nconst byteStringToArrayBuffer = (byteString) => {\r\n    const buffer = new ArrayBuffer(byteString.length);\r\n    const bufferView = new Uint8Array(buffer);\r\n    for (let i = 0, len = byteString.length; i < len; i++) {\r\n        bufferView[i] = byteString.charCodeAt(i);\r\n    }\r\n    return buffer;\r\n};\r\nconst byteStringToString = (byteString) => {\r\n    return new TextDecoder(\"utf-8\").decode(byteStringToArrayBuffer(byteString));\r\n};\r\n// -----------------------------------------------------------------------------\r\n// base64\r\n// -----------------------------------------------------------------------------\r\n/**\r\n * @param isByteString set to true if already byte string to prevent bloat\r\n *  due to reencoding\r\n */\r\nexport const stringToBase64 = async (str, isByteString = false) => {\r\n    return isByteString ? window.btoa(str) : window.btoa(await toByteString(str));\r\n};\r\n// async to align with stringToBase64\r\nexport const base64ToString = async (base64, isByteString = false) => {\r\n    return isByteString\r\n        ? window.atob(base64)\r\n        : byteStringToString(window.atob(base64));\r\n};\r\n/**\r\n * Encodes (and potentially compresses via zlib) text to byte string\r\n */\r\nexport const encode = async ({ text, compress, }) => {\r\n    let deflated;\r\n    if (compress !== false) {\r\n        try {\r\n            deflated = await toByteString(deflate(text));\r\n        }\r\n        catch (error) {\r\n            console.error(\"encode: cannot deflate\", error);\r\n        }\r\n    }\r\n    return {\r\n        version: \"1\",\r\n        encoding: \"bstring\",\r\n        compressed: !!deflated,\r\n        encoded: deflated || (await toByteString(text)),\r\n    };\r\n};\r\nexport const decode = async (data) => {\r\n    let decoded;\r\n    switch (data.encoding) {\r\n        case \"bstring\":\r\n            // if compressed, do not double decode the bstring\r\n            decoded = data.compressed\r\n                ? data.encoded\r\n                : await byteStringToString(data.encoded);\r\n            break;\r\n        default:\r\n            throw new Error(`decode: unknown encoding \"${data.encoding}\"`);\r\n    }\r\n    if (data.compressed) {\r\n        return inflate(new Uint8Array(byteStringToArrayBuffer(decoded)), {\r\n            to: \"string\",\r\n        });\r\n    }\r\n    return decoded;\r\n};\r\n// -----------------------------------------------------------------------------\r\nconst CONCAT_BUFFERS_VERSION = 1;\r\n/** how many bytes we use to encode how many bytes the next chunk has.\r\n * Corresponds to DataView setter methods (setUint32, setUint16, etc).\r\n *\r\n * NOTE ! values must not be changed, which would be backwards incompatible !\r\n */\r\nconst VERSION_DATAVIEW_BYTES = 4;\r\nconst NEXT_CHUNK_SIZE_DATAVIEW_BYTES = 4;\r\n// -----------------------------------------------------------------------------\r\nconst DATA_VIEW_BITS_MAP = { 1: 8, 2: 16, 4: 32 };\r\n/**\r\n * abstraction over DataView that serves as a typed getter/setter in case\r\n * you're using constants for the byte size and want to ensure there's no\r\n * discrepenancy in the encoding across refactors.\r\n *\r\n * DataView serves for an endian-agnostic handling of numbers in ArrayBuffers.\r\n */\r\nfunction dataView(buffer, bytes, offset, value) {\r\n    if (value != null) {\r\n        if (value > Math.pow(2, DATA_VIEW_BITS_MAP[bytes]) - 1) {\r\n            throw new Error(`attempting to set value higher than the allocated bytes (value: ${value}, bytes: ${bytes})`);\r\n        }\r\n        const method = `setUint${DATA_VIEW_BITS_MAP[bytes]}`;\r\n        new DataView(buffer.buffer)[method](offset, value);\r\n        return buffer;\r\n    }\r\n    const method = `getUint${DATA_VIEW_BITS_MAP[bytes]}`;\r\n    return new DataView(buffer.buffer)[method](offset);\r\n}\r\n// -----------------------------------------------------------------------------\r\n/**\r\n * Resulting concatenated buffer has this format:\r\n *\r\n * [\r\n *   VERSION chunk (4 bytes)\r\n *   LENGTH chunk 1 (4 bytes)\r\n *   DATA chunk 1 (up to 2^32 bits)\r\n *   LENGTH chunk 2 (4 bytes)\r\n *   DATA chunk 2 (up to 2^32 bits)\r\n *   ...\r\n * ]\r\n *\r\n * @param buffers each buffer (chunk) must be at most 2^32 bits large (~4GB)\r\n */\r\nconst concatBuffers = (...buffers) => {\r\n    const bufferView = new Uint8Array(VERSION_DATAVIEW_BYTES +\r\n        NEXT_CHUNK_SIZE_DATAVIEW_BYTES * buffers.length +\r\n        buffers.reduce((acc, buffer) => acc + buffer.byteLength, 0));\r\n    let cursor = 0;\r\n    // as the first chunk we'll encode the version for backwards compatibility\r\n    dataView(bufferView, VERSION_DATAVIEW_BYTES, cursor, CONCAT_BUFFERS_VERSION);\r\n    cursor += VERSION_DATAVIEW_BYTES;\r\n    for (const buffer of buffers) {\r\n        dataView(bufferView, NEXT_CHUNK_SIZE_DATAVIEW_BYTES, cursor, buffer.byteLength);\r\n        cursor += NEXT_CHUNK_SIZE_DATAVIEW_BYTES;\r\n        bufferView.set(buffer, cursor);\r\n        cursor += buffer.byteLength;\r\n    }\r\n    return bufferView;\r\n};\r\n/** can only be used on buffers created via `concatBuffers()` */\r\nconst splitBuffers = (concatenatedBuffer) => {\r\n    const buffers = [];\r\n    let cursor = 0;\r\n    // first chunk is the version (ignored for now)\r\n    cursor += VERSION_DATAVIEW_BYTES;\r\n    while (true) {\r\n        const chunkSize = dataView(concatenatedBuffer, NEXT_CHUNK_SIZE_DATAVIEW_BYTES, cursor);\r\n        cursor += NEXT_CHUNK_SIZE_DATAVIEW_BYTES;\r\n        buffers.push(concatenatedBuffer.slice(cursor, cursor + chunkSize));\r\n        cursor += chunkSize;\r\n        if (cursor >= concatenatedBuffer.byteLength) {\r\n            break;\r\n        }\r\n    }\r\n    return buffers;\r\n};\r\n// helpers for (de)compressing data with JSON metadata including encryption\r\n// -----------------------------------------------------------------------------\r\n/** @private */\r\nconst _encryptAndCompress = async (data, encryptionKey) => {\r\n    const { encryptedBuffer, iv } = await encryptData(encryptionKey, deflate(data));\r\n    return { iv, buffer: new Uint8Array(encryptedBuffer) };\r\n};\r\n/**\r\n * The returned buffer has following format:\r\n * `[]` refers to a buffers wrapper (see `concatBuffers`)\r\n *\r\n * [\r\n *   encodingMetadataBuffer,\r\n *   iv,\r\n *   [\r\n *      contentsMetadataBuffer\r\n *      contentsBuffer\r\n *   ]\r\n * ]\r\n */\r\nexport const compressData = async (dataBuffer, options) => {\r\n    const fileInfo = {\r\n        version: 2,\r\n        compression: \"pako@1\",\r\n        encryption: \"AES-GCM\",\r\n    };\r\n    const encodingMetadataBuffer = new TextEncoder().encode(JSON.stringify(fileInfo));\r\n    const contentsMetadataBuffer = new TextEncoder().encode(JSON.stringify(options.metadata || null));\r\n    const { iv, buffer } = await _encryptAndCompress(concatBuffers(contentsMetadataBuffer, dataBuffer), options.encryptionKey);\r\n    return concatBuffers(encodingMetadataBuffer, iv, buffer);\r\n};\r\n/** @private */\r\nconst _decryptAndDecompress = async (iv, decryptedBuffer, decryptionKey, isCompressed) => {\r\n    decryptedBuffer = new Uint8Array(await decryptData(iv, decryptedBuffer, decryptionKey));\r\n    if (isCompressed) {\r\n        return inflate(decryptedBuffer);\r\n    }\r\n    return decryptedBuffer;\r\n};\r\nexport const decompressData = async (bufferView, options) => {\r\n    // first chunk is encoding metadata (ignored for now)\r\n    const [encodingMetadataBuffer, iv, buffer] = splitBuffers(bufferView);\r\n    const encodingMetadata = JSON.parse(new TextDecoder().decode(encodingMetadataBuffer));\r\n    try {\r\n        const [contentsMetadataBuffer, contentsBuffer] = splitBuffers(await _decryptAndDecompress(iv, buffer, options.decryptionKey, !!encodingMetadata.compression));\r\n        const metadata = JSON.parse(new TextDecoder().decode(contentsMetadataBuffer));\r\n        return {\r\n            /** metadata source is always JSON so we can decode it here */\r\n            metadata,\r\n            /** data can be anything so the caller must decode it */\r\n            data: contentsBuffer,\r\n        };\r\n    }\r\n    catch (error) {\r\n        console.error(`Error during decompressing and decrypting the file.`, encodingMetadata);\r\n        throw error;\r\n    }\r\n};\r\n// -----------------------------------------------------------------------------\r\n"],"sourceRoot":""}