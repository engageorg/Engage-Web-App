{"version":3,"sources":["ChalkBoard/css/variables.module.scss","ChalkBoard/locales lazy /^/.*/.json$/ groupOptions: {} namespace object","ChalkBoard/data/encryption.js","ChalkBoard/analytics.js","ChalkBoard/i18n.js","ChalkBoard/colors.js","ChalkBoard/keys.js","ChalkBoard/utils.js","ChalkBoard/appState.js","ChalkBoard/hooks/useCallbackRefState.js","ChalkBoard/element/typeChecks.js","ChalkBoard/math.js","ChalkBoard/points.js","ChalkBoard/element/bounds.js","ChalkBoard/renderer/renderElement.js","ChalkBoard/scene/Scene.js","ChalkBoard/random.js","ChalkBoard/element/mutateElement.js","ChalkBoard/element/sizeHelpers.js","ChalkBoard/groups.js","ChalkBoard/element/newElement.js","ChalkBoard/element/transformHandles.js","ChalkBoard/ga.js","ChalkBoard/galines.js","ChalkBoard/gapoints.js","ChalkBoard/gadirections.js","ChalkBoard/gatransforms.js","ChalkBoard/element/collision.js","ChalkBoard/element/resizeTest.js","ChalkBoard/element/linearElementEditor.js","ChalkBoard/element/binding.js","ChalkBoard/element/resizeElements.js","ChalkBoard/element/dragElements.js","ChalkBoard/element/textWysiwyg.jsx","ChalkBoard/element/textElement.js","ChalkBoard/element/showSelectedShapeActions.js","ChalkBoard/element/index.js","ChalkBoard/scene/scrollbars.js","ChalkBoard/scene/selection.js","ChalkBoard/scene/scroll.js","ChalkBoard/scene/comparisons.js","ChalkBoard/scene/zoom.js","ChalkBoard/errors.js","ChalkBoard/components/Spinner.jsx","ChalkBoard/components/ToolButton.jsx","ChalkBoard/components/icons.jsx","ChalkBoard/actions/register.js","ChalkBoard/actions/actionDeleteSelected.jsx","ChalkBoard/zindex.js","ChalkBoard/actions/actionZindex.jsx","ChalkBoard/actions/actionSelectAll.js","ChalkBoard/actions/actionDuplicateSelection.jsx","ChalkBoard/components/ButtonIconSelect.jsx","ChalkBoard/components/Popover.jsx","ChalkBoard/components/ColorPicker.jsx","ChalkBoard/components/IconPicker.jsx","ChalkBoard/actions/actionProperties.jsx","ChalkBoard/types.js","ChalkBoard/components/DarkModeToggle.jsx","ChalkBoard/components/Tooltip.jsx","ChalkBoard/components/ClearCanvas.jsx","ChalkBoard/actions/actionCanvas.jsx","ChalkBoard/actions/actionFinalize.jsx","ChalkBoard/components/ProjectName.jsx","ChalkBoard/renderer/roundRect.js","ChalkBoard/clients.js","ChalkBoard/renderer/renderScene.js","ChalkBoard/data/filesystem.js","ChalkBoard/data/restore.js","ChalkBoard/data/blob.js","ChalkBoard/data/json.js","ChalkBoard/element/image.js","ChalkBoard/scene/export.js","ChalkBoard/charts.js","ChalkBoard/clipboard.js","ChalkBoard/data/index.js","ChalkBoard/data/resave.js","ChalkBoard/components/CheckboxItem.jsx","ChalkBoard/components/Stack.jsx","ChalkBoard/components/ActiveFile.jsx","ChalkBoard/actions/actionExport.jsx","ChalkBoard/actions/actionStyles.js","ChalkBoard/components/HelpIcon.jsx","ChalkBoard/actions/actionGroup.jsx","ChalkBoard/actions/actionMenu.jsx","ChalkBoard/components/Avatar.jsx","ChalkBoard/actions/actionAddToLibrary.js","ChalkBoard/actions/actionNavigate.jsx","ChalkBoard/align.js","ChalkBoard/actions/actionAlign.jsx","ChalkBoard/disitrubte.js","ChalkBoard/actions/actionDistribute.jsx","ChalkBoard/actions/actionFlip.js","ChalkBoard/actions/actionClipboard.jsx","ChalkBoard/actions/actionToggleGridMode.jsx","ChalkBoard/actions/actionToggleZenMode.jsx","ChalkBoard/actions/actionToggleStats.jsx","ChalkBoard/actions/actionHistory.jsx","ChalkBoard/actions/manager.jsx","ChalkBoard/data/library.js","ChalkBoard/gesture.js","ChalkBoard/history.js","ChalkBoard/shapes.jsx","ChalkBoard/actions/shortcuts.js","ChalkBoard/components/ContextMenu.jsx","ChalkBoard/components/Actions.jsx","ChalkBoard/components/BackgroundPickerAndDarkModeToggle.jsx","ChalkBoard/components/CollabButton.jsx","ChalkBoard/components/ImageExportDialog.jsx","ChalkBoard/components/FixedSideContainer.jsx","ChalkBoard/components/HintViewer.jsx","ChalkBoard/components/Island.jsx","ChalkBoard/components/LibraryUnit.jsx","ChalkBoard/components/LoadingMessage.jsx","ChalkBoard/components/LockButton.jsx","ChalkBoard/components/Section.jsx","ChalkBoard/components/UserList.jsx","ChalkBoard/components/LibraryButton.jsx","ChalkBoard/components/MobileMenu.jsx","ChalkBoard/components/PasteChartDialog.jsx","ChalkBoard/components/HelpDialog.jsx","ChalkBoard/components/Card.jsx","ChalkBoard/components/JSONExportDialog.jsx","ChalkBoard/components/LayerUI.jsx","ChalkBoard/components/Stats.jsx","ChalkBoard/components/Toast.jsx","ChalkBoard/actions/actionToggleViewMode.jsx","ChalkBoard/components/App.jsx","ChalkBoard/components/Modal.jsx","ChalkBoard/components/Dialog.jsx","ChalkBoard/components/ErrorDialog.jsx","ChalkBoard/components/TopErrorBoundary.jsx","ChalkBoard/packages/excalidraw/publicPath.js","ChalkBoard/components/InitializeApp.jsx","ChalkBoard/excalidraw-app/app_constants.js","ChalkBoard/packages/excalidraw/index.jsx","ChalkBoard/excalidraw-app/data/FileManager.js","ChalkBoard/excalidraw-app/data/firebase.js","ChalkBoard/excalidraw-app/data/index.js","ChalkBoard/excalidraw-app/data/localStorage.js","ChalkBoard/excalidraw-app/collab/Portal.jsx","ChalkBoard/excalidraw-app/collab/RoomDialog.jsx","ChalkBoard/excalidraw-app/collab/reconciliation.js","ChalkBoard/excalidraw-app/collab/CollabWrapper.jsx","ChalkBoard/createInverseContext.jsx","ChalkBoard/excalidraw-app/components/LanguageList.jsx","ChalkBoard/excalidraw-app/CustomStats.jsx","ChalkBoard/excalidraw-app/components/icons.jsx","ChalkBoard/excalidraw-app/components/ExportToExcalidrawPlus.jsx","ChalkBoard/excalidraw-app/index.jsx","ChalkBoard/excalidraw-app/sentry.js","ChalkBoard/index.js","assets/files.js","TextEditor/TextEditor.js","actions/index.js","MultilanguageEditor/multiFile.js","actions/outputAction.js","IDE.js","Recorder/index.js","StartingComponent/startingCompoent.js","RecorderForm/recorderForm.js","Player/index.js","assets/Gear-0.2s-200px.png","LiveClasses/liveClassEmitter.js","LiveClasses/liveClassReceiver.js","Card/card.js","Lectures/allLectures.js","reducers/filenameSelection.js","reducers/outputModalReducer.js","reducers/languageSelection.js","reducers/index.js","App.js","index.js","ChalkBoard/constants.js","ChalkBoard/data/encode.js"],"names":["module","exports","map","webpackAsyncContext","req","Promise","resolve","then","__webpack_require__","o","e","Error","code","id","t","keys","Object","IV_LENGTH_BYTES","createIV","arr","Uint8Array","window","crypto","getRandomValues","generateEncryptionKey","a","subtle","generateKey","name","length","key","exportKey","k","getImportedKey","usage","importKey","alg","ext","key_ops","kty","encryptData","data","importedKey","iv","TextEncoder","encode","Blob","arrayBuffer","buffer","encrypt","encryptedBuffer","decryptData","encrypted","privateKey","decrypt","trackEvent","process","REACT_APP_GOOGLE_ANALYTICS_ID","gtag","category","label","value","event_category","event_label","JEST_WORKER_ID","defaultLang","languages","rtl","concat","sort","left","right","filter","lang","percentages","TEST_LANG_CODE","ENV","DEVELOPMENT","unshift","currentLang","currentLangData","setLanguage","document","documentElement","dir","startsWith","getLanguage","findPartsForData","parts","index","part","undefined","path","replacement","JSON","stringify","slice","split","translation","fallbackLangData","replace","shades","oc","red","pink","grape","violet","indigo","blue","cyan","teal","green","lime","yellow","orange","canvasBackground","white","gray","elementBackground","elementStroke","black","isDarwin","test","navigator","platform","isWindows","CODES","KEYS","isArrowKey","shouldResizeFromCenter","event","altKey","shouldMaintainAspectRatio","shiftKey","shouldRotateWithDiscreteAngle","mockDateTime","getDateTime","date","Date","year","getFullYear","month","getMonth","padStart","day","getDate","hr","getHours","min","getMinutes","capitalizeString","str","charAt","toUpperCase","isWritableElement","target","HTMLElement","dataset","type","HTMLBRElement","HTMLTextAreaElement","HTMLInputElement","getFontFamilyString","fontFamily","entries","FONT_FAMILY","fontFamilyString","WINDOWS_EMOJI_FALLBACK_FONT","getFontString","fontSize","measureText","text","font","line","createElement","body","style","position","whiteSpace","appendChild","innerText","x","join","width","offsetWidth","height","offsetHeight","span","display","overflow","baseline","offsetTop","removeChild","debounce","fn","timeout","handle","lastArgs","ret","args","clearTimeout","setTimeout","flush","_lastArgs","cancel","distance","y","Math","abs","resetCursor","canvas","cursor","setCursor","setCursorForShape","shape","CURSOR_TYPE","CROSSHAIR","isFullScreen","fullscreenElement","nodeName","getShortcutKey","shortcut","viewportCoordsToSceneCoords","clientX","clientY","zoom","offsetLeft","scrollX","scrollY","invScale","sceneCoordsToViewportCoords","sceneX","sceneY","getGlobalCSSVariable","getComputedStyle","getPropertyValue","RE_RTL_CHECK","RegExp","isRTL","tupleToCoors","xyTuple","muteFSAbortError","error","isTransparent","color","isRGBTransparent","substr","isRRGGBBTransparent","colors","resolvablePromise","reject","promise","_resolve","_reject","withBatchedUpdates","func","unstable_batchedUpdates","nFormatter","num","digits","si","symbol","toFixed","getVersion","querySelector","content","DEFAULT_VERSION","preventUnload","preventDefault","returnValue","defaultExportScale","EXPORT_SCALES","includes","devicePixelRatio","getDefaultAppState","theme","THEME","LIGHT","collaborators","Map","currentChartType","currentItemBackgroundColor","currentItemEndArrowhead","currentItemFillStyle","currentItemFontFamily","DEFAULT_FONT_FAMILY","currentItemFontSize","DEFAULT_FONT_SIZE","currentItemLinearStrokeSharpness","currentItemOpacity","currentItemRoughness","currentItemStartArrowhead","currentItemStrokeColor","currentItemStrokeSharpness","currentItemStrokeStyle","currentItemStrokeWidth","currentItemTextAlign","DEFAULT_TEXT_ALIGN","cursorButton","draggingElement","editingElement","editingGroupId","editingLinearElement","elementLocked","elementType","errorMessage","exportBackground","exportScale","exportEmbedScene","exportWithDarkMode","fileHandle","gridSize","isBindingEnabled","isLibraryOpen","isLoading","isResizing","isRotating","lastPointerDownWith","multiElement","openMenu","openPopup","pasteDialog","shown","previousSelectedElementIds","resizingElement","scrolledOutside","selectedElementIds","selectedGroupIds","selectionElement","shouldCacheIgnoreZoom","showHelpDialog","showStats","startBoundElement","suggestedBindings","toastMessage","viewBackgroundColor","zenModeEnabled","viewModeEnabled","pendingImageElement","APP_STATE_STORAGE_CONF","browser","export","server","_clearAppStateForStorage","appState","exportType","stateForExport","propConfig","nextValue","clearAppStateForLocalStorage","cleanAppStateForExport","clearAppStateForDatabase","useCallbackRefState","useState","refValue","setRefValue","useCallback","isInitializedImageElement","element","fileId","isImageElement","isTextElement","isFreeDrawElement","isFreeDrawElementType","isLinearElement","isLinearElementType","isBindingElement","isBindingElementType","isBindableElement","rotate","x1","y1","x2","y2","angle","cos","sin","rotatePoint","point","center","adjustXYWithRotation","sides","deltaX1","deltaY1","deltaX2","deltaY2","w","n","s","distance2d","xd","yd","hypot","isPathALoop","points","zoomValue","first","last","LINE_CONFIRM_THRESHOLD","isPointInPolygon","vertices","extreme","Number","MAX_SAFE_INTEGER","p","count","i","current","next","doSegmentsIntersect","orderedColinearOrientation","isPointWithinBounds","q","r","max","val","p1","q1","p2","q2","o1","o2","o3","o4","getGridPoint","round","getSizeFromPoints","xs","ys","rescalePoints","dimension","nextDimensionSize","prevPoints","prevDimValues","prevMaxDimension","prevMinDimension","prevDimensionSize","dimensionScaleFactor","nextMinDimension","Infinity","scaledPoints","prevPoint","currentDimension","scaledValue","scaledPoint","getElementAbsoluteCoords","getFreeDrawElementAbsoluteCoords","getLinearElementAbsoluteCoords","getCurvePathOps","sets","set","ops","getMinMaxXYFromCurvePathOps","transformXY","currentP","reduce","limits","op","p3","p0","equation","idx","pow","minY","minX","maxX","maxY","getBoundsFromPoints","coords","getShapeForElement","getElementBounds","bounds","cx","cy","getLinearElementRotatedBounds","x11","y11","x12","y12","x22","y22","x21","y21","h","ww","hh","getCommonBounds","elements","forEach","getResizedElementAbsoluteCoords","nextWidth","nextHeight","gen","rough","generator","curve","strokeSharpness","linearPath","generateRoughOptions","getElementPointsCoords","sharpness","defaultAppState","isPendingImageElement","sceneState","imageCache","has","getDashArrayDashed","strokeWidth","getDashArrayDotted","getCanvasPadding","IMAGE_PLACEHOLDER_IMG","src","MIME_TYPES","svg","encodeURIComponent","IMAGE_ERROR_PLACEHOLDER_IMG","drawElementOnCanvas","rc","context","globalAlpha","opacity","lineJoin","lineCap","draw","save","fillStyle","strokeColor","pathsCache","get","getFreeDrawPath2D","fill","restore","img","image","fillRect","imageMinWidthOrHeight","size","drawImage","status","drawImagePlaceholder","shouldTemporarilyAttach","isConnected","setAttribute","textAlign","lines","lineHeight","verticalOffset","horizontalOffset","fillText","remove","elementWithCanvasCache","WeakMap","shapeCache","invalidateShapeForElement","delete","continuousPath","options","seed","strokeLineDash","strokeStyle","disableMultiStroke","fillWeight","hachureGap","roughness","stroke","preserveVertices","fixedDecimalPlaceDigits","backgroundColor","curveFitting","generateElementShape","rectangle","topX","floor","rightX","rightY","getDiamondPoints","topY","bottomX","bottomY","leftX","leftY","polygon","ellipse","startArrowhead","endArrowhead","getArrowheadShapes","arrowhead","arrowheadPoints","prevOp","nx","ny","arrow","bar","dot","triangle","px","py","minSize","PI","x3","y3","getArrowheadPoints","circle","x4","y4","dash","shapes","push","generateFreeDrawShape","generateElementWithCanvas","prevElementWithCanvas","shouldRegenerateBecauseZoom","canvasZoom","elementWithCanvas","getContext","padding","canvasOffsetX","canvasOffsetY","ceil","translate","scale","mimeType","generateElementCanvas","drawElementFromCanvas","_isPendingImageElement","scaleXFactor","scaleYFactor","renderElement","renderOptimizations","shiftX","shiftY","roughSVGDrawWithPrecision","rsvg","drawable","precision","pshape","renderElementToSvg","svgRoot","files","offsetX","offsetY","degree","node","MAX_DECIMALS_FOR_SVG_EXPORT","group","ownerDocument","createElementNS","SVG_NS","getFreeDrawSvgPath","fileData","symbolId","dataURL","prepend","use","direction","textAnchor","textContent","svgPathData","Path2D","inputPoints","simulatePressure","pressures","thinning","smoothing","streamline","easing","lastCommittedPoint","acc","med","TO_FIXED_PRECISION","getSvgPathFromStroke","getStroke","A","B","isIdKey","elementKey","Scene","this","callbacks","Set","nonDeletedElements","elementsMap","getElement","isNonDeletedElement","ids","result","getNonDeletedElement","nextElements","clear","mapElementToScene","getNonDeletedElements","informMutation","Array","from","callback","cb","add","sceneMapById","scene","sceneMapByElement","random","Random","now","randomInteger","randomId","nanoid","mutateElement","updates","didChange","prevScale","nextScale","nextPoints","didChangePoints","nextPoint","version","versionNonce","getScene","newElementWith","bumpVersion","isInvisiblySmallElement","getPerfectElementSize","absWidth","absHeight","lockedAngle","atan","SHIFT_LOCKING_ANGLE","tan","sign","getNormalizedDimensions","selectGroup","groupId","elementsInGroup","groupIds","fromEntries","isSelectedViaGroup","getSelectedGroupForElement","find","getSelectedGroupIds","selectGroupsForSelectedElements","nextAppState","selectedElements","getSelectedElements","indexOfEditingGroup","indexOf","isElementInGroup","getElementsInGroup","addToGroup","prevGroupIds","newGroupId","positionOfEditingGroupId","positionToInsert","splice","_newElementBase","boundElementIds","rest","isDeleted","newElement","opts","getTextElementPositionOffsets","metrics","verticalAlign","newTextElement","offsets","updateTextElement","nextText","nextBaseline","prevMetrics","isFinite","getAdjustedDimensions","newLinearElement","startBinding","endBinding","deepCopyElement","depth","prototype","toString","call","tmp","constructor","create","getPrototypeOf","hasOwnProperty","isArray","duplicateElement","groupIdMapForOperation","overrides","copy","mapper","endIndex","getNewGroupIdsForDuplication","assign","transformHandleSizes","mouse","pen","touch","OMIT_SIDES_FOR_MULTIPLE_ELEMENTS","OMIT_SIDES_FOR_TEXT_ELEMENT","OMIT_SIDES_FOR_LINE_SLASH","nw","se","OMIT_SIDES_FOR_LINE_BACKSLASH","ne","sw","generateTransformHandle","getTransformHandlesFromCoords","pointerType","omitSides","handleWidth","handleHeight","handleMarginX","handleMarginY","dashedLineMargin","centeringOffset","transformHandles","rotation","minimumSizeForEightHandles","getTransformHandles","nvector","reverse","b","isNumber","sub","mul","mulScalar","meet","joinScalar","norm","sqrt","inorm","normalized","inormalized","c","GA","through","to","orthogonal","toTuple","intersect","line1","line2","point1","point2","distanceToLine","pivot","apply","motor","isHittingElementBoundingBoxWithoutHittingElement","threshold","isHittingElementNotConsideringBoundingBox","isPointHittingElementBoundingBox","check","isStrictlyInside","isDraggableFromInside","isElementDraggableFromInside","isInsideCheck","isNearCheck","hitTestPointAgainstElement","isElementSelected","rotatedX","rotatedY","bindingBorderTest","maxBindingGap","isOutsideCheck","elementWidth","elementHeight","smallerDimension","distanceToBindableElement","distanceToRectangle","hitTestFreeDrawElement","hitTestLinear","console","warn","distanceToDiamond","distanceToEllipse","pointRelativeToElement","pointRel","hwidth","hheight","GAPoint","GALine","side","ellipseParamsForTest","tangent","tx","ty","_","xx","yy","ex","ey","rx","ry","qx","qy","intersection","closestPoint","rotatedPoint","P","delta","U","C","d","da","db","pointAbs","side1","side2","relX","relY","some","subshape","hitTestCurveInside","hitTestRoughShape","pointTuple","elementCoords","coordsCenter","GATransform","pointRotated","pointRelToCenterAbs","GADirection","elementPos","pointRelToPos","ax","ay","relativizationToElementCenter","bx","by","determineFocusDistance","relateToCenter","aRel","bRel","m","mabs","nabs","getSortedElementLineIntersections","nearPoint","intersections","gap","corners","getCorners","flatMap","edge","intersectSegment","offsetSegment","getCircleIntersections","getEllipseIntersections","sortedIntersections","i1","i2","hx","hy","segment","offset","squares","discr","discrRoot","xn","yn","radius","findFocusPointForEllipse","relativeDistance","relativeDistanceAbs","orientation","pyo","findFocusPointForRectangulars","maxDistance","tangentPoint","corner","odd","operation","polygonPoints","pointsOnBezierCurves","lineThreshold","retVal","mx","my","pointInBezierEquation","isInsideTransformHandle","transformHandle","getElementWithTransformHandleType","scenePointerX","scenePointerY","transformHandleType","rotationTransformHandle","resizeTest","getTransformHandleTypeFromCoords","RESIZE_CURSORS","getCursorForResizingElement","shouldSwapCursors","rotateResizeCursor","LinearElementEditor","elementId","normalizePoints","activePointIndex","lastUncommittedPoint","isDragging","pointerOffset","startBindingElement","endBindingElement","setState","maybeSuggestBinding","newPoint","createPointAt","movePoint","binding","bindingElement","getHoveredElementForBinding","getPointAtIndexGlobalCoordinates","history","scenePointer","didAddPoint","hitElement","resumeRecording","clickedPointIndex","getPointIndexUnderCursor","bindOrUnbindLinearElement","targetPoint","lastPoint","indexMaybeFromEnd","absoluteCoords","pointHandles","getPointsGlobalCoordinates","POINT_HANDLE_SIZE","pointerOnGrid","_idx","getNormalizedPoints","pointIndex","targetPosition","otherUpdates","deltaX","deltaY","nextCoords","prevCoords","nextCenterX","nextCenterY","prevCenterX","prevCenterY","rotated","linearElement","boundToElementIds","unboundFromElementIds","bindOrUnbindLinearElementEdge","onlyUnbound","bindableElement","otherEdgeBindableElement","startOrEnd","isLinearElementSimpleAndAlreadyBoundOnOppositeEdge","bindLinearElement","unbound","unbindLinearElement","bindOrUnbindSelectedElements","getElligibleElementForBindingElement","maybeBindBindableElement","getElligibleElementsForBindableElementAndWhere","where","maybeBindLinearElement","pointerCoords","hoveredElement","calculateFocusAndGap","otherBinding","isLinearElementSimpleAndAlreadyBound","alreadyBoundToId","unbindLinearElements","field","getElementAtPosition","getElements","edgePointIndex","adjacentPointIndex","edgePoint","adjacentPoint","focus","updateBoundElements","changedElement","newSize","simultaneouslyUpdated","simultaneouslyUpdatedElementIds","getSimultaneouslyUpdatedElementIds","doesNeedUpdate","maybeCalculateNewGapWhenScaling","updateBoundPoint","boundElement","newEdgePoint","focusPointAbsolute","adjecentPoint","adjecentPointRel","reverseRelateToCenter","determineFocusPoint","intersectElementWithLine","pointFromAbsoluteCoords","currentBinding","newWidth","newHeight","getElligibleElementsForBindingElement","getLinearElementEdgeCoors","canBindStart","isLinearElementEligibleForNewBindingByBindable","canBindEnd","maybeElement","fixBindingsAfterDuplication","sceneElements","oldElements","oldIdToDuplicatedId","duplicatesServeAsOld","allBoundElementIds","allBindableElementIds","shouldReverseRoles","oldElement","boundElementId","newBindingAfterDuplication","fixBindingsAfterDeletion","deletedElements","deletedElementIds","deletedElement","newBindingAfterDeletion","normalizeAngle","rotateSingleElement","pointerX","pointerY","atan2","reshapeSingleTwoPointElement","resizeArrowDirection","getPerfectElementSizeWithRotation","nextElementX","nextElementY","rescalePointsInElement","measureFontSizeFromWH","nextFontSize","resizeSingleTextElement","nextFont","getSidesForTransformHandle","resizeSingleElement","stateAtResizeStart","transformHandleDirection","startTopLeft","startBottomRight","startCenter","rotatedPointer","esx1","esy1","boundsCurrentWidth","boundsCurrentHeight","scaleX","scaleY","eleInitialWidth","eleInitialHeight","eleNewWidth","eleNewHeight","widthRatio","heightRatio","ratio","newBoundsX1","newBoundsY1","newBoundsWidth","newBoundsHeight","newTopLeft","bottomLeft","topRight","rotatedTopLeft","newCenter","rotatedNewCenter","rescaledPoints","newOrigin","resizedElement","resizeMultipleElements","getNextXY","origX1","origY1","finalX1","finalY1","origX2","origY2","finalX2","finalY2","prev","origCoords","finalCoords","rotateMultipleElements","pointerDownState","centerX","centerY","centerAngle","origAngle","originalElements","rotatedCX","rotatedCY","dragNewElement","originX","originY","widthAspectRatio","newX","newY","normalizeText","getTransform","maxWidth","translateX","translateY","redrawTextBoundingBox","showSelectedShapeActions","Boolean","getElementMap","getSceneVersion","el","_clearElements","clearElementsForDatabase","clearElementsForExport","clearElementsForLocalStorage","SCROLLBAR_COLOR","getScrollBars","viewportWidth","viewportHeight","horizontal","vertical","elementsMinX","elementsMinY","elementsMaxX","elementsMaxY","viewportWidthWithZoom","viewportHeightWithZoom","viewportWidthDiff","viewportHeightDiff","safeArea","top","parseInt","bottom","viewportMinX","viewportMinY","viewportMaxX","viewportMaxY","sceneMinX","sceneMinY","sceneMaxX","sceneMaxY","SCROLLBAR_MARGIN","isOverScrollBars","scrollBars","scrollBar","isOverHorizontal","isOverVertical","isOverEither","isSomeElementSelected","getTargetElements","centerScrollOn","scenePoint","viewportDimensions","calculateScrollCenter","getVisibleElements","cords","viewportX1","viewportY1","viewportX2","viewportY2","isOutsideViewPort","minDistance","closestElement","getClosestElementBounds","hasBackground","hasStrokeColor","hasStrokeWidth","hasStrokeStyle","canChangeSharpness","hasText","canHaveArrowheads","isAtPositionFn","getNewZoom","newZoomValue","prevZoom","canvasOffset","zoomOnViewportPoint","getNormalizedZoom","normalizedZoom","parseFloat","CanvasError","message","AbortError","DOMException","Spinner","circleWidth","className","viewBox","strokeMiterlimit","ToolButton","React","forwardRef","props","ref","excalId","useExcalidrawContainer","innerRef","useRef","useImperativeHandle","sizeCn","setIsLoading","isMountedRef","onClick","useEffect","lastPointerTypeRef","clsx","visible","hidden","ToolIcon","selected","title","disabled","icon","keyBindingLabel","showAriaLabel","children","onPointerDown","onPointerUp","requestAnimationFrame","onChange","checked","defaultProps","activeElementColor","iconFillColor","handlerColor","createIcon","mirror","focusable","role","checkIcon","link","saveAs","load","clipboard","trash","palette","exportFile","exportImage","exportToFileIcon","zoomIn","zoomOut","done","menu","undo","redo","questionCircle","share","shareIOS","shareWindows","BringForwardIcon","memo","SendBackwardIcon","BringToFrontIcon","SendToBackIcon","AlignTopIcon","strokeLinecap","AlignBottomIcon","AlignLeftIcon","AlignRightIcon","DistributeHorizontallyIcon","DistributeVerticallyIcon","CenterVerticallyIcon","strokeDasharray","CenterHorizontallyIcon","users","start","stop","close","back","marginLeft","clone","shield","file","GroupIcon","UngroupIcon","FillHachureIcon","fillRule","clipRule","FillCrossHatchIcon","FillSolidIcon","StrokeWidthIcon","StrokeStyleSolidIcon","StrokeStyleDashedIcon","StrokeStyleDottedIcon","SloppinessArchitectIcon","SloppinessArtistIcon","SloppinessCartoonistIcon","EdgeSharpIcon","EdgeRoundIcon","ArrowheadNoneIcon","ArrowheadArrowIcon","flip","transform","ArrowheadDotIcon","ArrowheadBarIcon","ArrowheadTriangleIcon","FontSizeSmallIcon","FontSizeMediumIcon","FontSizeLargeIcon","FontSizeExtraLargeIcon","FontFamilyHandDrawnIcon","FontFamilyNormalIcon","FontFamilyCodeIcon","TextAlignLeftIcon","TextAlignCenterIcon","TextAlignRightIcon","actions","register","action","handleGroupEditingState","siblingElements","actionDeleteSelected","perform","commitToHistory","deleteSelectedElements","contextItemLabel","keyTest","PanelComponent","updateData","getIndicesToMove","selectedIndices","deletedIndices","includeDeletedIndex","getTargetIndex","boundaryIndex","sourceElement","indexFilter","candidateIndex","array","fromIndex","findLastIndex","findIndex","nextElement","siblingGroupId","elementsInSiblingGroup","getTargetElementsMap","indices","shiftElements","indicesToMove","targetElementsMap","groupedIndices","toContiguousGroups","leadingIndex","trailingIndex","targetIndex","leadingElements","targetElements","displacedElements","trailingElements","shiftElementsToEnd","groupElements","values","moveOneLeft","moveOneRight","moveAllLeft","moveAllRight","actionSendBackward","keyPriority","actionBringForward","actionSendToBack","actionBringToFront","actionSelectAll","actionDuplicateSelection","selectedPoint","duplicateElements","groupIdMap","newElements","duplicateAndOffsetElement","GRID_SIZE","finalElements","ButtonIconSelect","option","active","Popover","onCloseRequest","fitInViewport","popoverRef","useLayoutEffect","getBoundingClientRect","innerWidth","innerHeight","handler","contains","addEventListener","removeEventListener","isValidColor","Option","keyBindings","flat","Picker","onClose","showInput","firstItem","activeItem","gallery","colorInput","onKeyDown","activeElement","nextIndex","toLowerCase","nativeEvent","stopImmediatePropagation","stopPropagation","tabIndex","_color","_colorWithoutHash","currentTarget","onFocus","ColorInput","innerValue","setInnerValue","inputRef","changeColor","inputValue","getColor","spellCheck","onBlur","ColorPicker","isActive","setActive","pickerButton","Suspense","fallback","changedColor","rFirstItem","rActiveItem","rGallery","pressedOption","keyBinding","metaKey","ctrlKey","IconPicker","rPickerButton","UserIdleState","changeProperty","getFormValue","getAttribute","defaultValue","attributes","getCommonAttributeOfSelectedElements","DarkModeToggle","step","onWheel","Virgil","Helvetica","Cascadia","shouldUpdateForNonLinearElements","every","shouldUpdateForLinearElements","ICONS","MOON","SUN","DARK","getTooltipDiv","existingDiv","div","classList","Tooltip","long","onPointerEnter","item","tooltip","minWidth","itemX","itemBottom","itemTop","itemWidth","labelWidth","labelHeight","margin","updateTooltip","onPointerLeave","ClearCanvas","onConfirm","showDialog","setShowDialog","toggleDialog","useIsMobile","small","zoomToFitElements","app","_elements","ZOOM_STEP","zoomToSelection","commonBounds","commonBoundsWidth","zoomValueForWidth","commonBoundsHeight","zoomValueForHeight","smallestZoomValue","zoomAdjustedToSteps","zoomValueToFitBoundsOnViewport","newZoom","actionFinalize","marginInlineStart","focusContainer","multiPointElement","isLoop","linePoints","firstPoint","ProjectName","fileName","setFileName","htmlFor","isNameEditable","parent","parentElement","focusNearestParent","isComposing","keyCode","blur","roundRect","beginPath","moveTo","lineTo","quadraticCurveTo","closePath","getClientColors","clientId","currentUser","sum","charCodeAt","backgrounds","strokes","background","hasEmojiSupport","ctx","textBaseline","getImageData","supportsEmoji","strokeRectWithRotation","strokeRect","fillCircle","arc","strokeGrid","renderLinearPointHandles","lineWidth","setLineDash","renderScene","renderScrollbars","renderSelection","renderGrid","isExport","atLeastOneVisibleElement","setTransform","normalizedCanvasWidth","normalizedCanvasHeight","THEME_FILTER","hasTransparence","clearRect","zoomTranslationX","zoomTranslationY","visibleElements","isVisibleElement","suggestedBinding","renderBindingHighlight","selections","selectionColors","remoteSelectedElementIds","socketId","elementX1","elementY1","elementX2","elementY2","addSelectionForGroupId","selection","renderSelectionBorder","locallySelectedElements","renderTransformHandles","dashedLinePadding","initialLineDash","getLineDash","remotePointerViewportCoords","isOutOfBounds","userState","remotePointerUserStates","AWAY","remotePointerButton","username","remotePointerUsernames","idleState","IDLE","ACTIVE","usernameAndIdleState","paddingHorizontal","paddingVertical","measure","measureHeight","actualBoundingBoxDescent","actualBoundingBoxAscent","SCROLLBAR_WIDTH","elementProperties","dashWidth","spaceWidth","lineDashOffset","renderHighlight","renderBindingHighlightForSuggestedPointBinding","renderBindingHighlightForBindableElement","strokeOffset","strokeDiamondWithRotation","strokeEllipseWithRotation","canvasWidth","canvasHeight","viewTransformations","topLeftSceneCoords","bottomRightSceneCoords","renderSceneToSvg","fileOpen","mimeTypes","extensions","_fileOpen","description","multiple","legacySetup","input","scheduleRejection","focusHandler","checkForFile","EVENT","KEYUP","POINTER_UP","FOCUS","interval","setInterval","rejectPromise","clearInterval","fileSave","blob","_fileSave","extension","AllowedExcalidrawElementTypes","diamond","freedraw","restoreElementWithProperties","extra","base","restoreElement","fontFamilyName","fontPx","_fontFamily","DEFAULT_VERTICAL_ALIGN","restoreElements","localElements","localElementsMap","migratedElement","localElement","restoreAppState","localAppState","suppliedValue","localValue","parseFileContents","png","decodePngMetadata","contents","reader","FileReader","readAsText","onloadend","readyState","DONE","decodeSvgMetadata","getFileHandleType","match","isImageFileHandle","isSupportedImageFile","ALLOWED_IMAGE_MIME_TYPES","loadFromBlob","parse","isValidExcalidrawData","loadLibraryFromBlob","EXPORT_DATA_TYPES","excalidrawLibrary","canvasToBlob","toBlob","generateIdFromFile","digest","hashBuffer","byte","getDataURL","onload","onerror","readAsDataURL","dataURLToFile","filename","dataIndexStart","byteString","atob","ab","ArrayBuffer","ia","File","resizeImageFile","maxWidthOrHeight","all","res","default","pica","imageBlobReduce","features","fileType","SVGStringToFile","SVGString","filterOutDeletedFiles","nextFiles","serializeAsJSON","excalidraw","source","EXPORT_SOURCE","saveAsJSON","serialized","loadFromJSON","isValidLibrary","json","saveLibraryAsJSON","library","loadLibrary","libraryItems","excalidrawlib","importLibraryFromJSON","importLibrary","loadHTMLImageElement","Image","updateImageCache","fileIds","updatedFiles","erroredFiles","promises","binary","imagePromise","getInitializedImageElements","normalizeSVG","doc","DOMParser","parseFromString","hasAttribute","outerHTML","SVG_EXPORT_TAG","exportToCanvas","exportPadding","DEFAULT_EXPORT_PADDING","createCanvas","getCanvasSize","exportToSvg","metadata","encodeSvgMetadata","innerHTML","rect","BAR_WIDTH","BAR_GAP","BAR_HEIGHT","NOT_SPREADSHEET","VALID_SPREADSHEET","tryParseNumber","exec","isNumericColumn","columnIndex","tryParseCells","cells","numCols","reason","hasHeader","spreadsheet","labels","valueColumnIndex","labelColumnIndex","rows","row","bgColors","commonProps","getChartDimentions","chartWidth","chartHeight","chartBaseElements","debug","debugRect","chartXLabels","minYLabel","toLocaleString","chartYLabels","chartLines","renderSpreadsheet","chartType","dots","chartTypeLine","bars","barHeight","chartTypeBar","CLIPBOARD","PREFER_APP_CLIPBOARD","probablySupportsClipboardReadText","probablySupportsClipboardWriteText","probablySupportsClipboardBlob","HTMLCanvasElement","copyToClipboard","excalidrawClipboard","copyTextToSystemClipboard","getAppClipboard","parsePotentialSpreadsheet","trim","numColsFirstLine","transposedResults","nextCells","col","nextCellRow","transposeCells","tryParseSpreadsheet","getSystemClipboard","clipboardData","getData","readText","parseClipboard","systemClipboard","spreadsheetResult","appClipboardData","systemClipboardData","copyBlobToClipboardAsPng","write","ClipboardItem","copied","writeText","copyTextViaExecCommand","textarea","border","yPosition","pageYOffset","scrollTop","success","select","setSelectionRange","execCommand","exportCanvas","tempSvg","tempCanvas","encodePngMetadata","resaveAsImageWithScene","fileHandleType","CheckboxItem","align","justifyContent","alignItems","justifyItems","ActiveFile","onSave","actionSaveFileToDisk","appProps","allElements","exportedElements","trunc","getExportSize","scaleButtonTitle","fileHandleExists","nativeFileSystemSupported","copiedStyles","loadedElements","loadedAppState","marginTop","marginBottom","actionCopyStyles","actionPasteStyles","pastedElement","HelpIcon","enableActionGroup","requestFullscreen","exitFullscreen","allElementsInSameGroup","actionGroup","selectedGroupId","elementIdsInGroup","updatedElements","lastElementInGroup","lastGroupElementIndex","lastIndexOf","elementsAfterGroup","elementsBeforeGroup","updatedElement","updatedElementsInOrder","contextItemPredicate","actionUngroup","nextGroupIds","removeFromSelectedGroups","Avatar","actionAddToLibrary","collaborator","shortName","names","substring","firstName","lastName","getClientInitials","pointer","items","saveLibrary","getMaximumGroups","groups","currentGroupMembers","calculateTranslation","selectionBoundingBox","axis","groupBoundingBox","getCommonBoundingBox","noTranslation","alignSelectedElements","alignment","alignElements","updatedElementsMap","midX","midY","distributeSelectedElements","distribution","mid","end","extent","index0","g","index1","pos","box","distributeElements","actionFlipHorizontal","space","flipSelectedElements","eligibleElements","enableActionFlipHorizontal","actionFlipVertical","enableActionFlipVertical","flipDirection","flipElements","flipElement","rotateElement","originalX","originalY","originalAngle","finalOffsetX","usingNWHandle","newNCoordsX","nHandle","rotationAngle","actionCopy","actionCut","actionCopyAsSvg","_data","actionCopyAsPng","exportSelection","exportColorScheme","actionToggleGridMode","actionToggleZenMode","actionToggleStats","writeData","prevElements","updater","prevElementMap","nextElementMap","prevElement","syncHistory","ActionManager","getAppState","getElementsIncludingDeleted","renderAction","canvasActions","UIOptions","formState","actionResult","registerAction","MODES","Library","libraryCache","resetLibrary","onLibraryChange","restoreLibraryItem","libraryItem","libraryItemsFromStorage","prevLibraryItems","serializedItems","libraryFile","isUniqueitem","existingLibraryItems","targetLibraryItem","libItemExcalidrawItem","filtered","restoredItem","getCenter","pointers","allCoords","getDistance","clearAppStatePropertiesForHistory","History","elementCache","recording","stateHistory","redoStack","lastEntry","generateEntry","dehydrateHistoryEntry","dehydratedExcalidrawElement","versions","dehydratedHistoryEntry","hydrateHistoryEntry","nextEntry","newEntryDehydrated","newEntry","shouldCreateEntry","clearRedoStack","entryToRestore","pop","currentEntry","state","pushEntry","SHAPES","shortcutMap","cut","paste","copyStyles","pasteStyles","selectAll","duplicateSelection","sendBackward","bringForward","sendToBack","bringToFront","copyAsPng","copyAsSvg","ungroup","gridMode","zenMode","stats","addToLibrary","flipHorizontal","flipVertical","viewMode","getShortcutFromShortcutName","shortcuts","ContextMenu","actionManager","onContextMenu","actionName","dangerous","checkmark","executeAction","contextMenuNodeByContainer","params","of","render","container","contextMenuNode","unmountComponentAtNode","handleClose","getContextMenuNode","SelectedShapeActions","isEditing","isMobile","showFillIcons","showChangeBackgroundIcons","commonSelectedType","ShapesSwitcher","setAppState","onImageAction","letter","ZoomActions","BackgroundPickerAndDarkModeToggle","showThemeBtn","CollabButton","isCollaborating","collaboratorCount","supportsContextFilters","ErrorCanvasPreview","renderPreview","previewNode","ExportButton","shade","OpenColor","ImageExportModal","onExportToPng","onExportToSvg","onExportToClipboard","someElementIsSelected","exportSelected","setExportSelected","previewRef","catch","gridTemplateColumns","userSelect","ImageExportDialog","modalIsShown","setModalIsShown","FixedSideContainer","HintViewer","hint","multiMode","targetElement","getHints","Island","PLUS_ICON","LibraryUnit","pendingElements","onRemoveFromLibrary","elementsToRender","isHovered","setIsHovered","adder","onMouseEnter","onMouseLeave","draggable","onDragStart","dataTransfer","setData","LoadingMessage","CHECKED","xmlns","UNCHECKED","LockButton","Section","heading","header","UserList","mobile","UserList_mobile","LIBRARY_ICON","LibraryButton","MobileMenu","libraryMenu","renderJSONExportDialog","renderImageExportDialog","onCollabButtonClick","onLockToggle","renderCustomFooter","renderTopRightUI","insertOnCanvasDirectly","marginRight","client","Fragment","ChartPreviewBtn","chartElements","setChartElements","parentNode","PasteChartDialog","onInsertChart","handleChartClick","autofocus","Header","href","rel","Columns","flexDirection","flexWrap","Column","ShortcutIsland","caption","Shortcut","flex","isOr","ShortcutKey","HelpDialog","Card","JSONExportModal","exportOpts","onExportToBackend","saveFileToDisk","renderCustomUI","JSONExportDialog","LibraryMenuItems","onAddToLibrary","onInsertShape","setLibraryItems","libraryReturnUrl","numCells","CELLS_PER_ROW","numRows","addedPendingElements","referrer","location","origin","pathname","confirm","shouldAddPendingElements","bind","LibraryMenu","onClickOutside","listener","Element","useOnClickOutside","closest","loadingState","loadingTimerRef","race","removeFromLibrary","indexToRemove","nextItems","LayerUI","onInsertElements","showExitZenModeBtn","toggleZenMode","saveAsImage","createExporter","Separator","closeLibrary","deselectItems","dialogs","shouldRenderSelectedShapeActions","zIndex","CLASSES","SHAPE_ACTIONS_MENU","maxHeight","renderFixedSideContainer","areEqual","getNecessaryObj","prevAppState","langCode","Stats","boundingBox","selectedBoundingBox","colSpan","renderCustomStats","Toast","clearToast","timerRef","scheduleTimeout","TOAST_TIMEOUT","actionToggleViewMode","IsMobileContext","createContext","useContext","ExcalidrawContainerContext","didTapTwice","tappedTwiceTimer","cursorX","cursorY","isHoldingSpace","isPanning","isDraggingScrollBar","currentScrollBars","touchTimeout","invalidateContextMenu","lastPointerUp","gesture","lastCenter","initialDistance","initialScale","App","unmounted","excalidrawContainerRef","createRef","autoFocus","getSceneElementsIncludingDeleted","getSceneElements","syncActionResult","replaceAllElements","replaceFiles","addNewImagesToImageCache","gridModeEnabled","setCurrentState","onUnload","disableEvent","onFontLoaded","onSceneUpdated","importLibraryFromUrl","url","token","hash","URL_HASH_KEYS","addLibrary","URLSearchParams","replaceState","APP_NAME","search","URL_QUERY_KEYS","query","fetch","decodeURIComponent","request","numShapes","alert","resetHistory","resetScene","resetLoadingState","initializeScene","launchQueue","setConsumer","launchParams","getFile","initialData","scrollToContent","libraryUrl","onResize","onScroll","getCanvasOffsets","SCROLL_TIMEOUT","onCut","cutAll","onCopy","copyAll","onTapStart","resetTapTwice","TAP_TWICE_TIMEOUT","touches","handleCanvasDoubleClick","onTapEnd","pasteFromClipboard","elementUnderCursor","elementFromPoint","string","endsWith","imageElement","createImageElement","insertImageElement","initializeImageDimensions","onPaste","addElementsFromPasteOrLibrary","addTextFromPaste","selectShapeTool","elementsCenterX","elementsCenterY","dx","dy","gridX","gridY","obj","removePointer","pointerId","toggleLock","prevState","toggleStats","setToastMessage","restoreFileFromShare","caches","open","webShareTargetCache","loadFileToCanvas","addFiles","filesMap","updateScene","sceneData","updateCurrentCursorPosition","Proxy","ev","prop","HTMLSelectElement","handleKeyDown","ELEMENT_TRANSLATE_AMOUNT","ELEMENT_SHIFT_TRANSLATE_AMOUNT","maybeSuggestBindingForAll","selectedElement","startTextEditing","findShapeByKey","GRABBING","onKeyUp","GRAB","onGestureStart","onGestureChange","onGestureEnd","insertAtParentCenter","existingTextElement","getTextElementAtPosition","parentCenterPosition","getTextWysiwygSnappedToCenterPosition","elementCenterX","elementCenterY","handleTextWysiwyg","isExistingElement","getSelectedGroupIdForElement","handleCanvasPointerMove","savePointer","scaleFactor","resetShouldCacheIgnoreZoomDebounced","isOverScrollBar","handlePointerMove","maybeSuggestBindingAtCursor","maybeSuggestBindingForLinearElementAtCursor","POINTER","buttons","elementWithTransformHandleType","TEXT","isHittingCommonBoundingBoxOfSelectedElements","AUTO","MOVE","handleTouchMove","handleCanvasPointerDown","getSelection","anchorNode","removeAllRanges","maybeOpenContextMenuAfterPointerDownOnTouchDevices","maybeCleanupAfterMissingPointerUp","handleCanvasPanUsingWheelOrSpaceDrag","button","POINTER_BUTTON","MAIN","TOUCH","updateGestureOnPointerDown","initialPointerDownState","handleDraggingScrollBar","clearSelectionIfNotUsingSelection","updateBindingEnabledOnPointerMove","handleSelectionOnPointerDown","handleLinearElementOnPointerDown","handleFreeDrawElementOnPointerDown","createGenericElementOnPointerDown","onPointerMove","onPointerMoveFromPointerDownHandler","onPointerUpFromPointerDownHandler","onKeyDownFromPointerDownHandler","onKeyUpFromPointerDownHandler","POINTER_MOVE","KEYDOWN","eventListeners","onMove","onUp","handleTextOnPointerDown","handleCanvasContextMenu","TOUCH_CTX_MENU_TIMEOUT","WHEEL","nextPastePrevented","isLinux","lastX","lastY","preventNextPaste","PASTE","enableNextPaste","teardown","BLUR","passive","resize","handleType","getResizeOffsetXY","arrowDirection","getResizeArrowDirection","handlePointerDown","hit","allHitElements","getElementsAtPosition","someHitElementIsSelected","isASelectedElement","hasHitCommonBoundingBoxOfSelectedElements","clearSelection","wasAddedToSelection","pressure","initializeImage","imageFile","_imageElement","showCursorImagePreview","generateIdForFile","existingFileData","DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT","MAX_ALLOWED_FILE_BYTES","maxSize","resizedFile","setImagePreviewCursor","created","cachedImageData","cursorImageSizePx","imagePreview","previewDataURL","toDataURL","forceNaturalSize","DRAGGING_THRESHOLD","placeholderSize","minHeight","naturalHeight","naturalWidth","_updateImageCache","imageElements","uncachedImageElements","scheduleImageRefresh","throttle","IMAGE_RENDER_TIMEOUT","shouldEnableBinding","shouldEnableBindingForPointerEvent","hoveredBindableElement","oppositeBindingBoundElement","handleCanvasRef","handleWheel","TOUCH_START","TOUCH_END","handleAppOnDrop","getAsFileSystemHandle","libraryShapes","preferSelected","_openContextMenu","maybeDragNewGenericElement","lastCoords","aspectRatio","originInGrid","maybeHandleResize","resizeX","resizeY","transformElements","maybeGroupAction","maybeUngroupAction","maybeFlipHorizontal","maybeFlipVertical","separator","viewModeOptions","appStates","log10","isNaN","onPointerUpdate","pointersMap","updateDOMRect","currentWidth","currentHeight","currentOffsetTop","currentOffsetLeft","refresh","excalidrawRef","readyPromise","api","ready","getFiles","excalidrawContainerValue","registerAll","undoOnce","redoOnce","createRedoAction","canvasScale","canvasDOMWidth","canvasDOMHeight","onPointerCancel","onTouchMove","onDoubleClick","renderFooter","onDrop","handleKeyboardGlobally","Provider","renderCanvas","TEST","defineProperties","configurable","addCallback","addEventListeners","resizeObserver","ResizeObserver","MQ_MAX_WIDTH_PORTRAIT","MQ_MAX_HEIGHT_LANDSCAPE","MQ_MAX_WIDTH_LANDSCAPE","observe","matchMedia","mediaQuery","matches","addListener","detachIsMobileMqHandler","removeListener","disconnect","removeEventListeners","destroy","COPY","CUT","nearestScrollableContainer","SCROLL","MOUSE_MOVE","RESIZE","UNLOAD","DRAG_OVER","DROP","GESTURE_START","GESTURE_CHANGE","GESTURE_END","fonts","detectScroll","overflowY","scrollHeight","clientHeight","getNearestScrollableContainer","prevProps","updateLanguage","deselectElements","toggle","pointerViewportCoords","pointerUsernames","pointerUserStates","user","renderingElements","record","updateElement","_element","onSubmit","getViewportCoords","excalidrawContainer","updateWysiwygStyle","viewportX","viewportY","editable","wrap","backfaceVisibility","outline","oninput","onkeydown","submittedViaKeyboard","handleSubmit","outdent","indent","dispatchEvent","Event","TAB","repeat","RE_LEADING_TAB","selectionStart","selectionEnd","linesStartIndices","getSelectedLinesStartIndices","startIndex","startValue","endValue","removedTabs","tabMatch","startOffset","startIndices","stopEvent","cleanup","viaKeyboard","isDestroyed","onblur","observer","bindBlurEvent","unbindUpdate","SVGElement","capture","textWysiwyg","elementWithHighestZIndex","hitTest","withCmdOrCtrl","scrollbars","hasBeenDuplicated","drag","hasOccurred","handlePointerMoveOverScrollbars","getDragOffsetXY","didDrag","handlePointDragging","hasHitASelectedElement","dragX","dragY","dragDistanceX","dragDistanceY","lockDirection","distanceX","distanceY","lockX","lockY","original","dragSelectedElements","elementsToAppend","duplicatedElement","originDragX","originDragY","nextSceneElements","elementsWithinSelection","selectionX1","selectionY1","selectionX2","selectionY2","getElementsWithinSelection","childEvent","handlePointerUp","idsOfSelectedElementsThatAreInGroups","prevId","_prevState","gId","includedElementIds","getEligibleElementsForBinding","elementClickedInside","getElementContainingPosition","TEXT_TO_CENTER_SNAP_THRESHOLD","Component","DEFAULT_UI_OPTIONS","Modal","modalRoot","useBodyRoot","createPortal","labelledBy","setDiv","isMobileRef","isDarkTheme","Dialog","islandNode","setIslandNode","lastActiveElement","focusableElements","queryFocusableElements","currentIndex","querySelectorAll","ErrorDialog","TopErrorBoundary","arguments","hasError","sentryEventId","localStorage","errorSplash","errorInfo","_localStorage","Sentry","scope","setExtras","eventId","templateStrFn","reload","createGithubIssue","selectTextArea","readOnly","__webpack_public_path__","EXCALIDRAW_ASSET_PATH","pkg","SCENE","InitializeApp","loading","setLoading","updateLang","Excalidraw","nextProps","prevUIOptions","nextUIOptions","prevUIOptionsKeys","nextUIOptionsKeys","isUIOptionsSame","prevKeys","nextKeys","forwardedRefComp","FILE_UPLOAD_MAX_BYTES","BROADCAST","FIREBASE_STORAGE_PREFIXES","FileManager","saveFiles","fetchingFiles","savingFiles","savedFiles","isFileHandled","isFileSaved","addedFiles","_saveFiles","loadedFiles","_getFiles","shouldPreventUnload","shouldUpdateImageElementStatus","encodeFilesForUpload","maxBytes","encryptionKey","processedFiles","compressData","encodedFile","byteLength","updateStaleImageStatuses","excalidrawAPI","FIREBASE_CONFIG","firebasePromise","firestorePromise","firebaseStoragePromise","isFirebaseInitialized","_loadFirebase","firebase","initializeApp","_getFirebase","loadFirestore","loadFirebaseStorage","encryptElements","encoded","ciphertext","decryptElements","decrypted","decodedData","TextDecoder","decode","firebaseSceneVersionCache","isSavedToFirebase","portal","socket","roomId","roomKey","sceneVersion","saveFilesToFirebase","prefix","storage","put","cacheControl","saveToFirebase","nextDocData","firestore","fromUint8Array","docRef","collection","runTransaction","transaction","exists","update","didUpdate","loadFromFirebase","storedScene","toUint8Array","loadFilesFromFirebase","decryptionKey","filesIds","storageBucket","response","decompressData","byteToHex","generateRandomID","encryptAESGEM","decryptAESGEM","getCollaborationLinkData","URL","generateCollaborationLinkData","decryptImported","importFromBackend","ok","fixedIv","loadScene","localDataState","exportToBackend","cryptoKey","payloadBlob","Response","payload","exportedKey","filesToUpload","method","urlString","prompt","error_class","STORAGE_KEYS","importUsernameFromLocalStorage","getItem","saveToLocalStorage","setItem","importFromLocalStorage","savedElements","savedState","getElementsStorageSize","getTotalStorageSize","collab","APP_STORAGE_KEYS","LOCAL_STORAGE_LIBRARY","Portal","socketInitialized","broadcastedElementVersions","queueFileUpload","fileManager","broadcastScene","sceneType","syncAll","INIT","syncableElements","isSyncableElement","syncableElement","broadcastPromise","_broadcastSocketData","saveCollabRoomToFirebase","broadcastIdleChange","broadcastMouseLocation","on","emit","_socketId","clients","setCollaborators","volatile","isOpen","getShareIcon","isAppleBrowser","vendor","isWindowsBrowser","appVersion","RoomDialog","activeRoomLink","onUsernameChange","onRoomCreate","onRoomDestroy","setErrorMessage","roomLinkInput","copyRoomLink","shareRoomLink","selectInput","onKeyPress","shouldDiscardRemoteElement","local","remote","initialValue","Context","InverseConsumer","_updateProviderValue","InverseProvider","Consumer","createInverseContext","CollabContext","CollabContextConsumer","CollabContextProvider","CollabWrapper","lastBroadcastedOrReceivedSceneVersion","destroySocketClient","isUnload","beforeUnload","getSyncableElements","timestamp","room","openPortal","initializeSocketClient","closePortal","queueBroadcastAllElements","loadImageFiles","pushState","onRoomClose","reset","fetchImageFilesFromFirebase","unfetchedImages","existingRoomLinkData","scenePromise","socketIOClient","broadcastElements","socketInitializationTimer","initializeSocket","encryptedData","decryptedData","UPDATE","remoteElements","reconciledElements","reconcileElements","handleRemoteSceneUpdate","init","socketID","off","initializeIdleDetector","localElementsData","duplicates","remoteElementIdx","remoteElement","_reconcileElements","setLastBroadcastedOrReceivedSceneVersion","idleTimeoutId","reportIdle","IDLE_THRESHOLD","activeIntervalId","reportActive","ACTIVE_THRESHOLD","onVisibilityChange","onIdleStateChange","VISIBILITY_CHANGE","getLastBroadcastedOrReceivedSceneVersion","currentVersion","newVersion","saveUsernameToLocalStorage","contextValue","getContextValue","BEFORE_UNLOAD","sockets","PureComponent","LanguageList","i18n","currentLangCode","getStorageSizes","total","CustomStats","storageSizes","setStorageSizes","sizes","excalidrawPlusIcon","exportToExcalidrawPlus","customMetadata","ExportToExcalidrawPlus","onError","filesStore","createStore","clearObsoleteFilesFromIndexedDB","allIds","currentFileIds","del","localFileStorage","getMany","filesData","languageDetector","LanguageDetector","languageUtils","formatLanguageCode","isWhitelisted","checkWhitelist","saveDebounced","onFilesSaved","searchParams","jsonBackendMatch","externalUrlMatch","roomLinkData","isExternalScene","once","collabAPI","ExcalidrawWrapper","detect","setLangCode","initialStatePromiseRef","VERSION_TIMEOUT","excalidrawRefCallback","loadImages","isInitialLoad","onHashChange","oldURL","titleTimeout","TITLE_TIMEOUT","HASHCHANGE","unloadHandler","cacheUserLanguage","renderLanguageList","isTinyDevice","borderRadius","removeItem","newEl","ExcalidrawApp","SentryEnvHostnameMap","onlineEnv","REACT_APP_DISABLE_SENTRY","hostname","dsn","environment","release","REACT_APP_GIT_SHA","ignoreErrors","integrations","SentryIntegrations","levels","beforeSend","__EXCALIDRAW_SHA__","language","TextEditor","srcDoc","useSelector","srcDocs","modalActive","outputModal","dispatch","useDispatch","handleCloseModal","log","defaultLanguage","saveViewState","cursorSmoothCaretAnimation","contentLabel","onRequestClose","overlayClassName","ariaHideApp","sandbox","frameBorder","MultiFile","outputValue","setOutputValue","setInputValue","words","axios","post","stdin","versionIndex","script","runCode","output","CustomEvent","detail","class","fontWeight","beforeMount","monaco","editor","defineTheme","inherit","rules","cols","placeholder","startTime","Recorder","lectureType","languageType","childValue","Recording","events","lastMouse","lastKey","lastKeyClass","handlers","eventName","time","pageX","pageY","Mp3Recorder","MicRecorder","bitRate","startRecording","stopRecording","getElementsByClassName","recordingString","createdAt","FieldValue","serverTimestamp","lectureName","creator","lectureCreator","audioString","getMp3","lastModified","storageRef","child","putString","snapshot","ChalkBoard","IDE","parentCallBack","childData","StartingComponent","useHistory","RecorderForm","languageList","getElementById","Preloader","Video","setRefresh","drawing","setDrawing","offsetPlay","videoPlayer","playButton","recordingJsonValue","FieldPath","documentId","snap","err","getDownloadURL","audioPlayer","fakeCursor","startPlay","paused","pausefunction","playfunction","frames","eve","PointerEvent","bubbles","cancelable","handleButtonEvents","tar","clickEvent","MouseEvent","click","flashClass","drawEvent","pause","curTime","currentTime","play","controls","controlsList","LiveClassEmitter","socketRef","stream","setStream","io","myVideo","mediaDevices","getUserMedia","video","audio","srcObject","sendData","startLive","peer","Peer","initiator","trickle","signalData","signal","stopLive","playsInline","muted","autoPlay","LiveClassReceiver","callerSignal","setCallerSignal","userVideo","paddingRight","answerCall","mainWindow","lectures","lecture","nameHeading","AllLectures","setLectures","lecturesArray","orderBy","limit","filenameReducer","outputModalReducer","languageReducer","allReducers","combineReducers","apps","apiKey","authDomain","projectId","messagingSenderId","appId","measurementId","middleware","thunk","composeEnhancer","__REDUX_DEVTOOLS_EXTENSION_COMPOSE__","compose","store","allReducer","applyMiddleware","exact","component","ide","ReactDOM","SECONDARY","jpg","gif","VIEW","ZEN","GRID","cssVariables","themeFilter","changeViewBackgroundColor","clearCanvas","saveToActiveFile","toByteString","readAsBinaryString","byteStringToArrayBuffer","bufferView","len","byteStringToString","stringToBase64","btoa","base64ToString","base64","isByteString","compress","deflate","deflated","encoding","compressed","decoded","inflate","DATA_VIEW_BITS_MAP","dataView","bytes","DataView","concatBuffers","buffers","splitBuffers","concatenatedBuffer","chunkSize","_encryptAndCompress","dataBuffer","fileInfo","compression","encryption","encodingMetadataBuffer","contentsMetadataBuffer","_decryptAndDecompress","decryptedBuffer","isCompressed","encodingMetadata","contentsBuffer"],"mappings":"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","file":"static/js/main.d901b532.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"themeFilter\":\"invert(93%) hue-rotate(180deg)\"};","var map = {\n\t\"./en.json\": 99,\n\t\"./percentages.json\": 100\n};\n\nfunction webpackAsyncContext(req) {\n\treturn Promise.resolve().then(function() {\n\t\tif(!__webpack_require__.o(map, req)) {\n\t\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\t\te.code = 'MODULE_NOT_FOUND';\n\t\t\tthrow e;\n\t\t}\n\n\t\tvar id = map[req];\n\t\treturn __webpack_require__.t(id, 3);\n\t});\n}\nwebpackAsyncContext.keys = function webpackAsyncContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackAsyncContext.id = 154;\nmodule.exports = webpackAsyncContext;","export const IV_LENGTH_BYTES = 12;\r\nexport const createIV = () => {\r\n    const arr = new Uint8Array(IV_LENGTH_BYTES);\r\n    return window.crypto.getRandomValues(arr);\r\n};\r\nexport const generateEncryptionKey = async () => {\r\n    const key = await window.crypto.subtle.generateKey({\r\n        name: \"AES-GCM\",\r\n        length: 128,\r\n    }, true, // extractable\r\n    [\"encrypt\", \"decrypt\"]);\r\n    return (await window.crypto.subtle.exportKey(\"jwk\", key)).k;\r\n};\r\nexport const getImportedKey = (key, usage) => window.crypto.subtle.importKey(\"jwk\", {\r\n    alg: \"A128GCM\",\r\n    ext: true,\r\n    k: key,\r\n    key_ops: [\"encrypt\", \"decrypt\"],\r\n    kty: \"oct\",\r\n}, {\r\n    name: \"AES-GCM\",\r\n    length: 128,\r\n}, false, // extractable\r\n[usage]);\r\nexport const encryptData = async (key, data) => {\r\n    const importedKey = await getImportedKey(key, \"encrypt\");\r\n    const iv = createIV();\r\n    const buffer = typeof data === \"string\"\r\n        ? new TextEncoder().encode(data)\r\n        : data instanceof Uint8Array\r\n            ? data\r\n            : data instanceof Blob\r\n                ? await data.arrayBuffer()\r\n                : data;\r\n    const encryptedBuffer = await window.crypto.subtle.encrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, importedKey, buffer);\r\n    return { encryptedBuffer, iv };\r\n};\r\nexport const decryptData = async (iv, encrypted, privateKey) => {\r\n    const key = await getImportedKey(privateKey, \"decrypt\");\r\n    return window.crypto.subtle.decrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, key, encrypted);\r\n};\r\n","export const trackEvent = typeof process !== \"undefined\" &&\r\n    process.env?.REACT_APP_GOOGLE_ANALYTICS_ID &&\r\n    typeof window !== \"undefined\" &&\r\n    window.gtag\r\n    ? (category, name, label, value) => {\r\n        window.gtag(\"event\", name, {\r\n            event_category: category,\r\n            event_label: label,\r\n            value,\r\n        });\r\n    }\r\n    : typeof process !== \"undefined\" && process.env?.JEST_WORKER_ID\r\n        ? (category, name, label, value) => { }\r\n        : (category, name, label, value) => {\r\n            // Uncomment the next line to track locally\r\n            // console.info(\"Track Event\", category, name, label, value);\r\n        };\r\n","import fallbackLangData from \"./locales/en.json\";\r\nimport percentages from \"./locales/percentages.json\";\r\nimport { ENV } from \"./constants\";\r\nconst COMPLETION_THRESHOLD = 85;\r\nexport const defaultLang = { code: \"en\", label: \"English\" };\r\nconst allLanguages = [\r\n    { code: \"ar-SA\", label: \"العربية\", rtl: true },\r\n    { code: \"bg-BG\", label: \"Български\" },\r\n    { code: \"ca-ES\", label: \"Català\" },\r\n    { code: \"de-DE\", label: \"Deutsch\" },\r\n    { code: \"el-GR\", label: \"Ελληνικά\" },\r\n    { code: \"es-ES\", label: \"Español\" },\r\n    { code: \"fa-IR\", label: \"فارسی\", rtl: true },\r\n    { code: \"fi-FI\", label: \"Suomi\" },\r\n    { code: \"fr-FR\", label: \"Français\" },\r\n    { code: \"he-IL\", label: \"עברית\", rtl: true },\r\n    { code: \"hi-IN\", label: \"हिन्दी\" },\r\n    { code: \"hu-HU\", label: \"Magyar\" },\r\n    { code: \"id-ID\", label: \"Bahasa Indonesia\" },\r\n    { code: \"it-IT\", label: \"Italiano\" },\r\n    { code: \"ja-JP\", label: \"日本語\" },\r\n    { code: \"kab-KAB\", label: \"Taqbaylit\" },\r\n    { code: \"ko-KR\", label: \"한국어\" },\r\n    { code: \"my-MM\", label: \"Burmese\" },\r\n    { code: \"nb-NO\", label: \"Norsk bokmål\" },\r\n    { code: \"nl-NL\", label: \"Nederlands\" },\r\n    { code: \"nn-NO\", label: \"Norsk nynorsk\" },\r\n    { code: \"oc-FR\", label: \"Occitan\" },\r\n    { code: \"pa-IN\", label: \"ਪੰਜਾਬੀ\" },\r\n    { code: \"pl-PL\", label: \"Polski\" },\r\n    { code: \"pt-BR\", label: \"Português Brasileiro\" },\r\n    { code: \"pt-PT\", label: \"Português\" },\r\n    { code: \"ro-RO\", label: \"Română\" },\r\n    { code: \"ru-RU\", label: \"Русский\" },\r\n    { code: \"sk-SK\", label: \"Slovenčina\" },\r\n    { code: \"sv-SE\", label: \"Svenska\" },\r\n    { code: \"tr-TR\", label: \"Türkçe\" },\r\n    { code: \"uk-UA\", label: \"Українська\" },\r\n    { code: \"zh-CN\", label: \"简体中文\" },\r\n    { code: \"zh-TW\", label: \"繁體中文\" },\r\n    { code: \"lv-LV\", label: \"Latviešu\" },\r\n    { code: \"cs-CZ\", label: \"Česky\" },\r\n    { code: \"kk-KZ\", label: \"Қазақ тілі\" },\r\n].concat([defaultLang]);\r\nexport const languages = allLanguages\r\n    .sort((left, right) => (left.label > right.label ? 1 : -1))\r\n    .filter((lang) => percentages[lang.code] >=\r\n    COMPLETION_THRESHOLD);\r\nconst TEST_LANG_CODE = \"__test__\";\r\nif (process.env.NODE_ENV === ENV.DEVELOPMENT) {\r\n    languages.unshift({ code: TEST_LANG_CODE, label: \"test language\" }, {\r\n        code: `${TEST_LANG_CODE}.rtl`,\r\n        label: \"\\u{202a}test language (rtl)\\u{202c}\",\r\n        rtl: true,\r\n    });\r\n}\r\nlet currentLang = defaultLang;\r\nlet currentLangData = {};\r\nexport const setLanguage = async (lang) => {\r\n    currentLang = lang;\r\n    document.documentElement.dir = currentLang.rtl ? \"rtl\" : \"ltr\";\r\n    document.documentElement.lang = currentLang.code;\r\n    if (lang.code.startsWith(TEST_LANG_CODE)) {\r\n        currentLangData = {};\r\n    }\r\n    else {\r\n        currentLangData = await import(\r\n        /* webpackChunkName: \"i18n-[request]\" */ `./locales/${currentLang.code}.json`);\r\n    }\r\n};\r\nexport const getLanguage = () => currentLang;\r\nconst findPartsForData = (data, parts) => {\r\n    for (let index = 0; index < parts.length; ++index) {\r\n        const part = parts[index];\r\n        if (data[part] === undefined) {\r\n            return undefined;\r\n        }\r\n        data = data[part];\r\n    }\r\n    if (typeof data !== \"string\") {\r\n        return undefined;\r\n    }\r\n    return data;\r\n};\r\nexport const t = (path, replacement) => {\r\n    if (currentLang.code.startsWith(TEST_LANG_CODE)) {\r\n        const name = replacement\r\n            ? `${path}(${JSON.stringify(replacement).slice(1, -1)})`\r\n            : path;\r\n        return `\\u{202a}[[${name}]]\\u{202c}`;\r\n    }\r\n    const parts = path.split(\".\");\r\n    let translation = findPartsForData(currentLangData, parts) ||\r\n        findPartsForData(fallbackLangData, parts);\r\n    if (translation === undefined) {\r\n        throw new Error(`Can't find translation for ${path}`);\r\n    }\r\n    if (replacement) {\r\n        for (const key in replacement) {\r\n            translation = translation.replace(`{{${key}}}`, replacement[key]);\r\n        }\r\n    }\r\n    return translation;\r\n};\r\n","import oc from \"open-color\";\r\nconst shades = (index) => [\r\n    oc.red[index],\r\n    oc.pink[index],\r\n    oc.grape[index],\r\n    oc.violet[index],\r\n    oc.indigo[index],\r\n    oc.blue[index],\r\n    oc.cyan[index],\r\n    oc.teal[index],\r\n    oc.green[index],\r\n    oc.lime[index],\r\n    oc.yellow[index],\r\n    oc.orange[index],\r\n];\r\nexport default {\r\n    canvasBackground: [oc.white, oc.gray[0], oc.gray[1], ...shades(0)],\r\n    elementBackground: [\"transparent\", oc.gray[4], oc.gray[6], ...shades(6)],\r\n    elementStroke: [oc.black, oc.gray[8], oc.gray[7], ...shades(9)],\r\n};\r\n","export const isDarwin = /Mac|iPod|iPhone|iPad/.test(window.navigator.platform);\r\nexport const isWindows = /^Win/.test(window.navigator.platform);\r\nexport const CODES = {\r\n    EQUAL: \"Equal\",\r\n    MINUS: \"Minus\",\r\n    NUM_ADD: \"NumpadAdd\",\r\n    NUM_SUBTRACT: \"NumpadSubtract\",\r\n    NUM_ZERO: \"Numpad0\",\r\n    BRACKET_RIGHT: \"BracketRight\",\r\n    BRACKET_LEFT: \"BracketLeft\",\r\n    ONE: \"Digit1\",\r\n    TWO: \"Digit2\",\r\n    NINE: \"Digit9\",\r\n    QUOTE: \"Quote\",\r\n    ZERO: \"Digit0\",\r\n    SLASH: \"Slash\",\r\n    C: \"KeyC\",\r\n    D: \"KeyD\",\r\n    G: \"KeyG\",\r\n    F: \"KeyF\",\r\n    H: \"KeyH\",\r\n    V: \"KeyV\",\r\n    X: \"KeyX\",\r\n    Z: \"KeyZ\",\r\n    R: \"KeyR\",\r\n};\r\nexport const KEYS = {\r\n    ARROW_DOWN: \"ArrowDown\",\r\n    ARROW_LEFT: \"ArrowLeft\",\r\n    ARROW_RIGHT: \"ArrowRight\",\r\n    ARROW_UP: \"ArrowUp\",\r\n    BACKSPACE: \"Backspace\",\r\n    ALT: \"Alt\",\r\n    CTRL_OR_CMD: isDarwin ? \"metaKey\" : \"ctrlKey\",\r\n    DELETE: \"Delete\",\r\n    ENTER: \"Enter\",\r\n    ESCAPE: \"Escape\",\r\n    QUESTION_MARK: \"?\",\r\n    SPACE: \" \",\r\n    TAB: \"Tab\",\r\n    A: \"a\",\r\n    D: \"d\",\r\n    E: \"e\",\r\n    G: \"g\",\r\n    I: \"i\",\r\n    L: \"l\",\r\n    O: \"o\",\r\n    P: \"p\",\r\n    Q: \"q\",\r\n    R: \"r\",\r\n    S: \"s\",\r\n    T: \"t\",\r\n    V: \"v\",\r\n    X: \"x\",\r\n    Y: \"y\",\r\n    Z: \"z\",\r\n};\r\nexport const isArrowKey = (key) => key === KEYS.ARROW_LEFT ||\r\n    key === KEYS.ARROW_RIGHT ||\r\n    key === KEYS.ARROW_DOWN ||\r\n    key === KEYS.ARROW_UP;\r\nexport const shouldResizeFromCenter = (event) => event.altKey;\r\nexport const shouldMaintainAspectRatio = (event) => event.shiftKey;\r\nexport const shouldRotateWithDiscreteAngle = (event) => event.shiftKey;\r\n","import colors from \"./colors\";\r\nimport { CURSOR_TYPE, DEFAULT_VERSION, FONT_FAMILY, WINDOWS_EMOJI_FALLBACK_FONT, } from \"./constants\";\r\nimport { unstable_batchedUpdates } from \"react-dom\";\r\nimport { isDarwin } from \"./keys\";\r\nlet mockDateTime = null;\r\nexport const setDateTimeForTests = (dateTime) => {\r\n    mockDateTime = dateTime;\r\n};\r\nexport const getDateTime = () => {\r\n    if (mockDateTime) {\r\n        return mockDateTime;\r\n    }\r\n    const date = new Date();\r\n    const year = date.getFullYear();\r\n    const month = `${date.getMonth() + 1}`.padStart(2, \"0\");\r\n    const day = `${date.getDate()}`.padStart(2, \"0\");\r\n    const hr = `${date.getHours()}`.padStart(2, \"0\");\r\n    const min = `${date.getMinutes()}`.padStart(2, \"0\");\r\n    return `${year}-${month}-${day}-${hr}${min}`;\r\n};\r\nexport const capitalizeString = (str) => str.charAt(0).toUpperCase() + str.slice(1);\r\nexport const isToolIcon = (target) => target instanceof HTMLElement && target.className.includes(\"ToolIcon\");\r\nexport const isInputLike = (target) => (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\r\n    target instanceof HTMLBRElement || // newline in wysiwyg\r\n    target instanceof HTMLInputElement ||\r\n    target instanceof HTMLTextAreaElement ||\r\n    target instanceof HTMLSelectElement;\r\nexport const isWritableElement = (target) => (target instanceof HTMLElement && target.dataset.type === \"wysiwyg\") ||\r\n    target instanceof HTMLBRElement || // newline in wysiwyg\r\n    target instanceof HTMLTextAreaElement ||\r\n    (target instanceof HTMLInputElement &&\r\n        (target.type === \"text\" || target.type === \"number\"));\r\nexport const getFontFamilyString = ({ fontFamily, }) => {\r\n    for (const [fontFamilyString, id] of Object.entries(FONT_FAMILY)) {\r\n        if (id === fontFamily) {\r\n            return `${fontFamilyString}, ${WINDOWS_EMOJI_FALLBACK_FONT}`;\r\n        }\r\n    }\r\n    return WINDOWS_EMOJI_FALLBACK_FONT;\r\n};\r\n/** returns fontSize+fontFamily string for assignment to DOM elements */\r\nexport const getFontString = ({ fontSize, fontFamily, }) => {\r\n    return `${fontSize}px ${getFontFamilyString({ fontFamily })}`;\r\n};\r\n// https://github.com/grassator/canvas-text-editor/blob/master/lib/FontMetrics.js\r\nexport const measureText = (text, font) => {\r\n    const line = document.createElement(\"div\");\r\n    const body = document.body;\r\n    line.style.position = \"absolute\";\r\n    line.style.whiteSpace = \"pre\";\r\n    line.style.font = font;\r\n    body.appendChild(line);\r\n    line.innerText = text\r\n        .split(\"\\n\")\r\n        // replace empty lines with single space because leading/trailing empty\r\n        // lines would be stripped from computation\r\n        .map((x) => x || \" \")\r\n        .join(\"\\n\");\r\n    const width = line.offsetWidth;\r\n    const height = line.offsetHeight;\r\n    // Now creating 1px sized item that will be aligned to baseline\r\n    // to calculate baseline shift\r\n    const span = document.createElement(\"span\");\r\n    span.style.display = \"inline-block\";\r\n    span.style.overflow = \"hidden\";\r\n    span.style.width = \"1px\";\r\n    span.style.height = \"1px\";\r\n    line.appendChild(span);\r\n    // Baseline is important for positioning text on canvas\r\n    const baseline = span.offsetTop + span.offsetHeight;\r\n    document.body.removeChild(line);\r\n    return { width, height, baseline };\r\n};\r\nexport const debounce = (fn, timeout) => {\r\n    let handle = 0;\r\n    let lastArgs = null;\r\n    const ret = (...args) => {\r\n        lastArgs = args;\r\n        clearTimeout(handle);\r\n        handle = window.setTimeout(() => {\r\n            lastArgs = null;\r\n            fn(...args);\r\n        }, timeout);\r\n    };\r\n    ret.flush = () => {\r\n        clearTimeout(handle);\r\n        if (lastArgs) {\r\n            const _lastArgs = lastArgs;\r\n            lastArgs = null;\r\n            fn(..._lastArgs);\r\n        }\r\n    };\r\n    ret.cancel = () => {\r\n        lastArgs = null;\r\n        clearTimeout(handle);\r\n    };\r\n    return ret;\r\n};\r\nexport const selectNode = (node) => {\r\n    const selection = window.getSelection();\r\n    if (selection) {\r\n        const range = document.createRange();\r\n        range.selectNodeContents(node);\r\n        selection.removeAllRanges();\r\n        selection.addRange(range);\r\n    }\r\n};\r\nexport const removeSelection = () => {\r\n    const selection = window.getSelection();\r\n    if (selection) {\r\n        selection.removeAllRanges();\r\n    }\r\n};\r\nexport const distance = (x, y) => Math.abs(x - y);\r\nexport const resetCursor = (canvas) => {\r\n    if (canvas) {\r\n        canvas.style.cursor = \"\";\r\n    }\r\n};\r\nexport const setCursor = (canvas, cursor) => {\r\n    if (canvas) {\r\n        canvas.style.cursor = cursor;\r\n    }\r\n};\r\nexport const setCursorForShape = (canvas, shape) => {\r\n    if (!canvas) {\r\n        return;\r\n    }\r\n    if (shape === \"selection\") {\r\n        resetCursor(canvas);\r\n        // do nothing if image tool is selected which suggests there's\r\n        // a image-preview set as the cursor\r\n    }\r\n    else if (shape !== \"image\") {\r\n        canvas.style.cursor = CURSOR_TYPE.CROSSHAIR;\r\n    }\r\n};\r\nexport const isFullScreen = () => document.fullscreenElement?.nodeName === \"HTML\";\r\nexport const allowFullScreen = () => document.documentElement.requestFullscreen();\r\nexport const exitFullScreen = () => document.exitFullscreen();\r\nexport const getShortcutKey = (shortcut) => {\r\n    shortcut = shortcut\r\n        .replace(/\\bAlt\\b/i, \"Alt\")\r\n        .replace(/\\bShift\\b/i, \"Shift\")\r\n        .replace(/\\b(Enter|Return)\\b/i, \"Enter\")\r\n        .replace(/\\bDel\\b/i, \"Delete\");\r\n    if (isDarwin) {\r\n        return shortcut\r\n            .replace(/\\bCtrlOrCmd\\b/i, \"Cmd\")\r\n            .replace(/\\bAlt\\b/i, \"Option\");\r\n    }\r\n    return shortcut.replace(/\\bCtrlOrCmd\\b/i, \"Ctrl\");\r\n};\r\nexport const viewportCoordsToSceneCoords = ({ clientX, clientY }, { zoom, offsetLeft, offsetTop, scrollX, scrollY, }) => {\r\n    const invScale = 1 / zoom.value;\r\n    const x = (clientX - zoom.translation.x - offsetLeft) * invScale - scrollX;\r\n    const y = (clientY - zoom.translation.y - offsetTop) * invScale - scrollY;\r\n    return { x, y };\r\n};\r\nexport const sceneCoordsToViewportCoords = ({ sceneX, sceneY }, { zoom, offsetLeft, offsetTop, scrollX, scrollY, }) => {\r\n    const x = (sceneX + scrollX + offsetLeft) * zoom.value + zoom.translation.x;\r\n    const y = (sceneY + scrollY + offsetTop) * zoom.value + zoom.translation.y;\r\n    return { x, y };\r\n};\r\nexport const getGlobalCSSVariable = (name) => getComputedStyle(document.documentElement).getPropertyValue(`--${name}`);\r\nconst RS_LTR_CHARS = \"A-Za-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02B8\\u0300-\\u0590\\u0800-\\u1FFF\" +\r\n    \"\\u2C00-\\uFB1C\\uFDFE-\\uFE6F\\uFEFD-\\uFFFF\";\r\nconst RS_RTL_CHARS = \"\\u0591-\\u07FF\\uFB1D-\\uFDFD\\uFE70-\\uFEFC\";\r\nconst RE_RTL_CHECK = new RegExp(`^[^${RS_LTR_CHARS}]*[${RS_RTL_CHARS}]`);\r\n/**\r\n * Checks whether first directional character is RTL. Meaning whether it starts\r\n *  with RTL characters, or indeterminate (numbers etc.) characters followed by\r\n *  RTL.\r\n * See https://github.com/excalidraw/excalidraw/pull/1722#discussion_r436340171\r\n */\r\nexport const isRTL = (text) => RE_RTL_CHECK.test(text);\r\nexport const tupleToCoors = (xyTuple) => {\r\n    const [x, y] = xyTuple;\r\n    return { x, y };\r\n};\r\n/** use as a rejectionHandler to mute filesystem Abort errors */\r\nexport const muteFSAbortError = (error) => {\r\n    if (error?.name === \"AbortError\") {\r\n        return;\r\n    }\r\n    throw error;\r\n};\r\nexport const findIndex = (array, cb, fromIndex = 0) => {\r\n    if (fromIndex < 0) {\r\n        fromIndex = array.length + fromIndex;\r\n    }\r\n    fromIndex = Math.min(array.length, Math.max(fromIndex, 0));\r\n    let index = fromIndex - 1;\r\n    while (++index < array.length) {\r\n        if (cb(array[index], index, array)) {\r\n            return index;\r\n        }\r\n    }\r\n    return -1;\r\n};\r\nexport const findLastIndex = (array, cb, fromIndex = array.length - 1) => {\r\n    if (fromIndex < 0) {\r\n        fromIndex = array.length + fromIndex;\r\n    }\r\n    fromIndex = Math.min(array.length - 1, Math.max(fromIndex, 0));\r\n    let index = fromIndex + 1;\r\n    while (--index > -1) {\r\n        if (cb(array[index], index, array)) {\r\n            return index;\r\n        }\r\n    }\r\n    return -1;\r\n};\r\nexport const isTransparent = (color) => {\r\n    const isRGBTransparent = color.length === 5 && color.substr(4, 1) === \"0\";\r\n    const isRRGGBBTransparent = color.length === 9 && color.substr(7, 2) === \"00\";\r\n    return (isRGBTransparent ||\r\n        isRRGGBBTransparent ||\r\n        color === colors.elementBackground[0]);\r\n};\r\nexport const resolvablePromise = () => {\r\n    let resolve;\r\n    let reject;\r\n    const promise = new Promise((_resolve, _reject) => {\r\n        resolve = _resolve;\r\n        reject = _reject;\r\n    });\r\n    promise.resolve = resolve;\r\n    promise.reject = reject;\r\n    return promise;\r\n};\r\n/**\r\n * @param func handler taking at most single parameter (event).\r\n */\r\nexport const withBatchedUpdates = (func) => ((event) => {\r\n    unstable_batchedUpdates(func, event);\r\n});\r\n//https://stackoverflow.com/a/9462382/8418\r\nexport const nFormatter = (num, digits) => {\r\n    const si = [\r\n        { value: 1, symbol: \"b\" },\r\n        { value: 1e3, symbol: \"k\" },\r\n        { value: 1e6, symbol: \"M\" },\r\n        { value: 1e9, symbol: \"G\" },\r\n    ];\r\n    const rx = /\\.0+$|(\\.[0-9]*[1-9])0+$/;\r\n    let index;\r\n    for (index = si.length - 1; index > 0; index--) {\r\n        if (num >= si[index].value) {\r\n            break;\r\n        }\r\n    }\r\n    return ((num / si[index].value).toFixed(digits).replace(rx, \"$1\") + si[index].symbol);\r\n};\r\nexport const getVersion = () => {\r\n    return (document.querySelector('meta[name=\"version\"]')?.content ||\r\n        DEFAULT_VERSION);\r\n};\r\n// Adapted from https://github.com/Modernizr/Modernizr/blob/master/feature-detects/emoji.js\r\nexport const supportsEmoji = () => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const ctx = canvas.getContext(\"2d\");\r\n    if (!ctx) {\r\n        return false;\r\n    }\r\n    const offset = 12;\r\n    ctx.fillStyle = \"#f00\";\r\n    ctx.textBaseline = \"top\";\r\n    ctx.font = \"32px Arial\";\r\n    // Modernizr used 🐨, but it is sort of supported on Windows 7.\r\n    // Luckily 😀 isn't supported.\r\n    ctx.fillText(\"😀\", 0, 0);\r\n    return ctx.getImageData(offset, offset, 1, 1).data[0] !== 0;\r\n};\r\nexport const getNearestScrollableContainer = (element) => {\r\n    let parent = element.parentElement;\r\n    while (parent) {\r\n        if (parent === document.body) {\r\n            return document;\r\n        }\r\n        const { overflowY } = window.getComputedStyle(parent);\r\n        const hasScrollableContent = parent.scrollHeight > parent.clientHeight;\r\n        if (hasScrollableContent &&\r\n            (overflowY === \"auto\" || overflowY === \"scroll\")) {\r\n            return parent;\r\n        }\r\n        parent = parent.parentElement;\r\n    }\r\n    return document;\r\n};\r\nexport const focusNearestParent = (element) => {\r\n    let parent = element.parentElement;\r\n    while (parent) {\r\n        if (parent.tabIndex > -1) {\r\n            parent.focus();\r\n            return;\r\n        }\r\n        parent = parent.parentElement;\r\n    }\r\n};\r\nexport const preventUnload = (event) => {\r\n    event.preventDefault();\r\n    // NOTE: modern browsers no longer allow showing a custom message here\r\n    event.returnValue = \"\";\r\n};\r\n","import oc from \"open-color\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_FONT_SIZE, DEFAULT_TEXT_ALIGN, EXPORT_SCALES, THEME, } from \"./constants\";\r\nimport { t } from \"./i18n\";\r\nimport { getDateTime } from \"./utils\";\r\nconst defaultExportScale = EXPORT_SCALES.includes(devicePixelRatio)\r\n    ? devicePixelRatio\r\n    : 1;\r\nexport const getDefaultAppState = () => {\r\n    return {\r\n        theme: THEME.LIGHT,\r\n        collaborators: new Map(),\r\n        currentChartType: \"bar\",\r\n        currentItemBackgroundColor: \"transparent\",\r\n        currentItemEndArrowhead: \"arrow\",\r\n        currentItemFillStyle: \"hachure\",\r\n        currentItemFontFamily: DEFAULT_FONT_FAMILY,\r\n        currentItemFontSize: DEFAULT_FONT_SIZE,\r\n        currentItemLinearStrokeSharpness: \"round\",\r\n        currentItemOpacity: 100,\r\n        currentItemRoughness: 1,\r\n        currentItemStartArrowhead: null,\r\n        currentItemStrokeColor: oc.black,\r\n        currentItemStrokeSharpness: \"sharp\",\r\n        currentItemStrokeStyle: \"solid\",\r\n        currentItemStrokeWidth: 1,\r\n        currentItemTextAlign: DEFAULT_TEXT_ALIGN,\r\n        cursorButton: \"up\",\r\n        draggingElement: null,\r\n        editingElement: null,\r\n        editingGroupId: null,\r\n        editingLinearElement: null,\r\n        elementLocked: false,\r\n        elementType: \"selection\",\r\n        errorMessage: null,\r\n        exportBackground: true,\r\n        exportScale: defaultExportScale,\r\n        exportEmbedScene: false,\r\n        exportWithDarkMode: false,\r\n        fileHandle: null,\r\n        gridSize: null,\r\n        isBindingEnabled: true,\r\n        isLibraryOpen: false,\r\n        isLoading: false,\r\n        isResizing: false,\r\n        isRotating: false,\r\n        lastPointerDownWith: \"mouse\",\r\n        multiElement: null,\r\n        name: `${t(\"labels.untitled\")}-${getDateTime()}`,\r\n        openMenu: null,\r\n        openPopup: null,\r\n        pasteDialog: { shown: false, data: null },\r\n        previousSelectedElementIds: {},\r\n        resizingElement: null,\r\n        scrolledOutside: false,\r\n        scrollX: 0,\r\n        scrollY: 0,\r\n        selectedElementIds: {},\r\n        selectedGroupIds: {},\r\n        selectionElement: null,\r\n        shouldCacheIgnoreZoom: false,\r\n        showHelpDialog: false,\r\n        showStats: false,\r\n        startBoundElement: null,\r\n        suggestedBindings: [],\r\n        toastMessage: null,\r\n        viewBackgroundColor: oc.white,\r\n        zenModeEnabled: false,\r\n        zoom: { value: 1, translation: { x: 0, y: 0 } },\r\n        viewModeEnabled: false,\r\n        pendingImageElement: null,\r\n    };\r\n};\r\n/**\r\n * Config containing all AppState keys. Used to determine whether given state\r\n *  prop should be stripped when exporting to given storage type.\r\n */\r\nconst APP_STATE_STORAGE_CONF = ((config) => config)({\r\n    theme: { browser: true, export: false, server: false },\r\n    collaborators: { browser: false, export: false, server: false },\r\n    currentChartType: { browser: true, export: false, server: false },\r\n    currentItemBackgroundColor: { browser: true, export: false, server: false },\r\n    currentItemEndArrowhead: { browser: true, export: false, server: false },\r\n    currentItemFillStyle: { browser: true, export: false, server: false },\r\n    currentItemFontFamily: { browser: true, export: false, server: false },\r\n    currentItemFontSize: { browser: true, export: false, server: false },\r\n    currentItemLinearStrokeSharpness: {\r\n        browser: true,\r\n        export: false,\r\n        server: false,\r\n    },\r\n    currentItemOpacity: { browser: true, export: false, server: false },\r\n    currentItemRoughness: { browser: true, export: false, server: false },\r\n    currentItemStartArrowhead: { browser: true, export: false, server: false },\r\n    currentItemStrokeColor: { browser: true, export: false, server: false },\r\n    currentItemStrokeSharpness: { browser: true, export: false, server: false },\r\n    currentItemStrokeStyle: { browser: true, export: false, server: false },\r\n    currentItemStrokeWidth: { browser: true, export: false, server: false },\r\n    currentItemTextAlign: { browser: true, export: false, server: false },\r\n    cursorButton: { browser: true, export: false, server: false },\r\n    draggingElement: { browser: false, export: false, server: false },\r\n    editingElement: { browser: false, export: false, server: false },\r\n    editingGroupId: { browser: true, export: false, server: false },\r\n    editingLinearElement: { browser: false, export: false, server: false },\r\n    elementLocked: { browser: true, export: false, server: false },\r\n    elementType: { browser: true, export: false, server: false },\r\n    errorMessage: { browser: false, export: false, server: false },\r\n    exportBackground: { browser: true, export: false, server: false },\r\n    exportEmbedScene: { browser: true, export: false, server: false },\r\n    exportScale: { browser: true, export: false, server: false },\r\n    exportWithDarkMode: { browser: true, export: false, server: false },\r\n    fileHandle: { browser: false, export: false, server: false },\r\n    gridSize: { browser: true, export: true, server: true },\r\n    height: { browser: false, export: false, server: false },\r\n    isBindingEnabled: { browser: false, export: false, server: false },\r\n    isLibraryOpen: { browser: false, export: false, server: false },\r\n    isLoading: { browser: false, export: false, server: false },\r\n    isResizing: { browser: false, export: false, server: false },\r\n    isRotating: { browser: false, export: false, server: false },\r\n    lastPointerDownWith: { browser: true, export: false, server: false },\r\n    multiElement: { browser: false, export: false, server: false },\r\n    name: { browser: true, export: false, server: false },\r\n    offsetLeft: { browser: false, export: false, server: false },\r\n    offsetTop: { browser: false, export: false, server: false },\r\n    openMenu: { browser: true, export: false, server: false },\r\n    openPopup: { browser: false, export: false, server: false },\r\n    pasteDialog: { browser: false, export: false, server: false },\r\n    previousSelectedElementIds: { browser: true, export: false, server: false },\r\n    resizingElement: { browser: false, export: false, server: false },\r\n    scrolledOutside: { browser: true, export: false, server: false },\r\n    scrollX: { browser: true, export: false, server: false },\r\n    scrollY: { browser: true, export: false, server: false },\r\n    selectedElementIds: { browser: true, export: false, server: false },\r\n    selectedGroupIds: { browser: true, export: false, server: false },\r\n    selectionElement: { browser: false, export: false, server: false },\r\n    shouldCacheIgnoreZoom: { browser: true, export: false, server: false },\r\n    showHelpDialog: { browser: false, export: false, server: false },\r\n    showStats: { browser: true, export: false, server: false },\r\n    startBoundElement: { browser: false, export: false, server: false },\r\n    suggestedBindings: { browser: false, export: false, server: false },\r\n    toastMessage: { browser: false, export: false, server: false },\r\n    viewBackgroundColor: { browser: true, export: true, server: true },\r\n    width: { browser: false, export: false, server: false },\r\n    zenModeEnabled: { browser: true, export: false, server: false },\r\n    zoom: { browser: true, export: false, server: false },\r\n    viewModeEnabled: { browser: false, export: false, server: false },\r\n    pendingImageElement: { browser: false, export: false, server: false },\r\n});\r\nconst _clearAppStateForStorage = (appState, exportType) => {\r\n    const stateForExport = {};\r\n    for (const key of Object.keys(appState)) {\r\n        const propConfig = APP_STATE_STORAGE_CONF[key];\r\n        if (propConfig?.[exportType]) {\r\n            const nextValue = appState[key];\r\n            // https://github.com/microsoft/TypeScript/issues/31445\r\n            stateForExport[key] = nextValue;\r\n        }\r\n    }\r\n    return stateForExport;\r\n};\r\nexport const clearAppStateForLocalStorage = (appState) => {\r\n    return _clearAppStateForStorage(appState, \"browser\");\r\n};\r\nexport const cleanAppStateForExport = (appState) => {\r\n    return _clearAppStateForStorage(appState, \"export\");\r\n};\r\nexport const clearAppStateForDatabase = (appState) => {\r\n    return _clearAppStateForStorage(appState, \"server\");\r\n};\r\n","import { useCallback, useState } from \"react\";\r\nexport const useCallbackRefState = () => {\r\n    const [refValue, setRefValue] = useState(null);\r\n    const refCallback = useCallback((value) => setRefValue(value), []);\r\n    return [refValue, refCallback];\r\n};\r\n","export const isGenericElement = (element) => {\r\n    return (element != null &&\r\n        (element.type === \"selection\" ||\r\n            element.type === \"rectangle\" ||\r\n            element.type === \"diamond\" ||\r\n            element.type === \"ellipse\"));\r\n};\r\nexport const isInitializedImageElement = (element) => {\r\n    return !!element && element.type === \"image\" && !!element.fileId;\r\n};\r\nexport const isImageElement = (element) => {\r\n    return !!element && element.type === \"image\";\r\n};\r\nexport const isTextElement = (element) => {\r\n    return element != null && element.type === \"text\";\r\n};\r\nexport const isFreeDrawElement = (element) => {\r\n    return element != null && isFreeDrawElementType(element.type);\r\n};\r\nexport const isFreeDrawElementType = (elementType) => {\r\n    return elementType === \"freedraw\";\r\n};\r\nexport const isLinearElement = (element) => {\r\n    return element != null && isLinearElementType(element.type);\r\n};\r\nexport const isLinearElementType = (elementType) => {\r\n    return (elementType === \"arrow\" || elementType === \"line\" // || elementType === \"freedraw\"\r\n    );\r\n};\r\nexport const isBindingElement = (element) => {\r\n    return element != null && isBindingElementType(element.type);\r\n};\r\nexport const isBindingElementType = (elementType) => {\r\n    return elementType === \"arrow\";\r\n};\r\nexport const isBindableElement = (element) => {\r\n    return (element != null &&\r\n        (element.type === \"rectangle\" ||\r\n            element.type === \"diamond\" ||\r\n            element.type === \"ellipse\" ||\r\n            element.type === \"text\"));\r\n};\r\nexport const isExcalidrawElement = (element) => {\r\n    return (element?.type === \"text\" ||\r\n        element?.type === \"diamond\" ||\r\n        element?.type === \"rectangle\" ||\r\n        element?.type === \"ellipse\" ||\r\n        element?.type === \"arrow\" ||\r\n        element?.type === \"freedraw\" ||\r\n        element?.type === \"line\");\r\n};\r\n","import { LINE_CONFIRM_THRESHOLD } from \"./constants\";\r\nexport const rotate = (x1, y1, x2, y2, angle) => \r\n// 𝑎′𝑥=(𝑎𝑥−𝑐𝑥)cos𝜃−(𝑎𝑦−𝑐𝑦)sin𝜃+𝑐𝑥\r\n// 𝑎′𝑦=(𝑎𝑥−𝑐𝑥)sin𝜃+(𝑎𝑦−𝑐𝑦)cos𝜃+𝑐𝑦.\r\n// https://math.stackexchange.com/questions/2204520/how-do-i-rotate-a-line-segment-in-a-specific-point-on-the-line\r\n[\r\n    (x1 - x2) * Math.cos(angle) - (y1 - y2) * Math.sin(angle) + x2,\r\n    (x1 - x2) * Math.sin(angle) + (y1 - y2) * Math.cos(angle) + y2,\r\n];\r\nexport const rotatePoint = (point, center, angle) => rotate(point[0], point[1], center[0], center[1], angle);\r\nexport const adjustXYWithRotation = (sides, x, y, angle, deltaX1, deltaY1, deltaX2, deltaY2) => {\r\n    const cos = Math.cos(angle);\r\n    const sin = Math.sin(angle);\r\n    if (sides.e && sides.w) {\r\n        x += deltaX1 + deltaX2;\r\n    }\r\n    else if (sides.e) {\r\n        x += deltaX1 * (1 + cos);\r\n        y += deltaX1 * sin;\r\n        x += deltaX2 * (1 - cos);\r\n        y += deltaX2 * -sin;\r\n    }\r\n    else if (sides.w) {\r\n        x += deltaX1 * (1 - cos);\r\n        y += deltaX1 * -sin;\r\n        x += deltaX2 * (1 + cos);\r\n        y += deltaX2 * sin;\r\n    }\r\n    if (sides.n && sides.s) {\r\n        y += deltaY1 + deltaY2;\r\n    }\r\n    else if (sides.n) {\r\n        x += deltaY1 * sin;\r\n        y += deltaY1 * (1 - cos);\r\n        x += deltaY2 * -sin;\r\n        y += deltaY2 * (1 + cos);\r\n    }\r\n    else if (sides.s) {\r\n        x += deltaY1 * -sin;\r\n        y += deltaY1 * (1 + cos);\r\n        x += deltaY2 * sin;\r\n        y += deltaY2 * (1 - cos);\r\n    }\r\n    return [x, y];\r\n};\r\nexport const getPointOnAPath = (point, path) => {\r\n    const [px, py] = point;\r\n    const [start, ...other] = path;\r\n    let [lastX, lastY] = start;\r\n    let kLine = 0;\r\n    let idx = 0;\r\n    // if any item in the array is true, it means that a point is\r\n    // on some segment of a line based path\r\n    const retVal = other.some(([x2, y2], i) => {\r\n        // we always take a line when dealing with line segments\r\n        const x1 = lastX;\r\n        const y1 = lastY;\r\n        lastX = x2;\r\n        lastY = y2;\r\n        // if a point is not within the domain of the line segment\r\n        // it is not on the line segment\r\n        if (px < x1 || px > x2) {\r\n            return false;\r\n        }\r\n        // check if all points lie on the same line\r\n        // y1 = kx1 + b, y2 = kx2 + b\r\n        // y2 - y1 = k(x2 - x2) -> k = (y2 - y1) / (x2 - x1)\r\n        // coefficient for the line (p0, p1)\r\n        const kL = (y2 - y1) / (x2 - x1);\r\n        // coefficient for the line segment (p0, point)\r\n        const kP1 = (py - y1) / (px - x1);\r\n        // coefficient for the line segment (point, p1)\r\n        const kP2 = (py - y2) / (px - x2);\r\n        // because we are basing both lines from the same starting point\r\n        // the only option for collinearity is having same coefficients\r\n        // using it for floating point comparisons\r\n        const epsilon = 0.3;\r\n        // if coefficient is more than an arbitrary epsilon,\r\n        // these lines are nor collinear\r\n        if (Math.abs(kP1 - kL) > epsilon && Math.abs(kP2 - kL) > epsilon) {\r\n            return false;\r\n        }\r\n        // store the coefficient because we are goint to need it\r\n        kLine = kL;\r\n        idx = i;\r\n        return true;\r\n    });\r\n    // Return a coordinate that is always on the line segment\r\n    if (retVal === true) {\r\n        return { x: point[0], y: kLine * point[0], segment: idx };\r\n    }\r\n    return null;\r\n};\r\nexport const distance2d = (x1, y1, x2, y2) => {\r\n    const xd = x2 - x1;\r\n    const yd = y2 - y1;\r\n    return Math.hypot(xd, yd);\r\n};\r\nexport const centerPoint = (a, b) => {\r\n    return [(a[0] + b[0]) / 2, (a[1] + b[1]) / 2];\r\n};\r\n// Checks if the first and last point are close enough\r\n// to be considered a loop\r\nexport const isPathALoop = (points, \r\n/** supply if you want the loop detection to account for current zoom */\r\nzoomValue = 1) => {\r\n    if (points.length >= 3) {\r\n        const [first, last] = [points[0], points[points.length - 1]];\r\n        const distance = distance2d(first[0], first[1], last[0], last[1]);\r\n        // Adjusting LINE_CONFIRM_THRESHOLD to current zoom so that when zoomed in\r\n        // really close we make the threshold smaller, and vice versa.\r\n        return distance <= LINE_CONFIRM_THRESHOLD / zoomValue;\r\n    }\r\n    return false;\r\n};\r\n// Draw a line from the point to the right till infiinty\r\n// Check how many lines of the polygon does this infinite line intersects with\r\n// If the number of intersections is odd, point is in the polygon\r\nexport const isPointInPolygon = (points, x, y) => {\r\n    const vertices = points.length;\r\n    // There must be at least 3 vertices in polygon\r\n    if (vertices < 3) {\r\n        return false;\r\n    }\r\n    const extreme = [Number.MAX_SAFE_INTEGER, y];\r\n    const p = [x, y];\r\n    let count = 0;\r\n    for (let i = 0; i < vertices; i++) {\r\n        const current = points[i];\r\n        const next = points[(i + 1) % vertices];\r\n        if (doSegmentsIntersect(current, next, p, extreme)) {\r\n            if (orderedColinearOrientation(current, p, next) === 0) {\r\n                return isPointWithinBounds(current, p, next);\r\n            }\r\n            count++;\r\n        }\r\n    }\r\n    // true if count is off\r\n    return count % 2 === 1;\r\n};\r\n// Returns whether `q` lies inside the segment/rectangle defined by `p` and `r`.\r\n// This is an approximation to \"does `q` lie on a segment `pr`\" check.\r\nconst isPointWithinBounds = (p, q, r) => {\r\n    return (q[0] <= Math.max(p[0], r[0]) &&\r\n        q[0] >= Math.min(p[0], r[0]) &&\r\n        q[1] <= Math.max(p[1], r[1]) &&\r\n        q[1] >= Math.min(p[1], r[1]));\r\n};\r\n// For the ordered points p, q, r, return\r\n// 0 if p, q, r are colinear\r\n// 1 if Clockwise\r\n// 2 if counterclickwise\r\nconst orderedColinearOrientation = (p, q, r) => {\r\n    const val = (q[1] - p[1]) * (r[0] - q[0]) - (q[0] - p[0]) * (r[1] - q[1]);\r\n    if (val === 0) {\r\n        return 0;\r\n    }\r\n    return val > 0 ? 1 : 2;\r\n};\r\n// Check is p1q1 intersects with p2q2\r\nconst doSegmentsIntersect = (p1, q1, p2, q2) => {\r\n    const o1 = orderedColinearOrientation(p1, q1, p2);\r\n    const o2 = orderedColinearOrientation(p1, q1, q2);\r\n    const o3 = orderedColinearOrientation(p2, q2, p1);\r\n    const o4 = orderedColinearOrientation(p2, q2, q1);\r\n    if (o1 !== o2 && o3 !== o4) {\r\n        return true;\r\n    }\r\n    // p1, q1 and p2 are colinear and p2 lies on segment p1q1\r\n    if (o1 === 0 && isPointWithinBounds(p1, p2, q1)) {\r\n        return true;\r\n    }\r\n    // p1, q1 and p2 are colinear and q2 lies on segment p1q1\r\n    if (o2 === 0 && isPointWithinBounds(p1, q2, q1)) {\r\n        return true;\r\n    }\r\n    // p2, q2 and p1 are colinear and p1 lies on segment p2q2\r\n    if (o3 === 0 && isPointWithinBounds(p2, p1, q2)) {\r\n        return true;\r\n    }\r\n    // p2, q2 and q1 are colinear and q1 lies on segment p2q2\r\n    if (o4 === 0 && isPointWithinBounds(p2, q1, q2)) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\n// TODO: Rounding this point causes some shake when free drawing\r\nexport const getGridPoint = (x, y, gridSize) => {\r\n    if (gridSize) {\r\n        return [\r\n            Math.round(x / gridSize) * gridSize,\r\n            Math.round(y / gridSize) * gridSize,\r\n        ];\r\n    }\r\n    return [x, y];\r\n};\r\n","export const getSizeFromPoints = (points) => {\r\n    const xs = points.map((point) => point[0]);\r\n    const ys = points.map((point) => point[1]);\r\n    return {\r\n        width: Math.max(...xs) - Math.min(...xs),\r\n        height: Math.max(...ys) - Math.min(...ys),\r\n    };\r\n};\r\nexport const rescalePoints = (dimension, nextDimensionSize, prevPoints) => {\r\n    const prevDimValues = prevPoints.map((point) => point[dimension]);\r\n    const prevMaxDimension = Math.max(...prevDimValues);\r\n    const prevMinDimension = Math.min(...prevDimValues);\r\n    const prevDimensionSize = prevMaxDimension - prevMinDimension;\r\n    const dimensionScaleFactor = prevDimensionSize === 0 ? 1 : nextDimensionSize / prevDimensionSize;\r\n    let nextMinDimension = Infinity;\r\n    const scaledPoints = prevPoints.map((prevPoint) => prevPoint.map((value, currentDimension) => {\r\n        if (currentDimension !== dimension) {\r\n            return value;\r\n        }\r\n        const scaledValue = value * dimensionScaleFactor;\r\n        nextMinDimension = Math.min(scaledValue, nextMinDimension);\r\n        return scaledValue;\r\n    }));\r\n    if (scaledPoints.length === 2) {\r\n        // we don't tranlate two-point lines\r\n        return scaledPoints;\r\n    }\r\n    const translation = prevMinDimension - nextMinDimension;\r\n    const nextPoints = scaledPoints.map((scaledPoint) => scaledPoint.map((value, currentDimension) => {\r\n        return currentDimension === dimension ? value + translation : value;\r\n    }));\r\n    return nextPoints;\r\n};\r\n","import { distance2d, rotate } from \"../math\";\r\nimport rough from \"roughjs/bin/rough\";\r\nimport { getShapeForElement, generateRoughOptions, } from \"../renderer/renderElement\";\r\nimport { isFreeDrawElement, isLinearElement } from \"./typeChecks\";\r\nimport { rescalePoints } from \"../points\";\r\n// If the element is created from right to left, the width is going to be negative\r\n// This set of functions retrieves the absolute position of the 4 points.\r\nexport const getElementAbsoluteCoords = (element) => {\r\n    if (isFreeDrawElement(element)) {\r\n        return getFreeDrawElementAbsoluteCoords(element);\r\n    }\r\n    else if (isLinearElement(element)) {\r\n        return getLinearElementAbsoluteCoords(element);\r\n    }\r\n    return [\r\n        element.x,\r\n        element.y,\r\n        element.x + element.width,\r\n        element.y + element.height,\r\n    ];\r\n};\r\nexport const pointRelativeTo = (element, absoluteCoords) => {\r\n    return [absoluteCoords[0] - element.x, absoluteCoords[1] - element.y];\r\n};\r\nexport const getDiamondPoints = (element) => {\r\n    // Here we add +1 to avoid these numbers to be 0\r\n    // otherwise rough.js will throw an error complaining about it\r\n    const topX = Math.floor(element.width / 2) + 1;\r\n    const topY = 0;\r\n    const rightX = element.width;\r\n    const rightY = Math.floor(element.height / 2) + 1;\r\n    const bottomX = topX;\r\n    const bottomY = element.height;\r\n    const leftX = 0;\r\n    const leftY = rightY;\r\n    return [topX, topY, rightX, rightY, bottomX, bottomY, leftX, leftY];\r\n};\r\nexport const getCurvePathOps = (shape) => {\r\n    for (const set of shape.sets) {\r\n        if (set.type === \"path\") {\r\n            return set.ops;\r\n        }\r\n    }\r\n    return shape.sets[0].ops;\r\n};\r\nconst getMinMaxXYFromCurvePathOps = (ops, transformXY) => {\r\n    let currentP = [0, 0];\r\n    const { minX, minY, maxX, maxY } = ops.reduce((limits, { op, data }) => {\r\n        // There are only four operation types:\r\n        // move, bcurveTo, lineTo, and curveTo\r\n        if (op === \"move\") {\r\n            // change starting point\r\n            currentP = data;\r\n            // move operation does not draw anything; so, it always\r\n            // returns false\r\n        }\r\n        else if (op === \"bcurveTo\") {\r\n            // create points from bezier curve\r\n            // bezier curve stores data as a flattened array of three positions\r\n            // [x1, y1, x2, y2, x3, y3]\r\n            const p1 = [data[0], data[1]];\r\n            const p2 = [data[2], data[3]];\r\n            const p3 = [data[4], data[5]];\r\n            const p0 = currentP;\r\n            currentP = p3;\r\n            const equation = (t, idx) => Math.pow(1 - t, 3) * p3[idx] +\r\n                3 * t * Math.pow(1 - t, 2) * p2[idx] +\r\n                3 * Math.pow(t, 2) * (1 - t) * p1[idx] +\r\n                p0[idx] * Math.pow(t, 3);\r\n            let t = 0;\r\n            while (t <= 1.0) {\r\n                let x = equation(t, 0);\r\n                let y = equation(t, 1);\r\n                if (transformXY) {\r\n                    [x, y] = transformXY(x, y);\r\n                }\r\n                limits.minY = Math.min(limits.minY, y);\r\n                limits.minX = Math.min(limits.minX, x);\r\n                limits.maxX = Math.max(limits.maxX, x);\r\n                limits.maxY = Math.max(limits.maxY, y);\r\n                t += 0.1;\r\n            }\r\n        }\r\n        else if (op === \"lineTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        else if (op === \"qcurveTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        return limits;\r\n    }, { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n    return [minX, minY, maxX, maxY];\r\n};\r\nconst getBoundsFromPoints = (points) => {\r\n    let minX = Infinity;\r\n    let minY = Infinity;\r\n    let maxX = -Infinity;\r\n    let maxY = -Infinity;\r\n    for (const [x, y] of points) {\r\n        minX = Math.min(minX, x);\r\n        minY = Math.min(minY, y);\r\n        maxX = Math.max(maxX, x);\r\n        maxY = Math.max(maxY, y);\r\n    }\r\n    return [minX, minY, maxX, maxY];\r\n};\r\nconst getFreeDrawElementAbsoluteCoords = (element) => {\r\n    const [minX, minY, maxX, maxY] = getBoundsFromPoints(element.points);\r\n    return [\r\n        minX + element.x,\r\n        minY + element.y,\r\n        maxX + element.x,\r\n        maxY + element.y,\r\n    ];\r\n};\r\nconst getLinearElementAbsoluteCoords = (element) => {\r\n    let coords;\r\n    if (element.points.length < 2 || !getShapeForElement(element)) {\r\n        // XXX this is just a poor estimate and not very useful\r\n        const { minX, minY, maxX, maxY } = element.points.reduce((limits, [x, y]) => {\r\n            limits.minY = Math.min(limits.minY, y);\r\n            limits.minX = Math.min(limits.minX, x);\r\n            limits.maxX = Math.max(limits.maxX, x);\r\n            limits.maxY = Math.max(limits.maxY, y);\r\n            return limits;\r\n        }, { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n        coords = [\r\n            minX + element.x,\r\n            minY + element.y,\r\n            maxX + element.x,\r\n            maxY + element.y,\r\n        ];\r\n    }\r\n    else {\r\n        const shape = getShapeForElement(element);\r\n        // first element is always the curve\r\n        const ops = getCurvePathOps(shape[0]);\r\n        const [minX, minY, maxX, maxY] = getMinMaxXYFromCurvePathOps(ops);\r\n        coords = [\r\n            minX + element.x,\r\n            minY + element.y,\r\n            maxX + element.x,\r\n            maxY + element.y,\r\n        ];\r\n    }\r\n    return coords;\r\n};\r\nexport const getArrowheadPoints = (element, shape, position, arrowhead) => {\r\n    const ops = getCurvePathOps(shape[0]);\r\n    if (ops.length < 1) {\r\n        return null;\r\n    }\r\n    // The index of the bCurve operation to examine.\r\n    const index = position === \"start\" ? 1 : ops.length - 1;\r\n    const data = ops[index].data;\r\n    const p3 = [data[4], data[5]];\r\n    const p2 = [data[2], data[3]];\r\n    const p1 = [data[0], data[1]];\r\n    // We need to find p0 of the bezier curve.\r\n    // It is typically the last point of the previous\r\n    // curve; it can also be the position of moveTo operation.\r\n    const prevOp = ops[index - 1];\r\n    let p0 = [0, 0];\r\n    if (prevOp.op === \"move\") {\r\n        p0 = prevOp.data;\r\n    }\r\n    else if (prevOp.op === \"bcurveTo\") {\r\n        p0 = [prevOp.data[4], prevOp.data[5]];\r\n    }\r\n    // B(t) = p0 * (1-t)^3 + 3p1 * t * (1-t)^2 + 3p2 * t^2 * (1-t) + p3 * t^3\r\n    const equation = (t, idx) => Math.pow(1 - t, 3) * p3[idx] +\r\n        3 * t * Math.pow(1 - t, 2) * p2[idx] +\r\n        3 * Math.pow(t, 2) * (1 - t) * p1[idx] +\r\n        p0[idx] * Math.pow(t, 3);\r\n    // Ee know the last point of the arrow (or the first, if start arrowhead).\r\n    const [x2, y2] = position === \"start\" ? p0 : p3;\r\n    // By using cubic bezier equation (B(t)) and the given parameters,\r\n    // we calculate a point that is closer to the last point.\r\n    // The value 0.3 is chosen arbitrarily and it works best for all\r\n    // the tested cases.\r\n    const [x1, y1] = [equation(0.3, 0), equation(0.3, 1)];\r\n    // Find the normalized direction vector based on the\r\n    // previously calculated points.\r\n    const distance = Math.hypot(x2 - x1, y2 - y1);\r\n    const nx = (x2 - x1) / distance;\r\n    const ny = (y2 - y1) / distance;\r\n    const size = {\r\n        arrow: 30,\r\n        bar: 15,\r\n        dot: 15,\r\n        triangle: 15,\r\n    }[arrowhead]; // pixels (will differ for each arrowhead)\r\n    let length = 0;\r\n    if (arrowhead === \"arrow\") {\r\n        // Length for -> arrows is based on the length of the last section\r\n        const [cx, cy] = element.points[element.points.length - 1];\r\n        const [px, py] = element.points.length > 1\r\n            ? element.points[element.points.length - 2]\r\n            : [0, 0];\r\n        length = Math.hypot(cx - px, cy - py);\r\n    }\r\n    else {\r\n        // Length for other arrowhead types is based on the total length of the line\r\n        for (let i = 0; i < element.points.length; i++) {\r\n            const [px, py] = element.points[i - 1] || [0, 0];\r\n            const [cx, cy] = element.points[i];\r\n            length += Math.hypot(cx - px, cy - py);\r\n        }\r\n    }\r\n    // Scale down the arrowhead until we hit a certain size so that it doesn't look weird.\r\n    // This value is selected by minimizing a minimum size with the last segment of the arrowhead\r\n    const minSize = Math.min(size, length / 2);\r\n    const xs = x2 - nx * minSize;\r\n    const ys = y2 - ny * minSize;\r\n    if (arrowhead === \"dot\") {\r\n        const r = Math.hypot(ys - y2, xs - x2) + element.strokeWidth;\r\n        return [x2, y2, r];\r\n    }\r\n    const angle = {\r\n        arrow: 20,\r\n        bar: 90,\r\n        triangle: 25,\r\n    }[arrowhead]; // degrees\r\n    // Return points\r\n    const [x3, y3] = rotate(xs, ys, x2, y2, (-angle * Math.PI) / 180);\r\n    const [x4, y4] = rotate(xs, ys, x2, y2, (angle * Math.PI) / 180);\r\n    return [x2, y2, x3, y3, x4, y4];\r\n};\r\nconst getLinearElementRotatedBounds = (element, cx, cy) => {\r\n    if (element.points.length < 2 || !getShapeForElement(element)) {\r\n        // XXX this is just a poor estimate and not very useful\r\n        const { minX, minY, maxX, maxY } = element.points.reduce((limits, [x, y]) => {\r\n            [x, y] = rotate(element.x + x, element.y + y, cx, cy, element.angle);\r\n            limits.minY = Math.min(limits.minY, y);\r\n            limits.minX = Math.min(limits.minX, x);\r\n            limits.maxX = Math.max(limits.maxX, x);\r\n            limits.maxY = Math.max(limits.maxY, y);\r\n            return limits;\r\n        }, { minX: Infinity, minY: Infinity, maxX: -Infinity, maxY: -Infinity });\r\n        return [minX, minY, maxX, maxY];\r\n    }\r\n    const shape = getShapeForElement(element);\r\n    // first element is always the curve\r\n    const ops = getCurvePathOps(shape[0]);\r\n    const transformXY = (x, y) => rotate(element.x + x, element.y + y, cx, cy, element.angle);\r\n    return getMinMaxXYFromCurvePathOps(ops, transformXY);\r\n};\r\n// We could cache this stuff\r\nexport const getElementBounds = (element) => {\r\n    let bounds;\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    if (isFreeDrawElement(element)) {\r\n        const [minX, minY, maxX, maxY] = getBoundsFromPoints(element.points.map(([x, y]) => rotate(x, y, cx - element.x, cy - element.y, element.angle)));\r\n        return [\r\n            minX + element.x,\r\n            minY + element.y,\r\n            maxX + element.x,\r\n            maxY + element.y,\r\n        ];\r\n    }\r\n    else if (isLinearElement(element)) {\r\n        bounds = getLinearElementRotatedBounds(element, cx, cy);\r\n    }\r\n    else if (element.type === \"diamond\") {\r\n        const [x11, y11] = rotate(cx, y1, cx, cy, element.angle);\r\n        const [x12, y12] = rotate(cx, y2, cx, cy, element.angle);\r\n        const [x22, y22] = rotate(x1, cy, cx, cy, element.angle);\r\n        const [x21, y21] = rotate(x2, cy, cx, cy, element.angle);\r\n        const minX = Math.min(x11, x12, x22, x21);\r\n        const minY = Math.min(y11, y12, y22, y21);\r\n        const maxX = Math.max(x11, x12, x22, x21);\r\n        const maxY = Math.max(y11, y12, y22, y21);\r\n        bounds = [minX, minY, maxX, maxY];\r\n    }\r\n    else if (element.type === \"ellipse\") {\r\n        const w = (x2 - x1) / 2;\r\n        const h = (y2 - y1) / 2;\r\n        const cos = Math.cos(element.angle);\r\n        const sin = Math.sin(element.angle);\r\n        const ww = Math.hypot(w * cos, h * sin);\r\n        const hh = Math.hypot(h * cos, w * sin);\r\n        bounds = [cx - ww, cy - hh, cx + ww, cy + hh];\r\n    }\r\n    else {\r\n        const [x11, y11] = rotate(x1, y1, cx, cy, element.angle);\r\n        const [x12, y12] = rotate(x1, y2, cx, cy, element.angle);\r\n        const [x22, y22] = rotate(x2, y2, cx, cy, element.angle);\r\n        const [x21, y21] = rotate(x2, y1, cx, cy, element.angle);\r\n        const minX = Math.min(x11, x12, x22, x21);\r\n        const minY = Math.min(y11, y12, y22, y21);\r\n        const maxX = Math.max(x11, x12, x22, x21);\r\n        const maxY = Math.max(y11, y12, y22, y21);\r\n        bounds = [minX, minY, maxX, maxY];\r\n    }\r\n    return bounds;\r\n};\r\nexport const getCommonBounds = (elements) => {\r\n    if (!elements.length) {\r\n        return [0, 0, 0, 0];\r\n    }\r\n    let minX = Infinity;\r\n    let maxX = -Infinity;\r\n    let minY = Infinity;\r\n    let maxY = -Infinity;\r\n    elements.forEach((element) => {\r\n        const [x1, y1, x2, y2] = getElementBounds(element);\r\n        minX = Math.min(minX, x1);\r\n        minY = Math.min(minY, y1);\r\n        maxX = Math.max(maxX, x2);\r\n        maxY = Math.max(maxY, y2);\r\n    });\r\n    return [minX, minY, maxX, maxY];\r\n};\r\nexport const getResizedElementAbsoluteCoords = (element, nextWidth, nextHeight) => {\r\n    if (!(isLinearElement(element) || isFreeDrawElement(element))) {\r\n        return [\r\n            element.x,\r\n            element.y,\r\n            element.x + nextWidth,\r\n            element.y + nextHeight,\r\n        ];\r\n    }\r\n    const points = rescalePoints(0, nextWidth, rescalePoints(1, nextHeight, element.points));\r\n    let bounds;\r\n    if (isFreeDrawElement(element)) {\r\n        // Free Draw\r\n        bounds = getBoundsFromPoints(points);\r\n    }\r\n    else {\r\n        // Line\r\n        const gen = rough.generator();\r\n        const curve = element.strokeSharpness === \"sharp\"\r\n            ? gen.linearPath(points, generateRoughOptions(element))\r\n            : gen.curve(points, generateRoughOptions(element));\r\n        const ops = getCurvePathOps(curve);\r\n        bounds = getMinMaxXYFromCurvePathOps(ops);\r\n    }\r\n    const [minX, minY, maxX, maxY] = bounds;\r\n    return [\r\n        minX + element.x,\r\n        minY + element.y,\r\n        maxX + element.x,\r\n        maxY + element.y,\r\n    ];\r\n};\r\nexport const getElementPointsCoords = (element, points, sharpness) => {\r\n    // This might be computationally heavey\r\n    const gen = rough.generator();\r\n    const curve = sharpness === \"sharp\"\r\n        ? gen.linearPath(points, generateRoughOptions(element))\r\n        : gen.curve(points, generateRoughOptions(element));\r\n    const ops = getCurvePathOps(curve);\r\n    const [minX, minY, maxX, maxY] = getMinMaxXYFromCurvePathOps(ops);\r\n    return [\r\n        minX + element.x,\r\n        minY + element.y,\r\n        maxX + element.x,\r\n        maxY + element.y,\r\n    ];\r\n};\r\nexport const getClosestElementBounds = (elements, from) => {\r\n    if (!elements.length) {\r\n        return [0, 0, 0, 0];\r\n    }\r\n    let minDistance = Infinity;\r\n    let closestElement = elements[0];\r\n    elements.forEach((element) => {\r\n        const [x1, y1, x2, y2] = getElementBounds(element);\r\n        const distance = distance2d((x1 + x2) / 2, (y1 + y2) / 2, from.x, from.y);\r\n        if (distance < minDistance) {\r\n            minDistance = distance;\r\n            closestElement = element;\r\n        }\r\n    });\r\n    return getElementBounds(closestElement);\r\n};\r\n","import { isTextElement, isLinearElement, isFreeDrawElement, isInitializedImageElement, } from \"../element/typeChecks\";\r\nimport { getDiamondPoints, getElementAbsoluteCoords, getArrowheadPoints, } from \"../element/bounds\";\r\nimport { distance, getFontString, getFontFamilyString, isRTL } from \"../utils\";\r\nimport { isPathALoop } from \"../math\";\r\nimport rough from \"roughjs/bin/rough\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { MAX_DECIMALS_FOR_SVG_EXPORT, MIME_TYPES, SVG_NS } from \"../constants\";\r\nimport { getStroke } from \"perfect-freehand\";\r\nconst defaultAppState = getDefaultAppState();\r\nconst isPendingImageElement = (element, sceneState) => isInitializedImageElement(element) &&\r\n    !sceneState.imageCache.has(element.fileId);\r\nconst getDashArrayDashed = (strokeWidth) => [8, 8 + strokeWidth];\r\nconst getDashArrayDotted = (strokeWidth) => [1.5, 6 + strokeWidth];\r\nconst getCanvasPadding = (element) => element.type === \"freedraw\" ? element.strokeWidth * 12 : 20;\r\nconst generateElementCanvas = (element, zoom, sceneState) => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    const context = canvas.getContext(\"2d\");\r\n    const padding = getCanvasPadding(element);\r\n    let canvasOffsetX = 0;\r\n    let canvasOffsetY = 0;\r\n    if (isLinearElement(element) || isFreeDrawElement(element)) {\r\n        let [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        x1 = Math.floor(x1);\r\n        x2 = Math.ceil(x2);\r\n        y1 = Math.floor(y1);\r\n        y2 = Math.ceil(y2);\r\n        canvas.width =\r\n            distance(x1, x2) * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n        canvas.height =\r\n            distance(y1, y2) * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n        canvasOffsetX =\r\n            element.x > x1\r\n                ? Math.floor(distance(element.x, x1)) *\r\n                    window.devicePixelRatio *\r\n                    zoom.value\r\n                : 0;\r\n        canvasOffsetY =\r\n            element.y > y1\r\n                ? Math.floor(distance(element.y, y1)) *\r\n                    window.devicePixelRatio *\r\n                    zoom.value\r\n                : 0;\r\n        context.translate(canvasOffsetX, canvasOffsetY);\r\n    }\r\n    else {\r\n        canvas.width =\r\n            element.width * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n        canvas.height =\r\n            element.height * window.devicePixelRatio * zoom.value +\r\n                padding * zoom.value * 2;\r\n    }\r\n    context.save();\r\n    context.translate(padding * zoom.value, padding * zoom.value);\r\n    context.scale(window.devicePixelRatio * zoom.value, window.devicePixelRatio * zoom.value);\r\n    const rc = rough.canvas(canvas);\r\n    if (sceneState.theme === \"dark\" &&\r\n        isInitializedImageElement(element) &&\r\n        !isPendingImageElement(element, sceneState) &&\r\n        sceneState.imageCache.get(element.fileId)?.mimeType !== MIME_TYPES.svg) {\r\n        // using a stronger invert (100% vs our regular 93%) and saturate\r\n        // as a temp hack to make images in dark theme look closer to original\r\n        // color scheme (it's still not quite there and the clors look slightly\r\n        // desaturing/black is not as black, but...)\r\n        context.filter = \"invert(100%) hue-rotate(180deg) saturate(1.25)\";\r\n    }\r\n    drawElementOnCanvas(element, rc, context, sceneState);\r\n    context.restore();\r\n    return {\r\n        element,\r\n        canvas,\r\n        theme: sceneState.theme,\r\n        canvasZoom: zoom.value,\r\n        canvasOffsetX,\r\n        canvasOffsetY,\r\n    };\r\n};\r\nconst IMAGE_PLACEHOLDER_IMG = document.createElement(\"img\");\r\nIMAGE_PLACEHOLDER_IMG.src = `data:${MIME_TYPES.svg},${encodeURIComponent(`<svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"image\" class=\"svg-inline--fa fa-image fa-w-16\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 512 512\"><path fill=\"#888\" d=\"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48zM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56zM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48z\"></path></svg>`)}`;\r\nconst IMAGE_ERROR_PLACEHOLDER_IMG = document.createElement(\"img\");\r\nIMAGE_ERROR_PLACEHOLDER_IMG.src = `data:${MIME_TYPES.svg},${encodeURIComponent(`<svg viewBox=\"0 0 668 668\" xmlns=\"http://www.w3.org/2000/svg\" xml:space=\"preserve\" style=\"fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2\"><path d=\"M464 448H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h416c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48ZM112 120c-30.928 0-56 25.072-56 56s25.072 56 56 56 56-25.072 56-56-25.072-56-56-56ZM64 384h384V272l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L208 320l-55.515-55.515c-4.686-4.686-12.284-4.686-16.971 0L64 336v48Z\" style=\"fill:#888;fill-rule:nonzero\" transform=\"matrix(.81709 0 0 .81709 124.825 145.825)\"/><path d=\"M256 8C119.034 8 8 119.033 8 256c0 136.967 111.034 248 248 248s248-111.034 248-248S392.967 8 256 8Zm130.108 117.892c65.448 65.448 70 165.481 20.677 235.637L150.47 105.216c70.204-49.356 170.226-44.735 235.638 20.676ZM125.892 386.108c-65.448-65.448-70-165.481-20.677-235.637L361.53 406.784c-70.203 49.356-170.226 44.736-235.638-20.676Z\" style=\"fill:#888;fill-rule:nonzero\" transform=\"matrix(.30366 0 0 .30366 506.822 60.065)\"/></svg>`)}`;\r\nconst drawImagePlaceholder = (element, context, zoomValue) => {\r\n    context.fillStyle = \"#E7E7E7\";\r\n    context.fillRect(0, 0, element.width, element.height);\r\n    const imageMinWidthOrHeight = Math.min(element.width, element.height);\r\n    const size = Math.min(imageMinWidthOrHeight, Math.min(imageMinWidthOrHeight * 0.4, 100));\r\n    context.drawImage(element.status === \"error\"\r\n        ? IMAGE_ERROR_PLACEHOLDER_IMG\r\n        : IMAGE_PLACEHOLDER_IMG, element.width / 2 - size / 2, element.height / 2 - size / 2, size, size);\r\n};\r\nconst drawElementOnCanvas = (element, rc, context, sceneState) => {\r\n    context.globalAlpha = element.opacity / 100;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\": {\r\n            context.lineJoin = \"round\";\r\n            context.lineCap = \"round\";\r\n            rc.draw(getShapeForElement(element));\r\n            break;\r\n        }\r\n        case \"arrow\":\r\n        case \"line\": {\r\n            context.lineJoin = \"round\";\r\n            context.lineCap = \"round\";\r\n            getShapeForElement(element).forEach((shape) => {\r\n                rc.draw(shape);\r\n            });\r\n            break;\r\n        }\r\n        case \"freedraw\": {\r\n            // Draw directly to canvas\r\n            context.save();\r\n            context.fillStyle = element.strokeColor;\r\n            const path = getFreeDrawPath2D(element);\r\n            context.fillStyle = element.strokeColor;\r\n            context.fill(path);\r\n            context.restore();\r\n            break;\r\n        }\r\n        case \"image\": {\r\n            const img = isInitializedImageElement(element)\r\n                ? sceneState.imageCache.get(element.fileId)?.image\r\n                : undefined;\r\n            if (img != null && !(img instanceof Promise)) {\r\n                context.drawImage(img, 0 /* hardcoded for the selection box*/, 0, element.width, element.height);\r\n            }\r\n            else {\r\n                drawImagePlaceholder(element, context, sceneState.zoom.value);\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            if (isTextElement(element)) {\r\n                const rtl = isRTL(element.text);\r\n                const shouldTemporarilyAttach = rtl && !context.canvas.isConnected;\r\n                if (shouldTemporarilyAttach) {\r\n                    // to correctly render RTL text mixed with LTR, we have to append it\r\n                    // to the DOM\r\n                    document.body.appendChild(context.canvas);\r\n                }\r\n                context.canvas.setAttribute(\"dir\", rtl ? \"rtl\" : \"ltr\");\r\n                context.save();\r\n                context.font = getFontString(element);\r\n                context.fillStyle = element.strokeColor;\r\n                context.textAlign = element.textAlign;\r\n                // Canvas does not support multiline text by default\r\n                const lines = element.text.replace(/\\r\\n?/g, \"\\n\").split(\"\\n\");\r\n                const lineHeight = element.height / lines.length;\r\n                const verticalOffset = element.height - element.baseline;\r\n                const horizontalOffset = element.textAlign === \"center\"\r\n                    ? element.width / 2\r\n                    : element.textAlign === \"right\"\r\n                        ? element.width\r\n                        : 0;\r\n                for (let index = 0; index < lines.length; index++) {\r\n                    context.fillText(lines[index], horizontalOffset, (index + 1) * lineHeight - verticalOffset);\r\n                }\r\n                context.restore();\r\n                if (shouldTemporarilyAttach) {\r\n                    context.canvas.remove();\r\n                }\r\n            }\r\n            else {\r\n                throw new Error(`Unimplemented type ${element.type}`);\r\n            }\r\n        }\r\n    }\r\n    context.globalAlpha = 1;\r\n};\r\nconst elementWithCanvasCache = new WeakMap();\r\nconst shapeCache = new WeakMap();\r\nexport const getShapeForElement = (element) => shapeCache.get(element);\r\nexport const invalidateShapeForElement = (element) => shapeCache.delete(element);\r\nexport const generateRoughOptions = (element, continuousPath = false) => {\r\n    const options = {\r\n        seed: element.seed,\r\n        strokeLineDash: element.strokeStyle === \"dashed\"\r\n            ? getDashArrayDashed(element.strokeWidth)\r\n            : element.strokeStyle === \"dotted\"\r\n                ? getDashArrayDotted(element.strokeWidth)\r\n                : undefined,\r\n        // for non-solid strokes, disable multiStroke because it tends to make\r\n        // dashes/dots overlay each other\r\n        disableMultiStroke: element.strokeStyle !== \"solid\",\r\n        // for non-solid strokes, increase the width a bit to make it visually\r\n        // similar to solid strokes, because we're also disabling multiStroke\r\n        strokeWidth: element.strokeStyle !== \"solid\"\r\n            ? element.strokeWidth + 0.5\r\n            : element.strokeWidth,\r\n        // when increasing strokeWidth, we must explicitly set fillWeight and\r\n        // hachureGap because if not specified, roughjs uses strokeWidth to\r\n        // calculate them (and we don't want the fills to be modified)\r\n        fillWeight: element.strokeWidth / 2,\r\n        hachureGap: element.strokeWidth * 4,\r\n        roughness: element.roughness,\r\n        stroke: element.strokeColor,\r\n        preserveVertices: continuousPath,\r\n        // disable decimals to fix Skia rendering issues #4046\r\n        fixedDecimalPlaceDigits: 0,\r\n    };\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\": {\r\n            options.fillStyle = element.fillStyle;\r\n            options.fill =\r\n                element.backgroundColor === \"transparent\"\r\n                    ? undefined\r\n                    : element.backgroundColor;\r\n            if (element.type === \"ellipse\") {\r\n                options.curveFitting = 1;\r\n            }\r\n            return options;\r\n        }\r\n        case \"line\": {\r\n            if (isPathALoop(element.points)) {\r\n                options.fillStyle = element.fillStyle;\r\n                options.fill =\r\n                    element.backgroundColor === \"transparent\"\r\n                        ? undefined\r\n                        : element.backgroundColor;\r\n            }\r\n            return options;\r\n        }\r\n        case \"freedraw\":\r\n        case \"arrow\":\r\n            return options;\r\n        default: {\r\n            throw new Error(`Unimplemented type ${element.type}`);\r\n        }\r\n    }\r\n};\r\n/**\r\n * Generates the element's shape and puts it into the cache.\r\n * @param element\r\n * @param generator\r\n */\r\nconst generateElementShape = (element, generator) => {\r\n    let shape = shapeCache.get(element) || null;\r\n    if (!shape) {\r\n        elementWithCanvasCache.delete(element);\r\n        switch (element.type) {\r\n            case \"rectangle\":\r\n                if (element.strokeSharpness === \"round\") {\r\n                    const w = element.width;\r\n                    const h = element.height;\r\n                    const r = Math.min(w, h) * 0.25;\r\n                    shape = generator.path(`M ${r} 0 L ${w - r} 0 Q ${w} 0, ${w} ${r} L ${w} ${h - r} Q ${w} ${h}, ${w - r} ${h} L ${r} ${h} Q 0 ${h}, 0 ${h - r} L 0 ${r} Q 0 0, ${r} 0`, generateRoughOptions(element, true));\r\n                }\r\n                else {\r\n                    shape = generator.rectangle(0, 0, element.width, element.height, generateRoughOptions(element));\r\n                }\r\n                break;\r\n            case \"diamond\": {\r\n                const [topX, topY, rightX, rightY, bottomX, bottomY, leftX, leftY] = getDiamondPoints(element);\r\n                shape = generator.polygon([\r\n                    [topX, topY],\r\n                    [rightX, rightY],\r\n                    [bottomX, bottomY],\r\n                    [leftX, leftY],\r\n                ], generateRoughOptions(element));\r\n                break;\r\n            }\r\n            case \"ellipse\":\r\n                shape = generator.ellipse(element.width / 2, element.height / 2, element.width, element.height, generateRoughOptions(element));\r\n                break;\r\n            case \"line\":\r\n            case \"arrow\": {\r\n                const options = generateRoughOptions(element);\r\n                // points array can be empty in the beginning, so it is important to add\r\n                // initial position to it\r\n                const points = element.points.length ? element.points : [[0, 0]];\r\n                // curve is always the first element\r\n                // this simplifies finding the curve for an element\r\n                if (element.strokeSharpness === \"sharp\") {\r\n                    if (options.fill) {\r\n                        shape = [generator.polygon(points, options)];\r\n                    }\r\n                    else {\r\n                        shape = [\r\n                            generator.linearPath(points, options),\r\n                        ];\r\n                    }\r\n                }\r\n                else {\r\n                    shape = [generator.curve(points, options)];\r\n                }\r\n                // add lines only in arrow\r\n                if (element.type === \"arrow\") {\r\n                    const { startArrowhead = null, endArrowhead = \"arrow\" } = element;\r\n                    const getArrowheadShapes = (element, shape, position, arrowhead) => {\r\n                        const arrowheadPoints = getArrowheadPoints(element, shape, position, arrowhead);\r\n                        if (arrowheadPoints === null) {\r\n                            return [];\r\n                        }\r\n                        // Other arrowheads here...\r\n                        if (arrowhead === \"dot\") {\r\n                            const [x, y, r] = arrowheadPoints;\r\n                            return [\r\n                                generator.circle(x, y, r, {\r\n                                    ...options,\r\n                                    fill: element.strokeColor,\r\n                                    fillStyle: \"solid\",\r\n                                    stroke: \"none\",\r\n                                }),\r\n                            ];\r\n                        }\r\n                        if (arrowhead === \"triangle\") {\r\n                            const [x, y, x2, y2, x3, y3] = arrowheadPoints;\r\n                            // always use solid stroke for triangle arrowhead\r\n                            delete options.strokeLineDash;\r\n                            return [\r\n                                generator.polygon([\r\n                                    [x, y],\r\n                                    [x2, y2],\r\n                                    [x3, y3],\r\n                                    [x, y],\r\n                                ], {\r\n                                    ...options,\r\n                                    fill: element.strokeColor,\r\n                                    fillStyle: \"solid\",\r\n                                }),\r\n                            ];\r\n                        }\r\n                        // Arrow arrowheads\r\n                        const [x2, y2, x3, y3, x4, y4] = arrowheadPoints;\r\n                        if (element.strokeStyle === \"dotted\") {\r\n                            // for dotted arrows caps, reduce gap to make it more legible\r\n                            const dash = getDashArrayDotted(element.strokeWidth - 1);\r\n                            options.strokeLineDash = [dash[0], dash[1] - 1];\r\n                        }\r\n                        else {\r\n                            // for solid/dashed, keep solid arrow cap\r\n                            delete options.strokeLineDash;\r\n                        }\r\n                        return [\r\n                            generator.line(x3, y3, x2, y2, options),\r\n                            generator.line(x4, y4, x2, y2, options),\r\n                        ];\r\n                    };\r\n                    if (startArrowhead !== null) {\r\n                        const shapes = getArrowheadShapes(element, shape, \"start\", startArrowhead);\r\n                        shape.push(...shapes);\r\n                    }\r\n                    if (endArrowhead !== null) {\r\n                        if (endArrowhead === undefined) {\r\n                            // Hey, we have an old arrow here!\r\n                        }\r\n                        const shapes = getArrowheadShapes(element, shape, \"end\", endArrowhead);\r\n                        shape.push(...shapes);\r\n                    }\r\n                }\r\n                break;\r\n            }\r\n            case \"freedraw\": {\r\n                generateFreeDrawShape(element);\r\n                shape = [];\r\n                break;\r\n            }\r\n            case \"text\":\r\n            case \"image\": {\r\n                // just to ensure we don't regenerate element.canvas on rerenders\r\n                shape = [];\r\n                break;\r\n            }\r\n        }\r\n        shapeCache.set(element, shape);\r\n    }\r\n};\r\nconst generateElementWithCanvas = (element, sceneState) => {\r\n    const zoom = sceneState ? sceneState.zoom : defaultAppState.zoom;\r\n    const prevElementWithCanvas = elementWithCanvasCache.get(element);\r\n    const shouldRegenerateBecauseZoom = prevElementWithCanvas &&\r\n        prevElementWithCanvas.canvasZoom !== zoom.value &&\r\n        !sceneState?.shouldCacheIgnoreZoom;\r\n    if (!prevElementWithCanvas ||\r\n        shouldRegenerateBecauseZoom ||\r\n        prevElementWithCanvas.theme !== sceneState.theme) {\r\n        const elementWithCanvas = generateElementCanvas(element, zoom, sceneState);\r\n        elementWithCanvasCache.set(element, elementWithCanvas);\r\n        return elementWithCanvas;\r\n    }\r\n    return prevElementWithCanvas;\r\n};\r\nconst drawElementFromCanvas = (elementWithCanvas, rc, context, sceneState) => {\r\n    const element = elementWithCanvas.element;\r\n    const padding = getCanvasPadding(element);\r\n    let [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    // Free draw elements will otherwise \"shuffle\" as the min x and y change\r\n    if (isFreeDrawElement(element)) {\r\n        x1 = Math.floor(x1);\r\n        x2 = Math.ceil(x2);\r\n        y1 = Math.floor(y1);\r\n        y2 = Math.ceil(y2);\r\n    }\r\n    const cx = ((x1 + x2) / 2 + sceneState.scrollX) * window.devicePixelRatio;\r\n    const cy = ((y1 + y2) / 2 + sceneState.scrollY) * window.devicePixelRatio;\r\n    const _isPendingImageElement = isPendingImageElement(element, sceneState);\r\n    const scaleXFactor = \"scale\" in elementWithCanvas.element && !_isPendingImageElement\r\n        ? elementWithCanvas.element.scale[0]\r\n        : 1;\r\n    const scaleYFactor = \"scale\" in elementWithCanvas.element && !_isPendingImageElement\r\n        ? elementWithCanvas.element.scale[1]\r\n        : 1;\r\n    context.save();\r\n    context.scale((1 / window.devicePixelRatio) * scaleXFactor, (1 / window.devicePixelRatio) * scaleYFactor);\r\n    context.translate(cx * scaleXFactor, cy * scaleYFactor);\r\n    context.rotate(element.angle * scaleXFactor * scaleYFactor);\r\n    context.drawImage(elementWithCanvas.canvas, (-(x2 - x1) / 2) * window.devicePixelRatio -\r\n        (padding * elementWithCanvas.canvasZoom) / elementWithCanvas.canvasZoom, (-(y2 - y1) / 2) * window.devicePixelRatio -\r\n        (padding * elementWithCanvas.canvasZoom) / elementWithCanvas.canvasZoom, elementWithCanvas.canvas.width / elementWithCanvas.canvasZoom, elementWithCanvas.canvas.height / elementWithCanvas.canvasZoom);\r\n    context.restore();\r\n    // Clear the nested element we appended to the DOM\r\n};\r\nexport const renderElement = (element, rc, context, renderOptimizations, sceneState) => {\r\n    const generator = rc.generator;\r\n    switch (element.type) {\r\n        case \"selection\": {\r\n            context.save();\r\n            context.translate(element.x + sceneState.scrollX, element.y + sceneState.scrollY);\r\n            context.fillStyle = \"rgba(0, 0, 255, 0.10)\";\r\n            context.fillRect(0, 0, element.width, element.height);\r\n            context.restore();\r\n            break;\r\n        }\r\n        case \"freedraw\": {\r\n            generateElementShape(element, generator);\r\n            if (renderOptimizations) {\r\n                const elementWithCanvas = generateElementWithCanvas(element, sceneState);\r\n                drawElementFromCanvas(elementWithCanvas, rc, context, sceneState);\r\n            }\r\n            else {\r\n                const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n                const cx = (x1 + x2) / 2 + sceneState.scrollX;\r\n                const cy = (y1 + y2) / 2 + sceneState.scrollY;\r\n                const shiftX = (x2 - x1) / 2 - (element.x - x1);\r\n                const shiftY = (y2 - y1) / 2 - (element.y - y1);\r\n                context.save();\r\n                context.translate(cx, cy);\r\n                context.rotate(element.angle);\r\n                context.translate(-shiftX, -shiftY);\r\n                drawElementOnCanvas(element, rc, context, sceneState);\r\n                context.restore();\r\n            }\r\n            break;\r\n        }\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\":\r\n        case \"line\":\r\n        case \"arrow\":\r\n        case \"image\":\r\n        case \"text\": {\r\n            generateElementShape(element, generator);\r\n            if (renderOptimizations) {\r\n                const elementWithCanvas = generateElementWithCanvas(element, sceneState);\r\n                drawElementFromCanvas(elementWithCanvas, rc, context, sceneState);\r\n            }\r\n            else {\r\n                const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n                const cx = (x1 + x2) / 2 + sceneState.scrollX;\r\n                const cy = (y1 + y2) / 2 + sceneState.scrollY;\r\n                const shiftX = (x2 - x1) / 2 - (element.x - x1);\r\n                const shiftY = (y2 - y1) / 2 - (element.y - y1);\r\n                context.save();\r\n                context.translate(cx, cy);\r\n                context.rotate(element.angle);\r\n                context.translate(-shiftX, -shiftY);\r\n                drawElementOnCanvas(element, rc, context, sceneState);\r\n                context.restore();\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            // @ts-ignore\r\n            throw new Error(`Unimplemented type ${element.type}`);\r\n        }\r\n    }\r\n};\r\nconst roughSVGDrawWithPrecision = (rsvg, drawable, precision) => {\r\n    if (typeof precision === \"undefined\") {\r\n        return rsvg.draw(drawable);\r\n    }\r\n    const pshape = {\r\n        sets: drawable.sets,\r\n        shape: drawable.shape,\r\n        options: { ...drawable.options, fixedDecimalPlaceDigits: precision },\r\n    };\r\n    return rsvg.draw(pshape);\r\n};\r\nexport const renderElementToSvg = (element, rsvg, svgRoot, files, offsetX, offsetY) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x2 - x1) / 2 - (element.x - x1);\r\n    const cy = (y2 - y1) / 2 - (element.y - y1);\r\n    const degree = (180 * element.angle) / Math.PI;\r\n    const generator = rsvg.generator;\r\n    switch (element.type) {\r\n        case \"selection\": {\r\n            // Since this is used only during editing experience, which is canvas based,\r\n            // this should not happen\r\n            throw new Error(\"Selection rendering is not supported for SVG\");\r\n        }\r\n        case \"rectangle\":\r\n        case \"diamond\":\r\n        case \"ellipse\": {\r\n            generateElementShape(element, generator);\r\n            const node = roughSVGDrawWithPrecision(rsvg, getShapeForElement(element), MAX_DECIMALS_FOR_SVG_EXPORT);\r\n            const opacity = element.opacity / 100;\r\n            if (opacity !== 1) {\r\n                node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n            }\r\n            node.setAttribute(\"stroke-linecap\", \"round\");\r\n            node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n            svgRoot.appendChild(node);\r\n            break;\r\n        }\r\n        case \"line\":\r\n        case \"arrow\": {\r\n            generateElementShape(element, generator);\r\n            const group = svgRoot.ownerDocument.createElementNS(SVG_NS, \"g\");\r\n            const opacity = element.opacity / 100;\r\n            group.setAttribute(\"stroke-linecap\", \"round\");\r\n            getShapeForElement(element).forEach((shape) => {\r\n                const node = roughSVGDrawWithPrecision(rsvg, shape, MAX_DECIMALS_FOR_SVG_EXPORT);\r\n                if (opacity !== 1) {\r\n                    node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                    node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n                }\r\n                node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n                if (element.type === \"line\" &&\r\n                    isPathALoop(element.points) &&\r\n                    element.backgroundColor !== \"transparent\") {\r\n                    node.setAttribute(\"fill-rule\", \"evenodd\");\r\n                }\r\n                group.appendChild(node);\r\n            });\r\n            svgRoot.appendChild(group);\r\n            break;\r\n        }\r\n        case \"freedraw\": {\r\n            generateFreeDrawShape(element);\r\n            const opacity = element.opacity / 100;\r\n            const node = svgRoot.ownerDocument.createElementNS(SVG_NS, \"g\");\r\n            if (opacity !== 1) {\r\n                node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n            }\r\n            node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n            const path = svgRoot.ownerDocument.createElementNS(SVG_NS, \"path\");\r\n            node.setAttribute(\"stroke\", \"none\");\r\n            node.setAttribute(\"fill\", element.strokeColor);\r\n            path.setAttribute(\"d\", getFreeDrawSvgPath(element));\r\n            node.appendChild(path);\r\n            svgRoot.appendChild(node);\r\n            break;\r\n        }\r\n        case \"image\": {\r\n            const fileData = isInitializedImageElement(element) && files[element.fileId];\r\n            if (fileData) {\r\n                const symbolId = `image-${fileData.id}`;\r\n                let symbol = svgRoot.querySelector(`#${symbolId}`);\r\n                if (!symbol) {\r\n                    symbol = svgRoot.ownerDocument.createElementNS(SVG_NS, \"symbol\");\r\n                    symbol.id = symbolId;\r\n                    const image = svgRoot.ownerDocument.createElementNS(SVG_NS, \"image\");\r\n                    image.setAttribute(\"width\", \"100%\");\r\n                    image.setAttribute(\"height\", \"100%\");\r\n                    image.setAttribute(\"href\", fileData.dataURL);\r\n                    symbol.appendChild(image);\r\n                    svgRoot.prepend(symbol);\r\n                }\r\n                const use = svgRoot.ownerDocument.createElementNS(SVG_NS, \"use\");\r\n                use.setAttribute(\"href\", `#${symbolId}`);\r\n                use.setAttribute(\"width\", `${Math.round(element.width)}`);\r\n                use.setAttribute(\"height\", `${Math.round(element.height)}`);\r\n                use.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n                svgRoot.appendChild(use);\r\n            }\r\n            break;\r\n        }\r\n        default: {\r\n            if (isTextElement(element)) {\r\n                const opacity = element.opacity / 100;\r\n                const node = svgRoot.ownerDocument.createElementNS(SVG_NS, \"g\");\r\n                if (opacity !== 1) {\r\n                    node.setAttribute(\"stroke-opacity\", `${opacity}`);\r\n                    node.setAttribute(\"fill-opacity\", `${opacity}`);\r\n                }\r\n                node.setAttribute(\"transform\", `translate(${offsetX || 0} ${offsetY || 0}) rotate(${degree} ${cx} ${cy})`);\r\n                const lines = element.text.replace(/\\r\\n?/g, \"\\n\").split(\"\\n\");\r\n                const lineHeight = element.height / lines.length;\r\n                const verticalOffset = element.height - element.baseline;\r\n                const horizontalOffset = element.textAlign === \"center\"\r\n                    ? element.width / 2\r\n                    : element.textAlign === \"right\"\r\n                        ? element.width\r\n                        : 0;\r\n                const direction = isRTL(element.text) ? \"rtl\" : \"ltr\";\r\n                const textAnchor = element.textAlign === \"center\"\r\n                    ? \"middle\"\r\n                    : element.textAlign === \"right\" || direction === \"rtl\"\r\n                        ? \"end\"\r\n                        : \"start\";\r\n                for (let i = 0; i < lines.length; i++) {\r\n                    const text = svgRoot.ownerDocument.createElementNS(SVG_NS, \"text\");\r\n                    text.textContent = lines[i];\r\n                    text.setAttribute(\"x\", `${horizontalOffset}`);\r\n                    text.setAttribute(\"y\", `${(i + 1) * lineHeight - verticalOffset}`);\r\n                    text.setAttribute(\"font-family\", getFontFamilyString(element));\r\n                    text.setAttribute(\"font-size\", `${element.fontSize}px`);\r\n                    text.setAttribute(\"fill\", element.strokeColor);\r\n                    text.setAttribute(\"text-anchor\", textAnchor);\r\n                    text.setAttribute(\"style\", \"white-space: pre;\");\r\n                    text.setAttribute(\"direction\", direction);\r\n                    node.appendChild(text);\r\n                }\r\n                svgRoot.appendChild(node);\r\n            }\r\n            else {\r\n                // @ts-ignore\r\n                throw new Error(`Unimplemented type ${element.type}`);\r\n            }\r\n        }\r\n    }\r\n};\r\nexport const pathsCache = new WeakMap([]);\r\nexport function generateFreeDrawShape(element) {\r\n    const svgPathData = getFreeDrawSvgPath(element);\r\n    const path = new Path2D(svgPathData);\r\n    pathsCache.set(element, path);\r\n    return path;\r\n}\r\nexport function getFreeDrawPath2D(element) {\r\n    return pathsCache.get(element);\r\n}\r\nexport function getFreeDrawSvgPath(element) {\r\n    // If input points are empty (should they ever be?) return a dot\r\n    const inputPoints = element.simulatePressure\r\n        ? element.points\r\n        : element.points.length\r\n            ? element.points.map(([x, y], i) => [x, y, element.pressures[i]])\r\n            : [[0, 0, 0.5]];\r\n    // Consider changing the options for simulated pressure vs real pressure\r\n    const options = {\r\n        simulatePressure: element.simulatePressure,\r\n        size: element.strokeWidth * 4.25,\r\n        thinning: 0.6,\r\n        smoothing: 0.5,\r\n        streamline: 0.5,\r\n        easing: (t) => Math.sin((t * Math.PI) / 2),\r\n        last: !!element.lastCommittedPoint, // LastCommittedPoint is added on pointerup\r\n    };\r\n    return getSvgPathFromStroke(getStroke(inputPoints, options));\r\n}\r\nfunction med(A, B) {\r\n    return [(A[0] + B[0]) / 2, (A[1] + B[1]) / 2];\r\n}\r\n// Trim SVG path data so number are each two decimal points. This\r\n// improves SVG exports, and prevents rendering errors on points\r\n// with long decimals.\r\nconst TO_FIXED_PRECISION = /(\\s?[A-Z]?,?-?[0-9]*\\.[0-9]{0,2})(([0-9]|e|-)*)/g;\r\nfunction getSvgPathFromStroke(points) {\r\n    if (!points.length) {\r\n        return \"\";\r\n    }\r\n    const max = points.length - 1;\r\n    return points\r\n        .reduce((acc, point, i, arr) => {\r\n        if (i === max) {\r\n            acc.push(point, med(point, arr[0]), \"L\", arr[0], \"Z\");\r\n        }\r\n        else {\r\n            acc.push(point, med(point, arr[i + 1]));\r\n        }\r\n        return acc;\r\n    }, [\"M\", points[0], \"Q\"])\r\n        .join(\" \")\r\n        .replace(TO_FIXED_PRECISION, \"$1\");\r\n}\r\n","import { getNonDeletedElements, isNonDeletedElement } from \"../element\";\r\nconst isIdKey = (elementKey) => {\r\n    if (typeof elementKey === \"string\") {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nclass Scene {\r\n    constructor() {\r\n        // ---------------------------------------------------------------------------\r\n        // static methods/props\r\n        // ---------------------------------------------------------------------------\r\n        // ---------------------------------------------------------------------------\r\n        // instance methods/props\r\n        // ---------------------------------------------------------------------------\r\n        this.callbacks = new Set();\r\n        this.nonDeletedElements = [];\r\n        this.elements = [];\r\n        this.elementsMap = new Map();\r\n    }\r\n    static mapElementToScene(elementKey, scene) {\r\n        if (isIdKey(elementKey)) {\r\n            this.sceneMapById.set(elementKey, scene);\r\n        }\r\n        else {\r\n            this.sceneMapByElement.set(elementKey, scene);\r\n        }\r\n    }\r\n    static getScene(elementKey) {\r\n        if (isIdKey(elementKey)) {\r\n            return this.sceneMapById.get(elementKey) || null;\r\n        }\r\n        return this.sceneMapByElement.get(elementKey) || null;\r\n    }\r\n    // TODO: getAllElementsIncludingDeleted\r\n    getElementsIncludingDeleted() {\r\n        return this.elements;\r\n    }\r\n    // TODO: getAllNonDeletedElements\r\n    getElements() {\r\n        return this.nonDeletedElements;\r\n    }\r\n    getElement(id) {\r\n        return this.elementsMap.get(id) || null;\r\n    }\r\n    getNonDeletedElement(id) {\r\n        const element = this.getElement(id);\r\n        if (element && isNonDeletedElement(element)) {\r\n            return element;\r\n        }\r\n        return null;\r\n    }\r\n    // TODO: Rename methods here, this is confusing\r\n    getNonDeletedElements(ids) {\r\n        const result = [];\r\n        ids.forEach((id) => {\r\n            const element = this.getNonDeletedElement(id);\r\n            if (element != null) {\r\n                result.push(element);\r\n            }\r\n        });\r\n        return result;\r\n    }\r\n    replaceAllElements(nextElements) {\r\n        this.elements = nextElements;\r\n        this.elementsMap.clear();\r\n        nextElements.forEach((element) => {\r\n            this.elementsMap.set(element.id, element);\r\n            Scene.mapElementToScene(element, this);\r\n        });\r\n        this.nonDeletedElements = getNonDeletedElements(this.elements);\r\n        this.informMutation();\r\n    }\r\n    informMutation() {\r\n        for (const callback of Array.from(this.callbacks)) {\r\n            callback();\r\n        }\r\n    }\r\n    addCallback(cb) {\r\n        if (this.callbacks.has(cb)) {\r\n            throw new Error();\r\n        }\r\n        this.callbacks.add(cb);\r\n        return () => {\r\n            if (!this.callbacks.has(cb)) {\r\n                throw new Error();\r\n            }\r\n            this.callbacks.delete(cb);\r\n        };\r\n    }\r\n    destroy() {\r\n        Scene.sceneMapById.forEach((scene, elementKey) => {\r\n            if (scene === this) {\r\n                Scene.sceneMapById.delete(elementKey);\r\n            }\r\n        });\r\n        // done not for memory leaks, but to guard against possible late fires\r\n        // (I guess?)\r\n        this.callbacks.clear();\r\n    }\r\n}\r\nScene.sceneMapByElement = new WeakMap();\r\nScene.sceneMapById = new Map();\r\nexport default Scene;\r\n","import { Random } from \"roughjs/bin/math\";\r\nimport { nanoid } from \"nanoid\";\r\nlet random = new Random(Date.now());\r\nlet testIdBase = 0;\r\nexport const randomInteger = () => Math.floor(random.next() * 2 ** 31);\r\nexport const reseed = (seed) => {\r\n    random = new Random(seed);\r\n    testIdBase = 0;\r\n};\r\nexport const randomId = () => process.env.NODE_ENV === \"test\" ? `id${testIdBase++}` : nanoid();\r\n","import { invalidateShapeForElement } from \"../renderer/renderElement\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { getSizeFromPoints } from \"../points\";\r\nimport { randomInteger } from \"../random\";\r\n// This function tracks updates of text elements for the purposes for collaboration.\r\n// The version is used to compare updates when more than one user is working in\r\n// the same drawing. Note: this will trigger the component to update. Make sure you\r\n// are calling it either from a React event handler or within unstable_batchedUpdates().\r\nexport const mutateElement = (element, updates, informMutation = true) => {\r\n    let didChange = false;\r\n    // casting to any because can't use `in` operator\r\n    // (see https://github.com/microsoft/TypeScript/issues/21732)\r\n    const { points, fileId } = updates;\r\n    if (typeof points !== \"undefined\") {\r\n        updates = { ...getSizeFromPoints(points), ...updates };\r\n    }\r\n    for (const key in updates) {\r\n        const value = updates[key];\r\n        if (typeof value !== \"undefined\") {\r\n            if (element[key] === value &&\r\n                // if object, always update because its attrs could have changed\r\n                // (except for specific keys we handle below)\r\n                (typeof value !== \"object\" ||\r\n                    value === null ||\r\n                    key === \"groupIds\" ||\r\n                    key === \"scale\")) {\r\n                continue;\r\n            }\r\n            if (key === \"scale\") {\r\n                const prevScale = element[key];\r\n                const nextScale = value;\r\n                if (prevScale[0] === nextScale[0] && prevScale[1] === nextScale[1]) {\r\n                    continue;\r\n                }\r\n            }\r\n            else if (key === \"points\") {\r\n                const prevPoints = element[key];\r\n                const nextPoints = value;\r\n                if (prevPoints.length === nextPoints.length) {\r\n                    let didChangePoints = false;\r\n                    let index = prevPoints.length;\r\n                    while (--index) {\r\n                        const prevPoint = prevPoints[index];\r\n                        const nextPoint = nextPoints[index];\r\n                        if (prevPoint[0] !== nextPoint[0] ||\r\n                            prevPoint[1] !== nextPoint[1]) {\r\n                            didChangePoints = true;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!didChangePoints) {\r\n                        continue;\r\n                    }\r\n                }\r\n            }\r\n            element[key] = value;\r\n            didChange = true;\r\n        }\r\n    }\r\n    if (!didChange) {\r\n        return element;\r\n    }\r\n    if (typeof updates.height !== \"undefined\" ||\r\n        typeof updates.width !== \"undefined\" ||\r\n        typeof fileId != \"undefined\" ||\r\n        typeof points !== \"undefined\") {\r\n        invalidateShapeForElement(element);\r\n    }\r\n    element.version++;\r\n    element.versionNonce = randomInteger();\r\n    if (informMutation) {\r\n        Scene.getScene(element)?.informMutation();\r\n    }\r\n    return element;\r\n};\r\nexport const newElementWith = (element, updates) => {\r\n    let didChange = false;\r\n    for (const key in updates) {\r\n        const value = updates[key];\r\n        if (typeof value !== \"undefined\") {\r\n            if (element[key] === value &&\r\n                // if object, always update because its attrs could have changed\r\n                (typeof value !== \"object\" || value === null)) {\r\n                continue;\r\n            }\r\n            didChange = true;\r\n        }\r\n    }\r\n    if (!didChange) {\r\n        return element;\r\n    }\r\n    return {\r\n        ...element,\r\n        ...updates,\r\n        version: element.version + 1,\r\n        versionNonce: randomInteger(),\r\n    };\r\n};\r\n/**\r\n * Mutates element and updates `version` & `versionNonce`.\r\n *\r\n * NOTE: does not trigger re-render.\r\n */\r\nexport const bumpVersion = (element, version) => {\r\n    element.version = (version ?? element.version) + 1;\r\n    element.versionNonce = randomInteger();\r\n    return element;\r\n};\r\n","import { mutateElement } from \"./mutateElement\";\r\nimport { isFreeDrawElement, isLinearElement } from \"./typeChecks\";\r\nimport { SHIFT_LOCKING_ANGLE } from \"../constants\";\r\nexport const isInvisiblySmallElement = (element) => {\r\n    if (isLinearElement(element) || isFreeDrawElement(element)) {\r\n        return element.points.length < 2;\r\n    }\r\n    return element.width === 0 && element.height === 0;\r\n};\r\n/**\r\n * Makes a perfect shape or diagonal/horizontal/vertical line\r\n */\r\nexport const getPerfectElementSize = (elementType, width, height) => {\r\n    const absWidth = Math.abs(width);\r\n    const absHeight = Math.abs(height);\r\n    if (elementType === \"line\" ||\r\n        elementType === \"arrow\" ||\r\n        elementType === \"freedraw\") {\r\n        const lockedAngle = Math.round(Math.atan(absHeight / absWidth) / SHIFT_LOCKING_ANGLE) *\r\n            SHIFT_LOCKING_ANGLE;\r\n        if (lockedAngle === 0) {\r\n            height = 0;\r\n        }\r\n        else if (lockedAngle === Math.PI / 2) {\r\n            width = 0;\r\n        }\r\n        else {\r\n            height =\r\n                Math.round(absWidth * Math.tan(lockedAngle)) * Math.sign(height) ||\r\n                    height;\r\n        }\r\n    }\r\n    else if (elementType !== \"selection\") {\r\n        height = absWidth * Math.sign(height);\r\n    }\r\n    return { width, height };\r\n};\r\nexport const resizePerfectLineForNWHandler = (element, x, y) => {\r\n    const anchorX = element.x + element.width;\r\n    const anchorY = element.y + element.height;\r\n    const distanceToAnchorX = x - anchorX;\r\n    const distanceToAnchorY = y - anchorY;\r\n    if (Math.abs(distanceToAnchorX) < Math.abs(distanceToAnchorY) / 2) {\r\n        mutateElement(element, {\r\n            x: anchorX,\r\n            width: 0,\r\n            y,\r\n            height: -distanceToAnchorY,\r\n        });\r\n    }\r\n    else if (Math.abs(distanceToAnchorY) < Math.abs(element.width) / 2) {\r\n        mutateElement(element, {\r\n            y: anchorY,\r\n            height: 0,\r\n        });\r\n    }\r\n    else {\r\n        const nextHeight = Math.sign(distanceToAnchorY) *\r\n            Math.sign(distanceToAnchorX) *\r\n            element.width;\r\n        mutateElement(element, {\r\n            x,\r\n            y: anchorY - nextHeight,\r\n            width: -distanceToAnchorX,\r\n            height: nextHeight,\r\n        });\r\n    }\r\n};\r\nexport const getNormalizedDimensions = (element) => {\r\n    const ret = {\r\n        width: element.width,\r\n        height: element.height,\r\n        x: element.x,\r\n        y: element.y,\r\n    };\r\n    if (element.width < 0) {\r\n        const nextWidth = Math.abs(element.width);\r\n        ret.width = nextWidth;\r\n        ret.x = element.x - nextWidth;\r\n    }\r\n    if (element.height < 0) {\r\n        const nextHeight = Math.abs(element.height);\r\n        ret.height = nextHeight;\r\n        ret.y = element.y - nextHeight;\r\n    }\r\n    return ret;\r\n};\r\n","import { getSelectedElements } from \"./scene\";\r\nexport const selectGroup = (groupId, appState, elements) => {\r\n    const elementsInGroup = elements.filter((element) => element.groupIds.includes(groupId));\r\n    if (elementsInGroup.length < 2) {\r\n        if (appState.selectedGroupIds[groupId] ||\r\n            appState.editingGroupId === groupId) {\r\n            return {\r\n                ...appState,\r\n                selectedGroupIds: { ...appState.selectedGroupIds, [groupId]: false },\r\n                editingGroupId: null,\r\n            };\r\n        }\r\n        return appState;\r\n    }\r\n    return {\r\n        ...appState,\r\n        selectedGroupIds: { ...appState.selectedGroupIds, [groupId]: true },\r\n        selectedElementIds: {\r\n            ...appState.selectedElementIds,\r\n            ...Object.fromEntries(elementsInGroup.map((element) => [element.id, true])),\r\n        },\r\n    };\r\n};\r\n/**\r\n * If the element's group is selected, don't render an individual\r\n * selection border around it.\r\n */\r\nexport const isSelectedViaGroup = (appState, element) => getSelectedGroupForElement(appState, element) != null;\r\nexport const getSelectedGroupForElement = (appState, element) => element.groupIds\r\n    .filter((groupId) => groupId !== appState.editingGroupId)\r\n    .find((groupId) => appState.selectedGroupIds[groupId]);\r\nexport const getSelectedGroupIds = (appState) => Object.entries(appState.selectedGroupIds)\r\n    .filter(([groupId, isSelected]) => isSelected)\r\n    .map(([groupId, isSelected]) => groupId);\r\n/**\r\n * When you select an element, you often want to actually select the whole group it's in, unless\r\n * you're currently editing that group.\r\n */\r\nexport const selectGroupsForSelectedElements = (appState, elements) => {\r\n    let nextAppState = { ...appState, selectedGroupIds: {} };\r\n    const selectedElements = getSelectedElements(elements, appState);\r\n    if (!selectedElements.length) {\r\n        return { ...nextAppState, editingGroupId: null };\r\n    }\r\n    for (const selectedElement of selectedElements) {\r\n        let groupIds = selectedElement.groupIds;\r\n        if (appState.editingGroupId) {\r\n            // handle the case where a group is nested within a group\r\n            const indexOfEditingGroup = groupIds.indexOf(appState.editingGroupId);\r\n            if (indexOfEditingGroup > -1) {\r\n                groupIds = groupIds.slice(0, indexOfEditingGroup);\r\n            }\r\n        }\r\n        if (groupIds.length > 0) {\r\n            const groupId = groupIds[groupIds.length - 1];\r\n            nextAppState = selectGroup(groupId, nextAppState, elements);\r\n        }\r\n    }\r\n    return nextAppState;\r\n};\r\nexport const editGroupForSelectedElement = (appState, element) => {\r\n    return {\r\n        ...appState,\r\n        editingGroupId: element.groupIds.length ? element.groupIds[0] : null,\r\n        selectedGroupIds: {},\r\n        selectedElementIds: {\r\n            [element.id]: true,\r\n        },\r\n    };\r\n};\r\nexport const isElementInGroup = (element, groupId) => element.groupIds.includes(groupId);\r\nexport const getElementsInGroup = (elements, groupId) => elements.filter((element) => isElementInGroup(element, groupId));\r\nexport const getSelectedGroupIdForElement = (element, selectedGroupIds) => element.groupIds.find((groupId) => selectedGroupIds[groupId]);\r\nexport const getNewGroupIdsForDuplication = (groupIds, editingGroupId, mapper) => {\r\n    const copy = [...groupIds];\r\n    const positionOfEditingGroupId = editingGroupId\r\n        ? groupIds.indexOf(editingGroupId)\r\n        : -1;\r\n    const endIndex = positionOfEditingGroupId > -1 ? positionOfEditingGroupId : groupIds.length;\r\n    for (let index = 0; index < endIndex; index++) {\r\n        copy[index] = mapper(copy[index]);\r\n    }\r\n    return copy;\r\n};\r\nexport const addToGroup = (prevGroupIds, newGroupId, editingGroupId) => {\r\n    // insert before the editingGroupId, or push to the end.\r\n    const groupIds = [...prevGroupIds];\r\n    const positionOfEditingGroupId = editingGroupId\r\n        ? groupIds.indexOf(editingGroupId)\r\n        : -1;\r\n    const positionToInsert = positionOfEditingGroupId > -1 ? positionOfEditingGroupId : groupIds.length;\r\n    groupIds.splice(positionToInsert, 0, newGroupId);\r\n    return groupIds;\r\n};\r\nexport const removeFromSelectedGroups = (groupIds, selectedGroupIds) => groupIds.filter((groupId) => !selectedGroupIds[groupId]);\r\n","import { measureText, getFontString } from \"../utils\";\r\nimport { randomInteger, randomId } from \"../random\";\r\nimport { newElementWith } from \"./mutateElement\";\r\nimport { getNewGroupIdsForDuplication } from \"../groups\";\r\nimport { getElementAbsoluteCoords } from \".\";\r\nimport { adjustXYWithRotation } from \"../math\";\r\nimport { getResizedElementAbsoluteCoords } from \"./bounds\";\r\nconst _newElementBase = (type, { x, y, strokeColor, backgroundColor, fillStyle, strokeWidth, strokeStyle, roughness, opacity, width = 0, height = 0, angle = 0, groupIds = [], strokeSharpness, boundElementIds = null, ...rest }) => ({\r\n    id: rest.id || randomId(),\r\n    type,\r\n    x,\r\n    y,\r\n    width,\r\n    height,\r\n    angle,\r\n    strokeColor,\r\n    backgroundColor,\r\n    fillStyle,\r\n    strokeWidth,\r\n    strokeStyle,\r\n    roughness,\r\n    opacity,\r\n    groupIds,\r\n    strokeSharpness,\r\n    seed: rest.seed ?? randomInteger(),\r\n    version: rest.version || 1,\r\n    versionNonce: rest.versionNonce ?? 0,\r\n    isDeleted: false,\r\n    boundElementIds,\r\n});\r\nexport const newElement = (opts) => _newElementBase(opts.type, opts);\r\n/** computes element x/y offset based on textAlign/verticalAlign */\r\nconst getTextElementPositionOffsets = (opts, metrics) => {\r\n    return {\r\n        x: opts.textAlign === \"center\"\r\n            ? metrics.width / 2\r\n            : opts.textAlign === \"right\"\r\n                ? metrics.width\r\n                : 0,\r\n        y: opts.verticalAlign === \"middle\" ? metrics.height / 2 : 0,\r\n    };\r\n};\r\nexport const newTextElement = (opts) => {\r\n    const metrics = measureText(opts.text, getFontString(opts));\r\n    const offsets = getTextElementPositionOffsets(opts, metrics);\r\n    const textElement = newElementWith({\r\n        ..._newElementBase(\"text\", opts),\r\n        text: opts.text,\r\n        fontSize: opts.fontSize,\r\n        fontFamily: opts.fontFamily,\r\n        textAlign: opts.textAlign,\r\n        verticalAlign: opts.verticalAlign,\r\n        x: opts.x - offsets.x,\r\n        y: opts.y - offsets.y,\r\n        width: metrics.width,\r\n        height: metrics.height,\r\n        baseline: metrics.baseline,\r\n    }, {});\r\n    return textElement;\r\n};\r\nconst getAdjustedDimensions = (element, nextText) => {\r\n    const { width: nextWidth, height: nextHeight, baseline: nextBaseline, } = measureText(nextText, getFontString(element));\r\n    const { textAlign, verticalAlign } = element;\r\n    let x;\r\n    let y;\r\n    if (textAlign === \"center\" && verticalAlign === \"middle\") {\r\n        const prevMetrics = measureText(element.text, getFontString(element));\r\n        const offsets = getTextElementPositionOffsets(element, {\r\n            width: nextWidth - prevMetrics.width,\r\n            height: nextHeight - prevMetrics.height,\r\n        });\r\n        x = element.x - offsets.x;\r\n        y = element.y - offsets.y;\r\n    }\r\n    else {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const [nextX1, nextY1, nextX2, nextY2] = getResizedElementAbsoluteCoords(element, nextWidth, nextHeight);\r\n        const deltaX1 = (x1 - nextX1) / 2;\r\n        const deltaY1 = (y1 - nextY1) / 2;\r\n        const deltaX2 = (x2 - nextX2) / 2;\r\n        const deltaY2 = (y2 - nextY2) / 2;\r\n        [x, y] = adjustXYWithRotation({\r\n            s: true,\r\n            e: textAlign === \"center\" || textAlign === \"left\",\r\n            w: textAlign === \"center\" || textAlign === \"right\",\r\n        }, element.x, element.y, element.angle, deltaX1, deltaY1, deltaX2, deltaY2);\r\n    }\r\n    return {\r\n        width: nextWidth,\r\n        height: nextHeight,\r\n        x: Number.isFinite(x) ? x : element.x,\r\n        y: Number.isFinite(y) ? y : element.y,\r\n        baseline: nextBaseline,\r\n    };\r\n};\r\nexport const updateTextElement = (element, { text, isDeleted }) => {\r\n    return newElementWith(element, {\r\n        text,\r\n        isDeleted: isDeleted ?? element.isDeleted,\r\n        ...getAdjustedDimensions(element, text),\r\n    });\r\n};\r\nexport const newFreeDrawElement = (opts) => {\r\n    return {\r\n        ..._newElementBase(opts.type, opts),\r\n        points: opts.points || [],\r\n        pressures: [],\r\n        simulatePressure: opts.simulatePressure,\r\n        lastCommittedPoint: null,\r\n    };\r\n};\r\nexport const newLinearElement = (opts) => {\r\n    return {\r\n        ..._newElementBase(opts.type, opts),\r\n        points: opts.points || [],\r\n        lastCommittedPoint: null,\r\n        startBinding: null,\r\n        endBinding: null,\r\n        startArrowhead: opts.startArrowhead,\r\n        endArrowhead: opts.endArrowhead,\r\n    };\r\n};\r\nexport const newImageElement = (opts) => {\r\n    return {\r\n        ..._newElementBase(\"image\", opts),\r\n        // in the future we'll support changing stroke color for some SVG elements,\r\n        // and `transparent` will likely mean \"use original colors of the image\"\r\n        strokeColor: \"transparent\",\r\n        status: \"pending\",\r\n        fileId: null,\r\n        scale: [1, 1],\r\n    };\r\n};\r\n// Simplified deep clone for the purpose of cloning ExcalidrawElement only\r\n// (doesn't clone Date, RegExp, Map, Set, Typed arrays etc.)\r\n//\r\n// Adapted from https://github.com/lukeed/klona\r\nexport const deepCopyElement = (val, depth = 0) => {\r\n    if (val == null || typeof val !== \"object\") {\r\n        return val;\r\n    }\r\n    if (Object.prototype.toString.call(val) === \"[object Object]\") {\r\n        const tmp = typeof val.constructor === \"function\"\r\n            ? Object.create(Object.getPrototypeOf(val))\r\n            : {};\r\n        for (const key in val) {\r\n            if (val.hasOwnProperty(key)) {\r\n                // don't copy top-level shape property, which we want to regenerate\r\n                if (depth === 0 && (key === \"shape\" || key === \"canvas\")) {\r\n                    continue;\r\n                }\r\n                tmp[key] = deepCopyElement(val[key], depth + 1);\r\n            }\r\n        }\r\n        return tmp;\r\n    }\r\n    if (Array.isArray(val)) {\r\n        let k = val.length;\r\n        const arr = new Array(k);\r\n        while (k--) {\r\n            arr[k] = deepCopyElement(val[k], depth + 1);\r\n        }\r\n        return arr;\r\n    }\r\n    return val;\r\n};\r\n/**\r\n * Duplicate an element, often used in the alt-drag operation.\r\n * Note that this method has gotten a bit complicated since the\r\n * introduction of gruoping/ungrouping elements.\r\n * @param editingGroupId The current group being edited. The new\r\n *                       element will inherit this group and its\r\n *                       parents.\r\n * @param groupIdMapForOperation A Map that maps old group IDs to\r\n *                               duplicated ones. If you are duplicating\r\n *                               multiple elements at once, share this map\r\n *                               amongst all of them\r\n * @param element Element to duplicate\r\n * @param overrides Any element properties to override\r\n */\r\nexport const duplicateElement = (editingGroupId, groupIdMapForOperation, element, overrides) => {\r\n    let copy = deepCopyElement(element);\r\n    if (process.env.NODE_ENV === \"test\") {\r\n        copy.id = `${copy.id}_copy`;\r\n        // `window.h` may not be defined in some unit tests\r\n        if (window.h?.app\r\n            ?.getSceneElementsIncludingDeleted()\r\n            .find((el) => el.id === copy.id)) {\r\n            copy.id += \"_copy\";\r\n        }\r\n    }\r\n    else {\r\n        copy.id = randomId();\r\n    }\r\n    copy.seed = randomInteger();\r\n    copy.groupIds = getNewGroupIdsForDuplication(copy.groupIds, editingGroupId, (groupId) => {\r\n        if (!groupIdMapForOperation.has(groupId)) {\r\n            groupIdMapForOperation.set(groupId, randomId());\r\n        }\r\n        return groupIdMapForOperation.get(groupId);\r\n    });\r\n    if (overrides) {\r\n        copy = Object.assign(copy, overrides);\r\n    }\r\n    return copy;\r\n};\r\n","import { getElementAbsoluteCoords } from \"./bounds\";\r\nimport { rotate } from \"../math\";\r\nconst transformHandleSizes = {\r\n    mouse: 8,\r\n    pen: 16,\r\n    touch: 28,\r\n};\r\nconst ROTATION_RESIZE_HANDLE_GAP = 16;\r\nexport const OMIT_SIDES_FOR_MULTIPLE_ELEMENTS = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n};\r\nconst OMIT_SIDES_FOR_TEXT_ELEMENT = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n};\r\nconst OMIT_SIDES_FOR_LINE_SLASH = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n    nw: true,\r\n    se: true,\r\n};\r\nconst OMIT_SIDES_FOR_LINE_BACKSLASH = {\r\n    e: true,\r\n    s: true,\r\n    n: true,\r\n    w: true,\r\n    ne: true,\r\n    sw: true,\r\n};\r\nconst generateTransformHandle = (x, y, width, height, cx, cy, angle) => {\r\n    const [xx, yy] = rotate(x + width / 2, y + height / 2, cx, cy, angle);\r\n    return [xx - width / 2, yy - height / 2, width, height];\r\n};\r\nexport const getTransformHandlesFromCoords = ([x1, y1, x2, y2], angle, zoom, pointerType, omitSides = {}) => {\r\n    const size = transformHandleSizes[pointerType];\r\n    const handleWidth = size / zoom.value;\r\n    const handleHeight = size / zoom.value;\r\n    const handleMarginX = size / zoom.value;\r\n    const handleMarginY = size / zoom.value;\r\n    const width = x2 - x1;\r\n    const height = y2 - y1;\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    const dashedLineMargin = 4 / zoom.value;\r\n    const centeringOffset = (size - 8) / (2 * zoom.value);\r\n    const transformHandles = {\r\n        nw: omitSides.nw\r\n            ? undefined\r\n            : generateTransformHandle(x1 - dashedLineMargin - handleMarginX + centeringOffset, y1 - dashedLineMargin - handleMarginY + centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        ne: omitSides.ne\r\n            ? undefined\r\n            : generateTransformHandle(x2 + dashedLineMargin - centeringOffset, y1 - dashedLineMargin - handleMarginY + centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        sw: omitSides.sw\r\n            ? undefined\r\n            : generateTransformHandle(x1 - dashedLineMargin - handleMarginX + centeringOffset, y2 + dashedLineMargin - centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        se: omitSides.se\r\n            ? undefined\r\n            : generateTransformHandle(x2 + dashedLineMargin - centeringOffset, y2 + dashedLineMargin - centeringOffset, handleWidth, handleHeight, cx, cy, angle),\r\n        rotation: omitSides.rotation\r\n            ? undefined\r\n            : generateTransformHandle(x1 + width / 2 - handleWidth / 2, y1 -\r\n                dashedLineMargin -\r\n                handleMarginY +\r\n                centeringOffset -\r\n                ROTATION_RESIZE_HANDLE_GAP / zoom.value, handleWidth, handleHeight, cx, cy, angle),\r\n    };\r\n    // We only want to show height handles (all cardinal directions)  above a certain size\r\n    // Note: we render using \"mouse\" size so we should also use \"mouse\" size for this check\r\n    const minimumSizeForEightHandles = (5 * transformHandleSizes.mouse) / zoom.value;\r\n    if (Math.abs(width) > minimumSizeForEightHandles) {\r\n        if (!omitSides.n) {\r\n            transformHandles.n = generateTransformHandle(x1 + width / 2 - handleWidth / 2, y1 - dashedLineMargin - handleMarginY + centeringOffset, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n        if (!omitSides.s) {\r\n            transformHandles.s = generateTransformHandle(x1 + width / 2 - handleWidth / 2, y2 + dashedLineMargin - centeringOffset, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n    }\r\n    if (Math.abs(height) > minimumSizeForEightHandles) {\r\n        if (!omitSides.w) {\r\n            transformHandles.w = generateTransformHandle(x1 - dashedLineMargin - handleMarginX + centeringOffset, y1 + height / 2 - handleHeight / 2, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n        if (!omitSides.e) {\r\n            transformHandles.e = generateTransformHandle(x2 + dashedLineMargin - centeringOffset, y1 + height / 2 - handleHeight / 2, handleWidth, handleHeight, cx, cy, angle);\r\n        }\r\n    }\r\n    return transformHandles;\r\n};\r\nexport const getTransformHandles = (element, zoom, pointerType = \"mouse\") => {\r\n    let omitSides = {};\r\n    if (element.type === \"arrow\" ||\r\n        element.type === \"line\" ||\r\n        element.type === \"freedraw\") {\r\n        if (element.points.length === 2) {\r\n            // only check the last point because starting point is always (0,0)\r\n            const [, p1] = element.points;\r\n            if (p1[0] === 0 || p1[1] === 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_BACKSLASH;\r\n            }\r\n            else if (p1[0] > 0 && p1[1] < 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_SLASH;\r\n            }\r\n            else if (p1[0] > 0 && p1[1] > 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_BACKSLASH;\r\n            }\r\n            else if (p1[0] < 0 && p1[1] > 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_SLASH;\r\n            }\r\n            else if (p1[0] < 0 && p1[1] < 0) {\r\n                omitSides = OMIT_SIDES_FOR_LINE_BACKSLASH;\r\n            }\r\n        }\r\n    }\r\n    else if (element.type === \"text\") {\r\n        omitSides = OMIT_SIDES_FOR_TEXT_ELEMENT;\r\n    }\r\n    return getTransformHandlesFromCoords(getElementAbsoluteCoords(element), element.angle, zoom, pointerType, omitSides);\r\n};\r\n","/**\r\n * This is a 2D Projective Geometric Algebra implementation.\r\n *\r\n * For wider context on geometric algebra visit see https://bivector.net.\r\n *\r\n * For this specific algebra see cheatsheet https://bivector.net/2DPGA.pdf.\r\n *\r\n * Converted from generator written by enki, with a ton of added on top.\r\n *\r\n * This library uses 8-vectors to represent points, directions and lines\r\n * in 2D space.\r\n *\r\n * An array `[a, b, c, d, e, f, g, h]` represents a n(8)vector:\r\n *   a + b*e0 + c*e1 + d*e2 + e*e01 + f*e20 + g*e12 + h*e012\r\n *\r\n * See GAPoint, GALine, GADirection and GATransform modules for common\r\n * operations.\r\n */\r\nexport const point = (x, y) => [0, 0, 0, 0, y, x, 1, 0];\r\nexport const origin = () => [0, 0, 0, 0, 0, 0, 1, 0];\r\nexport const direction = (x, y) => {\r\n    const norm = Math.hypot(x, y); // same as `inorm(direction(x, y))`\r\n    return [0, 0, 0, 0, y / norm, x / norm, 0, 0];\r\n};\r\nexport const offset = (x, y) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    y,\r\n    x,\r\n    0,\r\n    0,\r\n];\r\n// These are labels for what each number in an nvector represents\r\nconst NVECTOR_BASE = [\"1\", \"e0\", \"e1\", \"e2\", \"e01\", \"e20\", \"e12\", \"e012\"];\r\n// Used to represent points, lines and transformations\r\nexport const nvector = (value = 0, index = 0) => {\r\n    const result = [0, 0, 0, 0, 0, 0, 0, 0];\r\n    if (index < 0 || index > 7) {\r\n        throw new Error(`Expected \\`index\\` betwen 0 and 7, got \\`${index}\\``);\r\n    }\r\n    if (value !== 0) {\r\n        result[index] = value;\r\n    }\r\n    return result;\r\n};\r\nconst STRING_EPSILON = 0.000001;\r\nexport const toString = (nvector) => {\r\n    const result = nvector\r\n        .map((value, index) => Math.abs(value) > STRING_EPSILON\r\n        ? value.toFixed(7).replace(/(\\.|0+)$/, \"\") +\r\n            (index > 0 ? NVECTOR_BASE[index] : \"\")\r\n        : null)\r\n        .filter((representation) => representation != null)\r\n        .join(\" + \");\r\n    return result === \"\" ? \"0\" : result;\r\n};\r\n// Reverse the order of the basis blades.\r\nexport const reverse = (nvector) => [\r\n    nvector[0],\r\n    nvector[1],\r\n    nvector[2],\r\n    nvector[3],\r\n    -nvector[4],\r\n    -nvector[5],\r\n    -nvector[6],\r\n    -nvector[7],\r\n];\r\n// Poincare duality operator.\r\nexport const dual = (nvector) => [\r\n    nvector[7],\r\n    nvector[6],\r\n    nvector[5],\r\n    nvector[4],\r\n    nvector[3],\r\n    nvector[2],\r\n    nvector[1],\r\n    nvector[0],\r\n];\r\n// Clifford Conjugation\r\nexport const conjugate = (nvector) => [\r\n    nvector[0],\r\n    -nvector[1],\r\n    -nvector[2],\r\n    -nvector[3],\r\n    -nvector[4],\r\n    -nvector[5],\r\n    -nvector[6],\r\n    nvector[7],\r\n];\r\n// Main involution\r\nexport const involute = (nvector) => [\r\n    nvector[0],\r\n    -nvector[1],\r\n    -nvector[2],\r\n    -nvector[3],\r\n    nvector[4],\r\n    nvector[5],\r\n    nvector[6],\r\n    -nvector[7],\r\n];\r\n// Multivector addition\r\nexport const add = (a, b) => {\r\n    if (isNumber(b)) {\r\n        return [a[0] + b, a[1], a[2], a[3], a[4], a[5], a[6], a[7]];\r\n    }\r\n    return [\r\n        a[0] + b[0],\r\n        a[1] + b[1],\r\n        a[2] + b[2],\r\n        a[3] + b[3],\r\n        a[4] + b[4],\r\n        a[5] + b[5],\r\n        a[6] + b[6],\r\n        a[7] + b[7],\r\n    ];\r\n};\r\n// Multivector subtraction\r\nexport const sub = (a, b) => {\r\n    if (isNumber(b)) {\r\n        return [a[0] - b, a[1], a[2], a[3], a[4], a[5], a[6], a[7]];\r\n    }\r\n    return [\r\n        a[0] - b[0],\r\n        a[1] - b[1],\r\n        a[2] - b[2],\r\n        a[3] - b[3],\r\n        a[4] - b[4],\r\n        a[5] - b[5],\r\n        a[6] - b[6],\r\n        a[7] - b[7],\r\n    ];\r\n};\r\n// The geometric product.\r\nexport const mul = (a, b) => {\r\n    if (isNumber(b)) {\r\n        return [\r\n            a[0] * b,\r\n            a[1] * b,\r\n            a[2] * b,\r\n            a[3] * b,\r\n            a[4] * b,\r\n            a[5] * b,\r\n            a[6] * b,\r\n            a[7] * b,\r\n        ];\r\n    }\r\n    return [\r\n        mulScalar(a, b),\r\n        b[1] * a[0] +\r\n            b[0] * a[1] -\r\n            b[4] * a[2] +\r\n            b[5] * a[3] +\r\n            b[2] * a[4] -\r\n            b[3] * a[5] -\r\n            b[7] * a[6] -\r\n            b[6] * a[7],\r\n        b[2] * a[0] + b[0] * a[2] - b[6] * a[3] + b[3] * a[6],\r\n        b[3] * a[0] + b[6] * a[2] + b[0] * a[3] - b[2] * a[6],\r\n        b[4] * a[0] +\r\n            b[2] * a[1] -\r\n            b[1] * a[2] +\r\n            b[7] * a[3] +\r\n            b[0] * a[4] +\r\n            b[6] * a[5] -\r\n            b[5] * a[6] +\r\n            b[3] * a[7],\r\n        b[5] * a[0] -\r\n            b[3] * a[1] +\r\n            b[7] * a[2] +\r\n            b[1] * a[3] -\r\n            b[6] * a[4] +\r\n            b[0] * a[5] +\r\n            b[4] * a[6] +\r\n            b[2] * a[7],\r\n        b[6] * a[0] + b[3] * a[2] - b[2] * a[3] + b[0] * a[6],\r\n        b[7] * a[0] +\r\n            b[6] * a[1] +\r\n            b[5] * a[2] +\r\n            b[4] * a[3] +\r\n            b[3] * a[4] +\r\n            b[2] * a[5] +\r\n            b[1] * a[6] +\r\n            b[0] * a[7],\r\n    ];\r\n};\r\nexport const mulScalar = (a, b) => b[0] * a[0] + b[2] * a[2] + b[3] * a[3] - b[6] * a[6];\r\n// The outer/exterior/wedge product.\r\nexport const meet = (a, b) => [\r\n    b[0] * a[0],\r\n    b[1] * a[0] + b[0] * a[1],\r\n    b[2] * a[0] + b[0] * a[2],\r\n    b[3] * a[0] + b[0] * a[3],\r\n    b[4] * a[0] + b[2] * a[1] - b[1] * a[2] + b[0] * a[4],\r\n    b[5] * a[0] - b[3] * a[1] + b[1] * a[3] + b[0] * a[5],\r\n    b[6] * a[0] + b[3] * a[2] - b[2] * a[3] + b[0] * a[6],\r\n    b[7] * a[0] +\r\n        b[6] * a[1] +\r\n        b[5] * a[2] +\r\n        b[4] * a[3] +\r\n        b[3] * a[4] +\r\n        b[2] * a[5] +\r\n        b[1] * a[6],\r\n];\r\n// The regressive product.\r\nexport const join = (a, b) => [\r\n    joinScalar(a, b),\r\n    a[1] * b[7] + a[4] * b[5] - a[5] * b[4] + a[7] * b[1],\r\n    a[2] * b[7] - a[4] * b[6] + a[6] * b[4] + a[7] * b[2],\r\n    a[3] * b[7] + a[5] * b[6] - a[6] * b[5] + a[7] * b[3],\r\n    a[4] * b[7] + a[7] * b[4],\r\n    a[5] * b[7] + a[7] * b[5],\r\n    a[6] * b[7] + a[7] * b[6],\r\n    a[7] * b[7],\r\n];\r\nexport const joinScalar = (a, b) => a[0] * b[7] +\r\n    a[1] * b[6] +\r\n    a[2] * b[5] +\r\n    a[3] * b[4] +\r\n    a[4] * b[3] +\r\n    a[5] * b[2] +\r\n    a[6] * b[1] +\r\n    a[7] * b[0];\r\n// The inner product.\r\nexport const dot = (a, b) => [\r\n    b[0] * a[0] + b[2] * a[2] + b[3] * a[3] - b[6] * a[6],\r\n    b[1] * a[0] +\r\n        b[0] * a[1] -\r\n        b[4] * a[2] +\r\n        b[5] * a[3] +\r\n        b[2] * a[4] -\r\n        b[3] * a[5] -\r\n        b[7] * a[6] -\r\n        b[6] * a[7],\r\n    b[2] * a[0] + b[0] * a[2] - b[6] * a[3] + b[3] * a[6],\r\n    b[3] * a[0] + b[6] * a[2] + b[0] * a[3] - b[2] * a[6],\r\n    b[4] * a[0] + b[7] * a[3] + b[0] * a[4] + b[3] * a[7],\r\n    b[5] * a[0] + b[7] * a[2] + b[0] * a[5] + b[2] * a[7],\r\n    b[6] * a[0] + b[0] * a[6],\r\n    b[7] * a[0] + b[0] * a[7],\r\n];\r\nexport const norm = (a) => Math.sqrt(Math.abs(a[0] * a[0] - a[2] * a[2] - a[3] * a[3] + a[6] * a[6]));\r\nexport const inorm = (a) => Math.sqrt(Math.abs(a[7] * a[7] - a[5] * a[5] - a[4] * a[4] + a[1] * a[1]));\r\nexport const normalized = (a) => {\r\n    const n = norm(a);\r\n    if (n === 0 || n === 1) {\r\n        return a;\r\n    }\r\n    const sign = a[6] < 0 ? -1 : 1;\r\n    return mul(a, sign / n);\r\n};\r\nexport const inormalized = (a) => {\r\n    const n = inorm(a);\r\n    if (n === 0 || n === 1) {\r\n        return a;\r\n    }\r\n    return mul(a, 1 / n);\r\n};\r\nconst isNumber = (a) => typeof a === \"number\";\r\nexport const E0 = nvector(1, 1);\r\nexport const E1 = nvector(1, 2);\r\nexport const E2 = nvector(1, 3);\r\nexport const E01 = nvector(1, 4);\r\nexport const E20 = nvector(1, 5);\r\nexport const E12 = nvector(1, 6);\r\nexport const E012 = nvector(1, 7);\r\nexport const I = E012;\r\n","import * as GA from \"./ga\";\r\n/**\r\n * A line is stored as an array `[0, c, a, b, 0, 0, 0, 0]` representing:\r\n *   c * e0 + a * e1 + b*e2\r\n *\r\n * This maps to a standard formula `a * x + b * y + c`.\r\n *\r\n * `(-b, a)` correponds to a 2D vector parallel to the line. The lines\r\n * have a natural orientation, corresponding to that vector.\r\n *\r\n * The magnitude (\"norm\") of the line is `sqrt(a ^ 2 + b ^ 2)`.\r\n * `c / norm(line)` is the oriented distance from line to origin.\r\n */\r\n// Returns line with direction (x, y) through origin\r\nexport const vector = (x, y) => GA.normalized([0, 0, -y, x, 0, 0, 0, 0]);\r\n// For equation ax + by + c = 0.\r\nexport const equation = (a, b, c) => GA.normalized([0, c, a, b, 0, 0, 0, 0]);\r\nexport const through = (from, to) => GA.normalized(GA.join(to, from));\r\nexport const orthogonal = (line, point) => GA.dot(line, point);\r\n// Returns a line perpendicular to the line through `against` and `intersection`\r\n// going through `intersection`.\r\nexport const orthogonalThrough = (against, intersection) => orthogonal(through(against, intersection), intersection);\r\nexport const parallel = (line, distance) => {\r\n    const result = line.slice();\r\n    result[1] -= distance;\r\n    return result;\r\n};\r\nexport const parallelThrough = (line, point) => orthogonal(orthogonal(point, line), point);\r\nexport const distance = (line1, line2) => GA.inorm(GA.meet(line1, line2));\r\nexport const angle = (line1, line2) => Math.acos(GA.dot(line1, line2)[0]);\r\n// The orientation of the line\r\nexport const sign = (line) => Math.sign(line[1]);\r\n","import * as GA from \"./ga\";\r\nimport * as GALine from \"./galines\";\r\nimport { join } from \"./ga\";\r\nexport const from = ([x, y]) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    y,\r\n    x,\r\n    1,\r\n    0,\r\n];\r\nexport const toTuple = (point) => [point[5], point[4]];\r\nexport const abs = (point) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    Math.abs(point[4]),\r\n    Math.abs(point[5]),\r\n    1,\r\n    0,\r\n];\r\nexport const intersect = (line1, line2) => GA.normalized(GA.meet(line1, line2));\r\n// Projects `point` onto the `line`.\r\n// The returned point is the closest point on the `line` to the `point`.\r\nexport const project = (point, line) => intersect(GALine.orthogonal(line, point), line);\r\nexport const distance = (point1, point2) => GA.norm(join(point1, point2));\r\nexport const distanceToLine = (point, line) => GA.joinScalar(point, line);\r\n","import * as GA from \"./ga\";\r\n/**\r\n * A direction is stored as an array `[0, 0, 0, 0, y, x, 0, 0]` representing\r\n * vector `(x, y)`.\r\n */\r\nexport const from = (point) => [\r\n    0,\r\n    0,\r\n    0,\r\n    0,\r\n    point[4],\r\n    point[5],\r\n    0,\r\n    0,\r\n];\r\nexport const fromTo = (from, to) => GA.inormalized([0, 0, 0, 0, to[4] - from[4], to[5] - from[5], 0, 0]);\r\nexport const orthogonal = (direction) => GA.inormalized([0, 0, 0, 0, -direction[5], direction[4], 0, 0]);\r\nexport const orthogonalToLine = (line) => GA.mul(line, GA.I);\r\n","import * as GA from \"./ga\";\r\nimport * as GADirection from \"./gadirections\";\r\n/**\r\n * TODO: docs\r\n */\r\nexport const rotation = (pivot, angle) => GA.add(GA.mul(pivot, Math.sin(angle / 2)), Math.cos(angle / 2));\r\nexport const translation = (direction) => [\r\n    1,\r\n    0,\r\n    0,\r\n    0,\r\n    -(0.5 * direction[5]),\r\n    0.5 * direction[4],\r\n    0,\r\n    0,\r\n];\r\nexport const translationOrthogonal = (direction, distance) => {\r\n    const scale = 0.5 * distance;\r\n    return [1, 0, 0, 0, scale * direction[4], scale * direction[5], 0, 0];\r\n};\r\nexport const translationAlong = (line, distance) => GA.add(GA.mul(GADirection.orthogonalToLine(line), 0.5 * distance), 1);\r\nexport const compose = (motor1, motor2) => GA.mul(motor2, motor1);\r\nexport const apply = (motor, nvector) => GA.normalized(GA.mul(GA.mul(motor, nvector), GA.reverse(motor)));\r\n","import * as GA from \"../ga\";\r\nimport * as GAPoint from \"../gapoints\";\r\nimport * as GADirection from \"../gadirections\";\r\nimport * as GALine from \"../galines\";\r\nimport * as GATransform from \"../gatransforms\";\r\nimport { distance2d, rotatePoint, isPathALoop, isPointInPolygon, rotate, } from \"../math\";\r\nimport { pointsOnBezierCurves } from \"points-on-curve\";\r\nimport { getElementAbsoluteCoords, getCurvePathOps } from \"./bounds\";\r\nimport { getShapeForElement } from \"../renderer/renderElement\";\r\nimport { isImageElement } from \"./typeChecks\";\r\nconst isElementDraggableFromInside = (element) => {\r\n    if (element.type === \"arrow\") {\r\n        return false;\r\n    }\r\n    if (element.type === \"freedraw\") {\r\n        return true;\r\n    }\r\n    const isDraggableFromInside = element.backgroundColor !== \"transparent\";\r\n    if (element.type === \"line\") {\r\n        return isDraggableFromInside && isPathALoop(element.points);\r\n    }\r\n    return isDraggableFromInside || isImageElement(element);\r\n};\r\nexport const hitTest = (element, appState, x, y) => {\r\n    // How many pixels off the shape boundary we still consider a hit\r\n    const threshold = 10 / appState.zoom.value;\r\n    const point = [x, y];\r\n    if (isElementSelected(appState, element)) {\r\n        return isPointHittingElementBoundingBox(element, point, threshold);\r\n    }\r\n    return isHittingElementNotConsideringBoundingBox(element, appState, point);\r\n};\r\nexport const isHittingElementBoundingBoxWithoutHittingElement = (element, appState, x, y) => {\r\n    const threshold = 10 / appState.zoom.value;\r\n    return (!isHittingElementNotConsideringBoundingBox(element, appState, [x, y]) &&\r\n        isPointHittingElementBoundingBox(element, [x, y], threshold));\r\n};\r\nconst isHittingElementNotConsideringBoundingBox = (element, appState, point) => {\r\n    const threshold = 10 / appState.zoom.value;\r\n    const check = element.type === \"text\"\r\n        ? isStrictlyInside\r\n        : isElementDraggableFromInside(element)\r\n            ? isInsideCheck\r\n            : isNearCheck;\r\n    return hitTestPointAgainstElement({ element, point, threshold, check });\r\n};\r\nconst isElementSelected = (appState, element) => appState.selectedElementIds[element.id];\r\nconst isPointHittingElementBoundingBox = (element, [x, y], threshold) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const elementCenterX = (x1 + x2) / 2;\r\n    const elementCenterY = (y1 + y2) / 2;\r\n    // reverse rotate to take element's angle into account.\r\n    const [rotatedX, rotatedY] = rotate(x, y, elementCenterX, elementCenterY, -element.angle);\r\n    return (rotatedX > x1 - threshold &&\r\n        rotatedX < x2 + threshold &&\r\n        rotatedY > y1 - threshold &&\r\n        rotatedY < y2 + threshold);\r\n};\r\nexport const bindingBorderTest = (element, { x, y }) => {\r\n    const threshold = maxBindingGap(element, element.width, element.height);\r\n    const check = isOutsideCheck;\r\n    const point = [x, y];\r\n    return hitTestPointAgainstElement({ element, point, threshold, check });\r\n};\r\nexport const maxBindingGap = (element, elementWidth, elementHeight) => {\r\n    // Aligns diamonds with rectangles\r\n    const shapeRatio = element.type === \"diamond\" ? 1 / Math.sqrt(2) : 1;\r\n    const smallerDimension = shapeRatio * Math.min(elementWidth, elementHeight);\r\n    // We make the bindable boundary bigger for bigger elements\r\n    return Math.max(16, Math.min(0.25 * smallerDimension, 32));\r\n};\r\nconst hitTestPointAgainstElement = (args) => {\r\n    switch (args.element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n        case \"diamond\":\r\n        case \"ellipse\":\r\n            const distance = distanceToBindableElement(args.element, args.point);\r\n            return args.check(distance, args.threshold);\r\n        case \"freedraw\": {\r\n            if (!args.check(distanceToRectangle(args.element, args.point), args.threshold)) {\r\n                return false;\r\n            }\r\n            return hitTestFreeDrawElement(args.element, args.point, args.threshold);\r\n        }\r\n        case \"arrow\":\r\n        case \"line\":\r\n            return hitTestLinear(args);\r\n        case \"selection\":\r\n            console.warn(\"This should not happen, we need to investigate why it does.\");\r\n            return false;\r\n    }\r\n};\r\nexport const distanceToBindableElement = (element, point) => {\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n            return distanceToRectangle(element, point);\r\n        case \"diamond\":\r\n            return distanceToDiamond(element, point);\r\n        case \"ellipse\":\r\n            return distanceToEllipse(element, point);\r\n    }\r\n};\r\nconst isStrictlyInside = (distance, threshold) => {\r\n    return distance < 0;\r\n};\r\nconst isInsideCheck = (distance, threshold) => {\r\n    return distance < threshold;\r\n};\r\nconst isNearCheck = (distance, threshold) => {\r\n    return Math.abs(distance) < threshold;\r\n};\r\nconst isOutsideCheck = (distance, threshold) => {\r\n    return 0 <= distance && distance < threshold;\r\n};\r\nconst distanceToRectangle = (element, point) => {\r\n    const [, pointRel, hwidth, hheight] = pointRelativeToElement(element, point);\r\n    return Math.max(GAPoint.distanceToLine(pointRel, GALine.equation(0, 1, -hheight)), GAPoint.distanceToLine(pointRel, GALine.equation(1, 0, -hwidth)));\r\n};\r\nconst distanceToDiamond = (element, point) => {\r\n    const [, pointRel, hwidth, hheight] = pointRelativeToElement(element, point);\r\n    const side = GALine.equation(hheight, hwidth, -hheight * hwidth);\r\n    return GAPoint.distanceToLine(pointRel, side);\r\n};\r\nconst distanceToEllipse = (element, point) => {\r\n    const [pointRel, tangent] = ellipseParamsForTest(element, point);\r\n    return -GALine.sign(tangent) * GAPoint.distanceToLine(pointRel, tangent);\r\n};\r\nconst ellipseParamsForTest = (element, point) => {\r\n    const [, pointRel, hwidth, hheight] = pointRelativeToElement(element, point);\r\n    const [px, py] = GAPoint.toTuple(pointRel);\r\n    // We're working in positive quadrant, so start with `t = 45deg`, `tx=cos(t)`\r\n    let tx = 0.707;\r\n    let ty = 0.707;\r\n    const a = hwidth;\r\n    const b = hheight;\r\n    // This is a numerical method to find the params tx, ty at which\r\n    // the ellipse has the closest point to the given point\r\n    [0, 1, 2, 3].forEach((_) => {\r\n        const xx = a * tx;\r\n        const yy = b * ty;\r\n        const ex = ((a * a - b * b) * tx ** 3) / a;\r\n        const ey = ((b * b - a * a) * ty ** 3) / b;\r\n        const rx = xx - ex;\r\n        const ry = yy - ey;\r\n        const qx = px - ex;\r\n        const qy = py - ey;\r\n        const r = Math.hypot(ry, rx);\r\n        const q = Math.hypot(qy, qx);\r\n        tx = Math.min(1, Math.max(0, ((qx * r) / q + ex) / a));\r\n        ty = Math.min(1, Math.max(0, ((qy * r) / q + ey) / b));\r\n        const t = Math.hypot(ty, tx);\r\n        tx /= t;\r\n        ty /= t;\r\n    });\r\n    const closestPoint = GA.point(a * tx, b * ty);\r\n    const tangent = GALine.orthogonalThrough(pointRel, closestPoint);\r\n    return [pointRel, tangent];\r\n};\r\nconst hitTestFreeDrawElement = (element, point, threshold) => {\r\n    // Check point-distance-to-line-segment for every segment in the\r\n    // element's points (its input points, not its outline points).\r\n    // This is... okay? It's plenty fast, but the GA library may\r\n    // have a faster option.\r\n    let x;\r\n    let y;\r\n    if (element.angle === 0) {\r\n        x = point[0] - element.x;\r\n        y = point[1] - element.y;\r\n    }\r\n    else {\r\n        // Counter-rotate the point around center before testing\r\n        const [minX, minY, maxX, maxY] = getElementAbsoluteCoords(element);\r\n        const rotatedPoint = rotatePoint(point, [minX + (maxX - minX) / 2, minY + (maxY - minY) / 2], -element.angle);\r\n        x = rotatedPoint[0] - element.x;\r\n        y = rotatedPoint[1] - element.y;\r\n    }\r\n    let [A, B] = element.points;\r\n    let P;\r\n    // For freedraw dots\r\n    if (distance2d(A[0], A[1], x, y) < threshold ||\r\n        distance2d(B[0], B[1], x, y) < threshold) {\r\n        return true;\r\n    }\r\n    // For freedraw lines\r\n    for (let i = 0; i < element.points.length; i++) {\r\n        const delta = [B[0] - A[0], B[1] - A[1]];\r\n        const length = Math.hypot(delta[1], delta[0]);\r\n        const U = [delta[0] / length, delta[1] / length];\r\n        const C = [x - A[0], y - A[1]];\r\n        const d = (C[0] * U[0] + C[1] * U[1]) / Math.hypot(U[1], U[0]);\r\n        P = [A[0] + U[0] * d, A[1] + U[1] * d];\r\n        const da = distance2d(P[0], P[1], A[0], A[1]);\r\n        const db = distance2d(P[0], P[1], B[0], B[1]);\r\n        P = db < da && da > length ? B : da < db && db > length ? A : P;\r\n        if (Math.hypot(y - P[1], x - P[0]) < threshold) {\r\n            return true;\r\n        }\r\n        A = B;\r\n        B = element.points[i + 1];\r\n    }\r\n    return false;\r\n};\r\nconst hitTestLinear = (args) => {\r\n    const { element, threshold } = args;\r\n    if (!getShapeForElement(element)) {\r\n        return false;\r\n    }\r\n    const [point, pointAbs, hwidth, hheight] = pointRelativeToElement(args.element, args.point);\r\n    const side1 = GALine.equation(0, 1, -hheight);\r\n    const side2 = GALine.equation(1, 0, -hwidth);\r\n    if (!isInsideCheck(GAPoint.distanceToLine(pointAbs, side1), threshold) ||\r\n        !isInsideCheck(GAPoint.distanceToLine(pointAbs, side2), threshold)) {\r\n        return false;\r\n    }\r\n    const [relX, relY] = GAPoint.toTuple(point);\r\n    const shape = getShapeForElement(element);\r\n    if (args.check === isInsideCheck) {\r\n        const hit = shape.some((subshape) => hitTestCurveInside(subshape, relX, relY, element.strokeSharpness));\r\n        if (hit) {\r\n            return true;\r\n        }\r\n    }\r\n    // hit test all \"subshapes\" of the linear element\r\n    return shape.some((subshape) => hitTestRoughShape(subshape, relX, relY, threshold));\r\n};\r\n// Returns:\r\n//   1. the point relative to the elements (x, y) position\r\n//   2. the point relative to the element's center with positive (x, y)\r\n//   3. half element width\r\n//   4. half element height\r\n//\r\n// Note that for linear elements the (x, y) position is not at the\r\n// top right corner of their boundary.\r\n//\r\n// Rectangles, diamonds and ellipses are symmetrical over axes,\r\n// and other elements have a rectangular boundary,\r\n// so we only need to perform hit tests for the positive quadrant.\r\nconst pointRelativeToElement = (element, pointTuple) => {\r\n    const point = GAPoint.from(pointTuple);\r\n    const elementCoords = getElementAbsoluteCoords(element);\r\n    const center = coordsCenter(elementCoords);\r\n    // GA has angle orientation opposite to `rotate`\r\n    const rotate = GATransform.rotation(center, element.angle);\r\n    const pointRotated = GATransform.apply(rotate, point);\r\n    const pointRelToCenter = GA.sub(pointRotated, GADirection.from(center));\r\n    const pointRelToCenterAbs = GAPoint.abs(pointRelToCenter);\r\n    const elementPos = GA.offset(element.x, element.y);\r\n    const pointRelToPos = GA.sub(pointRotated, elementPos);\r\n    const [ax, ay, bx, by] = elementCoords;\r\n    const halfWidth = (bx - ax) / 2;\r\n    const halfHeight = (by - ay) / 2;\r\n    return [pointRelToPos, pointRelToCenterAbs, halfWidth, halfHeight];\r\n};\r\n// Returns point in absolute coordinates\r\nexport const pointInAbsoluteCoords = (element, \r\n// Point relative to the element position\r\npoint) => {\r\n    const [x, y] = point;\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x2 - x1) / 2;\r\n    const cy = (y2 - y1) / 2;\r\n    const [rotatedX, rotatedY] = rotate(x, y, cx, cy, element.angle);\r\n    return [element.x + rotatedX, element.y + rotatedY];\r\n};\r\nconst relativizationToElementCenter = (element) => {\r\n    const elementCoords = getElementAbsoluteCoords(element);\r\n    const center = coordsCenter(elementCoords);\r\n    // GA has angle orientation opposite to `rotate`\r\n    const rotate = GATransform.rotation(center, element.angle);\r\n    const translate = GA.reverse(GATransform.translation(GADirection.from(center)));\r\n    return GATransform.compose(rotate, translate);\r\n};\r\nconst coordsCenter = ([ax, ay, bx, by]) => {\r\n    return GA.point((ax + bx) / 2, (ay + by) / 2);\r\n};\r\n// The focus distance is the oriented ratio between the size of\r\n// the `element` and the \"focus image\" of the element on which\r\n// all focus points lie, so it's a number between -1 and 1.\r\n// The line going through `a` and `b` is a tangent to the \"focus image\"\r\n// of the element.\r\nexport const determineFocusDistance = (element, \r\n// Point on the line, in absolute coordinates\r\na, \r\n// Another point on the line, in absolute coordinates (closer to element)\r\nb) => {\r\n    const relateToCenter = relativizationToElementCenter(element);\r\n    const aRel = GATransform.apply(relateToCenter, GAPoint.from(a));\r\n    const bRel = GATransform.apply(relateToCenter, GAPoint.from(b));\r\n    const line = GALine.through(aRel, bRel);\r\n    const q = element.height / element.width;\r\n    const hwidth = element.width / 2;\r\n    const hheight = element.height / 2;\r\n    const n = line[2];\r\n    const m = line[3];\r\n    const c = line[1];\r\n    const mabs = Math.abs(m);\r\n    const nabs = Math.abs(n);\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n            return c / (hwidth * (nabs + q * mabs));\r\n        case \"diamond\":\r\n            return mabs < nabs ? c / (nabs * hwidth) : c / (mabs * hheight);\r\n        case \"ellipse\":\r\n            return c / (hwidth * Math.sqrt(n ** 2 + q ** 2 * m ** 2));\r\n    }\r\n};\r\nexport const determineFocusPoint = (element, \r\n// The oriented, relative distance from the center of `element` of the\r\n// returned focusPoint\r\nfocus, adjecentPoint) => {\r\n    if (focus === 0) {\r\n        const elementCoords = getElementAbsoluteCoords(element);\r\n        const center = coordsCenter(elementCoords);\r\n        return GAPoint.toTuple(center);\r\n    }\r\n    const relateToCenter = relativizationToElementCenter(element);\r\n    const adjecentPointRel = GATransform.apply(relateToCenter, GAPoint.from(adjecentPoint));\r\n    const reverseRelateToCenter = GA.reverse(relateToCenter);\r\n    let point;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n        case \"diamond\":\r\n            point = findFocusPointForRectangulars(element, focus, adjecentPointRel);\r\n            break;\r\n        case \"ellipse\":\r\n            point = findFocusPointForEllipse(element, focus, adjecentPointRel);\r\n            break;\r\n    }\r\n    return GAPoint.toTuple(GATransform.apply(reverseRelateToCenter, point));\r\n};\r\n// Returns 2 or 0 intersection points between line going through `a` and `b`\r\n// and the `element`, in ascending order of distance from `a`.\r\nexport const intersectElementWithLine = (element, \r\n// Point on the line, in absolute coordinates\r\na, \r\n// Another point on the line, in absolute coordinates\r\nb, \r\n// If given, the element is inflated by this value\r\ngap = 0) => {\r\n    const relateToCenter = relativizationToElementCenter(element);\r\n    const aRel = GATransform.apply(relateToCenter, GAPoint.from(a));\r\n    const bRel = GATransform.apply(relateToCenter, GAPoint.from(b));\r\n    const line = GALine.through(aRel, bRel);\r\n    const reverseRelateToCenter = GA.reverse(relateToCenter);\r\n    const intersections = getSortedElementLineIntersections(element, line, aRel, gap);\r\n    return intersections.map((point) => GAPoint.toTuple(GATransform.apply(reverseRelateToCenter, point)));\r\n};\r\nconst getSortedElementLineIntersections = (element, \r\n// Relative to element center\r\nline, \r\n// Relative to element center\r\nnearPoint, gap = 0) => {\r\n    let intersections;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n        case \"diamond\":\r\n            const corners = getCorners(element);\r\n            intersections = corners\r\n                .flatMap((point, i) => {\r\n                const edge = [point, corners[(i + 1) % 4]];\r\n                return intersectSegment(line, offsetSegment(edge, gap));\r\n            })\r\n                .concat(corners.flatMap((point) => getCircleIntersections(point, gap, line)));\r\n            break;\r\n        case \"ellipse\":\r\n            intersections = getEllipseIntersections(element, gap, line);\r\n            break;\r\n    }\r\n    if (intersections.length < 2) {\r\n        // Ignore the \"edge\" case of only intersecting with a single corner\r\n        return [];\r\n    }\r\n    const sortedIntersections = intersections.sort((i1, i2) => GAPoint.distance(i1, nearPoint) - GAPoint.distance(i2, nearPoint));\r\n    return [\r\n        sortedIntersections[0],\r\n        sortedIntersections[sortedIntersections.length - 1],\r\n    ];\r\n};\r\nconst getCorners = (element, scale = 1) => {\r\n    const hx = (scale * element.width) / 2;\r\n    const hy = (scale * element.height) / 2;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"image\":\r\n        case \"text\":\r\n            return [\r\n                GA.point(hx, hy),\r\n                GA.point(hx, -hy),\r\n                GA.point(-hx, -hy),\r\n                GA.point(-hx, hy),\r\n            ];\r\n        case \"diamond\":\r\n            return [\r\n                GA.point(0, hy),\r\n                GA.point(hx, 0),\r\n                GA.point(0, -hy),\r\n                GA.point(-hx, 0),\r\n            ];\r\n    }\r\n};\r\n// Returns intersection of `line` with `segment`, with `segment` moved by\r\n// `gap` in its polar direction.\r\n// If intersection conincides with second segment point returns empty array.\r\nconst intersectSegment = (line, segment) => {\r\n    const [a, b] = segment;\r\n    const aDist = GAPoint.distanceToLine(a, line);\r\n    const bDist = GAPoint.distanceToLine(b, line);\r\n    if (aDist * bDist >= 0) {\r\n        // The intersection is outside segment `(a, b)`\r\n        return [];\r\n    }\r\n    return [GAPoint.intersect(line, GALine.through(a, b))];\r\n};\r\nconst offsetSegment = (segment, distance) => {\r\n    const [a, b] = segment;\r\n    const offset = GATransform.translationOrthogonal(GADirection.fromTo(a, b), distance);\r\n    return [GATransform.apply(offset, a), GATransform.apply(offset, b)];\r\n};\r\nconst getEllipseIntersections = (element, gap, line) => {\r\n    const a = element.width / 2 + gap;\r\n    const b = element.height / 2 + gap;\r\n    const m = line[2];\r\n    const n = line[3];\r\n    const c = line[1];\r\n    const squares = a * a * m * m + b * b * n * n;\r\n    const discr = squares - c * c;\r\n    if (squares === 0 || discr <= 0) {\r\n        return [];\r\n    }\r\n    const discrRoot = Math.sqrt(discr);\r\n    const xn = -a * a * m * c;\r\n    const yn = -b * b * n * c;\r\n    return [\r\n        GA.point((xn + a * b * n * discrRoot) / squares, (yn - a * b * m * discrRoot) / squares),\r\n        GA.point((xn - a * b * n * discrRoot) / squares, (yn + a * b * m * discrRoot) / squares),\r\n    ];\r\n};\r\nexport const getCircleIntersections = (center, radius, line) => {\r\n    if (radius === 0) {\r\n        return GAPoint.distanceToLine(line, center) === 0 ? [center] : [];\r\n    }\r\n    const m = line[2];\r\n    const n = line[3];\r\n    const c = line[1];\r\n    const [a, b] = GAPoint.toTuple(center);\r\n    const r = radius;\r\n    const squares = m * m + n * n;\r\n    const discr = r * r * squares - (m * a + n * b + c) ** 2;\r\n    if (squares === 0 || discr <= 0) {\r\n        return [];\r\n    }\r\n    const discrRoot = Math.sqrt(discr);\r\n    const xn = a * n * n - b * m * n - m * c;\r\n    const yn = b * m * m - a * m * n - n * c;\r\n    return [\r\n        GA.point((xn + n * discrRoot) / squares, (yn - m * discrRoot) / squares),\r\n        GA.point((xn - n * discrRoot) / squares, (yn + m * discrRoot) / squares),\r\n    ];\r\n};\r\n// The focus point is the tangent point of the \"focus image\" of the\r\n// `element`, where the tangent goes through `point`.\r\nexport const findFocusPointForEllipse = (ellipse, \r\n// Between -1 and 1 (not 0) the relative size of the \"focus image\" of\r\n// the element on which the focus point lies\r\nrelativeDistance, \r\n// The point for which we're trying to find the focus point, relative\r\n// to the ellipse center.\r\npoint) => {\r\n    const relativeDistanceAbs = Math.abs(relativeDistance);\r\n    const a = (ellipse.width * relativeDistanceAbs) / 2;\r\n    const b = (ellipse.height * relativeDistanceAbs) / 2;\r\n    const orientation = Math.sign(relativeDistance);\r\n    const [px, pyo] = GAPoint.toTuple(point);\r\n    // The calculation below can't handle py = 0\r\n    const py = pyo === 0 ? 0.0001 : pyo;\r\n    const squares = px ** 2 * b ** 2 + py ** 2 * a ** 2;\r\n    // Tangent mx + ny + 1 = 0\r\n    const m = (-px * b ** 2 +\r\n        orientation * py * Math.sqrt(Math.max(0, squares - a ** 2 * b ** 2))) /\r\n        squares;\r\n    const n = (-m * px - 1) / py;\r\n    const x = -(a ** 2 * m) / (n ** 2 * b ** 2 + m ** 2 * a ** 2);\r\n    return GA.point(x, (-m * x - 1) / n);\r\n};\r\nexport const findFocusPointForRectangulars = (element, \r\n// Between -1 and 1 for how far away should the focus point be relative\r\n// to the size of the element. Sign determines orientation.\r\nrelativeDistance, \r\n// The point for which we're trying to find the focus point, relative\r\n// to the element center.\r\npoint) => {\r\n    const relativeDistanceAbs = Math.abs(relativeDistance);\r\n    const orientation = Math.sign(relativeDistance);\r\n    const corners = getCorners(element, relativeDistanceAbs);\r\n    let maxDistance = 0;\r\n    let tangentPoint = null;\r\n    corners.forEach((corner) => {\r\n        const distance = orientation * GALine.through(point, corner)[1];\r\n        if (distance > maxDistance) {\r\n            maxDistance = distance;\r\n            tangentPoint = corner;\r\n        }\r\n    });\r\n    return tangentPoint;\r\n};\r\nconst pointInBezierEquation = (p0, p1, p2, p3, [mx, my], lineThreshold) => {\r\n    // B(t) = p0 * (1-t)^3 + 3p1 * t * (1-t)^2 + 3p2 * t^2 * (1-t) + p3 * t^3\r\n    const equation = (t, idx) => Math.pow(1 - t, 3) * p3[idx] +\r\n        3 * t * Math.pow(1 - t, 2) * p2[idx] +\r\n        3 * Math.pow(t, 2) * (1 - t) * p1[idx] +\r\n        p0[idx] * Math.pow(t, 3);\r\n    // go through t in increments of 0.01\r\n    let t = 0;\r\n    while (t <= 1.0) {\r\n        const tx = equation(t, 0);\r\n        const ty = equation(t, 1);\r\n        const diff = Math.sqrt(Math.pow(tx - mx, 2) + Math.pow(ty - my, 2));\r\n        if (diff < lineThreshold) {\r\n            return true;\r\n        }\r\n        t += 0.01;\r\n    }\r\n    return false;\r\n};\r\nconst hitTestCurveInside = (drawable, x, y, sharpness) => {\r\n    const ops = getCurvePathOps(drawable);\r\n    const points = [];\r\n    let odd = false; // select one line out of double lines\r\n    for (const operation of ops) {\r\n        if (operation.op === \"move\") {\r\n            odd = !odd;\r\n            if (odd) {\r\n                points.push([operation.data[0], operation.data[1]]);\r\n            }\r\n        }\r\n        else if (operation.op === \"bcurveTo\") {\r\n            if (odd) {\r\n                points.push([operation.data[0], operation.data[1]]);\r\n                points.push([operation.data[2], operation.data[3]]);\r\n                points.push([operation.data[4], operation.data[5]]);\r\n            }\r\n        }\r\n    }\r\n    if (points.length >= 4) {\r\n        if (sharpness === \"sharp\") {\r\n            return isPointInPolygon(points, x, y);\r\n        }\r\n        const polygonPoints = pointsOnBezierCurves(points, 10, 5);\r\n        return isPointInPolygon(polygonPoints, x, y);\r\n    }\r\n    return false;\r\n};\r\nconst hitTestRoughShape = (drawable, x, y, lineThreshold) => {\r\n    // read operations from first opSet\r\n    const ops = getCurvePathOps(drawable);\r\n    // set start position as (0,0) just in case\r\n    // move operation does not exist (unlikely but it is worth safekeeping it)\r\n    let currentP = [0, 0];\r\n    return ops.some(({ op, data }, idx) => {\r\n        // There are only four operation types:\r\n        // move, bcurveTo, lineTo, and curveTo\r\n        if (op === \"move\") {\r\n            // change starting point\r\n            currentP = data;\r\n            // move operation does not draw anything; so, it always\r\n            // returns false\r\n        }\r\n        else if (op === \"bcurveTo\") {\r\n            // create points from bezier curve\r\n            // bezier curve stores data as a flattened array of three positions\r\n            // [x1, y1, x2, y2, x3, y3]\r\n            const p1 = [data[0], data[1]];\r\n            const p2 = [data[2], data[3]];\r\n            const p3 = [data[4], data[5]];\r\n            const p0 = currentP;\r\n            currentP = p3;\r\n            // check if points are on the curve\r\n            // cubic bezier curves require four parameters\r\n            // the first parameter is the last stored position (p0)\r\n            const retVal = pointInBezierEquation(p0, p1, p2, p3, [x, y], lineThreshold);\r\n            // set end point of bezier curve as the new starting point for\r\n            // upcoming operations as each operation is based on the last drawn\r\n            // position of the previous operation\r\n            return retVal;\r\n        }\r\n        else if (op === \"lineTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        else if (op === \"qcurveTo\") {\r\n            // TODO: Implement this\r\n        }\r\n        return false;\r\n    });\r\n};\r\n","import { OMIT_SIDES_FOR_MULTIPLE_ELEMENTS, getTransformHandlesFromCoords, getTransformHandles, } from \"./transformHandles\";\r\nconst isInsideTransformHandle = (transformHandle, x, y) => x >= transformHandle[0] &&\r\n    x <= transformHandle[0] + transformHandle[2] &&\r\n    y >= transformHandle[1] &&\r\n    y <= transformHandle[1] + transformHandle[3];\r\nexport const resizeTest = (element, appState, x, y, zoom, pointerType) => {\r\n    if (!appState.selectedElementIds[element.id]) {\r\n        return false;\r\n    }\r\n    const { rotation: rotationTransformHandle, ...transformHandles } = getTransformHandles(element, zoom, pointerType);\r\n    if (rotationTransformHandle &&\r\n        isInsideTransformHandle(rotationTransformHandle, x, y)) {\r\n        return \"rotation\";\r\n    }\r\n    const filter = Object.keys(transformHandles).filter((key) => {\r\n        const transformHandle = transformHandles[key];\r\n        if (!transformHandle) {\r\n            return false;\r\n        }\r\n        return isInsideTransformHandle(transformHandle, x, y);\r\n    });\r\n    if (filter.length > 0) {\r\n        return filter[0];\r\n    }\r\n    return false;\r\n};\r\nexport const getElementWithTransformHandleType = (elements, appState, scenePointerX, scenePointerY, zoom, pointerType) => {\r\n    return elements.reduce((result, element) => {\r\n        if (result) {\r\n            return result;\r\n        }\r\n        const transformHandleType = resizeTest(element, appState, scenePointerX, scenePointerY, zoom, pointerType);\r\n        return transformHandleType ? { element, transformHandleType } : null;\r\n    }, null);\r\n};\r\nexport const getTransformHandleTypeFromCoords = ([x1, y1, x2, y2], scenePointerX, scenePointerY, zoom, pointerType) => {\r\n    const transformHandles = getTransformHandlesFromCoords([x1, y1, x2, y2], 0, zoom, pointerType, OMIT_SIDES_FOR_MULTIPLE_ELEMENTS);\r\n    const found = Object.keys(transformHandles).find((key) => {\r\n        const transformHandle = transformHandles[key];\r\n        return (transformHandle &&\r\n            isInsideTransformHandle(transformHandle, scenePointerX, scenePointerY));\r\n    });\r\n    return (found || false);\r\n};\r\nconst RESIZE_CURSORS = [\"ns\", \"nesw\", \"ew\", \"nwse\"];\r\nconst rotateResizeCursor = (cursor, angle) => {\r\n    const index = RESIZE_CURSORS.indexOf(cursor);\r\n    if (index >= 0) {\r\n        const a = Math.round(angle / (Math.PI / 4));\r\n        cursor = RESIZE_CURSORS[(index + a) % RESIZE_CURSORS.length];\r\n    }\r\n    return cursor;\r\n};\r\n/*\r\n * Returns bi-directional cursor for the element being resized\r\n */\r\nexport const getCursorForResizingElement = (resizingElement) => {\r\n    const { element, transformHandleType } = resizingElement;\r\n    const shouldSwapCursors = element && Math.sign(element.height) * Math.sign(element.width) === -1;\r\n    let cursor = null;\r\n    switch (transformHandleType) {\r\n        case \"n\":\r\n        case \"s\":\r\n            cursor = \"ns\";\r\n            break;\r\n        case \"w\":\r\n        case \"e\":\r\n            cursor = \"ew\";\r\n            break;\r\n        case \"nw\":\r\n        case \"se\":\r\n            if (shouldSwapCursors) {\r\n                cursor = \"nesw\";\r\n            }\r\n            else {\r\n                cursor = \"nwse\";\r\n            }\r\n            break;\r\n        case \"ne\":\r\n        case \"sw\":\r\n            if (shouldSwapCursors) {\r\n                cursor = \"nwse\";\r\n            }\r\n            else {\r\n                cursor = \"nesw\";\r\n            }\r\n            break;\r\n        case \"rotation\":\r\n            return \"grab\";\r\n    }\r\n    if (cursor && element) {\r\n        cursor = rotateResizeCursor(cursor, element.angle);\r\n    }\r\n    return cursor ? `${cursor}-resize` : \"\";\r\n};\r\n","import { distance2d, rotate, isPathALoop, getGridPoint } from \"../math\";\r\nimport { getElementAbsoluteCoords } from \".\";\r\nimport { getElementPointsCoords } from \"./bounds\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { bindOrUnbindLinearElement, getHoveredElementForBinding, isBindingEnabled, } from \"./binding\";\r\nimport { tupleToCoors } from \"../utils\";\r\nimport { isBindingElement } from \"./typeChecks\";\r\nexport class LinearElementEditor {\r\n    constructor(element, scene) {\r\n        this.elementId = element.id;\r\n        Scene.mapElementToScene(this.elementId, scene);\r\n        LinearElementEditor.normalizePoints(element);\r\n        this.activePointIndex = null;\r\n        this.lastUncommittedPoint = null;\r\n        this.isDragging = false;\r\n        this.pointerOffset = { x: 0, y: 0 };\r\n        this.startBindingElement = \"keep\";\r\n        this.endBindingElement = \"keep\";\r\n    }\r\n    /**\r\n     * @param id the `elementId` from the instance of this class (so that we can\r\n     *  statically guarantee this method returns an ExcalidrawLinearElement)\r\n     */\r\n    static getElement(id) {\r\n        const element = Scene.getScene(id)?.getNonDeletedElement(id);\r\n        if (element) {\r\n            return element;\r\n        }\r\n        return null;\r\n    }\r\n    /** @returns whether point was dragged */\r\n    static handlePointDragging(appState, setState, scenePointerX, scenePointerY, maybeSuggestBinding) {\r\n        if (!appState.editingLinearElement) {\r\n            return false;\r\n        }\r\n        const { editingLinearElement } = appState;\r\n        const { activePointIndex, elementId, isDragging } = editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return false;\r\n        }\r\n        if (activePointIndex != null && activePointIndex > -1) {\r\n            if (isDragging === false) {\r\n                setState({\r\n                    editingLinearElement: {\r\n                        ...editingLinearElement,\r\n                        isDragging: true,\r\n                    },\r\n                });\r\n            }\r\n            const newPoint = LinearElementEditor.createPointAt(element, scenePointerX - editingLinearElement.pointerOffset.x, scenePointerY - editingLinearElement.pointerOffset.y, appState.gridSize);\r\n            LinearElementEditor.movePoint(element, activePointIndex, newPoint);\r\n            if (isBindingElement(element)) {\r\n                maybeSuggestBinding(element, activePointIndex === 0 ? \"start\" : \"end\");\r\n            }\r\n            return true;\r\n        }\r\n        return false;\r\n    }\r\n    static handlePointerUp(event, editingLinearElement, appState) {\r\n        const { elementId, activePointIndex, isDragging } = editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return editingLinearElement;\r\n        }\r\n        let binding = {};\r\n        if (isDragging &&\r\n            (activePointIndex === 0 || activePointIndex === element.points.length - 1)) {\r\n            if (isPathALoop(element.points, appState.zoom.value)) {\r\n                LinearElementEditor.movePoint(element, activePointIndex, activePointIndex === 0\r\n                    ? element.points[element.points.length - 1]\r\n                    : element.points[0]);\r\n            }\r\n            const bindingElement = isBindingEnabled(appState)\r\n                ? getHoveredElementForBinding(tupleToCoors(LinearElementEditor.getPointAtIndexGlobalCoordinates(element, activePointIndex)), Scene.getScene(element))\r\n                : null;\r\n            binding = {\r\n                [activePointIndex === 0 ? \"startBindingElement\" : \"endBindingElement\"]: bindingElement,\r\n            };\r\n        }\r\n        return {\r\n            ...editingLinearElement,\r\n            ...binding,\r\n            isDragging: false,\r\n            pointerOffset: { x: 0, y: 0 },\r\n        };\r\n    }\r\n    static handlePointerDown(event, appState, setState, history, scenePointer) {\r\n        const ret = {\r\n            didAddPoint: false,\r\n            hitElement: null,\r\n        };\r\n        if (!appState.editingLinearElement) {\r\n            return ret;\r\n        }\r\n        const { elementId } = appState.editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return ret;\r\n        }\r\n        if (event.altKey) {\r\n            if (appState.editingLinearElement.lastUncommittedPoint == null) {\r\n                mutateElement(element, {\r\n                    points: [\r\n                        ...element.points,\r\n                        LinearElementEditor.createPointAt(element, scenePointer.x, scenePointer.y, appState.gridSize),\r\n                    ],\r\n                });\r\n            }\r\n            history.resumeRecording();\r\n            setState({\r\n                editingLinearElement: {\r\n                    ...appState.editingLinearElement,\r\n                    activePointIndex: element.points.length - 1,\r\n                    lastUncommittedPoint: null,\r\n                    endBindingElement: getHoveredElementForBinding(scenePointer, Scene.getScene(element)),\r\n                },\r\n            });\r\n            ret.didAddPoint = true;\r\n            return ret;\r\n        }\r\n        const clickedPointIndex = LinearElementEditor.getPointIndexUnderCursor(element, appState.zoom, scenePointer.x, scenePointer.y);\r\n        // if we clicked on a point, set the element as hitElement otherwise\r\n        // it would get deselected if the point is outside the hitbox area\r\n        if (clickedPointIndex > -1) {\r\n            ret.hitElement = element;\r\n        }\r\n        else {\r\n            // You might be wandering why we are storing the binding elements on\r\n            // LinearElementEditor and passing them in, insted of calculating them\r\n            // from the end points of the `linearElement` - this is to allow disabling\r\n            // binding (which needs to happen at the point the user finishes moving\r\n            // the point).\r\n            const { startBindingElement, endBindingElement } = appState.editingLinearElement;\r\n            if (isBindingEnabled(appState) && isBindingElement(element)) {\r\n                bindOrUnbindLinearElement(element, startBindingElement, endBindingElement);\r\n            }\r\n        }\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const targetPoint = clickedPointIndex > -1 &&\r\n            rotate(element.x + element.points[clickedPointIndex][0], element.y + element.points[clickedPointIndex][1], cx, cy, element.angle);\r\n        setState({\r\n            editingLinearElement: {\r\n                ...appState.editingLinearElement,\r\n                activePointIndex: clickedPointIndex > -1 ? clickedPointIndex : null,\r\n                pointerOffset: targetPoint\r\n                    ? {\r\n                        x: scenePointer.x - targetPoint[0],\r\n                        y: scenePointer.y - targetPoint[1],\r\n                    }\r\n                    : { x: 0, y: 0 },\r\n            },\r\n        });\r\n        return ret;\r\n    }\r\n    static handlePointerMove(event, scenePointerX, scenePointerY, editingLinearElement, gridSize) {\r\n        const { elementId, lastUncommittedPoint } = editingLinearElement;\r\n        const element = LinearElementEditor.getElement(elementId);\r\n        if (!element) {\r\n            return editingLinearElement;\r\n        }\r\n        const { points } = element;\r\n        const lastPoint = points[points.length - 1];\r\n        if (!event.altKey) {\r\n            if (lastPoint === lastUncommittedPoint) {\r\n                LinearElementEditor.movePoint(element, points.length - 1, \"delete\");\r\n            }\r\n            return { ...editingLinearElement, lastUncommittedPoint: null };\r\n        }\r\n        const newPoint = LinearElementEditor.createPointAt(element, scenePointerX - editingLinearElement.pointerOffset.x, scenePointerY - editingLinearElement.pointerOffset.y, gridSize);\r\n        if (lastPoint === lastUncommittedPoint) {\r\n            LinearElementEditor.movePoint(element, element.points.length - 1, newPoint);\r\n        }\r\n        else {\r\n            LinearElementEditor.movePoint(element, \"new\", newPoint);\r\n        }\r\n        return {\r\n            ...editingLinearElement,\r\n            lastUncommittedPoint: element.points[element.points.length - 1],\r\n        };\r\n    }\r\n    static getPointsGlobalCoordinates(element) {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        return element.points.map((point) => {\r\n            let { x, y } = element;\r\n            [x, y] = rotate(x + point[0], y + point[1], cx, cy, element.angle);\r\n            return [x, y];\r\n        });\r\n    }\r\n    static getPointAtIndexGlobalCoordinates(element, indexMaybeFromEnd) {\r\n        const index = indexMaybeFromEnd < 0\r\n            ? element.points.length + indexMaybeFromEnd\r\n            : indexMaybeFromEnd;\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const point = element.points[index];\r\n        const { x, y } = element;\r\n        return rotate(x + point[0], y + point[1], cx, cy, element.angle);\r\n    }\r\n    static pointFromAbsoluteCoords(element, absoluteCoords) {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const [x, y] = rotate(absoluteCoords[0], absoluteCoords[1], cx, cy, -element.angle);\r\n        return [x - element.x, y - element.y];\r\n    }\r\n    static getPointIndexUnderCursor(element, zoom, x, y) {\r\n        const pointHandles = this.getPointsGlobalCoordinates(element);\r\n        let idx = pointHandles.length;\r\n        // loop from right to left because points on the right are rendered over\r\n        // points on the left, thus should take precedence when clicking, if they\r\n        // overlap\r\n        while (--idx > -1) {\r\n            const point = pointHandles[idx];\r\n            if (distance2d(x, y, point[0], point[1]) * zoom.value <\r\n                // +1px to account for outline stroke\r\n                this.POINT_HANDLE_SIZE / 2 + 1) {\r\n                return idx;\r\n            }\r\n        }\r\n        return -1;\r\n    }\r\n    static createPointAt(element, scenePointerX, scenePointerY, gridSize) {\r\n        const pointerOnGrid = getGridPoint(scenePointerX, scenePointerY, gridSize);\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const [rotatedX, rotatedY] = rotate(pointerOnGrid[0], pointerOnGrid[1], cx, cy, -element.angle);\r\n        return [rotatedX - element.x, rotatedY - element.y];\r\n    }\r\n    /**\r\n     * Normalizes line points so that the start point is at [0,0]. This is\r\n     * expected in various parts of the codebase. Also returns new x/y to account\r\n     * for the potential normalization.\r\n     */\r\n    static getNormalizedPoints(element) {\r\n        const { points } = element;\r\n        const offsetX = points[0][0];\r\n        const offsetY = points[0][1];\r\n        return {\r\n            points: points.map((point, _idx) => {\r\n                return [point[0] - offsetX, point[1] - offsetY];\r\n            }),\r\n            x: element.x + offsetX,\r\n            y: element.y + offsetY,\r\n        };\r\n    }\r\n    // element-mutating methods\r\n    // ---------------------------------------------------------------------------\r\n    static normalizePoints(element) {\r\n        mutateElement(element, LinearElementEditor.getNormalizedPoints(element));\r\n    }\r\n    static movePointByOffset(element, pointIndex, offset) {\r\n        const [x, y] = element.points[pointIndex];\r\n        LinearElementEditor.movePoint(element, pointIndex, [\r\n            x + offset.x,\r\n            y + offset.y,\r\n        ]);\r\n    }\r\n    static movePoint(element, pointIndex, targetPosition, otherUpdates) {\r\n        const { points } = element;\r\n        // in case we're moving start point, instead of modifying its position\r\n        // which would break the invariant of it being at [0,0], we move\r\n        // all the other points in the opposite direction by delta to\r\n        // offset it. We do the same with actual element.x/y position, so\r\n        // this hacks are completely transparent to the user.\r\n        let offsetX = 0;\r\n        let offsetY = 0;\r\n        let nextPoints;\r\n        if (targetPosition === \"delete\") {\r\n            // remove point\r\n            if (pointIndex === \"new\") {\r\n                throw new Error(\"invalid args in movePoint\");\r\n            }\r\n            nextPoints = points.slice();\r\n            nextPoints.splice(pointIndex, 1);\r\n            if (pointIndex === 0) {\r\n                // if deleting first point, make the next to be [0,0] and recalculate\r\n                // positions of the rest with respect to it\r\n                offsetX = nextPoints[0][0];\r\n                offsetY = nextPoints[0][1];\r\n                nextPoints = nextPoints.map((point, idx) => {\r\n                    if (idx === 0) {\r\n                        return [0, 0];\r\n                    }\r\n                    return [point[0] - offsetX, point[1] - offsetY];\r\n                });\r\n            }\r\n        }\r\n        else if (pointIndex === \"new\") {\r\n            nextPoints = [...points, targetPosition];\r\n        }\r\n        else {\r\n            const deltaX = targetPosition[0] - points[pointIndex][0];\r\n            const deltaY = targetPosition[1] - points[pointIndex][1];\r\n            nextPoints = points.map((point, idx) => {\r\n                if (idx === pointIndex) {\r\n                    if (idx === 0) {\r\n                        offsetX = deltaX;\r\n                        offsetY = deltaY;\r\n                        return point;\r\n                    }\r\n                    offsetX = 0;\r\n                    offsetY = 0;\r\n                    return [point[0] + deltaX, point[1] + deltaY];\r\n                }\r\n                return offsetX || offsetY\r\n                    ? [point[0] - offsetX, point[1] - offsetY]\r\n                    : point;\r\n            });\r\n        }\r\n        const nextCoords = getElementPointsCoords(element, nextPoints, element.strokeSharpness || \"round\");\r\n        const prevCoords = getElementPointsCoords(element, points, element.strokeSharpness || \"round\");\r\n        const nextCenterX = (nextCoords[0] + nextCoords[2]) / 2;\r\n        const nextCenterY = (nextCoords[1] + nextCoords[3]) / 2;\r\n        const prevCenterX = (prevCoords[0] + prevCoords[2]) / 2;\r\n        const prevCenterY = (prevCoords[1] + prevCoords[3]) / 2;\r\n        const dX = prevCenterX - nextCenterX;\r\n        const dY = prevCenterY - nextCenterY;\r\n        const rotated = rotate(offsetX, offsetY, dX, dY, element.angle);\r\n        mutateElement(element, {\r\n            ...otherUpdates,\r\n            points: nextPoints,\r\n            x: element.x + rotated[0],\r\n            y: element.y + rotated[1],\r\n        });\r\n    }\r\n}\r\n// ---------------------------------------------------------------------------\r\n// static methods\r\n// ---------------------------------------------------------------------------\r\nLinearElementEditor.POINT_HANDLE_SIZE = 20;\r\n","import { getElementAtPosition } from \"../scene\";\r\nimport { isBindableElement, isBindingElement } from \"./typeChecks\";\r\nimport { bindingBorderTest, distanceToBindableElement, maxBindingGap, determineFocusDistance, intersectElementWithLine, determineFocusPoint, } from \"./collision\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { LinearElementEditor } from \"./linearElementEditor\";\r\nimport { tupleToCoors } from \"../utils\";\r\nimport { KEYS } from \"../keys\";\r\nexport const shouldEnableBindingForPointerEvent = (event) => {\r\n    return !event[KEYS.CTRL_OR_CMD];\r\n};\r\nexport const isBindingEnabled = (appState) => {\r\n    return appState.isBindingEnabled;\r\n};\r\nexport const bindOrUnbindLinearElement = (linearElement, startBindingElement, endBindingElement) => {\r\n    const boundToElementIds = new Set();\r\n    const unboundFromElementIds = new Set();\r\n    bindOrUnbindLinearElementEdge(linearElement, startBindingElement, endBindingElement, \"start\", boundToElementIds, unboundFromElementIds);\r\n    bindOrUnbindLinearElementEdge(linearElement, endBindingElement, startBindingElement, \"end\", boundToElementIds, unboundFromElementIds);\r\n    const onlyUnbound = Array.from(unboundFromElementIds).filter((id) => !boundToElementIds.has(id));\r\n    Scene.getScene(linearElement)\r\n        .getNonDeletedElements(onlyUnbound)\r\n        .forEach((element) => {\r\n        mutateElement(element, {\r\n            boundElementIds: element.boundElementIds?.filter((id) => id !== linearElement.id),\r\n        });\r\n    });\r\n};\r\nconst bindOrUnbindLinearElementEdge = (linearElement, bindableElement, otherEdgeBindableElement, startOrEnd, \r\n// Is mutated\r\nboundToElementIds, \r\n// Is mutated\r\nunboundFromElementIds) => {\r\n    if (bindableElement !== \"keep\") {\r\n        if (bindableElement != null) {\r\n            // Don't bind if we're trying to bind or are already bound to the same\r\n            // element on the other edge already (\"start\" edge takes precedence).\r\n            if (otherEdgeBindableElement == null ||\r\n                (otherEdgeBindableElement === \"keep\"\r\n                    ? !isLinearElementSimpleAndAlreadyBoundOnOppositeEdge(linearElement, bindableElement, startOrEnd)\r\n                    : startOrEnd === \"start\" ||\r\n                        otherEdgeBindableElement.id !== bindableElement.id)) {\r\n                bindLinearElement(linearElement, bindableElement, startOrEnd);\r\n                boundToElementIds.add(bindableElement.id);\r\n            }\r\n        }\r\n        else {\r\n            const unbound = unbindLinearElement(linearElement, startOrEnd);\r\n            if (unbound != null) {\r\n                unboundFromElementIds.add(unbound);\r\n            }\r\n        }\r\n    }\r\n};\r\nexport const bindOrUnbindSelectedElements = (elements) => {\r\n    elements.forEach((element) => {\r\n        if (isBindingElement(element)) {\r\n            bindOrUnbindLinearElement(element, getElligibleElementForBindingElement(element, \"start\"), getElligibleElementForBindingElement(element, \"end\"));\r\n        }\r\n        else if (isBindableElement(element)) {\r\n            maybeBindBindableElement(element);\r\n        }\r\n    });\r\n};\r\nconst maybeBindBindableElement = (bindableElement) => {\r\n    getElligibleElementsForBindableElementAndWhere(bindableElement).forEach(([linearElement, where]) => bindOrUnbindLinearElement(linearElement, where === \"end\" ? \"keep\" : bindableElement, where === \"start\" ? \"keep\" : bindableElement));\r\n};\r\nexport const maybeBindLinearElement = (linearElement, appState, scene, pointerCoords) => {\r\n    if (appState.startBoundElement != null) {\r\n        bindLinearElement(linearElement, appState.startBoundElement, \"start\");\r\n    }\r\n    const hoveredElement = getHoveredElementForBinding(pointerCoords, scene);\r\n    if (hoveredElement != null &&\r\n        !isLinearElementSimpleAndAlreadyBoundOnOppositeEdge(linearElement, hoveredElement, \"end\")) {\r\n        bindLinearElement(linearElement, hoveredElement, \"end\");\r\n    }\r\n};\r\nconst bindLinearElement = (linearElement, hoveredElement, startOrEnd) => {\r\n    mutateElement(linearElement, {\r\n        [startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\"]: {\r\n            elementId: hoveredElement.id,\r\n            ...calculateFocusAndGap(linearElement, hoveredElement, startOrEnd),\r\n        },\r\n    });\r\n    mutateElement(hoveredElement, {\r\n        boundElementIds: Array.from(new Set([...(hoveredElement.boundElementIds ?? []), linearElement.id])),\r\n    });\r\n};\r\n// Don't bind both ends of a simple segment\r\nconst isLinearElementSimpleAndAlreadyBoundOnOppositeEdge = (linearElement, bindableElement, startOrEnd) => {\r\n    const otherBinding = linearElement[startOrEnd === \"start\" ? \"endBinding\" : \"startBinding\"];\r\n    return isLinearElementSimpleAndAlreadyBound(linearElement, otherBinding?.elementId, bindableElement);\r\n};\r\nexport const isLinearElementSimpleAndAlreadyBound = (linearElement, alreadyBoundToId, bindableElement) => {\r\n    return (alreadyBoundToId === bindableElement.id && linearElement.points.length < 3);\r\n};\r\nexport const unbindLinearElements = (elements) => {\r\n    elements.forEach((element) => {\r\n        if (isBindingElement(element)) {\r\n            bindOrUnbindLinearElement(element, null, null);\r\n        }\r\n    });\r\n};\r\nconst unbindLinearElement = (linearElement, startOrEnd) => {\r\n    const field = startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\";\r\n    const binding = linearElement[field];\r\n    if (binding == null) {\r\n        return null;\r\n    }\r\n    mutateElement(linearElement, { [field]: null });\r\n    return binding.elementId;\r\n};\r\nexport const getHoveredElementForBinding = (pointerCoords, scene) => {\r\n    const hoveredElement = getElementAtPosition(scene.getElements(), (element) => isBindableElement(element) && bindingBorderTest(element, pointerCoords));\r\n    return hoveredElement;\r\n};\r\nconst calculateFocusAndGap = (linearElement, hoveredElement, startOrEnd) => {\r\n    const direction = startOrEnd === \"start\" ? -1 : 1;\r\n    const edgePointIndex = direction === -1 ? 0 : linearElement.points.length - 1;\r\n    const adjacentPointIndex = edgePointIndex - direction;\r\n    const edgePoint = LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, edgePointIndex);\r\n    const adjacentPoint = LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, adjacentPointIndex);\r\n    return {\r\n        focus: determineFocusDistance(hoveredElement, adjacentPoint, edgePoint),\r\n        gap: Math.max(1, distanceToBindableElement(hoveredElement, edgePoint)),\r\n    };\r\n};\r\n// Supports translating, rotating and scaling `changedElement` with bound\r\n// linear elements.\r\n// Because scaling involves moving the focus points as well, it is\r\n// done before the `changedElement` is updated, and the `newSize` is passed\r\n// in explicitly.\r\nexport const updateBoundElements = (changedElement, options) => {\r\n    const boundElementIds = changedElement.boundElementIds ?? [];\r\n    if (boundElementIds.length === 0) {\r\n        return;\r\n    }\r\n    const { newSize, simultaneouslyUpdated } = options ?? {};\r\n    const simultaneouslyUpdatedElementIds = getSimultaneouslyUpdatedElementIds(simultaneouslyUpdated);\r\n    Scene.getScene(changedElement).getNonDeletedElements(boundElementIds).forEach((linearElement) => {\r\n        const bindableElement = changedElement;\r\n        // In case the boundElementIds are stale\r\n        if (!doesNeedUpdate(linearElement, bindableElement)) {\r\n            return;\r\n        }\r\n        const startBinding = maybeCalculateNewGapWhenScaling(bindableElement, linearElement.startBinding, newSize);\r\n        const endBinding = maybeCalculateNewGapWhenScaling(bindableElement, linearElement.endBinding, newSize);\r\n        // `linearElement` is being moved/scaled already, just update the binding\r\n        if (simultaneouslyUpdatedElementIds.has(linearElement.id)) {\r\n            mutateElement(linearElement, { startBinding, endBinding });\r\n            return;\r\n        }\r\n        updateBoundPoint(linearElement, \"start\", startBinding, changedElement);\r\n        updateBoundPoint(linearElement, \"end\", endBinding, changedElement);\r\n    });\r\n};\r\nconst doesNeedUpdate = (boundElement, changedElement) => {\r\n    return (boundElement.startBinding?.elementId === changedElement.id ||\r\n        boundElement.endBinding?.elementId === changedElement.id);\r\n};\r\nconst getSimultaneouslyUpdatedElementIds = (simultaneouslyUpdated) => {\r\n    return new Set((simultaneouslyUpdated || []).map((element) => element.id));\r\n};\r\nconst updateBoundPoint = (linearElement, startOrEnd, binding, changedElement) => {\r\n    if (binding == null ||\r\n        // We only need to update the other end if this is a 2 point line element\r\n        (binding.elementId !== changedElement.id && linearElement.points.length > 2)) {\r\n        return;\r\n    }\r\n    const bindingElement = Scene.getScene(linearElement).getElement(binding.elementId);\r\n    if (bindingElement == null) {\r\n        // We're not cleaning up after deleted elements atm., so handle this case\r\n        return;\r\n    }\r\n    const direction = startOrEnd === \"start\" ? -1 : 1;\r\n    const edgePointIndex = direction === -1 ? 0 : linearElement.points.length - 1;\r\n    const adjacentPointIndex = edgePointIndex - direction;\r\n    const adjacentPoint = LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, adjacentPointIndex);\r\n    const focusPointAbsolute = determineFocusPoint(bindingElement, binding.focus, adjacentPoint);\r\n    let newEdgePoint;\r\n    // The linear element was not originally pointing inside the bound shape,\r\n    // we can point directly at the focus point\r\n    if (binding.gap === 0) {\r\n        newEdgePoint = focusPointAbsolute;\r\n    }\r\n    else {\r\n        const intersections = intersectElementWithLine(bindingElement, adjacentPoint, focusPointAbsolute, binding.gap);\r\n        if (intersections.length === 0) {\r\n            // This should never happen, since focusPoint should always be\r\n            // inside the element, but just in case, bail out\r\n            newEdgePoint = focusPointAbsolute;\r\n        }\r\n        else {\r\n            // Guaranteed to intersect because focusPoint is always inside the shape\r\n            newEdgePoint = intersections[0];\r\n        }\r\n    }\r\n    LinearElementEditor.movePoint(linearElement, edgePointIndex, LinearElementEditor.pointFromAbsoluteCoords(linearElement, newEdgePoint), { [startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\"]: binding });\r\n};\r\nconst maybeCalculateNewGapWhenScaling = (changedElement, currentBinding, newSize) => {\r\n    if (currentBinding == null || newSize == null) {\r\n        return currentBinding;\r\n    }\r\n    const { gap, focus, elementId } = currentBinding;\r\n    const { width: newWidth, height: newHeight } = newSize;\r\n    const { width, height } = changedElement;\r\n    const newGap = Math.max(1, Math.min(maxBindingGap(changedElement, newWidth, newHeight), gap * (newWidth < newHeight ? newWidth / width : newHeight / height)));\r\n    return { elementId, gap: newGap, focus };\r\n};\r\nexport const getEligibleElementsForBinding = (elements) => {\r\n    const includedElementIds = new Set(elements.map(({ id }) => id));\r\n    return elements.flatMap((element) => isBindingElement(element)\r\n        ? getElligibleElementsForBindingElement(element).filter((element) => !includedElementIds.has(element.id))\r\n        : isBindableElement(element)\r\n            ? getElligibleElementsForBindableElementAndWhere(element).filter((binding) => !includedElementIds.has(binding[0].id))\r\n            : []);\r\n};\r\nconst getElligibleElementsForBindingElement = (linearElement) => {\r\n    return [\r\n        getElligibleElementForBindingElement(linearElement, \"start\"),\r\n        getElligibleElementForBindingElement(linearElement, \"end\"),\r\n    ].filter((element) => element != null);\r\n};\r\nconst getElligibleElementForBindingElement = (linearElement, startOrEnd) => {\r\n    return getHoveredElementForBinding(getLinearElementEdgeCoors(linearElement, startOrEnd), Scene.getScene(linearElement));\r\n};\r\nconst getLinearElementEdgeCoors = (linearElement, startOrEnd) => {\r\n    const index = startOrEnd === \"start\" ? 0 : -1;\r\n    return tupleToCoors(LinearElementEditor.getPointAtIndexGlobalCoordinates(linearElement, index));\r\n};\r\nconst getElligibleElementsForBindableElementAndWhere = (bindableElement) => {\r\n    return Scene.getScene(bindableElement)\r\n        .getElements()\r\n        .map((element) => {\r\n        if (!isBindingElement(element)) {\r\n            return null;\r\n        }\r\n        const canBindStart = isLinearElementEligibleForNewBindingByBindable(element, \"start\", bindableElement);\r\n        const canBindEnd = isLinearElementEligibleForNewBindingByBindable(element, \"end\", bindableElement);\r\n        if (!canBindStart && !canBindEnd) {\r\n            return null;\r\n        }\r\n        return [\r\n            element,\r\n            canBindStart && canBindEnd ? \"both\" : canBindStart ? \"start\" : \"end\",\r\n            bindableElement,\r\n        ];\r\n    })\r\n        .filter((maybeElement) => maybeElement != null);\r\n};\r\nconst isLinearElementEligibleForNewBindingByBindable = (linearElement, startOrEnd, bindableElement) => {\r\n    const existingBinding = linearElement[startOrEnd === \"start\" ? \"startBinding\" : \"endBinding\"];\r\n    return (existingBinding == null &&\r\n        !isLinearElementSimpleAndAlreadyBoundOnOppositeEdge(linearElement, bindableElement, startOrEnd) &&\r\n        bindingBorderTest(bindableElement, getLinearElementEdgeCoors(linearElement, startOrEnd)));\r\n};\r\n// We need to:\r\n// 1: Update elements not selected to point to duplicated elements\r\n// 2: Update duplicated elements to point to other duplicated elements\r\nexport const fixBindingsAfterDuplication = (sceneElements, oldElements, oldIdToDuplicatedId, \r\n// There are three copying mechanisms: Copy-paste, duplication and alt-drag.\r\n// Only when alt-dragging the new \"duplicates\" act as the \"old\", while\r\n// the \"old\" elements act as the \"new copy\" - essentially working reverse\r\n// to the other two.\r\nduplicatesServeAsOld) => {\r\n    // First collect all the binding/bindable elements, so we only update\r\n    // each once, regardless of whether they were duplicated or not.\r\n    const allBoundElementIds = new Set();\r\n    const allBindableElementIds = new Set();\r\n    const shouldReverseRoles = duplicatesServeAsOld === \"duplicatesServeAsOld\";\r\n    oldElements.forEach((oldElement) => {\r\n        const { boundElementIds } = oldElement;\r\n        if (boundElementIds != null && boundElementIds.length > 0) {\r\n            boundElementIds.forEach((boundElementId) => {\r\n                if (shouldReverseRoles && !oldIdToDuplicatedId.has(boundElementId)) {\r\n                    allBoundElementIds.add(boundElementId);\r\n                }\r\n            });\r\n            allBindableElementIds.add(oldIdToDuplicatedId.get(oldElement.id));\r\n        }\r\n        if (isBindingElement(oldElement)) {\r\n            if (oldElement.startBinding != null) {\r\n                const { elementId } = oldElement.startBinding;\r\n                if (shouldReverseRoles && !oldIdToDuplicatedId.has(elementId)) {\r\n                    allBindableElementIds.add(elementId);\r\n                }\r\n            }\r\n            if (oldElement.endBinding != null) {\r\n                const { elementId } = oldElement.endBinding;\r\n                if (shouldReverseRoles && !oldIdToDuplicatedId.has(elementId)) {\r\n                    allBindableElementIds.add(elementId);\r\n                }\r\n            }\r\n            if (oldElement.startBinding != null || oldElement.endBinding != null) {\r\n                allBoundElementIds.add(oldIdToDuplicatedId.get(oldElement.id));\r\n            }\r\n        }\r\n    });\r\n    // Update the linear elements\r\n    sceneElements.filter(({ id }) => allBoundElementIds.has(id)).forEach((element) => {\r\n        const { startBinding, endBinding } = element;\r\n        mutateElement(element, {\r\n            startBinding: newBindingAfterDuplication(startBinding, oldIdToDuplicatedId),\r\n            endBinding: newBindingAfterDuplication(endBinding, oldIdToDuplicatedId),\r\n        });\r\n    });\r\n    // Update the bindable shapes\r\n    sceneElements\r\n        .filter(({ id }) => allBindableElementIds.has(id))\r\n        .forEach((bindableElement) => {\r\n        const { boundElementIds } = bindableElement;\r\n        if (boundElementIds != null && boundElementIds.length > 0) {\r\n            mutateElement(bindableElement, {\r\n                boundElementIds: boundElementIds.map((boundElementId) => oldIdToDuplicatedId.get(boundElementId) ?? boundElementId),\r\n            });\r\n        }\r\n    });\r\n};\r\nconst newBindingAfterDuplication = (binding, oldIdToDuplicatedId) => {\r\n    if (binding == null) {\r\n        return null;\r\n    }\r\n    const { elementId, focus, gap } = binding;\r\n    return {\r\n        focus,\r\n        gap,\r\n        elementId: oldIdToDuplicatedId.get(elementId) ?? elementId,\r\n    };\r\n};\r\nexport const fixBindingsAfterDeletion = (sceneElements, deletedElements) => {\r\n    const deletedElementIds = new Set(deletedElements.map((element) => element.id));\r\n    // Non deleted and need an update\r\n    const boundElementIds = new Set();\r\n    deletedElements.forEach((deletedElement) => {\r\n        if (isBindableElement(deletedElement)) {\r\n            deletedElement.boundElementIds?.forEach((id) => {\r\n                if (!deletedElementIds.has(id)) {\r\n                    boundElementIds.add(id);\r\n                }\r\n            });\r\n        }\r\n    });\r\n    sceneElements.filter(({ id }) => boundElementIds.has(id)).forEach((element) => {\r\n        const { startBinding, endBinding } = element;\r\n        mutateElement(element, {\r\n            startBinding: newBindingAfterDeletion(startBinding, deletedElementIds),\r\n            endBinding: newBindingAfterDeletion(endBinding, deletedElementIds),\r\n        });\r\n    });\r\n};\r\nconst newBindingAfterDeletion = (binding, deletedElementIds) => {\r\n    if (binding == null || deletedElementIds.has(binding.elementId)) {\r\n        return null;\r\n    }\r\n    return binding;\r\n};\r\n","import { SHIFT_LOCKING_ANGLE } from \"../constants\";\r\nimport { rescalePoints } from \"../points\";\r\nimport { rotate, adjustXYWithRotation, centerPoint, rotatePoint, } from \"../math\";\r\nimport { getElementAbsoluteCoords, getCommonBounds, getResizedElementAbsoluteCoords, } from \"./bounds\";\r\nimport { isFreeDrawElement, isLinearElement, isTextElement, } from \"./typeChecks\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport { getPerfectElementSize } from \"./sizeHelpers\";\r\nimport { measureText, getFontString } from \"../utils\";\r\nimport { updateBoundElements } from \"./binding\";\r\nexport const normalizeAngle = (angle) => {\r\n    if (angle >= 2 * Math.PI) {\r\n        return angle - 2 * Math.PI;\r\n    }\r\n    return angle;\r\n};\r\n// Returns true when transform (resizing/rotation) happened\r\nexport const transformElements = (pointerDownState, transformHandleType, selectedElements, resizeArrowDirection, shouldRotateWithDiscreteAngle, shouldResizeFromCenter, shouldMaintainAspectRatio, pointerX, pointerY, centerX, centerY) => {\r\n    if (selectedElements.length === 1) {\r\n        const [element] = selectedElements;\r\n        if (transformHandleType === \"rotation\") {\r\n            rotateSingleElement(element, pointerX, pointerY, shouldRotateWithDiscreteAngle);\r\n            updateBoundElements(element);\r\n        }\r\n        else if (isLinearElement(element) &&\r\n            element.points.length === 2 &&\r\n            (transformHandleType === \"nw\" ||\r\n                transformHandleType === \"ne\" ||\r\n                transformHandleType === \"sw\" ||\r\n                transformHandleType === \"se\")) {\r\n            reshapeSingleTwoPointElement(element, resizeArrowDirection, shouldRotateWithDiscreteAngle, pointerX, pointerY);\r\n        }\r\n        else if (isTextElement(element) &&\r\n            (transformHandleType === \"nw\" ||\r\n                transformHandleType === \"ne\" ||\r\n                transformHandleType === \"sw\" ||\r\n                transformHandleType === \"se\")) {\r\n            resizeSingleTextElement(element, transformHandleType, shouldResizeFromCenter, pointerX, pointerY);\r\n            updateBoundElements(element);\r\n        }\r\n        else if (transformHandleType) {\r\n            resizeSingleElement(pointerDownState.originalElements.get(element.id), shouldMaintainAspectRatio, element, transformHandleType, shouldResizeFromCenter, pointerX, pointerY);\r\n        }\r\n        return true;\r\n    }\r\n    else if (selectedElements.length > 1) {\r\n        if (transformHandleType === \"rotation\") {\r\n            rotateMultipleElements(pointerDownState, selectedElements, pointerX, pointerY, shouldRotateWithDiscreteAngle, centerX, centerY);\r\n            return true;\r\n        }\r\n        else if (transformHandleType === \"nw\" ||\r\n            transformHandleType === \"ne\" ||\r\n            transformHandleType === \"sw\" ||\r\n            transformHandleType === \"se\") {\r\n            resizeMultipleElements(selectedElements, transformHandleType, pointerX, pointerY);\r\n            return true;\r\n        }\r\n    }\r\n    return false;\r\n};\r\nconst rotateSingleElement = (element, pointerX, pointerY, shouldRotateWithDiscreteAngle) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    let angle = (5 * Math.PI) / 2 + Math.atan2(pointerY - cy, pointerX - cx);\r\n    if (shouldRotateWithDiscreteAngle) {\r\n        angle += SHIFT_LOCKING_ANGLE / 2;\r\n        angle -= angle % SHIFT_LOCKING_ANGLE;\r\n    }\r\n    angle = normalizeAngle(angle);\r\n    mutateElement(element, { angle });\r\n};\r\n// used in DEV only\r\nconst validateTwoPointElementNormalized = (element) => {\r\n    if (element.points.length !== 2 ||\r\n        element.points[0][0] !== 0 ||\r\n        element.points[0][1] !== 0 ||\r\n        Math.abs(element.points[1][0]) !== element.width ||\r\n        Math.abs(element.points[1][1]) !== element.height) {\r\n        throw new Error(\"Two-point element is not normalized\");\r\n    }\r\n};\r\nconst getPerfectElementSizeWithRotation = (elementType, width, height, angle) => {\r\n    const size = getPerfectElementSize(elementType, ...rotate(width, height, 0, 0, angle));\r\n    return rotate(size.width, size.height, 0, 0, -angle);\r\n};\r\nexport const reshapeSingleTwoPointElement = (element, resizeArrowDirection, shouldRotateWithDiscreteAngle, pointerX, pointerY) => {\r\n    if (process.env.NODE_ENV !== \"production\") {\r\n        validateTwoPointElementNormalized(element);\r\n    }\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    // rotation pointer with reverse angle\r\n    const [rotatedX, rotatedY] = rotate(pointerX, pointerY, cx, cy, -element.angle);\r\n    let [width, height] = resizeArrowDirection === \"end\"\r\n        ? [rotatedX - element.x, rotatedY - element.y]\r\n        : [\r\n            element.x + element.points[1][0] - rotatedX,\r\n            element.y + element.points[1][1] - rotatedY,\r\n        ];\r\n    if (shouldRotateWithDiscreteAngle) {\r\n        [width, height] = getPerfectElementSizeWithRotation(element.type, width, height, element.angle);\r\n    }\r\n    const [nextElementX, nextElementY] = adjustXYWithRotation(resizeArrowDirection === \"end\"\r\n        ? { s: true, e: true }\r\n        : { n: true, w: true }, element.x, element.y, element.angle, 0, 0, (element.points[1][0] - width) / 2, (element.points[1][1] - height) / 2);\r\n    mutateElement(element, {\r\n        x: nextElementX,\r\n        y: nextElementY,\r\n        points: [\r\n            [0, 0],\r\n            [width, height],\r\n        ],\r\n    });\r\n};\r\nconst rescalePointsInElement = (element, width, height) => isLinearElement(element) || isFreeDrawElement(element)\r\n    ? {\r\n        points: rescalePoints(0, width, rescalePoints(1, height, element.points)),\r\n    }\r\n    : {};\r\nconst MIN_FONT_SIZE = 1;\r\nconst measureFontSizeFromWH = (element, nextWidth, nextHeight) => {\r\n    // We only use width to scale font on resize\r\n    const nextFontSize = element.fontSize * (nextWidth / element.width);\r\n    if (nextFontSize < MIN_FONT_SIZE) {\r\n        return null;\r\n    }\r\n    const metrics = measureText(element.text, getFontString({ fontSize: nextFontSize, fontFamily: element.fontFamily }));\r\n    return {\r\n        size: nextFontSize,\r\n        baseline: metrics.baseline + (nextHeight - metrics.height),\r\n    };\r\n};\r\nconst getSidesForTransformHandle = (transformHandleType, shouldResizeFromCenter) => {\r\n    return {\r\n        n: /^(n|ne|nw)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(s|se|sw)$/.test(transformHandleType)),\r\n        s: /^(s|se|sw)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(n|ne|nw)$/.test(transformHandleType)),\r\n        w: /^(w|nw|sw)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(e|ne|se)$/.test(transformHandleType)),\r\n        e: /^(e|ne|se)$/.test(transformHandleType) ||\r\n            (shouldResizeFromCenter && /^(w|nw|sw)$/.test(transformHandleType)),\r\n    };\r\n};\r\nconst resizeSingleTextElement = (element, transformHandleType, shouldResizeFromCenter, pointerX, pointerY) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    // rotation pointer with reverse angle\r\n    const [rotatedX, rotatedY] = rotate(pointerX, pointerY, cx, cy, -element.angle);\r\n    let scale;\r\n    switch (transformHandleType) {\r\n        case \"se\":\r\n            scale = Math.max((rotatedX - x1) / (x2 - x1), (rotatedY - y1) / (y2 - y1));\r\n            break;\r\n        case \"nw\":\r\n            scale = Math.max((x2 - rotatedX) / (x2 - x1), (y2 - rotatedY) / (y2 - y1));\r\n            break;\r\n        case \"ne\":\r\n            scale = Math.max((rotatedX - x1) / (x2 - x1), (y2 - rotatedY) / (y2 - y1));\r\n            break;\r\n        case \"sw\":\r\n            scale = Math.max((x2 - rotatedX) / (x2 - x1), (rotatedY - y1) / (y2 - y1));\r\n            break;\r\n    }\r\n    if (scale > 0) {\r\n        const nextWidth = element.width * scale;\r\n        const nextHeight = element.height * scale;\r\n        const nextFont = measureFontSizeFromWH(element, nextWidth, nextHeight);\r\n        if (nextFont === null) {\r\n            return;\r\n        }\r\n        const [nextX1, nextY1, nextX2, nextY2] = getResizedElementAbsoluteCoords(element, nextWidth, nextHeight);\r\n        const deltaX1 = (x1 - nextX1) / 2;\r\n        const deltaY1 = (y1 - nextY1) / 2;\r\n        const deltaX2 = (x2 - nextX2) / 2;\r\n        const deltaY2 = (y2 - nextY2) / 2;\r\n        const [nextElementX, nextElementY] = adjustXYWithRotation(getSidesForTransformHandle(transformHandleType, shouldResizeFromCenter), element.x, element.y, element.angle, deltaX1, deltaY1, deltaX2, deltaY2);\r\n        mutateElement(element, {\r\n            fontSize: nextFont.size,\r\n            width: nextWidth,\r\n            height: nextHeight,\r\n            baseline: nextFont.baseline,\r\n            x: nextElementX,\r\n            y: nextElementY,\r\n        });\r\n    }\r\n};\r\nexport const resizeSingleElement = (stateAtResizeStart, shouldMaintainAspectRatio, element, transformHandleDirection, shouldResizeFromCenter, pointerX, pointerY) => {\r\n    // Gets bounds corners\r\n    const [x1, y1, x2, y2] = getResizedElementAbsoluteCoords(stateAtResizeStart, stateAtResizeStart.width, stateAtResizeStart.height);\r\n    const startTopLeft = [x1, y1];\r\n    const startBottomRight = [x2, y2];\r\n    const startCenter = centerPoint(startTopLeft, startBottomRight);\r\n    // Calculate new dimensions based on cursor position\r\n    const rotatedPointer = rotatePoint([pointerX, pointerY], startCenter, -stateAtResizeStart.angle);\r\n    // Get bounds corners rendered on screen\r\n    const [esx1, esy1, esx2, esy2] = getResizedElementAbsoluteCoords(element, element.width, element.height);\r\n    const boundsCurrentWidth = esx2 - esx1;\r\n    const boundsCurrentHeight = esy2 - esy1;\r\n    // It's important we set the initial scale value based on the width and height at resize start,\r\n    // otherwise previous dimensions affected by modifiers will be taken into account.\r\n    const atStartBoundsWidth = startBottomRight[0] - startTopLeft[0];\r\n    const atStartBoundsHeight = startBottomRight[1] - startTopLeft[1];\r\n    let scaleX = atStartBoundsWidth / boundsCurrentWidth;\r\n    let scaleY = atStartBoundsHeight / boundsCurrentHeight;\r\n    if (transformHandleDirection.includes(\"e\")) {\r\n        scaleX = (rotatedPointer[0] - startTopLeft[0]) / boundsCurrentWidth;\r\n    }\r\n    if (transformHandleDirection.includes(\"s\")) {\r\n        scaleY = (rotatedPointer[1] - startTopLeft[1]) / boundsCurrentHeight;\r\n    }\r\n    if (transformHandleDirection.includes(\"w\")) {\r\n        scaleX = (startBottomRight[0] - rotatedPointer[0]) / boundsCurrentWidth;\r\n    }\r\n    if (transformHandleDirection.includes(\"n\")) {\r\n        scaleY = (startBottomRight[1] - rotatedPointer[1]) / boundsCurrentHeight;\r\n    }\r\n    // Linear elements dimensions differ from bounds dimensions\r\n    const eleInitialWidth = stateAtResizeStart.width;\r\n    const eleInitialHeight = stateAtResizeStart.height;\r\n    // We have to use dimensions of element on screen, otherwise the scaling of the\r\n    // dimensions won't match the cursor for linear elements.\r\n    let eleNewWidth = element.width * scaleX;\r\n    let eleNewHeight = element.height * scaleY;\r\n    // adjust dimensions for resizing from center\r\n    if (shouldResizeFromCenter) {\r\n        eleNewWidth = 2 * eleNewWidth - eleInitialWidth;\r\n        eleNewHeight = 2 * eleNewHeight - eleInitialHeight;\r\n    }\r\n    // adjust dimensions to keep sides ratio\r\n    if (shouldMaintainAspectRatio) {\r\n        const widthRatio = Math.abs(eleNewWidth) / eleInitialWidth;\r\n        const heightRatio = Math.abs(eleNewHeight) / eleInitialHeight;\r\n        if (transformHandleDirection.length === 1) {\r\n            eleNewHeight *= widthRatio;\r\n            eleNewWidth *= heightRatio;\r\n        }\r\n        if (transformHandleDirection.length === 2) {\r\n            const ratio = Math.max(widthRatio, heightRatio);\r\n            eleNewWidth = eleInitialWidth * ratio * Math.sign(eleNewWidth);\r\n            eleNewHeight = eleInitialHeight * ratio * Math.sign(eleNewHeight);\r\n        }\r\n    }\r\n    const [newBoundsX1, newBoundsY1, newBoundsX2, newBoundsY2] = getResizedElementAbsoluteCoords(stateAtResizeStart, eleNewWidth, eleNewHeight);\r\n    const newBoundsWidth = newBoundsX2 - newBoundsX1;\r\n    const newBoundsHeight = newBoundsY2 - newBoundsY1;\r\n    // Calculate new topLeft based on fixed corner during resize\r\n    let newTopLeft = [...startTopLeft];\r\n    if ([\"n\", \"w\", \"nw\"].includes(transformHandleDirection)) {\r\n        newTopLeft = [\r\n            startBottomRight[0] - Math.abs(newBoundsWidth),\r\n            startBottomRight[1] - Math.abs(newBoundsHeight),\r\n        ];\r\n    }\r\n    if (transformHandleDirection === \"ne\") {\r\n        const bottomLeft = [startTopLeft[0], startBottomRight[1]];\r\n        newTopLeft = [bottomLeft[0], bottomLeft[1] - Math.abs(newBoundsHeight)];\r\n    }\r\n    if (transformHandleDirection === \"sw\") {\r\n        const topRight = [startBottomRight[0], startTopLeft[1]];\r\n        newTopLeft = [topRight[0] - Math.abs(newBoundsWidth), topRight[1]];\r\n    }\r\n    // Keeps opposite handle fixed during resize\r\n    if (shouldMaintainAspectRatio) {\r\n        if ([\"s\", \"n\"].includes(transformHandleDirection)) {\r\n            newTopLeft[0] = startCenter[0] - newBoundsWidth / 2;\r\n        }\r\n        if ([\"e\", \"w\"].includes(transformHandleDirection)) {\r\n            newTopLeft[1] = startCenter[1] - newBoundsHeight / 2;\r\n        }\r\n    }\r\n    // Flip horizontally\r\n    if (eleNewWidth < 0) {\r\n        if (transformHandleDirection.includes(\"e\")) {\r\n            newTopLeft[0] -= Math.abs(newBoundsWidth);\r\n        }\r\n        if (transformHandleDirection.includes(\"w\")) {\r\n            newTopLeft[0] += Math.abs(newBoundsWidth);\r\n        }\r\n    }\r\n    // Flip vertically\r\n    if (eleNewHeight < 0) {\r\n        if (transformHandleDirection.includes(\"s\")) {\r\n            newTopLeft[1] -= Math.abs(newBoundsHeight);\r\n        }\r\n        if (transformHandleDirection.includes(\"n\")) {\r\n            newTopLeft[1] += Math.abs(newBoundsHeight);\r\n        }\r\n    }\r\n    if (shouldResizeFromCenter) {\r\n        newTopLeft[0] = startCenter[0] - Math.abs(newBoundsWidth) / 2;\r\n        newTopLeft[1] = startCenter[1] - Math.abs(newBoundsHeight) / 2;\r\n    }\r\n    // adjust topLeft to new rotation point\r\n    const angle = stateAtResizeStart.angle;\r\n    const rotatedTopLeft = rotatePoint(newTopLeft, startCenter, angle);\r\n    const newCenter = [\r\n        newTopLeft[0] + Math.abs(newBoundsWidth) / 2,\r\n        newTopLeft[1] + Math.abs(newBoundsHeight) / 2,\r\n    ];\r\n    const rotatedNewCenter = rotatePoint(newCenter, startCenter, angle);\r\n    newTopLeft = rotatePoint(rotatedTopLeft, rotatedNewCenter, -angle);\r\n    // Readjust points for linear elements\r\n    const rescaledPoints = rescalePointsInElement(stateAtResizeStart, eleNewWidth, eleNewHeight);\r\n    // For linear elements (x,y) are the coordinates of the first drawn point not the top-left corner\r\n    // So we need to readjust (x,y) to be where the first point should be\r\n    const newOrigin = [...newTopLeft];\r\n    newOrigin[0] += stateAtResizeStart.x - newBoundsX1;\r\n    newOrigin[1] += stateAtResizeStart.y - newBoundsY1;\r\n    const resizedElement = {\r\n        width: Math.abs(eleNewWidth),\r\n        height: Math.abs(eleNewHeight),\r\n        x: newOrigin[0],\r\n        y: newOrigin[1],\r\n        ...rescaledPoints,\r\n    };\r\n    if (\"scale\" in element && \"scale\" in stateAtResizeStart) {\r\n        mutateElement(element, {\r\n            scale: [\r\n                // defaulting because scaleX/Y can be 0/-0\r\n                (Math.sign(scaleX) || stateAtResizeStart.scale[0]) *\r\n                    stateAtResizeStart.scale[0],\r\n                (Math.sign(scaleY) || stateAtResizeStart.scale[1]) *\r\n                    stateAtResizeStart.scale[1],\r\n            ],\r\n        });\r\n    }\r\n    if (resizedElement.width !== 0 &&\r\n        resizedElement.height !== 0 &&\r\n        Number.isFinite(resizedElement.x) &&\r\n        Number.isFinite(resizedElement.y)) {\r\n        updateBoundElements(element, {\r\n            newSize: { width: resizedElement.width, height: resizedElement.height },\r\n        });\r\n        mutateElement(element, resizedElement);\r\n    }\r\n};\r\nconst resizeMultipleElements = (elements, transformHandleType, pointerX, pointerY) => {\r\n    const [x1, y1, x2, y2] = getCommonBounds(elements);\r\n    let scale;\r\n    let getNextXY;\r\n    switch (transformHandleType) {\r\n        case \"se\":\r\n            scale = Math.max((pointerX - x1) / (x2 - x1), (pointerY - y1) / (y2 - y1));\r\n            getNextXY = (element, [origX1, origY1], [finalX1, finalY1]) => {\r\n                const x = element.x + (origX1 - x1) * (scale - 1) + origX1 - finalX1;\r\n                const y = element.y + (origY1 - y1) * (scale - 1) + origY1 - finalY1;\r\n                return { x, y };\r\n            };\r\n            break;\r\n        case \"nw\":\r\n            scale = Math.max((x2 - pointerX) / (x2 - x1), (y2 - pointerY) / (y2 - y1));\r\n            getNextXY = (element, [, , origX2, origY2], [, , finalX2, finalY2]) => {\r\n                const x = element.x - (x2 - origX2) * (scale - 1) + origX2 - finalX2;\r\n                const y = element.y - (y2 - origY2) * (scale - 1) + origY2 - finalY2;\r\n                return { x, y };\r\n            };\r\n            break;\r\n        case \"ne\":\r\n            scale = Math.max((pointerX - x1) / (x2 - x1), (y2 - pointerY) / (y2 - y1));\r\n            getNextXY = (element, [origX1, , , origY2], [finalX1, , , finalY2]) => {\r\n                const x = element.x + (origX1 - x1) * (scale - 1) + origX1 - finalX1;\r\n                const y = element.y - (y2 - origY2) * (scale - 1) + origY2 - finalY2;\r\n                return { x, y };\r\n            };\r\n            break;\r\n        case \"sw\":\r\n            scale = Math.max((x2 - pointerX) / (x2 - x1), (pointerY - y1) / (y2 - y1));\r\n            getNextXY = (element, [, origY1, origX2], [, finalY1, finalX2]) => {\r\n                const x = element.x - (x2 - origX2) * (scale - 1) + origX2 - finalX2;\r\n                const y = element.y + (origY1 - y1) * (scale - 1) + origY1 - finalY1;\r\n                return { x, y };\r\n            };\r\n            break;\r\n    }\r\n    if (scale > 0) {\r\n        const updates = elements.reduce((prev, element) => {\r\n            if (!prev) {\r\n                return prev;\r\n            }\r\n            const width = element.width * scale;\r\n            const height = element.height * scale;\r\n            let font = {};\r\n            if (element.type === \"text\") {\r\n                const nextFont = measureFontSizeFromWH(element, width, height);\r\n                if (nextFont === null) {\r\n                    return null;\r\n                }\r\n                font = { fontSize: nextFont.size, baseline: nextFont.baseline };\r\n            }\r\n            const origCoords = getElementAbsoluteCoords(element);\r\n            const rescaledPoints = rescalePointsInElement(element, width, height);\r\n            updateBoundElements(element, {\r\n                newSize: { width, height },\r\n                simultaneouslyUpdated: elements,\r\n            });\r\n            const finalCoords = getResizedElementAbsoluteCoords({\r\n                ...element,\r\n                ...rescaledPoints,\r\n            }, width, height);\r\n            const { x, y } = getNextXY(element, origCoords, finalCoords);\r\n            return [...prev, { width, height, x, y, ...rescaledPoints, ...font }];\r\n        }, []);\r\n        if (updates) {\r\n            elements.forEach((element, index) => {\r\n                mutateElement(element, updates[index]);\r\n            });\r\n        }\r\n    }\r\n};\r\nconst rotateMultipleElements = (pointerDownState, elements, pointerX, pointerY, shouldRotateWithDiscreteAngle, centerX, centerY) => {\r\n    let centerAngle = (5 * Math.PI) / 2 + Math.atan2(pointerY - centerY, pointerX - centerX);\r\n    if (shouldRotateWithDiscreteAngle) {\r\n        centerAngle += SHIFT_LOCKING_ANGLE / 2;\r\n        centerAngle -= centerAngle % SHIFT_LOCKING_ANGLE;\r\n    }\r\n    elements.forEach((element, index) => {\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n        const cx = (x1 + x2) / 2;\r\n        const cy = (y1 + y2) / 2;\r\n        const origAngle = pointerDownState.originalElements.get(element.id)?.angle ?? element.angle;\r\n        const [rotatedCX, rotatedCY] = rotate(cx, cy, centerX, centerY, centerAngle + origAngle - element.angle);\r\n        mutateElement(element, {\r\n            x: element.x + (rotatedCX - cx),\r\n            y: element.y + (rotatedCY - cy),\r\n            angle: normalizeAngle(centerAngle + origAngle),\r\n        });\r\n    });\r\n};\r\nexport const getResizeOffsetXY = (transformHandleType, selectedElements, x, y) => {\r\n    const [x1, y1, x2, y2] = selectedElements.length === 1\r\n        ? getElementAbsoluteCoords(selectedElements[0])\r\n        : getCommonBounds(selectedElements);\r\n    const cx = (x1 + x2) / 2;\r\n    const cy = (y1 + y2) / 2;\r\n    const angle = selectedElements.length === 1 ? selectedElements[0].angle : 0;\r\n    [x, y] = rotate(x, y, cx, cy, -angle);\r\n    switch (transformHandleType) {\r\n        case \"n\":\r\n            return rotate(x - (x1 + x2) / 2, y - y1, 0, 0, angle);\r\n        case \"s\":\r\n            return rotate(x - (x1 + x2) / 2, y - y2, 0, 0, angle);\r\n        case \"w\":\r\n            return rotate(x - x1, y - (y1 + y2) / 2, 0, 0, angle);\r\n        case \"e\":\r\n            return rotate(x - x2, y - (y1 + y2) / 2, 0, 0, angle);\r\n        case \"nw\":\r\n            return rotate(x - x1, y - y1, 0, 0, angle);\r\n        case \"ne\":\r\n            return rotate(x - x2, y - y1, 0, 0, angle);\r\n        case \"sw\":\r\n            return rotate(x - x1, y - y2, 0, 0, angle);\r\n        case \"se\":\r\n            return rotate(x - x2, y - y2, 0, 0, angle);\r\n        default:\r\n            return [0, 0];\r\n    }\r\n};\r\nexport const getResizeArrowDirection = (transformHandleType, element) => {\r\n    const [, [px, py]] = element.points;\r\n    const isResizeEnd = (transformHandleType === \"nw\" && (px < 0 || py < 0)) ||\r\n        (transformHandleType === \"ne\" && px >= 0) ||\r\n        (transformHandleType === \"sw\" && px <= 0) ||\r\n        (transformHandleType === \"se\" && (px > 0 || py > 0));\r\n    return isResizeEnd ? \"end\" : \"origin\";\r\n};\r\n","import { updateBoundElements } from \"./binding\";\r\nimport { getCommonBounds } from \"./bounds\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nimport { getPerfectElementSize } from \"./sizeHelpers\";\r\nexport const dragSelectedElements = (pointerDownState, selectedElements, pointerX, pointerY, scene, lockDirection = false, distanceX = 0, distanceY = 0) => {\r\n    const [x1, y1] = getCommonBounds(selectedElements);\r\n    const offset = { x: pointerX - x1, y: pointerY - y1 };\r\n    selectedElements.forEach((element) => {\r\n        let x;\r\n        let y;\r\n        if (lockDirection) {\r\n            const lockX = lockDirection && distanceX < distanceY;\r\n            const lockY = lockDirection && distanceX > distanceY;\r\n            const original = pointerDownState.originalElements.get(element.id);\r\n            x = lockX && original ? original.x : element.x + offset.x;\r\n            y = lockY && original ? original.y : element.y + offset.y;\r\n        }\r\n        else {\r\n            x = element.x + offset.x;\r\n            y = element.y + offset.y;\r\n        }\r\n        mutateElement(element, {\r\n            x,\r\n            y,\r\n        });\r\n        updateBoundElements(element, {\r\n            simultaneouslyUpdated: selectedElements,\r\n        });\r\n    });\r\n};\r\nexport const getDragOffsetXY = (selectedElements, x, y) => {\r\n    const [x1, y1] = getCommonBounds(selectedElements);\r\n    return [x - x1, y - y1];\r\n};\r\nexport const dragNewElement = (draggingElement, elementType, originX, originY, x, y, width, height, shouldMaintainAspectRatio, shouldResizeFromCenter, \r\n/** whether to keep given aspect ratio when `isResizeWithSidesSameLength` is\r\n    true */\r\nwidthAspectRatio) => {\r\n    if (shouldMaintainAspectRatio) {\r\n        if (widthAspectRatio) {\r\n            height = width / widthAspectRatio;\r\n        }\r\n        else {\r\n            ({ width, height } = getPerfectElementSize(elementType, width, y < originY ? -height : height));\r\n            if (height < 0) {\r\n                height = -height;\r\n            }\r\n        }\r\n    }\r\n    let newX = x < originX ? originX - width : originX;\r\n    let newY = y < originY ? originY - height : originY;\r\n    if (shouldResizeFromCenter) {\r\n        width += width;\r\n        height += height;\r\n        newX = originX - width / 2;\r\n        newY = originY - height / 2;\r\n    }\r\n    if (width !== 0 && height !== 0) {\r\n        mutateElement(draggingElement, {\r\n            x: newX,\r\n            y: newY,\r\n            width,\r\n            height,\r\n        });\r\n    }\r\n};\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { isWritableElement, getFontString } from \"../utils\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { isTextElement } from \"./typeChecks\";\r\nimport { CLASSES } from \"../constants\";\r\nconst normalizeText = (text) => {\r\n    return (text\r\n        // replace tabs with spaces so they render and measure correctly\r\n        .replace(/\\t/g, \"        \")\r\n        // normalize newlines\r\n        .replace(/\\r?\\n|\\r/g, \"\\n\"));\r\n};\r\nconst getTransform = (width, height, angle, appState, maxWidth) => {\r\n    const { zoom, offsetTop, offsetLeft } = appState;\r\n    const degree = (180 * angle) / Math.PI;\r\n    // offsets must be multiplied by 2 to account for the division by 2 of\r\n    // the whole expression afterwards\r\n    let translateX = ((width - offsetLeft * 2) * (zoom.value - 1)) / 2;\r\n    const translateY = ((height - offsetTop * 2) * (zoom.value - 1)) / 2;\r\n    if (width > maxWidth && zoom.value !== 1) {\r\n        translateX = (maxWidth / 2) * (zoom.value - 1);\r\n    }\r\n    return `translate(${translateX}px, ${translateY}px) scale(${zoom.value}) rotate(${degree}deg)`;\r\n};\r\nexport const textWysiwyg = ({ id, appState, onChange, onSubmit, getViewportCoords, element, canvas, excalidrawContainer, }) => {\r\n    const updateWysiwygStyle = () => {\r\n        const updatedElement = Scene.getScene(element)?.getElement(id);\r\n        if (updatedElement && isTextElement(updatedElement)) {\r\n            const [viewportX, viewportY] = getViewportCoords(updatedElement.x, updatedElement.y);\r\n            const { textAlign, angle } = updatedElement;\r\n            editable.value = updatedElement.text;\r\n            const lines = updatedElement.text.replace(/\\r\\n?/g, \"\\n\").split(\"\\n\");\r\n            const lineHeight = updatedElement.height / lines.length;\r\n            const maxWidth = (appState.offsetLeft + appState.width - viewportX - 8) /\r\n                appState.zoom.value -\r\n                // margin-right of parent if any\r\n                Number(getComputedStyle(excalidrawContainer?.parentNode).marginRight.slice(0, -2));\r\n            Object.assign(editable.style, {\r\n                font: getFontString(updatedElement),\r\n                // must be defined *after* font ¯\\_(ツ)_/¯\r\n                lineHeight: `${lineHeight}px`,\r\n                width: `${updatedElement.width}px`,\r\n                height: `${updatedElement.height}px`,\r\n                left: `${viewportX}px`,\r\n                top: `${viewportY}px`,\r\n                transform: getTransform(updatedElement.width, updatedElement.height, angle, appState, maxWidth),\r\n                textAlign,\r\n                color: updatedElement.strokeColor,\r\n                opacity: updatedElement.opacity / 100,\r\n                filter: \"var(--theme-filter)\",\r\n                maxWidth: `${maxWidth}px`,\r\n            });\r\n        }\r\n    };\r\n    const editable = document.createElement(\"textarea\");\r\n    editable.dir = \"auto\";\r\n    editable.tabIndex = 0;\r\n    editable.dataset.type = \"wysiwyg\";\r\n    // prevent line wrapping on Safari\r\n    editable.wrap = \"off\";\r\n    Object.assign(editable.style, {\r\n        position: \"absolute\",\r\n        display: \"inline-block\",\r\n        minHeight: \"1em\",\r\n        backfaceVisibility: \"hidden\",\r\n        margin: 0,\r\n        padding: 0,\r\n        border: 0,\r\n        outline: 0,\r\n        resize: \"none\",\r\n        background: \"transparent\",\r\n        overflow: \"hidden\",\r\n        // prevent line wrapping (`whitespace: nowrap` doesn't work on FF)\r\n        whiteSpace: \"pre\",\r\n        // must be specified because in dark mode canvas creates a stacking context\r\n        zIndex: \"var(--zIndex-wysiwyg)\",\r\n    });\r\n    updateWysiwygStyle();\r\n    if (onChange) {\r\n        editable.oninput = () => {\r\n            onChange(normalizeText(editable.value));\r\n        };\r\n    }\r\n    editable.onkeydown = (event) => {\r\n        event.stopPropagation();\r\n        if (event.key === KEYS.ESCAPE) {\r\n            event.preventDefault();\r\n            submittedViaKeyboard = true;\r\n            handleSubmit();\r\n        }\r\n        else if (event.key === KEYS.ENTER && event[KEYS.CTRL_OR_CMD]) {\r\n            event.preventDefault();\r\n            if (event.isComposing || event.keyCode === 229) {\r\n                return;\r\n            }\r\n            submittedViaKeyboard = true;\r\n            handleSubmit();\r\n        }\r\n        else if (event.key === KEYS.TAB ||\r\n            (event[KEYS.CTRL_OR_CMD] &&\r\n                (event.code === CODES.BRACKET_LEFT ||\r\n                    event.code === CODES.BRACKET_RIGHT))) {\r\n            event.preventDefault();\r\n            if (event.shiftKey || event.code === CODES.BRACKET_LEFT) {\r\n                outdent();\r\n            }\r\n            else {\r\n                indent();\r\n            }\r\n            // We must send an input event to resize the element\r\n            editable.dispatchEvent(new Event(\"input\"));\r\n        }\r\n    };\r\n    const TAB_SIZE = 4;\r\n    const TAB = \" \".repeat(TAB_SIZE);\r\n    const RE_LEADING_TAB = new RegExp(`^ {1,${TAB_SIZE}}`);\r\n    const indent = () => {\r\n        const { selectionStart, selectionEnd } = editable;\r\n        const linesStartIndices = getSelectedLinesStartIndices();\r\n        let value = editable.value;\r\n        linesStartIndices.forEach((startIndex) => {\r\n            const startValue = value.slice(0, startIndex);\r\n            const endValue = value.slice(startIndex);\r\n            value = `${startValue}${TAB}${endValue}`;\r\n        });\r\n        editable.value = value;\r\n        editable.selectionStart = selectionStart + TAB_SIZE;\r\n        editable.selectionEnd = selectionEnd + TAB_SIZE * linesStartIndices.length;\r\n    };\r\n    const outdent = () => {\r\n        const { selectionStart, selectionEnd } = editable;\r\n        const linesStartIndices = getSelectedLinesStartIndices();\r\n        const removedTabs = [];\r\n        let value = editable.value;\r\n        linesStartIndices.forEach((startIndex) => {\r\n            const tabMatch = value\r\n                .slice(startIndex, startIndex + TAB_SIZE)\r\n                .match(RE_LEADING_TAB);\r\n            if (tabMatch) {\r\n                const startValue = value.slice(0, startIndex);\r\n                const endValue = value.slice(startIndex + tabMatch[0].length);\r\n                // Delete a tab from the line\r\n                value = `${startValue}${endValue}`;\r\n                removedTabs.push(startIndex);\r\n            }\r\n        });\r\n        editable.value = value;\r\n        if (removedTabs.length) {\r\n            if (selectionStart > removedTabs[removedTabs.length - 1]) {\r\n                editable.selectionStart = Math.max(selectionStart - TAB_SIZE, removedTabs[removedTabs.length - 1]);\r\n            }\r\n            else {\r\n                // If the cursor is before the first tab removed, ex:\r\n                // Line| #1\r\n                //     Line #2\r\n                // Lin|e #3\r\n                // we should reset the selectionStart to his initial value.\r\n                editable.selectionStart = selectionStart;\r\n            }\r\n            editable.selectionEnd = Math.max(editable.selectionStart, selectionEnd - TAB_SIZE * removedTabs.length);\r\n        }\r\n    };\r\n    /**\r\n     * @returns indeces of start positions of selected lines, in reverse order\r\n     */\r\n    const getSelectedLinesStartIndices = () => {\r\n        let { selectionStart, selectionEnd, value } = editable;\r\n        // chars before selectionStart on the same line\r\n        const startOffset = value.slice(0, selectionStart).match(/[^\\n]*$/)[0]\r\n            .length;\r\n        // put caret at the start of the line\r\n        selectionStart = selectionStart - startOffset;\r\n        const selected = value.slice(selectionStart, selectionEnd);\r\n        return selected\r\n            .split(\"\\n\")\r\n            .reduce((startIndices, line, idx, lines) => startIndices.concat(idx\r\n            ? // curr line index is prev line's start + prev line's length + \\n\r\n                startIndices[idx - 1] + lines[idx - 1].length + 1\r\n            : // first selected line\r\n                selectionStart), [])\r\n            .reverse();\r\n    };\r\n    const stopEvent = (event) => {\r\n        event.preventDefault();\r\n        event.stopPropagation();\r\n    };\r\n    // using a state variable instead of passing it to the handleSubmit callback\r\n    // so that we don't need to create separate a callback for event handlers\r\n    let submittedViaKeyboard = false;\r\n    const handleSubmit = () => {\r\n        // cleanup must be run before onSubmit otherwise when app blurs the wysiwyg\r\n        // it'd get stuck in an infinite loop of blur→onSubmit after we re-focus the\r\n        // wysiwyg on update\r\n        cleanup();\r\n        onSubmit({\r\n            text: normalizeText(editable.value),\r\n            viaKeyboard: submittedViaKeyboard,\r\n        });\r\n    };\r\n    const cleanup = () => {\r\n        if (isDestroyed) {\r\n            return;\r\n        }\r\n        isDestroyed = true;\r\n        // remove events to ensure they don't late-fire\r\n        editable.onblur = null;\r\n        editable.oninput = null;\r\n        editable.onkeydown = null;\r\n        if (observer) {\r\n            observer.disconnect();\r\n        }\r\n        window.removeEventListener(\"resize\", updateWysiwygStyle);\r\n        window.removeEventListener(\"wheel\", stopEvent, true);\r\n        window.removeEventListener(\"pointerdown\", onPointerDown);\r\n        window.removeEventListener(\"pointerup\", bindBlurEvent);\r\n        window.removeEventListener(\"blur\", handleSubmit);\r\n        unbindUpdate();\r\n        editable.remove();\r\n    };\r\n    const bindBlurEvent = () => {\r\n        window.removeEventListener(\"pointerup\", bindBlurEvent);\r\n        // Deferred so that the pointerdown that initiates the wysiwyg doesn't\r\n        // trigger the blur on ensuing pointerup.\r\n        // Also to handle cases such as picking a color which would trigger a blur\r\n        // in that same tick.\r\n        setTimeout(() => {\r\n            editable.onblur = handleSubmit;\r\n            // case: clicking on the same property → no change → no update → no focus\r\n            editable.focus();\r\n        });\r\n    };\r\n    // prevent blur when changing properties from the menu\r\n    const onPointerDown = (event) => {\r\n        if ((event.target instanceof HTMLElement ||\r\n            event.target instanceof SVGElement) &&\r\n            event.target.closest(`.${CLASSES.SHAPE_ACTIONS_MENU}`) &&\r\n            !isWritableElement(event.target)) {\r\n            editable.onblur = null;\r\n            window.addEventListener(\"pointerup\", bindBlurEvent);\r\n            // handle edge-case where pointerup doesn't fire e.g. due to user\r\n            // alt-tabbing away\r\n            window.addEventListener(\"blur\", handleSubmit);\r\n        }\r\n    };\r\n    // handle updates of textElement properties of editing element\r\n    const unbindUpdate = Scene.getScene(element).addCallback(() => {\r\n        updateWysiwygStyle();\r\n        editable.focus();\r\n    });\r\n    // ---------------------------------------------------------------------------\r\n    let isDestroyed = false;\r\n    // select on init (focusing is done separately inside the bindBlurEvent()\r\n    // because we need it to happen *after* the blur event from `pointerdown`)\r\n    editable.select();\r\n    bindBlurEvent();\r\n    // reposition wysiwyg in case of canvas is resized. Using ResizeObserver\r\n    // is preferred so we catch changes from host, where window may not resize.\r\n    let observer = null;\r\n    if (canvas && \"ResizeObserver\" in window) {\r\n        observer = new window.ResizeObserver(() => {\r\n            updateWysiwygStyle();\r\n        });\r\n        observer.observe(canvas);\r\n    }\r\n    else {\r\n        window.addEventListener(\"resize\", updateWysiwygStyle);\r\n    }\r\n    window.addEventListener(\"pointerdown\", onPointerDown);\r\n    window.addEventListener(\"wheel\", stopEvent, {\r\n        passive: false,\r\n        capture: true,\r\n    });\r\n    excalidrawContainer\r\n        ?.querySelector(\".excalidraw-textEditorContainer\")\r\n        .appendChild(editable);\r\n};\r\n","import { measureText, getFontString } from \"../utils\";\r\nimport { mutateElement } from \"./mutateElement\";\r\nexport const redrawTextBoundingBox = (element) => {\r\n    const metrics = measureText(element.text, getFontString(element));\r\n    mutateElement(element, {\r\n        width: metrics.width,\r\n        height: metrics.height,\r\n        baseline: metrics.baseline,\r\n    });\r\n};\r\n","import { getSelectedElements } from \"../scene\";\r\nexport const showSelectedShapeActions = (appState, elements) => Boolean(!appState.viewModeEnabled &&\r\n    (appState.editingElement ||\r\n        getSelectedElements(elements, appState).length ||\r\n        appState.elementType !== \"selection\"));\r\n","import { isInvisiblySmallElement } from \"./sizeHelpers\";\r\nimport { isLinearElementType } from \"./typeChecks\";\r\nexport { newElement, newTextElement, updateTextElement, newLinearElement, newImageElement, duplicateElement, } from \"./newElement\";\r\nexport { getElementAbsoluteCoords, getElementBounds, getCommonBounds, getDiamondPoints, getArrowheadPoints, getClosestElementBounds, } from \"./bounds\";\r\nexport { OMIT_SIDES_FOR_MULTIPLE_ELEMENTS, getTransformHandlesFromCoords, getTransformHandles, } from \"./transformHandles\";\r\nexport { hitTest, isHittingElementBoundingBoxWithoutHittingElement, } from \"./collision\";\r\nexport { resizeTest, getCursorForResizingElement, getElementWithTransformHandleType, getTransformHandleTypeFromCoords, } from \"./resizeTest\";\r\nexport { transformElements, getResizeOffsetXY, getResizeArrowDirection, } from \"./resizeElements\";\r\nexport { dragSelectedElements, getDragOffsetXY, dragNewElement, } from \"./dragElements\";\r\nexport { isTextElement, isExcalidrawElement } from \"./typeChecks\";\r\nexport { textWysiwyg } from \"./textWysiwyg\";\r\nexport { redrawTextBoundingBox } from \"./textElement\";\r\nexport { getPerfectElementSize, isInvisiblySmallElement, resizePerfectLineForNWHandler, getNormalizedDimensions, } from \"./sizeHelpers\";\r\nexport { showSelectedShapeActions } from \"./showSelectedShapeActions\";\r\nexport const getElementMap = (elements) => elements.reduce((acc, element) => {\r\n    acc[element.id] = element;\r\n    return acc;\r\n}, {});\r\nexport const getSceneVersion = (elements) => elements.reduce((acc, el) => acc + el.version, 0);\r\nexport const getVisibleElements = (elements) => elements.filter((el) => !el.isDeleted && !isInvisiblySmallElement(el));\r\nexport const getNonDeletedElements = (elements) => elements.filter((element) => !element.isDeleted);\r\nexport const isNonDeletedElement = (element) => !element.isDeleted;\r\nconst _clearElements = (elements) => getNonDeletedElements(elements).map((element) => isLinearElementType(element.type)\r\n    ? { ...element, lastCommittedPoint: null }\r\n    : element);\r\nexport const clearElementsForDatabase = (elements) => _clearElements(elements);\r\nexport const clearElementsForExport = (elements) => _clearElements(elements);\r\nexport const clearElementsForLocalStorage = (elements) => _clearElements(elements);\r\n","import { getCommonBounds } from \"../element\";\r\nimport { getGlobalCSSVariable } from \"../utils\";\r\nimport { getLanguage } from \"../i18n\";\r\nexport const SCROLLBAR_MARGIN = 4;\r\nexport const SCROLLBAR_WIDTH = 6;\r\nexport const SCROLLBAR_COLOR = \"rgba(0,0,0,0.3)\";\r\nexport const getScrollBars = (elements, viewportWidth, viewportHeight, { scrollX, scrollY, zoom, }) => {\r\n    if (elements.length === 0) {\r\n        return {\r\n            horizontal: null,\r\n            vertical: null,\r\n        };\r\n    }\r\n    // This is the bounding box of all the elements\r\n    const [elementsMinX, elementsMinY, elementsMaxX, elementsMaxY] = getCommonBounds(elements);\r\n    // Apply zoom\r\n    const viewportWidthWithZoom = viewportWidth / zoom.value;\r\n    const viewportHeightWithZoom = viewportHeight / zoom.value;\r\n    const viewportWidthDiff = viewportWidth - viewportWidthWithZoom;\r\n    const viewportHeightDiff = viewportHeight - viewportHeightWithZoom;\r\n    const safeArea = {\r\n        top: parseInt(getGlobalCSSVariable(\"sat\")),\r\n        bottom: parseInt(getGlobalCSSVariable(\"sab\")),\r\n        left: parseInt(getGlobalCSSVariable(\"sal\")),\r\n        right: parseInt(getGlobalCSSVariable(\"sar\")),\r\n    };\r\n    const isRTL = getLanguage().rtl;\r\n    // The viewport is the rectangle currently visible for the user\r\n    const viewportMinX = -scrollX + viewportWidthDiff / 2 + safeArea.left;\r\n    const viewportMinY = -scrollY + viewportHeightDiff / 2 + safeArea.top;\r\n    const viewportMaxX = viewportMinX + viewportWidthWithZoom - safeArea.right;\r\n    const viewportMaxY = viewportMinY + viewportHeightWithZoom - safeArea.bottom;\r\n    // The scene is the bounding box of both the elements and viewport\r\n    const sceneMinX = Math.min(elementsMinX, viewportMinX);\r\n    const sceneMinY = Math.min(elementsMinY, viewportMinY);\r\n    const sceneMaxX = Math.max(elementsMaxX, viewportMaxX);\r\n    const sceneMaxY = Math.max(elementsMaxY, viewportMaxY);\r\n    // The scrollbar represents where the viewport is in relationship to the scene\r\n    return {\r\n        horizontal: viewportMinX === sceneMinX && viewportMaxX === sceneMaxX\r\n            ? null\r\n            : {\r\n                x: Math.max(safeArea.left, SCROLLBAR_MARGIN) +\r\n                    ((viewportMinX - sceneMinX) / (sceneMaxX - sceneMinX)) *\r\n                        viewportWidth,\r\n                y: viewportHeight -\r\n                    SCROLLBAR_WIDTH -\r\n                    Math.max(SCROLLBAR_MARGIN, safeArea.bottom),\r\n                width: ((viewportMaxX - viewportMinX) / (sceneMaxX - sceneMinX)) *\r\n                    viewportWidth -\r\n                    Math.max(SCROLLBAR_MARGIN * 2, safeArea.left + safeArea.right),\r\n                height: SCROLLBAR_WIDTH,\r\n            },\r\n        vertical: viewportMinY === sceneMinY && viewportMaxY === sceneMaxY\r\n            ? null\r\n            : {\r\n                x: isRTL\r\n                    ? Math.max(safeArea.left, SCROLLBAR_MARGIN)\r\n                    : viewportWidth -\r\n                        SCROLLBAR_WIDTH -\r\n                        Math.max(safeArea.right, SCROLLBAR_MARGIN),\r\n                y: ((viewportMinY - sceneMinY) / (sceneMaxY - sceneMinY)) *\r\n                    viewportHeight +\r\n                    Math.max(safeArea.top, SCROLLBAR_MARGIN),\r\n                width: SCROLLBAR_WIDTH,\r\n                height: ((viewportMaxY - viewportMinY) / (sceneMaxY - sceneMinY)) *\r\n                    viewportHeight -\r\n                    Math.max(SCROLLBAR_MARGIN * 2, safeArea.top + safeArea.bottom),\r\n            },\r\n    };\r\n};\r\nexport const isOverScrollBars = (scrollBars, x, y) => {\r\n    const [isOverHorizontal, isOverVertical] = [\r\n        scrollBars.horizontal,\r\n        scrollBars.vertical,\r\n    ].map((scrollBar) => {\r\n        return (scrollBar != null &&\r\n            scrollBar.x <= x &&\r\n            x <= scrollBar.x + scrollBar.width &&\r\n            scrollBar.y <= y &&\r\n            y <= scrollBar.y + scrollBar.height);\r\n    });\r\n    const isOverEither = isOverHorizontal || isOverVertical;\r\n    return { isOverEither, isOverHorizontal, isOverVertical };\r\n};\r\n","import { getElementAbsoluteCoords, getElementBounds } from \"../element\";\r\nexport const getElementsWithinSelection = (elements, selection) => {\r\n    const [selectionX1, selectionY1, selectionX2, selectionY2] = getElementAbsoluteCoords(selection);\r\n    return elements.filter((element) => {\r\n        const [elementX1, elementY1, elementX2, elementY2] = getElementBounds(element);\r\n        return (element.type !== \"selection\" &&\r\n            selectionX1 <= elementX1 &&\r\n            selectionY1 <= elementY1 &&\r\n            selectionX2 >= elementX2 &&\r\n            selectionY2 >= elementY2);\r\n    });\r\n};\r\nexport const isSomeElementSelected = (elements, appState) => elements.some((element) => appState.selectedElementIds[element.id]);\r\n/**\r\n * Returns common attribute (picked by `getAttribute` callback) of selected\r\n *  elements. If elements don't share the same value, returns `null`.\r\n */\r\nexport const getCommonAttributeOfSelectedElements = (elements, appState, getAttribute) => {\r\n    const attributes = Array.from(new Set(getSelectedElements(elements, appState).map((element) => getAttribute(element))));\r\n    return attributes.length === 1 ? attributes[0] : null;\r\n};\r\nexport const getSelectedElements = (elements, appState) => elements.filter((element) => appState.selectedElementIds[element.id]);\r\nexport const getTargetElements = (elements, appState) => appState.editingElement\r\n    ? [appState.editingElement]\r\n    : getSelectedElements(elements, appState);\r\n","import { getCommonBounds, getClosestElementBounds, getVisibleElements, } from \"../element\";\r\nimport { sceneCoordsToViewportCoords, viewportCoordsToSceneCoords, } from \"../utils\";\r\nconst isOutsideViewPort = (appState, canvas, cords) => {\r\n    const [x1, y1, x2, y2] = cords;\r\n    const { x: viewportX1, y: viewportY1 } = sceneCoordsToViewportCoords({ sceneX: x1, sceneY: y1 }, appState);\r\n    const { x: viewportX2, y: viewportY2 } = sceneCoordsToViewportCoords({ sceneX: x2, sceneY: y2 }, appState);\r\n    return (viewportX2 - viewportX1 > appState.width ||\r\n        viewportY2 - viewportY1 > appState.height);\r\n};\r\nexport const centerScrollOn = ({ scenePoint, viewportDimensions, zoom, }) => {\r\n    return {\r\n        scrollX: (viewportDimensions.width / 2) * (1 / zoom.value) -\r\n            scenePoint.x -\r\n            zoom.translation.x * (1 / zoom.value),\r\n        scrollY: (viewportDimensions.height / 2) * (1 / zoom.value) -\r\n            scenePoint.y -\r\n            zoom.translation.y * (1 / zoom.value),\r\n    };\r\n};\r\nexport const calculateScrollCenter = (elements, appState, canvas) => {\r\n    elements = getVisibleElements(elements);\r\n    if (!elements.length) {\r\n        return {\r\n            scrollX: 0,\r\n            scrollY: 0,\r\n        };\r\n    }\r\n    let [x1, y1, x2, y2] = getCommonBounds(elements);\r\n    if (isOutsideViewPort(appState, canvas, [x1, y1, x2, y2])) {\r\n        [x1, y1, x2, y2] = getClosestElementBounds(elements, viewportCoordsToSceneCoords({ clientX: appState.scrollX, clientY: appState.scrollY }, appState));\r\n    }\r\n    const centerX = (x1 + x2) / 2;\r\n    const centerY = (y1 + y2) / 2;\r\n    return centerScrollOn({\r\n        scenePoint: { x: centerX, y: centerY },\r\n        viewportDimensions: { width: appState.width, height: appState.height },\r\n        zoom: appState.zoom,\r\n    });\r\n};\r\n","import { getElementAbsoluteCoords } from \"../element\";\r\nexport const hasBackground = (type) => type === \"rectangle\" ||\r\n    type === \"ellipse\" ||\r\n    type === \"diamond\" ||\r\n    type === \"line\";\r\nexport const hasStrokeColor = (type) => type !== \"image\";\r\nexport const hasStrokeWidth = (type) => type === \"rectangle\" ||\r\n    type === \"ellipse\" ||\r\n    type === \"diamond\" ||\r\n    type === \"freedraw\" ||\r\n    type === \"arrow\" ||\r\n    type === \"line\";\r\nexport const hasStrokeStyle = (type) => type === \"rectangle\" ||\r\n    type === \"ellipse\" ||\r\n    type === \"diamond\" ||\r\n    type === \"arrow\" ||\r\n    type === \"line\";\r\nexport const canChangeSharpness = (type) => type === \"rectangle\" || type === \"arrow\" || type === \"line\";\r\nexport const hasText = (type) => type === \"text\";\r\nexport const canHaveArrowheads = (type) => type === \"arrow\";\r\nexport const getElementAtPosition = (elements, isAtPositionFn) => {\r\n    let hitElement = null;\r\n    // We need to to hit testing from front (end of the array) to back (beginning of the array)\r\n    // because array is ordered from lower z-index to highest and we want element z-index\r\n    // with higher z-index\r\n    for (let index = elements.length - 1; index >= 0; --index) {\r\n        const element = elements[index];\r\n        if (element.isDeleted) {\r\n            continue;\r\n        }\r\n        if (isAtPositionFn(element)) {\r\n            hitElement = element;\r\n            break;\r\n        }\r\n    }\r\n    return hitElement;\r\n};\r\nexport const getElementsAtPosition = (elements, isAtPositionFn) => {\r\n    // The parameter elements comes ordered from lower z-index to higher.\r\n    // We want to preserve that order on the returned array.\r\n    return elements.filter((element) => !element.isDeleted && isAtPositionFn(element));\r\n};\r\nexport const getElementContainingPosition = (elements, x, y) => {\r\n    let hitElement = null;\r\n    // We need to to hit testing from front (end of the array) to back (beginning of the array)\r\n    for (let index = elements.length - 1; index >= 0; --index) {\r\n        if (elements[index].isDeleted) {\r\n            continue;\r\n        }\r\n        const [x1, y1, x2, y2] = getElementAbsoluteCoords(elements[index]);\r\n        if (x1 < x && x < x2 && y1 < y && y < y2) {\r\n            hitElement = elements[index];\r\n            break;\r\n        }\r\n    }\r\n    return hitElement;\r\n};\r\n","export const getNewZoom = (newZoomValue, prevZoom, canvasOffset, zoomOnViewportPoint = { x: 0, y: 0 }) => {\r\n    return {\r\n        value: newZoomValue,\r\n        translation: {\r\n            x: zoomOnViewportPoint.x -\r\n                canvasOffset.left -\r\n                (zoomOnViewportPoint.x - canvasOffset.left - prevZoom.translation.x) *\r\n                    (newZoomValue / prevZoom.value),\r\n            y: zoomOnViewportPoint.y -\r\n                canvasOffset.top -\r\n                (zoomOnViewportPoint.y - canvasOffset.top - prevZoom.translation.y) *\r\n                    (newZoomValue / prevZoom.value),\r\n        },\r\n    };\r\n};\r\nexport const getNormalizedZoom = (zoom) => {\r\n    const normalizedZoom = parseFloat(zoom.toFixed(2));\r\n    const clampedZoom = Math.max(0.1, Math.min(normalizedZoom, 10));\r\n    return clampedZoom;\r\n};\r\n","export class CanvasError extends Error {\r\n    constructor(message = \"Couldn't export canvas.\", name = \"CANVAS_ERROR\") {\r\n        super();\r\n        this.name = name;\r\n        this.message = message;\r\n    }\r\n}\r\nexport class AbortError extends DOMException {\r\n    constructor(message = \"Request Aborted\") {\r\n        super(message, \"AbortError\");\r\n    }\r\n}\r\n","import React from \"react\";\r\nimport \"./Spinner.scss\";\r\nconst Spinner = ({ size = \"1em\", circleWidth = 8, }) => {\r\n    return (<div className=\"Spinner\">\r\n      <svg viewBox=\"0 0 100 100\" style={{ width: size, height: size }}>\r\n        <circle cx=\"50\" cy=\"50\" r={50 - circleWidth / 2} strokeWidth={circleWidth} fill=\"none\" strokeMiterlimit=\"10\"/>\r\n      </svg>\r\n    </div>);\r\n};\r\nexport default Spinner;\r\n","import \"./ToolIcon.scss\";\r\nimport React, { useEffect, useRef, useState } from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nimport { AbortError } from \"../errors\";\r\nimport Spinner from \"./Spinner\";\r\nexport const ToolButton = React.forwardRef((props, ref) => {\r\n    const { id: excalId } = useExcalidrawContainer();\r\n    const innerRef = React.useRef(null);\r\n    React.useImperativeHandle(ref, () => innerRef.current);\r\n    const sizeCn = `ToolIcon_size_${props.size}`;\r\n    const [isLoading, setIsLoading] = useState(false);\r\n    const isMountedRef = useRef(true);\r\n    const onClick = async (event) => {\r\n        const ret = \"onClick\" in props && props.onClick?.(event);\r\n        if (ret && \"then\" in ret) {\r\n            try {\r\n                setIsLoading(true);\r\n                await ret;\r\n            }\r\n            catch (error) {\r\n                if (!(error instanceof AbortError)) {\r\n                    throw error;\r\n                }\r\n            }\r\n            finally {\r\n                if (isMountedRef.current) {\r\n                    setIsLoading(false);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    useEffect(() => () => {\r\n        isMountedRef.current = false;\r\n    }, []);\r\n    const lastPointerTypeRef = useRef(null);\r\n    if (props.type === \"button\" || props.type === \"icon\") {\r\n        return (<button className={clsx(\"ToolIcon_type_button\", sizeCn, props.className, props.visible && !props.hidden\r\n                ? \"ToolIcon_type_button--show\"\r\n                : \"ToolIcon_type_button--hide\", {\r\n                ToolIcon: !props.hidden,\r\n                \"ToolIcon--selected\": props.selected,\r\n                \"ToolIcon--plain\": props.type === \"icon\",\r\n            })} data-testid={props[\"data-testid\"]} hidden={props.hidden} title={props.title} aria-label={props[\"aria-label\"]} type=\"button\" onClick={onClick} ref={innerRef} disabled={isLoading}>\r\n        {(props.icon || props.label) && (<div className=\"ToolIcon__icon\" aria-hidden=\"true\">\r\n            {props.icon || props.label}\r\n            {props.keyBindingLabel && (<span className=\"ToolIcon__keybinding\">\r\n                {props.keyBindingLabel}\r\n              </span>)}\r\n          </div>)}\r\n        {props.showAriaLabel && (<div className=\"ToolIcon__label\">\r\n            {props[\"aria-label\"]} {isLoading && <Spinner />}\r\n          </div>)}\r\n        {props.children}\r\n      </button>);\r\n    }\r\n    return (<label className={clsx(`ToolIcon ${props.title}`, props.className)} title={props.title} onPointerDown={(event) => {\r\n            lastPointerTypeRef.current = event.pointerType || null;\r\n        }} onPointerUp={() => {\r\n            requestAnimationFrame(() => {\r\n                lastPointerTypeRef.current = null;\r\n            });\r\n        }}>\r\n      <input className={`ToolIcon_type_radio ${sizeCn} ${props[\"aria-label\"]}`} type=\"radio\" name={props.name} aria-label={props[\"aria-label\"]} aria-keyshortcuts={props[\"aria-keyshortcuts\"]} data-testid={props[\"data-testid\"]} id={`${excalId}-${props.id}`} onChange={() => {\r\n            props.onChange?.({ pointerType: lastPointerTypeRef.current });\r\n        }} checked={props.checked} ref={innerRef}/>\r\n      <div className = {`ToolIcon__icon ${props[\"aria-label\"]}`}>\r\n        {props.icon}\r\n        {props.keyBindingLabel && (<span className=\"ToolIcon__keybinding\">{props.keyBindingLabel}</span>)}\r\n      </div>\r\n    </label>);\r\n});\r\nToolButton.defaultProps = {\r\n    visible: true,\r\n    className: \"\",\r\n    size: \"medium\",\r\n};\r\n","//\r\n// All icons are imported from https://fontawesome.com/icons?d=gallery\r\n// Icons are under the license https://fontawesome.com/license\r\n//\r\n// Note: when adding new icons, review https://developer.mozilla.org/en-US/docs/Mozilla/Developer_guide/RTL_Guidelines\r\n// to determine whether or not the icons should be mirrored in right-to-left languages.\r\nimport React from \"react\";\r\nimport oc from \"open-color\";\r\nimport clsx from \"clsx\";\r\nimport { THEME } from \"../constants\";\r\nconst activeElementColor = (theme) => theme === THEME.LIGHT ? oc.orange[4] : oc.orange[9];\r\nconst iconFillColor = (theme) => theme === THEME.LIGHT ? oc.black : oc.gray[4];\r\nconst handlerColor = (theme) => theme === THEME.LIGHT ? oc.white : \"#1e1e1e\";\r\nexport const createIcon = (d, opts = 512) => {\r\n    const { width = 512, height = width, mirror, style, } = typeof opts === \"number\" ? { width: opts } : opts;\r\n    return (<svg aria-hidden=\"true\" focusable=\"false\" role=\"img\" viewBox={`0 0 ${width} ${height}`} className={clsx({ \"rtl-mirror\": mirror })} style={style}>\r\n      {typeof d === \"string\" ? <path fill=\"currentColor\" d={d}/> : d}\r\n    </svg>);\r\n};\r\nexport const checkIcon = createIcon(<polyline fill=\"none\" stroke=\"currentColor\" points=\"20 6 9 17 4 12\"/>, {\r\n    width: 24,\r\n    height: 24,\r\n});\r\nexport const link = createIcon(\"M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z\", { mirror: true });\r\nexport const save = createIcon(\"M433.941 129.941l-83.882-83.882A48 48 0 0 0 316.118 32H48C21.49 32 0 53.49 0 80v352c0 26.51 21.49 48 48 48h352c26.51 0 48-21.49 48-48V163.882a48 48 0 0 0-14.059-33.941zM224 416c-35.346 0-64-28.654-64-64 0-35.346 28.654-64 64-64s64 28.654 64 64c0 35.346-28.654 64-64 64zm96-304.52V212c0 6.627-5.373 12-12 12H76c-6.627 0-12-5.373-12-12V108c0-6.627 5.373-12 12-12h228.52c3.183 0 6.235 1.264 8.485 3.515l3.48 3.48A11.996 11.996 0 0 1 320 111.48z\", { width: 448, height: 512 });\r\nexport const saveAs = createIcon(\"M252 54L203 8a28 27 0 00-20-8H28C12 0 0 12 0 27v195c0 15 12 26 28 26h204c15 0 28-11 28-26V73a28 27 0 00-8-19zM130 213c-21 0-37-16-37-36 0-19 16-35 37-35 20 0 37 16 37 35 0 20-17 36-37 36zm56-169v56c0 4-4 6-7 6H44c-4 0-7-2-7-6V42c0-4 3-7 7-7h133l4 2 3 2a7 7 0 012 5z M296 201l87 95-188 205-78 9c-10 1-19-8-18-20l9-84zm141-14l-41-44a31 31 0 00-46 0l-38 41 87 95 38-42c13-14 13-36 0-50z\", { width: 448, height: 512 });\r\nexport const load = createIcon(\"M572.694 292.093L500.27 416.248A63.997 63.997 0 0 1 444.989 448H45.025c-18.523 0-30.064-20.093-20.731-36.093l72.424-124.155A64 64 0 0 1 152 256h399.964c18.523 0 30.064 20.093 20.73 36.093zM152 224h328v-48c0-26.51-21.49-48-48-48H272l-64-64H48C21.49 64 0 85.49 0 112v278.046l69.077-118.418C86.214 242.25 117.989 224 152 224z\", { width: 576, height: 512, mirror: true });\r\nexport const clipboard = createIcon(\"M384 112v352c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112c0-26.51 21.49-48 48-48h80c0-35.29 28.71-64 64-64s64 28.71 64 64h80c26.51 0 48 21.49 48 48zM192 40c-13.255 0-24 10.745-24 24s10.745 24 24 24 24-10.745 24-24-10.745-24-24-24m96 114v-20a6 6 0 0 0-6-6H102a6 6 0 0 0-6 6v20a6 6 0 0 0 6 6h180a6 6 0 0 0 6-6z\", { width: 384, height: 512 });\r\nexport const trash = createIcon(\"M32 464a48 48 0 0 0 48 48h288a48 48 0 0 0 48-48V128H32zm272-256a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zm-96 0a16 16 0 0 1 32 0v224a16 16 0 0 1-32 0zM432 32H312l-9.4-18.7A24 24 0 0 0 281.1 0H166.8a23.72 23.72 0 0 0-21.4 13.3L136 32H16A16 16 0 0 0 0 48v32a16 16 0 0 0 16 16h416a16 16 0 0 0 16-16V48a16 16 0 0 0-16-16z\", { width: 448, height: 512 });\r\nexport const palette = createIcon(\"M204.3 5C104.9 24.4 24.8 104.3 5.2 203.4c-37 187 131.7 326.4 258.8 306.7 41.2-6.4 61.4-54.6 42.5-91.7-23.1-45.4 9.9-98.4 60.9-98.4h79.7c35.8 0 64.8-29.6 64.9-65.3C511.5 97.1 368.1-26.9 204.3 5zM96 320c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm32-128c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128-64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32zm128 64c-17.7 0-32-14.3-32-32s14.3-32 32-32 32 14.3 32 32-14.3 32-32 32z\");\r\nexport const exportFile = createIcon(\"M384 121.9c0-6.3-2.5-12.4-7-16.9L279.1 7c-4.5-4.5-10.6-7-17-7H256v128h128zM571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-379 28v-32c0-8.8 7.2-16 16-16h176V160H248c-13.2 0-24-10.8-24-24V0H24C10.7 0 0 10.7 0 24v464c0 13.3 10.7 24 24 24h336c13.3 0 24-10.7 24-24V352H208c-8.8 0-16-7.2-16-16z\", { width: 576, height: 512, mirror: true });\r\nexport const exportImage = createIcon(<>\r\n    <path d=\"M571 308l-95.7-96.4c-10.1-10.1-27.4-3-27.4 11.3V288h-64v64h64v65.2c0 14.3 17.3 21.4 27.4 11.3L571 332c6.6-6.6 6.6-17.4 0-24zm-187 44v-64 64z\"/>\r\n    <path d=\"M384 121.941V128H256V0h6.059c6.362 0 12.471 2.53 16.97 7.029l97.941 97.941a24.01 24.01 0 017.03 16.971zM248 160c-13.2 0-24-10.8-24-24V0H24C10.745 0 0 10.745 0 24v464c0 13.255 10.745 24 24 24h336c13.255 0 24-10.745 24-24V160H248zm-135.455 16c26.51 0 48 21.49 48 48s-21.49 48-48 48-48-21.49-48-48 21.491-48 48-48zm208 240h-256l.485-48.485L104.545 328c4.686-4.686 11.799-4.201 16.485.485L160.545 368 264.06 264.485c4.686-4.686 12.284-4.686 16.971 0L320.545 304v112z\"/>\r\n  </>, { width: 576, height: 512, mirror: true });\r\nexport const exportToFileIcon = createIcon(\"M216 0h80c13.3 0 24 10.7 24 24v168h87.7c17.8 0 26.7 21.5 14.1 34.1L269.7 378.3c-7.5 7.5-19.8 7.5-27.3 0L90.1 226.1c-12.6-12.6-3.7-34.1 14.1-34.1H192V24c0-13.3 10.7-24 24-24zm296 376v112c0 13.3-10.7 24-24 24H24c-13.3 0-24-10.7-24-24V376c0-13.3 10.7-24 24-24h146.7l49 49c20.1 20.1 52.5 20.1 72.6 0l49-49H488c13.3 0 24 10.7 24 24zm-124 88c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20zm64 0c0-11-9-20-20-20s-20 9-20 20 9 20 20 20 20-9 20-20z\", { width: 512, height: 512 });\r\nexport const zoomIn = createIcon(\"M416 208H272V64c0-17.67-14.33-32-32-32h-32c-17.67 0-32 14.33-32 32v144H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h144v144c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32V304h144c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\", { width: 448, height: 512 });\r\nexport const zoomOut = createIcon(\"M416 208H32c-17.67 0-32 14.33-32 32v32c0 17.67 14.33 32 32 32h384c17.67 0 32-14.33 32-32v-32c0-17.67-14.33-32-32-32z\", { width: 448, height: 512 });\r\nexport const done = createIcon(\"M173.898 439.404l-166.4-166.4c-9.997-9.997-9.997-26.206 0-36.204l36.203-36.204c9.997-9.998 26.207-9.998 36.204 0L192 312.69 432.095 72.596c9.997-9.997 26.207-9.997 36.204 0l36.203 36.204c9.997 9.997 9.997 26.206 0 36.204l-294.4 294.401c-9.998 9.997-26.207 9.997-36.204-.001z\");\r\nexport const menu = createIcon(\"M16 132h416c8.837 0 16-7.163 16-16V76c0-8.837-7.163-16-16-16H16C7.163 60 0 67.163 0 76v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16zm0 160h416c8.837 0 16-7.163 16-16v-40c0-8.837-7.163-16-16-16H16c-8.837 0-16 7.163-16 16v40c0 8.837 7.163 16 16 16z\");\r\nexport const undo = createIcon(\"M255.545 8c-66.269.119-126.438 26.233-170.86 68.685L48.971 40.971C33.851 25.851 8 36.559 8 57.941V192c0 13.255 10.745 24 24 24h134.059c21.382 0 32.09-25.851 16.971-40.971l-41.75-41.75c30.864-28.899 70.801-44.907 113.23-45.273 92.398-.798 170.283 73.977 169.484 169.442C423.236 348.009 349.816 424 256 424c-41.127 0-79.997-14.678-110.63-41.556-4.743-4.161-11.906-3.908-16.368.553L89.34 422.659c-4.872 4.872-4.631 12.815.482 17.433C133.798 479.813 192.074 504 256 504c136.966 0 247.999-111.033 248-247.998C504.001 119.193 392.354 7.755 255.545 8z\", { mirror: true });\r\nexport const redo = createIcon(\"M256.455 8c66.269.119 126.437 26.233 170.859 68.685l35.715-35.715C478.149 25.851 504 36.559 504 57.941V192c0 13.255-10.745 24-24 24H345.941c-21.382 0-32.09-25.851-16.971-40.971l41.75-41.75c-30.864-28.899-70.801-44.907-113.23-45.273-92.398-.798-170.283 73.977-169.484 169.442C88.764 348.009 162.184 424 256 424c41.127 0 79.997-14.678 110.629-41.556 4.743-4.161 11.906-3.908 16.368.553l39.662 39.662c4.872 4.872 4.631 12.815-.482 17.433C378.202 479.813 319.926 504 256 504 119.034 504 8.001 392.967 8 256.002 7.999 119.193 119.646 7.755 256.455 8z\", { mirror: true });\r\nexport const questionCircle = createIcon(\"M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zM262.655 90c-54.497 0-89.255 22.957-116.549 63.758-3.536 5.286-2.353 12.415 2.715 16.258l34.699 26.31c5.205 3.947 12.621 3.008 16.665-2.122 17.864-22.658 30.113-35.797 57.303-35.797 20.429 0 45.698 13.148 45.698 32.958 0 14.976-12.363 22.667-32.534 33.976C247.128 238.528 216 254.941 216 296v4c0 6.627 5.373 12 12 12h56c6.627 0 12-5.373 12-12v-1.333c0-28.462 83.186-29.647 83.186-106.667 0-58.002-60.165-102-116.531-102zM256 338c-25.365 0-46 20.635-46 46 0 25.364 20.635 46 46 46s46-20.636 46-46c0-25.365-20.635-46-46-46z\", { mirror: true });\r\nexport const share = createIcon(\"M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92 1.61 0 2.92-1.31 2.92-2.92s-1.31-2.92-2.92-2.92z\", { width: 24, height: 24 });\r\nexport const shareIOS = createIcon(\"M16 5l-1.42 1.42-1.59-1.59V16h-1.98V4.83L9.42 6.42 8 5l4-4 4 4zm4 5v11c0 1.1-.9 2-2 2H6c-1.11 0-2-.9-2-2V10c0-1.11.89-2 2-2h3v2H6v11h12V10h-3V8h3c1.1 0 2 .89 2 2z\", { width: 24, height: 24 });\r\nexport const shareWindows = createIcon(<>\r\n    <path stroke=\"currentColor\" fill=\"currentColor\" d=\"M40 5.6v6.1l-4.1.7c-8.9 1.4-16.5 6.9-20.6 15C13 32 10.9 43 12.4 43c.4 0 2.4-1.3 4.4-3 5-3.9 12.1-7 18.2-7.7l5-.6v12.8l11.2-11.3L62.5 22 51.2 10.8 40-.5v6.1zm10.2 22.6L44 34.5v-6.8l-6.9.6c-3.9.3-9.8 1.7-13.2 3.1-3.5 1.4-6.5 2.4-6.7 2.2-.9-1 3-7.5 6.4-10.8C28 18.6 34.4 16 40.1 16c3.7 0 3.9-.1 3.9-3.2V9.5l6.2 6.3 6.3 6.2-6.3 6.2z\"/>\r\n    <path stroke=\"currentColor\" fill=\"currentColor\" d=\"M0 36v20h48v-6.2c0-6 0-6.1-2-4.3-1.1 1-2 2.9-2 4.2V52H4V34c0-17.3-.1-18-2-18s-2 .7-2 20z\"/>\r\n  </>, { width: 64, height: 64 });\r\n// Icon imported form Storybook\r\n// Storybook is licensed under MIT https://github.com/storybookjs/storybook/blob/next/LICENSE\r\nexport const resetZoom = createIcon(<path stroke=\"currentColor\" strokeWidth=\"40\" fill=\"currentColor\" d=\"M148 560a318 318 0 0 0 522 110 316 316 0 0 0 0-450 316 316 0 0 0-450 0c-11 11-21 22-30 34v4h47c25 0 46 21 46 46s-21 45-46 45H90c-13 0-25-6-33-14-9-9-14-20-14-33V156c0-25 20-45 45-45s45 20 45 45v32l1 1a401 401 0 0 1 623 509l212 212a42 42 0 0 1-59 59L698 757A401 401 0 0 1 65 570a42 42 0 0 1 83-10z\"/>, { width: 1024 });\r\nexport const BringForwardIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M22 9.556C22 8.696 21.303 8 20.444 8H16v8H8v4.444C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const SendBackwardIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M16 3.556C16 2.696 15.303 2 14.444 2H3.556C2.696 2 2 2.697 2 3.556v10.888C2 15.304 2.697 16 3.556 16h10.888c.86 0 1.556-.697 1.556-1.556V3.556z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M22 9.556C22 8.696 21.303 8 20.444 8H9.556C8.696 8 8 8.697 8 9.556v10.888C8 21.304 8.697 22 9.556 22h10.888c.86 0 1.556-.697 1.556-1.556V9.556z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const BringToFrontIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M13 21a1 1 0 001 1h7a1 1 0 001-1v-7a1 1 0 00-1-1h-3v5h-5v3zM11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h3V6h5V3z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const SendToBackIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M18 7.333C18 6.597 17.403 6 16.667 6H7.333C6.597 6 6 6.597 6 7.333v9.334C6 17.403 6.597 18 7.333 18h9.334c.736 0 1.333-.597 1.333-1.333V7.333z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M11 3a1 1 0 00-1-1H3a1 1 0 00-1 1v7a1 1 0 001 1h8V3zM22 14a1 1 0 00-1-1h-7a1 1 0 00-1 1v7a1 1 0 001 1h8v-8z\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\n//\r\n// Align action icons created from scratch to match those of z-index actions\r\n// Note: vertical align icons are flipped so the larger item is always the\r\n// first one the user sees. Horizontal align icons should not be flipped since\r\n// that would make them lie about their function.\r\n//\r\nexport const AlignTopIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 2,5 H 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"M 6,7 C 5.446,7 5,7.446 5,8 v 9.999992 c 0,0.554 0.446,1 1,1 h 3.0000001 c 0.554,0 0.9999999,-0.446 0.9999999,-1 V 8 C 10,7.446 9.5540001,7 9.0000001,7 Z m 9,0 c -0.554,0 -1,0.446 -1,1 v 5.999992 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 V 8 C 19,7.446 18.554,7 18,7 Z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const AlignBottomIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 2,19 H 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"m 6,16.999992 c -0.554,0 -1,-0.446 -1,-1 V 6 C 5,5.446 5.446,5 6,5 H 9.0000001 C 9.5540001,5 10,5.446 10,6 v 9.999992 c 0,0.554 -0.4459999,1 -0.9999999,1 z m 9,0 c -0.554,0 -1,-0.446 -1,-1 V 10 c 0,-0.554 0.446,-1 1,-1 h 3 c 0.554,0 1,0.446 1,1 v 5.999992 c 0,0.554 -0.446,1 -1,1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const AlignLeftIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 5,2 V 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"m 7.000004,5.999996 c 0,-0.554 0.446,-1 1,-1 h 9.999992 c 0.554,0 1,0.446 1,1 v 3.0000001 c 0,0.554 -0.446,0.9999999 -1,0.9999999 H 8.000004 c -0.554,0 -1,-0.4459999 -1,-0.9999999 z m 0,9 c 0,-0.554 0.446,-1 1,-1 h 5.999992 c 0.554,0 1,0.446 1,1 v 3 c 0,0.554 -0.446,1 -1,1 H 8.000004 c -0.554,0 -1,-0.446 -1,-1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24 }));\r\nexport const AlignRightIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M 19,2 V 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n      <path d=\"m 16.999996,5.999996 c 0,-0.554 -0.446,-1 -1,-1 H 6.000004 c -0.554,0 -1,0.446 -1,1 v 3.0000001 c 0,0.554 0.446,0.9999999 1,0.9999999 h 9.999992 c 0.554,0 1,-0.4459999 1,-0.9999999 z m 0,9 c 0,-0.554 -0.446,-1 -1,-1 h -5.999992 c -0.554,0 -1,0.446 -1,1 v 3 c 0,0.554 0.446,1 1,1 h 5.999992 c 0.554,0 1,-0.446 1,-1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n    </>, { width: 24 }));\r\nexport const DistributeHorizontallyIcon = React.memo(({ theme }) => createIcon(<>\r\n        <path d=\"M19 5V19M5 5V19\" stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n        <path d=\"M15 9C15.554 9 16 9.446 16 10V14C16 14.554 15.554 15 15 15H9C8.446 15 8 14.554 8 14V10C8 9.446 8.446 9 9 9H15Z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      </>, { width: 24 }));\r\nexport const DistributeVerticallyIcon = React.memo(({ theme }) => createIcon(<>\r\n        <path d=\"M5 5L19 5M5 19H19\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeLinecap=\"round\"/>\r\n        <path d=\"M15 9C15.554 9 16 9.446 16 10V14C16 14.554 15.554 15 15 15H9C8.446 15 8 14.554 8 14V10C8 9.446 8.446 9 9 9H15Z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      </>, { width: 24 }));\r\nexport const CenterVerticallyIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"m 5.000004,16.999996 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 v -10 c 0,-0.554 -0.446,-1 -1,-1 h -3 c -0.554,0 -1,0.446 -1,1 z m 9,-2 c 0,0.554 0.446,1 1,1 h 3 c 0.554,0 1,-0.446 1,-1 v -6 c 0,-0.554 -0.446,-1 -1,-1 h -3 c -0.554,0 -1,0.446 -1,1 z\" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M 2,12 H 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeDasharray=\"1, 2.8\" strokeLinecap=\"round\"/>\r\n    </>, { width: 24, mirror: true }));\r\nexport const CenterHorizontallyIcon = React.memo(({ theme }) => createIcon(<>\r\n        <path d=\"M 7 5 C 6.446 5 6 5.446 6 6 L 6 9 C 6 9.554 6.446 10 7 10 L 17 10 C 17.554 10 18 9.554 18 9 L 18 6 C 18 5.446 17.554 5 17 5 L 7 5 z M 9 14 C 8.446 14 8 14.446 8 15 L 8 18 C 8 18.554 8.446 19 9 19 L 15 19 C 15.554 19 16 18.554 16 18 L 16 15 C 16 14.446 15.554 14 15 14 L 9 14 z \" fill={activeElementColor(theme)} stroke={activeElementColor(theme)} strokeWidth=\"2\"/>\r\n        <path d=\"M 12,2 V 22\" fill={iconFillColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"2\" strokeDasharray=\"1, 2.8\" strokeLinecap=\"round\"/>\r\n      </>, { width: 24 }));\r\nexport const users = createIcon(\"M192 256c61.9 0 112-50.1 112-112S253.9 32 192 32 80 82.1 80 144s50.1 112 112 112zm76.8 32h-8.3c-20.8 10-43.9 16-68.5 16s-47.6-6-68.5-16h-8.3C51.6 288 0 339.6 0 403.2V432c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48v-28.8c0-63.6-51.6-115.2-115.2-115.2zM480 256c53 0 96-43 96-96s-43-96-96-96-96 43-96 96 43 96 96 96zm48 32h-3.8c-13.9 4.8-28.6 8-44.2 8s-30.3-3.2-44.2-8H432c-20.4 0-39.2 5.9-55.7 15.4 24.4 26.3 39.7 61.2 39.7 99.8v38.4c0 2.2-.5 4.3-.6 6.4H592c26.5 0 48-21.5 48-48 0-61.9-50.1-112-112-112z\", { width: 640, height: 512, mirror: true });\r\n// not mirrored because it's inspired by a playback control, which is always RTL\r\nexport const start = createIcon(\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z\");\r\nexport const stop = createIcon(\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm96 328c0 8.8-7.2 16-16 16H176c-8.8 0-16-7.2-16-16V176c0-8.8 7.2-16 16-16h160c8.8 0 16 7.2 16 16v160z\");\r\nexport const close = createIcon(\"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z\", { width: 352, height: 512 });\r\nexport const back = createIcon(\"M34.52 239.03L228.87 44.69c9.37-9.37 24.57-9.37 33.94 0l22.67 22.67c9.36 9.36 9.37 24.52.04 33.9L131.49 256l154.02 154.75c9.34 9.38 9.32 24.54-.04 33.9l-22.67 22.67c-9.37 9.37-24.57 9.37-33.94 0L34.52 272.97c-9.37-9.37-9.37-24.57 0-33.94z\", { width: 320, height: 512, style: { marginLeft: \"-0.2rem\" }, mirror: true });\r\nexport const clone = createIcon(\"M464 0c26.51 0 48 21.49 48 48v288c0 26.51-21.49 48-48 48H176c-26.51 0-48-21.49-48-48V48c0-26.51 21.49-48 48-48h288M176 416c-44.112 0-80-35.888-80-80V128H48c-26.51 0-48 21.49-48 48v288c0 26.51 21.49 48 48 48h288c26.51 0 48-21.49 48-48v-48H176z\", { mirror: true });\r\n// modified https://feathericons.com/?query=shield\r\nexport const shield = createIcon(\"M11.553 22.894a.998.998 0 00.894 0s3.037-1.516 5.465-4.097C19.616 16.987 21 14.663 21 12V5a1 1 0 00-.649-.936l-8-3a.998.998 0 00-.702 0l-8 3A1 1 0 003 5v7c0 2.663 1.384 4.987 3.088 6.797 2.428 2.581 5.465 4.097 5.465 4.097zm-1.303-8.481l6.644-6.644a.856.856 0 111.212 1.212l-7.25 7.25a.856.856 0 01-1.212 0l-3.75-3.75a.856.856 0 111.212-1.212l3.144 3.144z\", { width: 24 });\r\nexport const file = createIcon(\"M369.9 97.9L286 14C277 5 264.8-.1 252.1-.1H48C21.5 0 0 21.5 0 48v416c0 26.5 21.5 48 48 48h288c26.5 0 48-21.5 48-48V131.9c0-12.7-5.1-25-14.1-34zM332.1 128H256V51.9l76.1 76.1zM48 464V48h160v104c0 13.3 10.7 24 24 24h104v288H48zm32-48h224V288l-23.5-23.5c-4.7-4.7-12.3-4.7-17 0L176 352l-39.5-39.5c-4.7-4.7-12.3-4.7-17 0L80 352v64zm48-240c-26.5 0-48 21.5-48 48s21.5 48 48 48 48-21.5 48-48-21.5-48-48-48z\", { width: 384, height: 512 });\r\nexport const GroupIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M25 26H111V111H25\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M25 111C25 80.2068 25 49.4135 25 26M25 26C48.6174 26 72.2348 26 111 26H25ZM25 26C53.3671 26 81.7343 26 111 26H25ZM111 26C111 52.303 111 78.606 111 111V26ZM111 26C111 51.2947 111 76.5893 111 111V26ZM111 111C87.0792 111 63.1585 111 25 111H111ZM111 111C87.4646 111 63.9293 111 25 111H111ZM25 111C25 81.1514 25 51.3028 25 26V111Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M100 100H160V160H100\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M100 160C100 144.106 100 128.211 100 100M100 100C117.706 100 135.412 100 160 100H100ZM100 100C114.214 100 128.428 100 160 100H100ZM160 100C160 120.184 160 140.369 160 160V100ZM160 100C160 113.219 160 126.437 160 160V100ZM160 160C145.534 160 131.068 160 100 160H160ZM160 160C143.467 160 126.934 160 100 160H160ZM100 160C100 143.661 100 127.321 100 100V160Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <g fill={handlerColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"6\">\r\n        <rect x=\"2.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"2.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n      </g>\r\n    </>, { width: 182, height: 182, mirror: true }));\r\nexport const UngroupIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path d=\"M25 26H111V111H25\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M25 111C25 80.2068 25 49.4135 25 26M25 26C48.6174 26 72.2348 26 111 26H25ZM25 26C53.3671 26 81.7343 26 111 26H25ZM111 26C111 52.303 111 78.606 111 111V26ZM111 26C111 51.2947 111 76.5893 111 111V26ZM111 111C87.0792 111 63.1585 111 25 111H111ZM111 111C87.4646 111 63.9293 111 25 111H111ZM25 111C25 81.1514 25 51.3028 25 26V111Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <path d=\"M100 100H160V160H100\" fill={iconFillColor(theme)}/>\r\n      <path d=\"M100 160C100 144.106 100 128.211 100 100M100 100C117.706 100 135.412 100 160 100H100ZM100 100C114.214 100 128.428 100 160 100H100ZM160 100C160 120.184 160 140.369 160 160V100ZM160 100C160 113.219 160 126.437 160 160V100ZM160 160C145.534 160 131.068 160 100 160H160ZM160 160C143.467 160 126.934 160 100 160H160ZM100 160C100 143.661 100 127.321 100 100V160Z\" stroke={iconFillColor(theme)} strokeWidth=\"2\"/>\r\n      <g fill={handlerColor(theme)} stroke={iconFillColor(theme)} strokeWidth=\"6\">\r\n        <rect x=\"2.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"78.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"149.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"147.5\" y=\"78.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"105.5\" y=\"2.5\" width=\"30\" height=\"30\"/>\r\n        <rect x=\"2.5\" y=\"102.5\" width=\"30\" height=\"30\"/>\r\n      </g>\r\n    </>, { width: 182, height: 182, mirror: true }));\r\nexport const FillHachureIcon = React.memo(({ theme }) => createIcon(<path fillRule=\"evenodd\" clipRule=\"evenodd\" d=\"M20.101 16H28.0934L36 8.95989V4H33.5779L20.101 16ZM30.5704 4L17.0935 16H9.10101L22.5779 4H30.5704ZM19.5704 4L6.09349 16H4V10.7475L11.5779 4H19.5704ZM8.57036 4H4V8.06952L8.57036 4ZM36 11.6378L31.101 16H36V11.6378ZM2 2V18H38V2H2Z\" fill={iconFillColor(theme)}/>, { width: 40, height: 20 }));\r\nexport const FillCrossHatchIcon = React.memo(({ theme }) => createIcon(<g fill={iconFillColor(theme)} fillRule=\"evenodd\" clipRule=\"evenodd\">\r\n      <path d=\"M20.101 16H28.0934L36 8.95989V4H33.5779L20.101 16ZM30.5704 4L17.0935 16H9.10101L22.5779 4H30.5704ZM19.5704 4L6.09349 16H4V10.7475L11.5779 4H19.5704ZM8.57036 4H4V8.06952L8.57036 4ZM36 11.6378L31.101 16H36V11.6378ZM2 2V18H38V2H2Z\"/>\r\n      <path d=\"M14.0001 18L3.00006 4.00002L4.5727 2.76438L15.5727 16.7644L14.0001 18ZM25.0001 18L14.0001 4.00002L15.5727 2.76438L26.5727 16.7644L25.0001 18ZM36.0001 18L25.0001 4.00002L26.5727 2.76438L37.5727 16.7644L36.0001 18Z\"/>\r\n    </g>, { width: 40, height: 20 }));\r\nexport const FillSolidIcon = React.memo(({ theme }) => createIcon(<path d=\"M2 2H38V18H2V2Z\" fill={iconFillColor(theme)}/>, {\r\n    width: 40,\r\n    height: 20,\r\n}));\r\nexport const StrokeWidthIcon = React.memo(({ theme, strokeWidth }) => createIcon(<path d=\"M6 10H32\" stroke={iconFillColor(theme)} strokeWidth={strokeWidth} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20 }));\r\nexport const StrokeStyleSolidIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H34\" stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\" strokeLinecap=\"round\"/>, {\r\n    width: 40,\r\n    height: 20,\r\n}));\r\nexport const StrokeStyleDashedIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H34\" stroke={iconFillColor(theme)} strokeWidth={2.5} strokeDasharray={\"10, 8\"} fill=\"none\" strokeLinecap=\"round\"/>, { width: 40, height: 20 }));\r\nexport const StrokeStyleDottedIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H36\" stroke={iconFillColor(theme)} strokeWidth={2.5} strokeDasharray={\"2, 4.5\"} fill=\"none\" strokeLinecap=\"round\"/>, { width: 40, height: 20 }));\r\nexport const SloppinessArchitectIcon = React.memo(({ theme }) => createIcon(<path d=\"M3.00098 16.1691C6.28774 13.9744 19.6399 2.8905 22.7215 3.00082C25.8041 3.11113 19.1158 15.5488 21.4962 16.8309C23.8757 18.1131 34.4155 11.7148 37.0001 10.6919\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const SloppinessArtistIcon = React.memo(({ theme }) => createIcon(<path d=\"M3 17C6.68158 14.8752 16.1296 9.09849 22.0648 6.54922C28 3.99995 22.2896 13.3209 25 14C27.7104 14.6791 36.3757 9.6471 36.3757 9.6471M6.40706 15C13 11.1918 20.0468 1.51045 23.0234 3.0052C26 4.49995 20.457 12.8659 22.7285 16.4329C25 20 36.3757 13 36.3757 13\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const SloppinessCartoonistIcon = React.memo(({ theme }) => createIcon(<path d=\"M3 15.6468C6.93692 13.5378 22.5544 2.81528 26.6206 3.00242C30.6877 3.18956 25.6708 15.3346 27.4009 16.7705C29.1309 18.2055 35.4001 12.4762 37 11.6177M3.97143 10.4917C6.61158 9.24563 16.3706 2.61886 19.8104 3.01724C23.2522 3.41472 22.0773 12.2013 24.6181 12.8783C27.1598 13.5536 33.3179 8.04068 35.0571 7.07244\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const EdgeSharpIcon = React.memo(({ theme }) => createIcon(<path d=\"M10 17L10 5L35 5\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const EdgeRoundIcon = React.memo(({ theme }) => createIcon(<path d=\"M10 17V15C10 8 13 5 21 5L33.5 5\" stroke={iconFillColor(theme)} strokeWidth={2} strokeLinecap=\"round\" fill=\"none\"/>, { width: 40, height: 20, mirror: true }));\r\nexport const ArrowheadNoneIcon = React.memo(({ theme }) => createIcon(<path d=\"M6 10H34\" stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\"/>, {\r\n    width: 40,\r\n    height: 20,\r\n}));\r\nexport const ArrowheadArrowIcon = React.memo(({ theme, flip = false }) => createIcon(<g transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"} stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\">\r\n        <path d=\"M34 10H6M34 10L27 5M34 10L27 15\"/>\r\n        <path d=\"M27.5 5L34.5 10L27.5 15\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const ArrowheadDotIcon = React.memo(({ theme, flip = false }) => createIcon(<g stroke={iconFillColor(theme)} fill={iconFillColor(theme)} transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"}>\r\n        <path d=\"M32 10L6 10\" strokeWidth={2}/>\r\n        <circle r=\"4\" transform=\"matrix(-1 0 0 1 30 10)\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const ArrowheadBarIcon = React.memo(({ theme, flip = false }) => createIcon(<g transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"}>\r\n        <path d=\"M34 10H5.99996M34 10L34 5M34 10L34 15\" stroke={iconFillColor(theme)} strokeWidth={2} fill=\"none\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const ArrowheadTriangleIcon = React.memo(({ theme, flip = false }) => createIcon(<g stroke={iconFillColor(theme)} fill={iconFillColor(theme)} transform={flip ? \"translate(40, 0) scale(-1, 1)\" : \"\"}>\r\n        <path d=\"M32 10L6 10\" strokeWidth={2}/>\r\n        <path d=\"M27.5 5.5L34.5 10L27.5 14.5L27.5 5.5\"/>\r\n      </g>, { width: 40, height: 20 }));\r\nexport const FontSizeSmallIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 0 69.092 L 0 55.03 A 124.24 124.24 0 0 0 4.706 57.02 Q 6.826 57.863 8.708 58.5 A 53.466 53.466 0 0 0 12.231 59.571 Q 17.236 60.889 21.387 60.889 A 20.909 20.909 0 0 0 24.265 60.704 Q 25.719 60.502 26.903 60.077 A 8.649 8.649 0 0 0 29.028 58.985 Q 31.689 57.08 31.689 53.321 Q 31.689 51.221 30.518 49.585 A 10.126 10.126 0 0 0 29.282 48.177 Q 28.352 47.287 27.075 46.436 A 23.719 23.719 0 0 0 25.752 45.627 Q 23.774 44.492 20.176 42.735 A 254.44 254.44 0 0 0 17.822 41.602 Q 11.503 38.631 8.236 35.888 A 19.742 19.742 0 0 1 8.008 35.694 A 22.18 22.18 0 0 1 2.783 29.102 Q 0.83 25.342 0.83 20.313 A 22.471 22.471 0 0 1 1.733 13.778 A 17.283 17.283 0 0 1 7.251 5.42 A 21.486 21.486 0 0 1 15.177 1.272 Q 18.361 0.338 22.166 0.09 A 43.573 43.573 0 0 1 25 0 A 42.399 42.399 0 0 1 34.349 1.01 A 39.075 39.075 0 0 1 35.62 1.319 A 67.407 67.407 0 0 1 42.108 3.382 A 83.357 83.357 0 0 1 46.191 5.03 L 41.309 16.797 Q 35.596 14.453 31.86 13.526 A 30.762 30.762 0 0 0 25.417 12.612 A 28.337 28.337 0 0 0 24.512 12.598 A 14.846 14.846 0 0 0 22.022 12.793 Q 19.498 13.224 17.92 14.6 Q 15.625 16.602 15.625 19.824 Q 15.625 21.826 16.553 23.316 Q 17.48 24.805 19.507 26.197 A 18.343 18.343 0 0 0 20.659 26.912 Q 22.596 28.035 26.516 29.953 A 299.99 299.99 0 0 0 29.102 31.201 Q 37.91 35.412 41.841 39.642 A 16.553 16.553 0 0 1 42.822 40.796 A 17.675 17.675 0 0 1 46.301 49.233 A 23.517 23.517 0 0 1 46.533 52.588 A 21.581 21.581 0 0 1 45.471 59.515 A 17.733 17.733 0 0 1 39.575 67.823 Q 33.745 72.486 24.094 73.243 A 49.683 49.683 0 0 1 20.215 73.389 A 51.712 51.712 0 0 1 9.448 72.315 A 40.672 40.672 0 0 1 0 69.092 Z\"/>, { width: 47, height: 77 }));\r\nexport const FontSizeMediumIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 44.092 71.387 L 30.225 71.387 L 13.037 15.381 L 12.598 15.381 A 1505.093 1505.093 0 0 1 12.959 22.313 Q 13.426 31.715 13.508 36.4 A 102.991 102.991 0 0 1 13.525 38.184 L 13.525 71.387 L 0 71.387 L 0 0 L 20.605 0 L 37.5 54.59 L 37.793 54.59 L 55.713 0 L 76.318 0 L 76.318 71.387 L 62.207 71.387 L 62.207 37.598 Q 62.207 35.205 62.28 32.08 A 160.703 160.703 0 0 1 62.326 30.544 Q 62.452 26.754 62.866 17.168 A 5390.536 5390.536 0 0 1 62.939 15.479 L 62.5 15.479 L 44.092 71.387 Z\"/>, { width: 77, height: 75 }));\r\nexport const FontSizeLargeIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 44.092 71.387 L 0 71.387 L 0 0 L 15.137 0 L 15.137 58.887 L 44.092 58.887 L 44.092 71.387 Z\"/>, { width: 45, height: 75 }));\r\nexport const FontSizeExtraLargeIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M 42.578 35.4 L 66.699 71.387 L 49.414 71.387 L 32.813 44.385 L 16.211 71.387 L 0 71.387 L 23.682 34.57 L 1.514 0 L 18.213 0 L 33.594 25.684 L 48.682 0 L 64.99 0 L 42.578 35.4 Z M 119.775 71.387 L 75.684 71.387 L 75.684 0 L 90.82 0 L 90.82 58.887 L 119.775 58.887 L 119.775 71.387 Z\"/>, { width: 120, height: 75 }));\r\nexport const FontFamilyHandDrawnIcon = React.memo(({ theme }) => createIcon(<path fill={iconFillColor(theme)} d=\"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z\"/>, { width: 448, height: 512 }));\r\nexport const FontFamilyNormalIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path fill={iconFillColor(theme)} d=\"M 63.818 71.68 L 54.492 71.68 L 45.898 49.561 L 17.578 49.561 L 9.082 71.68 L 0 71.68 L 27.881 0 L 35.986 0 L 63.818 71.68 Z M 20.605 41.602 L 43.213 41.602 L 35.205 19.971 L 31.787 9.277 Q 30.322 15.137 28.711 19.971 L 20.605 41.602 Z\"/>\r\n      <path fill={iconFillColor(theme)} d=\"M 68.994 71.68 L 52.686 71.68 L 47.51 54.688 L 21.484 54.688 L 16.309 71.68 L 0 71.68 L 25.195 0 L 43.701 0 L 68.994 71.68 Z M 25.293 41.992 L 43.896 41.992 A 27590.463 27590.463 0 0 1 42.2 36.532 Q 36.965 19.676 35.937 16.273 A 120.932 120.932 0 0 1 35.815 15.869 A 131.65 131.65 0 0 1 35.396 14.435 Q 34.951 12.879 34.675 11.741 A 34.866 34.866 0 0 1 34.521 11.084 A 141.762 141.762 0 0 1 33.706 14.075 Q 31.482 21.957 25.293 41.992 Z\"/>\r\n    </>, { width: 70, height: 78 }));\r\nexport const FontFamilyCodeIcon = React.memo(({ theme }) => createIcon(<>\r\n      <path fill={iconFillColor(theme)} d=\"M278.9 511.5l-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2l43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6l144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z\"/>\r\n    </>, { width: 640, height: 512 }));\r\nexport const TextAlignLeftIcon = React.memo(({ theme }) => createIcon(<path d=\"M12.83 352h262.34A12.82 12.82 0 00288 339.17v-38.34A12.82 12.82 0 00275.17 288H12.83A12.82 12.82 0 000 300.83v38.34A12.82 12.82 0 0012.83 352zm0-256h262.34A12.82 12.82 0 00288 83.17V44.83A12.82 12.82 0 00275.17 32H12.83A12.82 12.82 0 000 44.83v38.34A12.82 12.82 0 0012.83 96zM432 160H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm0 256H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16z\" fill={iconFillColor(theme)} strokeLinecap=\"round\"/>, { width: 448, height: 512 }));\r\nexport const TextAlignCenterIcon = React.memo(({ theme }) => createIcon(<path d=\"M432 160H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm0 256H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zM108.1 96h231.81A12.09 12.09 0 00352 83.9V44.09A12.09 12.09 0 00339.91 32H108.1A12.09 12.09 0 0096 44.09V83.9A12.1 12.1 0 00108.1 96zm231.81 256A12.09 12.09 0 00352 339.9v-39.81A12.09 12.09 0 00339.91 288H108.1A12.09 12.09 0 0096 300.09v39.81a12.1 12.1 0 0012.1 12.1z\" fill={iconFillColor(theme)}/>, { width: 448, height: 512 }));\r\nexport const TextAlignRightIcon = React.memo(({ theme }) => createIcon(<path d=\"M16 224h416a16 16 0 0016-16v-32a16 16 0 00-16-16H16a16 16 0 00-16 16v32a16 16 0 0016 16zm416 192H16a16 16 0 00-16 16v32a16 16 0 0016 16h416a16 16 0 0016-16v-32a16 16 0 00-16-16zm3.17-384H172.83A12.82 12.82 0 00160 44.83v38.34A12.82 12.82 0 00172.83 96h262.34A12.82 12.82 0 00448 83.17V44.83A12.82 12.82 0 00435.17 32zm0 256H172.83A12.82 12.82 0 00160 300.83v38.34A12.82 12.82 0 00172.83 352h262.34A12.82 12.82 0 00448 339.17v-38.34A12.82 12.82 0 00435.17 288z\" fill={iconFillColor(theme)} strokeLinecap=\"round\"/>, { width: 448, height: 512 }));\r\n","export let actions = [];\r\nexport const register = (action) => {\r\n    actions = actions.concat(action);\r\n    return action;\r\n};\r\n","import { isSomeElementSelected } from \"../scene\";\r\nimport { KEYS } from \"../keys\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { trash } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport { register } from \"./register\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { getElementsInGroup } from \"../groups\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\r\nconst deleteSelectedElements = (elements, appState) => {\r\n    return {\r\n        elements: elements.map((el) => {\r\n            if (appState.selectedElementIds[el.id]) {\r\n                return newElementWith(el, { isDeleted: true });\r\n            }\r\n            return el;\r\n        }),\r\n        appState: {\r\n            ...appState,\r\n            selectedElementIds: {},\r\n        },\r\n    };\r\n};\r\nconst handleGroupEditingState = (appState, elements) => {\r\n    if (appState.editingGroupId) {\r\n        const siblingElements = getElementsInGroup(getNonDeletedElements(elements), appState.editingGroupId);\r\n        if (siblingElements.length) {\r\n            return {\r\n                ...appState,\r\n                selectedElementIds: { [siblingElements[0].id]: true },\r\n            };\r\n        }\r\n    }\r\n    return appState;\r\n};\r\nexport const actionDeleteSelected = register({\r\n    name: \"deleteSelectedElements\",\r\n    perform: (elements, appState) => {\r\n        if (appState.editingLinearElement) {\r\n            const { elementId, activePointIndex, startBindingElement, endBindingElement, } = appState.editingLinearElement;\r\n            const element = LinearElementEditor.getElement(elementId);\r\n            if (!element) {\r\n                return false;\r\n            }\r\n            if (\r\n            // case: no point selected → delete whole element\r\n            activePointIndex == null ||\r\n                activePointIndex === -1 ||\r\n                // case: deleting last remaining point\r\n                element.points.length < 2) {\r\n                const nextElements = elements.filter((el) => el.id !== element.id);\r\n                const nextAppState = handleGroupEditingState(appState, nextElements);\r\n                return {\r\n                    elements: nextElements,\r\n                    appState: {\r\n                        ...nextAppState,\r\n                        editingLinearElement: null,\r\n                    },\r\n                    commitToHistory: false,\r\n                };\r\n            }\r\n            // We cannot do this inside `movePoint` because it is also called\r\n            // when deleting the uncommitted point (which hasn't caused any binding)\r\n            const binding = {\r\n                startBindingElement: activePointIndex === 0 ? null : startBindingElement,\r\n                endBindingElement: activePointIndex === element.points.length - 1\r\n                    ? null\r\n                    : endBindingElement,\r\n            };\r\n            LinearElementEditor.movePoint(element, activePointIndex, \"delete\");\r\n            return {\r\n                elements,\r\n                appState: {\r\n                    ...appState,\r\n                    editingLinearElement: {\r\n                        ...appState.editingLinearElement,\r\n                        ...binding,\r\n                        activePointIndex: activePointIndex > 0 ? activePointIndex - 1 : 0,\r\n                    },\r\n                },\r\n                commitToHistory: true,\r\n            };\r\n        }\r\n        let { elements: nextElements, appState: nextAppState } = deleteSelectedElements(elements, appState);\r\n        fixBindingsAfterDeletion(nextElements, elements.filter(({ id }) => appState.selectedElementIds[id]));\r\n        nextAppState = handleGroupEditingState(nextAppState, nextElements);\r\n        return {\r\n            elements: nextElements,\r\n            appState: {\r\n                ...nextAppState,\r\n                elementType: \"selection\",\r\n                multiElement: null,\r\n            },\r\n            commitToHistory: isSomeElementSelected(getNonDeletedElements(elements), appState),\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.delete\",\r\n    keyTest: (event) => event.key === KEYS.BACKSPACE || event.key === KEYS.DELETE,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton type=\"button\" icon={trash} title={t(\"labels.delete\")} aria-label={t(\"labels.delete\")} onClick={() => updateData(null)} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\n","import { bumpVersion } from \"./element/mutateElement\";\r\nimport { getElementsInGroup } from \"./groups\";\r\nimport { findIndex, findLastIndex } from \"./utils\";\r\n/**\r\n * Returns indices of elements to move based on selected elements.\r\n * Includes contiguous deleted elements that are between two selected elements,\r\n *  e.g.: [0 (selected), 1 (deleted), 2 (deleted), 3 (selected)]\r\n */\r\nconst getIndicesToMove = (elements, appState) => {\r\n    let selectedIndices = [];\r\n    let deletedIndices = [];\r\n    let includeDeletedIndex = null;\r\n    let index = -1;\r\n    while (++index < elements.length) {\r\n        if (appState.selectedElementIds[elements[index].id]) {\r\n            if (deletedIndices.length) {\r\n                selectedIndices = selectedIndices.concat(deletedIndices);\r\n                deletedIndices = [];\r\n            }\r\n            selectedIndices.push(index);\r\n            includeDeletedIndex = index + 1;\r\n        }\r\n        else if (elements[index].isDeleted && includeDeletedIndex === index) {\r\n            includeDeletedIndex = index + 1;\r\n            deletedIndices.push(index);\r\n        }\r\n        else {\r\n            deletedIndices = [];\r\n        }\r\n    }\r\n    return selectedIndices;\r\n};\r\nconst toContiguousGroups = (array) => {\r\n    let cursor = 0;\r\n    return array.reduce((acc, value, index) => {\r\n        if (index > 0 && array[index - 1] !== value - 1) {\r\n            cursor = ++cursor;\r\n        }\r\n        (acc[cursor] || (acc[cursor] = [])).push(value);\r\n        return acc;\r\n    }, []);\r\n};\r\n/**\r\n * Returns next candidate index that's available to be moved to. Currently that\r\n *  is a non-deleted element, and not inside a group (unless we're editing it).\r\n */\r\nconst getTargetIndex = (appState, elements, boundaryIndex, direction) => {\r\n    const sourceElement = elements[boundaryIndex];\r\n    const indexFilter = (element) => {\r\n        if (element.isDeleted) {\r\n            return false;\r\n        }\r\n        // if we're editing group, find closest sibling irrespective of whether\r\n        // there's a different-group element between them (for legacy reasons)\r\n        if (appState.editingGroupId) {\r\n            return element.groupIds.includes(appState.editingGroupId);\r\n        }\r\n        return true;\r\n    };\r\n    const candidateIndex = direction === \"left\"\r\n        ? findLastIndex(elements, indexFilter, Math.max(0, boundaryIndex - 1))\r\n        : findIndex(elements, indexFilter, boundaryIndex + 1);\r\n    const nextElement = elements[candidateIndex];\r\n    if (!nextElement) {\r\n        return -1;\r\n    }\r\n    if (appState.editingGroupId) {\r\n        if (\r\n        // candidate element is a sibling in current editing group → return\r\n        sourceElement?.groupIds.join(\"\") === nextElement?.groupIds.join(\"\")) {\r\n            return candidateIndex;\r\n        }\r\n        else if (!nextElement?.groupIds.includes(appState.editingGroupId)) {\r\n            // candidate element is outside current editing group → prevent\r\n            return -1;\r\n        }\r\n    }\r\n    if (!nextElement.groupIds.length) {\r\n        return candidateIndex;\r\n    }\r\n    const siblingGroupId = appState.editingGroupId\r\n        ? nextElement.groupIds[nextElement.groupIds.indexOf(appState.editingGroupId) - 1]\r\n        : nextElement.groupIds[nextElement.groupIds.length - 1];\r\n    const elementsInSiblingGroup = getElementsInGroup(elements, siblingGroupId);\r\n    if (elementsInSiblingGroup.length) {\r\n        // assumes getElementsInGroup() returned elements are sorted\r\n        // by zIndex (ascending)\r\n        return direction === \"left\"\r\n            ? elements.indexOf(elementsInSiblingGroup[0])\r\n            : elements.indexOf(elementsInSiblingGroup[elementsInSiblingGroup.length - 1]);\r\n    }\r\n    return candidateIndex;\r\n};\r\nconst getTargetElementsMap = (elements, indices) => {\r\n    return indices.reduce((acc, index) => {\r\n        const element = elements[index];\r\n        acc[element.id] = element;\r\n        return acc;\r\n    }, {});\r\n};\r\nconst shiftElements = (appState, elements, direction) => {\r\n    const indicesToMove = getIndicesToMove(elements, appState);\r\n    const targetElementsMap = getTargetElementsMap(elements, indicesToMove);\r\n    let groupedIndices = toContiguousGroups(indicesToMove);\r\n    if (direction === \"right\") {\r\n        groupedIndices = groupedIndices.reverse();\r\n    }\r\n    groupedIndices.forEach((indices, i) => {\r\n        const leadingIndex = indices[0];\r\n        const trailingIndex = indices[indices.length - 1];\r\n        const boundaryIndex = direction === \"left\" ? leadingIndex : trailingIndex;\r\n        const targetIndex = getTargetIndex(appState, elements, boundaryIndex, direction);\r\n        if (targetIndex === -1 || boundaryIndex === targetIndex) {\r\n            return;\r\n        }\r\n        const leadingElements = direction === \"left\"\r\n            ? elements.slice(0, targetIndex)\r\n            : elements.slice(0, leadingIndex);\r\n        const targetElements = elements.slice(leadingIndex, trailingIndex + 1);\r\n        const displacedElements = direction === \"left\"\r\n            ? elements.slice(targetIndex, leadingIndex)\r\n            : elements.slice(trailingIndex + 1, targetIndex + 1);\r\n        const trailingElements = direction === \"left\"\r\n            ? elements.slice(trailingIndex + 1)\r\n            : elements.slice(targetIndex + 1);\r\n        elements =\r\n            direction === \"left\"\r\n                ? [\r\n                    ...leadingElements,\r\n                    ...targetElements,\r\n                    ...displacedElements,\r\n                    ...trailingElements,\r\n                ]\r\n                : [\r\n                    ...leadingElements,\r\n                    ...displacedElements,\r\n                    ...targetElements,\r\n                    ...trailingElements,\r\n                ];\r\n    });\r\n    return elements.map((element) => {\r\n        if (targetElementsMap[element.id]) {\r\n            return bumpVersion(element);\r\n        }\r\n        return element;\r\n    });\r\n};\r\nconst shiftElementsToEnd = (elements, appState, direction) => {\r\n    const indicesToMove = getIndicesToMove(elements, appState);\r\n    const targetElementsMap = getTargetElementsMap(elements, indicesToMove);\r\n    const displacedElements = [];\r\n    let leadingIndex;\r\n    let trailingIndex;\r\n    if (direction === \"left\") {\r\n        if (appState.editingGroupId) {\r\n            const groupElements = getElementsInGroup(elements, appState.editingGroupId);\r\n            if (!groupElements.length) {\r\n                return elements;\r\n            }\r\n            leadingIndex = elements.indexOf(groupElements[0]);\r\n        }\r\n        else {\r\n            leadingIndex = 0;\r\n        }\r\n        trailingIndex = indicesToMove[indicesToMove.length - 1];\r\n    }\r\n    else {\r\n        if (appState.editingGroupId) {\r\n            const groupElements = getElementsInGroup(elements, appState.editingGroupId);\r\n            if (!groupElements.length) {\r\n                return elements;\r\n            }\r\n            trailingIndex = elements.indexOf(groupElements[groupElements.length - 1]);\r\n        }\r\n        else {\r\n            trailingIndex = elements.length - 1;\r\n        }\r\n        leadingIndex = indicesToMove[0];\r\n    }\r\n    for (let index = leadingIndex; index < trailingIndex + 1; index++) {\r\n        if (!indicesToMove.includes(index)) {\r\n            displacedElements.push(elements[index]);\r\n        }\r\n    }\r\n    const targetElements = Object.values(targetElementsMap).map((element) => {\r\n        return bumpVersion(element);\r\n    });\r\n    const leadingElements = elements.slice(0, leadingIndex);\r\n    const trailingElements = elements.slice(trailingIndex + 1);\r\n    return direction === \"left\"\r\n        ? [\r\n            ...leadingElements,\r\n            ...targetElements,\r\n            ...displacedElements,\r\n            ...trailingElements,\r\n        ]\r\n        : [\r\n            ...leadingElements,\r\n            ...displacedElements,\r\n            ...targetElements,\r\n            ...trailingElements,\r\n        ];\r\n};\r\n// public API\r\n// -----------------------------------------------------------------------------\r\nexport const moveOneLeft = (elements, appState) => {\r\n    return shiftElements(appState, elements, \"left\");\r\n};\r\nexport const moveOneRight = (elements, appState) => {\r\n    return shiftElements(appState, elements, \"right\");\r\n};\r\nexport const moveAllLeft = (elements, appState) => {\r\n    return shiftElementsToEnd(elements, appState, \"left\");\r\n};\r\nexport const moveAllRight = (elements, appState) => {\r\n    return shiftElementsToEnd(elements, appState, \"right\");\r\n};\r\n","import React from \"react\";\r\nimport { moveOneLeft, moveOneRight, moveAllLeft, moveAllRight, } from \"../zindex\";\r\nimport { KEYS, isDarwin, CODES } from \"../keys\";\r\nimport { t } from \"../i18n\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nimport { SendBackwardIcon, BringToFrontIcon, SendToBackIcon, BringForwardIcon, } from \"../components/icons\";\r\nexport const actionSendBackward = register({\r\n    name: \"sendBackward\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveOneLeft(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.sendBackward\",\r\n    keyPriority: 40,\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] &&\r\n        !event.shiftKey &&\r\n        event.code === CODES.BRACKET_LEFT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={() => updateData(null)} title={`${t(\"labels.sendBackward\")} — ${getShortcutKey(\"CtrlOrCmd+[\")}`}>\r\n      <SendBackwardIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\nexport const actionBringForward = register({\r\n    name: \"bringForward\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveOneRight(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.bringForward\",\r\n    keyPriority: 40,\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] &&\r\n        !event.shiftKey &&\r\n        event.code === CODES.BRACKET_RIGHT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={() => updateData(null)} title={`${t(\"labels.bringForward\")} — ${getShortcutKey(\"CtrlOrCmd+]\")}`}>\r\n      <BringForwardIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\nexport const actionSendToBack = register({\r\n    name: \"sendToBack\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveAllLeft(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.sendToBack\",\r\n    keyTest: (event) => isDarwin\r\n        ? event[KEYS.CTRL_OR_CMD] &&\r\n            event.altKey &&\r\n            event.code === CODES.BRACKET_LEFT\r\n        : event[KEYS.CTRL_OR_CMD] &&\r\n            event.shiftKey &&\r\n            event.code === CODES.BRACKET_LEFT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={() => updateData(null)} title={`${t(\"labels.sendToBack\")} — ${isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+[\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+[\")}`}>\r\n      <SendToBackIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\nexport const actionBringToFront = register({\r\n    name: \"bringToFront\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: moveAllRight(elements, appState),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.bringToFront\",\r\n    keyTest: (event) => isDarwin\r\n        ? event[KEYS.CTRL_OR_CMD] &&\r\n            event.altKey &&\r\n            event.code === CODES.BRACKET_RIGHT\r\n        : event[KEYS.CTRL_OR_CMD] &&\r\n            event.shiftKey &&\r\n            event.code === CODES.BRACKET_RIGHT,\r\n    PanelComponent: ({ updateData, appState }) => (<button type=\"button\" className=\"zIndexButton\" onClick={(event) => updateData(null)} title={`${t(\"labels.bringToFront\")} — ${isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+]\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+]\")}`}>\r\n      <BringToFrontIcon theme={appState.theme}/>\r\n    </button>),\r\n});\r\n","import { KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { selectGroupsForSelectedElements } from \"../groups\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nexport const actionSelectAll = register({\r\n    name: \"selectAll\",\r\n    perform: (elements, appState) => {\r\n        if (appState.editingLinearElement) {\r\n            return false;\r\n        }\r\n        return {\r\n            appState: selectGroupsForSelectedElements({\r\n                ...appState,\r\n                editingGroupId: null,\r\n                selectedElementIds: elements.reduce((map, element) => {\r\n                    if (!element.isDeleted) {\r\n                        map[element.id] = true;\r\n                    }\r\n                    return map;\r\n                }, {}),\r\n            }, getNonDeletedElements(elements)),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.selectAll\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.key === KEYS.A,\r\n});\r\n","import { KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { duplicateElement, getNonDeletedElements } from \"../element\";\r\nimport { isSomeElementSelected } from \"../scene\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { clone } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { mutateElement } from \"../element/mutateElement\";\r\nimport { selectGroupsForSelectedElements, getSelectedGroupForElement, getElementsInGroup, } from \"../groups\";\r\nimport { fixBindingsAfterDuplication } from \"../element/binding\";\r\nimport { GRID_SIZE } from \"../constants\";\r\nexport const actionDuplicateSelection = register({\r\n    name: \"duplicateSelection\",\r\n    perform: (elements, appState) => {\r\n        // duplicate point if selected while editing multi-point element\r\n        if (appState.editingLinearElement) {\r\n            const { activePointIndex, elementId } = appState.editingLinearElement;\r\n            const element = LinearElementEditor.getElement(elementId);\r\n            if (!element || activePointIndex === null) {\r\n                return false;\r\n            }\r\n            const { points } = element;\r\n            const selectedPoint = points[activePointIndex];\r\n            const nextPoint = points[activePointIndex + 1];\r\n            mutateElement(element, {\r\n                points: [\r\n                    ...points.slice(0, activePointIndex + 1),\r\n                    nextPoint\r\n                        ? [\r\n                            (selectedPoint[0] + nextPoint[0]) / 2,\r\n                            (selectedPoint[1] + nextPoint[1]) / 2,\r\n                        ]\r\n                        : [selectedPoint[0] + 30, selectedPoint[1] + 30],\r\n                    ...points.slice(activePointIndex + 1),\r\n                ],\r\n            });\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    editingLinearElement: {\r\n                        ...appState.editingLinearElement,\r\n                        activePointIndex: activePointIndex + 1,\r\n                    },\r\n                },\r\n                elements,\r\n                commitToHistory: true,\r\n            };\r\n        }\r\n        return {\r\n            ...duplicateElements(elements, appState),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.duplicateSelection\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.key === KEYS.D,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton type=\"button\" icon={clone} title={`${t(\"labels.duplicateSelection\")} — ${getShortcutKey(\"CtrlOrCmd+D\")}`} aria-label={t(\"labels.duplicateSelection\")} onClick={() => updateData(null)} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nconst duplicateElements = (elements, appState) => {\r\n    const groupIdMap = new Map();\r\n    const newElements = [];\r\n    const oldElements = [];\r\n    const oldIdToDuplicatedId = new Map();\r\n    const duplicateAndOffsetElement = (element) => {\r\n        const newElement = duplicateElement(appState.editingGroupId, groupIdMap, element, {\r\n            x: element.x + GRID_SIZE / 2,\r\n            y: element.y + GRID_SIZE / 2,\r\n        });\r\n        oldIdToDuplicatedId.set(element.id, newElement.id);\r\n        oldElements.push(element);\r\n        newElements.push(newElement);\r\n        return newElement;\r\n    };\r\n    const finalElements = [];\r\n    let index = 0;\r\n    while (index < elements.length) {\r\n        const element = elements[index];\r\n        if (appState.selectedElementIds[element.id]) {\r\n            if (element.groupIds.length) {\r\n                const groupId = getSelectedGroupForElement(appState, element);\r\n                // if group selected, duplicate it atomically\r\n                if (groupId) {\r\n                    const groupElements = getElementsInGroup(elements, groupId);\r\n                    finalElements.push(...groupElements, ...groupElements.map((element) => duplicateAndOffsetElement(element)));\r\n                    index = index + groupElements.length;\r\n                    continue;\r\n                }\r\n            }\r\n            finalElements.push(element, duplicateAndOffsetElement(element));\r\n        }\r\n        else {\r\n            finalElements.push(element);\r\n        }\r\n        index++;\r\n    }\r\n    fixBindingsAfterDuplication(finalElements, oldElements, oldIdToDuplicatedId);\r\n    return {\r\n        elements: finalElements,\r\n        appState: selectGroupsForSelectedElements({\r\n            ...appState,\r\n            selectedGroupIds: {},\r\n            selectedElementIds: newElements.reduce((acc, element) => {\r\n                acc[element.id] = true;\r\n                return acc;\r\n            }, {}),\r\n        }, getNonDeletedElements(finalElements)),\r\n    };\r\n};\r\n","import clsx from \"clsx\";\r\n// TODO: It might be \"clever\" to add option.icon to the existing component <ButtonSelect />\r\nexport const ButtonIconSelect = ({ options, value, onChange, group, }) => (<div className=\"buttonList buttonListIcon\">\r\n    {options.map((option) => (<label key={option.text} className={clsx({ active: value === option.value })} title={option.text}>\r\n        <input type=\"radio\" name={group} onChange={() => onChange(option.value)} checked={value === option.value}/>\r\n        {option.icon}\r\n      </label>))}\r\n  </div>);\r\n","import React, { useLayoutEffect, useRef, useEffect } from \"react\";\r\nimport \"./Popover.scss\";\r\nimport { unstable_batchedUpdates } from \"react-dom\";\r\nexport const Popover = ({ children, left, top, onCloseRequest, fitInViewport = false, }) => {\r\n    const popoverRef = useRef(null);\r\n    // ensure the popover doesn't overflow the viewport\r\n    useLayoutEffect(() => {\r\n        if (fitInViewport && popoverRef.current) {\r\n            const element = popoverRef.current;\r\n            const { x, y, width, height } = element.getBoundingClientRect();\r\n            const viewportWidth = window.innerWidth;\r\n            if (x + width > viewportWidth) {\r\n                element.style.left = `${viewportWidth - width}px`;\r\n            }\r\n            const viewportHeight = window.innerHeight;\r\n            if (y + height > viewportHeight) {\r\n                element.style.top = `${viewportHeight - height}px`;\r\n            }\r\n        }\r\n    }, [fitInViewport]);\r\n    useEffect(() => {\r\n        if (onCloseRequest) {\r\n            const handler = (event) => {\r\n                if (!popoverRef.current?.contains(event.target)) {\r\n                    unstable_batchedUpdates(() => onCloseRequest(event));\r\n                }\r\n            };\r\n            document.addEventListener(\"pointerdown\", handler, false);\r\n            return () => document.removeEventListener(\"pointerdown\", handler, false);\r\n        }\r\n    }, [onCloseRequest]);\r\n    return (<div className=\"popover\" style={{ top, left }} ref={popoverRef}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import React from \"react\";\r\nimport { Popover } from \"./Popover\";\r\nimport { isTransparent } from \"../utils\";\r\nimport \"./ColorPicker.scss\";\r\nimport { isArrowKey, KEYS } from \"../keys\";\r\nimport { t, getLanguage } from \"../i18n\";\r\nimport { isWritableElement } from \"../utils\";\r\nimport colors from \"../colors\";\r\nconst isValidColor = (color) => {\r\n    const style = new Option().style;\r\n    style.color = color;\r\n    return !!style.color;\r\n};\r\nconst getColor = (color) => {\r\n    if (isTransparent(color)) {\r\n        return color;\r\n    }\r\n    return isValidColor(color)\r\n        ? color\r\n        : isValidColor(`#${color}`)\r\n            ? `#${color}`\r\n            : null;\r\n};\r\n// This is a narrow reimplementation of the awesome react-color Twitter component\r\n// https://github.com/casesandberg/react-color/blob/master/src/components/twitter/Twitter.js\r\n// Unfortunately, we can't detect keyboard layout in the browser. So this will\r\n// only work well for QWERTY but not AZERTY or others...\r\nconst keyBindings = [\r\n    [\"1\", \"2\", \"3\", \"4\", \"5\"],\r\n    [\"q\", \"w\", \"e\", \"r\", \"t\"],\r\n    [\"a\", \"s\", \"d\", \"f\", \"g\"],\r\n].flat();\r\nconst Picker = ({ colors, color, onChange, onClose, label, showInput = true, type, }) => {\r\n    const firstItem = React.useRef();\r\n    const activeItem = React.useRef();\r\n    const gallery = React.useRef();\r\n    const colorInput = React.useRef();\r\n    React.useEffect(() => {\r\n        // After the component is first mounted focus on first input\r\n        if (activeItem.current) {\r\n            activeItem.current.focus();\r\n        }\r\n        else if (colorInput.current) {\r\n            colorInput.current.focus();\r\n        }\r\n        else if (gallery.current) {\r\n            gallery.current.focus();\r\n        }\r\n    }, []);\r\n    const handleKeyDown = (event) => {\r\n        if (event.key === KEYS.TAB) {\r\n            const { activeElement } = document;\r\n            if (event.shiftKey) {\r\n                if (activeElement === firstItem.current) {\r\n                    colorInput.current?.focus();\r\n                    event.preventDefault();\r\n                }\r\n            }\r\n            else if (activeElement === colorInput.current) {\r\n                firstItem.current?.focus();\r\n                event.preventDefault();\r\n            }\r\n        }\r\n        else if (isArrowKey(event.key)) {\r\n            const { activeElement } = document;\r\n            const isRTL = getLanguage().rtl;\r\n            const index = Array.prototype.indexOf.call(gallery.current.children, activeElement);\r\n            if (index !== -1) {\r\n                const length = gallery.current.children.length - (showInput ? 1 : 0);\r\n                const nextIndex = event.key === (isRTL ? KEYS.ARROW_LEFT : KEYS.ARROW_RIGHT)\r\n                    ? (index + 1) % length\r\n                    : event.key === (isRTL ? KEYS.ARROW_RIGHT : KEYS.ARROW_LEFT)\r\n                        ? (length + index - 1) % length\r\n                        : event.key === KEYS.ARROW_DOWN\r\n                            ? (index + 5) % length\r\n                            : event.key === KEYS.ARROW_UP\r\n                                ? (length + index - 5) % length\r\n                                : index;\r\n                gallery.current.children[nextIndex].focus();\r\n            }\r\n            event.preventDefault();\r\n        }\r\n        else if (keyBindings.includes(event.key.toLowerCase()) &&\r\n            !isWritableElement(event.target)) {\r\n            const index = keyBindings.indexOf(event.key.toLowerCase());\r\n            gallery.current.children[index].focus();\r\n            event.preventDefault();\r\n        }\r\n        else if (event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) {\r\n            event.preventDefault();\r\n            onClose();\r\n        }\r\n        event.nativeEvent.stopImmediatePropagation();\r\n        event.stopPropagation();\r\n    };\r\n    return (<div className={`color-picker color-picker-type-${type}`} role=\"dialog\" aria-modal=\"true\" aria-label={t(\"labels.colorPicker\")} onKeyDown={handleKeyDown}>\r\n      <div className=\"color-picker-triangle color-picker-triangle-shadow\"></div>\r\n      <div className=\"color-picker-triangle\"></div>\r\n      <div className=\"color-picker-content\" ref={(el) => {\r\n            if (el) {\r\n                gallery.current = el;\r\n            }\r\n        }} tabIndex={0}>\r\n        {colors.map((_color, i) => {\r\n            const _colorWithoutHash = _color.replace(\"#\", \"\");\r\n            return (<button className=\"color-picker-swatch\" onClick={(event) => {\r\n                    event.currentTarget.focus();\r\n                    onChange(_color);\r\n                }} title={`${t(`colors.${_colorWithoutHash}`)}${!isTransparent(_color) ? ` (${_color})` : \"\"} — ${keyBindings[i].toUpperCase()}`} aria-label={t(`colors.${_colorWithoutHash}`)} aria-keyshortcuts={keyBindings[i]} style={{ color: _color }} key={_color} ref={(el) => {\r\n                    if (el && i === 0) {\r\n                        firstItem.current = el;\r\n                    }\r\n                    if (el && _color === color) {\r\n                        activeItem.current = el;\r\n                    }\r\n                }} onFocus={() => {\r\n                    onChange(_color);\r\n                }}>\r\n              {isTransparent(_color) ? (<div className=\"color-picker-transparent\"></div>) : undefined}\r\n              <span className=\"color-picker-keybinding\">{keyBindings[i]}</span>\r\n            </button>);\r\n        })}\r\n        {showInput && (<ColorInput color={color} label={label} onChange={(color) => {\r\n                onChange(color);\r\n            }} ref={colorInput}/>)}\r\n      </div>\r\n    </div>);\r\n};\r\nconst ColorInput = React.forwardRef(({ color, onChange, label, }, ref) => {\r\n    const [innerValue, setInnerValue] = React.useState(color);\r\n    const inputRef = React.useRef(null);\r\n    React.useEffect(() => {\r\n        setInnerValue(color);\r\n    }, [color]);\r\n    React.useImperativeHandle(ref, () => inputRef.current);\r\n    const changeColor = React.useCallback((inputValue) => {\r\n        const value = inputValue.toLowerCase();\r\n        const color = getColor(value);\r\n        if (color) {\r\n            onChange(color);\r\n        }\r\n        setInnerValue(value);\r\n    }, [onChange]);\r\n    return (<label className=\"color-input-container\">\r\n        <div className=\"color-picker-hash\">#</div>\r\n        <input spellCheck={false} className=\"color-picker-input\" aria-label={label} onChange={(event) => changeColor(event.target.value)} value={(innerValue || \"\").replace(/^#/, \"\")} onBlur={() => setInnerValue(color)} ref={inputRef}/>\r\n      </label>);\r\n});\r\nexport const ColorPicker = ({ type, color, onChange, label, isActive, setActive, }) => {\r\n    const pickerButton = React.useRef(null);\r\n    return (<div>\r\n      <div className=\"color-picker-control-container\">\r\n        <button className=\"color-picker-label-swatch\" aria-label={label} style={color ? { \"--swatch-color\": color } : undefined} onClick={() => setActive(!isActive)} ref={pickerButton}/>\r\n        <ColorInput color={color} label={label} onChange={(color) => {\r\n            onChange(color);\r\n        }}/>\r\n      </div>\r\n      <React.Suspense fallback=\"\">\r\n        {isActive ? (<Popover onCloseRequest={(event) => event.target !== pickerButton.current && setActive(false)}>\r\n            <Picker colors={colors[type]} color={color || null} onChange={(changedColor) => {\r\n                onChange(changedColor);\r\n            }} onClose={() => {\r\n                setActive(false);\r\n                pickerButton.current?.focus();\r\n            }} label={label} showInput={false} type={type}/>\r\n          </Popover>) : null}\r\n      </React.Suspense>\r\n    </div>);\r\n};\r\n","import React from \"react\";\r\nimport { Popover } from \"./Popover\";\r\nimport \"./IconPicker.scss\";\r\nimport { isArrowKey, KEYS } from \"../keys\";\r\nimport { getLanguage } from \"../i18n\";\r\nfunction Picker({ options, value, label, onChange, onClose, }) {\r\n    const rFirstItem = React.useRef();\r\n    const rActiveItem = React.useRef();\r\n    const rGallery = React.useRef(null);\r\n    React.useEffect(() => {\r\n        // After the component is first mounted focus on first input\r\n        if (rActiveItem.current) {\r\n            rActiveItem.current.focus();\r\n        }\r\n        else if (rGallery.current) {\r\n            rGallery.current.focus();\r\n        }\r\n    }, []);\r\n    const handleKeyDown = (event) => {\r\n        const pressedOption = options.find((option) => option.keyBinding === event.key.toLowerCase());\r\n        if (!(event.metaKey || event.altKey || event.ctrlKey) && pressedOption) {\r\n            // Keybinding navigation\r\n            const index = options.indexOf(pressedOption);\r\n            rGallery.current.children[index].focus();\r\n            event.preventDefault();\r\n        }\r\n        else if (event.key === KEYS.TAB) {\r\n            // Tab navigation cycle through options. If the user tabs\r\n            // away from the picker, close the picker. We need to use\r\n            // a timeout here to let the stack clear before checking.\r\n            setTimeout(() => {\r\n                const active = rActiveItem.current;\r\n                const docActive = document.activeElement;\r\n                if (active !== docActive) {\r\n                    onClose();\r\n                }\r\n            }, 0);\r\n        }\r\n        else if (isArrowKey(event.key)) {\r\n            // Arrow navigation\r\n            const { activeElement } = document;\r\n            const isRTL = getLanguage().rtl;\r\n            const index = Array.prototype.indexOf.call(rGallery.current.children, activeElement);\r\n            if (index !== -1) {\r\n                const length = options.length;\r\n                let nextIndex = index;\r\n                switch (event.key) {\r\n                    // Select the next option\r\n                    case isRTL ? KEYS.ARROW_LEFT : KEYS.ARROW_RIGHT:\r\n                    case KEYS.ARROW_DOWN: {\r\n                        nextIndex = (index + 1) % length;\r\n                        break;\r\n                    }\r\n                    // Select the previous option\r\n                    case isRTL ? KEYS.ARROW_RIGHT : KEYS.ARROW_LEFT:\r\n                    case KEYS.ARROW_UP: {\r\n                        nextIndex = (length + index - 1) % length;\r\n                        break;\r\n                    }\r\n                }\r\n                rGallery.current.children[nextIndex].focus();\r\n            }\r\n            event.preventDefault();\r\n        }\r\n        else if (event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) {\r\n            // Close on escape or enter\r\n            event.preventDefault();\r\n            onClose();\r\n        }\r\n        event.nativeEvent.stopImmediatePropagation();\r\n        event.stopPropagation();\r\n    };\r\n    return (<div className={`picker`} role=\"dialog\" aria-modal=\"true\" aria-label={label} onKeyDown={handleKeyDown}>\r\n      <div className=\"picker-content\" ref={rGallery}>\r\n        {options.map((option, i) => (<button className=\"picker-option\" onClick={(event) => {\r\n                event.currentTarget.focus();\r\n                onChange(option.value);\r\n            }} title={`${option.text} — ${option.keyBinding.toUpperCase()}`} aria-label={option.text || \"none\"} aria-keyshortcuts={option.keyBinding} key={option.text} ref={(el) => {\r\n                if (el && i === 0) {\r\n                    rFirstItem.current = el;\r\n                }\r\n                if (el && option.value === value) {\r\n                    rActiveItem.current = el;\r\n                }\r\n            }} onFocus={() => {\r\n                onChange(option.value);\r\n            }}>\r\n            {option.icon}\r\n            <span className=\"picker-keybinding\">{option.keyBinding}</span>\r\n          </button>))}\r\n      </div>\r\n    </div>);\r\n}\r\nexport function IconPicker({ value, label, options, onChange, group = \"\", }) {\r\n    const [isActive, setActive] = React.useState(false);\r\n    const rPickerButton = React.useRef(null);\r\n    const isRTL = getLanguage().rtl;\r\n    return (<label className={\"picker-container\"}>\r\n      <button name={group} className={isActive ? \"active\" : \"\"} aria-label={label} onClick={() => setActive(!isActive)} ref={rPickerButton}>\r\n        {options.find((option) => option.value === value)?.icon}\r\n      </button>\r\n      <React.Suspense fallback=\"\">\r\n        {isActive ? (<>\r\n            <Popover onCloseRequest={(event) => event.target !== rPickerButton.current && setActive(false)} {...(isRTL ? { right: 5.5 } : { left: -5.5 })}>\r\n              <Picker options={options} value={value} label={label} onChange={onChange} onClose={() => {\r\n                setActive(false);\r\n                rPickerButton.current?.focus();\r\n            }}/>\r\n            </Popover>\r\n            <div className=\"picker-triangle\"/>\r\n          </>) : null}\r\n      </React.Suspense>\r\n    </label>);\r\n}\r\n","import { ButtonIconSelect } from \"../components/ButtonIconSelect\";\r\nimport { ColorPicker } from \"../components/ColorPicker\";\r\nimport { IconPicker } from \"../components/IconPicker\";\r\nimport { ArrowheadArrowIcon, ArrowheadBarIcon, ArrowheadDotIcon, ArrowheadTriangleIcon, ArrowheadNoneIcon, EdgeRoundIcon, EdgeSharpIcon, FillCrossHatchIcon, FillHachureIcon, FillSolidIcon, FontFamilyCodeIcon, FontFamilyHandDrawnIcon, FontFamilyNormalIcon, FontSizeExtraLargeIcon, FontSizeLargeIcon, FontSizeMediumIcon, FontSizeSmallIcon, SloppinessArchitectIcon, SloppinessArtistIcon, SloppinessCartoonistIcon, StrokeStyleDashedIcon, StrokeStyleDottedIcon, StrokeStyleSolidIcon, StrokeWidthIcon, TextAlignCenterIcon, TextAlignLeftIcon, TextAlignRightIcon, } from \"../components/icons\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_FONT_SIZE, FONT_FAMILY, } from \"../constants\";\r\nimport { getNonDeletedElements, isTextElement, redrawTextBoundingBox, } from \"../element\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { isLinearElement, isLinearElementType } from \"../element/typeChecks\";\r\nimport { getLanguage, t } from \"../i18n\";\r\nimport { randomInteger } from \"../random\";\r\nimport { canChangeSharpness, canHaveArrowheads, getCommonAttributeOfSelectedElements, getTargetElements, isSomeElementSelected, } from \"../scene\";\r\nimport { hasStrokeColor } from \"../scene/comparisons\";\r\nimport { register } from \"./register\";\r\nconst changeProperty = (elements, appState, callback) => {\r\n    return elements.map((element) => {\r\n        if (appState.selectedElementIds[element.id] ||\r\n            element.id === appState.editingElement?.id) {\r\n            return callback(element);\r\n        }\r\n        return element;\r\n    });\r\n};\r\nconst getFormValue = function (elements, appState, getAttribute, defaultValue) {\r\n    const editingElement = appState.editingElement;\r\n    const nonDeletedElements = getNonDeletedElements(elements);\r\n    return ((editingElement && getAttribute(editingElement)) ??\r\n        (isSomeElementSelected(nonDeletedElements, appState)\r\n            ? getCommonAttributeOfSelectedElements(nonDeletedElements, appState, getAttribute)\r\n            : defaultValue) ??\r\n        null);\r\n};\r\nexport const actionChangeStrokeColor = register({\r\n    name: \"changeStrokeColor\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            ...(value.currentItemStrokeColor && {\r\n                elements: changeProperty(elements, appState, (el) => {\r\n                    return hasStrokeColor(el.type)\r\n                        ? newElementWith(el, {\r\n                            strokeColor: value.currentItemStrokeColor,\r\n                        })\r\n                        : el;\r\n                }),\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                ...value,\r\n            },\r\n            commitToHistory: !!value.currentItemStrokeColor,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<>\r\n      <h3 aria-hidden=\"true\">{t(\"labels.stroke\")}</h3>\r\n      <ColorPicker type=\"elementStroke\" label={t(\"labels.stroke\")} color={getFormValue(elements, appState, (element) => element.strokeColor, appState.currentItemStrokeColor)} onChange={(color) => updateData({ currentItemStrokeColor: color })} isActive={appState.openPopup === \"strokeColorPicker\"} setActive={(active) => updateData({ openPopup: active ? \"strokeColorPicker\" : null })}/>\r\n    </>),\r\n});\r\nexport const actionChangeBackgroundColor = register({\r\n    name: \"changeBackgroundColor\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            ...(value.currentItemBackgroundColor && {\r\n                elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                    backgroundColor: value.currentItemBackgroundColor,\r\n                })),\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                ...value,\r\n            },\r\n            commitToHistory: !!value.currentItemBackgroundColor,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<>\r\n      <h3 aria-hidden=\"true\">{t(\"labels.background\")}</h3>\r\n      <ColorPicker type=\"elementBackground\" label={t(\"labels.background\")} color={getFormValue(elements, appState, (element) => element.backgroundColor, appState.currentItemBackgroundColor)} onChange={(color) => updateData({ currentItemBackgroundColor: color })} isActive={appState.openPopup === \"backgroundColorPicker\"} setActive={(active) => updateData({ openPopup: active ? \"backgroundColorPicker\" : null })}/>\r\n    </>),\r\n});\r\nexport const actionChangeFillStyle = register({\r\n    name: \"changeFillStyle\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                fillStyle: value,\r\n            })),\r\n            appState: { ...appState, currentItemFillStyle: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.fill\")}</legend>\r\n      <ButtonIconSelect options={[\r\n            {\r\n                value: \"hachure\",\r\n                text: t(\"labels.hachure\"),\r\n                icon: <FillHachureIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"cross-hatch\",\r\n                text: t(\"labels.crossHatch\"),\r\n                icon: <FillCrossHatchIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"solid\",\r\n                text: t(\"labels.solid\"),\r\n                icon: <FillSolidIcon theme={appState.theme}/>,\r\n            },\r\n        ]} group=\"fill\" value={getFormValue(elements, appState, (element) => element.fillStyle, appState.currentItemFillStyle)} onChange={(value) => {\r\n            updateData(value);\r\n        }}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeStrokeWidth = register({\r\n    name: \"changeStrokeWidth\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                strokeWidth: value,\r\n            })),\r\n            appState: { ...appState, currentItemStrokeWidth: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.strokeWidth\")}</legend>\r\n      <ButtonIconSelect group=\"stroke-width\" options={[\r\n            {\r\n                value: 1,\r\n                text: t(\"labels.thin\"),\r\n                icon: <StrokeWidthIcon theme={appState.theme} strokeWidth={2}/>,\r\n            },\r\n            {\r\n                value: 2,\r\n                text: t(\"labels.bold\"),\r\n                icon: <StrokeWidthIcon theme={appState.theme} strokeWidth={6}/>,\r\n            },\r\n            {\r\n                value: 4,\r\n                text: t(\"labels.extraBold\"),\r\n                icon: <StrokeWidthIcon theme={appState.theme} strokeWidth={10}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.strokeWidth, appState.currentItemStrokeWidth)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeSloppiness = register({\r\n    name: \"changeSloppiness\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                seed: randomInteger(),\r\n                roughness: value,\r\n            })),\r\n            appState: { ...appState, currentItemRoughness: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.sloppiness\")}</legend>\r\n      <ButtonIconSelect group=\"sloppiness\" options={[\r\n            {\r\n                value: 0,\r\n                text: t(\"labels.architect\"),\r\n                icon: <SloppinessArchitectIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 1,\r\n                text: t(\"labels.artist\"),\r\n                icon: <SloppinessArtistIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 2,\r\n                text: t(\"labels.cartoonist\"),\r\n                icon: <SloppinessCartoonistIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.roughness, appState.currentItemRoughness)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeStrokeStyle = register({\r\n    name: \"changeStrokeStyle\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                strokeStyle: value,\r\n            })),\r\n            appState: { ...appState, currentItemStrokeStyle: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.strokeStyle\")}</legend>\r\n      <ButtonIconSelect group=\"strokeStyle\" options={[\r\n            {\r\n                value: \"solid\",\r\n                text: t(\"labels.strokeStyle_solid\"),\r\n                icon: <StrokeStyleSolidIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"dashed\",\r\n                text: t(\"labels.strokeStyle_dashed\"),\r\n                icon: <StrokeStyleDashedIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"dotted\",\r\n                text: t(\"labels.strokeStyle_dotted\"),\r\n                icon: <StrokeStyleDottedIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.strokeStyle, appState.currentItemStrokeStyle)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeOpacity = register({\r\n    name: \"changeOpacity\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                opacity: value,\r\n            })),\r\n            appState: { ...appState, currentItemOpacity: value },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<label className=\"control-label\">\r\n      {t(\"labels.opacity\")}\r\n      <input type=\"range\" min=\"0\" max=\"100\" step=\"10\" onChange={(event) => updateData(+event.target.value)} onWheel={(event) => {\r\n            event.stopPropagation();\r\n            const target = event.target;\r\n            const STEP = 10;\r\n            const MAX = 100;\r\n            const MIN = 0;\r\n            const value = +target.value;\r\n            if (event.deltaY < 0 && value < MAX) {\r\n                updateData(value + STEP);\r\n            }\r\n            else if (event.deltaY > 0 && value > MIN) {\r\n                updateData(value - STEP);\r\n            }\r\n        }} value={getFormValue(elements, appState, (element) => element.opacity, appState.currentItemOpacity) ?? undefined}/>\r\n    </label>),\r\n});\r\nexport const actionChangeFontSize = register({\r\n    name: \"changeFontSize\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isTextElement(el)) {\r\n                    const element = newElementWith(el, {\r\n                        fontSize: value,\r\n                    });\r\n                    redrawTextBoundingBox(element);\r\n                    return element;\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                currentItemFontSize: value,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.fontSize\")}</legend>\r\n      <ButtonIconSelect group=\"font-size\" options={[\r\n            {\r\n                value: 16,\r\n                text: t(\"labels.small\"),\r\n                icon: <FontSizeSmallIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 20,\r\n                text: t(\"labels.medium\"),\r\n                icon: <FontSizeMediumIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 28,\r\n                text: t(\"labels.large\"),\r\n                icon: <FontSizeLargeIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: 36,\r\n                text: t(\"labels.veryLarge\"),\r\n                icon: <FontSizeExtraLargeIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => isTextElement(element) && element.fontSize, appState.currentItemFontSize || DEFAULT_FONT_SIZE)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeFontFamily = register({\r\n    name: \"changeFontFamily\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isTextElement(el)) {\r\n                    const element = newElementWith(el, {\r\n                        fontFamily: value,\r\n                    });\r\n                    redrawTextBoundingBox(element);\r\n                    return element;\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                currentItemFontFamily: value,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => {\r\n        const options = [\r\n            {\r\n                value: FONT_FAMILY.Virgil,\r\n                text: t(\"labels.handDrawn\"),\r\n                icon: <FontFamilyHandDrawnIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: FONT_FAMILY.Helvetica,\r\n                text: t(\"labels.normal\"),\r\n                icon: <FontFamilyNormalIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: FONT_FAMILY.Cascadia,\r\n                text: t(\"labels.code\"),\r\n                icon: <FontFamilyCodeIcon theme={appState.theme}/>,\r\n            },\r\n        ];\r\n        return (<fieldset>\r\n        <legend>{t(\"labels.fontFamily\")}</legend>\r\n        <ButtonIconSelect group=\"font-family\" options={options} value={getFormValue(elements, appState, (element) => isTextElement(element) && element.fontFamily, appState.currentItemFontFamily || DEFAULT_FONT_FAMILY)} onChange={(value) => updateData(value)}/>\r\n      </fieldset>);\r\n    },\r\n});\r\nexport const actionChangeTextAlign = register({\r\n    name: \"changeTextAlign\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isTextElement(el)) {\r\n                    const element = newElementWith(el, {\r\n                        textAlign: value,\r\n                    });\r\n                    redrawTextBoundingBox(element);\r\n                    return element;\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                currentItemTextAlign: value,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.textAlign\")}</legend>\r\n      <ButtonIconSelect group=\"text-align\" options={[\r\n            {\r\n                value: \"left\",\r\n                text: t(\"labels.left\"),\r\n                icon: <TextAlignLeftIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"center\",\r\n                text: t(\"labels.center\"),\r\n                icon: <TextAlignCenterIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"right\",\r\n                text: t(\"labels.right\"),\r\n                icon: <TextAlignRightIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => isTextElement(element) && element.textAlign, appState.currentItemTextAlign)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeSharpness = register({\r\n    name: \"changeSharpness\",\r\n    perform: (elements, appState, value) => {\r\n        const targetElements = getTargetElements(getNonDeletedElements(elements), appState);\r\n        const shouldUpdateForNonLinearElements = targetElements.length\r\n            ? targetElements.every((el) => !isLinearElement(el))\r\n            : !isLinearElementType(appState.elementType);\r\n        const shouldUpdateForLinearElements = targetElements.length\r\n            ? targetElements.every(isLinearElement)\r\n            : isLinearElementType(appState.elementType);\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => newElementWith(el, {\r\n                strokeSharpness: value,\r\n            })),\r\n            appState: {\r\n                ...appState,\r\n                currentItemStrokeSharpness: shouldUpdateForNonLinearElements\r\n                    ? value\r\n                    : appState.currentItemStrokeSharpness,\r\n                currentItemLinearStrokeSharpness: shouldUpdateForLinearElements\r\n                    ? value\r\n                    : appState.currentItemLinearStrokeSharpness,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<fieldset>\r\n      <legend>{t(\"labels.edges\")}</legend>\r\n      <ButtonIconSelect group=\"edges\" options={[\r\n            {\r\n                value: \"sharp\",\r\n                text: t(\"labels.sharp\"),\r\n                icon: <EdgeSharpIcon theme={appState.theme}/>,\r\n            },\r\n            {\r\n                value: \"round\",\r\n                text: t(\"labels.round\"),\r\n                icon: <EdgeRoundIcon theme={appState.theme}/>,\r\n            },\r\n        ]} value={getFormValue(elements, appState, (element) => element.strokeSharpness, (canChangeSharpness(appState.elementType) &&\r\n            (isLinearElementType(appState.elementType)\r\n                ? appState.currentItemLinearStrokeSharpness\r\n                : appState.currentItemStrokeSharpness)) ||\r\n            null)} onChange={(value) => updateData(value)}/>\r\n    </fieldset>),\r\n});\r\nexport const actionChangeArrowhead = register({\r\n    name: \"changeArrowhead\",\r\n    perform: (elements, appState, value) => {\r\n        return {\r\n            elements: changeProperty(elements, appState, (el) => {\r\n                if (isLinearElement(el)) {\r\n                    const { position, type } = value;\r\n                    if (position === \"start\") {\r\n                        const element = newElementWith(el, {\r\n                            startArrowhead: type,\r\n                        });\r\n                        return element;\r\n                    }\r\n                    else if (position === \"end\") {\r\n                        const element = newElementWith(el, {\r\n                            endArrowhead: type,\r\n                        });\r\n                        return element;\r\n                    }\r\n                }\r\n                return el;\r\n            }),\r\n            appState: {\r\n                ...appState,\r\n                [value.position === \"start\"\r\n                    ? \"currentItemStartArrowhead\"\r\n                    : \"currentItemEndArrowhead\"]: value.type,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => {\r\n        const isRTL = getLanguage().rtl;\r\n        return (<fieldset>\r\n        <legend>{t(\"labels.arrowheads\")}</legend>\r\n        <div className=\"iconSelectList\">\r\n          <IconPicker label=\"arrowhead_start\" options={[\r\n                {\r\n                    value: null,\r\n                    text: t(\"labels.arrowhead_none\"),\r\n                    icon: <ArrowheadNoneIcon theme={appState.theme}/>,\r\n                    keyBinding: \"q\",\r\n                },\r\n                {\r\n                    value: \"arrow\",\r\n                    text: t(\"labels.arrowhead_arrow\"),\r\n                    icon: (<ArrowheadArrowIcon theme={appState.theme} flip={!isRTL}/>),\r\n                    keyBinding: \"w\",\r\n                },\r\n                {\r\n                    value: \"bar\",\r\n                    text: t(\"labels.arrowhead_bar\"),\r\n                    icon: <ArrowheadBarIcon theme={appState.theme} flip={!isRTL}/>,\r\n                    keyBinding: \"e\",\r\n                },\r\n                {\r\n                    value: \"dot\",\r\n                    text: t(\"labels.arrowhead_dot\"),\r\n                    icon: <ArrowheadDotIcon theme={appState.theme} flip={!isRTL}/>,\r\n                    keyBinding: \"r\",\r\n                },\r\n                {\r\n                    value: \"triangle\",\r\n                    text: t(\"labels.arrowhead_triangle\"),\r\n                    icon: (<ArrowheadTriangleIcon theme={appState.theme} flip={!isRTL}/>),\r\n                    keyBinding: \"t\",\r\n                },\r\n            ]} value={getFormValue(elements, appState, (element) => isLinearElement(element) && canHaveArrowheads(element.type)\r\n                ? element.startArrowhead\r\n                : appState.currentItemStartArrowhead, appState.currentItemStartArrowhead)} onChange={(value) => updateData({ position: \"start\", type: value })}/>\r\n          <IconPicker label=\"arrowhead_end\" group=\"arrowheads\" options={[\r\n                {\r\n                    value: null,\r\n                    text: t(\"labels.arrowhead_none\"),\r\n                    keyBinding: \"q\",\r\n                    icon: <ArrowheadNoneIcon theme={appState.theme}/>,\r\n                },\r\n                {\r\n                    value: \"arrow\",\r\n                    text: t(\"labels.arrowhead_arrow\"),\r\n                    keyBinding: \"w\",\r\n                    icon: (<ArrowheadArrowIcon theme={appState.theme} flip={isRTL}/>),\r\n                },\r\n                {\r\n                    value: \"bar\",\r\n                    text: t(\"labels.arrowhead_bar\"),\r\n                    keyBinding: \"e\",\r\n                    icon: <ArrowheadBarIcon theme={appState.theme} flip={isRTL}/>,\r\n                },\r\n                {\r\n                    value: \"dot\",\r\n                    text: t(\"labels.arrowhead_dot\"),\r\n                    keyBinding: \"r\",\r\n                    icon: <ArrowheadDotIcon theme={appState.theme} flip={isRTL}/>,\r\n                },\r\n                {\r\n                    value: \"triangle\",\r\n                    text: t(\"labels.arrowhead_triangle\"),\r\n                    icon: (<ArrowheadTriangleIcon theme={appState.theme} flip={isRTL}/>),\r\n                    keyBinding: \"t\",\r\n                },\r\n            ]} value={getFormValue(elements, appState, (element) => isLinearElement(element) && canHaveArrowheads(element.type)\r\n                ? element.endArrowhead\r\n                : appState.currentItemEndArrowhead, appState.currentItemEndArrowhead)} onChange={(value) => updateData({ position: \"end\", type: value })}/>\r\n        </div>\r\n      </fieldset>);\r\n    },\r\n});\r\n","export var UserIdleState;\r\n(function (UserIdleState) {\r\n    UserIdleState[\"ACTIVE\"] = \"active\";\r\n    UserIdleState[\"AWAY\"] = \"away\";\r\n    UserIdleState[\"IDLE\"] = \"idle\";\r\n})(UserIdleState || (UserIdleState = {}));\r\n","import \"./ToolIcon.scss\";\r\nimport { t } from \"../i18n\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { THEME } from \"../constants\";\r\n// We chose to use only explicit toggle and not a third option for system value,\r\n// but this could be added in the future.\r\nexport const DarkModeToggle = (props) => {\r\n    const title = props.title ||\r\n        (props.value === \"dark\" ? t(\"buttons.lightMode\") : t(\"buttons.darkMode\"));\r\n    return (<ToolButton type=\"icon\" icon={props.value === THEME.LIGHT ? ICONS.MOON : ICONS.SUN} title={title} aria-label={title} onClick={() => props.onChange(props.value === THEME.DARK ? THEME.LIGHT : THEME.DARK)} data-testid=\"toggle-dark-mode\"/>);\r\n};\r\nconst ICONS = {\r\n    SUN: (<svg width=\"512\" height=\"512\" className=\"rtl-mirror\" viewBox=\"0 0 512 512\">\r\n      <path fill=\"currentColor\" d=\"M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z\"></path>\r\n    </svg>),\r\n    MOON: (<svg width=\"512\" height=\"512\" className=\"rtl-mirror\" viewBox=\"0 0 512 512\">\r\n      <path fill=\"currentColor\" d=\"M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z\"></path>\r\n    </svg>),\r\n};\r\n","import \"./Tooltip.scss\";\r\nimport React, { useEffect } from \"react\";\r\nconst getTooltipDiv = () => {\r\n    const existingDiv = document.querySelector(\".excalidraw-tooltip\");\r\n    if (existingDiv) {\r\n        return existingDiv;\r\n    }\r\n    const div = document.createElement(\"div\");\r\n    document.body.appendChild(div);\r\n    div.classList.add(\"excalidraw-tooltip\");\r\n    return div;\r\n};\r\nconst updateTooltip = (item, tooltip, label, long) => {\r\n    tooltip.classList.add(\"excalidraw-tooltip--visible\");\r\n    tooltip.style.minWidth = long ? \"50ch\" : \"10ch\";\r\n    tooltip.style.maxWidth = long ? \"50ch\" : \"15ch\";\r\n    tooltip.textContent = label;\r\n    const { x: itemX, bottom: itemBottom, top: itemTop, width: itemWidth, } = item.getBoundingClientRect();\r\n    const { width: labelWidth, height: labelHeight } = tooltip.getBoundingClientRect();\r\n    const viewportWidth = window.innerWidth;\r\n    const viewportHeight = window.innerHeight;\r\n    const margin = 5;\r\n    const left = itemX + itemWidth / 2 - labelWidth / 2;\r\n    const offsetLeft = left + labelWidth >= viewportWidth ? left + labelWidth - viewportWidth : 0;\r\n    const top = itemBottom + margin;\r\n    const offsetTop = top + labelHeight >= viewportHeight\r\n        ? itemBottom - itemTop + labelHeight + margin * 2\r\n        : 0;\r\n    Object.assign(tooltip.style, {\r\n        top: `${top - offsetTop}px`,\r\n        left: `${left - offsetLeft}px`,\r\n    });\r\n};\r\nexport const Tooltip = ({ children, label, long = false }) => {\r\n    useEffect(() => {\r\n        return () => getTooltipDiv().classList.remove(\"excalidraw-tooltip--visible\");\r\n    }, []);\r\n    return (<div className=\"excalidraw-tooltip-wrapper\" onPointerEnter={(event) => updateTooltip(event.currentTarget, getTooltipDiv(), label, long)} onPointerLeave={() => getTooltipDiv().classList.remove(\"excalidraw-tooltip--visible\")}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import { useState } from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"./App\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { trash } from \"./icons\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport \"./ClearCanvas.scss\";\r\nconst ClearCanvas = ({ onConfirm }) => {\r\n    const [showDialog, setShowDialog] = useState(false);\r\n    const toggleDialog = () => {\r\n        setShowDialog(!showDialog);\r\n    };\r\n    return (<>\r\n      <ToolButton type=\"button\" icon={trash} title={t(\"buttons.clearReset\")} aria-label={t(\"buttons.clearReset\")} showAriaLabel={useIsMobile()} onClick={toggleDialog} data-testid=\"clear-canvas-button\"/>\r\n\r\n      {showDialog && (<Dialog onCloseRequest={toggleDialog} title={t(\"clearCanvasDialog.title\")} className=\"clear-canvas\" small={true}>\r\n          <>\r\n            <p className=\"clear-canvas__content\"> {t(\"alerts.clearReset\")}</p>\r\n            <div className=\"clear-canvas-buttons\">\r\n              <ToolButton type=\"button\" title={t(\"buttons.clear\")} aria-label={t(\"buttons.clear\")} label={t(\"buttons.clear\")} onClick={() => {\r\n                onConfirm();\r\n                toggleDialog();\r\n            }} data-testid=\"confirm-clear-canvas-button\" className=\"clear-canvas--confirm\"/>\r\n              <ToolButton type=\"button\" title={t(\"buttons.cancel\")} aria-label={t(\"buttons.cancel\")} label={t(\"buttons.cancel\")} onClick={toggleDialog} data-testid=\"cancel-clear-canvas-button\" className=\"clear-canvas--cancel\"/>\r\n            </div>\r\n          </>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\nexport default ClearCanvas;\r\n","import { ColorPicker } from \"../components/ColorPicker\";\r\nimport { zoomIn, zoomOut } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { DarkModeToggle } from \"../components/DarkModeToggle\";\r\nimport { THEME, ZOOM_STEP } from \"../constants\";\r\nimport { getCommonBounds, getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nimport { getNormalizedZoom, getSelectedElements } from \"../scene\";\r\nimport { centerScrollOn } from \"../scene/scroll\";\r\nimport { getNewZoom } from \"../scene/zoom\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nimport { Tooltip } from \"../components/Tooltip\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport ClearCanvas from \"../components/ClearCanvas\";\r\nexport const actionChangeViewBackgroundColor = register({\r\n    name: \"changeViewBackgroundColor\",\r\n    perform: (_, appState, value) => {\r\n        return {\r\n            appState: { ...appState, ...value },\r\n            commitToHistory: !!value.viewBackgroundColor,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => {\r\n        return (<div style={{ position: \"relative\" }}>\r\n        <ColorPicker label={t(\"labels.canvasBackground\")} type=\"canvasBackground\" color={appState.viewBackgroundColor} onChange={(color) => updateData({ viewBackgroundColor: color })} isActive={appState.openPopup === \"canvasColorPicker\"} setActive={(active) => updateData({ openPopup: active ? \"canvasColorPicker\" : null })} data-testid=\"canvas-background-picker\"/>\r\n      </div>);\r\n    },\r\n});\r\nexport const actionClearCanvas = register({\r\n    name: \"clearCanvas\",\r\n    perform: (elements, appState, _, app) => {\r\n        app.imageCache.clear();\r\n        return {\r\n            elements: elements.map((element) => newElementWith(element, { isDeleted: true })),\r\n            appState: {\r\n                ...getDefaultAppState(),\r\n                files: {},\r\n                theme: appState.theme,\r\n                elementLocked: appState.elementLocked,\r\n                exportBackground: appState.exportBackground,\r\n                exportEmbedScene: appState.exportEmbedScene,\r\n                gridSize: appState.gridSize,\r\n                showStats: appState.showStats,\r\n                pasteDialog: appState.pasteDialog,\r\n            },\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => <ClearCanvas onConfirm={updateData}/>,\r\n});\r\nexport const actionZoomIn = register({\r\n    name: \"zoomIn\",\r\n    perform: (_elements, appState) => {\r\n        const zoom = getNewZoom(getNormalizedZoom(appState.zoom.value + ZOOM_STEP), appState.zoom, { left: appState.offsetLeft, top: appState.offsetTop }, { x: appState.width / 2, y: appState.height / 2 });\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zoom,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => (<ToolButton type=\"button\" icon={zoomIn} title={`${t(\"buttons.zoomIn\")} — ${getShortcutKey(\"CtrlOrCmd++\")}`} aria-label={t(\"buttons.zoomIn\")} onClick={() => {\r\n            updateData(null);\r\n        }} size=\"small\"/>),\r\n    keyTest: (event) => (event.code === CODES.EQUAL || event.code === CODES.NUM_ADD) &&\r\n        (event[KEYS.CTRL_OR_CMD] || event.shiftKey),\r\n});\r\nexport const actionZoomOut = register({\r\n    name: \"zoomOut\",\r\n    perform: (_elements, appState) => {\r\n        const zoom = getNewZoom(getNormalizedZoom(appState.zoom.value - ZOOM_STEP), appState.zoom, { left: appState.offsetLeft, top: appState.offsetTop }, { x: appState.width / 2, y: appState.height / 2 });\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zoom,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => (<ToolButton type=\"button\" icon={zoomOut} title={`${t(\"buttons.zoomOut\")} — ${getShortcutKey(\"CtrlOrCmd+-\")}`} aria-label={t(\"buttons.zoomOut\")} onClick={() => {\r\n            updateData(null);\r\n        }} size=\"small\"/>),\r\n    keyTest: (event) => (event.code === CODES.MINUS || event.code === CODES.NUM_SUBTRACT) &&\r\n        (event[KEYS.CTRL_OR_CMD] || event.shiftKey),\r\n});\r\nexport const actionResetZoom = register({\r\n    name: \"resetZoom\",\r\n    perform: (_elements, appState) => {\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zoom: getNewZoom(1, appState.zoom, { left: appState.offsetLeft, top: appState.offsetTop }, {\r\n                    x: appState.width / 2,\r\n                    y: appState.height / 2,\r\n                }),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData, appState }) => (<Tooltip label={t(\"buttons.resetZoom\")}>\r\n      <ToolButton type=\"button\" className=\"reset-zoom-button\" title={t(\"buttons.resetZoom\")} aria-label={t(\"buttons.resetZoom\")} onClick={() => {\r\n            updateData(null);\r\n        }} size=\"small\">\r\n        {(appState.zoom.value * 100).toFixed(0)}%\r\n      </ToolButton>\r\n    </Tooltip>),\r\n    keyTest: (event) => (event.code === CODES.ZERO || event.code === CODES.NUM_ZERO) &&\r\n        (event[KEYS.CTRL_OR_CMD] || event.shiftKey),\r\n});\r\nconst zoomValueToFitBoundsOnViewport = (bounds, viewportDimensions) => {\r\n    const [x1, y1, x2, y2] = bounds;\r\n    const commonBoundsWidth = x2 - x1;\r\n    const zoomValueForWidth = viewportDimensions.width / commonBoundsWidth;\r\n    const commonBoundsHeight = y2 - y1;\r\n    const zoomValueForHeight = viewportDimensions.height / commonBoundsHeight;\r\n    const smallestZoomValue = Math.min(zoomValueForWidth, zoomValueForHeight);\r\n    const zoomAdjustedToSteps = Math.floor(smallestZoomValue / ZOOM_STEP) * ZOOM_STEP;\r\n    const clampedZoomValueToFitElements = Math.min(Math.max(zoomAdjustedToSteps, ZOOM_STEP), 1);\r\n    return clampedZoomValueToFitElements;\r\n};\r\nconst zoomToFitElements = (elements, appState, zoomToSelection) => {\r\n    const nonDeletedElements = getNonDeletedElements(elements);\r\n    const selectedElements = getSelectedElements(nonDeletedElements, appState);\r\n    const commonBounds = zoomToSelection && selectedElements.length > 0\r\n        ? getCommonBounds(selectedElements)\r\n        : getCommonBounds(nonDeletedElements);\r\n    const zoomValue = zoomValueToFitBoundsOnViewport(commonBounds, {\r\n        width: appState.width,\r\n        height: appState.height,\r\n    });\r\n    const newZoom = getNewZoom(zoomValue, appState.zoom, {\r\n        left: appState.offsetLeft,\r\n        top: appState.offsetTop,\r\n    });\r\n    const [x1, y1, x2, y2] = commonBounds;\r\n    const centerX = (x1 + x2) / 2;\r\n    const centerY = (y1 + y2) / 2;\r\n    return {\r\n        appState: {\r\n            ...appState,\r\n            ...centerScrollOn({\r\n                scenePoint: { x: centerX, y: centerY },\r\n                viewportDimensions: {\r\n                    width: appState.width,\r\n                    height: appState.height,\r\n                },\r\n                zoom: newZoom,\r\n            }),\r\n            zoom: newZoom,\r\n        },\r\n        commitToHistory: false,\r\n    };\r\n};\r\nexport const actionZoomToSelected = register({\r\n    name: \"zoomToSelection\",\r\n    perform: (elements, appState) => zoomToFitElements(elements, appState, true),\r\n    keyTest: (event) => event.code === CODES.TWO &&\r\n        event.shiftKey &&\r\n        !event.altKey &&\r\n        !event[KEYS.CTRL_OR_CMD],\r\n});\r\nexport const actionZoomToFit = register({\r\n    name: \"zoomToFit\",\r\n    perform: (elements, appState) => zoomToFitElements(elements, appState, false),\r\n    keyTest: (event) => event.code === CODES.ONE &&\r\n        event.shiftKey &&\r\n        !event.altKey &&\r\n        !event[KEYS.CTRL_OR_CMD],\r\n});\r\nexport const actionToggleTheme = register({\r\n    name: \"toggleTheme\",\r\n    perform: (_, appState, value) => {\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                theme: value || (appState.theme === THEME.LIGHT ? THEME.DARK : THEME.LIGHT),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<div style={{ marginInlineStart: \"0.25rem\" }}>\r\n      <DarkModeToggle value={appState.theme} onChange={(theme) => {\r\n            updateData(theme);\r\n        }}/>\r\n    </div>),\r\n    keyTest: (event) => event.altKey && event.shiftKey && event.code === CODES.D,\r\n});\r\n","import { KEYS } from \"../keys\";\r\nimport { isInvisiblySmallElement } from \"../element\";\r\nimport { resetCursor } from \"../utils\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { done } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport { register } from \"./register\";\r\nimport { mutateElement } from \"../element/mutateElement\";\r\nimport { isPathALoop } from \"../math\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { maybeBindLinearElement, bindOrUnbindLinearElement, } from \"../element/binding\";\r\nimport { isBindingElement } from \"../element/typeChecks\";\r\nexport const actionFinalize = register({\r\n    name: \"finalize\",\r\n    perform: (elements, appState, _, { canvas, focusContainer }) => {\r\n        if (appState.editingLinearElement) {\r\n            const { elementId, startBindingElement, endBindingElement } = appState.editingLinearElement;\r\n            const element = LinearElementEditor.getElement(elementId);\r\n            if (element) {\r\n                if (isBindingElement(element)) {\r\n                    bindOrUnbindLinearElement(element, startBindingElement, endBindingElement);\r\n                }\r\n                return {\r\n                    elements: element.points.length < 2 || isInvisiblySmallElement(element)\r\n                        ? elements.filter((el) => el.id !== element.id)\r\n                        : undefined,\r\n                    appState: {\r\n                        ...appState,\r\n                        editingLinearElement: null,\r\n                    },\r\n                    commitToHistory: true,\r\n                };\r\n            }\r\n        }\r\n        let newElements = elements;\r\n        if (appState.pendingImageElement) {\r\n            mutateElement(appState.pendingImageElement, { isDeleted: true }, false);\r\n        }\r\n        if (window.document.activeElement instanceof HTMLElement) {\r\n            focusContainer();\r\n        }\r\n        const multiPointElement = appState.multiElement\r\n            ? appState.multiElement\r\n            : appState.editingElement?.type === \"freedraw\"\r\n                ? appState.editingElement\r\n                : null;\r\n        if (multiPointElement) {\r\n            // pen and mouse have hover\r\n            if (multiPointElement.type !== \"freedraw\" &&\r\n                appState.lastPointerDownWith !== \"touch\") {\r\n                const { points, lastCommittedPoint } = multiPointElement;\r\n                if (!lastCommittedPoint ||\r\n                    points[points.length - 1] !== lastCommittedPoint) {\r\n                    mutateElement(multiPointElement, {\r\n                        points: multiPointElement.points.slice(0, -1),\r\n                    });\r\n                }\r\n            }\r\n            if (isInvisiblySmallElement(multiPointElement)) {\r\n                newElements = newElements.slice(0, -1);\r\n            }\r\n            // If the multi point line closes the loop,\r\n            // set the last point to first point.\r\n            // This ensures that loop remains closed at different scales.\r\n            const isLoop = isPathALoop(multiPointElement.points, appState.zoom.value);\r\n            if (multiPointElement.type === \"line\" ||\r\n                multiPointElement.type === \"freedraw\") {\r\n                if (isLoop) {\r\n                    const linePoints = multiPointElement.points;\r\n                    const firstPoint = linePoints[0];\r\n                    mutateElement(multiPointElement, {\r\n                        points: linePoints.map((point, index) => index === linePoints.length - 1\r\n                            ? [firstPoint[0], firstPoint[1]]\r\n                            : point),\r\n                    });\r\n                }\r\n            }\r\n            if (isBindingElement(multiPointElement) &&\r\n                !isLoop &&\r\n                multiPointElement.points.length > 1) {\r\n                const [x, y] = LinearElementEditor.getPointAtIndexGlobalCoordinates(multiPointElement, -1);\r\n                maybeBindLinearElement(multiPointElement, appState, Scene.getScene(multiPointElement), { x, y });\r\n            }\r\n            if (!appState.elementLocked && appState.elementType !== \"freedraw\") {\r\n                appState.selectedElementIds[multiPointElement.id] = true;\r\n            }\r\n        }\r\n        if ((!appState.elementLocked && appState.elementType !== \"freedraw\") ||\r\n            !multiPointElement) {\r\n            resetCursor(canvas);\r\n        }\r\n        return {\r\n            elements: newElements,\r\n            appState: {\r\n                ...appState,\r\n                elementType: (appState.elementLocked || appState.elementType === \"freedraw\") &&\r\n                    multiPointElement\r\n                    ? appState.elementType\r\n                    : \"selection\",\r\n                draggingElement: null,\r\n                multiElement: null,\r\n                editingElement: null,\r\n                startBoundElement: null,\r\n                suggestedBindings: [],\r\n                selectedElementIds: multiPointElement &&\r\n                    !appState.elementLocked &&\r\n                    appState.elementType !== \"freedraw\"\r\n                    ? {\r\n                        ...appState.selectedElementIds,\r\n                        [multiPointElement.id]: true,\r\n                    }\r\n                    : appState.selectedElementIds,\r\n                pendingImageElement: null,\r\n            },\r\n            commitToHistory: appState.elementType === \"freedraw\",\r\n        };\r\n    },\r\n    keyTest: (event, appState) => (event.key === KEYS.ESCAPE &&\r\n        (appState.editingLinearElement !== null ||\r\n            (!appState.draggingElement && appState.multiElement === null))) ||\r\n        ((event.key === KEYS.ESCAPE || event.key === KEYS.ENTER) &&\r\n            appState.multiElement !== null),\r\n    PanelComponent: ({ appState, updateData }) => (<ToolButton type=\"button\" icon={done} title={t(\"buttons.done\")} aria-label={t(\"buttons.done\")} onClick={updateData} visible={appState.multiElement != null}/>),\r\n});\r\n","import \"./TextInput.scss\";\r\nimport React, { useState } from \"react\";\r\nimport { focusNearestParent } from \"../utils\";\r\nimport \"./ProjectName.scss\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nexport const ProjectName = (props) => {\r\n    const { id } = useExcalidrawContainer();\r\n    const [fileName, setFileName] = useState(props.value);\r\n    const handleBlur = (event) => {\r\n        focusNearestParent(event.target);\r\n        const value = event.target.value;\r\n        if (value !== props.value) {\r\n            props.onChange(value);\r\n        }\r\n    };\r\n    const handleKeyDown = (event) => {\r\n        if (event.key === \"Enter\") {\r\n            event.preventDefault();\r\n            if (event.nativeEvent.isComposing || event.keyCode === 229) {\r\n                return;\r\n            }\r\n            event.currentTarget.blur();\r\n        }\r\n    };\r\n    return (<div className=\"ProjectName\">\r\n      <label className=\"ProjectName-label\" htmlFor=\"filename\">\r\n        {`${props.label}${props.isNameEditable ? \"\" : \":\"}`}\r\n      </label>\r\n      {props.isNameEditable ? (<input className=\"TextInput\" onBlur={handleBlur} onKeyDown={handleKeyDown} id={`${id}-filename`} value={fileName} onChange={(event) => setFileName(event.target.value)}/>) : (<span className=\"TextInput TextInput--readonly\" id={`${id}-filename`}>\r\n          {props.value}\r\n        </span>)}\r\n    </div>);\r\n};\r\n","/**\r\n * https://stackoverflow.com/a/3368118\r\n * Draws a rounded rectangle using the current state of the canvas.\r\n * @param {CanvasRenderingContext2D} context\r\n * @param {Number} x The top left x coordinate\r\n * @param {Number} y The top left y coordinate\r\n * @param {Number} width The width of the rectangle\r\n * @param {Number} height The height of the rectangle\r\n * @param {Number} radius The corner radius\r\n */\r\nexport const roundRect = (context, x, y, width, height, radius) => {\r\n    context.beginPath();\r\n    context.moveTo(x + radius, y);\r\n    context.lineTo(x + width - radius, y);\r\n    context.quadraticCurveTo(x + width, y, x + width, y + radius);\r\n    context.lineTo(x + width, y + height - radius);\r\n    context.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);\r\n    context.lineTo(x + radius, y + height);\r\n    context.quadraticCurveTo(x, y + height, x, y + height - radius);\r\n    context.lineTo(x, y + radius);\r\n    context.quadraticCurveTo(x, y, x + radius, y);\r\n    context.closePath();\r\n    context.fill();\r\n    context.stroke();\r\n};\r\n","import colors from \"./colors\";\r\nexport const getClientColors = (clientId, appState) => {\r\n    if (appState?.collaborators) {\r\n        const currentUser = appState.collaborators.get(clientId);\r\n        if (currentUser?.color) {\r\n            return currentUser.color;\r\n        }\r\n    }\r\n    // Naive way of getting an integer out of the clientId\r\n    const sum = clientId.split(\"\").reduce((a, str) => a + str.charCodeAt(0), 0);\r\n    // Skip transparent background.\r\n    const backgrounds = colors.elementBackground.slice(1);\r\n    const strokes = colors.elementStroke.slice(1);\r\n    return {\r\n        background: backgrounds[sum % backgrounds.length],\r\n        stroke: strokes[sum % strokes.length],\r\n    };\r\n};\r\nexport const getClientInitials = (username) => {\r\n    if (!username) {\r\n        return \"?\";\r\n    }\r\n    const names = username.trim().split(\" \");\r\n    if (names.length < 2) {\r\n        return names[0].substring(0, 2).toUpperCase();\r\n    }\r\n    const firstName = names[0];\r\n    const lastName = names[names.length - 1];\r\n    return (firstName[0] + lastName[0]).toUpperCase();\r\n};\r\n","import oc from \"open-color\";\r\nimport { getElementAbsoluteCoords, OMIT_SIDES_FOR_MULTIPLE_ELEMENTS, getTransformHandlesFromCoords, getTransformHandles, getElementBounds, getCommonBounds, } from \"../element\";\r\nimport { roundRect } from \"./roundRect\";\r\nimport { getScrollBars, SCROLLBAR_COLOR, SCROLLBAR_WIDTH, } from \"../scene/scrollbars\";\r\nimport { getSelectedElements } from \"../scene/selection\";\r\nimport { renderElement, renderElementToSvg } from \"./renderElement\";\r\nimport { getClientColors } from \"../clients\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { isSelectedViaGroup, getSelectedGroupIds, getElementsInGroup, } from \"../groups\";\r\nimport { maxBindingGap } from \"../element/collision\";\r\nimport { isBindingEnabled, } from \"../element/binding\";\r\nimport { viewportCoordsToSceneCoords, supportsEmoji } from \"../utils\";\r\nimport { UserIdleState } from \"../types\";\r\nimport { THEME_FILTER } from \"../constants\";\r\nconst hasEmojiSupport = supportsEmoji();\r\nconst strokeRectWithRotation = (context, x, y, width, height, cx, cy, angle, fill = false) => {\r\n    context.save();\r\n    context.translate(cx, cy);\r\n    context.rotate(angle);\r\n    if (fill) {\r\n        context.fillRect(x - cx, y - cy, width, height);\r\n    }\r\n    context.strokeRect(x - cx, y - cy, width, height);\r\n    context.restore();\r\n};\r\nconst strokeDiamondWithRotation = (context, width, height, cx, cy, angle) => {\r\n    context.save();\r\n    context.translate(cx, cy);\r\n    context.rotate(angle);\r\n    context.beginPath();\r\n    context.moveTo(0, height / 2);\r\n    context.lineTo(width / 2, 0);\r\n    context.lineTo(0, -height / 2);\r\n    context.lineTo(-width / 2, 0);\r\n    context.closePath();\r\n    context.stroke();\r\n    context.restore();\r\n};\r\nconst strokeEllipseWithRotation = (context, width, height, cx, cy, angle) => {\r\n    context.beginPath();\r\n    context.ellipse(cx, cy, width / 2, height / 2, angle, 0, Math.PI * 2);\r\n    context.stroke();\r\n};\r\nconst fillCircle = (context, cx, cy, radius) => {\r\n    context.beginPath();\r\n    context.arc(cx, cy, radius, 0, Math.PI * 2);\r\n    context.fill();\r\n    context.stroke();\r\n};\r\nconst strokeGrid = (context, gridSize, offsetX, offsetY, width, height) => {\r\n    context.save();\r\n    context.strokeStyle = \"rgba(0,0,0,0.1)\";\r\n    context.beginPath();\r\n    for (let x = offsetX; x < offsetX + width + gridSize * 2; x += gridSize) {\r\n        context.moveTo(x, offsetY - gridSize);\r\n        context.lineTo(x, offsetY + height + gridSize * 2);\r\n    }\r\n    for (let y = offsetY; y < offsetY + height + gridSize * 2; y += gridSize) {\r\n        context.moveTo(offsetX - gridSize, y);\r\n        context.lineTo(offsetX + width + gridSize * 2, y);\r\n    }\r\n    context.stroke();\r\n    context.restore();\r\n};\r\nconst renderLinearPointHandles = (context, appState, sceneState, element) => {\r\n    context.save();\r\n    context.translate(sceneState.scrollX, sceneState.scrollY);\r\n    context.lineWidth = 1 / sceneState.zoom.value;\r\n    LinearElementEditor.getPointsGlobalCoordinates(element).forEach((point, idx) => {\r\n        context.strokeStyle = \"red\";\r\n        context.setLineDash([]);\r\n        context.fillStyle =\r\n            appState.editingLinearElement?.activePointIndex === idx\r\n                ? \"rgba(255, 127, 127, 0.9)\"\r\n                : \"rgba(255, 255, 255, 0.9)\";\r\n        const { POINT_HANDLE_SIZE } = LinearElementEditor;\r\n        fillCircle(context, point[0], point[1], POINT_HANDLE_SIZE / 2 / sceneState.zoom.value);\r\n    });\r\n    context.restore();\r\n};\r\nexport const renderScene = (elements, appState, selectionElement, scale, rc, canvas, sceneState, \r\n// extra options passed to the renderer\r\n{ renderScrollbars = true, renderSelection = true, \r\n// Whether to employ render optimizations to improve performance.\r\n// Should not be turned on for export operations and similar, because it\r\n// doesn't guarantee pixel-perfect output.\r\nrenderOptimizations = false, renderGrid = true, \r\n/** when exporting the behavior is slightly different (e.g. we can't use\r\n    CSS filters) */\r\nisExport = false, } = {}) => {\r\n    if (canvas === null) {\r\n        return { atLeastOneVisibleElement: false };\r\n    }\r\n    const context = canvas.getContext(\"2d\");\r\n    context.setTransform(1, 0, 0, 1, 0, 0);\r\n    context.save();\r\n    context.scale(scale, scale);\r\n    // When doing calculations based on canvas width we should used normalized one\r\n    const normalizedCanvasWidth = canvas.width / scale;\r\n    const normalizedCanvasHeight = canvas.height / scale;\r\n    if (isExport && sceneState.theme === \"dark\") {\r\n        context.filter = THEME_FILTER;\r\n    }\r\n    // Paint background\r\n    if (typeof sceneState.viewBackgroundColor === \"string\") {\r\n        const hasTransparence = sceneState.viewBackgroundColor === \"transparent\" ||\r\n            sceneState.viewBackgroundColor.length === 5 || // #RGBA\r\n            sceneState.viewBackgroundColor.length === 9 || // #RRGGBBA\r\n            /(hsla|rgba)\\(/.test(sceneState.viewBackgroundColor);\r\n        if (hasTransparence) {\r\n            context.clearRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\r\n        }\r\n        context.save();\r\n        context.fillStyle = sceneState.viewBackgroundColor;\r\n        context.fillRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\r\n        context.restore();\r\n    }\r\n    else {\r\n        context.clearRect(0, 0, normalizedCanvasWidth, normalizedCanvasHeight);\r\n    }\r\n    // Apply zoom\r\n    const zoomTranslationX = sceneState.zoom.translation.x;\r\n    const zoomTranslationY = sceneState.zoom.translation.y;\r\n    context.save();\r\n    context.translate(zoomTranslationX, zoomTranslationY);\r\n    context.scale(sceneState.zoom.value, sceneState.zoom.value);\r\n    // Grid\r\n    if (renderGrid && appState.gridSize) {\r\n        strokeGrid(context, appState.gridSize, -Math.ceil(zoomTranslationX / sceneState.zoom.value / appState.gridSize) *\r\n            appState.gridSize +\r\n            (sceneState.scrollX % appState.gridSize), -Math.ceil(zoomTranslationY / sceneState.zoom.value / appState.gridSize) *\r\n            appState.gridSize +\r\n            (sceneState.scrollY % appState.gridSize), normalizedCanvasWidth / sceneState.zoom.value, normalizedCanvasHeight / sceneState.zoom.value);\r\n    }\r\n    // Paint visible elements\r\n    const visibleElements = elements.filter((element) => isVisibleElement(element, normalizedCanvasWidth, normalizedCanvasHeight, {\r\n        zoom: sceneState.zoom,\r\n        offsetLeft: appState.offsetLeft,\r\n        offsetTop: appState.offsetTop,\r\n        scrollX: sceneState.scrollX,\r\n        scrollY: sceneState.scrollY,\r\n    }));\r\n    visibleElements.forEach((element) => {\r\n        try {\r\n            renderElement(element, rc, context, renderOptimizations, sceneState);\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n    });\r\n    if (appState.editingLinearElement) {\r\n        const element = LinearElementEditor.getElement(appState.editingLinearElement.elementId);\r\n        if (element) {\r\n            renderLinearPointHandles(context, appState, sceneState, element);\r\n        }\r\n    }\r\n    // Paint selection element\r\n    if (selectionElement) {\r\n        try {\r\n            renderElement(selectionElement, rc, context, renderOptimizations, sceneState);\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n    }\r\n    if (isBindingEnabled(appState)) {\r\n        appState.suggestedBindings\r\n            .filter((binding) => binding != null)\r\n            .forEach((suggestedBinding) => {\r\n            renderBindingHighlight(context, sceneState, suggestedBinding);\r\n        });\r\n    }\r\n    // Paint selected elements\r\n    if (renderSelection &&\r\n        !appState.multiElement &&\r\n        !appState.editingLinearElement) {\r\n        const selections = elements.reduce((acc, element) => {\r\n            const selectionColors = [];\r\n            // local user\r\n            if (appState.selectedElementIds[element.id] &&\r\n                !isSelectedViaGroup(appState, element)) {\r\n                selectionColors.push(oc.black);\r\n            }\r\n            // remote users\r\n            if (sceneState.remoteSelectedElementIds[element.id]) {\r\n                selectionColors.push(...sceneState.remoteSelectedElementIds[element.id].map((socketId) => {\r\n                    const { background } = getClientColors(socketId, appState);\r\n                    return background;\r\n                }));\r\n            }\r\n            if (selectionColors.length) {\r\n                const [elementX1, elementY1, elementX2, elementY2] = getElementAbsoluteCoords(element);\r\n                acc.push({\r\n                    angle: element.angle,\r\n                    elementX1,\r\n                    elementY1,\r\n                    elementX2,\r\n                    elementY2,\r\n                    selectionColors,\r\n                });\r\n            }\r\n            return acc;\r\n        }, []);\r\n        const addSelectionForGroupId = (groupId) => {\r\n            const groupElements = getElementsInGroup(elements, groupId);\r\n            const [elementX1, elementY1, elementX2, elementY2] = getCommonBounds(groupElements);\r\n            selections.push({\r\n                angle: 0,\r\n                elementX1,\r\n                elementX2,\r\n                elementY1,\r\n                elementY2,\r\n                selectionColors: [oc.black],\r\n            });\r\n        };\r\n        for (const groupId of getSelectedGroupIds(appState)) {\r\n            // TODO: support multiplayer selected group IDs\r\n            addSelectionForGroupId(groupId);\r\n        }\r\n        if (appState.editingGroupId) {\r\n            addSelectionForGroupId(appState.editingGroupId);\r\n        }\r\n        selections.forEach((selection) => renderSelectionBorder(context, sceneState, selection));\r\n        const locallySelectedElements = getSelectedElements(elements, appState);\r\n        // Paint resize transformHandles\r\n        context.save();\r\n        context.translate(sceneState.scrollX, sceneState.scrollY);\r\n        if (locallySelectedElements.length === 1) {\r\n            context.fillStyle = oc.white;\r\n            const transformHandles = getTransformHandles(locallySelectedElements[0], sceneState.zoom, \"mouse\");\r\n            if (!appState.viewModeEnabled) {\r\n                renderTransformHandles(context, sceneState, transformHandles, locallySelectedElements[0].angle);\r\n            }\r\n        }\r\n        else if (locallySelectedElements.length > 1 && !appState.isRotating) {\r\n            const dashedLinePadding = 4 / sceneState.zoom.value;\r\n            context.fillStyle = oc.white;\r\n            const [x1, y1, x2, y2] = getCommonBounds(locallySelectedElements);\r\n            const initialLineDash = context.getLineDash();\r\n            context.setLineDash([2 / sceneState.zoom.value]);\r\n            const lineWidth = context.lineWidth;\r\n            context.lineWidth = 1 / sceneState.zoom.value;\r\n            strokeRectWithRotation(context, x1 - dashedLinePadding, y1 - dashedLinePadding, x2 - x1 + dashedLinePadding * 2, y2 - y1 + dashedLinePadding * 2, (x1 + x2) / 2, (y1 + y2) / 2, 0);\r\n            context.lineWidth = lineWidth;\r\n            context.setLineDash(initialLineDash);\r\n            const transformHandles = getTransformHandlesFromCoords([x1, y1, x2, y2], 0, sceneState.zoom, \"mouse\", OMIT_SIDES_FOR_MULTIPLE_ELEMENTS);\r\n            renderTransformHandles(context, sceneState, transformHandles, 0);\r\n        }\r\n        context.restore();\r\n    }\r\n    // Reset zoom\r\n    context.restore();\r\n    // Paint remote pointers\r\n    for (const clientId in sceneState.remotePointerViewportCoords) {\r\n        let { x, y } = sceneState.remotePointerViewportCoords[clientId];\r\n        x -= appState.offsetLeft;\r\n        y -= appState.offsetTop;\r\n        const width = 9;\r\n        const height = 14;\r\n        const isOutOfBounds = x < 0 ||\r\n            x > normalizedCanvasWidth - width ||\r\n            y < 0 ||\r\n            y > normalizedCanvasHeight - height;\r\n        x = Math.max(x, 0);\r\n        x = Math.min(x, normalizedCanvasWidth - width);\r\n        y = Math.max(y, 0);\r\n        y = Math.min(y, normalizedCanvasHeight - height);\r\n        const { background, stroke } = getClientColors(clientId, appState);\r\n        context.save();\r\n        context.strokeStyle = stroke;\r\n        context.fillStyle = background;\r\n        const userState = sceneState.remotePointerUserStates[clientId];\r\n        if (isOutOfBounds || userState === UserIdleState.AWAY) {\r\n            context.globalAlpha = 0.48;\r\n        }\r\n        if (sceneState.remotePointerButton &&\r\n            sceneState.remotePointerButton[clientId] === \"down\") {\r\n            context.beginPath();\r\n            context.arc(x, y, 15, 0, 2 * Math.PI, false);\r\n            context.lineWidth = 3;\r\n            context.strokeStyle = \"#ffffff88\";\r\n            context.stroke();\r\n            context.closePath();\r\n            context.beginPath();\r\n            context.arc(x, y, 15, 0, 2 * Math.PI, false);\r\n            context.lineWidth = 1;\r\n            context.strokeStyle = stroke;\r\n            context.stroke();\r\n            context.closePath();\r\n        }\r\n        context.beginPath();\r\n        context.moveTo(x, y);\r\n        context.lineTo(x + 1, y + 14);\r\n        context.lineTo(x + 4, y + 9);\r\n        context.lineTo(x + 9, y + 10);\r\n        context.lineTo(x, y);\r\n        context.fill();\r\n        context.stroke();\r\n        const username = sceneState.remotePointerUsernames[clientId];\r\n        let idleState = \"\";\r\n        if (userState === UserIdleState.AWAY) {\r\n            idleState = hasEmojiSupport ? \"⚫️\" : ` (${UserIdleState.AWAY})`;\r\n        }\r\n        else if (userState === UserIdleState.IDLE) {\r\n            idleState = hasEmojiSupport ? \"💤\" : ` (${UserIdleState.IDLE})`;\r\n        }\r\n        else if (userState === UserIdleState.ACTIVE) {\r\n            idleState = hasEmojiSupport ? \"🟢\" : \"\";\r\n        }\r\n        const usernameAndIdleState = `${username ? `${username} ` : \"\"}${idleState}`;\r\n        if (!isOutOfBounds && usernameAndIdleState) {\r\n            const offsetX = x + width;\r\n            const offsetY = y + height;\r\n            const paddingHorizontal = 4;\r\n            const paddingVertical = 4;\r\n            const measure = context.measureText(usernameAndIdleState);\r\n            const measureHeight = measure.actualBoundingBoxDescent + measure.actualBoundingBoxAscent;\r\n            // Border\r\n            context.fillStyle = stroke;\r\n            context.fillRect(offsetX - 1, offsetY - 1, measure.width + 2 * paddingHorizontal + 2, measureHeight + 2 * paddingVertical + 2);\r\n            // Background\r\n            context.fillStyle = background;\r\n            context.fillRect(offsetX, offsetY, measure.width + 2 * paddingHorizontal, measureHeight + 2 * paddingVertical);\r\n            context.fillStyle = oc.white;\r\n            context.fillText(usernameAndIdleState, offsetX + paddingHorizontal, offsetY + paddingVertical + measure.actualBoundingBoxAscent);\r\n        }\r\n        context.restore();\r\n        context.closePath();\r\n    }\r\n    // Paint scrollbars\r\n    let scrollBars;\r\n    if (renderScrollbars) {\r\n        scrollBars = getScrollBars(elements, normalizedCanvasWidth, normalizedCanvasHeight, sceneState);\r\n        context.save();\r\n        context.fillStyle = SCROLLBAR_COLOR;\r\n        context.strokeStyle = \"rgba(255,255,255,0.8)\";\r\n        [scrollBars.horizontal, scrollBars.vertical].forEach((scrollBar) => {\r\n            if (scrollBar) {\r\n                roundRect(context, scrollBar.x, scrollBar.y, scrollBar.width, scrollBar.height, SCROLLBAR_WIDTH / 2);\r\n            }\r\n        });\r\n        context.restore();\r\n    }\r\n    context.restore();\r\n    return { atLeastOneVisibleElement: visibleElements.length > 0, scrollBars };\r\n};\r\nconst renderTransformHandles = (context, sceneState, transformHandles, angle) => {\r\n    Object.keys(transformHandles).forEach((key) => {\r\n        const transformHandle = transformHandles[key];\r\n        if (transformHandle !== undefined) {\r\n            context.save();\r\n            context.lineWidth = 1 / sceneState.zoom.value;\r\n            if (key === \"rotation\") {\r\n                fillCircle(context, transformHandle[0] + transformHandle[2] / 2, transformHandle[1] + transformHandle[3] / 2, transformHandle[2] / 2);\r\n            }\r\n            else {\r\n                strokeRectWithRotation(context, transformHandle[0], transformHandle[1], transformHandle[2], transformHandle[3], transformHandle[0] + transformHandle[2] / 2, transformHandle[1] + transformHandle[3] / 2, angle, true);\r\n            }\r\n            context.restore();\r\n        }\r\n    });\r\n};\r\nconst renderSelectionBorder = (context, sceneState, elementProperties) => {\r\n    const { angle, elementX1, elementY1, elementX2, elementY2, selectionColors } = elementProperties;\r\n    const elementWidth = elementX2 - elementX1;\r\n    const elementHeight = elementY2 - elementY1;\r\n    const dashedLinePadding = 4 / sceneState.zoom.value;\r\n    const dashWidth = 8 / sceneState.zoom.value;\r\n    const spaceWidth = 4 / sceneState.zoom.value;\r\n    context.save();\r\n    context.translate(sceneState.scrollX, sceneState.scrollY);\r\n    context.lineWidth = 1 / sceneState.zoom.value;\r\n    const count = selectionColors.length;\r\n    for (let index = 0; index < count; ++index) {\r\n        context.strokeStyle = selectionColors[index];\r\n        context.setLineDash([\r\n            dashWidth,\r\n            spaceWidth + (dashWidth + spaceWidth) * (count - 1),\r\n        ]);\r\n        context.lineDashOffset = (dashWidth + spaceWidth) * index;\r\n        strokeRectWithRotation(context, elementX1 - dashedLinePadding, elementY1 - dashedLinePadding, elementWidth + dashedLinePadding * 2, elementHeight + dashedLinePadding * 2, elementX1 + elementWidth / 2, elementY1 + elementHeight / 2, angle);\r\n    }\r\n    context.restore();\r\n};\r\nconst renderBindingHighlight = (context, sceneState, suggestedBinding) => {\r\n    const renderHighlight = Array.isArray(suggestedBinding)\r\n        ? renderBindingHighlightForSuggestedPointBinding\r\n        : renderBindingHighlightForBindableElement;\r\n    context.save();\r\n    context.translate(sceneState.scrollX, sceneState.scrollY);\r\n    renderHighlight(context, suggestedBinding);\r\n    context.restore();\r\n};\r\nconst renderBindingHighlightForBindableElement = (context, element) => {\r\n    const [x1, y1, x2, y2] = getElementAbsoluteCoords(element);\r\n    const width = x2 - x1;\r\n    const height = y2 - y1;\r\n    const threshold = maxBindingGap(element, width, height);\r\n    // So that we don't overlap the element itself\r\n    const strokeOffset = 4;\r\n    context.strokeStyle = \"rgba(0,0,0,.05)\";\r\n    context.lineWidth = threshold - strokeOffset;\r\n    const padding = strokeOffset / 2 + threshold / 2;\r\n    switch (element.type) {\r\n        case \"rectangle\":\r\n        case \"text\":\r\n            strokeRectWithRotation(context, x1 - padding, y1 - padding, width + padding * 2, height + padding * 2, x1 + width / 2, y1 + height / 2, element.angle);\r\n            break;\r\n        case \"diamond\":\r\n            const side = Math.hypot(width, height);\r\n            const wPadding = (padding * side) / height;\r\n            const hPadding = (padding * side) / width;\r\n            strokeDiamondWithRotation(context, width + wPadding * 2, height + hPadding * 2, x1 + width / 2, y1 + height / 2, element.angle);\r\n            break;\r\n        case \"ellipse\":\r\n            strokeEllipseWithRotation(context, width + padding * 2, height + padding * 2, x1 + width / 2, y1 + height / 2, element.angle);\r\n            break;\r\n    }\r\n};\r\nconst renderBindingHighlightForSuggestedPointBinding = (context, suggestedBinding) => {\r\n    const [element, startOrEnd, bindableElement] = suggestedBinding;\r\n    const threshold = maxBindingGap(bindableElement, bindableElement.width, bindableElement.height);\r\n    context.strokeStyle = \"rgba(0,0,0,0)\";\r\n    context.fillStyle = \"rgba(0,0,0,.05)\";\r\n    const pointIndices = startOrEnd === \"both\" ? [0, -1] : startOrEnd === \"start\" ? [0] : [-1];\r\n    pointIndices.forEach((index) => {\r\n        const [x, y] = LinearElementEditor.getPointAtIndexGlobalCoordinates(element, index);\r\n        fillCircle(context, x, y, threshold);\r\n    });\r\n};\r\nconst isVisibleElement = (element, canvasWidth, canvasHeight, viewTransformations) => {\r\n    const [x1, y1, x2, y2] = getElementBounds(element); // scene coordinates\r\n    const topLeftSceneCoords = viewportCoordsToSceneCoords({\r\n        clientX: viewTransformations.offsetLeft,\r\n        clientY: viewTransformations.offsetTop,\r\n    }, viewTransformations);\r\n    const bottomRightSceneCoords = viewportCoordsToSceneCoords({\r\n        clientX: viewTransformations.offsetLeft + canvasWidth,\r\n        clientY: viewTransformations.offsetTop + canvasHeight,\r\n    }, viewTransformations);\r\n    return (topLeftSceneCoords.x <= x2 &&\r\n        topLeftSceneCoords.y <= y2 &&\r\n        bottomRightSceneCoords.x >= x1 &&\r\n        bottomRightSceneCoords.y >= y1);\r\n};\r\n// This should be only called for exporting purposes\r\nexport const renderSceneToSvg = (elements, rsvg, svgRoot, files, { offsetX = 0, offsetY = 0, } = {}) => {\r\n    if (!svgRoot) {\r\n        return;\r\n    }\r\n    // render elements\r\n    elements.forEach((element) => {\r\n        if (!element.isDeleted) {\r\n            try {\r\n                renderElementToSvg(element, rsvg, svgRoot, files, element.x + offsetX, element.y + offsetY);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n            }\r\n        }\r\n    });\r\n};\r\n","import { fileOpen as _fileOpen, fileSave as _fileSave, supported as nativeFileSystemSupported, } from \"browser-fs-access\";\r\nimport { EVENT, MIME_TYPES } from \"../constants\";\r\nimport { AbortError } from \"../errors\";\r\nimport { debounce } from \"../utils\";\r\nconst INPUT_CHANGE_INTERVAL_MS = 500;\r\nexport const fileOpen = (opts) => {\r\n    const mimeTypes = opts.extensions?.reduce((mimeTypes, type) => {\r\n        mimeTypes.push(MIME_TYPES[type]);\r\n        return mimeTypes;\r\n    }, []);\r\n    const extensions = opts.extensions?.reduce((acc, ext) => {\r\n        if (ext === \"jpg\") {\r\n            return acc.concat(\".jpg\", \".jpeg\");\r\n        }\r\n        return acc.concat(`.${ext}`);\r\n    }, []);\r\n    return _fileOpen({\r\n        description: opts.description,\r\n        extensions,\r\n        mimeTypes,\r\n        multiple: opts.multiple ?? false,\r\n        legacySetup: (resolve, reject, input) => {\r\n            const scheduleRejection = debounce(reject, INPUT_CHANGE_INTERVAL_MS);\r\n            const focusHandler = () => {\r\n                checkForFile();\r\n                document.addEventListener(EVENT.KEYUP, scheduleRejection);\r\n                document.addEventListener(EVENT.POINTER_UP, scheduleRejection);\r\n                scheduleRejection();\r\n            };\r\n            const checkForFile = () => {\r\n                // this hack might not work when expecting multiple files\r\n                if (input.files?.length) {\r\n                    const ret = opts.multiple ? [...input.files] : input.files[0];\r\n                    resolve(ret);\r\n                }\r\n            };\r\n            requestAnimationFrame(() => {\r\n                window.addEventListener(EVENT.FOCUS, focusHandler);\r\n            });\r\n            const interval = window.setInterval(() => {\r\n                checkForFile();\r\n            }, INPUT_CHANGE_INTERVAL_MS);\r\n            return (rejectPromise) => {\r\n                clearInterval(interval);\r\n                scheduleRejection.cancel();\r\n                window.removeEventListener(EVENT.FOCUS, focusHandler);\r\n                document.removeEventListener(EVENT.KEYUP, scheduleRejection);\r\n                document.removeEventListener(EVENT.POINTER_UP, scheduleRejection);\r\n                if (rejectPromise) {\r\n                    // so that something is shown in console if we need to debug this\r\n                    console.warn(\"Opening the file was canceled (legacy-fs).\");\r\n                    rejectPromise(new AbortError());\r\n                }\r\n            };\r\n        },\r\n    });\r\n};\r\nexport const fileSave = (blob, opts) => {\r\n    return _fileSave(blob, {\r\n        fileName: `${opts.name}.${opts.extension}`,\r\n        description: opts.description,\r\n        extensions: [`.${opts.extension}`],\r\n    }, opts.fileHandle);\r\n};\r\nexport { nativeFileSystemSupported };\r\n","import { getElementMap, getNormalizedDimensions, isInvisiblySmallElement, } from \"../element\";\r\nimport { isLinearElementType } from \"../element/typeChecks\";\r\nimport { randomId } from \"../random\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_TEXT_ALIGN, DEFAULT_VERTICAL_ALIGN, FONT_FAMILY, } from \"../constants\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport { bumpVersion } from \"../element/mutateElement\";\r\nexport const AllowedExcalidrawElementTypes = {\r\n    selection: true,\r\n    text: true,\r\n    rectangle: true,\r\n    diamond: true,\r\n    ellipse: true,\r\n    line: true,\r\n    image: true,\r\n    arrow: true,\r\n    freedraw: true,\r\n};\r\nconst getFontFamilyByName = (fontFamilyName) => {\r\n    if (Object.keys(FONT_FAMILY).includes(fontFamilyName)) {\r\n        return FONT_FAMILY[fontFamilyName];\r\n    }\r\n    return DEFAULT_FONT_FAMILY;\r\n};\r\nconst restoreElementWithProperties = (element, extra) => {\r\n    const base = {\r\n        type: extra.type || element.type,\r\n        // all elements must have version > 0 so getSceneVersion() will pick up\r\n        // newly added elements\r\n        version: element.version || 1,\r\n        versionNonce: element.versionNonce ?? 0,\r\n        isDeleted: element.isDeleted ?? false,\r\n        id: element.id || randomId(),\r\n        fillStyle: element.fillStyle || \"hachure\",\r\n        strokeWidth: element.strokeWidth || 1,\r\n        strokeStyle: element.strokeStyle ?? \"solid\",\r\n        roughness: element.roughness ?? 1,\r\n        opacity: element.opacity == null ? 100 : element.opacity,\r\n        angle: element.angle || 0,\r\n        x: extra.x ?? element.x ?? 0,\r\n        y: extra.y ?? element.y ?? 0,\r\n        strokeColor: element.strokeColor,\r\n        backgroundColor: element.backgroundColor,\r\n        width: element.width || 0,\r\n        height: element.height || 0,\r\n        seed: element.seed ?? 1,\r\n        groupIds: element.groupIds ?? [],\r\n        strokeSharpness: element.strokeSharpness ??\r\n            (isLinearElementType(element.type) ? \"round\" : \"sharp\"),\r\n        boundElementIds: element.boundElementIds ?? [],\r\n    };\r\n    return {\r\n        ...base,\r\n        ...getNormalizedDimensions(base),\r\n        ...extra,\r\n    };\r\n};\r\nconst restoreElement = (element) => {\r\n    switch (element.type) {\r\n        case \"text\":\r\n            let fontSize = element.fontSize;\r\n            let fontFamily = element.fontFamily;\r\n            if (\"font\" in element) {\r\n                const [fontPx, _fontFamily] = element.font.split(\" \");\r\n                fontSize = parseInt(fontPx, 10);\r\n                fontFamily = getFontFamilyByName(_fontFamily);\r\n            }\r\n            return restoreElementWithProperties(element, {\r\n                fontSize,\r\n                fontFamily,\r\n                text: element.text ?? \"\",\r\n                baseline: element.baseline,\r\n                textAlign: element.textAlign || DEFAULT_TEXT_ALIGN,\r\n                verticalAlign: element.verticalAlign || DEFAULT_VERTICAL_ALIGN,\r\n            });\r\n        case \"freedraw\": {\r\n            return restoreElementWithProperties(element, {\r\n                points: element.points,\r\n                lastCommittedPoint: null,\r\n                simulatePressure: element.simulatePressure,\r\n                pressures: element.pressures,\r\n            });\r\n        }\r\n        case \"image\":\r\n            return restoreElementWithProperties(element, {\r\n                status: element.status || \"pending\",\r\n                fileId: element.fileId,\r\n                scale: element.scale || [1, 1],\r\n            });\r\n        case \"line\":\r\n        // @ts-ignore LEGACY type\r\n        // eslint-disable-next-line no-fallthrough\r\n        case \"draw\":\r\n        case \"arrow\": {\r\n            const { startArrowhead = null, endArrowhead = element.type === \"arrow\" ? \"arrow\" : null, } = element;\r\n            let x = element.x;\r\n            let y = element.y;\r\n            let points = // migrate old arrow model to new one\r\n             !Array.isArray(element.points) || element.points.length < 2\r\n                ? [\r\n                    [0, 0],\r\n                    [element.width, element.height],\r\n                ]\r\n                : element.points;\r\n            if (points[0][0] !== 0 || points[0][1] !== 0) {\r\n                ({ points, x, y } = LinearElementEditor.getNormalizedPoints(element));\r\n            }\r\n            return restoreElementWithProperties(element, {\r\n                type: element.type === \"draw\"\r\n                    ? \"line\"\r\n                    : element.type,\r\n                startBinding: element.startBinding,\r\n                endBinding: element.endBinding,\r\n                lastCommittedPoint: null,\r\n                startArrowhead,\r\n                endArrowhead,\r\n                points,\r\n                x,\r\n                y,\r\n            });\r\n        }\r\n        // generic elements\r\n        case \"ellipse\":\r\n            return restoreElementWithProperties(element, {});\r\n        case \"rectangle\":\r\n            return restoreElementWithProperties(element, {});\r\n        case \"diamond\":\r\n            return restoreElementWithProperties(element, {});\r\n        // Don't use default case so as to catch a missing an element type case.\r\n        // We also don't want to throw, but instead return void so we filter\r\n        // out these unsupported elements from the restored array.\r\n    }\r\n};\r\nexport const restoreElements = (elements, \r\n/** NOTE doesn't serve for reconciliation */\r\nlocalElements) => {\r\n    const localElementsMap = localElements ? getElementMap(localElements) : null;\r\n    return (elements || []).reduce((elements, element) => {\r\n        // filtering out selection, which is legacy, no longer kept in elements,\r\n        // and causing issues if retained\r\n        if (element.type !== \"selection\" && !isInvisiblySmallElement(element)) {\r\n            let migratedElement = restoreElement(element);\r\n            if (migratedElement) {\r\n                const localElement = localElementsMap?.[element.id];\r\n                if (localElement && localElement.version > migratedElement.version) {\r\n                    migratedElement = bumpVersion(migratedElement, localElement.version);\r\n                }\r\n                elements.push(migratedElement);\r\n            }\r\n        }\r\n        return elements;\r\n    }, []);\r\n};\r\nexport const restoreAppState = (appState, localAppState) => {\r\n    appState = appState || {};\r\n    const defaultAppState = getDefaultAppState();\r\n    const nextAppState = {};\r\n    for (const [key, defaultValue] of Object.entries(defaultAppState)) {\r\n        const suppliedValue = appState[key];\r\n        const localValue = localAppState ? localAppState[key] : undefined;\r\n        nextAppState[key] =\r\n            suppliedValue !== undefined\r\n                ? suppliedValue\r\n                : localValue !== undefined\r\n                    ? localValue\r\n                    : defaultValue;\r\n    }\r\n    return {\r\n        ...nextAppState,\r\n        elementType: AllowedExcalidrawElementTypes[nextAppState.elementType]\r\n            ? nextAppState.elementType\r\n            : \"selection\",\r\n        // Migrates from previous version where appState.zoom was a number\r\n        zoom: typeof appState.zoom === \"number\"\r\n            ? {\r\n                value: appState.zoom,\r\n                translation: defaultAppState.zoom.translation,\r\n            }\r\n            : appState.zoom || defaultAppState.zoom,\r\n    };\r\n};\r\nexport const restore = (data, \r\n/**\r\n * Local AppState (`this.state` or initial state from localStorage) so that we\r\n * don't overwrite local state with default values (when values not\r\n * explicitly specified).\r\n * Supply `null` if you can't get access to it.\r\n */\r\nlocalAppState, localElements) => {\r\n    return {\r\n        elements: restoreElements(data?.elements, localElements),\r\n        appState: restoreAppState(data?.appState, localAppState || null),\r\n        files: data?.files || {},\r\n    };\r\n};\r\n","import { nanoid } from \"nanoid\";\r\nimport { cleanAppStateForExport } from \"../appState\";\r\nimport { ALLOWED_IMAGE_MIME_TYPES, EXPORT_DATA_TYPES, MIME_TYPES, } from \"../constants\";\r\nimport { clearElementsForExport } from \"../element\";\r\nimport { CanvasError } from \"../errors\";\r\nimport { t } from \"../i18n\";\r\nimport { calculateScrollCenter } from \"../scene\";\r\nimport { isValidExcalidrawData } from \"./json\";\r\nimport { restore } from \"./restore\";\r\nconst parseFileContents = async (blob) => {\r\n    let contents;\r\n    if (blob.type === MIME_TYPES.png) {\r\n        try {\r\n            return await (await import(/* webpackChunkName: \"image\" */ \"./image\")).decodePngMetadata(blob);\r\n        }\r\n        catch (error) {\r\n            if (error.message === \"INVALID\") {\r\n                throw new DOMException(t(\"alerts.imageDoesNotContainScene\"), \"EncodingError\");\r\n            }\r\n            else {\r\n                throw new DOMException(t(\"alerts.cannotRestoreFromImage\"), \"EncodingError\");\r\n            }\r\n        }\r\n    }\r\n    else {\r\n        if (\"text\" in Blob) {\r\n            contents = await blob.text();\r\n        }\r\n        else {\r\n            contents = await new Promise((resolve) => {\r\n                const reader = new FileReader();\r\n                reader.readAsText(blob, \"utf8\");\r\n                reader.onloadend = () => {\r\n                    if (reader.readyState === FileReader.DONE) {\r\n                        resolve(reader.result);\r\n                    }\r\n                };\r\n            });\r\n        }\r\n        if (blob.type === MIME_TYPES.svg) {\r\n            try {\r\n                return await (await import(/* webpackChunkName: \"image\" */ \"./image\")).decodeSvgMetadata({\r\n                    svg: contents,\r\n                });\r\n            }\r\n            catch (error) {\r\n                if (error.message === \"INVALID\") {\r\n                    throw new DOMException(t(\"alerts.imageDoesNotContainScene\"), \"EncodingError\");\r\n                }\r\n                else {\r\n                    throw new DOMException(t(\"alerts.cannotRestoreFromImage\"), \"EncodingError\");\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return contents;\r\n};\r\nexport const getMimeType = (blob) => {\r\n    let name;\r\n    if (typeof blob === \"string\") {\r\n        name = blob;\r\n    }\r\n    else {\r\n        if (blob.type) {\r\n            return blob.type;\r\n        }\r\n        name = blob.name || \"\";\r\n    }\r\n    if (/\\.(excalidraw|json)$/.test(name)) {\r\n        return MIME_TYPES.json;\r\n    }\r\n    else if (/\\.png$/.test(name)) {\r\n        return MIME_TYPES.png;\r\n    }\r\n    else if (/\\.jpe?g$/.test(name)) {\r\n        return MIME_TYPES.jpg;\r\n    }\r\n    else if (/\\.svg$/.test(name)) {\r\n        return MIME_TYPES.svg;\r\n    }\r\n    return \"\";\r\n};\r\nexport const getFileHandleType = (handle) => {\r\n    if (!handle) {\r\n        return null;\r\n    }\r\n    return handle.name.match(/\\.(json|excalidraw|png|svg)$/)?.[1] || null;\r\n};\r\nexport const isImageFileHandleType = (type) => {\r\n    return type === \"png\" || type === \"svg\";\r\n};\r\nexport const isImageFileHandle = (handle) => {\r\n    const type = getFileHandleType(handle);\r\n    return type === \"png\" || type === \"svg\";\r\n};\r\nexport const isSupportedImageFile = (blob) => {\r\n    const { type } = blob || {};\r\n    return (!!type && ALLOWED_IMAGE_MIME_TYPES.includes(type));\r\n};\r\nexport const loadFromBlob = async (blob, \r\n/** @see restore.localAppState */\r\nlocalAppState, localElements) => {\r\n    const contents = await parseFileContents(blob);\r\n    try {\r\n        const data = JSON.parse(contents);\r\n        if (!isValidExcalidrawData(data)) {\r\n            throw new Error(t(\"alerts.couldNotLoadInvalidFile\"));\r\n        }\r\n        const result = restore({\r\n            elements: clearElementsForExport(data.elements || []),\r\n            appState: {\r\n                theme: localAppState?.theme,\r\n                fileHandle: blob.handle || null,\r\n                ...cleanAppStateForExport(data.appState || {}),\r\n                ...(localAppState\r\n                    ? calculateScrollCenter(data.elements || [], localAppState, null)\r\n                    : {}),\r\n            },\r\n            files: data.files,\r\n        }, localAppState, localElements);\r\n        return result;\r\n    }\r\n    catch (error) {\r\n        console.error(error.message);\r\n        throw new Error(t(\"alerts.couldNotLoadInvalidFile\"));\r\n    }\r\n};\r\nexport const loadLibraryFromBlob = async (blob) => {\r\n    const contents = await parseFileContents(blob);\r\n    const data = JSON.parse(contents);\r\n    if (data.type !== EXPORT_DATA_TYPES.excalidrawLibrary) {\r\n        throw new Error(t(\"alerts.couldNotLoadInvalidFile\"));\r\n    }\r\n    return data;\r\n};\r\nexport const canvasToBlob = async (canvas) => {\r\n    return new Promise((resolve, reject) => {\r\n        try {\r\n            canvas.toBlob((blob) => {\r\n                if (!blob) {\r\n                    return reject(new CanvasError(t(\"canvasError.canvasTooBig\"), \"CANVAS_POSSIBLY_TOO_BIG\"));\r\n                }\r\n                resolve(blob);\r\n            });\r\n        }\r\n        catch (error) {\r\n            reject(error);\r\n        }\r\n    });\r\n};\r\n/** generates SHA-1 digest from supplied file (if not supported, falls back\r\n    to a 40-char base64 random id) */\r\nexport const generateIdFromFile = async (file) => {\r\n    let id;\r\n    try {\r\n        const hashBuffer = await window.crypto.subtle.digest(\"SHA-1\", await file.arrayBuffer());\r\n        id =\r\n            // convert buffer to byte array\r\n            Array.from(new Uint8Array(hashBuffer))\r\n                // convert to hex string\r\n                .map((byte) => byte.toString(16).padStart(2, \"0\"))\r\n                .join(\"\");\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        // length 40 to align with the HEX length of SHA-1 (which is 160 bit)\r\n        id = nanoid(40);\r\n    }\r\n    return id;\r\n};\r\nexport const getDataURL = async (file) => {\r\n    return new Promise((resolve, reject) => {\r\n        const reader = new FileReader();\r\n        reader.onload = () => {\r\n            const dataURL = reader.result;\r\n            resolve(dataURL);\r\n        };\r\n        reader.onerror = (error) => reject(error);\r\n        reader.readAsDataURL(file);\r\n    });\r\n};\r\nexport const dataURLToFile = (dataURL, filename = \"\") => {\r\n    const dataIndexStart = dataURL.indexOf(\",\");\r\n    const byteString = atob(dataURL.slice(dataIndexStart + 1));\r\n    const mimeType = dataURL.slice(0, dataIndexStart).split(\":\")[1].split(\";\")[0];\r\n    const ab = new ArrayBuffer(byteString.length);\r\n    const ia = new Uint8Array(ab);\r\n    for (let i = 0; i < byteString.length; i++) {\r\n        ia[i] = byteString.charCodeAt(i);\r\n    }\r\n    return new File([ab], filename, { type: mimeType });\r\n};\r\nexport const resizeImageFile = async (file, maxWidthOrHeight) => {\r\n    // SVG files shouldn't a can't be resized\r\n    if (file.type === MIME_TYPES.svg) {\r\n        return file;\r\n    }\r\n    const [pica, imageBlobReduce] = await Promise.all([\r\n        import(\"pica\").then((res) => res.default),\r\n        // a wrapper for pica for better API\r\n        import(\"image-blob-reduce\").then((res) => res.default),\r\n    ]);\r\n    // CRA's minification settings break pica in WebWorkers, so let's disable\r\n    // them for now\r\n    // https://github.com/nodeca/image-blob-reduce/issues/21#issuecomment-757365513\r\n    const reduce = imageBlobReduce({\r\n        pica: pica({ features: [\"js\", \"wasm\"] }),\r\n    });\r\n    const fileType = file.type;\r\n    if (!isSupportedImageFile(file)) {\r\n        throw new Error(t(\"errors.unsupportedFileType\"));\r\n    }\r\n    return new File([await reduce.toBlob(file, { max: maxWidthOrHeight })], file.name, { type: fileType });\r\n};\r\nexport const SVGStringToFile = (SVGString, filename = \"\") => {\r\n    return new File([new TextEncoder().encode(SVGString)], filename, {\r\n        type: MIME_TYPES.svg,\r\n    });\r\n};\r\n","import { fileOpen, fileSave } from \"./filesystem\";\r\nimport { cleanAppStateForExport, clearAppStateForDatabase } from \"../appState\";\r\nimport { EXPORT_DATA_TYPES, EXPORT_SOURCE, MIME_TYPES } from \"../constants\";\r\nimport { clearElementsForDatabase, clearElementsForExport } from \"../element\";\r\nimport { isImageFileHandle, loadFromBlob } from \"./blob\";\r\n/**\r\n * Strips out files which are only referenced by deleted elements\r\n */\r\nconst filterOutDeletedFiles = (elements, files) => {\r\n    const nextFiles = {};\r\n    for (const element of elements) {\r\n        if (!element.isDeleted &&\r\n            \"fileId\" in element &&\r\n            element.fileId &&\r\n            files[element.fileId]) {\r\n            nextFiles[element.fileId] = files[element.fileId];\r\n        }\r\n    }\r\n    return nextFiles;\r\n};\r\nexport const serializeAsJSON = (elements, appState, files, type) => {\r\n    const data = {\r\n        type: EXPORT_DATA_TYPES.excalidraw,\r\n        version: 2,\r\n        source: EXPORT_SOURCE,\r\n        elements: type === \"local\"\r\n            ? clearElementsForExport(elements)\r\n            : clearElementsForDatabase(elements),\r\n        appState: type === \"local\"\r\n            ? cleanAppStateForExport(appState)\r\n            : clearAppStateForDatabase(appState),\r\n        files: type === \"local\"\r\n            ? filterOutDeletedFiles(elements, files)\r\n            : // will be stripped from JSON\r\n                undefined,\r\n    };\r\n    return JSON.stringify(data, null, 2);\r\n};\r\nexport const saveAsJSON = async (elements, appState, files) => {\r\n    const serialized = serializeAsJSON(elements, appState, files, \"local\");\r\n    const blob = new Blob([serialized], {\r\n        type: MIME_TYPES.excalidraw,\r\n    });\r\n    const fileHandle = await fileSave(blob, {\r\n        name: appState.name,\r\n        extension: \"excalidraw\",\r\n        description: \"Excalidraw file\",\r\n        fileHandle: isImageFileHandle(appState.fileHandle)\r\n            ? null\r\n            : appState.fileHandle,\r\n    });\r\n    return { fileHandle };\r\n};\r\nexport const loadFromJSON = async (localAppState, localElements) => {\r\n    const blob = await fileOpen({\r\n        description: \"Excalidraw files\",\r\n        // ToDo: Be over-permissive until https://bugs.webkit.org/show_bug.cgi?id=34442\r\n        // gets resolved. Else, iOS users cannot open `.excalidraw` files.\r\n        // extensions: [\"json\", \"excalidraw\", \"png\", \"svg\"],\r\n    });\r\n    return loadFromBlob(blob, localAppState, localElements);\r\n};\r\nexport const isValidExcalidrawData = (data) => {\r\n    return (data?.type === EXPORT_DATA_TYPES.excalidraw &&\r\n        (!data.elements ||\r\n            (Array.isArray(data.elements) &&\r\n                (!data.appState || typeof data.appState === \"object\"))));\r\n};\r\nexport const isValidLibrary = (json) => {\r\n    return (typeof json === \"object\" &&\r\n        json &&\r\n        json.type === EXPORT_DATA_TYPES.excalidrawLibrary &&\r\n        json.version === 1);\r\n};\r\nexport const saveLibraryAsJSON = async (library) => {\r\n    const libraryItems = await library.loadLibrary();\r\n    const data = {\r\n        type: EXPORT_DATA_TYPES.excalidrawLibrary,\r\n        version: 1,\r\n        source: EXPORT_SOURCE,\r\n        library: libraryItems,\r\n    };\r\n    const serialized = JSON.stringify(data, null, 2);\r\n    await fileSave(new Blob([serialized], {\r\n        type: MIME_TYPES.excalidrawlib,\r\n    }), {\r\n        name: \"library\",\r\n        extension: \"excalidrawlib\",\r\n        description: \"Excalidraw library file\",\r\n    });\r\n};\r\nexport const importLibraryFromJSON = async (library) => {\r\n    const blob = await fileOpen({\r\n        description: \"Excalidraw library files\",\r\n        // ToDo: Be over-permissive until https://bugs.webkit.org/show_bug.cgi?id=34442\r\n        // gets resolved. Else, iOS users cannot open `.excalidraw` files.\r\n        /*\r\n        extensions: [\".json\", \".excalidrawlib\"],\r\n        */\r\n    });\r\n    await library.importLibrary(blob);\r\n};\r\n","// -----------------------------------------------------------------------------\r\n// ExcalidrawImageElement & related helpers\r\n// -----------------------------------------------------------------------------\r\nimport { MIME_TYPES, SVG_NS } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { isInitializedImageElement } from \"./typeChecks\";\r\nexport const loadHTMLImageElement = (dataURL) => {\r\n    return new Promise((resolve, reject) => {\r\n        const image = new Image();\r\n        image.onload = () => {\r\n            resolve(image);\r\n        };\r\n        image.onerror = (error) => {\r\n            reject(error);\r\n        };\r\n        image.src = dataURL;\r\n    });\r\n};\r\n/** NOTE: updates cache even if already populated with given image. Thus,\r\n * you should filter out the images upstream if you want to optimize this. */\r\nexport const updateImageCache = async ({ fileIds, files, imageCache, }) => {\r\n    const updatedFiles = new Map();\r\n    const erroredFiles = new Map();\r\n    await Promise.all(fileIds.reduce((promises, fileId) => {\r\n        const fileData = files[fileId];\r\n        if (fileData && !updatedFiles.has(fileId)) {\r\n            updatedFiles.set(fileId, true);\r\n            return promises.concat((async () => {\r\n                try {\r\n                    if (fileData.mimeType === MIME_TYPES.binary) {\r\n                        throw new Error(\"Only images can be added to ImageCache\");\r\n                    }\r\n                    const imagePromise = loadHTMLImageElement(fileData.dataURL);\r\n                    const data = {\r\n                        image: imagePromise,\r\n                        mimeType: fileData.mimeType,\r\n                    };\r\n                    // store the promise immediately to indicate there's an in-progress\r\n                    // initialization\r\n                    imageCache.set(fileId, data);\r\n                    const image = await imagePromise;\r\n                    imageCache.set(fileId, { ...data, image });\r\n                }\r\n                catch (error) {\r\n                    erroredFiles.set(fileId, true);\r\n                }\r\n            })());\r\n        }\r\n        return promises;\r\n    }, []));\r\n    return {\r\n        imageCache,\r\n        /** includes errored files because they cache was updated nonetheless */\r\n        updatedFiles,\r\n        /** files that failed when creating HTMLImageElement */\r\n        erroredFiles,\r\n    };\r\n};\r\nexport const getInitializedImageElements = (elements) => elements.filter((element) => isInitializedImageElement(element));\r\nexport const isHTMLSVGElement = (node) => {\r\n    // lower-casing due to XML/HTML convention differences\r\n    // https://johnresig.com/blog/nodename-case-sensitivity\r\n    return node?.nodeName.toLowerCase() === \"svg\";\r\n};\r\nexport const normalizeSVG = async (SVGString) => {\r\n    const doc = new DOMParser().parseFromString(SVGString, MIME_TYPES.svg);\r\n    const svg = doc.querySelector(\"svg\");\r\n    const errorNode = doc.querySelector(\"parsererror\");\r\n    if (errorNode || !isHTMLSVGElement(svg)) {\r\n        throw new Error(t(\"errors.invalidSVGString\"));\r\n    }\r\n    else {\r\n        if (!svg.hasAttribute(\"xmlns\")) {\r\n            svg.setAttribute(\"xmlns\", SVG_NS);\r\n        }\r\n        return svg.outerHTML;\r\n    }\r\n};\r\n","import rough from \"roughjs/bin/rough\";\r\nimport { getCommonBounds } from \"../element/bounds\";\r\nimport { renderScene, renderSceneToSvg } from \"../renderer/renderScene\";\r\nimport { distance } from \"../utils\";\r\nimport { DEFAULT_EXPORT_PADDING, SVG_NS, THEME_FILTER } from \"../constants\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { serializeAsJSON } from \"../data/json\";\r\nimport { getInitializedImageElements, updateImageCache, } from \"../element/image\";\r\nexport const SVG_EXPORT_TAG = `<!-- svg-source:excalidraw -->`;\r\nexport const exportToCanvas = async (elements, appState, files, { exportBackground, exportPadding = DEFAULT_EXPORT_PADDING, viewBackgroundColor, }, createCanvas = (width, height) => {\r\n    const canvas = document.createElement(\"canvas\");\r\n    canvas.width = width * appState.exportScale;\r\n    canvas.height = height * appState.exportScale;\r\n    return { canvas, scale: appState.exportScale };\r\n}) => {\r\n    const [minX, minY, width, height] = getCanvasSize(elements, exportPadding);\r\n    const { canvas, scale = 1 } = createCanvas(width, height);\r\n    const defaultAppState = getDefaultAppState();\r\n    const { imageCache } = await updateImageCache({\r\n        imageCache: new Map(),\r\n        fileIds: getInitializedImageElements(elements).map((element) => element.fileId),\r\n        files,\r\n    });\r\n    renderScene(elements, appState, null, scale, rough.canvas(canvas), canvas, {\r\n        viewBackgroundColor: exportBackground ? viewBackgroundColor : null,\r\n        scrollX: -minX + exportPadding,\r\n        scrollY: -minY + exportPadding,\r\n        zoom: defaultAppState.zoom,\r\n        remotePointerViewportCoords: {},\r\n        remoteSelectedElementIds: {},\r\n        shouldCacheIgnoreZoom: false,\r\n        remotePointerUsernames: {},\r\n        remotePointerUserStates: {},\r\n        theme: appState.exportWithDarkMode ? \"dark\" : \"light\",\r\n        imageCache,\r\n    }, {\r\n        renderScrollbars: false,\r\n        renderSelection: false,\r\n        renderOptimizations: true,\r\n        renderGrid: false,\r\n        isExport: true,\r\n    });\r\n    return canvas;\r\n};\r\nexport const exportToSvg = async (elements, appState, files) => {\r\n    const { exportPadding = DEFAULT_EXPORT_PADDING, viewBackgroundColor, exportScale = 1, exportEmbedScene, } = appState;\r\n    let metadata = \"\";\r\n    if (exportEmbedScene) {\r\n        try {\r\n            metadata = await (await import(/* webpackChunkName: \"image\" */ \"../../../src/ChalkBoard/data/image\")).encodeSvgMetadata({\r\n                text: serializeAsJSON(elements, appState, files || {}, \"local\"),\r\n            });\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n    }\r\n    const [minX, minY, width, height] = getCanvasSize(elements, exportPadding);\r\n    // initialze SVG root\r\n    const svgRoot = document.createElementNS(SVG_NS, \"svg\");\r\n    svgRoot.setAttribute(\"version\", \"1.1\");\r\n    svgRoot.setAttribute(\"xmlns\", SVG_NS);\r\n    svgRoot.setAttribute(\"viewBox\", `0 0 ${width} ${height}`);\r\n    svgRoot.setAttribute(\"width\", `${width * exportScale}`);\r\n    svgRoot.setAttribute(\"height\", `${height * exportScale}`);\r\n    if (appState.exportWithDarkMode) {\r\n        svgRoot.setAttribute(\"filter\", THEME_FILTER);\r\n    }\r\n    svgRoot.innerHTML = `\r\n  ${SVG_EXPORT_TAG}\r\n  ${metadata}\r\n  <defs>\r\n    <style>\r\n      @font-face {\r\n        font-family: \"Virgil\";\r\n        src: url(\"https://excalidraw.com/Virgil.woff2\");\r\n      }\r\n      @font-face {\r\n        font-family: \"Cascadia\";\r\n        src: url(\"https://excalidraw.com/Cascadia.woff2\");\r\n      }\r\n    </style>\r\n  </defs>\r\n  `;\r\n    // render background rect\r\n    if (appState.exportBackground && viewBackgroundColor) {\r\n        const rect = svgRoot.ownerDocument.createElementNS(SVG_NS, \"rect\");\r\n        rect.setAttribute(\"x\", \"0\");\r\n        rect.setAttribute(\"y\", \"0\");\r\n        rect.setAttribute(\"width\", `${width}`);\r\n        rect.setAttribute(\"height\", `${height}`);\r\n        rect.setAttribute(\"fill\", viewBackgroundColor);\r\n        svgRoot.appendChild(rect);\r\n    }\r\n    const rsvg = rough.svg(svgRoot);\r\n    renderSceneToSvg(elements, rsvg, svgRoot, files || {}, {\r\n        offsetX: -minX + exportPadding,\r\n        offsetY: -minY + exportPadding,\r\n    });\r\n    return svgRoot;\r\n};\r\n// calculate smallest area to fit the contents in\r\nconst getCanvasSize = (elements, exportPadding) => {\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n    const width = distance(minX, maxX) + exportPadding * 2;\r\n    const height = distance(minY, maxY) + exportPadding + exportPadding;\r\n    return [minX, minY, width, height];\r\n};\r\nexport const getExportSize = (elements, exportPadding, scale) => {\r\n    const [, , width, height] = getCanvasSize(elements, exportPadding).map((dimension) => Math.trunc(dimension * scale));\r\n    return [width, height];\r\n};\r\n","import colors from \"./colors\";\r\nimport { DEFAULT_FONT_FAMILY, DEFAULT_FONT_SIZE, ENV } from \"./constants\";\r\nimport { newElement, newLinearElement, newTextElement } from \"./element\";\r\nimport { randomId } from \"./random\";\r\nconst BAR_WIDTH = 32;\r\nconst BAR_GAP = 12;\r\nconst BAR_HEIGHT = 256;\r\nconst GRID_OPACITY = 50;\r\nexport const NOT_SPREADSHEET = \"NOT_SPREADSHEET\";\r\nexport const VALID_SPREADSHEET = \"VALID_SPREADSHEET\";\r\nconst tryParseNumber = (s) => {\r\n    const match = /^[$€£¥₩]?([0-9,]+(\\.[0-9]+)?)$/.exec(s);\r\n    if (!match) {\r\n        return null;\r\n    }\r\n    return parseFloat(match[1].replace(/,/g, \"\"));\r\n};\r\nconst isNumericColumn = (lines, columnIndex) => lines.slice(1).every((line) => tryParseNumber(line[columnIndex]) !== null);\r\nconst tryParseCells = (cells) => {\r\n    const numCols = cells[0].length;\r\n    if (numCols > 2) {\r\n        return { type: NOT_SPREADSHEET, reason: \"More than 2 columns\" };\r\n    }\r\n    if (numCols === 1) {\r\n        if (!isNumericColumn(cells, 0)) {\r\n            return { type: NOT_SPREADSHEET, reason: \"Value is not numeric\" };\r\n        }\r\n        const hasHeader = tryParseNumber(cells[0][0]) === null;\r\n        const values = (hasHeader ? cells.slice(1) : cells).map((line) => tryParseNumber(line[0]));\r\n        if (values.length < 2) {\r\n            return { type: NOT_SPREADSHEET, reason: \"Less than two rows\" };\r\n        }\r\n        return {\r\n            type: VALID_SPREADSHEET,\r\n            spreadsheet: {\r\n                title: hasHeader ? cells[0][0] : null,\r\n                labels: null,\r\n                values: values,\r\n            },\r\n        };\r\n    }\r\n    const valueColumnIndex = isNumericColumn(cells, 0) ? 0 : 1;\r\n    if (!isNumericColumn(cells, valueColumnIndex)) {\r\n        return { type: NOT_SPREADSHEET, reason: \"Value is not numeric\" };\r\n    }\r\n    const labelColumnIndex = (valueColumnIndex + 1) % 2;\r\n    const hasHeader = tryParseNumber(cells[0][valueColumnIndex]) === null;\r\n    const rows = hasHeader ? cells.slice(1) : cells;\r\n    if (rows.length < 2) {\r\n        return { type: NOT_SPREADSHEET, reason: \"Less than 2 rows\" };\r\n    }\r\n    return {\r\n        type: VALID_SPREADSHEET,\r\n        spreadsheet: {\r\n            title: hasHeader ? cells[0][valueColumnIndex] : null,\r\n            labels: rows.map((row) => row[labelColumnIndex]),\r\n            values: rows.map((row) => tryParseNumber(row[valueColumnIndex])),\r\n        },\r\n    };\r\n};\r\nconst transposeCells = (cells) => {\r\n    const nextCells = [];\r\n    for (let col = 0; col < cells[0].length; col++) {\r\n        const nextCellRow = [];\r\n        for (let row = 0; row < cells.length; row++) {\r\n            nextCellRow.push(cells[row][col]);\r\n        }\r\n        nextCells.push(nextCellRow);\r\n    }\r\n    return nextCells;\r\n};\r\nexport const tryParseSpreadsheet = (text) => {\r\n    // Copy/paste from excel, spreadhseets, tsv, csv.\r\n    // For now we only accept 2 columns with an optional header\r\n    // Check for tab separated values\r\n    let lines = text\r\n        .trim()\r\n        .split(\"\\n\")\r\n        .map((line) => line.trim().split(\"\\t\"));\r\n    // Check for comma separated files\r\n    if (lines.length && lines[0].length !== 2) {\r\n        lines = text\r\n            .trim()\r\n            .split(\"\\n\")\r\n            .map((line) => line.trim().split(\",\"));\r\n    }\r\n    if (lines.length === 0) {\r\n        return { type: NOT_SPREADSHEET, reason: \"No values\" };\r\n    }\r\n    const numColsFirstLine = lines[0].length;\r\n    const isSpreadsheet = lines.every((line) => line.length === numColsFirstLine);\r\n    if (!isSpreadsheet) {\r\n        return {\r\n            type: NOT_SPREADSHEET,\r\n            reason: \"All rows don't have same number of columns\",\r\n        };\r\n    }\r\n    const result = tryParseCells(lines);\r\n    if (result.type !== VALID_SPREADSHEET) {\r\n        const transposedResults = tryParseCells(transposeCells(lines));\r\n        if (transposedResults.type === VALID_SPREADSHEET) {\r\n            return transposedResults;\r\n        }\r\n    }\r\n    return result;\r\n};\r\nconst bgColors = colors.elementBackground.slice(2, colors.elementBackground.length);\r\n// Put all the common properties here so when the whole chart is selected\r\n// the properties dialog shows the correct selected values\r\nconst commonProps = {\r\n    fillStyle: \"hachure\",\r\n    fontFamily: DEFAULT_FONT_FAMILY,\r\n    fontSize: DEFAULT_FONT_SIZE,\r\n    opacity: 100,\r\n    roughness: 1,\r\n    strokeColor: colors.elementStroke[0],\r\n    strokeSharpness: \"sharp\",\r\n    strokeStyle: \"solid\",\r\n    strokeWidth: 1,\r\n    verticalAlign: \"middle\",\r\n};\r\nconst getChartDimentions = (spreadsheet) => {\r\n    const chartWidth = (BAR_WIDTH + BAR_GAP) * spreadsheet.values.length + BAR_GAP;\r\n    const chartHeight = BAR_HEIGHT + BAR_GAP * 2;\r\n    return { chartWidth, chartHeight };\r\n};\r\nconst chartXLabels = (spreadsheet, x, y, groupId, backgroundColor) => {\r\n    return (spreadsheet.labels?.map((label, index) => {\r\n        return newTextElement({\r\n            groupIds: [groupId],\r\n            backgroundColor,\r\n            ...commonProps,\r\n            text: label.length > 8 ? `${label.slice(0, 5)}...` : label,\r\n            x: x + index * (BAR_WIDTH + BAR_GAP) + BAR_GAP * 2,\r\n            y: y + BAR_GAP / 2,\r\n            width: BAR_WIDTH,\r\n            angle: 5.87,\r\n            fontSize: 16,\r\n            textAlign: \"center\",\r\n            verticalAlign: \"top\",\r\n        });\r\n    }) || []);\r\n};\r\nconst chartYLabels = (spreadsheet, x, y, groupId, backgroundColor) => {\r\n    const minYLabel = newTextElement({\r\n        groupIds: [groupId],\r\n        backgroundColor,\r\n        ...commonProps,\r\n        x: x - BAR_GAP,\r\n        y: y - BAR_GAP,\r\n        text: \"0\",\r\n        textAlign: \"right\",\r\n    });\r\n    const maxYLabel = newTextElement({\r\n        groupIds: [groupId],\r\n        backgroundColor,\r\n        ...commonProps,\r\n        x: x - BAR_GAP,\r\n        y: y - BAR_HEIGHT - minYLabel.height / 2,\r\n        text: Math.max(...spreadsheet.values).toLocaleString(),\r\n        textAlign: \"right\",\r\n    });\r\n    return [minYLabel, maxYLabel];\r\n};\r\nconst chartLines = (spreadsheet, x, y, groupId, backgroundColor) => {\r\n    const { chartWidth, chartHeight } = getChartDimentions(spreadsheet);\r\n    const xLine = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x,\r\n        y,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        width: chartWidth,\r\n        points: [\r\n            [0, 0],\r\n            [chartWidth, 0],\r\n        ],\r\n    });\r\n    const yLine = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x,\r\n        y,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        height: chartHeight,\r\n        points: [\r\n            [0, 0],\r\n            [0, -chartHeight],\r\n        ],\r\n    });\r\n    const maxLine = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x,\r\n        y: y - BAR_HEIGHT - BAR_GAP,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        strokeStyle: \"dotted\",\r\n        width: chartWidth,\r\n        opacity: GRID_OPACITY,\r\n        points: [\r\n            [0, 0],\r\n            [chartWidth, 0],\r\n        ],\r\n    });\r\n    return [xLine, yLine, maxLine];\r\n};\r\n// For the maths behind it https://excalidraw.com/#json=6320864370884608,O_5xfD-Agh32tytHpRJx1g\r\nconst chartBaseElements = (spreadsheet, x, y, groupId, backgroundColor, debug) => {\r\n    const { chartWidth, chartHeight } = getChartDimentions(spreadsheet);\r\n    const title = spreadsheet.title\r\n        ? newTextElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            text: spreadsheet.title,\r\n            x: x + chartWidth / 2,\r\n            y: y - BAR_HEIGHT - BAR_GAP * 2 - DEFAULT_FONT_SIZE,\r\n            strokeSharpness: \"sharp\",\r\n            strokeStyle: \"solid\",\r\n            textAlign: \"center\",\r\n        })\r\n        : null;\r\n    const debugRect = debug\r\n        ? newElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            type: \"rectangle\",\r\n            x,\r\n            y: y - chartHeight,\r\n            width: chartWidth,\r\n            height: chartHeight,\r\n            strokeColor: colors.elementStroke[0],\r\n            fillStyle: \"solid\",\r\n            opacity: 6,\r\n        })\r\n        : null;\r\n    return [\r\n        ...(debugRect ? [debugRect] : []),\r\n        ...(title ? [title] : []),\r\n        ...chartXLabels(spreadsheet, x, y, groupId, backgroundColor),\r\n        ...chartYLabels(spreadsheet, x, y, groupId, backgroundColor),\r\n        ...chartLines(spreadsheet, x, y, groupId, backgroundColor),\r\n    ];\r\n};\r\nconst chartTypeBar = (spreadsheet, x, y) => {\r\n    const max = Math.max(...spreadsheet.values);\r\n    const groupId = randomId();\r\n    const backgroundColor = bgColors[Math.floor(Math.random() * bgColors.length)];\r\n    const bars = spreadsheet.values.map((value, index) => {\r\n        const barHeight = (value / max) * BAR_HEIGHT;\r\n        return newElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            type: \"rectangle\",\r\n            x: x + index * (BAR_WIDTH + BAR_GAP) + BAR_GAP,\r\n            y: y - barHeight - BAR_GAP,\r\n            width: BAR_WIDTH,\r\n            height: barHeight,\r\n        });\r\n    });\r\n    return [\r\n        ...bars,\r\n        ...chartBaseElements(spreadsheet, x, y, groupId, backgroundColor, process.env.NODE_ENV === ENV.DEVELOPMENT),\r\n    ];\r\n};\r\nconst chartTypeLine = (spreadsheet, x, y) => {\r\n    const max = Math.max(...spreadsheet.values);\r\n    const groupId = randomId();\r\n    const backgroundColor = bgColors[Math.floor(Math.random() * bgColors.length)];\r\n    let index = 0;\r\n    const points = [];\r\n    for (const value of spreadsheet.values) {\r\n        const cx = index * (BAR_WIDTH + BAR_GAP);\r\n        const cy = -(value / max) * BAR_HEIGHT;\r\n        points.push([cx, cy]);\r\n        index++;\r\n    }\r\n    const maxX = Math.max(...points.map((element) => element[0]));\r\n    const maxY = Math.max(...points.map((element) => element[1]));\r\n    const minX = Math.min(...points.map((element) => element[0]));\r\n    const minY = Math.min(...points.map((element) => element[1]));\r\n    const line = newLinearElement({\r\n        backgroundColor,\r\n        groupIds: [groupId],\r\n        ...commonProps,\r\n        type: \"line\",\r\n        x: x + BAR_GAP + BAR_WIDTH / 2,\r\n        y: y - BAR_GAP,\r\n        startArrowhead: null,\r\n        endArrowhead: null,\r\n        height: maxY - minY,\r\n        width: maxX - minX,\r\n        strokeWidth: 2,\r\n        points: points,\r\n    });\r\n    const dots = spreadsheet.values.map((value, index) => {\r\n        const cx = index * (BAR_WIDTH + BAR_GAP) + BAR_GAP / 2;\r\n        const cy = -(value / max) * BAR_HEIGHT + BAR_GAP / 2;\r\n        return newElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            fillStyle: \"solid\",\r\n            strokeWidth: 2,\r\n            type: \"ellipse\",\r\n            x: x + cx + BAR_WIDTH / 2,\r\n            y: y + cy - BAR_GAP * 2,\r\n            width: BAR_GAP,\r\n            height: BAR_GAP,\r\n        });\r\n    });\r\n    const lines = spreadsheet.values.map((value, index) => {\r\n        const cx = index * (BAR_WIDTH + BAR_GAP) + BAR_GAP / 2;\r\n        const cy = (value / max) * BAR_HEIGHT + BAR_GAP / 2 + BAR_GAP;\r\n        return newLinearElement({\r\n            backgroundColor,\r\n            groupIds: [groupId],\r\n            ...commonProps,\r\n            type: \"line\",\r\n            x: x + cx + BAR_WIDTH / 2 + BAR_GAP / 2,\r\n            y: y - cy,\r\n            startArrowhead: null,\r\n            endArrowhead: null,\r\n            height: cy,\r\n            strokeStyle: \"dotted\",\r\n            opacity: GRID_OPACITY,\r\n            points: [\r\n                [0, 0],\r\n                [0, cy],\r\n            ],\r\n        });\r\n    });\r\n    return [\r\n        ...chartBaseElements(spreadsheet, x, y, groupId, backgroundColor, process.env.NODE_ENV === ENV.DEVELOPMENT),\r\n        line,\r\n        ...lines,\r\n        ...dots,\r\n    ];\r\n};\r\nexport const renderSpreadsheet = (chartType, spreadsheet, x, y) => {\r\n    if (chartType === \"line\") {\r\n        return chartTypeLine(spreadsheet, x, y);\r\n    }\r\n    return chartTypeBar(spreadsheet, x, y);\r\n};\r\n","import { getSelectedElements } from \"./scene\";\r\nimport { SVG_EXPORT_TAG } from \"./scene/export\";\r\nimport { tryParseSpreadsheet, VALID_SPREADSHEET } from \"./charts\";\r\nimport { EXPORT_DATA_TYPES, MIME_TYPES } from \"./constants\";\r\nimport { isInitializedImageElement } from \"./element/typeChecks\";\r\nlet CLIPBOARD = \"\";\r\nlet PREFER_APP_CLIPBOARD = false;\r\nexport const probablySupportsClipboardReadText = \"clipboard\" in navigator && \"readText\" in navigator.clipboard;\r\nexport const probablySupportsClipboardWriteText = \"clipboard\" in navigator && \"writeText\" in navigator.clipboard;\r\nexport const probablySupportsClipboardBlob = \"clipboard\" in navigator &&\r\n    \"write\" in navigator.clipboard &&\r\n    \"ClipboardItem\" in window &&\r\n    \"toBlob\" in HTMLCanvasElement.prototype;\r\nconst clipboardContainsElements = (contents) => {\r\n    if ([\r\n        EXPORT_DATA_TYPES.excalidraw,\r\n        EXPORT_DATA_TYPES.excalidrawClipboard,\r\n    ].includes(contents?.type) &&\r\n        Array.isArray(contents.elements)) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nexport const copyToClipboard = async (elements, appState, files) => {\r\n    const selectedElements = getSelectedElements(elements, appState);\r\n    const contents = {\r\n        type: EXPORT_DATA_TYPES.excalidrawClipboard,\r\n        elements: selectedElements,\r\n        files: selectedElements.reduce((acc, element) => {\r\n            if (isInitializedImageElement(element) && files[element.fileId]) {\r\n                acc[element.fileId] = files[element.fileId];\r\n            }\r\n            return acc;\r\n        }, {}),\r\n    };\r\n    const json = JSON.stringify(contents);\r\n    CLIPBOARD = json;\r\n    try {\r\n        PREFER_APP_CLIPBOARD = false;\r\n        await copyTextToSystemClipboard(json);\r\n    }\r\n    catch (error) {\r\n        PREFER_APP_CLIPBOARD = true;\r\n        console.error(error);\r\n    }\r\n};\r\nconst getAppClipboard = () => {\r\n    if (!CLIPBOARD) {\r\n        return {};\r\n    }\r\n    try {\r\n        return JSON.parse(CLIPBOARD);\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        return {};\r\n    }\r\n};\r\nconst parsePotentialSpreadsheet = (text) => {\r\n    const result = tryParseSpreadsheet(text);\r\n    if (result.type === VALID_SPREADSHEET) {\r\n        return { spreadsheet: result.spreadsheet };\r\n    }\r\n    return null;\r\n};\r\n/**\r\n * Retrieves content from system clipboard (either from ClipboardEvent or\r\n *  via async clipboard API if supported)\r\n */\r\nconst getSystemClipboard = async (event) => {\r\n    try {\r\n        const text = event\r\n            ? event.clipboardData?.getData(\"text/plain\").trim()\r\n            : probablySupportsClipboardReadText &&\r\n                (await navigator.clipboard.readText());\r\n        return text || \"\";\r\n    }\r\n    catch {\r\n        return \"\";\r\n    }\r\n};\r\n/**\r\n * Attemps to parse clipboard. Prefers system clipboard.\r\n */\r\nexport const parseClipboard = async (event) => {\r\n    const systemClipboard = await getSystemClipboard(event);\r\n    // if system clipboard empty, couldn't be resolved, or contains previously\r\n    // copied excalidraw scene as SVG, fall back to previously copied excalidraw\r\n    // elements\r\n    if (!systemClipboard || systemClipboard.includes(SVG_EXPORT_TAG)) {\r\n        return getAppClipboard();\r\n    }\r\n    // if system clipboard contains spreadsheet, use it even though it's\r\n    // technically possible it's staler than in-app clipboard\r\n    const spreadsheetResult = parsePotentialSpreadsheet(systemClipboard);\r\n    if (spreadsheetResult) {\r\n        return spreadsheetResult;\r\n    }\r\n    const appClipboardData = getAppClipboard();\r\n    try {\r\n        const systemClipboardData = JSON.parse(systemClipboard);\r\n        if (clipboardContainsElements(systemClipboardData)) {\r\n            return {\r\n                elements: systemClipboardData.elements,\r\n                files: systemClipboardData.files,\r\n            };\r\n        }\r\n        return appClipboardData;\r\n    }\r\n    catch {\r\n        // system clipboard doesn't contain excalidraw elements → return plaintext\r\n        // unless we set a flag to prefer in-app clipboard because browser didn't\r\n        // support storing to system clipboard on copy\r\n        return PREFER_APP_CLIPBOARD && appClipboardData.elements\r\n            ? appClipboardData\r\n            : { text: systemClipboard };\r\n    }\r\n};\r\nexport const copyBlobToClipboardAsPng = async (blob) => {\r\n    await navigator.clipboard.write([\r\n        new window.ClipboardItem({ [MIME_TYPES.png]: blob }),\r\n    ]);\r\n};\r\nexport const copyTextToSystemClipboard = async (text) => {\r\n    let copied = false;\r\n    if (probablySupportsClipboardWriteText) {\r\n        try {\r\n            // NOTE: doesn't work on FF on non-HTTPS domains, or when document\r\n            // not focused\r\n            await navigator.clipboard.writeText(text || \"\");\r\n            copied = true;\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n    }\r\n    // Note that execCommand doesn't allow copying empty strings, so if we're\r\n    // clearing clipboard using this API, we must copy at least an empty char\r\n    if (!copied && !copyTextViaExecCommand(text || \" \")) {\r\n        throw new Error(\"couldn't copy\");\r\n    }\r\n};\r\n// adapted from https://github.com/zenorocha/clipboard.js/blob/ce79f170aa655c408b6aab33c9472e8e4fa52e19/src/clipboard-action.js#L48\r\nconst copyTextViaExecCommand = (text) => {\r\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\";\r\n    const textarea = document.createElement(\"textarea\");\r\n    textarea.style.border = \"0\";\r\n    textarea.style.padding = \"0\";\r\n    textarea.style.margin = \"0\";\r\n    textarea.style.position = \"absolute\";\r\n    textarea.style[isRTL ? \"right\" : \"left\"] = \"-9999px\";\r\n    const yPosition = window.pageYOffset || document.documentElement.scrollTop;\r\n    textarea.style.top = `${yPosition}px`;\r\n    // Prevent zooming on iOS\r\n    textarea.style.fontSize = \"12pt\";\r\n    textarea.setAttribute(\"readonly\", \"\");\r\n    textarea.value = text;\r\n    document.body.appendChild(textarea);\r\n    let success = false;\r\n    try {\r\n        textarea.select();\r\n        textarea.setSelectionRange(0, textarea.value.length);\r\n        success = document.execCommand(\"copy\");\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n    }\r\n    textarea.remove();\r\n    return success;\r\n};\r\n","import { copyBlobToClipboardAsPng, copyTextToSystemClipboard, } from \"../clipboard\";\r\nimport { DEFAULT_EXPORT_PADDING, MIME_TYPES } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { exportToCanvas, exportToSvg } from \"../scene/export\";\r\nimport { canvasToBlob } from \"./blob\";\r\nimport { fileSave } from \"./filesystem\";\r\nimport { serializeAsJSON } from \"./json\";\r\nexport { loadFromBlob } from \"./blob\";\r\nexport { loadFromJSON, saveAsJSON } from \"./json\";\r\nexport const exportCanvas = async (type, elements, appState, files, { exportBackground, exportPadding = DEFAULT_EXPORT_PADDING, viewBackgroundColor, name, fileHandle = null, }) => {\r\n    if (elements.length === 0) {\r\n        throw new Error(t(\"alerts.cannotExportEmptyCanvas\"));\r\n    }\r\n    if (type === \"svg\" || type === \"clipboard-svg\") {\r\n        const tempSvg = await exportToSvg(elements, {\r\n            exportBackground,\r\n            exportWithDarkMode: appState.exportWithDarkMode,\r\n            viewBackgroundColor,\r\n            exportPadding,\r\n            exportScale: appState.exportScale,\r\n            exportEmbedScene: appState.exportEmbedScene && type === \"svg\",\r\n        }, files);\r\n        if (type === \"svg\") {\r\n            return await fileSave(new Blob([tempSvg.outerHTML], { type: MIME_TYPES.svg }), {\r\n                name,\r\n                extension: \"svg\",\r\n                fileHandle,\r\n            });\r\n        }\r\n        else if (type === \"clipboard-svg\") {\r\n            await copyTextToSystemClipboard(tempSvg.outerHTML);\r\n            return;\r\n        }\r\n    }\r\n    const tempCanvas = await exportToCanvas(elements, appState, files, {\r\n        exportBackground,\r\n        viewBackgroundColor,\r\n        exportPadding,\r\n    });\r\n    tempCanvas.style.display = \"none\";\r\n    document.body.appendChild(tempCanvas);\r\n    let blob = await canvasToBlob(tempCanvas);\r\n    tempCanvas.remove();\r\n    if (type === \"png\") {\r\n        if (appState.exportEmbedScene) {\r\n            blob = await (await import(/* webpackChunkName: \"image\" */ \"./image\")).encodePngMetadata({\r\n                blob,\r\n                metadata: serializeAsJSON(elements, appState, files, \"local\"),\r\n            });\r\n        }\r\n        return await fileSave(blob, {\r\n            name,\r\n            extension: \"png\",\r\n            fileHandle,\r\n        });\r\n    }\r\n    else if (type === \"clipboard\") {\r\n        try {\r\n            await copyBlobToClipboardAsPng(blob);\r\n        }\r\n        catch (error) {\r\n            if (error.name === \"CANVAS_POSSIBLY_TOO_BIG\") {\r\n                throw error;\r\n            }\r\n            throw new Error(t(\"alerts.couldNotCopyToClipboard\"));\r\n        }\r\n    }\r\n};\r\n","import { exportCanvas } from \".\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { getFileHandleType, isImageFileHandleType } from \"./blob\";\r\nexport const resaveAsImageWithScene = async (elements, appState, files) => {\r\n    const { exportBackground, viewBackgroundColor, name, fileHandle } = appState;\r\n    const fileHandleType = getFileHandleType(fileHandle);\r\n    if (!fileHandle || !isImageFileHandleType(fileHandleType)) {\r\n        throw new Error(\"fileHandle should exist and should be of type svg or png when resaving\");\r\n    }\r\n    appState = {\r\n        ...appState,\r\n        exportEmbedScene: true,\r\n    };\r\n    await exportCanvas(fileHandleType, getNonDeletedElements(elements), appState, files, {\r\n        exportBackground,\r\n        viewBackgroundColor,\r\n        name,\r\n        fileHandle,\r\n    });\r\n    return { fileHandle };\r\n};\r\n","import React from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { checkIcon } from \"./icons\";\r\nimport \"./CheckboxItem.scss\";\r\nexport const CheckboxItem = ({ children, checked, onChange }) => {\r\n    return (<div className={clsx(\"Checkbox\", { \"is-checked\": checked })} onClick={(event) => {\r\n            onChange(!checked);\r\n            event.currentTarget.querySelector(\".Checkbox-box\").focus();\r\n        }}>\r\n      <button className=\"Checkbox-box\" role=\"checkbox\" aria-checked={checked}>\r\n        {checkIcon}\r\n      </button>\r\n      <div className=\"Checkbox-label\">{children}</div>\r\n    </div>);\r\n};\r\n","import \"./Stack.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nconst RowStack = ({ children, gap, align, justifyContent, className, style, }) => {\r\n    return (<div className={clsx(\"Stack Stack_horizontal\", className)} style={{\r\n            \"--gap\": gap,\r\n            alignItems: align,\r\n            justifyContent,\r\n            ...style,\r\n        }}>\r\n      {children}\r\n    </div>);\r\n};\r\nconst ColStack = ({ children, gap, align, justifyContent, className, }) => {\r\n    return (<div className={clsx(\"Stack Stack_vertical\", className)} style={{\r\n            \"--gap\": gap,\r\n            justifyItems: align,\r\n            justifyContent,\r\n        }}>\r\n      {children}\r\n    </div>);\r\n};\r\nexport default {\r\n    Row: RowStack,\r\n    Col: ColStack,\r\n};\r\n","import Stack from \"../components/Stack\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { save, file } from \"../components/icons\";\r\nimport { t } from \"../i18n\";\r\nimport \"./ActiveFile.scss\";\r\nexport const ActiveFile = ({ fileName, onSave }) => (<Stack.Row className=\"ActiveFile\" gap={1} align=\"center\">\r\n    <span className=\"ActiveFile__fileName\">\r\n      {file}\r\n      <span>{fileName}</span>\r\n    </span>\r\n    <ToolButton type=\"icon\" icon={save} title={t(\"buttons.save\")} aria-label={t(\"buttons.save\")} onClick={onSave} data-testid=\"save-button\"/>\r\n  </Stack.Row>);\r\n","import { trackEvent } from \"../analytics\";\r\nimport { load, questionCircle, saveAs } from \"../components/icons\";\r\nimport { ProjectName } from \"../components/ProjectName\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport \"../components/ToolIcon.scss\";\r\nimport { Tooltip } from \"../components/Tooltip\";\r\nimport { DarkModeToggle } from \"../components/DarkModeToggle\";\r\nimport { loadFromJSON, saveAsJSON } from \"../data\";\r\nimport { resaveAsImageWithScene } from \"../data/resave\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { CheckboxItem } from \"../components/CheckboxItem\";\r\nimport { getExportSize } from \"../scene/export\";\r\nimport { DEFAULT_EXPORT_PADDING, EXPORT_SCALES, THEME } from \"../constants\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { ActiveFile } from \"../components/ActiveFile\";\r\nimport { isImageFileHandle } from \"../data/blob\";\r\nimport { nativeFileSystemSupported } from \"../data/filesystem\";\r\nexport const actionChangeProjectName = register({\r\n    name: \"changeProjectName\",\r\n    perform: (_elements, appState, value) => {\r\n        trackEvent(\"change\", \"title\");\r\n        return { appState: { ...appState, name: value }, commitToHistory: false };\r\n    },\r\n    PanelComponent: ({ appState, updateData, appProps }) => (<ProjectName label={t(\"labels.fileTitle\")} value={appState.name || \"Unnamed\"} onChange={(name) => updateData(name)} isNameEditable={typeof appProps.name === \"undefined\" && !appState.viewModeEnabled}/>),\r\n});\r\nexport const actionChangeExportScale = register({\r\n    name: \"changeExportScale\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportScale: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements: allElements, appState, updateData }) => {\r\n        const elements = getNonDeletedElements(allElements);\r\n        const exportSelected = isSomeElementSelected(elements, appState);\r\n        const exportedElements = exportSelected\r\n            ? getSelectedElements(elements, appState)\r\n            : elements;\r\n        return (<>\r\n        {EXPORT_SCALES.map((s) => {\r\n                const [width, height] = getExportSize(exportedElements, DEFAULT_EXPORT_PADDING, s);\r\n                const scaleButtonTitle = `${t(\"buttons.scale\")} ${s}x (${width}x${height})`;\r\n                return (<ToolButton key={s} size=\"small\" type=\"radio\" icon={`${s}x`} name=\"export-canvas-scale\" title={scaleButtonTitle} aria-label={scaleButtonTitle} id=\"export-canvas-scale\" checked={s === appState.exportScale} onChange={() => updateData(s)}/>);\r\n            })}\r\n      </>);\r\n    },\r\n});\r\nexport const actionChangeExportBackground = register({\r\n    name: \"changeExportBackground\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportBackground: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<CheckboxItem checked={appState.exportBackground} onChange={(checked) => updateData(checked)}>\r\n      {t(\"labels.withBackground\")}\r\n    </CheckboxItem>),\r\n});\r\nexport const actionChangeExportEmbedScene = register({\r\n    name: \"changeExportEmbedScene\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportEmbedScene: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<CheckboxItem checked={appState.exportEmbedScene} onChange={(checked) => updateData(checked)}>\r\n      {t(\"labels.exportEmbedScene\")}\r\n      <Tooltip label={t(\"labels.exportEmbedScene_details\")} long={true}>\r\n        <div className=\"excalidraw-tooltip-icon\">{questionCircle}</div>\r\n      </Tooltip>\r\n    </CheckboxItem>),\r\n});\r\nexport const actionSaveToActiveFile = register({\r\n    name: \"saveToActiveFile\",\r\n    perform: async (elements, appState, value, app) => {\r\n        const fileHandleExists = !!appState.fileHandle;\r\n        try {\r\n            const { fileHandle } = isImageFileHandle(appState.fileHandle)\r\n                ? await resaveAsImageWithScene(elements, appState, app.files)\r\n                : await saveAsJSON(elements, appState, app.files);\r\n            return {\r\n                commitToHistory: false,\r\n                appState: {\r\n                    ...appState,\r\n                    fileHandle,\r\n                    toastMessage: fileHandleExists\r\n                        ? fileHandle?.name\r\n                            ? t(\"toast.fileSavedToFilename\").replace(\"{filename}\", `\"${fileHandle.name}\"`)\r\n                            : t(\"toast.fileSaved\")\r\n                        : null,\r\n                },\r\n            };\r\n        }\r\n        catch (error) {\r\n            if (error?.name !== \"AbortError\") {\r\n                console.error(error);\r\n            }\r\n            return { commitToHistory: false };\r\n        }\r\n    },\r\n    keyTest: (event) => event.key === KEYS.S && event[KEYS.CTRL_OR_CMD] && !event.shiftKey,\r\n    PanelComponent: ({ updateData, appState }) => (<ActiveFile onSave={() => updateData(null)} fileName={appState.fileHandle?.name}/>),\r\n});\r\nexport const actionSaveFileToDisk = register({\r\n    name: \"saveFileToDisk\",\r\n    perform: async (elements, appState, value, app) => {\r\n        try {\r\n            const { fileHandle } = await saveAsJSON(elements, {\r\n                ...appState,\r\n                fileHandle: null,\r\n            }, app.files);\r\n            return { commitToHistory: false, appState: { ...appState, fileHandle } };\r\n        }\r\n        catch (error) {\r\n            if (error?.name !== \"AbortError\") {\r\n                console.error(error);\r\n            }\r\n            return { commitToHistory: false };\r\n        }\r\n    },\r\n    keyTest: (event) => event.key === KEYS.S && event.shiftKey && event[KEYS.CTRL_OR_CMD],\r\n    PanelComponent: ({ updateData }) => (<ToolButton type=\"button\" icon={saveAs} title={t(\"buttons.saveAs\")} aria-label={t(\"buttons.saveAs\")} showAriaLabel={useIsMobile()} hidden={!nativeFileSystemSupported} onClick={() => updateData(null)} data-testid=\"save-as-button\"/>),\r\n});\r\nexport const actionLoadScene = register({\r\n    name: \"loadScene\",\r\n    perform: async (elements, appState, _, app) => {\r\n        try {\r\n            const { elements: loadedElements, appState: loadedAppState, files, } = await loadFromJSON(appState, elements);\r\n            return {\r\n                elements: loadedElements,\r\n                appState: loadedAppState,\r\n                files,\r\n                commitToHistory: true,\r\n            };\r\n        }\r\n        catch (error) {\r\n            if (error?.name === \"AbortError\") {\r\n                return false;\r\n            }\r\n            return {\r\n                elements,\r\n                appState: { ...appState, errorMessage: error.message },\r\n                files: app.files,\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.key === KEYS.O,\r\n    PanelComponent: ({ updateData, appState }) => (<ToolButton type=\"button\" icon={load} title={t(\"buttons.load\")} aria-label={t(\"buttons.load\")} showAriaLabel={useIsMobile()} onClick={updateData} data-testid=\"load-button\"/>),\r\n});\r\nexport const actionExportWithDarkMode = register({\r\n    name: \"exportWithDarkMode\",\r\n    perform: (_elements, appState, value) => {\r\n        return {\r\n            appState: { ...appState, exportWithDarkMode: value },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData }) => (<div style={{\r\n            display: \"flex\",\r\n            justifyContent: \"flex-end\",\r\n            marginTop: \"-45px\",\r\n            marginBottom: \"10px\",\r\n        }}>\r\n      <DarkModeToggle value={appState.exportWithDarkMode ? THEME.DARK : THEME.LIGHT} onChange={(theme) => {\r\n            updateData(theme === THEME.DARK);\r\n        }} title={t(\"labels.toggleExportColorScheme\")}/>\r\n    </div>),\r\n});\r\n","import { isTextElement, isExcalidrawElement, redrawTextBoundingBox, } from \"../element\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nimport { t } from \"../i18n\";\r\nimport { register } from \"./register\";\r\nimport { mutateElement, newElementWith } from \"../element/mutateElement\";\r\nimport { DEFAULT_FONT_SIZE, DEFAULT_FONT_FAMILY, DEFAULT_TEXT_ALIGN, } from \"../constants\";\r\n// `copiedStyles` is exported only for tests.\r\nexport let copiedStyles = \"{}\";\r\nexport const actionCopyStyles = register({\r\n    name: \"copyStyles\",\r\n    perform: (elements, appState) => {\r\n        const element = elements.find((el) => appState.selectedElementIds[el.id]);\r\n        if (element) {\r\n            copiedStyles = JSON.stringify(element);\r\n        }\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                toastMessage: t(\"toast.copyStyles\"),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.copyStyles\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.C,\r\n});\r\nexport const actionPasteStyles = register({\r\n    name: \"pasteStyles\",\r\n    perform: (elements, appState) => {\r\n        const pastedElement = JSON.parse(copiedStyles);\r\n        if (!isExcalidrawElement(pastedElement)) {\r\n            return { elements, commitToHistory: false };\r\n        }\r\n        return {\r\n            elements: elements.map((element) => {\r\n                if (appState.selectedElementIds[element.id]) {\r\n                    const newElement = newElementWith(element, {\r\n                        backgroundColor: pastedElement?.backgroundColor,\r\n                        strokeWidth: pastedElement?.strokeWidth,\r\n                        strokeColor: pastedElement?.strokeColor,\r\n                        strokeStyle: pastedElement?.strokeStyle,\r\n                        fillStyle: pastedElement?.fillStyle,\r\n                        opacity: pastedElement?.opacity,\r\n                        roughness: pastedElement?.roughness,\r\n                    });\r\n                    if (isTextElement(newElement)) {\r\n                        mutateElement(newElement, {\r\n                            fontSize: pastedElement?.fontSize || DEFAULT_FONT_SIZE,\r\n                            fontFamily: pastedElement?.fontFamily || DEFAULT_FONT_FAMILY,\r\n                            textAlign: pastedElement?.textAlign || DEFAULT_TEXT_ALIGN,\r\n                        });\r\n                        redrawTextBoundingBox(newElement);\r\n                    }\r\n                    return newElement;\r\n                }\r\n                return element;\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.pasteStyles\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.V,\r\n});\r\n","import { questionCircle } from \"../components/icons\";\r\nexport const HelpIcon = (props) => (<button className=\"help-icon\" onClick={props.onClick} type=\"button\" title={`${props.title} — ?`} aria-label={props.title}>\r\n    {questionCircle}\r\n  </button>);\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { t } from \"../i18n\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nimport { UngroupIcon, GroupIcon } from \"../components/icons\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getSelectedGroupIds, selectGroup, selectGroupsForSelectedElements, getElementsInGroup, addToGroup, removeFromSelectedGroups, isElementInGroup, } from \"../groups\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { randomId } from \"../random\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nconst allElementsInSameGroup = (elements) => {\r\n    if (elements.length >= 2) {\r\n        const groupIds = elements[0].groupIds;\r\n        for (const groupId of groupIds) {\r\n            if (elements.reduce((acc, element) => acc && isElementInGroup(element, groupId), true)) {\r\n                return true;\r\n            }\r\n        }\r\n    }\r\n    return false;\r\n};\r\nconst enableActionGroup = (elements, appState) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    return (selectedElements.length >= 2 && !allElementsInSameGroup(selectedElements));\r\n};\r\nexport const actionGroup = register({\r\n    name: \"group\",\r\n    perform: (elements, appState) => {\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        if (selectedElements.length < 2) {\r\n            // nothing to group\r\n            return { appState, elements, commitToHistory: false };\r\n        }\r\n        // if everything is already grouped into 1 group, there is nothing to do\r\n        const selectedGroupIds = getSelectedGroupIds(appState);\r\n        if (selectedGroupIds.length === 1) {\r\n            const selectedGroupId = selectedGroupIds[0];\r\n            const elementIdsInGroup = new Set(getElementsInGroup(elements, selectedGroupId).map((element) => element.id));\r\n            const selectedElementIds = new Set(selectedElements.map((element) => element.id));\r\n            const combinedSet = new Set([\r\n                ...Array.from(elementIdsInGroup),\r\n                ...Array.from(selectedElementIds),\r\n            ]);\r\n            if (combinedSet.size === elementIdsInGroup.size) {\r\n                // no incremental ids in the selected ids\r\n                return { appState, elements, commitToHistory: false };\r\n            }\r\n        }\r\n        const newGroupId = randomId();\r\n        const updatedElements = elements.map((element) => {\r\n            if (!appState.selectedElementIds[element.id]) {\r\n                return element;\r\n            }\r\n            return newElementWith(element, {\r\n                groupIds: addToGroup(element.groupIds, newGroupId, appState.editingGroupId),\r\n            });\r\n        });\r\n        // keep the z order within the group the same, but move them\r\n        // to the z order of the highest element in the layer stack\r\n        const elementsInGroup = getElementsInGroup(updatedElements, newGroupId);\r\n        const lastElementInGroup = elementsInGroup[elementsInGroup.length - 1];\r\n        const lastGroupElementIndex = updatedElements.lastIndexOf(lastElementInGroup);\r\n        const elementsAfterGroup = updatedElements.slice(lastGroupElementIndex + 1);\r\n        const elementsBeforeGroup = updatedElements\r\n            .slice(0, lastGroupElementIndex)\r\n            .filter((updatedElement) => !isElementInGroup(updatedElement, newGroupId));\r\n        const updatedElementsInOrder = [\r\n            ...elementsBeforeGroup,\r\n            ...elementsInGroup,\r\n            ...elementsAfterGroup,\r\n        ];\r\n        return {\r\n            appState: selectGroup(newGroupId, { ...appState, selectedGroupIds: {} }, getNonDeletedElements(updatedElementsInOrder)),\r\n            elements: updatedElementsInOrder,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.group\",\r\n    contextItemPredicate: (elements, appState) => enableActionGroup(elements, appState),\r\n    keyTest: (event) => !event.shiftKey && event[KEYS.CTRL_OR_CMD] && event.code === CODES.G,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<GroupIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.group\")} — ${getShortcutKey(\"CtrlOrCmd+G\")}`} aria-label={t(\"labels.group\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}></ToolButton>),\r\n});\r\nexport const actionUngroup = register({\r\n    name: \"ungroup\",\r\n    perform: (elements, appState) => {\r\n        const groupIds = getSelectedGroupIds(appState);\r\n        if (groupIds.length === 0) {\r\n            return { appState, elements, commitToHistory: false };\r\n        }\r\n        const nextElements = elements.map((element) => {\r\n            const nextGroupIds = removeFromSelectedGroups(element.groupIds, appState.selectedGroupIds);\r\n            if (nextGroupIds.length === element.groupIds.length) {\r\n                return element;\r\n            }\r\n            return newElementWith(element, {\r\n                groupIds: nextGroupIds,\r\n            });\r\n        });\r\n        return {\r\n            appState: selectGroupsForSelectedElements({ ...appState, selectedGroupIds: {} }, getNonDeletedElements(nextElements)),\r\n            elements: nextElements,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.shiftKey && event[KEYS.CTRL_OR_CMD] && event.code === CODES.G,\r\n    contextItemLabel: \"labels.ungroup\",\r\n    contextItemPredicate: (elements, appState) => getSelectedGroupIds(appState).length > 0,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton type=\"button\" hidden={getSelectedGroupIds(appState).length === 0} icon={<UngroupIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.ungroup\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+G\")}`} aria-label={t(\"labels.ungroup\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}></ToolButton>),\r\n});\r\n","import { menu, palette } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { t } from \"../i18n\";\r\nimport { showSelectedShapeActions, getNonDeletedElements } from \"../element\";\r\nimport { register } from \"./register\";\r\nimport { allowFullScreen, exitFullScreen, isFullScreen } from \"../utils\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nimport { HelpIcon } from \"../components/HelpIcon\";\r\nexport const actionToggleCanvasMenu = register({\r\n    name: \"toggleCanvasMenu\",\r\n    perform: (_, appState) => ({\r\n        appState: {\r\n            ...appState,\r\n            openMenu: appState.openMenu === \"canvas\" ? null : \"canvas\",\r\n        },\r\n        commitToHistory: false,\r\n    }),\r\n    PanelComponent: ({ appState, updateData }) => (<ToolButton type=\"button\" icon={menu} aria-label={t(\"buttons.menu\")} onClick={updateData} selected={appState.openMenu === \"canvas\"}/>),\r\n});\r\nexport const actionToggleEditMenu = register({\r\n    name: \"toggleEditMenu\",\r\n    perform: (_elements, appState) => ({\r\n        appState: {\r\n            ...appState,\r\n            openMenu: appState.openMenu === \"shape\" ? null : \"shape\",\r\n        },\r\n        commitToHistory: false,\r\n    }),\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton visible={showSelectedShapeActions(appState, getNonDeletedElements(elements))} type=\"button\" icon={palette} aria-label={t(\"buttons.edit\")} onClick={updateData} selected={appState.openMenu === \"shape\"}/>),\r\n});\r\nexport const actionFullScreen = register({\r\n    name: \"toggleFullScreen\",\r\n    perform: () => {\r\n        if (!isFullScreen()) {\r\n            allowFullScreen();\r\n        }\r\n        if (isFullScreen()) {\r\n            exitFullScreen();\r\n        }\r\n        return {\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    keyTest: (event) => event.code === CODES.F && !event[KEYS.CTRL_OR_CMD],\r\n});\r\nexport const actionShortcuts = register({\r\n    name: \"toggleShortcuts\",\r\n    perform: (_elements, appState, _, { focusContainer }) => {\r\n        if (appState.showHelpDialog) {\r\n            focusContainer();\r\n        }\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                showHelpDialog: !appState.showHelpDialog,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ updateData }) => (<HelpIcon title={t(\"helpDialog.title\")} onClick={updateData}/>),\r\n    keyTest: (event) => event.key === KEYS.QUESTION_MARK,\r\n});\r\n","import \"./Avatar.scss\";\r\nimport React from \"react\";\r\nexport const Avatar = ({ children, color, border, onClick }) => (<div className=\"Avatar\" style={{ background: color, border: `1px solid ${border}` }} onClick={onClick}>\r\n    {children}\r\n  </div>);\r\n","import { register } from \"./register\";\r\nimport { getSelectedElements } from \"../scene\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { deepCopyElement } from \"../element/newElement\";\r\nexport const actionAddToLibrary = register({\r\n    name: \"addToLibrary\",\r\n    perform: (elements, appState, _, app) => {\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        app.library.loadLibrary().then((items) => {\r\n            app.library.saveLibrary([\r\n                ...items,\r\n                selectedElements.map(deepCopyElement),\r\n            ]);\r\n        });\r\n        return false;\r\n    },\r\n    contextItemLabel: \"labels.addToLibrary\",\r\n});\r\n","import { getClientColors, getClientInitials } from \"../clients\";\r\nimport { Avatar } from \"../components/Avatar\";\r\nimport { centerScrollOn } from \"../scene/scroll\";\r\nimport { register } from \"./register\";\r\nexport const actionGoToCollaborator = register({\r\n    name: \"goToCollaborator\",\r\n    perform: (_elements, appState, value) => {\r\n        const point = value;\r\n        if (!point) {\r\n            return { appState, commitToHistory: false };\r\n        }\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                ...centerScrollOn({\r\n                    scenePoint: point,\r\n                    viewportDimensions: {\r\n                        width: appState.width,\r\n                        height: appState.height,\r\n                    },\r\n                    zoom: appState.zoom,\r\n                }),\r\n                // Close mobile menu\r\n                openMenu: appState.openMenu === \"canvas\" ? null : appState.openMenu,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    PanelComponent: ({ appState, updateData, data }) => {\r\n        const clientId = data?.id;\r\n        if (!clientId) {\r\n            return null;\r\n        }\r\n        const collaborator = appState.collaborators.get(clientId);\r\n        if (!collaborator) {\r\n            return null;\r\n        }\r\n        const { background, stroke } = getClientColors(clientId, appState);\r\n        const shortName = getClientInitials(collaborator.username);\r\n        return (<Avatar color={background} border={stroke} onClick={() => updateData(collaborator.pointer)}>\r\n        {shortName}\r\n      </Avatar>);\r\n    },\r\n});\r\n","import { newElementWith } from \"./element/mutateElement\";\r\nimport { getCommonBounds } from \"./element\";\r\nexport const alignElements = (selectedElements, alignment) => {\r\n    const groups = getMaximumGroups(selectedElements);\r\n    const selectionBoundingBox = getCommonBoundingBox(selectedElements);\r\n    return groups.flatMap((group) => {\r\n        const translation = calculateTranslation(group, selectionBoundingBox, alignment);\r\n        return group.map((element) => newElementWith(element, {\r\n            x: element.x + translation.x,\r\n            y: element.y + translation.y,\r\n        }));\r\n    });\r\n};\r\nexport const getMaximumGroups = (elements) => {\r\n    const groups = new Map();\r\n    elements.forEach((element) => {\r\n        const groupId = element.groupIds.length === 0\r\n            ? element.id\r\n            : element.groupIds[element.groupIds.length - 1];\r\n        const currentGroupMembers = groups.get(groupId) || [];\r\n        groups.set(groupId, [...currentGroupMembers, element]);\r\n    });\r\n    return Array.from(groups.values());\r\n};\r\nconst calculateTranslation = (group, selectionBoundingBox, { axis, position }) => {\r\n    const groupBoundingBox = getCommonBoundingBox(group);\r\n    const [min, max] = axis === \"x\" ? [\"minX\", \"maxX\"] : [\"minY\", \"maxY\"];\r\n    const noTranslation = { x: 0, y: 0 };\r\n    if (position === \"start\") {\r\n        return {\r\n            ...noTranslation,\r\n            [axis]: selectionBoundingBox[min] - groupBoundingBox[min],\r\n        };\r\n    }\r\n    else if (position === \"end\") {\r\n        return {\r\n            ...noTranslation,\r\n            [axis]: selectionBoundingBox[max] - groupBoundingBox[max],\r\n        };\r\n    } // else if (position === \"center\") {\r\n    return {\r\n        ...noTranslation,\r\n        [axis]: (selectionBoundingBox[min] + selectionBoundingBox[max]) / 2 -\r\n            (groupBoundingBox[min] + groupBoundingBox[max]) / 2,\r\n    };\r\n};\r\nconst getCommonBoundingBox = (elements) => {\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n    return { minX, minY, maxX, maxY };\r\n};\r\n","import { alignElements } from \"../align\";\r\nimport { AlignBottomIcon, AlignLeftIcon, AlignRightIcon, AlignTopIcon, CenterHorizontallyIcon, CenterVerticallyIcon, } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { getElementMap, getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { KEYS } from \"../keys\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nconst enableActionGroup = (elements, appState) => getSelectedElements(getNonDeletedElements(elements), appState).length > 1;\r\nconst alignSelectedElements = (elements, appState, alignment) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    const updatedElements = alignElements(selectedElements, alignment);\r\n    const updatedElementsMap = getElementMap(updatedElements);\r\n    return elements.map((element) => updatedElementsMap[element.id] || element);\r\n};\r\nexport const actionAlignTop = register({\r\n    name: \"alignTop\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"start\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_UP,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignTopIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignTop\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Up\")}`} aria-label={t(\"labels.alignTop\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignBottom = register({\r\n    name: \"alignBottom\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"end\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_DOWN,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignBottomIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignBottom\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Down\")}`} aria-label={t(\"labels.alignBottom\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignLeft = register({\r\n    name: \"alignLeft\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"start\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_LEFT,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignLeftIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignLeft\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Left\")}`} aria-label={t(\"labels.alignLeft\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignRight = register({\r\n    name: \"alignRight\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"end\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.shiftKey && event.key === KEYS.ARROW_RIGHT,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<AlignRightIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.alignRight\")} — ${getShortcutKey(\"CtrlOrCmd+Shift+Right\")}`} aria-label={t(\"labels.alignRight\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignVerticallyCentered = register({\r\n    name: \"alignVerticallyCentered\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"center\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<CenterVerticallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={t(\"labels.centerVertically\")} aria-label={t(\"labels.centerVertically\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const actionAlignHorizontallyCentered = register({\r\n    name: \"alignHorizontallyCentered\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: alignSelectedElements(elements, appState, {\r\n                position: \"center\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<CenterHorizontallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={t(\"labels.centerHorizontally\")} aria-label={t(\"labels.centerHorizontally\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\n","import { newElementWith } from \"./element/mutateElement\";\r\nimport { getCommonBounds } from \"./element\";\r\nexport const distributeElements = (selectedElements, distribution) => {\r\n    const [start, mid, end, extent] = distribution.axis === \"x\"\r\n        ? [\"minX\", \"midX\", \"maxX\", \"width\"]\r\n        : [\"minY\", \"midY\", \"maxY\", \"height\"];\r\n    const bounds = getCommonBoundingBox(selectedElements);\r\n    const groups = getMaximumGroups(selectedElements)\r\n        .map((group) => [group, getCommonBoundingBox(group)])\r\n        .sort((a, b) => a[1][mid] - b[1][mid]);\r\n    let span = 0;\r\n    for (const group of groups) {\r\n        span += group[1][extent];\r\n    }\r\n    const step = (bounds[extent] - span) / (groups.length - 1);\r\n    if (step < 0) {\r\n        // If we have a negative step, we'll need to distribute from centers\r\n        // rather than from gaps. Buckle up, this is a weird one.\r\n        // Get indices of boxes that define start and end of our bounding box\r\n        const index0 = groups.findIndex((g) => g[1][start] === bounds[start]);\r\n        const index1 = groups.findIndex((g) => g[1][end] === bounds[end]);\r\n        // Get our step, based on the distance between the center points of our\r\n        // start and end boxes\r\n        const step = (groups[index1][1][mid] - groups[index0][1][mid]) / (groups.length - 1);\r\n        let pos = groups[index0][1][mid];\r\n        return groups.flatMap(([group, box], index) => {\r\n            const translation = {\r\n                x: 0,\r\n                y: 0,\r\n            };\r\n            // Don't move our start and end boxes\r\n            if (index !== index0 && index !== index1) {\r\n                pos += step;\r\n                translation[distribution.axis] = pos - box[mid];\r\n            }\r\n            return group.map((element) => newElementWith(element, {\r\n                x: element.x + translation.x,\r\n                y: element.y + translation.y,\r\n            }));\r\n        });\r\n    }\r\n    // Distribute from gaps\r\n    let pos = bounds[start];\r\n    return groups.flatMap(([group, box]) => {\r\n        const translation = {\r\n            x: 0,\r\n            y: 0,\r\n        };\r\n        translation[distribution.axis] = pos - box[start];\r\n        pos += step;\r\n        pos += box[extent];\r\n        return group.map((element) => newElementWith(element, {\r\n            x: element.x + translation.x,\r\n            y: element.y + translation.y,\r\n        }));\r\n    });\r\n};\r\nexport const getMaximumGroups = (elements) => {\r\n    const groups = new Map();\r\n    elements.forEach((element) => {\r\n        const groupId = element.groupIds.length === 0\r\n            ? element.id\r\n            : element.groupIds[element.groupIds.length - 1];\r\n        const currentGroupMembers = groups.get(groupId) || [];\r\n        groups.set(groupId, [...currentGroupMembers, element]);\r\n    });\r\n    return Array.from(groups.values());\r\n};\r\nconst getCommonBoundingBox = (elements) => {\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n    return {\r\n        minX,\r\n        minY,\r\n        maxX,\r\n        maxY,\r\n        width: maxX - minX,\r\n        height: maxY - minY,\r\n        midX: (minX + maxX) / 2,\r\n        midY: (minY + maxY) / 2,\r\n    };\r\n};\r\n","import { DistributeHorizontallyIcon, DistributeVerticallyIcon, } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { distributeElements } from \"../disitrubte\";\r\nimport { getElementMap, getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { CODES } from \"../keys\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport { register } from \"./register\";\r\nconst enableActionGroup = (elements, appState) => getSelectedElements(getNonDeletedElements(elements), appState).length > 1;\r\nconst distributeSelectedElements = (elements, appState, distribution) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    const updatedElements = distributeElements(selectedElements, distribution);\r\n    const updatedElementsMap = getElementMap(updatedElements);\r\n    return elements.map((element) => updatedElementsMap[element.id] || element);\r\n};\r\nexport const distributeHorizontally = register({\r\n    name: \"distributeHorizontally\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: distributeSelectedElements(elements, appState, {\r\n                space: \"between\",\r\n                axis: \"x\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.altKey && event.code === CODES.H,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<DistributeHorizontallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.distributeHorizontally\")} — ${getShortcutKey(\"Alt+H\")}`} aria-label={t(\"labels.distributeHorizontally\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\nexport const distributeVertically = register({\r\n    name: \"distributeVertically\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            appState,\r\n            elements: distributeSelectedElements(elements, appState, {\r\n                space: \"between\",\r\n                axis: \"y\",\r\n            }),\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.altKey && event.code === CODES.V,\r\n    PanelComponent: ({ elements, appState, updateData }) => (<ToolButton hidden={!enableActionGroup(elements, appState)} type=\"button\" icon={<DistributeVerticallyIcon theme={appState.theme}/>} onClick={() => updateData(null)} title={`${t(\"labels.distributeVertically\")} — ${getShortcutKey(\"Alt+V\")}`} aria-label={t(\"labels.distributeVertically\")} visible={isSomeElementSelected(getNonDeletedElements(elements), appState)}/>),\r\n});\r\n","import { register } from \"./register\";\r\nimport { getSelectedElements } from \"../scene\";\r\nimport { getElementMap, getNonDeletedElements } from \"../element\";\r\nimport { mutateElement } from \"../element/mutateElement\";\r\nimport { normalizeAngle, resizeSingleElement } from \"../element/resizeElements\";\r\nimport { getTransformHandles } from \"../element/transformHandles\";\r\nimport { isFreeDrawElement, isLinearElement } from \"../element/typeChecks\";\r\nimport { updateBoundElements } from \"../element/binding\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nconst enableActionFlipHorizontal = (elements, appState) => {\r\n    const eligibleElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    return eligibleElements.length === 1 && eligibleElements[0].type !== \"text\";\r\n};\r\nconst enableActionFlipVertical = (elements, appState) => {\r\n    const eligibleElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    return eligibleElements.length === 1;\r\n};\r\nexport const actionFlipHorizontal = register({\r\n    name: \"flipHorizontal\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: flipSelectedElements(elements, appState, \"horizontal\"),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.shiftKey && event.code === \"KeyH\",\r\n    contextItemLabel: \"labels.flipHorizontal\",\r\n    contextItemPredicate: (elements, appState) => enableActionFlipHorizontal(elements, appState),\r\n});\r\nexport const actionFlipVertical = register({\r\n    name: \"flipVertical\",\r\n    perform: (elements, appState) => {\r\n        return {\r\n            elements: flipSelectedElements(elements, appState, \"vertical\"),\r\n            appState,\r\n            commitToHistory: true,\r\n        };\r\n    },\r\n    keyTest: (event) => event.shiftKey && event.code === \"KeyV\",\r\n    contextItemLabel: \"labels.flipVertical\",\r\n    contextItemPredicate: (elements, appState) => enableActionFlipVertical(elements, appState),\r\n});\r\nconst flipSelectedElements = (elements, appState, flipDirection) => {\r\n    const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n    // remove once we allow for groups of elements to be flipped\r\n    if (selectedElements.length > 1) {\r\n        return elements;\r\n    }\r\n    const updatedElements = flipElements(selectedElements, appState, flipDirection);\r\n    const updatedElementsMap = getElementMap(updatedElements);\r\n    return elements.map((element) => updatedElementsMap[element.id] || element);\r\n};\r\nconst flipElements = (elements, appState, flipDirection) => {\r\n    elements.forEach((element) => {\r\n        flipElement(element, appState);\r\n        // If vertical flip, rotate an extra 180\r\n        if (flipDirection === \"vertical\") {\r\n            rotateElement(element, Math.PI);\r\n        }\r\n    });\r\n    return elements;\r\n};\r\nconst flipElement = (element, appState) => {\r\n    const originalX = element.x;\r\n    const originalY = element.y;\r\n    const width = element.width;\r\n    const height = element.height;\r\n    const originalAngle = normalizeAngle(element.angle);\r\n    let finalOffsetX = 0;\r\n    if (isLinearElement(element) || isFreeDrawElement(element)) {\r\n        finalOffsetX =\r\n            element.points.reduce((max, point) => Math.max(max, point[0]), 0) * 2 -\r\n                element.width;\r\n    }\r\n    // Rotate back to zero, if necessary\r\n    mutateElement(element, {\r\n        angle: normalizeAngle(0),\r\n    });\r\n    // Flip unrotated by pulling TransformHandle to opposite side\r\n    const transformHandles = getTransformHandles(element, appState.zoom);\r\n    let usingNWHandle = true;\r\n    let newNCoordsX = 0;\r\n    let nHandle = transformHandles.nw;\r\n    if (!nHandle) {\r\n        // Use ne handle instead\r\n        usingNWHandle = false;\r\n        nHandle = transformHandles.ne;\r\n        if (!nHandle) {\r\n            mutateElement(element, {\r\n                angle: originalAngle,\r\n            });\r\n            return;\r\n        }\r\n    }\r\n    if (isLinearElement(element)) {\r\n        for (let i = 1; i < element.points.length; i++) {\r\n            LinearElementEditor.movePoint(element, i, [\r\n                -element.points[i][0],\r\n                element.points[i][1],\r\n            ]);\r\n        }\r\n        LinearElementEditor.normalizePoints(element);\r\n    }\r\n    else {\r\n        // calculate new x-coord for transformation\r\n        newNCoordsX = usingNWHandle ? element.x + 2 * width : element.x - 2 * width;\r\n        resizeSingleElement(element, true, element, usingNWHandle ? \"nw\" : \"ne\", false, newNCoordsX, nHandle[1]);\r\n        // fix the size to account for handle sizes\r\n        mutateElement(element, {\r\n            width,\r\n            height,\r\n        });\r\n    }\r\n    // Rotate by (360 degrees - original angle)\r\n    let angle = normalizeAngle(2 * Math.PI - originalAngle);\r\n    if (angle < 0) {\r\n        // check, probably unnecessary\r\n        angle = normalizeAngle(angle + 2 * Math.PI);\r\n    }\r\n    mutateElement(element, {\r\n        angle,\r\n    });\r\n    // Move back to original spot to appear \"flipped in place\"\r\n    mutateElement(element, {\r\n        x: originalX + finalOffsetX,\r\n        y: originalY,\r\n    });\r\n    updateBoundElements(element);\r\n};\r\nconst rotateElement = (element, rotationAngle) => {\r\n    const originalX = element.x;\r\n    const originalY = element.y;\r\n    let angle = normalizeAngle(element.angle + rotationAngle);\r\n    if (angle < 0) {\r\n        // check, probably unnecessary\r\n        angle = normalizeAngle(2 * Math.PI + angle);\r\n    }\r\n    mutateElement(element, {\r\n        angle,\r\n    });\r\n    // Move back to original spot\r\n    mutateElement(element, {\r\n        x: originalX,\r\n        y: originalY,\r\n    });\r\n};\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { copyToClipboard } from \"../clipboard\";\r\nimport { actionDeleteSelected } from \"./actionDeleteSelected\";\r\nimport { getSelectedElements } from \"../scene/selection\";\r\nimport { exportCanvas } from \"../data/index\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nexport const actionCopy = register({\r\n    name: \"copy\",\r\n    perform: (elements, appState, _, app) => {\r\n        copyToClipboard(getNonDeletedElements(elements), appState, app.files);\r\n        return {\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    contextItemLabel: \"labels.copy\",\r\n    // don't supply a shortcut since we handle this conditionally via onCopy event\r\n    keyTest: undefined,\r\n});\r\nexport const actionCut = register({\r\n    name: \"cut\",\r\n    perform: (elements, appState, data, app) => {\r\n        actionCopy.perform(elements, appState, data, app);\r\n        return actionDeleteSelected.perform(elements, appState, data, app);\r\n    },\r\n    contextItemLabel: \"labels.cut\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.code === CODES.X,\r\n});\r\nexport const actionCopyAsSvg = register({\r\n    name: \"copyAsSvg\",\r\n    perform: async (elements, appState, _data, app) => {\r\n        if (!app.canvas) {\r\n            return {\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        try {\r\n            await exportCanvas(\"clipboard-svg\", selectedElements.length\r\n                ? selectedElements\r\n                : getNonDeletedElements(elements), appState, app.files, appState);\r\n            return {\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    errorMessage: error.message,\r\n                },\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n    },\r\n    contextItemLabel: \"labels.copyAsSvg\",\r\n});\r\nexport const actionCopyAsPng = register({\r\n    name: \"copyAsPng\",\r\n    perform: async (elements, appState, _data, app) => {\r\n        if (!app.canvas) {\r\n            return {\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        const selectedElements = getSelectedElements(getNonDeletedElements(elements), appState);\r\n        try {\r\n            await exportCanvas(\"clipboard\", selectedElements.length\r\n                ? selectedElements\r\n                : getNonDeletedElements(elements), appState, app.files, appState);\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    toastMessage: t(\"toast.copyToClipboardAsPng\", {\r\n                        exportSelection: selectedElements.length\r\n                            ? t(\"toast.selection\")\r\n                            : t(\"toast.canvas\"),\r\n                        exportColorScheme: appState.exportWithDarkMode\r\n                            ? t(\"buttons.darkMode\")\r\n                            : t(\"buttons.lightMode\"),\r\n                    }),\r\n                },\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            return {\r\n                appState: {\r\n                    ...appState,\r\n                    errorMessage: error.message,\r\n                },\r\n                commitToHistory: false,\r\n            };\r\n        }\r\n    },\r\n    contextItemLabel: \"labels.copyAsPng\",\r\n    keyTest: (event) => event.code === CODES.C && event.altKey && event.shiftKey,\r\n});\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { GRID_SIZE } from \"../constants\";\r\nimport { trackEvent } from \"../analytics\";\r\nexport const actionToggleGridMode = register({\r\n    name: \"gridMode\",\r\n    perform(elements, appState) {\r\n        trackEvent(\"view\", \"mode\", \"grid\");\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                gridSize: this.checked(appState) ? null : GRID_SIZE,\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.gridSize !== null,\r\n    contextItemLabel: \"labels.showGrid\",\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] && event.code === CODES.QUOTE,\r\n});\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { trackEvent } from \"../analytics\";\r\nexport const actionToggleZenMode = register({\r\n    name: \"zenMode\",\r\n    perform(elements, appState) {\r\n        trackEvent(\"view\", \"mode\", \"zen\");\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                zenModeEnabled: !this.checked(appState),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.zenModeEnabled,\r\n    contextItemLabel: \"buttons.zenMode\",\r\n    keyTest: (event) => !event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.Z,\r\n});\r\n","import { register } from \"./register\";\r\nimport { CODES, KEYS } from \"../keys\";\r\nexport const actionToggleStats = register({\r\n    name: \"stats\",\r\n    perform(elements, appState) {\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                showStats: !this.checked(appState),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.showStats,\r\n    contextItemLabel: \"stats.title\",\r\n    keyTest: (event) => !event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.SLASH,\r\n});\r\n","import { undo, redo } from \"../components/icons\";\r\nimport { ToolButton } from \"../components/ToolButton\";\r\nimport { t } from \"../i18n\";\r\nimport { isWindows, KEYS } from \"../keys\";\r\nimport { getElementMap } from \"../element\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { fixBindingsAfterDeletion } from \"../element/binding\";\r\nconst writeData = (prevElements, appState, updater) => {\r\n    const commitToHistory = false;\r\n    if (!appState.multiElement &&\r\n        !appState.resizingElement &&\r\n        !appState.editingElement &&\r\n        !appState.draggingElement) {\r\n        const data = updater();\r\n        if (data === null) {\r\n            return { commitToHistory };\r\n        }\r\n        const prevElementMap = getElementMap(prevElements);\r\n        const nextElements = data.elements;\r\n        const nextElementMap = getElementMap(nextElements);\r\n        const deletedElements = prevElements.filter((prevElement) => !nextElementMap.hasOwnProperty(prevElement.id));\r\n        const elements = nextElements\r\n            .map((nextElement) => newElementWith(prevElementMap[nextElement.id] || nextElement, nextElement))\r\n            .concat(deletedElements.map((prevElement) => newElementWith(prevElement, { isDeleted: true })));\r\n        fixBindingsAfterDeletion(elements, deletedElements);\r\n        return {\r\n            elements,\r\n            appState: { ...appState, ...data.appState },\r\n            commitToHistory,\r\n            syncHistory: true,\r\n        };\r\n    }\r\n    return { commitToHistory };\r\n};\r\nexport const createUndoAction = (history) => ({\r\n    name: \"undo\",\r\n    perform: (elements, appState) => writeData(elements, appState, () => history.undoOnce()),\r\n    keyTest: (event) => event[KEYS.CTRL_OR_CMD] &&\r\n        event.key.toLowerCase() === KEYS.Z &&\r\n        !event.shiftKey,\r\n    PanelComponent: ({ updateData, data }) => (<ToolButton type=\"button\" icon={undo} aria-label={t(\"buttons.undo\")} onClick={updateData} size={data?.size || \"medium\"}/>),\r\n    commitToHistory: () => false,\r\n});\r\nexport const createRedoAction = (history) => ({\r\n    name: \"redo\",\r\n    perform: (elements, appState) => writeData(elements, appState, () => history.redoOnce()),\r\n    keyTest: (event) => (event[KEYS.CTRL_OR_CMD] &&\r\n        event.shiftKey &&\r\n        event.key.toLowerCase() === KEYS.Z) ||\r\n        (isWindows && event.ctrlKey && !event.shiftKey && event.key === KEYS.Y),\r\n    PanelComponent: ({ updateData, data }) => (<ToolButton type=\"button\" icon={redo} aria-label={t(\"buttons.redo\")} onClick={updateData} size={data?.size || \"medium\"}/>),\r\n    commitToHistory: () => false,\r\n});\r\n","import React from \"react\";\r\nimport { MODES } from \"../constants\";\r\nexport class ActionManager {\r\n    constructor(updater, getAppState, getElementsIncludingDeleted, app) {\r\n        this.actions = {};\r\n        /**\r\n         * @param data additional data sent to the PanelComponent\r\n         */\r\n        this.renderAction = (name, data) => {\r\n            const canvasActions = this.app.props.UIOptions.canvasActions;\r\n            if (this.actions[name] &&\r\n                \"PanelComponent\" in this.actions[name] &&\r\n                (name in canvasActions\r\n                    ? canvasActions[name]\r\n                    : true)) {\r\n                const action = this.actions[name];\r\n                const PanelComponent = action.PanelComponent;\r\n                const updateData = (formState) => {\r\n                    this.updater(action.perform(this.getElementsIncludingDeleted(), this.getAppState(), formState, this.app));\r\n                };\r\n                return (<PanelComponent elements={this.getElementsIncludingDeleted()} appState={this.getAppState()} updateData={updateData} appProps={this.app.props} data={data}/>);\r\n            }\r\n            return null;\r\n        };\r\n        this.updater = (actionResult) => {\r\n            if (actionResult && \"then\" in actionResult) {\r\n                actionResult.then((actionResult) => {\r\n                    return updater(actionResult);\r\n                });\r\n            }\r\n            else {\r\n                return updater(actionResult);\r\n            }\r\n        };\r\n        this.getAppState = getAppState;\r\n        this.getElementsIncludingDeleted = getElementsIncludingDeleted;\r\n        this.app = app;\r\n    }\r\n    registerAction(action) {\r\n        this.actions[action.name] = action;\r\n    }\r\n    registerAll(actions) {\r\n        actions.forEach((action) => this.registerAction(action));\r\n    }\r\n    handleKeyDown(event) {\r\n        const canvasActions = this.app.props.UIOptions.canvasActions;\r\n        const data = Object.values(this.actions)\r\n            .sort((a, b) => (b.keyPriority || 0) - (a.keyPriority || 0))\r\n            .filter((action) => (action.name in canvasActions\r\n            ? canvasActions[action.name]\r\n            : true) &&\r\n            action.keyTest &&\r\n            action.keyTest(event, this.getAppState(), this.getElementsIncludingDeleted()));\r\n        if (data.length === 0) {\r\n            return false;\r\n        }\r\n        const { viewModeEnabled } = this.getAppState();\r\n        if (viewModeEnabled) {\r\n            if (!Object.values(MODES).includes(data[0].name)) {\r\n                return false;\r\n            }\r\n        }\r\n        event.preventDefault();\r\n        this.updater(data[0].perform(this.getElementsIncludingDeleted(), this.getAppState(), null, this.app));\r\n        return true;\r\n    }\r\n    executeAction(action) {\r\n        this.updater(action.perform(this.getElementsIncludingDeleted(), this.getAppState(), null, this.app));\r\n    }\r\n}\r\n","import { loadLibraryFromBlob } from \"./blob\";\r\nimport { restoreElements } from \"./restore\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nclass Library {\r\n    constructor(app) {\r\n        this.libraryCache = null;\r\n        this.resetLibrary = async () => {\r\n            await this.app.props.onLibraryChange?.([]);\r\n            this.libraryCache = [];\r\n        };\r\n        this.restoreLibraryItem = (libraryItem) => {\r\n            const elements = getNonDeletedElements(restoreElements(libraryItem, null));\r\n            return elements.length ? elements : null;\r\n        };\r\n        this.loadLibrary = () => {\r\n            return new Promise(async (resolve) => {\r\n                if (this.libraryCache) {\r\n                    return resolve(JSON.parse(JSON.stringify(this.libraryCache)));\r\n                }\r\n                try {\r\n                    const libraryItems = this.app.libraryItemsFromStorage;\r\n                    if (!libraryItems) {\r\n                        return resolve([]);\r\n                    }\r\n                    const items = libraryItems.reduce((acc, item) => {\r\n                        const restoredItem = this.restoreLibraryItem(item);\r\n                        if (restoredItem) {\r\n                            acc.push(item);\r\n                        }\r\n                        return acc;\r\n                    }, []);\r\n                    // clone to ensure we don't mutate the cached library elements in the app\r\n                    this.libraryCache = JSON.parse(JSON.stringify(items));\r\n                    resolve(items);\r\n                }\r\n                catch (error) {\r\n                    console.error(error);\r\n                    resolve([]);\r\n                }\r\n            });\r\n        };\r\n        this.saveLibrary = async (items) => {\r\n            const prevLibraryItems = this.libraryCache;\r\n            try {\r\n                const serializedItems = JSON.stringify(items);\r\n                // cache optimistically so that the app has access to the latest\r\n                // immediately\r\n                this.libraryCache = JSON.parse(serializedItems);\r\n                await this.app.props.onLibraryChange?.(items);\r\n            }\r\n            catch (error) {\r\n                this.libraryCache = prevLibraryItems;\r\n                throw error;\r\n            }\r\n        };\r\n        this.app = app;\r\n    }\r\n    /** imports library (currently merges, removing duplicates) */\r\n    async importLibrary(blob) {\r\n        const libraryFile = await loadLibraryFromBlob(blob);\r\n        if (!libraryFile || !libraryFile.library) {\r\n            return;\r\n        }\r\n        /**\r\n         * checks if library item does not exist already in current library\r\n         */\r\n        const isUniqueitem = (existingLibraryItems, targetLibraryItem) => {\r\n            return !existingLibraryItems.find((libraryItem) => {\r\n                if (libraryItem.length !== targetLibraryItem.length) {\r\n                    return false;\r\n                }\r\n                // detect z-index difference by checking the excalidraw elements\r\n                // are in order\r\n                return libraryItem.every((libItemExcalidrawItem, idx) => {\r\n                    return (libItemExcalidrawItem.id === targetLibraryItem[idx].id &&\r\n                        libItemExcalidrawItem.versionNonce ===\r\n                            targetLibraryItem[idx].versionNonce);\r\n                });\r\n            });\r\n        };\r\n        const existingLibraryItems = await this.loadLibrary();\r\n        const filtered = libraryFile.library.reduce((acc, libraryItem) => {\r\n            const restoredItem = this.restoreLibraryItem(libraryItem);\r\n            if (restoredItem && isUniqueitem(existingLibraryItems, restoredItem)) {\r\n                acc.push(restoredItem);\r\n            }\r\n            return acc;\r\n        }, []);\r\n        await this.saveLibrary([...existingLibraryItems, ...filtered]);\r\n    }\r\n}\r\nexport default Library;\r\n","export const getCenter = (pointers) => {\r\n    const allCoords = Array.from(pointers.values());\r\n    return {\r\n        x: sum(allCoords, (coords) => coords.x) / allCoords.length,\r\n        y: sum(allCoords, (coords) => coords.y) / allCoords.length,\r\n    };\r\n};\r\nexport const getDistance = ([a, b]) => Math.hypot(a.x - b.x, a.y - b.y);\r\nconst sum = (array, mapper) => array.reduce((acc, item) => acc + mapper(item), 0);\r\n","import { isLinearElement } from \"./element/typeChecks\";\r\nimport { deepCopyElement } from \"./element/newElement\";\r\nconst clearAppStatePropertiesForHistory = (appState) => {\r\n    return {\r\n        selectedElementIds: appState.selectedElementIds,\r\n        selectedGroupIds: appState.selectedGroupIds,\r\n        viewBackgroundColor: appState.viewBackgroundColor,\r\n        editingLinearElement: appState.editingLinearElement,\r\n        editingGroupId: appState.editingGroupId,\r\n        name: appState.name,\r\n    };\r\n};\r\nclass History {\r\n    constructor() {\r\n        this.elementCache = new Map();\r\n        this.recording = true;\r\n        this.stateHistory = [];\r\n        this.redoStack = [];\r\n        this.lastEntry = null;\r\n        this.generateEntry = (appState, elements) => this.dehydrateHistoryEntry({\r\n            appState: clearAppStatePropertiesForHistory(appState),\r\n            elements: elements.reduce((elements, element) => {\r\n                if (isLinearElement(element) &&\r\n                    appState.multiElement &&\r\n                    appState.multiElement.id === element.id) {\r\n                    // don't store multi-point arrow if still has only one point\r\n                    if (appState.multiElement &&\r\n                        appState.multiElement.id === element.id &&\r\n                        element.points.length < 2) {\r\n                        return elements;\r\n                    }\r\n                    elements.push({\r\n                        ...element,\r\n                        // don't store last point if not committed\r\n                        points: element.lastCommittedPoint !==\r\n                            element.points[element.points.length - 1]\r\n                            ? element.points.slice(0, -1)\r\n                            : element.points,\r\n                    });\r\n                }\r\n                else {\r\n                    elements.push(element);\r\n                }\r\n                return elements;\r\n            }, []),\r\n        });\r\n    }\r\n    hydrateHistoryEntry({ appState, elements, }) {\r\n        return {\r\n            appState: JSON.parse(appState),\r\n            elements: elements.map((dehydratedExcalidrawElement) => {\r\n                const element = this.elementCache\r\n                    .get(dehydratedExcalidrawElement.id)\r\n                    ?.get(dehydratedExcalidrawElement.versionNonce);\r\n                if (!element) {\r\n                    throw new Error(`Element not found: ${dehydratedExcalidrawElement.id}:${dehydratedExcalidrawElement.versionNonce}`);\r\n                }\r\n                return element;\r\n            }),\r\n        };\r\n    }\r\n    dehydrateHistoryEntry({ appState, elements, }) {\r\n        return {\r\n            appState: JSON.stringify(appState),\r\n            elements: elements.map((element) => {\r\n                if (!this.elementCache.has(element.id)) {\r\n                    this.elementCache.set(element.id, new Map());\r\n                }\r\n                const versions = this.elementCache.get(element.id);\r\n                if (!versions.has(element.versionNonce)) {\r\n                    versions.set(element.versionNonce, deepCopyElement(element));\r\n                }\r\n                return {\r\n                    id: element.id,\r\n                    versionNonce: element.versionNonce,\r\n                };\r\n            }),\r\n        };\r\n    }\r\n    getSnapshotForTest() {\r\n        return {\r\n            recording: this.recording,\r\n            stateHistory: this.stateHistory.map((dehydratedHistoryEntry) => this.hydrateHistoryEntry(dehydratedHistoryEntry)),\r\n            redoStack: this.redoStack.map((dehydratedHistoryEntry) => this.hydrateHistoryEntry(dehydratedHistoryEntry)),\r\n        };\r\n    }\r\n    clear() {\r\n        this.stateHistory.length = 0;\r\n        this.redoStack.length = 0;\r\n        this.lastEntry = null;\r\n        this.elementCache.clear();\r\n    }\r\n    shouldCreateEntry(nextEntry) {\r\n        const { lastEntry } = this;\r\n        if (!lastEntry) {\r\n            return true;\r\n        }\r\n        if (nextEntry.elements.length !== lastEntry.elements.length) {\r\n            return true;\r\n        }\r\n        // loop from right to left as changes are likelier to happen on new elements\r\n        for (let i = nextEntry.elements.length - 1; i > -1; i--) {\r\n            const prev = nextEntry.elements[i];\r\n            const next = lastEntry.elements[i];\r\n            if (!prev ||\r\n                !next ||\r\n                prev.id !== next.id ||\r\n                prev.versionNonce !== next.versionNonce) {\r\n                return true;\r\n            }\r\n        }\r\n        // note: this is safe because entry's appState is guaranteed no excess props\r\n        let key;\r\n        for (key in nextEntry.appState) {\r\n            if (key === \"editingLinearElement\") {\r\n                if (nextEntry.appState[key]?.elementId ===\r\n                    lastEntry.appState[key]?.elementId) {\r\n                    continue;\r\n                }\r\n            }\r\n            if (key === \"selectedElementIds\" || key === \"selectedGroupIds\") {\r\n                continue;\r\n            }\r\n            if (nextEntry.appState[key] !== lastEntry.appState[key]) {\r\n                return true;\r\n            }\r\n        }\r\n        return false;\r\n    }\r\n    pushEntry(appState, elements) {\r\n        const newEntryDehydrated = this.generateEntry(appState, elements);\r\n        const newEntry = this.hydrateHistoryEntry(newEntryDehydrated);\r\n        if (newEntry) {\r\n            if (!this.shouldCreateEntry(newEntry)) {\r\n                return;\r\n            }\r\n            this.stateHistory.push(newEntryDehydrated);\r\n            this.lastEntry = newEntry;\r\n            // As a new entry was pushed, we invalidate the redo stack\r\n            this.clearRedoStack();\r\n        }\r\n    }\r\n    clearRedoStack() {\r\n        this.redoStack.splice(0, this.redoStack.length);\r\n    }\r\n    redoOnce() {\r\n        if (this.redoStack.length === 0) {\r\n            return null;\r\n        }\r\n        const entryToRestore = this.redoStack.pop();\r\n        if (entryToRestore !== undefined) {\r\n            this.stateHistory.push(entryToRestore);\r\n            return this.hydrateHistoryEntry(entryToRestore);\r\n        }\r\n        return null;\r\n    }\r\n    undoOnce() {\r\n        if (this.stateHistory.length === 1) {\r\n            return null;\r\n        }\r\n        const currentEntry = this.stateHistory.pop();\r\n        const entryToRestore = this.stateHistory[this.stateHistory.length - 1];\r\n        if (currentEntry !== undefined) {\r\n            this.redoStack.push(currentEntry);\r\n            return this.hydrateHistoryEntry(entryToRestore);\r\n        }\r\n        return null;\r\n    }\r\n    /**\r\n     * Updates history's `lastEntry` to latest app state. This is necessary\r\n     *  when doing undo/redo which itself doesn't commit to history, but updates\r\n     *  app state in a way that would break `shouldCreateEntry` which relies on\r\n     *  `lastEntry` to reflect last comittable history state.\r\n     * We can't update `lastEntry` from within history when calling undo/redo\r\n     *  because the action potentially mutates appState/elements before storing\r\n     *  it.\r\n     */\r\n    setCurrentState(appState, elements) {\r\n        this.lastEntry = this.hydrateHistoryEntry(this.generateEntry(appState, elements));\r\n    }\r\n    // Suspicious that this is called so many places. Seems error-prone.\r\n    resumeRecording() {\r\n        this.recording = true;\r\n    }\r\n    record(state, elements) {\r\n        if (this.recording) {\r\n            this.pushEntry(state, elements);\r\n            this.recording = false;\r\n        }\r\n    }\r\n}\r\nexport default History;\r\n","import { KEYS } from \"./keys\";\r\n// We inline font-awesome icons in order to save on js size rather than including the font awesome react library\r\nexport const SHAPES = [\r\n    {\r\n        icon: (\r\n        // fa-mouse-pointer\r\n        <svg viewBox=\"0 0 320 512\" className=\"\">\r\n        <path d=\"M302.189 329.126H196.105l55.831 135.993c3.889 9.428-.555 19.999-9.444 23.999l-49.165 21.427c-9.165 4-19.443-.571-23.332-9.714l-53.053-129.136-86.664 89.138C18.729 472.71 0 463.554 0 447.977V18.299C0 1.899 19.921-6.096 30.277 5.443l284.412 292.542c11.472 11.179 3.007 31.141-12.5 31.141z\"/>\r\n      </svg>),\r\n        value: \"selection\",\r\n        key: KEYS.V,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-square\r\n        <svg viewBox=\"0 0 448 512\">\r\n        <path d=\"M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z\"/>\r\n      </svg>),\r\n        value: \"rectangle\",\r\n        key: KEYS.R,\r\n    },\r\n    {\r\n        icon: (\r\n        // custom\r\n        <svg viewBox=\"0 0 223.646 223.646\">\r\n        <path d=\"M111.823 0L16.622 111.823 111.823 223.646 207.025 111.823z\"/>\r\n      </svg>),\r\n        value: \"diamond\",\r\n        key: KEYS.D,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-circle\r\n        <svg viewBox=\"0 0 512 512\">\r\n        <path d=\"M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8z\"/>\r\n      </svg>),\r\n        value: \"ellipse\",\r\n        key: KEYS.E,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-long-arrow-alt-right\r\n        <svg viewBox=\"0 0 448 512\" className=\"rtl-mirror\">\r\n        <path d=\"M313.941 216H12c-6.627 0-12 5.373-12 12v56c0 6.627 5.373 12 12 12h301.941v46.059c0 21.382 25.851 32.09 40.971 16.971l86.059-86.059c9.373-9.373 9.373-24.569 0-33.941l-86.059-86.059c-15.119-15.119-40.971-4.411-40.971 16.971V216z\"/>\r\n      </svg>),\r\n        value: \"arrow\",\r\n        key: KEYS.A,\r\n    },\r\n    {\r\n        icon: (\r\n        // custom\r\n        <svg viewBox=\"0 0 6 6\">\r\n        <line x1=\"0\" y1=\"3\" x2=\"6\" y2=\"3\" stroke=\"currentColor\" strokeLinecap=\"round\"/>\r\n      </svg>),\r\n        value: \"line\",\r\n        key: [KEYS.P, KEYS.L],\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-pencil\r\n        <svg viewBox=\"0 0 512 512\">\r\n        <path fill=\"currentColor\" d=\"M290.74 93.24l128.02 128.02-277.99 277.99-114.14 12.6C11.35 513.54-1.56 500.62.14 485.34l12.7-114.22 277.9-277.88zm207.2-19.06l-60.11-60.11c-18.75-18.75-49.16-18.75-67.91 0l-56.55 56.55 128.02 128.02 56.55-56.55c18.75-18.76 18.75-49.16 0-67.91z\"></path>\r\n      </svg>),\r\n        value: \"freedraw\",\r\n        key: KEYS.X,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-font\r\n        <svg viewBox=\"0 0 448 512\">\r\n        <path d=\"M432 416h-23.41L277.88 53.69A32 32 0 0 0 247.58 32h-47.16a32 32 0 0 0-30.3 21.69L39.41 416H16a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16h-19.58l23.3-64h152.56l23.3 64H304a16 16 0 0 0-16 16v32a16 16 0 0 0 16 16h128a16 16 0 0 0 16-16v-32a16 16 0 0 0-16-16zM176.85 272L224 142.51 271.15 272z\"/>\r\n      </svg>),\r\n        value: \"text\",\r\n        key: KEYS.T,\r\n    },\r\n    {\r\n        icon: (\r\n        // fa-image\r\n        <svg viewBox=\"0 0 512 512\">\r\n        <path fill=\"currentColor\" d=\"M464 64H48C21.49 64 0 85.49 0 112v288c0 26.51 21.49 48 48 48h416c26.51 0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm-6 336H54a6 6 0 0 1-6-6V118a6 6 0 0 1 6-6h404a6 6 0 0 1 6 6v276a6 6 0 0 1-6 6zM128 152c-22.091 0-40 17.909-40 40s17.909 40 40 40 40-17.909 40-40-17.909-40-40-40zM96 352h320v-80l-87.515-87.515c-4.686-4.686-12.284-4.686-16.971 0L192 304l-39.515-39.515c-4.686-4.686-12.284-4.686-16.971 0L96 304v48z\"></path>\r\n      </svg>),\r\n        value: \"image\",\r\n        key: null,\r\n    },\r\n];\r\nexport const findShapeByKey = (key) => {\r\n    const shape = SHAPES.find((shape, index) => {\r\n        return (key === (index + 1).toString() ||\r\n            (shape.key &&\r\n                (typeof shape.key === \"string\"\r\n                    ? shape.key === key\r\n                    : shape.key.includes(key))));\r\n    });\r\n    return shape?.value || null;\r\n};\r\n","import { t } from \"../i18n\";\r\nimport { isDarwin } from \"../keys\";\r\nimport { getShortcutKey } from \"../utils\";\r\nconst shortcutMap = {\r\n    cut: [getShortcutKey(\"CtrlOrCmd+X\")],\r\n    copy: [getShortcutKey(\"CtrlOrCmd+C\")],\r\n    paste: [getShortcutKey(\"CtrlOrCmd+V\")],\r\n    copyStyles: [getShortcutKey(\"CtrlOrCmd+Alt+C\")],\r\n    pasteStyles: [getShortcutKey(\"CtrlOrCmd+Alt+V\")],\r\n    selectAll: [getShortcutKey(\"CtrlOrCmd+A\")],\r\n    deleteSelectedElements: [getShortcutKey(\"Del\")],\r\n    duplicateSelection: [\r\n        getShortcutKey(\"CtrlOrCmd+D\"),\r\n        getShortcutKey(`Alt+${t(\"helpDialog.drag\")}`),\r\n    ],\r\n    sendBackward: [getShortcutKey(\"CtrlOrCmd+[\")],\r\n    bringForward: [getShortcutKey(\"CtrlOrCmd+]\")],\r\n    sendToBack: [\r\n        isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+[\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+[\"),\r\n    ],\r\n    bringToFront: [\r\n        isDarwin\r\n            ? getShortcutKey(\"CtrlOrCmd+Alt+]\")\r\n            : getShortcutKey(\"CtrlOrCmd+Shift+]\"),\r\n    ],\r\n    copyAsPng: [getShortcutKey(\"Shift+Alt+C\")],\r\n    copyAsSvg: [],\r\n    group: [getShortcutKey(\"CtrlOrCmd+G\")],\r\n    ungroup: [getShortcutKey(\"CtrlOrCmd+Shift+G\")],\r\n    gridMode: [getShortcutKey(\"CtrlOrCmd+'\")],\r\n    zenMode: [getShortcutKey(\"Alt+Z\")],\r\n    stats: [getShortcutKey(\"Alt+/\")],\r\n    addToLibrary: [],\r\n    flipHorizontal: [getShortcutKey(\"Shift+H\")],\r\n    flipVertical: [getShortcutKey(\"Shift+V\")],\r\n    viewMode: [getShortcutKey(\"Alt+R\")],\r\n};\r\nexport const getShortcutFromShortcutName = (name) => {\r\n    const shortcuts = shortcutMap[name];\r\n    // if multiple shortcuts availiable, take the first one\r\n    return shortcuts && shortcuts.length > 0 ? shortcuts[0] : \"\";\r\n};\r\n","import { render, unmountComponentAtNode } from \"react-dom\";\r\nimport clsx from \"clsx\";\r\nimport { Popover } from \"./Popover\";\r\nimport { t } from \"../i18n\";\r\nimport \"./ContextMenu.scss\";\r\nimport { getShortcutFromShortcutName, } from \"../actions/shortcuts\";\r\nconst ContextMenu = ({ options, onCloseRequest, top, left, actionManager, appState, }) => {\r\n    return (<Popover onCloseRequest={onCloseRequest} top={top} left={left} fitInViewport={true}>\r\n      <ul className=\"context-menu\" onContextMenu={(event) => event.preventDefault()}>\r\n        {options.map((option, idx) => {\r\n            if (option === \"separator\") {\r\n                return <hr key={idx} className=\"context-menu-option-separator\"/>;\r\n            }\r\n            const actionName = option.name;\r\n            const label = option.contextItemLabel\r\n                ? t(option.contextItemLabel)\r\n                : \"\";\r\n            return (<li key={idx} data-testid={actionName} onClick={onCloseRequest}>\r\n              <button className={clsx(\"context-menu-option\", {\r\n                    dangerous: actionName === \"deleteSelectedElements\",\r\n                    checkmark: option.checked?.(appState),\r\n                })} onClick={() => actionManager.executeAction(option)}>\r\n                <div className=\"context-menu-option__label\">{label}</div>\r\n                <kbd className=\"context-menu-option__shortcut\">\r\n                  {actionName\r\n                    ? getShortcutFromShortcutName(actionName)\r\n                    : \"\"}\r\n                </kbd>\r\n              </button>\r\n            </li>);\r\n        })}\r\n      </ul>\r\n    </Popover>);\r\n};\r\nconst contextMenuNodeByContainer = new WeakMap();\r\nconst getContextMenuNode = (container) => {\r\n    let contextMenuNode = contextMenuNodeByContainer.get(container);\r\n    if (contextMenuNode) {\r\n        return contextMenuNode;\r\n    }\r\n    contextMenuNode = document.createElement(\"div\");\r\n    container\r\n        .querySelector(\".excalidraw-contextMenuContainer\")\r\n        .appendChild(contextMenuNode);\r\n    contextMenuNodeByContainer.set(container, contextMenuNode);\r\n    return contextMenuNode;\r\n};\r\nconst handleClose = (container) => {\r\n    const contextMenuNode = contextMenuNodeByContainer.get(container);\r\n    if (contextMenuNode) {\r\n        unmountComponentAtNode(contextMenuNode);\r\n        contextMenuNode.remove();\r\n        contextMenuNodeByContainer.delete(container);\r\n    }\r\n};\r\nexport default {\r\n    push(params) {\r\n        const options = Array.of();\r\n        params.options.forEach((option) => {\r\n            if (option) {\r\n                options.push(option);\r\n            }\r\n        });\r\n        if (options.length) {\r\n            render(<ContextMenu top={params.top} left={params.left} options={options} onCloseRequest={() => handleClose(params.container)} actionManager={params.actionManager} appState={params.appState}/>, getContextMenuNode(params.container));\r\n        }\r\n    },\r\n};\r\n","import React from \"react\";\r\nimport { getNonDeletedElements } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { canChangeSharpness, canHaveArrowheads, getTargetElements, hasBackground, hasStrokeStyle, hasStrokeWidth, hasText, } from \"../scene\";\r\nimport { SHAPES } from \"../shapes\";\r\nimport { capitalizeString, isTransparent, setCursorForShape } from \"../utils\";\r\nimport Stack from \"./Stack\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { hasStrokeColor } from \"../scene/comparisons\";\r\nexport const SelectedShapeActions = ({ appState, elements, renderAction, elementType, }) => {\r\n    const targetElements = getTargetElements(getNonDeletedElements(elements), appState);\r\n    const isEditing = Boolean(appState.editingElement);\r\n    const isMobile = useIsMobile();\r\n    const isRTL = document.documentElement.getAttribute(\"dir\") === \"rtl\";\r\n    const showFillIcons = hasBackground(elementType) ||\r\n        targetElements.some((element) => hasBackground(element.type) && !isTransparent(element.backgroundColor));\r\n    const showChangeBackgroundIcons = hasBackground(elementType) ||\r\n        targetElements.some((element) => hasBackground(element.type));\r\n    let commonSelectedType = targetElements[0]?.type || null;\r\n    for (const element of targetElements) {\r\n        if (element.type !== commonSelectedType) {\r\n            commonSelectedType = null;\r\n            break;\r\n        }\r\n    }\r\n    return (<div className=\"panelColumn\">\r\n      {((hasStrokeColor(elementType) &&\r\n            elementType !== \"image\" &&\r\n            commonSelectedType !== \"image\") ||\r\n            targetElements.some((element) => hasStrokeColor(element.type))) &&\r\n            renderAction(\"changeStrokeColor\")}\r\n      {showChangeBackgroundIcons && renderAction(\"changeBackgroundColor\")}\r\n      {showFillIcons && renderAction(\"changeFillStyle\")}\r\n\r\n      {(hasStrokeWidth(elementType) ||\r\n            targetElements.some((element) => hasStrokeWidth(element.type))) &&\r\n            renderAction(\"changeStrokeWidth\")}\r\n\r\n      {(elementType === \"freedraw\" ||\r\n            targetElements.some((element) => element.type === \"freedraw\")) &&\r\n            renderAction(\"changeStrokeShape\")}\r\n\r\n      {(hasStrokeStyle(elementType) ||\r\n            targetElements.some((element) => hasStrokeStyle(element.type))) && (<>\r\n          {renderAction(\"changeStrokeStyle\")}\r\n          {renderAction(\"changeSloppiness\")}\r\n        </>)}\r\n\r\n      {(canChangeSharpness(elementType) ||\r\n            targetElements.some((element) => canChangeSharpness(element.type))) && (<>{renderAction(\"changeSharpness\")}</>)}\r\n\r\n      {(hasText(elementType) ||\r\n            targetElements.some((element) => hasText(element.type))) && (<>\r\n          {renderAction(\"changeFontSize\")}\r\n\r\n          {renderAction(\"changeFontFamily\")}\r\n\r\n          {renderAction(\"changeTextAlign\")}\r\n        </>)}\r\n\r\n      {(canHaveArrowheads(elementType) ||\r\n            targetElements.some((element) => canHaveArrowheads(element.type))) && (<>{renderAction(\"changeArrowhead\")}</>)}\r\n\r\n      {renderAction(\"changeOpacity\")}\r\n\r\n      <fieldset>\r\n        <legend>{t(\"labels.layers\")}</legend>\r\n        <div className=\"buttonList\">\r\n          {renderAction(\"sendToBack\")}\r\n          {renderAction(\"sendBackward\")}\r\n          {renderAction(\"bringToFront\")}\r\n          {renderAction(\"bringForward\")}\r\n        </div>\r\n      </fieldset>\r\n\r\n      {targetElements.length > 1 && (<fieldset>\r\n          <legend>{t(\"labels.align\")}</legend>\r\n          <div className=\"buttonList\">\r\n            {\r\n            // swap this order for RTL so the button positions always match their action\r\n            // (i.e. the leftmost button aligns left)\r\n            }\r\n            {isRTL ? (<>\r\n                {renderAction(\"alignRight\")}\r\n                {renderAction(\"alignHorizontallyCentered\")}\r\n                {renderAction(\"alignLeft\")}\r\n              </>) : (<>\r\n                {renderAction(\"alignLeft\")}\r\n                {renderAction(\"alignHorizontallyCentered\")}\r\n                {renderAction(\"alignRight\")}\r\n              </>)}\r\n            {targetElements.length > 2 &&\r\n                renderAction(\"distributeHorizontally\")}\r\n            <div className=\"iconRow\">\r\n              {renderAction(\"alignTop\")}\r\n              {renderAction(\"alignVerticallyCentered\")}\r\n              {renderAction(\"alignBottom\")}\r\n              {targetElements.length > 2 &&\r\n                renderAction(\"distributeVertically\")}\r\n            </div>\r\n          </div>\r\n        </fieldset>)}\r\n      {!isMobile && !isEditing && targetElements.length > 0 && (<fieldset>\r\n          <legend>{t(\"labels.actions\")}</legend>\r\n          <div className=\"buttonList\">\r\n            {renderAction(\"duplicateSelection\")}\r\n            {renderAction(\"deleteSelectedElements\")}\r\n            {renderAction(\"group\")}\r\n            {renderAction(\"ungroup\")}\r\n          </div>\r\n        </fieldset>)}\r\n    </div>);\r\n};\r\nexport const ShapesSwitcher = ({ canvas, elementType, setAppState, onImageAction, }) => (<>\r\n    {SHAPES.map(({ value, icon, key }, index) => {\r\n        const label = t(`toolBar.${value}`);\r\n        const letter = key && (typeof key === \"string\" ? key : key[0]);\r\n        const shortcut = letter\r\n            ? `${capitalizeString(letter)} ${t(\"helpDialog.or\")} ${index + 1}`\r\n            : `${index + 1}`;\r\n        return (<ToolButton className=\"Shape\" key={value} type=\"radio\" icon={icon} checked={elementType === value} name=\"editor-current-shape\" title={`${capitalizeString(label)} — ${shortcut}`} keyBindingLabel={`${index + 1}`} aria-label={capitalizeString(label)} aria-keyshortcuts={shortcut} data-testid={value} onChange={({ pointerType }) => {\r\n                setAppState({\r\n                    elementType: value,\r\n                    multiElement: null,\r\n                    selectedElementIds: {},\r\n                });\r\n                setCursorForShape(canvas, value);\r\n                if (value === \"image\") {\r\n                    onImageAction({ pointerType });\r\n                }\r\n            }}/>);\r\n    })}\r\n  </>);\r\nexport const ZoomActions = ({ renderAction, zoom, }) => (<Stack.Col gap={1}>\r\n    <Stack.Row gap={1} align=\"center\">\r\n      {renderAction(\"zoomOut\")}\r\n      {renderAction(\"zoomIn\")}\r\n      {renderAction(\"resetZoom\")}\r\n    </Stack.Row>\r\n  </Stack.Col>);\r\n","import React from \"react\";\r\nexport const BackgroundPickerAndDarkModeToggle = ({ appState, setAppState, actionManager, showThemeBtn, }) => (<div style={{ display: \"flex\" }}>\r\n    {actionManager.renderAction(\"changeViewBackgroundColor\")}\r\n    {showThemeBtn && actionManager.renderAction(\"toggleTheme\")}\r\n  </div>);\r\n","import clsx from \"clsx\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { users } from \"./icons\";\r\nimport \"./CollabButton.scss\";\r\nconst CollabButton = ({ isCollaborating, collaboratorCount, onClick, }) => {\r\n    return (<>\r\n      <ToolButton className={clsx(\"CollabButton\", {\r\n            \"is-collaborating\": isCollaborating,\r\n        })} onClick={onClick} icon={users} type=\"button\" title={t(\"labels.liveCollaboration\")} aria-label={t(\"labels.liveCollaboration\")} showAriaLabel={useIsMobile()}>\r\n        {collaboratorCount > 0 && (<div className=\"CollabButton-collaborators\">{collaboratorCount}</div>)}\r\n      </ToolButton>\r\n    </>);\r\n};\r\nexport default CollabButton;\r\n","import React, { useEffect, useRef, useState } from \"react\";\r\nimport { render, unmountComponentAtNode } from \"react-dom\";\r\nimport { probablySupportsClipboardBlob } from \"../clipboard\";\r\nimport { canvasToBlob } from \"../data/blob\";\r\nimport { CanvasError } from \"../errors\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"./App\";\r\nimport { getSelectedElements, isSomeElementSelected } from \"../scene\";\r\nimport { exportToCanvas } from \"../scene/export\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { clipboard, exportImage } from \"./icons\";\r\nimport Stack from \"./Stack\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport \"./ExportDialog.scss\";\r\nimport OpenColor from \"open-color\";\r\nimport { CheckboxItem } from \"./CheckboxItem\";\r\nimport { DEFAULT_EXPORT_PADDING } from \"../constants\";\r\nimport { nativeFileSystemSupported } from \"../data/filesystem\";\r\nconst supportsContextFilters = \"filter\" in document.createElement(\"canvas\").getContext(\"2d\");\r\nexport const ErrorCanvasPreview = () => {\r\n    return (<div>\r\n      <h3>{t(\"canvasError.cannotShowPreview\")}</h3>\r\n      <p>\r\n        <span>{t(\"canvasError.canvasTooBig\")}</span>\r\n      </p>\r\n      <em>({t(\"canvasError.canvasTooBigTip\")})</em>\r\n    </div>);\r\n};\r\nconst renderPreview = (content, previewNode) => {\r\n    unmountComponentAtNode(previewNode);\r\n    previewNode.innerHTML = \"\";\r\n    if (content instanceof HTMLCanvasElement) {\r\n        previewNode.appendChild(content);\r\n    }\r\n    else {\r\n        render(<ErrorCanvasPreview />, previewNode);\r\n    }\r\n};\r\nconst ExportButton = ({ children, title, onClick, color, shade = 6 }) => {\r\n    return (<button className=\"ExportDialog-imageExportButton\" style={{\r\n            [\"--button-color\"]: OpenColor[color][shade],\r\n            [\"--button-color-darker\"]: OpenColor[color][shade + 1],\r\n            [\"--button-color-darkest\"]: OpenColor[color][shade + 2],\r\n        }} title={title} aria-label={title} onClick={onClick}>\r\n      {children}\r\n    </button>);\r\n};\r\nconst ImageExportModal = ({ elements, appState, files, exportPadding = DEFAULT_EXPORT_PADDING, actionManager, onExportToPng, onExportToSvg, onExportToClipboard, }) => {\r\n    const someElementIsSelected = isSomeElementSelected(elements, appState);\r\n    const [exportSelected, setExportSelected] = useState(someElementIsSelected);\r\n    const previewRef = useRef(null);\r\n    const { exportBackground, viewBackgroundColor } = appState;\r\n    const exportedElements = exportSelected\r\n        ? getSelectedElements(elements, appState)\r\n        : elements;\r\n    useEffect(() => {\r\n        setExportSelected(someElementIsSelected);\r\n    }, [someElementIsSelected]);\r\n    useEffect(() => {\r\n        const previewNode = previewRef.current;\r\n        if (!previewNode) {\r\n            return;\r\n        }\r\n        exportToCanvas(exportedElements, appState, files, {\r\n            exportBackground,\r\n            viewBackgroundColor,\r\n            exportPadding,\r\n        })\r\n            .then((canvas) => {\r\n            // if converting to blob fails, there's some problem that will\r\n            // likely prevent preview and export (e.g. canvas too big)\r\n            return canvasToBlob(canvas).then(() => {\r\n                renderPreview(canvas, previewNode);\r\n            });\r\n        })\r\n            .catch((error) => {\r\n            console.error(error);\r\n            renderPreview(new CanvasError(), previewNode);\r\n        });\r\n    }, [\r\n        appState,\r\n        files,\r\n        exportedElements,\r\n        exportBackground,\r\n        exportPadding,\r\n        viewBackgroundColor,\r\n    ]);\r\n    return (<div className=\"ExportDialog\">\r\n      <div className=\"ExportDialog__preview\" ref={previewRef}/>\r\n      {supportsContextFilters &&\r\n            actionManager.renderAction(\"exportWithDarkMode\")}\r\n      <div style={{ display: \"grid\", gridTemplateColumns: \"1fr\" }}>\r\n        <div style={{\r\n            display: \"grid\",\r\n            gridTemplateColumns: \"repeat(auto-fit, minmax(190px, 1fr))\",\r\n            // dunno why this is needed, but when the items wrap it creates\r\n            // an overflow\r\n            overflow: \"hidden\",\r\n        }}>\r\n          {actionManager.renderAction(\"changeExportBackground\")}\r\n          {someElementIsSelected && (<CheckboxItem checked={exportSelected} onChange={(checked) => setExportSelected(checked)}>\r\n              {t(\"labels.onlySelected\")}\r\n            </CheckboxItem>)}\r\n          {actionManager.renderAction(\"changeExportEmbedScene\")}\r\n        </div>\r\n      </div>\r\n      <div style={{ display: \"flex\", alignItems: \"center\", marginTop: \".6em\" }}>\r\n        <Stack.Row gap={2}>\r\n          {actionManager.renderAction(\"changeExportScale\")}\r\n        </Stack.Row>\r\n        <p style={{ marginLeft: \"1em\", userSelect: \"none\" }}>Scale</p>\r\n      </div>\r\n      <div style={{\r\n            display: \"flex\",\r\n            alignItems: \"center\",\r\n            justifyContent: \"center\",\r\n            margin: \".6em 0\",\r\n        }}>\r\n        {!nativeFileSystemSupported &&\r\n            actionManager.renderAction(\"changeProjectName\")}\r\n      </div>\r\n      <Stack.Row gap={2} justifyContent=\"center\" style={{ margin: \"2em 0\" }}>\r\n        <ExportButton color=\"indigo\" title={t(\"buttons.exportToPng\")} aria-label={t(\"buttons.exportToPng\")} onClick={() => onExportToPng(exportedElements)}>\r\n          PNG\r\n        </ExportButton>\r\n        <ExportButton color=\"red\" title={t(\"buttons.exportToSvg\")} aria-label={t(\"buttons.exportToSvg\")} onClick={() => onExportToSvg(exportedElements)}>\r\n          SVG\r\n        </ExportButton>\r\n        {probablySupportsClipboardBlob && (<ExportButton title={t(\"buttons.copyPngToClipboard\")} onClick={() => onExportToClipboard(exportedElements)} color=\"gray\" shade={7}>\r\n            {clipboard}\r\n          </ExportButton>)}\r\n      </Stack.Row>\r\n    </div>);\r\n};\r\nexport const ImageExportDialog = ({ elements, appState, files, exportPadding = DEFAULT_EXPORT_PADDING, actionManager, onExportToPng, onExportToSvg, onExportToClipboard, }) => {\r\n    const [modalIsShown, setModalIsShown] = useState(false);\r\n    const handleClose = React.useCallback(() => {\r\n        setModalIsShown(false);\r\n    }, []);\r\n    return (<>\r\n      <ToolButton onClick={() => {\r\n            setModalIsShown(true);\r\n        }} data-testid=\"image-export-button\" icon={exportImage} type=\"button\" aria-label={t(\"buttons.exportImage\")} showAriaLabel={useIsMobile()} title={t(\"buttons.exportImage\")}/>\r\n      {modalIsShown && (<Dialog onCloseRequest={handleClose} title={t(\"buttons.exportImage\")}>\r\n          <ImageExportModal elements={elements} appState={appState} files={files} exportPadding={exportPadding} actionManager={actionManager} onExportToPng={onExportToPng} onExportToSvg={onExportToSvg} onExportToClipboard={onExportToClipboard} onCloseRequest={handleClose}/>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\n","import \"./FixedSideContainer.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nexport const FixedSideContainer = ({ children, side, className, }) => (<div className={clsx(\"FixedSideContainer\", `FixedSideContainer_side_${side}`, className)}>\r\n    {children}\r\n  </div>);\r\n","import { t } from \"../i18n\";\r\nimport { getSelectedElements } from \"../scene\";\r\nimport \"./HintViewer.scss\";\r\nimport { isImageElement, isLinearElement, isTextElement, } from \"../element/typeChecks\";\r\nimport { getShortcutKey } from \"../utils\";\r\nconst getHints = ({ appState, elements, isMobile }) => {\r\n    const { elementType, isResizing, isRotating, lastPointerDownWith } = appState;\r\n    const multiMode = appState.multiElement !== null;\r\n    if (elementType === \"arrow\" || elementType === \"line\") {\r\n        if (!multiMode) {\r\n            return t(\"hints.linearElement\");\r\n        }\r\n        return t(\"hints.linearElementMulti\");\r\n    }\r\n    if (elementType === \"freedraw\") {\r\n        return t(\"hints.freeDraw\");\r\n    }\r\n    if (elementType === \"text\") {\r\n        return t(\"hints.text\");\r\n    }\r\n    if (appState.elementType === \"image\" && appState.pendingImageElement) {\r\n        return t(\"hints.placeImage\");\r\n    }\r\n    const selectedElements = getSelectedElements(elements, appState);\r\n    if (isResizing &&\r\n        lastPointerDownWith === \"mouse\" &&\r\n        selectedElements.length === 1) {\r\n        const targetElement = selectedElements[0];\r\n        if (isLinearElement(targetElement) && targetElement.points.length === 2) {\r\n            return t(\"hints.lockAngle\");\r\n        }\r\n        return isImageElement(targetElement)\r\n            ? t(\"hints.resizeImage\")\r\n            : t(\"hints.resize\");\r\n    }\r\n    if (isRotating && lastPointerDownWith === \"mouse\") {\r\n        return t(\"hints.rotate\");\r\n    }\r\n    if (selectedElements.length === 1 && isLinearElement(selectedElements[0])) {\r\n        if (appState.editingLinearElement) {\r\n            return appState.editingLinearElement.activePointIndex\r\n                ? t(\"hints.lineEditor_pointSelected\")\r\n                : t(\"hints.lineEditor_nothingSelected\");\r\n        }\r\n        return t(\"hints.lineEditor_info\");\r\n    }\r\n    if (selectedElements.length === 1 && isTextElement(selectedElements[0])) {\r\n        return t(\"hints.text_selected\");\r\n    }\r\n    if (appState.editingElement && isTextElement(appState.editingElement)) {\r\n        return t(\"hints.text_editing\");\r\n    }\r\n    if (elementType === \"selection\" && !selectedElements.length && !isMobile) {\r\n        return t(\"hints.canvasPanning\");\r\n    }\r\n    return null;\r\n};\r\nexport const HintViewer = ({ appState, elements, isMobile, }) => {\r\n    let hint = getHints({\r\n        appState,\r\n        elements,\r\n        isMobile,\r\n    });\r\n    if (!hint) {\r\n        return null;\r\n    }\r\n    hint = getShortcutKey(hint);\r\n    return (<div className=\"HintViewer\">\r\n      <span>{hint}</span>\r\n    </div>);\r\n};\r\n","import \"./Island.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nexport const Island = React.forwardRef(({ children, padding, className, style }, ref) => (<div className={clsx(\"Island\", className)} style={{ \"--padding\": padding, ...style }} ref={ref}>\r\n      {children}\r\n    </div>));\r\n","import clsx from \"clsx\";\r\nimport oc from \"open-color\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\nimport { close } from \"../components/icons\";\r\nimport { MIME_TYPES } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { exportToSvg } from \"../scene/export\";\r\nimport \"./LibraryUnit.scss\";\r\n// fa-plus\r\nconst PLUS_ICON = (<svg viewBox=\"0 0 1792 1792\">\r\n    <path fill=\"currentColor\" d=\"M1600 736v192q0 40-28 68t-68 28h-416v416q0 40-28 68t-68 28h-192q-40 0-68-28t-28-68v-416h-416q-40 0-68-28t-28-68v-192q0-40 28-68t68-28h416v-416q0-40 28-68t68-28h192q40 0 68 28t28 68v416h416q40 0 68 28t28 68z\"/>\r\n  </svg>);\r\nexport const LibraryUnit = ({ elements, files, pendingElements, onRemoveFromLibrary, onClick, }) => {\r\n    const ref = useRef(null);\r\n    useEffect(() => {\r\n        const node = ref.current;\r\n        if (!node) {\r\n            return;\r\n        }\r\n        (async () => {\r\n            const elementsToRender = elements || pendingElements;\r\n            if (!elementsToRender) {\r\n                return;\r\n            }\r\n            const svg = await exportToSvg(elementsToRender, {\r\n                exportBackground: false,\r\n                viewBackgroundColor: oc.white,\r\n            }, files);\r\n            node.innerHTML = svg.outerHTML;\r\n        })();\r\n        return () => {\r\n            node.innerHTML = \"\";\r\n        };\r\n    }, [elements, pendingElements, files]);\r\n    const [isHovered, setIsHovered] = useState(false);\r\n    const isMobile = useIsMobile();\r\n    const adder = (isHovered || isMobile) && pendingElements && (<div className=\"library-unit__adder\">{PLUS_ICON}</div>);\r\n    return (<div className={clsx(\"library-unit\", {\r\n            \"library-unit__active\": elements || pendingElements,\r\n        })} onMouseEnter={() => setIsHovered(true)} onMouseLeave={() => setIsHovered(false)}>\r\n      <div className={clsx(\"library-unit__dragger\", {\r\n            \"library-unit__pulse\": !!pendingElements,\r\n        })} ref={ref} draggable={!!elements} onClick={!!elements || !!pendingElements ? onClick : undefined} onDragStart={(event) => {\r\n            setIsHovered(false);\r\n            event.dataTransfer.setData(MIME_TYPES.excalidrawlib, JSON.stringify(elements));\r\n        }}/>\r\n      {adder}\r\n      {elements && (isHovered || isMobile) && (<button className=\"library-unit__removeFromLibrary\" aria-label={t(\"labels.removeFromLibrary\")} onClick={onRemoveFromLibrary}>\r\n          {close}\r\n        </button>)}\r\n    </div>);\r\n};\r\n","import { t } from \"../i18n\";\r\nexport const LoadingMessage = () => {\r\n    // !! KEEP THIS IN SYNC WITH index.html !!\r\n    return (<div className=\"LoadingMessage\">\r\n      <span>{t(\"labels.loadingScene\")}</span>\r\n    </div>);\r\n};\r\n","import \"./ToolIcon.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nconst DEFAULT_SIZE = \"medium\";\r\nconst ICONS = {\r\n    CHECKED: (<svg width=\"1792\" height=\"1792\" viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\">\r\n      <path d=\"M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z\"/>\r\n    </svg>),\r\n    UNCHECKED: (<svg width=\"1792\" height=\"1792\" viewBox=\"0 0 1792 1792\" xmlns=\"http://www.w3.org/2000/svg\" className=\"unlocked-icon rtl-mirror\">\r\n      <path d=\"M1728 576v256q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45v-256q0-106-75-181t-181-75-181 75-75 181v192h96q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h672v-192q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5z\"/>\r\n    </svg>),\r\n};\r\nexport const LockButton = (props) => {\r\n    return (<label className={clsx(\"ToolIcon ToolIcon__lock ToolIcon_type_floating zen-mode-visibility\", `ToolIcon_size_${DEFAULT_SIZE}`, {\r\n            \"zen-mode-visibility--hidden\": props.zenModeEnabled,\r\n        })} title={`${props.title} — Q`}>\r\n      <input className=\"ToolIcon_type_checkbox\" type=\"checkbox\" name={props.name} onChange={props.onChange} checked={props.checked} aria-label={props.title}/>\r\n      <div className=\"ToolIcon__icon\">\r\n        {props.checked ? ICONS.CHECKED : ICONS.UNCHECKED}\r\n      </div>\r\n    </label>);\r\n};\r\n","import React from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nexport const Section = ({ heading, children, ...props }) => {\r\n    const { id } = useExcalidrawContainer();\r\n    const header = (<h2 className=\"visually-hidden\" id={`${id}-${heading}-title`}>\r\n      {t(`headings.${heading}`)}\r\n    </h2>);\r\n    return (<section {...props} aria-labelledby={`${id}-${heading}-title`}>\r\n      {typeof children === \"function\" ? (children(header)) : (<>\r\n          {header}\r\n          {children}\r\n        </>)}\r\n    </section>);\r\n};\r\n","import \"./UserList.scss\";\r\nimport React from \"react\";\r\nimport clsx from \"clsx\";\r\nexport const UserList = ({ children, className, mobile }) => {\r\n    return (<div className={clsx(\"UserList\", className, { UserList_mobile: mobile })}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import React from \"react\";\r\nimport clsx from \"clsx\";\r\nimport { t } from \"../i18n\";\r\nimport { capitalizeString } from \"../utils\";\r\nconst LIBRARY_ICON = (<svg viewBox=\"0 0 576 512\">\r\n    <path fill=\"currentColor\" d=\"M542.22 32.05c-54.8 3.11-163.72 14.43-230.96 55.59-4.64 2.84-7.27 7.89-7.27 13.17v363.87c0 11.55 12.63 18.85 23.28 13.49 69.18-34.82 169.23-44.32 218.7-46.92 16.89-.89 30.02-14.43 30.02-30.66V62.75c.01-17.71-15.35-31.74-33.77-30.7zM264.73 87.64C197.5 46.48 88.58 35.17 33.78 32.05 15.36 31.01 0 45.04 0 62.75V400.6c0 16.24 13.13 29.78 30.02 30.66 49.49 2.6 149.59 12.11 218.77 46.95 10.62 5.35 23.21-1.94 23.21-13.46V100.63c0-5.29-2.62-10.14-7.27-12.99z\"></path>\r\n  </svg>);\r\nexport const LibraryButton = ({ appState, setAppState }) => {\r\n    return (<label className={clsx(\"ToolIcon ToolIcon_type_floating ToolIcon__library zen-mode-visibility\", `ToolIcon_size_medium`, {\r\n            \"zen-mode-visibility--hidden\": appState.zenModeEnabled,\r\n        })} title={`${capitalizeString(t(\"toolBar.library\"))} — 0`} style={{ marginInlineStart: \"var(--space-factor)\" }}>\r\n      <input className=\"ToolIcon_type_checkbox\" type=\"checkbox\" name=\"editor-library\" onChange={(event) => {\r\n            setAppState({ isLibraryOpen: event.target.checked });\r\n        }} checked={appState.isLibraryOpen} aria-label={capitalizeString(t(\"toolBar.library\"))} aria-keyshortcuts=\"0\"/>\r\n      <div className=\"ToolIcon__icon\">{LIBRARY_ICON}</div>\r\n    </label>);\r\n};\r\n","import React from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport Stack from \"./Stack\";\r\nimport { showSelectedShapeActions } from \"../element\";\r\nimport { FixedSideContainer } from \"./FixedSideContainer\";\r\nimport { Island } from \"./Island\";\r\nimport { HintViewer } from \"./HintViewer\";\r\nimport { calculateScrollCenter } from \"../scene\";\r\nimport { SelectedShapeActions, ShapesSwitcher } from \"./Actions\";\r\nimport { Section } from \"./Section\";\r\nimport CollabButton from \"./CollabButton\";\r\nimport { SCROLLBAR_WIDTH, SCROLLBAR_MARGIN } from \"../scene/scrollbars\";\r\nimport { LockButton } from \"./LockButton\";\r\nimport { UserList } from \"./UserList\";\r\nimport { BackgroundPickerAndDarkModeToggle } from \"./BackgroundPickerAndDarkModeToggle\";\r\nimport { LibraryButton } from \"./LibraryButton\";\r\nexport const MobileMenu = ({ appState, elements, libraryMenu, actionManager, renderJSONExportDialog, renderImageExportDialog, setAppState, onCollabButtonClick, onLockToggle, canvas, isCollaborating, renderCustomFooter, viewModeEnabled, showThemeBtn, onImageAction, renderTopRightUI, }) => {\r\n    const renderToolbar = () => {\r\n        return (<FixedSideContainer side=\"top\" className=\"App-top-bar\">\r\n        <Section heading=\"shapes\">\r\n          {(heading) => (<Stack.Col gap={4} align=\"center\">\r\n              <Stack.Row gap={1}>\r\n                <Island padding={1}>\r\n                  {heading}\r\n                  <Stack.Row gap={1}>\r\n                    <ShapesSwitcher canvas={canvas} elementType={appState.elementType} setAppState={setAppState} onImageAction={({ pointerType }) => {\r\n                    onImageAction({\r\n                        insertOnCanvasDirectly: pointerType !== \"mouse\",\r\n                    });\r\n                }}/>\r\n                  </Stack.Row>\r\n                </Island>\r\n                {renderTopRightUI && renderTopRightUI(true, appState)}\r\n                <LockButton checked={appState.elementLocked} onChange={onLockToggle} title={t(\"toolBar.lock\")}/>\r\n                <LibraryButton appState={appState} setAppState={setAppState}/>\r\n              </Stack.Row>\r\n              {libraryMenu}\r\n            </Stack.Col>)}\r\n        </Section>\r\n        <HintViewer appState={appState} elements={elements} isMobile={true}/>\r\n      </FixedSideContainer>);\r\n    };\r\n    const renderAppToolbar = () => {\r\n        if (viewModeEnabled) {\r\n            return (<div className=\"App-toolbar-content\">\r\n          {actionManager.renderAction(\"toggleCanvasMenu\")}\r\n        </div>);\r\n        }\r\n        return (<div className=\"App-toolbar-content\">\r\n        {actionManager.renderAction(\"toggleCanvasMenu\")}\r\n        {actionManager.renderAction(\"toggleEditMenu\")}\r\n        {actionManager.renderAction(\"undo\")}\r\n        {actionManager.renderAction(\"redo\")}\r\n        {actionManager.renderAction(appState.multiElement ? \"finalize\" : \"duplicateSelection\")}\r\n        {actionManager.renderAction(\"deleteSelectedElements\")}\r\n      </div>);\r\n    };\r\n    const renderCanvasActions = () => {\r\n        if (viewModeEnabled) {\r\n            return (<>\r\n          {renderJSONExportDialog()}\r\n          {renderImageExportDialog()}\r\n        </>);\r\n        }\r\n        return (<>\r\n        {actionManager.renderAction(\"clearCanvas\")}\r\n        {actionManager.renderAction(\"loadScene\")}\r\n        {renderJSONExportDialog()}\r\n        {renderImageExportDialog()}\r\n        {onCollabButtonClick && (<CollabButton isCollaborating={isCollaborating} collaboratorCount={appState.collaborators.size} onClick={onCollabButtonClick}/>)}\r\n        {<BackgroundPickerAndDarkModeToggle actionManager={actionManager} appState={appState} setAppState={setAppState} showThemeBtn={showThemeBtn}/>}\r\n      </>);\r\n    };\r\n    return (<>\r\n      {!viewModeEnabled && renderToolbar()}\r\n      <div className=\"App-bottom-bar\" style={{\r\n            marginBottom: SCROLLBAR_WIDTH + SCROLLBAR_MARGIN * 2,\r\n            marginLeft: SCROLLBAR_WIDTH + SCROLLBAR_MARGIN * 2,\r\n            marginRight: SCROLLBAR_WIDTH + SCROLLBAR_MARGIN * 2,\r\n        }}>\r\n        <Island padding={0}>\r\n          {appState.openMenu === \"canvas\" ? (<Section className=\"App-mobile-menu\" heading=\"canvasActions\">\r\n              <div className=\"panelColumn\">\r\n                <Stack.Col gap={4}>\r\n                  {renderCanvasActions()}\r\n                  {renderCustomFooter?.(true, appState)}\r\n                  {appState.collaborators.size > 0 && (<fieldset>\r\n                      <legend>{t(\"labels.collaborators\")}</legend>\r\n                      <UserList mobile>\r\n                        {Array.from(appState.collaborators)\r\n                    // Collaborator is either not initialized or is actually the current user.\r\n                    .filter(([_, client]) => Object.keys(client).length !== 0)\r\n                    .map(([clientId, client]) => (<React.Fragment key={clientId}>\r\n                              {actionManager.renderAction(\"goToCollaborator\", {\r\n                        id: clientId,\r\n                    })}\r\n                            </React.Fragment>))}\r\n                      </UserList>\r\n                    </fieldset>)}\r\n                </Stack.Col>\r\n              </div>\r\n            </Section>) : appState.openMenu === \"shape\" &&\r\n            !viewModeEnabled &&\r\n            showSelectedShapeActions(appState, elements) ? (<Section className=\"App-mobile-menu\" heading=\"selectedShapeActions\">\r\n              <SelectedShapeActions appState={appState} elements={elements} renderAction={actionManager.renderAction} elementType={appState.elementType}/>\r\n            </Section>) : null}\r\n          <footer className=\"App-toolbar\">\r\n            {renderAppToolbar()}\r\n            {appState.scrolledOutside && !appState.openMenu && (<button className=\"scroll-back-to-content\" onClick={() => {\r\n                setAppState({\r\n                    ...calculateScrollCenter(elements, appState, canvas),\r\n                });\r\n            }}>\r\n                {t(\"buttons.scrollBackToContent\")}\r\n              </button>)}\r\n          </footer>\r\n        </Island>\r\n      </div>\r\n    </>);\r\n};\r\n","import oc from \"open-color\";\r\nimport React, { useLayoutEffect, useRef, useState } from \"react\";\r\nimport { trackEvent } from \"../analytics\";\r\nimport { renderSpreadsheet } from \"../charts\";\r\nimport { t } from \"../i18n\";\r\nimport { exportToSvg } from \"../scene/export\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport \"./PasteChartDialog.scss\";\r\nconst ChartPreviewBtn = (props) => {\r\n    const previewRef = useRef(null);\r\n    const [chartElements, setChartElements] = useState(null);\r\n    useLayoutEffect(() => {\r\n        if (!props.spreadsheet) {\r\n            return;\r\n        }\r\n        const elements = renderSpreadsheet(props.chartType, props.spreadsheet, 0, 0);\r\n        setChartElements(elements);\r\n        let svg;\r\n        const previewNode = previewRef.current;\r\n        (async () => {\r\n            svg = await exportToSvg(elements, {\r\n                exportBackground: false,\r\n                viewBackgroundColor: oc.white,\r\n            }, null);\r\n            previewNode.appendChild(svg);\r\n            if (props.selected) {\r\n                previewNode.parentNode.focus();\r\n            }\r\n        })();\r\n        return () => {\r\n            previewNode.removeChild(svg);\r\n        };\r\n    }, [props.spreadsheet, props.chartType, props.selected]);\r\n    return (<button className=\"ChartPreview\" onClick={() => {\r\n            if (chartElements) {\r\n                props.onClick(props.chartType, chartElements);\r\n            }\r\n        }}>\r\n      <div ref={previewRef}/>\r\n    </button>);\r\n};\r\nexport const PasteChartDialog = ({ setAppState, appState, onClose, onInsertChart, }) => {\r\n    const handleClose = React.useCallback(() => {\r\n        if (onClose) {\r\n            onClose();\r\n        }\r\n    }, [onClose]);\r\n    const handleChartClick = (chartType, elements) => {\r\n        onInsertChart(elements);\r\n        trackEvent(\"magic\", \"chart\", chartType);\r\n        setAppState({\r\n            currentChartType: chartType,\r\n            pasteDialog: {\r\n                shown: false,\r\n                data: null,\r\n            },\r\n        });\r\n    };\r\n    return (<Dialog small onCloseRequest={handleClose} title={t(\"labels.pasteCharts\")} className={\"PasteChartDialog\"} autofocus={false}>\r\n      <div className={\"container\"}>\r\n        <ChartPreviewBtn chartType=\"bar\" spreadsheet={appState.pasteDialog.data} selected={appState.currentChartType === \"bar\"} onClick={handleChartClick}/>\r\n        <ChartPreviewBtn chartType=\"line\" spreadsheet={appState.pasteDialog.data} selected={appState.currentChartType === \"line\"} onClick={handleChartClick}/>\r\n      </div>\r\n    </Dialog>);\r\n};\r\n","import React from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { isDarwin, isWindows } from \"../keys\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { getShortcutKey } from \"../utils\";\r\nimport \"./HelpDialog.scss\";\r\nconst Header = () => (<div className=\"HelpDialog--header\">\r\n    <a className=\"HelpDialog--btn\" href=\"https://github.com/excalidraw/excalidraw#documentation\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n      {t(\"helpDialog.documentation\")}\r\n    </a>\r\n    <a className=\"HelpDialog--btn\" href=\"https://blog.excalidraw.com\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n      {t(\"helpDialog.blog\")}\r\n    </a>\r\n    <a className=\"HelpDialog--btn\" href=\"https://github.com/excalidraw/excalidraw/issues\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n      {t(\"helpDialog.github\")}\r\n    </a>\r\n  </div>);\r\nconst Section = (props) => (<>\r\n    <h3>{props.title}</h3>\r\n    {props.children}\r\n  </>);\r\nconst Columns = (props) => (<div style={{\r\n        display: \"flex\",\r\n        flexDirection: \"row\",\r\n        flexWrap: \"wrap\",\r\n        justifyContent: \"space-between\",\r\n    }}>\r\n    {props.children}\r\n  </div>);\r\nconst Column = (props) => (<div style={{ width: \"49%\" }}>{props.children}</div>);\r\nconst ShortcutIsland = (props) => (<div className=\"HelpDialog--island\">\r\n    <h3 className=\"HelpDialog--island-title\">{props.caption}</h3>\r\n    {props.children}\r\n  </div>);\r\nconst Shortcut = (props) => {\r\n    return (<div className=\"HelpDialog--shortcut\">\r\n      <div style={{\r\n            display: \"flex\",\r\n            margin: \"0\",\r\n            padding: \"4px 8px\",\r\n            alignItems: \"center\",\r\n        }}>\r\n        <div style={{\r\n            lineHeight: 1.4,\r\n        }}>\r\n          {props.label}\r\n        </div>\r\n        <div style={{\r\n            display: \"flex\",\r\n            flex: \"0 0 auto\",\r\n            justifyContent: \"flex-end\",\r\n            marginInlineStart: \"auto\",\r\n            minWidth: \"30%\",\r\n        }}>\r\n          {props.shortcuts.map((shortcut, index) => (<React.Fragment key={index}>\r\n              <ShortcutKey>{shortcut}</ShortcutKey>\r\n              {props.isOr &&\r\n                index !== props.shortcuts.length - 1 &&\r\n                t(\"helpDialog.or\")}\r\n            </React.Fragment>))}\r\n        </div>\r\n      </div>\r\n    </div>);\r\n};\r\nShortcut.defaultProps = {\r\n    isOr: true,\r\n};\r\nconst ShortcutKey = (props) => (<kbd className=\"HelpDialog--key\" {...props}/>);\r\nexport const HelpDialog = ({ onClose }) => {\r\n    const handleClose = React.useCallback(() => {\r\n        if (onClose) {\r\n            onClose();\r\n        }\r\n    }, [onClose]);\r\n    return (<>\r\n      <Dialog onCloseRequest={handleClose} title={t(\"helpDialog.title\")} className={\"HelpDialog\"}>\r\n        <Header />\r\n        <Section title={t(\"helpDialog.shortcuts\")}>\r\n          <Columns>\r\n            <Column>\r\n              <ShortcutIsland caption={t(\"helpDialog.shapes\")}>\r\n                <Shortcut label={t(\"toolBar.selection\")} shortcuts={[\"V\", \"1\"]}/>\r\n                <Shortcut label={t(\"toolBar.rectangle\")} shortcuts={[\"R\", \"2\"]}/>\r\n                <Shortcut label={t(\"toolBar.diamond\")} shortcuts={[\"D\", \"3\"]}/>\r\n                <Shortcut label={t(\"toolBar.ellipse\")} shortcuts={[\"E\", \"4\"]}/>\r\n                <Shortcut label={t(\"toolBar.arrow\")} shortcuts={[\"A\", \"5\"]}/>\r\n                <Shortcut label={t(\"toolBar.line\")} shortcuts={[\"P\", \"6\"]}/>\r\n                <Shortcut label={t(\"toolBar.freedraw\")} shortcuts={[\"Shift+P\", \"7\"]}/>\r\n                <Shortcut label={t(\"toolBar.text\")} shortcuts={[\"T\", \"8\"]}/>\r\n                <Shortcut label={t(\"toolBar.image\")} shortcuts={[\"9\"]}/>\r\n                <Shortcut label={t(\"toolBar.library\")} shortcuts={[\"0\"]}/>\r\n                <Shortcut label={t(\"helpDialog.editSelectedShape\")} shortcuts={[\r\n            getShortcutKey(\"Enter\"),\r\n            t(\"helpDialog.doubleClick\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"helpDialog.textNewLine\")} shortcuts={[\r\n            getShortcutKey(\"Enter\"),\r\n            getShortcutKey(\"Shift+Enter\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"helpDialog.textFinish\")} shortcuts={[\r\n            getShortcutKey(\"Esc\"),\r\n            getShortcutKey(\"CtrlOrCmd+Enter\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"helpDialog.curvedArrow\")} shortcuts={[\r\n            \"A\",\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n        ]} isOr={false}/>\r\n                <Shortcut label={t(\"helpDialog.curvedLine\")} shortcuts={[\r\n            \"L\",\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n            t(\"helpDialog.click\"),\r\n        ]} isOr={false}/>\r\n                <Shortcut label={t(\"toolBar.lock\")} shortcuts={[\"Q\"]}/>\r\n                <Shortcut label={t(\"helpDialog.preventBinding\")} shortcuts={[getShortcutKey(\"CtrlOrCmd\")]}/>\r\n              </ShortcutIsland>\r\n              <ShortcutIsland caption={t(\"helpDialog.view\")}>\r\n                <Shortcut label={t(\"buttons.zoomIn\")} shortcuts={[getShortcutKey(\"CtrlOrCmd++\")]}/>\r\n                <Shortcut label={t(\"buttons.zoomOut\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+-\")]}/>\r\n                <Shortcut label={t(\"buttons.resetZoom\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+0\")]}/>\r\n                <Shortcut label={t(\"helpDialog.zoomToFit\")} shortcuts={[\"Shift+1\"]}/>\r\n                <Shortcut label={t(\"helpDialog.zoomToSelection\")} shortcuts={[\"Shift+2\"]}/>\r\n                <Shortcut label={t(\"buttons.fullScreen\")} shortcuts={[\"F\"]}/>\r\n                <Shortcut label={t(\"buttons.zenMode\")} shortcuts={[getShortcutKey(\"Alt+Z\")]}/>\r\n                <Shortcut label={t(\"labels.showGrid\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+'\")]}/>\r\n                <Shortcut label={t(\"labels.viewMode\")} shortcuts={[getShortcutKey(\"Alt+R\")]}/>\r\n                <Shortcut label={t(\"labels.toggleTheme\")} shortcuts={[getShortcutKey(\"Alt+Shift+D\")]}/>\r\n                <Shortcut label={t(\"stats.title\")} shortcuts={[getShortcutKey(\"Alt+/\")]}/>\r\n              </ShortcutIsland>\r\n            </Column>\r\n            <Column>\r\n              <ShortcutIsland caption={t(\"helpDialog.editor\")}>\r\n                <Shortcut label={t(\"labels.selectAll\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+A\")]}/>\r\n                <Shortcut label={t(\"labels.multiSelect\")} shortcuts={[getShortcutKey(`Shift+${t(\"helpDialog.click\")}`)]}/>\r\n                <Shortcut label={t(\"labels.moveCanvas\")} shortcuts={[\r\n            getShortcutKey(`Space+${t(\"helpDialog.drag\")}`),\r\n            getShortcutKey(`Wheel+${t(\"helpDialog.drag\")}`),\r\n        ]} isOr={true}/>\r\n                <Shortcut label={t(\"labels.cut\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+X\")]}/>\r\n                <Shortcut label={t(\"labels.copy\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+C\")]}/>\r\n                <Shortcut label={t(\"labels.paste\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+V\")]}/>\r\n                <Shortcut label={t(\"labels.copyAsPng\")} shortcuts={[getShortcutKey(\"Shift+Alt+C\")]}/>\r\n                <Shortcut label={t(\"labels.copyStyles\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Alt+C\")]}/>\r\n                <Shortcut label={t(\"labels.pasteStyles\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Alt+V\")]}/>\r\n                <Shortcut label={t(\"labels.delete\")} shortcuts={[getShortcutKey(\"Del\")]}/>\r\n                <Shortcut label={t(\"labels.sendToBack\")} shortcuts={[\r\n            isDarwin\r\n                ? getShortcutKey(\"CtrlOrCmd+Alt+[\")\r\n                : getShortcutKey(\"CtrlOrCmd+Shift+[\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"labels.bringToFront\")} shortcuts={[\r\n            isDarwin\r\n                ? getShortcutKey(\"CtrlOrCmd+Alt+]\")\r\n                : getShortcutKey(\"CtrlOrCmd+Shift+]\"),\r\n        ]}/>\r\n                <Shortcut label={t(\"labels.sendBackward\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+[\")]}/>\r\n                <Shortcut label={t(\"labels.bringForward\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+]\")]}/>\r\n                <Shortcut label={t(\"labels.alignTop\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Up\")]}/>\r\n                <Shortcut label={t(\"labels.alignBottom\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Down\")]}/>\r\n                <Shortcut label={t(\"labels.alignLeft\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Left\")]}/>\r\n                <Shortcut label={t(\"labels.alignRight\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+Right\")]}/>\r\n                <Shortcut label={t(\"labels.duplicateSelection\")} shortcuts={[\r\n            getShortcutKey(\"CtrlOrCmd+D\"),\r\n            getShortcutKey(`Alt+${t(\"helpDialog.drag\")}`),\r\n        ]}/>\r\n                <Shortcut label={t(\"buttons.undo\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Z\")]}/>\r\n                <Shortcut label={t(\"buttons.redo\")} shortcuts={isWindows\r\n            ? [\r\n                getShortcutKey(\"CtrlOrCmd+Y\"),\r\n                getShortcutKey(\"CtrlOrCmd+Shift+Z\"),\r\n            ]\r\n            : [getShortcutKey(\"CtrlOrCmd+Shift+Z\")]}/>\r\n                <Shortcut label={t(\"labels.group\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+G\")]}/>\r\n                <Shortcut label={t(\"labels.ungroup\")} shortcuts={[getShortcutKey(\"CtrlOrCmd+Shift+G\")]}/>\r\n                <Shortcut label={t(\"labels.flipHorizontal\")} shortcuts={[getShortcutKey(\"Shift+H\")]}/>\r\n                <Shortcut label={t(\"labels.flipVertical\")} shortcuts={[getShortcutKey(\"Shift+V\")]}/>\r\n                <Shortcut label={t(\"labels.showStroke\")} shortcuts={[getShortcutKey(\"S\")]}/>\r\n                <Shortcut label={t(\"labels.showBackground\")} shortcuts={[getShortcutKey(\"G\")]}/>\r\n              </ShortcutIsland>\r\n            </Column>\r\n          </Columns>\r\n        </Section>\r\n      </Dialog>\r\n    </>);\r\n};\r\n","import OpenColor from \"open-color\";\r\nimport \"./Card.scss\";\r\nexport const Card = ({ children, color }) => {\r\n    return (<div className=\"Card\" style={{\r\n            [\"--card-color\"]: OpenColor[color][7],\r\n            [\"--card-color-darker\"]: OpenColor[color][8],\r\n            [\"--card-color-darkest\"]: OpenColor[color][9],\r\n        }}>\r\n      {children}\r\n    </div>);\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"./App\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { exportFile, exportToFileIcon, link } from \"./icons\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { actionSaveFileToDisk } from \"../actions/actionExport\";\r\nimport { Card } from \"./Card\";\r\nimport \"./ExportDialog.scss\";\r\nimport { nativeFileSystemSupported } from \"../data/filesystem\";\r\nconst JSONExportModal = ({ elements, appState, files, actionManager, exportOpts, canvas, }) => {\r\n    const { onExportToBackend } = exportOpts;\r\n    return (<div className=\"ExportDialog ExportDialog--json\">\r\n      <div className=\"ExportDialog-cards\">\r\n        {exportOpts.saveFileToDisk && (<Card color=\"lime\">\r\n            <div className=\"Card-icon\">{exportToFileIcon}</div>\r\n            <h2>{t(\"exportDialog.disk_title\")}</h2>\r\n            <div className=\"Card-details\">\r\n              {t(\"exportDialog.disk_details\")}\r\n              {!nativeFileSystemSupported &&\r\n                actionManager.renderAction(\"changeProjectName\")}\r\n            </div>\r\n            <ToolButton className=\"Card-button\" type=\"button\" title={t(\"exportDialog.disk_button\")} aria-label={t(\"exportDialog.disk_button\")} showAriaLabel={true} onClick={() => {\r\n                actionManager.executeAction(actionSaveFileToDisk);\r\n            }}/>\r\n          </Card>)}\r\n        {onExportToBackend && (<Card color=\"pink\">\r\n            <div className=\"Card-icon\">{link}</div>\r\n            <h2>{t(\"exportDialog.link_title\")}</h2>\r\n            <div className=\"Card-details\">{t(\"exportDialog.link_details\")}</div>\r\n            <ToolButton className=\"Card-button\" type=\"button\" title={t(\"exportDialog.link_button\")} aria-label={t(\"exportDialog.link_button\")} showAriaLabel={true} onClick={() => onExportToBackend(elements, appState, files, canvas)}/>\r\n          </Card>)}\r\n        {exportOpts.renderCustomUI &&\r\n            exportOpts.renderCustomUI(elements, appState, files, canvas)}\r\n      </div>\r\n    </div>);\r\n};\r\nexport const JSONExportDialog = ({ elements, appState, files, actionManager, exportOpts, canvas, }) => {\r\n    const [modalIsShown, setModalIsShown] = useState(false);\r\n    const handleClose = React.useCallback(() => {\r\n        setModalIsShown(false);\r\n    }, []);\r\n    return (<>\r\n      <ToolButton onClick={() => {\r\n            setModalIsShown(true);\r\n        }} data-testid=\"json-export-button\" icon={exportFile} type=\"button\" aria-label={t(\"buttons.export\")} showAriaLabel={useIsMobile()} title={t(\"buttons.export\")}/>\r\n      {modalIsShown && (<Dialog onCloseRequest={handleClose} title={t(\"buttons.export\")}>\r\n          <JSONExportModal elements={elements} appState={appState} files={files} actionManager={actionManager} onCloseRequest={handleClose} exportOpts={exportOpts} canvas={canvas}/>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\n","import clsx from \"clsx\";\r\nimport React, { useCallback, useEffect, useRef, useState, } from \"react\";\r\nimport { CLASSES } from \"../constants\";\r\nimport { exportCanvas } from \"../data\";\r\nimport { importLibraryFromJSON, saveLibraryAsJSON } from \"../data/json\";\r\nimport { isTextElement, showSelectedShapeActions } from \"../element\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { calculateScrollCenter, getSelectedElements } from \"../scene\";\r\nimport { muteFSAbortError } from \"../utils\";\r\nimport { SelectedShapeActions, ShapesSwitcher, ZoomActions } from \"./Actions\";\r\nimport { BackgroundPickerAndDarkModeToggle } from \"./BackgroundPickerAndDarkModeToggle\";\r\nimport CollabButton from \"./CollabButton\";\r\nimport { ErrorDialog } from \"./ErrorDialog\";\r\nimport { ImageExportDialog } from \"./ImageExportDialog\";\r\nimport { FixedSideContainer } from \"./FixedSideContainer\";\r\nimport { HintViewer } from \"./HintViewer\";\r\nimport { exportFile, load, trash } from \"./icons\";\r\nimport { Island } from \"./Island\";\r\nimport \"./LayerUI.scss\";\r\nimport { LibraryUnit } from \"./LibraryUnit\";\r\nimport { LoadingMessage } from \"./LoadingMessage\";\r\nimport { LockButton } from \"./LockButton\";\r\nimport { MobileMenu } from \"./MobileMenu\";\r\nimport { PasteChartDialog } from \"./PasteChartDialog\";\r\nimport { Section } from \"./Section\";\r\nimport { HelpDialog } from \"./HelpDialog\";\r\nimport Stack from \"./Stack\";\r\nimport { ToolButton } from \"./ToolButton\";\r\nimport { Tooltip } from \"./Tooltip\";\r\nimport { UserList } from \"./UserList\";\r\nimport { JSONExportDialog } from \"./JSONExportDialog\";\r\nimport { LibraryButton } from \"./LibraryButton\";\r\nimport { isImageFileHandle } from \"../data/blob\";\r\nconst useOnClickOutside = (ref, cb) => {\r\n    useEffect(() => {\r\n        const listener = (event) => {\r\n            if (!ref.current) {\r\n                return;\r\n            }\r\n            if (event.target instanceof Element &&\r\n                (ref.current.contains(event.target) ||\r\n                    !document.body.contains(event.target))) {\r\n                return;\r\n            }\r\n            cb(event);\r\n        };\r\n        document.addEventListener(\"pointerdown\", listener, false);\r\n        return () => {\r\n            document.removeEventListener(\"pointerdown\", listener);\r\n        };\r\n    }, [ref, cb]);\r\n};\r\nconst LibraryMenuItems = ({ libraryItems, onRemoveFromLibrary, onAddToLibrary, onInsertShape, pendingElements, theme, setAppState, setLibraryItems, libraryReturnUrl, focusContainer, library, files, id, }) => {\r\n    const isMobile = useIsMobile();\r\n    const numCells = libraryItems.length + (pendingElements.length > 0 ? 1 : 0);\r\n    const CELLS_PER_ROW = isMobile ? 4 : 6;\r\n    const numRows = Math.max(1, Math.ceil(numCells / CELLS_PER_ROW));\r\n    const rows = [];\r\n    let addedPendingElements = false;\r\n    const referrer = libraryReturnUrl || window.location.origin + window.location.pathname;\r\n    rows.push(<div className=\"layer-ui__library-header\" key=\"library-header\">\r\n      <ToolButton key=\"import\" type=\"button\" title={t(\"buttons.load\")} aria-label={t(\"buttons.load\")} icon={load} onClick={() => {\r\n            importLibraryFromJSON(library)\r\n                .then(() => {\r\n                // Close and then open to get the libraries updated\r\n                setAppState({ isLibraryOpen: false });\r\n                setAppState({ isLibraryOpen: true });\r\n            })\r\n                .catch(muteFSAbortError)\r\n                .catch((error) => {\r\n                setAppState({ errorMessage: error.message });\r\n            });\r\n        }}/>\r\n      {!!libraryItems.length && (<>\r\n          <ToolButton key=\"export\" type=\"button\" title={t(\"buttons.export\")} aria-label={t(\"buttons.export\")} icon={exportFile} onClick={() => {\r\n                saveLibraryAsJSON(library)\r\n                    .catch(muteFSAbortError)\r\n                    .catch((error) => {\r\n                    setAppState({ errorMessage: error.message });\r\n                });\r\n            }}/>\r\n          <ToolButton key=\"reset\" type=\"button\" title={t(\"buttons.resetLibrary\")} aria-label={t(\"buttons.resetLibrary\")} icon={trash} onClick={() => {\r\n                if (window.confirm(t(\"alerts.resetLibrary\"))) {\r\n                    library.resetLibrary();\r\n                    setLibraryItems([]);\r\n                    focusContainer();\r\n                }\r\n            }}/>\r\n        </>)}\r\n      <a href={`https://libraries.excalidraw.com?target=${window.name || \"_blank\"}&referrer=${referrer}&useHash=true&token=${id}&theme=${theme}`} target=\"_excalidraw_libraries\">\r\n        {t(\"labels.libraries\")}\r\n      </a>\r\n    </div>);\r\n    for (let row = 0; row < numRows; row++) {\r\n        const y = CELLS_PER_ROW * row;\r\n        const children = [];\r\n        for (let x = 0; x < CELLS_PER_ROW; x++) {\r\n            const shouldAddPendingElements = pendingElements.length > 0 &&\r\n                !addedPendingElements &&\r\n                y + x >= libraryItems.length;\r\n            addedPendingElements = addedPendingElements || shouldAddPendingElements;\r\n            children.push(<Stack.Col key={x}>\r\n          <LibraryUnit elements={libraryItems[y + x]} files={files} pendingElements={shouldAddPendingElements ? pendingElements : undefined} onRemoveFromLibrary={onRemoveFromLibrary.bind(null, y + x)} onClick={shouldAddPendingElements\r\n                    ? onAddToLibrary.bind(null, pendingElements)\r\n                    : onInsertShape.bind(null, libraryItems[y + x])}/>\r\n        </Stack.Col>);\r\n        }\r\n        rows.push(<Stack.Row align=\"center\" gap={1} key={row}>\r\n        {children}\r\n      </Stack.Row>);\r\n    }\r\n    return (<Stack.Col align=\"start\" gap={1} className=\"layer-ui__library-items\">\r\n      {rows}\r\n    </Stack.Col>);\r\n};\r\nconst LibraryMenu = ({ onClickOutside, onInsertShape, pendingElements, onAddToLibrary, theme, setAppState, files, libraryReturnUrl, focusContainer, library, id, }) => {\r\n    const ref = useRef(null);\r\n    useOnClickOutside(ref, (event) => {\r\n        // If click on the library icon, do nothing.\r\n        if (event.target.closest(\".ToolIcon_type_button__library\")) {\r\n            return;\r\n        }\r\n        onClickOutside(event);\r\n    });\r\n    const [libraryItems, setLibraryItems] = useState([]);\r\n    const [loadingState, setIsLoading] = useState(\"preloading\");\r\n    const loadingTimerRef = useRef(null);\r\n    useEffect(() => {\r\n        Promise.race([\r\n            new Promise((resolve) => {\r\n                loadingTimerRef.current = window.setTimeout(() => {\r\n                    resolve(\"loading\");\r\n                }, 100);\r\n            }),\r\n            library.loadLibrary().then((items) => {\r\n                setLibraryItems(items);\r\n                setIsLoading(\"ready\");\r\n            }),\r\n        ]).then((data) => {\r\n            if (data === \"loading\") {\r\n                setIsLoading(\"loading\");\r\n            }\r\n        });\r\n        return () => {\r\n            clearTimeout(loadingTimerRef.current);\r\n        };\r\n    }, [library]);\r\n    const removeFromLibrary = useCallback(async (indexToRemove) => {\r\n        const items = await library.loadLibrary();\r\n        const nextItems = items.filter((_, index) => index !== indexToRemove);\r\n        library.saveLibrary(nextItems).catch((error) => {\r\n            setLibraryItems(items);\r\n            setAppState({ errorMessage: t(\"alerts.errorRemovingFromLibrary\") });\r\n        });\r\n        setLibraryItems(nextItems);\r\n    }, [library, setAppState]);\r\n    const addToLibrary = useCallback(async (elements) => {\r\n        if (elements.some((element) => element.type === \"image\")) {\r\n            return setAppState({\r\n                errorMessage: \"Support for adding images to the library coming soon!\",\r\n            });\r\n        }\r\n        const items = await library.loadLibrary();\r\n        const nextItems = [...items, elements];\r\n        onAddToLibrary();\r\n        library.saveLibrary(nextItems).catch((error) => {\r\n            setLibraryItems(items);\r\n            setAppState({ errorMessage: t(\"alerts.errorAddingToLibrary\") });\r\n        });\r\n        setLibraryItems(nextItems);\r\n    }, [onAddToLibrary, library, setAppState]);\r\n    return loadingState === \"preloading\" ? null : (<Island padding={1} ref={ref} className=\"layer-ui__library\">\r\n      {loadingState === \"loading\" ? (<div className=\"layer-ui__library-message\">\r\n          {t(\"labels.libraryLoadingMessage\")}\r\n        </div>) : (<LibraryMenuItems libraryItems={libraryItems} onRemoveFromLibrary={removeFromLibrary} onAddToLibrary={addToLibrary} onInsertShape={onInsertShape} pendingElements={pendingElements} setAppState={setAppState} setLibraryItems={setLibraryItems} libraryReturnUrl={libraryReturnUrl} focusContainer={focusContainer} library={library} theme={theme} files={files} id={id}/>)}\r\n    </Island>);\r\n};\r\nconst LayerUI = ({ actionManager, appState, files, setAppState, canvas, elements, onCollabButtonClick, onLockToggle, onInsertElements, zenModeEnabled, showExitZenModeBtn, showThemeBtn, toggleZenMode, isCollaborating, renderTopRightUI, renderCustomFooter, viewModeEnabled, libraryReturnUrl, UIOptions, focusContainer, library, id, onImageAction, }) => {\r\n    const isMobile = useIsMobile();\r\n    const renderJSONExportDialog = () => {\r\n        if (!UIOptions.canvasActions.export) {\r\n            return null;\r\n        }\r\n        return (<JSONExportDialog elements={elements} appState={appState} files={files} actionManager={actionManager} exportOpts={UIOptions.canvasActions.export} canvas={canvas}/>);\r\n    };\r\n    const renderImageExportDialog = () => {\r\n        if (!UIOptions.canvasActions.saveAsImage) {\r\n            return null;\r\n        }\r\n        const createExporter = (type) => async (exportedElements) => {\r\n            const fileHandle = await exportCanvas(type, exportedElements, appState, files, {\r\n                exportBackground: appState.exportBackground,\r\n                name: appState.name,\r\n                viewBackgroundColor: appState.viewBackgroundColor,\r\n            })\r\n                .catch(muteFSAbortError)\r\n                .catch((error) => {\r\n                console.error(error);\r\n                setAppState({ errorMessage: error.message });\r\n            });\r\n            if (appState.exportEmbedScene &&\r\n                fileHandle &&\r\n                isImageFileHandle(fileHandle)) {\r\n                setAppState({ fileHandle });\r\n            }\r\n        };\r\n        return (<ImageExportDialog elements={elements} appState={appState} files={files} actionManager={actionManager} onExportToPng={createExporter(\"png\")} onExportToSvg={createExporter(\"svg\")} onExportToClipboard={createExporter(\"clipboard\")}/>);\r\n    };\r\n    const Separator = () => {\r\n        return <div style={{ width: \".625em\" }}/>;\r\n    };\r\n    const renderViewModeCanvasActions = () => {\r\n        return (<Section heading=\"canvasActions\" className={clsx(\"zen-mode-transition\", {\r\n                \"transition-left\": zenModeEnabled,\r\n            })}>\r\n        {/* the zIndex ensures this menu has higher stacking order,\r\n             see https://github.com/excalidraw/excalidraw/pull/1445 */}\r\n        <Island padding={2} style={{ zIndex: 1 }}>\r\n          <Stack.Col gap={4}>\r\n            <Stack.Row gap={1} justifyContent=\"space-between\">\r\n              {renderJSONExportDialog()}\r\n              {renderImageExportDialog()}\r\n            </Stack.Row>\r\n          </Stack.Col>\r\n        </Island>\r\n      </Section>);\r\n    };\r\n    const renderCanvasActions = () => (<Section heading=\"canvasActions\" className={clsx(\"zen-mode-transition\", {\r\n            \"transition-left\": zenModeEnabled,\r\n        })}>\r\n      {/* the zIndex ensures this menu has higher stacking order,\r\n           see https://github.com/excalidraw/excalidraw/pull/1445 */}\r\n      <Island padding={2} style={{ zIndex: 1 }}>\r\n        <Stack.Col gap={4}>\r\n          <Stack.Row gap={1} justifyContent=\"space-between\">\r\n            {actionManager.renderAction(\"clearCanvas\")}\r\n            <Separator />\r\n            {actionManager.renderAction(\"loadScene\")}\r\n            {renderJSONExportDialog()}\r\n            {renderImageExportDialog()}\r\n            <Separator />\r\n            {onCollabButtonClick && (<CollabButton isCollaborating={isCollaborating} collaboratorCount={appState.collaborators.size} onClick={onCollabButtonClick}/>)}\r\n          </Stack.Row>\r\n          <BackgroundPickerAndDarkModeToggle actionManager={actionManager} appState={appState} setAppState={setAppState} showThemeBtn={showThemeBtn}/>\r\n          {appState.fileHandle && (<>{actionManager.renderAction(\"saveToActiveFile\")}</>)}\r\n        </Stack.Col>\r\n      </Island>\r\n    </Section>);\r\n    const renderSelectedShapeActions = () => (<Section heading=\"selectedShapeActions\" className={clsx(\"zen-mode-transition\", {\r\n            \"transition-left\": zenModeEnabled,\r\n        })}>\r\n      <Island className={CLASSES.SHAPE_ACTIONS_MENU} padding={2} style={{\r\n            // we want to make sure this doesn't overflow so substracting 200\r\n            // which is approximately height of zoom footer and top left menu items with some buffer\r\n            // if active file name is displayed, subtracting 248 to account for its height\r\n            maxHeight: `${appState.height - (appState.fileHandle ? 248 : 200)}px`,\r\n        }}>\r\n        <SelectedShapeActions appState={appState} elements={elements} renderAction={actionManager.renderAction} elementType={appState.elementType}/>\r\n      </Island>\r\n    </Section>);\r\n    const closeLibrary = useCallback((event) => {\r\n        setAppState({ isLibraryOpen: false });\r\n    }, [setAppState]);\r\n    const deselectItems = useCallback(() => {\r\n        setAppState({\r\n            selectedElementIds: {},\r\n            selectedGroupIds: {},\r\n        });\r\n    }, [setAppState]);\r\n    const libraryMenu = appState.isLibraryOpen ? (<LibraryMenu pendingElements={getSelectedElements(elements, appState)} onClickOutside={closeLibrary} onInsertShape={onInsertElements} onAddToLibrary={deselectItems} setAppState={setAppState} libraryReturnUrl={libraryReturnUrl} focusContainer={focusContainer} library={library} theme={appState.theme} files={files} id={id}/>) : null;\r\n    const renderFixedSideContainer = () => {\r\n        const shouldRenderSelectedShapeActions = showSelectedShapeActions(appState, elements);\r\n        return (<FixedSideContainer side=\"top\">\r\n        <div className=\"App-menu App-menu_top\">\r\n          <Stack.Col gap={4} className={clsx({ \"disable-pointerEvents\": zenModeEnabled })}>\r\n            {viewModeEnabled\r\n                ? renderViewModeCanvasActions()\r\n                : renderCanvasActions()}\r\n            {shouldRenderSelectedShapeActions && renderSelectedShapeActions()}\r\n          </Stack.Col>\r\n          {!viewModeEnabled && (<Section heading=\"shapes\">\r\n              {(heading) => (<Stack.Col gap={4} align=\"start\">\r\n                  <Stack.Row gap={1}>\r\n                    <LockButton zenModeEnabled={zenModeEnabled} checked={appState.elementLocked} onChange={onLockToggle} title={t(\"toolBar.lock\")}/>\r\n                    <Island padding={1} className={clsx({ \"zen-mode\": zenModeEnabled })}>\r\n                      <HintViewer appState={appState} elements={elements} isMobile={isMobile}/>\r\n                      {heading}\r\n                      <Stack.Row gap={1}>\r\n                        <ShapesSwitcher canvas={canvas} elementType={appState.elementType} setAppState={setAppState} onImageAction={({ pointerType }) => {\r\n                        onImageAction({\r\n                            insertOnCanvasDirectly: pointerType !== \"mouse\",\r\n                        });\r\n                    }}/>\r\n                      </Stack.Row>\r\n                    </Island>\r\n                    <LibraryButton appState={appState} setAppState={setAppState}/>\r\n                  </Stack.Row>\r\n                  {libraryMenu}\r\n                </Stack.Col>)}\r\n            </Section>)}\r\n          <div className={clsx(\"layer-ui__wrapper__top-right zen-mode-transition\", {\r\n                \"transition-right\": zenModeEnabled,\r\n            })}>\r\n            <UserList>\r\n              {appState.collaborators.size > 0 &&\r\n                Array.from(appState.collaborators)\r\n                    // Collaborator is either not initialized or is actually the current user.\r\n                    .filter(([_, client]) => Object.keys(client).length !== 0)\r\n                    .map(([clientId, client]) => (<Tooltip label={client.username || \"Unknown user\"} key={clientId}>\r\n                      {actionManager.renderAction(\"goToCollaborator\", {\r\n                        id: clientId,\r\n                    })}\r\n                    </Tooltip>))}\r\n            </UserList>\r\n            {renderTopRightUI?.(isMobile, appState)}\r\n          </div>\r\n        </div>\r\n      </FixedSideContainer>);\r\n    };\r\n    const renderBottomAppMenu = () => {\r\n        return (<footer role=\"contentinfo\" className=\"layer-ui__wrapper__footer App-menu App-menu_bottom\">\r\n        <div className={clsx(\"layer-ui__wrapper__footer-left zen-mode-transition\", {\r\n                \"layer-ui__wrapper__footer-left--transition-left\": zenModeEnabled,\r\n            })}>\r\n          <Stack.Col gap={2}>\r\n            <Section heading=\"canvasActions\">\r\n              <Island padding={1}>\r\n                <ZoomActions renderAction={actionManager.renderAction} zoom={appState.zoom}/>\r\n              </Island>\r\n              {!viewModeEnabled && (<div className={clsx(\"undo-redo-buttons zen-mode-transition\", {\r\n                    \"layer-ui__wrapper__footer-left--transition-bottom\": zenModeEnabled,\r\n                })}>\r\n                  {actionManager.renderAction(\"undo\", { size: \"small\" })}\r\n                  {actionManager.renderAction(\"redo\", { size: \"small\" })}\r\n                </div>)}\r\n            </Section>\r\n          </Stack.Col>\r\n        </div>\r\n        <div className={clsx(\"layer-ui__wrapper__footer-center zen-mode-transition\", {\r\n                \"layer-ui__wrapper__footer-left--transition-bottom\": zenModeEnabled,\r\n            })}>\r\n          {renderCustomFooter?.(false, appState)}\r\n        </div>\r\n        <div className={clsx(\"layer-ui__wrapper__footer-right zen-mode-transition\", {\r\n                \"transition-right disable-pointerEvents\": zenModeEnabled,\r\n            })}>\r\n          {actionManager.renderAction(\"toggleShortcuts\")}\r\n        </div>\r\n        <button className={clsx(\"disable-zen-mode\", {\r\n                \"disable-zen-mode--visible\": showExitZenModeBtn,\r\n            })} onClick={toggleZenMode}>\r\n          {t(\"buttons.exitZenMode\")}\r\n        </button>\r\n      </footer>);\r\n    };\r\n    const dialogs = (<>\r\n      {appState.isLoading && <LoadingMessage />}\r\n      {appState.errorMessage && (<ErrorDialog message={appState.errorMessage} onClose={() => setAppState({ errorMessage: null })}/>)}\r\n      {appState.showHelpDialog && (<HelpDialog onClose={() => {\r\n                setAppState({ showHelpDialog: false });\r\n            }}/>)}\r\n      {appState.pasteDialog.shown && (<PasteChartDialog setAppState={setAppState} appState={appState} onInsertChart={onInsertElements} onClose={() => setAppState({\r\n                pasteDialog: { shown: false, data: null },\r\n            })}/>)}\r\n    </>);\r\n    return isMobile ? (<>\r\n      {dialogs}\r\n      <MobileMenu appState={appState} elements={elements} actionManager={actionManager} libraryMenu={libraryMenu} renderJSONExportDialog={renderJSONExportDialog} renderImageExportDialog={renderImageExportDialog} setAppState={setAppState} onCollabButtonClick={onCollabButtonClick} onLockToggle={onLockToggle} canvas={canvas} isCollaborating={isCollaborating} renderCustomFooter={renderCustomFooter} viewModeEnabled={viewModeEnabled} showThemeBtn={showThemeBtn} onImageAction={onImageAction} renderTopRightUI={renderTopRightUI}/>\r\n    </>) : (<div className={clsx(\"layer-ui__wrapper\", {\r\n            \"disable-pointerEvents\": appState.draggingElement ||\r\n                appState.resizingElement ||\r\n                (appState.editingElement && !isTextElement(appState.editingElement)),\r\n        })}>\r\n      {dialogs}\r\n      {renderFixedSideContainer()}\r\n      {renderBottomAppMenu()}\r\n      {appState.scrolledOutside && (<button className=\"scroll-back-to-content\" onClick={() => {\r\n                setAppState({\r\n                    ...calculateScrollCenter(elements, appState, canvas),\r\n                });\r\n            }}>\r\n          {t(\"buttons.scrollBackToContent\")}\r\n        </button>)}\r\n    </div>);\r\n};\r\nconst areEqual = (prev, next) => {\r\n    const getNecessaryObj = (appState) => {\r\n        const { suggestedBindings, startBoundElement: boundElement, ...ret } = appState;\r\n        return ret;\r\n    };\r\n    const prevAppState = getNecessaryObj(prev.appState);\r\n    const nextAppState = getNecessaryObj(next.appState);\r\n    const keys = Object.keys(prevAppState);\r\n    return (prev.renderCustomFooter === next.renderCustomFooter &&\r\n        prev.langCode === next.langCode &&\r\n        prev.elements === next.elements &&\r\n        prev.files === next.files &&\r\n        keys.every((key) => prevAppState[key] === nextAppState[key]));\r\n};\r\nexport default React.memo(LayerUI, areEqual);\r\n","import React from \"react\";\r\nimport { getCommonBounds } from \"../element/bounds\";\r\nimport { t } from \"../i18n\";\r\nimport { useIsMobile } from \"../components/App\";\r\nimport { getTargetElements } from \"../scene\";\r\nimport { close } from \"./icons\";\r\nimport { Island } from \"./Island\";\r\nimport \"./Stats.scss\";\r\nexport const Stats = (props) => {\r\n    const isMobile = useIsMobile();\r\n    const boundingBox = getCommonBounds(props.elements);\r\n    const selectedElements = getTargetElements(props.elements, props.appState);\r\n    const selectedBoundingBox = getCommonBounds(selectedElements);\r\n    if (isMobile && props.appState.openMenu) {\r\n        return null;\r\n    }\r\n    return (<div className=\"Stats\">\r\n      <Island padding={2}>\r\n        <div className=\"close\" onClick={props.onClose}>\r\n          {close}\r\n        </div>\r\n        <h3>{t(\"stats.title\")}</h3>\r\n        <table>\r\n          <tbody>\r\n            <tr>\r\n              <th colSpan={2}>{t(\"stats.scene\")}</th>\r\n            </tr>\r\n            <tr>\r\n              <td>{t(\"stats.elements\")}</td>\r\n              <td>{props.elements.length}</td>\r\n            </tr>\r\n            <tr>\r\n              <td>{t(\"stats.width\")}</td>\r\n              <td>{Math.round(boundingBox[2]) - Math.round(boundingBox[0])}</td>\r\n            </tr>\r\n            <tr>\r\n              <td>{t(\"stats.height\")}</td>\r\n              <td>{Math.round(boundingBox[3]) - Math.round(boundingBox[1])}</td>\r\n            </tr>\r\n\r\n            {selectedElements.length === 1 && (<tr>\r\n                <th colSpan={2}>{t(\"stats.element\")}</th>\r\n              </tr>)}\r\n\r\n            {selectedElements.length > 1 && (<>\r\n                <tr>\r\n                  <th colSpan={2}>{t(\"stats.selected\")}</th>\r\n                </tr>\r\n                <tr>\r\n                  <td>{t(\"stats.elements\")}</td>\r\n                  <td>{selectedElements.length}</td>\r\n                </tr>\r\n              </>)}\r\n            {selectedElements.length > 0 && (<>\r\n                <tr>\r\n                  <td>{\"x\"}</td>\r\n                  <td>{Math.round(selectedBoundingBox[0])}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>{\"y\"}</td>\r\n                  <td>{Math.round(selectedBoundingBox[1])}</td>\r\n                </tr>\r\n                <tr>\r\n                  <td>{t(\"stats.width\")}</td>\r\n                  <td>\r\n                    {Math.round(selectedBoundingBox[2] - selectedBoundingBox[0])}\r\n                  </td>\r\n                </tr>\r\n                <tr>\r\n                  <td>{t(\"stats.height\")}</td>\r\n                  <td>\r\n                    {Math.round(selectedBoundingBox[3] - selectedBoundingBox[1])}\r\n                  </td>\r\n                </tr>\r\n              </>)}\r\n            {selectedElements.length === 1 && (<tr>\r\n                <td>{t(\"stats.angle\")}</td>\r\n                <td>\r\n                  {`${Math.round((selectedElements[0].angle * 180) / Math.PI)}°`}\r\n                </td>\r\n              </tr>)}\r\n            {props.renderCustomStats?.(props.elements, props.appState)}\r\n          </tbody>\r\n        </table>\r\n      </Island>\r\n    </div>);\r\n};\r\n","import { useCallback, useEffect, useRef } from \"react\";\r\nimport { TOAST_TIMEOUT } from \"../constants\";\r\nimport \"./Toast.scss\";\r\nexport const Toast = ({ message, clearToast, }) => {\r\n    const timerRef = useRef(0);\r\n    const scheduleTimeout = useCallback(() => (timerRef.current = window.setTimeout(() => clearToast(), TOAST_TIMEOUT)), [clearToast]);\r\n    useEffect(() => {\r\n        scheduleTimeout();\r\n        return () => clearTimeout(timerRef.current);\r\n    }, [scheduleTimeout, message]);\r\n    return (<div className=\"Toast\" onMouseEnter={() => clearTimeout(timerRef?.current)} onMouseLeave={scheduleTimeout}>\r\n      <p className=\"Toast__message\">{message}</p>\r\n    </div>);\r\n};\r\n","import { CODES, KEYS } from \"../keys\";\r\nimport { register } from \"./register\";\r\nimport { trackEvent } from \"../analytics\";\r\nexport const actionToggleViewMode = register({\r\n    name: \"viewMode\",\r\n    perform(elements, appState) {\r\n        trackEvent(\"view\", \"mode\", \"view\");\r\n        return {\r\n            appState: {\r\n                ...appState,\r\n                viewModeEnabled: !this.checked(appState),\r\n            },\r\n            commitToHistory: false,\r\n        };\r\n    },\r\n    checked: (appState) => appState.viewModeEnabled,\r\n    contextItemLabel: \"labels.viewMode\",\r\n    keyTest: (event) => !event[KEYS.CTRL_OR_CMD] && event.altKey && event.code === CODES.R,\r\n});\r\n","import React, { useContext } from \"react\";\r\nimport rough from \"roughjs/bin/rough\";\r\nimport clsx from \"clsx\";\r\nimport { nanoid } from \"nanoid\";\r\nimport {\r\n  actionAddToLibrary,\r\n  actionBringForward,\r\n  actionBringToFront,\r\n  actionCopy,\r\n  actionCopyAsPng,\r\n  actionCopyAsSvg,\r\n  actionCopyStyles,\r\n  actionCut,\r\n  actionDeleteSelected,\r\n  actionDuplicateSelection,\r\n  actionFinalize,\r\n  actionFlipHorizontal,\r\n  actionFlipVertical,\r\n  actionGroup,\r\n  actionPasteStyles,\r\n  actionSelectAll,\r\n  actionSendBackward,\r\n  actionSendToBack,\r\n  actionToggleGridMode,\r\n  actionToggleStats,\r\n  actionToggleZenMode,\r\n  actionUngroup,\r\n} from \"../actions\";\r\nimport { createRedoAction, createUndoAction } from \"../actions/actionHistory\";\r\nimport { ActionManager } from \"../actions/manager\";\r\nimport { actions } from \"../actions/register\";\r\nimport { trackEvent } from \"../analytics\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport {\r\n  copyToClipboard,\r\n  parseClipboard,\r\n  probablySupportsClipboardBlob,\r\n  probablySupportsClipboardWriteText,\r\n} from \"../clipboard\";\r\nimport {\r\n  APP_NAME,\r\n  CURSOR_TYPE,\r\n  DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT,\r\n  DEFAULT_UI_OPTIONS,\r\n  DEFAULT_VERTICAL_ALIGN,\r\n  DRAGGING_THRESHOLD,\r\n  ELEMENT_SHIFT_TRANSLATE_AMOUNT,\r\n  ELEMENT_TRANSLATE_AMOUNT,\r\n  ENV,\r\n  EVENT,\r\n  GRID_SIZE,\r\n  IMAGE_RENDER_TIMEOUT,\r\n  LINE_CONFIRM_THRESHOLD,\r\n  MAX_ALLOWED_FILE_BYTES,\r\n  MIME_TYPES,\r\n  MQ_MAX_HEIGHT_LANDSCAPE,\r\n  MQ_MAX_WIDTH_LANDSCAPE,\r\n  MQ_MAX_WIDTH_PORTRAIT,\r\n  POINTER_BUTTON,\r\n  SCROLL_TIMEOUT,\r\n  TAP_TWICE_TIMEOUT,\r\n  TEXT_TO_CENTER_SNAP_THRESHOLD,\r\n  THEME,\r\n  TOUCH_CTX_MENU_TIMEOUT,\r\n  URL_HASH_KEYS,\r\n  URL_QUERY_KEYS,\r\n  ZOOM_STEP,\r\n} from \"../constants\";\r\nimport { loadFromBlob } from \"../data\";\r\nimport { isValidLibrary } from \"../data/json\";\r\nimport Library from \"../data/library\";\r\nimport { restore, restoreElements } from \"../data/restore\";\r\nimport {\r\n  dragNewElement,\r\n  dragSelectedElements,\r\n  duplicateElement,\r\n  getCommonBounds,\r\n  getCursorForResizingElement,\r\n  getDragOffsetXY,\r\n  getElementWithTransformHandleType,\r\n  getNormalizedDimensions,\r\n  getPerfectElementSize,\r\n  getResizeArrowDirection,\r\n  getResizeOffsetXY,\r\n  getTransformHandleTypeFromCoords,\r\n  hitTest,\r\n  isHittingElementBoundingBoxWithoutHittingElement,\r\n  isInvisiblySmallElement,\r\n  isNonDeletedElement,\r\n  isTextElement,\r\n  newElement,\r\n  newLinearElement,\r\n  newTextElement,\r\n  newImageElement,\r\n  textWysiwyg,\r\n  transformElements,\r\n  updateTextElement,\r\n} from \"../element\";\r\nimport {\r\n  bindOrUnbindSelectedElements,\r\n  fixBindingsAfterDeletion,\r\n  fixBindingsAfterDuplication,\r\n  getEligibleElementsForBinding,\r\n  getHoveredElementForBinding,\r\n  isBindingEnabled,\r\n  isLinearElementSimpleAndAlreadyBound,\r\n  maybeBindLinearElement,\r\n  shouldEnableBindingForPointerEvent,\r\n  unbindLinearElements,\r\n  updateBoundElements,\r\n} from \"../element/binding\";\r\nimport { LinearElementEditor } from \"../element/linearElementEditor\";\r\nimport {\r\n  bumpVersion,\r\n  mutateElement,\r\n  newElementWith,\r\n} from \"../element/mutateElement\";\r\nimport { deepCopyElement, newFreeDrawElement } from \"../element/newElement\";\r\nimport {\r\n  isBindingElement,\r\n  isBindingElementType,\r\n  isImageElement,\r\n  isInitializedImageElement,\r\n  isLinearElement,\r\n  isLinearElementType,\r\n} from \"../element/typeChecks\";\r\nimport { getCenter, getDistance } from \"../gesture\";\r\nimport {\r\n  editGroupForSelectedElement,\r\n  getElementsInGroup,\r\n  getSelectedGroupIdForElement,\r\n  getSelectedGroupIds,\r\n  isElementInGroup,\r\n  isSelectedViaGroup,\r\n  selectGroupsForSelectedElements,\r\n} from \"../groups\";\r\nimport History from \"../history\";\r\nimport { defaultLang, getLanguage, languages, setLanguage, t } from \"../i18n\";\r\nimport {\r\n  CODES,\r\n  shouldResizeFromCenter,\r\n  shouldMaintainAspectRatio,\r\n  shouldRotateWithDiscreteAngle,\r\n  isArrowKey,\r\n  KEYS,\r\n} from \"../keys\";\r\nimport { distance2d, getGridPoint, isPathALoop } from \"../math\";\r\nimport { renderScene } from \"../renderer\";\r\nimport { invalidateShapeForElement } from \"../renderer/renderElement\";\r\nimport {\r\n  calculateScrollCenter,\r\n  getElementContainingPosition,\r\n  getElementsAtPosition,\r\n  getElementsWithinSelection,\r\n  getNormalizedZoom,\r\n  getSelectedElements,\r\n  hasBackground,\r\n  isOverScrollBars,\r\n  isSomeElementSelected,\r\n} from \"../scene\";\r\nimport Scene from \"../scene/Scene\";\r\nimport { getNewZoom } from \"../scene/zoom\";\r\nimport { findShapeByKey } from \"../shapes\";\r\nimport {\r\n  debounce,\r\n  distance,\r\n  getNearestScrollableContainer,\r\n  isInputLike,\r\n  isToolIcon,\r\n  isWritableElement,\r\n  resetCursor,\r\n  resolvablePromise,\r\n  sceneCoordsToViewportCoords,\r\n  setCursor,\r\n  setCursorForShape,\r\n  tupleToCoors,\r\n  viewportCoordsToSceneCoords,\r\n  withBatchedUpdates,\r\n} from \"../utils\";\r\nimport ContextMenu from \"./ContextMenu\";\r\nimport LayerUI from \"./LayerUI\";\r\nimport { Stats } from \"./Stats\";\r\nimport { Toast } from \"./Toast\";\r\nimport { actionToggleViewMode } from \"../actions/actionToggleViewMode\";\r\nimport {\r\n  dataURLToFile,\r\n  generateIdFromFile,\r\n  getDataURL,\r\n  isSupportedImageFile,\r\n  resizeImageFile,\r\n  SVGStringToFile,\r\n} from \"../data/blob\";\r\nimport {\r\n  getInitializedImageElements,\r\n  loadHTMLImageElement,\r\n  normalizeSVG,\r\n  updateImageCache as _updateImageCache,\r\n} from \"../element/image\";\r\nimport throttle from \"lodash.throttle\";\r\nimport { fileOpen, nativeFileSystemSupported } from \"../data/filesystem\";\r\nconst IsMobileContext = React.createContext(false);\r\nexport const useIsMobile = () => useContext(IsMobileContext);\r\nconst ExcalidrawContainerContext = React.createContext({\r\n  container: null,\r\n  id: null,\r\n});\r\nexport const useExcalidrawContainer = () =>\r\n  useContext(ExcalidrawContainerContext);\r\nlet didTapTwice = false;\r\nlet tappedTwiceTimer = 0;\r\nlet cursorX = 0;\r\nlet cursorY = 0;\r\nlet isHoldingSpace = false;\r\nlet isPanning = false;\r\nlet isDraggingScrollBar = false;\r\nlet currentScrollBars = { horizontal: null, vertical: null };\r\nlet touchTimeout = 0;\r\nlet invalidateContextMenu = false;\r\nlet lastPointerUp = null;\r\nconst gesture = {\r\n  pointers: new Map(),\r\n  lastCenter: null,\r\n  initialDistance: null,\r\n  initialScale: null,\r\n};\r\nclass App extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.canvas = null;\r\n    this.rc = null;\r\n    this.unmounted = false;\r\n    this.isMobile = false;\r\n    this.excalidrawContainerRef = React.createRef();\r\n    this.files = {};\r\n    this.imageCache = new Map();\r\n    this.focusContainer = () => {\r\n      if (this.props.autoFocus) {\r\n        this.excalidrawContainerRef.current?.focus();\r\n      }\r\n    };\r\n    this.getSceneElementsIncludingDeleted = () => {\r\n      return this.scene.getElementsIncludingDeleted();\r\n    };\r\n    this.getSceneElements = () => {\r\n      return this.scene.getElements();\r\n    };\r\n    this.syncActionResult = withBatchedUpdates((actionResult) => {\r\n      if (this.unmounted || actionResult === false) {\r\n        return;\r\n      }\r\n      let editingElement = null;\r\n      if (actionResult.elements) {\r\n        actionResult.elements.forEach((element) => {\r\n          if (\r\n            this.state.editingElement?.id === element.id &&\r\n            this.state.editingElement !== element &&\r\n            isNonDeletedElement(element)\r\n          ) {\r\n            editingElement = element;\r\n          }\r\n        });\r\n        this.scene.replaceAllElements(actionResult.elements);\r\n        if (actionResult.commitToHistory) {\r\n          this.history.resumeRecording();\r\n        }\r\n      }\r\n      if (actionResult.files) {\r\n        this.files = actionResult.replaceFiles\r\n          ? actionResult.files\r\n          : { ...this.files, ...actionResult.files };\r\n        this.addNewImagesToImageCache();\r\n      }\r\n      if (actionResult.appState || editingElement) {\r\n        if (actionResult.commitToHistory) {\r\n          this.history.resumeRecording();\r\n        }\r\n        let viewModeEnabled = actionResult?.appState?.viewModeEnabled || false;\r\n        let zenModeEnabled = actionResult?.appState?.zenModeEnabled || false;\r\n        let gridSize = actionResult?.appState?.gridSize || null;\r\n        let theme = actionResult?.appState?.theme || THEME.LIGHT;\r\n        let name = actionResult?.appState?.name ?? this.state.name;\r\n        if (typeof this.props.viewModeEnabled !== \"undefined\") {\r\n          viewModeEnabled = this.props.viewModeEnabled;\r\n        }\r\n        if (typeof this.props.zenModeEnabled !== \"undefined\") {\r\n          zenModeEnabled = this.props.zenModeEnabled;\r\n        }\r\n        if (typeof this.props.gridModeEnabled !== \"undefined\") {\r\n          gridSize = this.props.gridModeEnabled ? GRID_SIZE : null;\r\n        }\r\n        if (typeof this.props.theme !== \"undefined\") {\r\n          theme = this.props.theme;\r\n        }\r\n        if (typeof this.props.name !== \"undefined\") {\r\n          name = this.props.name;\r\n        }\r\n        this.setState(\r\n          (state) => {\r\n            // using Object.assign instead of spread to fool TS 4.2.2+ into\r\n            // regarding the resulting type as not containing undefined\r\n            // (which the following expression will never contain)\r\n            return Object.assign(actionResult.appState || {}, {\r\n              editingElement:\r\n                editingElement || actionResult.appState?.editingElement || null,\r\n              viewModeEnabled,\r\n              zenModeEnabled,\r\n              gridSize,\r\n              theme,\r\n              name,\r\n            });\r\n          },\r\n          () => {\r\n            if (actionResult.syncHistory) {\r\n              this.history.setCurrentState(\r\n                this.state,\r\n                this.scene.getElementsIncludingDeleted()\r\n              );\r\n            }\r\n          }\r\n        );\r\n      }\r\n    });\r\n    // Lifecycle\r\n    this.onBlur = withBatchedUpdates(() => {\r\n      isHoldingSpace = false;\r\n      this.setState({ isBindingEnabled: true });\r\n    });\r\n    this.onUnload = () => {\r\n      this.onBlur();\r\n    };\r\n    this.disableEvent = (event) => {\r\n      event.preventDefault();\r\n    };\r\n    this.onFontLoaded = () => {\r\n      this.scene.getElementsIncludingDeleted().forEach((element) => {\r\n        if (isTextElement(element)) {\r\n          invalidateShapeForElement(element);\r\n        }\r\n      });\r\n      this.onSceneUpdated();\r\n    };\r\n    this.importLibraryFromUrl = async (url, token) => {\r\n      if (window.location.hash.includes(URL_HASH_KEYS.addLibrary)) {\r\n        const hash = new URLSearchParams(window.location.hash.slice(1));\r\n        hash.delete(URL_HASH_KEYS.addLibrary);\r\n        window.history.replaceState({}, APP_NAME, `#${hash.toString()}`);\r\n      } else if (window.location.search.includes(URL_QUERY_KEYS.addLibrary)) {\r\n        const query = new URLSearchParams(window.location.search);\r\n        query.delete(URL_QUERY_KEYS.addLibrary);\r\n        window.history.replaceState({}, APP_NAME, `?${query.toString()}`);\r\n      }\r\n      try {\r\n        const request = await fetch(decodeURIComponent(url));\r\n        const blob = await request.blob();\r\n        const json = JSON.parse(await blob.text());\r\n        if (!isValidLibrary(json)) {\r\n          throw new Error();\r\n        }\r\n        if (\r\n          token === this.id ||\r\n          window.confirm(\r\n            t(\"alerts.confirmAddLibrary\", { numShapes: json.library.length })\r\n          )\r\n        ) {\r\n          await this.library.importLibrary(blob);\r\n          // hack to rerender the library items after import\r\n          if (this.state.isLibraryOpen) {\r\n            this.setState({ isLibraryOpen: false });\r\n          }\r\n          this.setState({ isLibraryOpen: true });\r\n        }\r\n      } catch (error) {\r\n        window.alert(t(\"alerts.errorLoadingLibrary\"));\r\n        console.error(error);\r\n      } finally {\r\n        this.focusContainer();\r\n      }\r\n    };\r\n    this.resetHistory = () => {\r\n      this.history.clear();\r\n    };\r\n    /**\r\n     * Resets scene & history.\r\n     * ! Do not use to clear scene user action !\r\n     */\r\n    this.resetScene = withBatchedUpdates((opts) => {\r\n      this.scene.replaceAllElements([]);\r\n      this.setState((state) => ({\r\n        ...getDefaultAppState(),\r\n        isLoading: opts?.resetLoadingState ? false : state.isLoading,\r\n        theme: this.state.theme,\r\n      }));\r\n      this.resetHistory();\r\n    });\r\n    this.initializeScene = async () => {\r\n      if (\"launchQueue\" in window && \"LaunchParams\" in window) {\r\n        window.launchQueue.setConsumer(async (launchParams) => {\r\n          if (!launchParams.files.length) {\r\n            return;\r\n          }\r\n          const fileHandle = launchParams.files[0];\r\n          const blob = await fileHandle.getFile();\r\n          blob.handle = fileHandle;\r\n          loadFromBlob(\r\n            blob,\r\n            this.state,\r\n            this.scene.getElementsIncludingDeleted()\r\n          )\r\n            .then((scene) => {\r\n              this.syncActionResult({\r\n                ...scene,\r\n                appState: {\r\n                  ...(scene.appState || this.state),\r\n                  isLoading: false,\r\n                },\r\n                commitToHistory: true,\r\n              });\r\n            })\r\n            .catch((error) => {\r\n              this.setState({ isLoading: false, errorMessage: error.message });\r\n            });\r\n        });\r\n      }\r\n      if (!this.state.isLoading) {\r\n        this.setState({ isLoading: true });\r\n      }\r\n      let initialData = null;\r\n      try {\r\n        initialData = (await this.props.initialData) || null;\r\n        if (initialData?.libraryItems) {\r\n          this.libraryItemsFromStorage = initialData.libraryItems;\r\n        }\r\n      } catch (error) {\r\n        console.error(error);\r\n        initialData = {\r\n          appState: {\r\n            errorMessage:\r\n              error.message ||\r\n              \"Encountered an error during importing or restoring scene data\",\r\n          },\r\n        };\r\n      }\r\n      const scene = restore(initialData, null, null);\r\n      scene.appState = {\r\n        ...scene.appState,\r\n        elementType:\r\n          scene.appState.elementType === \"image\"\r\n            ? \"selection\"\r\n            : scene.appState.elementType,\r\n        isLoading: false,\r\n      };\r\n      if (initialData?.scrollToContent) {\r\n        scene.appState = {\r\n          ...scene.appState,\r\n          ...calculateScrollCenter(\r\n            scene.elements,\r\n            {\r\n              ...scene.appState,\r\n              width: this.state.width,\r\n              height: this.state.height,\r\n              offsetTop: this.state.offsetTop,\r\n              offsetLeft: this.state.offsetLeft,\r\n            },\r\n            null\r\n          ),\r\n        };\r\n      }\r\n      this.resetHistory();\r\n      this.syncActionResult({\r\n        ...scene,\r\n        commitToHistory: true,\r\n      });\r\n      const libraryUrl =\r\n        // current\r\n        new URLSearchParams(window.location.hash.slice(1)).get(\r\n          URL_HASH_KEYS.addLibrary\r\n        ) ||\r\n        // legacy, kept for compat reasons\r\n        new URLSearchParams(window.location.search).get(\r\n          URL_QUERY_KEYS.addLibrary\r\n        );\r\n      if (libraryUrl) {\r\n        await this.importLibraryFromUrl(libraryUrl);\r\n      }\r\n    };\r\n    this.onResize = withBatchedUpdates(() => {\r\n      this.scene\r\n        .getElementsIncludingDeleted()\r\n        .forEach((element) => invalidateShapeForElement(element));\r\n      this.setState({});\r\n    });\r\n    this.onScroll = debounce(() => {\r\n      const { offsetTop, offsetLeft } = this.getCanvasOffsets();\r\n      this.setState((state) => {\r\n        if (state.offsetLeft === offsetLeft && state.offsetTop === offsetTop) {\r\n          return null;\r\n        }\r\n        return { offsetTop, offsetLeft };\r\n      });\r\n    }, SCROLL_TIMEOUT);\r\n    // Copy/paste\r\n    this.onCut = withBatchedUpdates((event) => {\r\n      const isExcalidrawActive = this.excalidrawContainerRef.current?.contains(\r\n        document.activeElement\r\n      );\r\n      if (!isExcalidrawActive || isWritableElement(event.target)) {\r\n        return;\r\n      }\r\n      this.cutAll();\r\n      event.preventDefault();\r\n    });\r\n    this.onCopy = withBatchedUpdates((event) => {\r\n      const isExcalidrawActive = this.excalidrawContainerRef.current?.contains(\r\n        document.activeElement\r\n      );\r\n      if (!isExcalidrawActive || isWritableElement(event.target)) {\r\n        return;\r\n      }\r\n      this.copyAll();\r\n      event.preventDefault();\r\n    });\r\n    this.cutAll = () => {\r\n      this.copyAll();\r\n      this.actionManager.executeAction(actionDeleteSelected);\r\n    };\r\n    this.copyAll = () => {\r\n      copyToClipboard(this.scene.getElements(), this.state, this.files);\r\n    };\r\n    this.onTapStart = (event) => {\r\n      if (!didTapTwice) {\r\n        didTapTwice = true;\r\n        clearTimeout(tappedTwiceTimer);\r\n        tappedTwiceTimer = window.setTimeout(\r\n          App.resetTapTwice,\r\n          TAP_TWICE_TIMEOUT\r\n        );\r\n        return;\r\n      }\r\n      // insert text only if we tapped twice with a single finger\r\n      // event.touches.length === 1 will also prevent inserting text when user's zooming\r\n      if (didTapTwice && event.touches.length === 1) {\r\n        const [touch] = event.touches;\r\n        // @ts-ignore\r\n        this.handleCanvasDoubleClick({\r\n          clientX: touch.clientX,\r\n          clientY: touch.clientY,\r\n        });\r\n        didTapTwice = false;\r\n        clearTimeout(tappedTwiceTimer);\r\n      }\r\n      event.preventDefault();\r\n      if (event.touches.length === 2) {\r\n        this.setState({\r\n          selectedElementIds: {},\r\n        });\r\n      }\r\n    };\r\n    this.onTapEnd = (event) => {\r\n      if (event.touches.length > 0) {\r\n        this.setState({\r\n          previousSelectedElementIds: {},\r\n          selectedElementIds: this.state.previousSelectedElementIds,\r\n        });\r\n      }\r\n    };\r\n    this.pasteFromClipboard = withBatchedUpdates(async (event) => {\r\n      // #686\r\n      const target = document.activeElement;\r\n      const isExcalidrawActive =\r\n        this.excalidrawContainerRef.current?.contains(target);\r\n      if (!isExcalidrawActive) {\r\n        return;\r\n      }\r\n      const elementUnderCursor = document.elementFromPoint(cursorX, cursorY);\r\n      if (\r\n        // if no ClipboardEvent supplied, assume we're pasting via contextMenu\r\n        // thus these checks don't make sense\r\n        event &&\r\n        (!(elementUnderCursor instanceof HTMLCanvasElement) ||\r\n          isWritableElement(target))\r\n      ) {\r\n        return;\r\n      }\r\n      // must be called in the same frame (thus before any awaits) as the paste\r\n      // event else some browsers (FF...) will clear the clipboardData\r\n      // (something something security)\r\n      let file = event?.clipboardData?.files[0];\r\n      const data = await parseClipboard(event);\r\n      if (!file && data.text) {\r\n        const string = data.text.trim();\r\n        if (string.startsWith(\"<svg\") && string.endsWith(\"</svg>\")) {\r\n          // ignore SVG validation/normalization which will be done during image\r\n          // initialization\r\n          file = SVGStringToFile(string);\r\n        }\r\n      }\r\n      if (isSupportedImageFile(file)) {\r\n        const { x: sceneX, y: sceneY } = viewportCoordsToSceneCoords(\r\n          { clientX: cursorX, clientY: cursorY },\r\n          this.state\r\n        );\r\n        const imageElement = this.createImageElement({ sceneX, sceneY });\r\n        this.insertImageElement(imageElement, file);\r\n        this.initializeImageDimensions(imageElement);\r\n        this.setState({ selectedElementIds: { [imageElement.id]: true } });\r\n        return;\r\n      }\r\n      if (this.props.onPaste) {\r\n        try {\r\n          if ((await this.props.onPaste(data, event)) === false) {\r\n            return;\r\n          }\r\n        } catch (error) {\r\n          console.error(error);\r\n        }\r\n      }\r\n      if (data.errorMessage) {\r\n        this.setState({ errorMessage: data.errorMessage });\r\n      } else if (data.spreadsheet) {\r\n        this.setState({\r\n          pasteDialog: {\r\n            data: data.spreadsheet,\r\n            shown: true,\r\n          },\r\n        });\r\n      } else if (data.elements) {\r\n        this.addElementsFromPasteOrLibrary({\r\n          elements: data.elements,\r\n          files: data.files || null,\r\n          position: \"cursor\",\r\n        });\r\n      } else if (data.text) {\r\n        this.addTextFromPaste(data.text);\r\n      }\r\n      this.selectShapeTool(\"selection\");\r\n      event?.preventDefault();\r\n    });\r\n    this.addElementsFromPasteOrLibrary = (opts) => {\r\n      const elements = restoreElements(opts.elements, null);\r\n      const [minX, minY, maxX, maxY] = getCommonBounds(elements);\r\n      const elementsCenterX = distance(minX, maxX) / 2;\r\n      const elementsCenterY = distance(minY, maxY) / 2;\r\n      const clientX =\r\n        typeof opts.position === \"object\"\r\n          ? opts.position.clientX\r\n          : opts.position === \"cursor\"\r\n          ? cursorX\r\n          : this.state.width / 2 + this.state.offsetLeft;\r\n      const clientY =\r\n        typeof opts.position === \"object\"\r\n          ? opts.position.clientY\r\n          : opts.position === \"cursor\"\r\n          ? cursorY\r\n          : this.state.height / 2 + this.state.offsetTop;\r\n      const { x, y } = viewportCoordsToSceneCoords(\r\n        { clientX, clientY },\r\n        this.state\r\n      );\r\n      const dx = x - elementsCenterX;\r\n      const dy = y - elementsCenterY;\r\n      const groupIdMap = new Map();\r\n      const [gridX, gridY] = getGridPoint(dx, dy, this.state.gridSize);\r\n      const oldIdToDuplicatedId = new Map();\r\n      const newElements = elements.map((element) => {\r\n        const newElement = duplicateElement(\r\n          this.state.editingGroupId,\r\n          groupIdMap,\r\n          element,\r\n          {\r\n            x: element.x + gridX - minX,\r\n            y: element.y + gridY - minY,\r\n          }\r\n        );\r\n        oldIdToDuplicatedId.set(element.id, newElement.id);\r\n        return newElement;\r\n      });\r\n      const nextElements = [\r\n        ...this.scene.getElementsIncludingDeleted(),\r\n        ...newElements,\r\n      ];\r\n      fixBindingsAfterDuplication(nextElements, elements, oldIdToDuplicatedId);\r\n      if (opts.files) {\r\n        this.files = { ...this.files, ...opts.files };\r\n      }\r\n      this.scene.replaceAllElements(nextElements);\r\n      this.history.resumeRecording();\r\n      this.setState(\r\n        selectGroupsForSelectedElements(\r\n          {\r\n            ...this.state,\r\n            isLibraryOpen: false,\r\n            selectedElementIds: newElements.reduce((map, element) => {\r\n              map[element.id] = true;\r\n              return map;\r\n            }, {}),\r\n            selectedGroupIds: {},\r\n          },\r\n          this.scene.getElements()\r\n        ),\r\n        () => {\r\n          if (opts.files) {\r\n            this.addNewImagesToImageCache();\r\n          }\r\n        }\r\n      );\r\n      this.selectShapeTool(\"selection\");\r\n    };\r\n    // Collaboration\r\n    this.setAppState = (obj) => {\r\n      this.setState(obj);\r\n    };\r\n    this.removePointer = (event) => {\r\n      // remove touch handler for context menu on touch devices\r\n      if (event.pointerType === \"touch\" && touchTimeout) {\r\n        clearTimeout(touchTimeout);\r\n        touchTimeout = 0;\r\n        invalidateContextMenu = false;\r\n      }\r\n      gesture.pointers.delete(event.pointerId);\r\n    };\r\n    this.toggleLock = () => {\r\n      this.setState((prevState) => {\r\n        return {\r\n          elementLocked: !prevState.elementLocked,\r\n          elementType: prevState.elementLocked\r\n            ? \"selection\"\r\n            : prevState.elementType,\r\n        };\r\n      });\r\n    };\r\n    this.toggleZenMode = () => {\r\n      this.actionManager.executeAction(actionToggleZenMode);\r\n    };\r\n    this.toggleStats = () => {\r\n      if (!this.state.showStats) {\r\n        trackEvent(\"dialog\", \"stats\");\r\n      }\r\n      this.actionManager.executeAction(actionToggleStats);\r\n    };\r\n    this.scrollToContent = (target = this.scene.getElements()) => {\r\n      this.setState({\r\n        ...calculateScrollCenter(\r\n          Array.isArray(target) ? target : [target],\r\n          this.state,\r\n          this.canvas\r\n        ),\r\n      });\r\n    };\r\n    this.clearToast = () => {\r\n      this.setState({ toastMessage: null });\r\n    };\r\n    this.setToastMessage = (toastMessage) => {\r\n      this.setState({ toastMessage });\r\n    };\r\n    this.restoreFileFromShare = async () => {\r\n      try {\r\n        const webShareTargetCache = await caches.open(\"web-share-target\");\r\n        const file = await webShareTargetCache.match(\"shared-file\");\r\n        if (file) {\r\n          const blob = await file.blob();\r\n          this.loadFileToCanvas(blob);\r\n          await webShareTargetCache.delete(\"shared-file\");\r\n          window.history.replaceState(null, APP_NAME, window.location.pathname);\r\n        }\r\n      } catch (error) {\r\n        this.setState({ errorMessage: error.message });\r\n      }\r\n    };\r\n    /** adds supplied files to existing files in the appState */\r\n    this.addFiles = withBatchedUpdates((files) => {\r\n      const filesMap = files.reduce((acc, fileData) => {\r\n        acc.set(fileData.id, fileData);\r\n        return acc;\r\n      }, new Map());\r\n      this.files = { ...this.files, ...Object.fromEntries(filesMap) };\r\n      // bump versions for elements that reference added files so that\r\n      // we/host apps can detect the change, and invalidate the image & shape\r\n      // cache\r\n      this.scene.getElements().forEach((element) => {\r\n        if (\r\n          isInitializedImageElement(element) &&\r\n          filesMap.has(element.fileId)\r\n        ) {\r\n          this.imageCache.delete(element.fileId);\r\n          invalidateShapeForElement(element);\r\n          bumpVersion(element);\r\n        }\r\n      });\r\n      this.scene.informMutation();\r\n      this.addNewImagesToImageCache();\r\n    });\r\n    this.updateScene = withBatchedUpdates((sceneData) => {\r\n      if (sceneData.commitToHistory) {\r\n        this.history.resumeRecording();\r\n      }\r\n      if (sceneData.appState) {\r\n        this.setState(sceneData.appState);\r\n      }\r\n      if (sceneData.elements) {\r\n        this.scene.replaceAllElements(sceneData.elements);\r\n      }\r\n      if (sceneData.collaborators) {\r\n        this.setState({ collaborators: sceneData.collaborators });\r\n      }\r\n    });\r\n    this.onSceneUpdated = () => {\r\n      this.setState({});\r\n    };\r\n    this.updateCurrentCursorPosition = withBatchedUpdates((event) => {\r\n      cursorX = event.clientX;\r\n      cursorY = event.clientY;\r\n    });\r\n    // Input handling\r\n    this.onKeyDown = withBatchedUpdates((event) => {\r\n      // normalize `event.key` when CapsLock is pressed #2372\r\n      if (\r\n        \"Proxy\" in window &&\r\n        ((!event.shiftKey && /^[A-Z]$/.test(event.key)) ||\r\n          (event.shiftKey && /^[a-z]$/.test(event.key)))\r\n      ) {\r\n        event = new Proxy(event, {\r\n          get(ev, prop) {\r\n            const value = ev[prop];\r\n            if (typeof value === \"function\") {\r\n              // fix for Proxies hijacking `this`\r\n              return value.bind(ev);\r\n            }\r\n            return prop === \"key\"\r\n              ? // CapsLock inverts capitalization based on ShiftKey, so invert\r\n                // it back\r\n                event.shiftKey\r\n                ? ev.key.toUpperCase()\r\n                : ev.key.toLowerCase()\r\n              : value;\r\n          },\r\n        });\r\n      }\r\n      if (\r\n        (isWritableElement(event.target) && event.key !== KEYS.ESCAPE) ||\r\n        // case: using arrows to move between buttons\r\n        (isArrowKey(event.key) && isInputLike(event.target))\r\n      ) {\r\n        return;\r\n      }\r\n      if (event.key === KEYS.QUESTION_MARK) {\r\n        this.setState({\r\n          showHelpDialog: true,\r\n        });\r\n      }\r\n      if (this.actionManager.handleKeyDown(event)) {\r\n        return;\r\n      }\r\n      if (this.state.viewModeEnabled) {\r\n        return;\r\n      }\r\n      if (event[KEYS.CTRL_OR_CMD] && this.state.isBindingEnabled) {\r\n        this.setState({ isBindingEnabled: false });\r\n      }\r\n      if (event.code === CODES.ZERO) {\r\n        this.setState({ isLibraryOpen: !this.state.isLibraryOpen });\r\n      }\r\n      if (isArrowKey(event.key)) {\r\n        const step =\r\n          (this.state.gridSize &&\r\n            (event.shiftKey\r\n              ? ELEMENT_TRANSLATE_AMOUNT\r\n              : this.state.gridSize)) ||\r\n          (event.shiftKey\r\n            ? ELEMENT_SHIFT_TRANSLATE_AMOUNT\r\n            : ELEMENT_TRANSLATE_AMOUNT);\r\n        const selectedElements = this.scene\r\n          .getElements()\r\n          .filter((element) => this.state.selectedElementIds[element.id]);\r\n        let offsetX = 0;\r\n        let offsetY = 0;\r\n        if (event.key === KEYS.ARROW_LEFT) {\r\n          offsetX = -step;\r\n        } else if (event.key === KEYS.ARROW_RIGHT) {\r\n          offsetX = step;\r\n        } else if (event.key === KEYS.ARROW_UP) {\r\n          offsetY = -step;\r\n        } else if (event.key === KEYS.ARROW_DOWN) {\r\n          offsetY = step;\r\n        }\r\n        selectedElements.forEach((element) => {\r\n          mutateElement(element, {\r\n            x: element.x + offsetX,\r\n            y: element.y + offsetY,\r\n          });\r\n          updateBoundElements(element, {\r\n            simultaneouslyUpdated: selectedElements,\r\n          });\r\n        });\r\n        this.maybeSuggestBindingForAll(selectedElements);\r\n        event.preventDefault();\r\n      } else if (event.key === KEYS.ENTER) {\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        if (\r\n          selectedElements.length === 1 &&\r\n          isLinearElement(selectedElements[0])\r\n        ) {\r\n          if (\r\n            !this.state.editingLinearElement ||\r\n            this.state.editingLinearElement.elementId !== selectedElements[0].id\r\n          ) {\r\n            this.history.resumeRecording();\r\n            this.setState({\r\n              editingLinearElement: new LinearElementEditor(\r\n                selectedElements[0],\r\n                this.scene\r\n              ),\r\n            });\r\n          }\r\n        } else if (\r\n          selectedElements.length === 1 &&\r\n          !isLinearElement(selectedElements[0])\r\n        ) {\r\n          const selectedElement = selectedElements[0];\r\n          this.startTextEditing({\r\n            sceneX: selectedElement.x + selectedElement.width / 2,\r\n            sceneY: selectedElement.y + selectedElement.height / 2,\r\n          });\r\n          event.preventDefault();\r\n          return;\r\n        }\r\n      } else if (\r\n        !event.ctrlKey &&\r\n        !event.altKey &&\r\n        !event.metaKey &&\r\n        this.state.draggingElement === null\r\n      ) {\r\n        const shape = findShapeByKey(event.key);\r\n        if (shape) {\r\n          this.selectShapeTool(shape);\r\n        } else if (event.key === KEYS.Q) {\r\n          this.toggleLock();\r\n        }\r\n      }\r\n      if (event.key === KEYS.SPACE && gesture.pointers.size === 0) {\r\n        isHoldingSpace = true;\r\n        setCursor(this.canvas, CURSOR_TYPE.GRABBING);\r\n      }\r\n      if (event.key === KEYS.G || event.key === KEYS.S) {\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        if (\r\n          this.state.elementType === \"selection\" &&\r\n          !selectedElements.length\r\n        ) {\r\n          return;\r\n        }\r\n        if (\r\n          event.key === KEYS.G &&\r\n          (hasBackground(this.state.elementType) ||\r\n            selectedElements.some((element) => hasBackground(element.type)))\r\n        ) {\r\n          this.setState({ openPopup: \"backgroundColorPicker\" });\r\n        }\r\n        if (event.key === KEYS.S) {\r\n          this.setState({ openPopup: \"strokeColorPicker\" });\r\n        }\r\n      }\r\n    });\r\n    this.onKeyUp = withBatchedUpdates((event) => {\r\n      if (event.key === KEYS.SPACE) {\r\n        if (this.state.viewModeEnabled) {\r\n          setCursor(this.canvas, CURSOR_TYPE.GRAB);\r\n        } else if (this.state.elementType === \"selection\") {\r\n          resetCursor(this.canvas);\r\n        } else {\r\n          setCursorForShape(this.canvas, this.state.elementType);\r\n          this.setState({\r\n            selectedElementIds: {},\r\n            selectedGroupIds: {},\r\n            editingGroupId: null,\r\n          });\r\n        }\r\n        isHoldingSpace = false;\r\n      }\r\n      if (!event[KEYS.CTRL_OR_CMD] && !this.state.isBindingEnabled) {\r\n        this.setState({ isBindingEnabled: true });\r\n      }\r\n      if (isArrowKey(event.key)) {\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        isBindingEnabled(this.state)\r\n          ? bindOrUnbindSelectedElements(selectedElements)\r\n          : unbindLinearElements(selectedElements);\r\n        this.setState({ suggestedBindings: [] });\r\n      }\r\n    });\r\n    this.onGestureStart = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      this.setState({\r\n        selectedElementIds: {},\r\n      });\r\n      gesture.initialScale = this.state.zoom.value;\r\n    });\r\n    this.onGestureChange = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      // onGestureChange only has zoom factor but not the center.\r\n      // If we're on iPad or iPhone, then we recognize multi-touch and will\r\n      // zoom in at the right location on the touchMove handler already.\r\n      // On Macbook, we don't have those events so will zoom in at the\r\n      // current location instead.\r\n      if (gesture.pointers.size === 2) {\r\n        return;\r\n      }\r\n      const initialScale = gesture.initialScale;\r\n      if (initialScale) {\r\n        this.setState(({ zoom, offsetLeft, offsetTop }) => ({\r\n          zoom: getNewZoom(\r\n            getNormalizedZoom(initialScale * event.scale),\r\n            zoom,\r\n            { left: offsetLeft, top: offsetTop },\r\n            { x: cursorX, y: cursorY }\r\n          ),\r\n        }));\r\n      }\r\n    });\r\n    this.onGestureEnd = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      this.setState({\r\n        previousSelectedElementIds: {},\r\n        selectedElementIds: this.state.previousSelectedElementIds,\r\n      });\r\n      gesture.initialScale = null;\r\n    });\r\n    this.startTextEditing = ({\r\n      sceneX,\r\n      sceneY,\r\n      insertAtParentCenter = true,\r\n    }) => {\r\n      const existingTextElement = this.getTextElementAtPosition(sceneX, sceneY);\r\n      const parentCenterPosition =\r\n        insertAtParentCenter &&\r\n        this.getTextWysiwygSnappedToCenterPosition(\r\n          sceneX,\r\n          sceneY,\r\n          this.state,\r\n          this.canvas,\r\n          window.devicePixelRatio\r\n        );\r\n      const element = existingTextElement\r\n        ? existingTextElement\r\n        : newTextElement({\r\n            x: parentCenterPosition\r\n              ? parentCenterPosition.elementCenterX\r\n              : sceneX,\r\n            y: parentCenterPosition\r\n              ? parentCenterPosition.elementCenterY\r\n              : sceneY,\r\n            strokeColor: this.state.currentItemStrokeColor,\r\n            backgroundColor: this.state.currentItemBackgroundColor,\r\n            fillStyle: this.state.currentItemFillStyle,\r\n            strokeWidth: this.state.currentItemStrokeWidth,\r\n            strokeStyle: this.state.currentItemStrokeStyle,\r\n            roughness: this.state.currentItemRoughness,\r\n            opacity: this.state.currentItemOpacity,\r\n            strokeSharpness: this.state.currentItemStrokeSharpness,\r\n            text: \"\",\r\n            fontSize: this.state.currentItemFontSize,\r\n            fontFamily: this.state.currentItemFontFamily,\r\n            textAlign: parentCenterPosition\r\n              ? \"center\"\r\n              : this.state.currentItemTextAlign,\r\n            verticalAlign: parentCenterPosition\r\n              ? \"middle\"\r\n              : DEFAULT_VERTICAL_ALIGN,\r\n          });\r\n      this.setState({ editingElement: element });\r\n      if (existingTextElement) {\r\n        // if text element is no longer centered to a container, reset\r\n        // verticalAlign to default because it's currently internal-only\r\n        if (!parentCenterPosition || element.textAlign !== \"center\") {\r\n          mutateElement(element, { verticalAlign: DEFAULT_VERTICAL_ALIGN });\r\n        }\r\n      } else {\r\n        this.scene.replaceAllElements([\r\n          ...this.scene.getElementsIncludingDeleted(),\r\n          element,\r\n        ]);\r\n        // case: creating new text not centered to parent elemenent → offset Y\r\n        // so that the text is centered to cursor position\r\n        if (!parentCenterPosition) {\r\n          mutateElement(element, {\r\n            y: element.y - element.baseline / 2,\r\n          });\r\n        }\r\n      }\r\n      this.setState({\r\n        editingElement: element,\r\n      });\r\n      this.handleTextWysiwyg(element, {\r\n        isExistingElement: !!existingTextElement,\r\n      });\r\n    };\r\n    this.handleCanvasDoubleClick = (event) => {\r\n      // case: double-clicking with arrow/line tool selected would both create\r\n      // text and enter multiElement mode\r\n      if (this.state.multiElement) {\r\n        return;\r\n      }\r\n      // we should only be able to double click when mode is selection\r\n      if (this.state.elementType !== \"selection\") {\r\n        return;\r\n      }\r\n      const selectedElements = getSelectedElements(\r\n        this.scene.getElements(),\r\n        this.state\r\n      );\r\n      if (\r\n        selectedElements.length === 1 &&\r\n        isLinearElement(selectedElements[0])\r\n      ) {\r\n        if (\r\n          !this.state.editingLinearElement ||\r\n          this.state.editingLinearElement.elementId !== selectedElements[0].id\r\n        ) {\r\n          this.history.resumeRecording();\r\n          this.setState({\r\n            editingLinearElement: new LinearElementEditor(\r\n              selectedElements[0],\r\n              this.scene\r\n            ),\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      resetCursor(this.canvas);\r\n      const { x: sceneX, y: sceneY } = viewportCoordsToSceneCoords(\r\n        event,\r\n        this.state\r\n      );\r\n      const selectedGroupIds = getSelectedGroupIds(this.state);\r\n      if (selectedGroupIds.length > 0) {\r\n        const hitElement = this.getElementAtPosition(sceneX, sceneY);\r\n        const selectedGroupId =\r\n          hitElement &&\r\n          getSelectedGroupIdForElement(hitElement, this.state.selectedGroupIds);\r\n        if (selectedGroupId) {\r\n          this.setState((prevState) =>\r\n            selectGroupsForSelectedElements(\r\n              {\r\n                ...prevState,\r\n                editingGroupId: selectedGroupId,\r\n                selectedElementIds: { [hitElement.id]: true },\r\n                selectedGroupIds: {},\r\n              },\r\n              this.scene.getElements()\r\n            )\r\n          );\r\n          return;\r\n        }\r\n      }\r\n      resetCursor(this.canvas);\r\n      if (!event[KEYS.CTRL_OR_CMD] && !this.state.viewModeEnabled) {\r\n        this.startTextEditing({\r\n          sceneX,\r\n          sceneY,\r\n          insertAtParentCenter: !event.altKey,\r\n        });\r\n      }\r\n    };\r\n    this.handleCanvasPointerMove = (event) => {\r\n      this.savePointer(event.clientX, event.clientY, this.state.cursorButton);\r\n      if (gesture.pointers.has(event.pointerId)) {\r\n        gesture.pointers.set(event.pointerId, {\r\n          x: event.clientX,\r\n          y: event.clientY,\r\n        });\r\n      }\r\n      const initialScale = gesture.initialScale;\r\n      if (\r\n        gesture.pointers.size === 2 &&\r\n        gesture.lastCenter &&\r\n        initialScale &&\r\n        gesture.initialDistance\r\n      ) {\r\n        const center = getCenter(gesture.pointers);\r\n        const deltaX = center.x - gesture.lastCenter.x;\r\n        const deltaY = center.y - gesture.lastCenter.y;\r\n        gesture.lastCenter = center;\r\n        const distance = getDistance(Array.from(gesture.pointers.values()));\r\n        const scaleFactor = distance / gesture.initialDistance;\r\n        this.setState(({ zoom, scrollX, scrollY, offsetLeft, offsetTop }) => ({\r\n          scrollX: scrollX + deltaX / zoom.value,\r\n          scrollY: scrollY + deltaY / zoom.value,\r\n          zoom: getNewZoom(\r\n            getNormalizedZoom(initialScale * scaleFactor),\r\n            zoom,\r\n            { left: offsetLeft, top: offsetTop },\r\n            center\r\n          ),\r\n          shouldCacheIgnoreZoom: true,\r\n        }));\r\n        this.resetShouldCacheIgnoreZoomDebounced();\r\n      } else {\r\n        gesture.lastCenter =\r\n          gesture.initialDistance =\r\n          gesture.initialScale =\r\n            null;\r\n      }\r\n      if (isHoldingSpace || isPanning || isDraggingScrollBar) {\r\n        return;\r\n      }\r\n      const isPointerOverScrollBars = isOverScrollBars(\r\n        currentScrollBars,\r\n        event.clientX - this.state.offsetLeft,\r\n        event.clientY - this.state.offsetTop\r\n      );\r\n      const isOverScrollBar = isPointerOverScrollBars.isOverEither;\r\n      if (!this.state.draggingElement && !this.state.multiElement) {\r\n        if (isOverScrollBar) {\r\n          resetCursor(this.canvas);\r\n        } else {\r\n          setCursorForShape(this.canvas, this.state.elementType);\r\n        }\r\n      }\r\n      const scenePointer = viewportCoordsToSceneCoords(event, this.state);\r\n      const { x: scenePointerX, y: scenePointerY } = scenePointer;\r\n      if (\r\n        this.state.editingLinearElement &&\r\n        !this.state.editingLinearElement.isDragging\r\n      ) {\r\n        const editingLinearElement = LinearElementEditor.handlePointerMove(\r\n          event,\r\n          scenePointerX,\r\n          scenePointerY,\r\n          this.state.editingLinearElement,\r\n          this.state.gridSize\r\n        );\r\n        if (editingLinearElement !== this.state.editingLinearElement) {\r\n          this.setState({ editingLinearElement });\r\n        }\r\n        if (editingLinearElement.lastUncommittedPoint != null) {\r\n          this.maybeSuggestBindingAtCursor(scenePointer);\r\n        } else {\r\n          this.setState({ suggestedBindings: [] });\r\n        }\r\n      }\r\n      if (isBindingElementType(this.state.elementType)) {\r\n        // Hovering with a selected tool or creating new linear element via click\r\n        // and point\r\n        const { draggingElement } = this.state;\r\n        if (isBindingElement(draggingElement)) {\r\n          this.maybeSuggestBindingForLinearElementAtCursor(\r\n            draggingElement,\r\n            \"end\",\r\n            scenePointer,\r\n            this.state.startBoundElement\r\n          );\r\n        } else {\r\n          this.maybeSuggestBindingAtCursor(scenePointer);\r\n        }\r\n      }\r\n      if (this.state.multiElement) {\r\n        const { multiElement } = this.state;\r\n        const { x: rx, y: ry } = multiElement;\r\n        const { points, lastCommittedPoint } = multiElement;\r\n        const lastPoint = points[points.length - 1];\r\n        setCursorForShape(this.canvas, this.state.elementType);\r\n        if (lastPoint === lastCommittedPoint) {\r\n          // if we haven't yet created a temp point and we're beyond commit-zone\r\n          // threshold, add a point\r\n          if (\r\n            distance2d(\r\n              scenePointerX - rx,\r\n              scenePointerY - ry,\r\n              lastPoint[0],\r\n              lastPoint[1]\r\n            ) >= LINE_CONFIRM_THRESHOLD\r\n          ) {\r\n            mutateElement(multiElement, {\r\n              points: [...points, [scenePointerX - rx, scenePointerY - ry]],\r\n            });\r\n          } else {\r\n            setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n            // in this branch, we're inside the commit zone, and no uncommitted\r\n            // point exists. Thus do nothing (don't add/remove points).\r\n          }\r\n        } else if (\r\n          points.length > 2 &&\r\n          lastCommittedPoint &&\r\n          distance2d(\r\n            scenePointerX - rx,\r\n            scenePointerY - ry,\r\n            lastCommittedPoint[0],\r\n            lastCommittedPoint[1]\r\n          ) < LINE_CONFIRM_THRESHOLD\r\n        ) {\r\n          setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n          mutateElement(multiElement, {\r\n            points: points.slice(0, -1),\r\n          });\r\n        } else {\r\n          if (isPathALoop(points, this.state.zoom.value)) {\r\n            setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n          }\r\n          // update last uncommitted point\r\n          mutateElement(multiElement, {\r\n            points: [\r\n              ...points.slice(0, -1),\r\n              [scenePointerX - rx, scenePointerY - ry],\r\n            ],\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      const hasDeselectedButton = Boolean(event.buttons);\r\n      if (\r\n        hasDeselectedButton ||\r\n        (this.state.elementType !== \"selection\" &&\r\n          this.state.elementType !== \"text\")\r\n      ) {\r\n        return;\r\n      }\r\n      const elements = this.scene.getElements();\r\n      const selectedElements = getSelectedElements(elements, this.state);\r\n      if (\r\n        selectedElements.length === 1 &&\r\n        !isOverScrollBar &&\r\n        !this.state.editingLinearElement\r\n      ) {\r\n        const elementWithTransformHandleType =\r\n          getElementWithTransformHandleType(\r\n            elements,\r\n            this.state,\r\n            scenePointerX,\r\n            scenePointerY,\r\n            this.state.zoom,\r\n            event.pointerType\r\n          );\r\n        if (\r\n          elementWithTransformHandleType &&\r\n          elementWithTransformHandleType.transformHandleType\r\n        ) {\r\n          setCursor(\r\n            this.canvas,\r\n            getCursorForResizingElement(elementWithTransformHandleType)\r\n          );\r\n          return;\r\n        }\r\n      } else if (selectedElements.length > 1 && !isOverScrollBar) {\r\n        const transformHandleType = getTransformHandleTypeFromCoords(\r\n          getCommonBounds(selectedElements),\r\n          scenePointerX,\r\n          scenePointerY,\r\n          this.state.zoom,\r\n          event.pointerType\r\n        );\r\n        if (transformHandleType) {\r\n          setCursor(\r\n            this.canvas,\r\n            getCursorForResizingElement({\r\n              transformHandleType,\r\n            })\r\n          );\r\n          return;\r\n        }\r\n      }\r\n      const hitElement = this.getElementAtPosition(\r\n        scenePointer.x,\r\n        scenePointer.y\r\n      );\r\n      if (this.state.elementType === \"text\") {\r\n        setCursor(\r\n          this.canvas,\r\n          isTextElement(hitElement) ? CURSOR_TYPE.TEXT : CURSOR_TYPE.CROSSHAIR\r\n        );\r\n      } else if (this.state.viewModeEnabled) {\r\n        setCursor(this.canvas, CURSOR_TYPE.GRAB);\r\n      } else if (isOverScrollBar) {\r\n        setCursor(this.canvas, CURSOR_TYPE.AUTO);\r\n      } else if (\r\n        // if using cmd/ctrl, we're not dragging\r\n        !event[KEYS.CTRL_OR_CMD] &&\r\n        (hitElement ||\r\n          this.isHittingCommonBoundingBoxOfSelectedElements(\r\n            scenePointer,\r\n            selectedElements\r\n          ))\r\n      ) {\r\n        setCursor(this.canvas, CURSOR_TYPE.MOVE);\r\n      } else {\r\n        setCursor(this.canvas, CURSOR_TYPE.AUTO);\r\n      }\r\n    };\r\n    // set touch moving for mobile context menu\r\n    this.handleTouchMove = (event) => {\r\n      invalidateContextMenu = true;\r\n    };\r\n    this.handleCanvasPointerDown = (event) => {\r\n      // remove any active selection when we start to interact with canvas\r\n      // (mainly, we care about removing selection outside the component which\r\n      //  would prevent our copy handling otherwise)\r\n      const selection = document.getSelection();\r\n      if (selection?.anchorNode) {\r\n        selection.removeAllRanges();\r\n      }\r\n      this.maybeOpenContextMenuAfterPointerDownOnTouchDevices(event);\r\n      this.maybeCleanupAfterMissingPointerUp(event);\r\n      if (isPanning) {\r\n        return;\r\n      }\r\n      this.setState({\r\n        lastPointerDownWith: event.pointerType,\r\n        cursorButton: \"down\",\r\n      });\r\n      this.savePointer(event.clientX, event.clientY, \"down\");\r\n      if (this.handleCanvasPanUsingWheelOrSpaceDrag(event)) {\r\n        return;\r\n      }\r\n      // only handle left mouse button or touch\r\n      if (\r\n        event.button !== POINTER_BUTTON.MAIN &&\r\n        event.button !== POINTER_BUTTON.TOUCH\r\n      ) {\r\n        return;\r\n      }\r\n      this.updateGestureOnPointerDown(event);\r\n      // don't select while panning\r\n      if (gesture.pointers.size > 1) {\r\n        return;\r\n      }\r\n      // State for the duration of a pointer interaction, which starts with a\r\n      // pointerDown event, ends with a pointerUp event (or another pointerDown)\r\n      const pointerDownState = this.initialPointerDownState(event);\r\n      if (this.handleDraggingScrollBar(event, pointerDownState)) {\r\n        return;\r\n      }\r\n      this.clearSelectionIfNotUsingSelection();\r\n      this.updateBindingEnabledOnPointerMove(event);\r\n      if (this.handleSelectionOnPointerDown(event, pointerDownState)) {\r\n        return;\r\n      }\r\n      if (this.state.elementType === \"text\") {\r\n        this.handleTextOnPointerDown(event, pointerDownState);\r\n        return;\r\n      } else if (\r\n        this.state.elementType === \"arrow\" ||\r\n        this.state.elementType === \"line\"\r\n      ) {\r\n        this.handleLinearElementOnPointerDown(\r\n          event,\r\n          this.state.elementType,\r\n          pointerDownState\r\n        );\r\n      } else if (this.state.elementType === \"image\") {\r\n        // reset image preview on pointerdown\r\n        setCursor(this.canvas, CURSOR_TYPE.CROSSHAIR);\r\n        if (!this.state.pendingImageElement) {\r\n          return;\r\n        }\r\n        this.setState({\r\n          draggingElement: this.state.pendingImageElement,\r\n          editingElement: this.state.pendingImageElement,\r\n          pendingImageElement: null,\r\n          multiElement: null,\r\n        });\r\n        const { x, y } = viewportCoordsToSceneCoords(event, this.state);\r\n        mutateElement(this.state.pendingImageElement, {\r\n          x,\r\n          y,\r\n        });\r\n      } else if (this.state.elementType === \"freedraw\") {\r\n        this.handleFreeDrawElementOnPointerDown(\r\n          event,\r\n          this.state.elementType,\r\n          pointerDownState\r\n        );\r\n      } else {\r\n        this.createGenericElementOnPointerDown(\r\n          this.state.elementType,\r\n          pointerDownState\r\n        );\r\n      }\r\n      const onPointerMove =\r\n        this.onPointerMoveFromPointerDownHandler(pointerDownState);\r\n      const onPointerUp =\r\n        this.onPointerUpFromPointerDownHandler(pointerDownState);\r\n      const onKeyDown = this.onKeyDownFromPointerDownHandler(pointerDownState);\r\n      const onKeyUp = this.onKeyUpFromPointerDownHandler(pointerDownState);\r\n      lastPointerUp = onPointerUp;\r\n      if (!this.state.viewModeEnabled) {\r\n        window.addEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n        window.addEventListener(EVENT.POINTER_UP, onPointerUp);\r\n        window.addEventListener(EVENT.KEYDOWN, onKeyDown);\r\n        window.addEventListener(EVENT.KEYUP, onKeyUp);\r\n        pointerDownState.eventListeners.onMove = onPointerMove;\r\n        pointerDownState.eventListeners.onUp = onPointerUp;\r\n        pointerDownState.eventListeners.onKeyUp = onKeyUp;\r\n        pointerDownState.eventListeners.onKeyDown = onKeyDown;\r\n      }\r\n    };\r\n    this.maybeOpenContextMenuAfterPointerDownOnTouchDevices = (event) => {\r\n      // deal with opening context menu on touch devices\r\n      if (event.pointerType === \"touch\") {\r\n        invalidateContextMenu = false;\r\n        if (touchTimeout) {\r\n          // If there's already a touchTimeout, this means that there's another\r\n          // touch down and we are doing another touch, so we shouldn't open the\r\n          // context menu.\r\n          invalidateContextMenu = true;\r\n        } else {\r\n          // open the context menu with the first touch's clientX and clientY\r\n          // if the touch is not moving\r\n          touchTimeout = window.setTimeout(() => {\r\n            touchTimeout = 0;\r\n            if (!invalidateContextMenu) {\r\n              this.handleCanvasContextMenu(event);\r\n            }\r\n          }, TOUCH_CTX_MENU_TIMEOUT);\r\n        }\r\n      }\r\n    };\r\n    // Returns whether the event is a panning\r\n    this.handleCanvasPanUsingWheelOrSpaceDrag = (event) => {\r\n      if (\r\n        !(\r\n          gesture.pointers.size === 0 &&\r\n          (event.button === POINTER_BUTTON.WHEEL ||\r\n            (event.button === POINTER_BUTTON.MAIN && isHoldingSpace) ||\r\n            this.state.viewModeEnabled)\r\n        )\r\n      ) {\r\n        return false;\r\n      }\r\n      isPanning = true;\r\n      let nextPastePrevented = false;\r\n      const isLinux = /Linux/.test(window.navigator.platform);\r\n      setCursor(this.canvas, CURSOR_TYPE.GRABBING);\r\n      let { clientX: lastX, clientY: lastY } = event;\r\n      const onPointerMove = withBatchedUpdates((event) => {\r\n        const deltaX = lastX - event.clientX;\r\n        const deltaY = lastY - event.clientY;\r\n        lastX = event.clientX;\r\n        lastY = event.clientY;\r\n        /*\r\n         * Prevent paste event if we move while middle clicking on Linux.\r\n         * See issue #1383.\r\n         */\r\n        if (\r\n          isLinux &&\r\n          !nextPastePrevented &&\r\n          (Math.abs(deltaX) > 1 || Math.abs(deltaY) > 1)\r\n        ) {\r\n          nextPastePrevented = true;\r\n          /* Prevent the next paste event */\r\n          const preventNextPaste = (event) => {\r\n            document.body.removeEventListener(EVENT.PASTE, preventNextPaste);\r\n            event.stopPropagation();\r\n          };\r\n          /*\r\n           * Reenable next paste in case of disabled middle click paste for\r\n           * any reason:\r\n           * - rigth click paste\r\n           * - empty clipboard\r\n           */\r\n          const enableNextPaste = () => {\r\n            setTimeout(() => {\r\n              document.body.removeEventListener(EVENT.PASTE, preventNextPaste);\r\n              window.removeEventListener(EVENT.POINTER_UP, enableNextPaste);\r\n            }, 100);\r\n          };\r\n          document.body.addEventListener(EVENT.PASTE, preventNextPaste);\r\n          window.addEventListener(EVENT.POINTER_UP, enableNextPaste);\r\n        }\r\n        this.setState({\r\n          scrollX: this.state.scrollX - deltaX / this.state.zoom.value,\r\n          scrollY: this.state.scrollY - deltaY / this.state.zoom.value,\r\n        });\r\n      });\r\n      const teardown = withBatchedUpdates(\r\n        (lastPointerUp = () => {\r\n          lastPointerUp = null;\r\n          isPanning = false;\r\n          if (!isHoldingSpace) {\r\n            if (this.state.viewModeEnabled) {\r\n              setCursor(this.canvas, CURSOR_TYPE.GRAB);\r\n            } else {\r\n              setCursorForShape(this.canvas, this.state.elementType);\r\n            }\r\n          }\r\n          this.setState({\r\n            cursorButton: \"up\",\r\n          });\r\n          this.savePointer(event.clientX, event.clientY, \"up\");\r\n          window.removeEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n          window.removeEventListener(EVENT.POINTER_UP, teardown);\r\n          window.removeEventListener(EVENT.BLUR, teardown);\r\n        })\r\n      );\r\n      window.addEventListener(EVENT.BLUR, teardown);\r\n      window.addEventListener(EVENT.POINTER_MOVE, onPointerMove, {\r\n        passive: true,\r\n      });\r\n      window.addEventListener(EVENT.POINTER_UP, teardown);\r\n      return true;\r\n    };\r\n    this.clearSelectionIfNotUsingSelection = () => {\r\n      if (this.state.elementType !== \"selection\") {\r\n        this.setState({\r\n          selectedElementIds: {},\r\n          selectedGroupIds: {},\r\n          editingGroupId: null,\r\n        });\r\n      }\r\n    };\r\n    /**\r\n     * @returns whether the pointer event has been completely handled\r\n     */\r\n    this.handleSelectionOnPointerDown = (event, pointerDownState) => {\r\n      if (this.state.elementType === \"selection\") {\r\n        const elements = this.scene.getElements();\r\n        const selectedElements = getSelectedElements(elements, this.state);\r\n        if (selectedElements.length === 1 && !this.state.editingLinearElement) {\r\n          const elementWithTransformHandleType =\r\n            getElementWithTransformHandleType(\r\n              elements,\r\n              this.state,\r\n              pointerDownState.origin.x,\r\n              pointerDownState.origin.y,\r\n              this.state.zoom,\r\n              event.pointerType\r\n            );\r\n          if (elementWithTransformHandleType != null) {\r\n            this.setState({\r\n              resizingElement: elementWithTransformHandleType.element,\r\n            });\r\n            pointerDownState.resize.handleType =\r\n              elementWithTransformHandleType.transformHandleType;\r\n          }\r\n        } else if (selectedElements.length > 1) {\r\n          pointerDownState.resize.handleType = getTransformHandleTypeFromCoords(\r\n            getCommonBounds(selectedElements),\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y,\r\n            this.state.zoom,\r\n            event.pointerType\r\n          );\r\n        }\r\n        if (pointerDownState.resize.handleType) {\r\n          setCursor(\r\n            this.canvas,\r\n            getCursorForResizingElement({\r\n              transformHandleType: pointerDownState.resize.handleType,\r\n            })\r\n          );\r\n          pointerDownState.resize.isResizing = true;\r\n          pointerDownState.resize.offset = tupleToCoors(\r\n            getResizeOffsetXY(\r\n              pointerDownState.resize.handleType,\r\n              selectedElements,\r\n              pointerDownState.origin.x,\r\n              pointerDownState.origin.y\r\n            )\r\n          );\r\n          if (\r\n            selectedElements.length === 1 &&\r\n            isLinearElement(selectedElements[0]) &&\r\n            selectedElements[0].points.length === 2\r\n          ) {\r\n            pointerDownState.resize.arrowDirection = getResizeArrowDirection(\r\n              pointerDownState.resize.handleType,\r\n              selectedElements[0]\r\n            );\r\n          }\r\n        } else {\r\n          if (this.state.editingLinearElement) {\r\n            const ret = LinearElementEditor.handlePointerDown(\r\n              event,\r\n              this.state,\r\n              (appState) => this.setState(appState),\r\n              this.history,\r\n              pointerDownState.origin\r\n            );\r\n            if (ret.hitElement) {\r\n              pointerDownState.hit.element = ret.hitElement;\r\n            }\r\n            if (ret.didAddPoint) {\r\n              return true;\r\n            }\r\n          }\r\n          // hitElement may already be set above, so check first\r\n          pointerDownState.hit.element =\r\n            pointerDownState.hit.element ??\r\n            this.getElementAtPosition(\r\n              pointerDownState.origin.x,\r\n              pointerDownState.origin.y\r\n            );\r\n          // For overlapped elements one position may hit\r\n          // multiple elements\r\n          pointerDownState.hit.allHitElements = this.getElementsAtPosition(\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          );\r\n          const hitElement = pointerDownState.hit.element;\r\n          const someHitElementIsSelected =\r\n            pointerDownState.hit.allHitElements.some((element) =>\r\n              this.isASelectedElement(element)\r\n            );\r\n          if (\r\n            (hitElement === null || !someHitElementIsSelected) &&\r\n            !event.shiftKey &&\r\n            !pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements\r\n          ) {\r\n            this.clearSelection(hitElement);\r\n          }\r\n          // If we click on something\r\n          if (hitElement != null) {\r\n            // on CMD/CTRL, drill down to hit element regardless of groups etc.\r\n            if (event[KEYS.CTRL_OR_CMD]) {\r\n              if (!this.state.selectedElementIds[hitElement.id]) {\r\n                pointerDownState.hit.wasAddedToSelection = true;\r\n              }\r\n              this.setState((prevState) => ({\r\n                ...editGroupForSelectedElement(prevState, hitElement),\r\n                previousSelectedElementIds: this.state.selectedElementIds,\r\n              }));\r\n              // mark as not completely handled so as to allow dragging etc.\r\n              return false;\r\n            }\r\n            // deselect if item is selected\r\n            // if shift is not clicked, this will always return true\r\n            // otherwise, it will trigger selection based on current\r\n            // state of the box\r\n            if (!this.state.selectedElementIds[hitElement.id]) {\r\n              // if we are currently editing a group, exiting editing mode and deselect the group.\r\n              if (\r\n                this.state.editingGroupId &&\r\n                !isElementInGroup(hitElement, this.state.editingGroupId)\r\n              ) {\r\n                this.setState({\r\n                  selectedElementIds: {},\r\n                  selectedGroupIds: {},\r\n                  editingGroupId: null,\r\n                });\r\n              }\r\n              // Add hit element to selection. At this point if we're not holding\r\n              // SHIFT the previously selected element(s) were deselected above\r\n              // (make sure you use setState updater to use latest state)\r\n              if (\r\n                !someHitElementIsSelected &&\r\n                !pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements\r\n              ) {\r\n                this.setState((prevState) => {\r\n                  return selectGroupsForSelectedElements(\r\n                    {\r\n                      ...prevState,\r\n                      selectedElementIds: {\r\n                        ...prevState.selectedElementIds,\r\n                        [hitElement.id]: true,\r\n                      },\r\n                    },\r\n                    this.scene.getElements()\r\n                  );\r\n                });\r\n                pointerDownState.hit.wasAddedToSelection = true;\r\n              }\r\n            }\r\n          }\r\n          this.setState({\r\n            previousSelectedElementIds: this.state.selectedElementIds,\r\n          });\r\n        }\r\n      }\r\n      return false;\r\n    };\r\n    this.handleTextOnPointerDown = (event, pointerDownState) => {\r\n      // if we're currently still editing text, clicking outside\r\n      // should only finalize it, not create another (irrespective\r\n      // of state.elementLocked)\r\n      if (this.state.editingElement?.type === \"text\") {\r\n        return;\r\n      }\r\n      this.startTextEditing({\r\n        sceneX: pointerDownState.origin.x,\r\n        sceneY: pointerDownState.origin.y,\r\n        insertAtParentCenter: !event.altKey,\r\n      });\r\n      resetCursor(this.canvas);\r\n      if (!this.state.elementLocked) {\r\n        this.setState({\r\n          elementType: \"selection\",\r\n        });\r\n      }\r\n    };\r\n    this.handleFreeDrawElementOnPointerDown = (\r\n      event,\r\n      elementType,\r\n      pointerDownState\r\n    ) => {\r\n      // Begin a mark capture. This does not have to update state yet.\r\n      const [gridX, gridY] = getGridPoint(\r\n        pointerDownState.origin.x,\r\n        pointerDownState.origin.y,\r\n        null\r\n      );\r\n      const element = newFreeDrawElement({\r\n        type: elementType,\r\n        x: gridX,\r\n        y: gridY,\r\n        strokeColor: this.state.currentItemStrokeColor,\r\n        backgroundColor: this.state.currentItemBackgroundColor,\r\n        fillStyle: this.state.currentItemFillStyle,\r\n        strokeWidth: this.state.currentItemStrokeWidth,\r\n        strokeStyle: this.state.currentItemStrokeStyle,\r\n        roughness: this.state.currentItemRoughness,\r\n        opacity: this.state.currentItemOpacity,\r\n        strokeSharpness: this.state.currentItemLinearStrokeSharpness,\r\n        simulatePressure: event.pressure === 0.5,\r\n      });\r\n      this.setState((prevState) => ({\r\n        selectedElementIds: {\r\n          ...prevState.selectedElementIds,\r\n          [element.id]: false,\r\n        },\r\n      }));\r\n      const pressures = element.simulatePressure\r\n        ? element.pressures\r\n        : [...element.pressures, event.pressure];\r\n      mutateElement(element, {\r\n        points: [[0, 0]],\r\n        pressures,\r\n      });\r\n      const boundElement = getHoveredElementForBinding(\r\n        pointerDownState.origin,\r\n        this.scene\r\n      );\r\n      this.scene.replaceAllElements([\r\n        ...this.scene.getElementsIncludingDeleted(),\r\n        element,\r\n      ]);\r\n      this.setState({\r\n        draggingElement: element,\r\n        editingElement: element,\r\n        startBoundElement: boundElement,\r\n        suggestedBindings: [],\r\n      });\r\n    };\r\n    this.createImageElement = ({ sceneX, sceneY }) => {\r\n      const [gridX, gridY] = getGridPoint(sceneX, sceneY, this.state.gridSize);\r\n      const element = newImageElement({\r\n        type: \"image\",\r\n        x: gridX,\r\n        y: gridY,\r\n        strokeColor: this.state.currentItemStrokeColor,\r\n        backgroundColor: this.state.currentItemBackgroundColor,\r\n        fillStyle: this.state.currentItemFillStyle,\r\n        strokeWidth: this.state.currentItemStrokeWidth,\r\n        strokeStyle: this.state.currentItemStrokeStyle,\r\n        roughness: this.state.currentItemRoughness,\r\n        opacity: this.state.currentItemOpacity,\r\n        strokeSharpness: this.state.currentItemLinearStrokeSharpness,\r\n      });\r\n      return element;\r\n    };\r\n    this.handleLinearElementOnPointerDown = (\r\n      event,\r\n      elementType,\r\n      pointerDownState\r\n    ) => {\r\n      if (this.state.multiElement) {\r\n        const { multiElement } = this.state;\r\n        // finalize if completing a loop\r\n        if (\r\n          multiElement.type === \"line\" &&\r\n          isPathALoop(multiElement.points, this.state.zoom.value)\r\n        ) {\r\n          mutateElement(multiElement, {\r\n            lastCommittedPoint:\r\n              multiElement.points[multiElement.points.length - 1],\r\n          });\r\n          this.actionManager.executeAction(actionFinalize);\r\n          return;\r\n        }\r\n        const { x: rx, y: ry, lastCommittedPoint } = multiElement;\r\n        // clicking inside commit zone → finalize arrow\r\n        if (\r\n          multiElement.points.length > 1 &&\r\n          lastCommittedPoint &&\r\n          distance2d(\r\n            pointerDownState.origin.x - rx,\r\n            pointerDownState.origin.y - ry,\r\n            lastCommittedPoint[0],\r\n            lastCommittedPoint[1]\r\n          ) < LINE_CONFIRM_THRESHOLD\r\n        ) {\r\n          this.actionManager.executeAction(actionFinalize);\r\n          return;\r\n        }\r\n        this.setState((prevState) => ({\r\n          selectedElementIds: {\r\n            ...prevState.selectedElementIds,\r\n            [multiElement.id]: true,\r\n          },\r\n        }));\r\n        // clicking outside commit zone → update reference for last committed\r\n        // point\r\n        mutateElement(multiElement, {\r\n          lastCommittedPoint:\r\n            multiElement.points[multiElement.points.length - 1],\r\n        });\r\n        setCursor(this.canvas, CURSOR_TYPE.POINTER);\r\n      } else {\r\n        const [gridX, gridY] = getGridPoint(\r\n          pointerDownState.origin.x,\r\n          pointerDownState.origin.y,\r\n          this.state.gridSize\r\n        );\r\n        /* If arrow is pre-arrowheads, it will have undefined for both start and end arrowheads.\r\n                If so, we want it to be null for start and \"arrow\" for end. If the linear item is not\r\n                an arrow, we want it to be null for both. Otherwise, we want it to use the\r\n                values from appState. */\r\n        const { currentItemStartArrowhead, currentItemEndArrowhead } =\r\n          this.state;\r\n        const [startArrowhead, endArrowhead] =\r\n          elementType === \"arrow\"\r\n            ? [currentItemStartArrowhead, currentItemEndArrowhead]\r\n            : [null, null];\r\n        const element = newLinearElement({\r\n          type: elementType,\r\n          x: gridX,\r\n          y: gridY,\r\n          strokeColor: this.state.currentItemStrokeColor,\r\n          backgroundColor: this.state.currentItemBackgroundColor,\r\n          fillStyle: this.state.currentItemFillStyle,\r\n          strokeWidth: this.state.currentItemStrokeWidth,\r\n          strokeStyle: this.state.currentItemStrokeStyle,\r\n          roughness: this.state.currentItemRoughness,\r\n          opacity: this.state.currentItemOpacity,\r\n          strokeSharpness: this.state.currentItemLinearStrokeSharpness,\r\n          startArrowhead,\r\n          endArrowhead,\r\n        });\r\n        this.setState((prevState) => ({\r\n          selectedElementIds: {\r\n            ...prevState.selectedElementIds,\r\n            [element.id]: false,\r\n          },\r\n        }));\r\n        mutateElement(element, {\r\n          points: [...element.points, [0, 0]],\r\n        });\r\n        const boundElement = getHoveredElementForBinding(\r\n          pointerDownState.origin,\r\n          this.scene\r\n        );\r\n        this.scene.replaceAllElements([\r\n          ...this.scene.getElementsIncludingDeleted(),\r\n          element,\r\n        ]);\r\n        this.setState({\r\n          draggingElement: element,\r\n          editingElement: element,\r\n          startBoundElement: boundElement,\r\n          suggestedBindings: [],\r\n        });\r\n      }\r\n    };\r\n    this.createGenericElementOnPointerDown = (\r\n      elementType,\r\n      pointerDownState\r\n    ) => {\r\n      const [gridX, gridY] = getGridPoint(\r\n        pointerDownState.origin.x,\r\n        pointerDownState.origin.y,\r\n        this.state.gridSize\r\n      );\r\n      const element = newElement({\r\n        type: elementType,\r\n        x: gridX,\r\n        y: gridY,\r\n        strokeColor: this.state.currentItemStrokeColor,\r\n        backgroundColor: this.state.currentItemBackgroundColor,\r\n        fillStyle: this.state.currentItemFillStyle,\r\n        strokeWidth: this.state.currentItemStrokeWidth,\r\n        strokeStyle: this.state.currentItemStrokeStyle,\r\n        roughness: this.state.currentItemRoughness,\r\n        opacity: this.state.currentItemOpacity,\r\n        strokeSharpness: this.state.currentItemStrokeSharpness,\r\n      });\r\n      if (element.type === \"selection\") {\r\n        this.setState({\r\n          selectionElement: element,\r\n          draggingElement: element,\r\n        });\r\n      } else {\r\n        this.scene.replaceAllElements([\r\n          ...this.scene.getElementsIncludingDeleted(),\r\n          element,\r\n        ]);\r\n        this.setState({\r\n          multiElement: null,\r\n          draggingElement: element,\r\n          editingElement: element,\r\n        });\r\n      }\r\n    };\r\n    this.initializeImage = async ({\r\n      imageFile,\r\n      imageElement: _imageElement,\r\n      showCursorImagePreview = false,\r\n    }) => {\r\n      // at this point this should be guaranteed image file, but we do this check\r\n      // to satisfy TS down the line\r\n      if (!isSupportedImageFile(imageFile)) {\r\n        throw new Error(t(\"errors.unsupportedFileType\"));\r\n      }\r\n      const mimeType = imageFile.type;\r\n      setCursor(this.canvas, \"wait\");\r\n      if (mimeType === MIME_TYPES.svg) {\r\n        try {\r\n          imageFile = SVGStringToFile(\r\n            await normalizeSVG(await imageFile.text()),\r\n            imageFile.name\r\n          );\r\n        } catch (error) {\r\n          console.warn(error);\r\n          throw new Error(t(\"errors.svgImageInsertError\"));\r\n        }\r\n      }\r\n      // generate image id (by default the file digest) before any\r\n      // resizing/compression takes place to keep it more portable\r\n      const fileId = await (this.props.generateIdForFile?.(imageFile) ||\r\n        generateIdFromFile(imageFile));\r\n      if (!fileId) {\r\n        console.warn(\r\n          \"Couldn't generate file id or the supplied `generateIdForFile` didn't resolve to one.\"\r\n        );\r\n        throw new Error(t(\"errors.imageInsertError\"));\r\n      }\r\n      const existingFileData = this.files[fileId];\r\n      if (!existingFileData?.dataURL) {\r\n        try {\r\n          imageFile = await resizeImageFile(\r\n            imageFile,\r\n            DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT\r\n          );\r\n        } catch (error) {\r\n          console.error(\r\n            \"error trying to resing image file on insertion\",\r\n            error\r\n          );\r\n        }\r\n        if (imageFile.size > MAX_ALLOWED_FILE_BYTES) {\r\n          throw new Error(\r\n            t(\"errors.fileTooBig\", {\r\n              maxSize: `${Math.trunc(MAX_ALLOWED_FILE_BYTES / 1024 / 1024)}MB`,\r\n            })\r\n          );\r\n        }\r\n      }\r\n      if (showCursorImagePreview) {\r\n        const dataURL = this.files[fileId]?.dataURL;\r\n        // optimization so that we don't unnecessarily resize the original\r\n        // full-size file for cursor preview\r\n        // (it's much faster to convert the resized dataURL to File)\r\n        const resizedFile = dataURL && dataURLToFile(dataURL);\r\n        this.setImagePreviewCursor(resizedFile || imageFile);\r\n      }\r\n      const dataURL =\r\n        this.files[fileId]?.dataURL || (await getDataURL(imageFile));\r\n      const imageElement = mutateElement(\r\n        _imageElement,\r\n        {\r\n          fileId,\r\n        },\r\n        false\r\n      );\r\n      return new Promise(async (resolve, reject) => {\r\n        try {\r\n          this.files = {\r\n            ...this.files,\r\n            [fileId]: {\r\n              mimeType,\r\n              id: fileId,\r\n              dataURL,\r\n              created: Date.now(),\r\n            },\r\n          };\r\n          const cachedImageData = this.imageCache.get(fileId);\r\n          if (!cachedImageData) {\r\n            this.addNewImagesToImageCache();\r\n            await this.updateImageCache([imageElement]);\r\n          }\r\n          if (cachedImageData?.image instanceof Promise) {\r\n            await cachedImageData.image;\r\n          }\r\n          if (\r\n            this.state.pendingImageElement?.id !== imageElement.id &&\r\n            this.state.draggingElement?.id !== imageElement.id\r\n          ) {\r\n            this.initializeImageDimensions(imageElement, true);\r\n          }\r\n          resolve(imageElement);\r\n        } catch (error) {\r\n          console.error(error);\r\n          reject(new Error(t(\"errors.imageInsertError\")));\r\n        } finally {\r\n          if (!showCursorImagePreview) {\r\n            resetCursor(this.canvas);\r\n          }\r\n        }\r\n      });\r\n    };\r\n    /**\r\n     * inserts image into elements array and rerenders\r\n     */\r\n    this.insertImageElement = async (\r\n      imageElement,\r\n      imageFile,\r\n      showCursorImagePreview\r\n    ) => {\r\n      this.scene.replaceAllElements([\r\n        ...this.scene.getElementsIncludingDeleted(),\r\n        imageElement,\r\n      ]);\r\n      try {\r\n        await this.initializeImage({\r\n          imageFile,\r\n          imageElement,\r\n          showCursorImagePreview,\r\n        });\r\n      } catch (error) {\r\n        mutateElement(imageElement, {\r\n          isDeleted: true,\r\n        });\r\n        this.actionManager.executeAction(actionFinalize);\r\n        this.setState({\r\n          errorMessage: error.message || t(\"errors.imageInsertError\"),\r\n        });\r\n      }\r\n    };\r\n    this.setImagePreviewCursor = async (imageFile) => {\r\n      // mustn't be larger than 128 px\r\n      // https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Basic_User_Interface/Using_URL_values_for_the_cursor_property\r\n      const cursorImageSizePx = 96;\r\n      const imagePreview = await resizeImageFile(imageFile, cursorImageSizePx);\r\n      let previewDataURL = await getDataURL(imagePreview);\r\n      // SVG cannot be resized via `resizeImageFile` so we resize by rendering to\r\n      // a small canvas\r\n      if (imageFile.type === MIME_TYPES.svg) {\r\n        const img = await loadHTMLImageElement(previewDataURL);\r\n        let height = Math.min(img.height, cursorImageSizePx);\r\n        let width = height * (img.width / img.height);\r\n        if (width > cursorImageSizePx) {\r\n          width = cursorImageSizePx;\r\n          height = width * (img.height / img.width);\r\n        }\r\n        const canvas = document.createElement(\"canvas\");\r\n        canvas.height = height;\r\n        canvas.width = width;\r\n        const context = canvas.getContext(\"2d\");\r\n        context.drawImage(img, 0, 0, width, height);\r\n        previewDataURL = canvas.toDataURL(MIME_TYPES.svg);\r\n      }\r\n      if (this.state.pendingImageElement) {\r\n        setCursor(this.canvas, `url(${previewDataURL}) 4 4, auto`);\r\n      }\r\n    };\r\n    this.onImageAction = async (\r\n      { insertOnCanvasDirectly } = { insertOnCanvasDirectly: false }\r\n    ) => {\r\n      try {\r\n        const clientX = this.state.width / 2 + this.state.offsetLeft;\r\n        const clientY = this.state.height / 2 + this.state.offsetTop;\r\n        const { x, y } = viewportCoordsToSceneCoords(\r\n          { clientX, clientY },\r\n          this.state\r\n        );\r\n        const imageFile = await fileOpen({\r\n          description: \"Image\",\r\n          extensions: [\"jpg\", \"png\", \"svg\", \"gif\"],\r\n        });\r\n        const imageElement = this.createImageElement({\r\n          sceneX: x,\r\n          sceneY: y,\r\n        });\r\n        if (insertOnCanvasDirectly) {\r\n          this.insertImageElement(imageElement, imageFile);\r\n          this.initializeImageDimensions(imageElement);\r\n          this.setState(\r\n            {\r\n              selectedElementIds: { [imageElement.id]: true },\r\n            },\r\n            () => {\r\n              this.actionManager.executeAction(actionFinalize);\r\n            }\r\n          );\r\n        } else {\r\n          this.setState(\r\n            {\r\n              pendingImageElement: imageElement,\r\n            },\r\n            () => {\r\n              this.insertImageElement(\r\n                imageElement,\r\n                imageFile,\r\n                /* showCursorImagePreview */ true\r\n              );\r\n            }\r\n          );\r\n        }\r\n      } catch (error) {\r\n        if (error.name !== \"AbortError\") {\r\n          console.error(error);\r\n        }\r\n        this.setState(\r\n          {\r\n            pendingImageElement: null,\r\n            editingElement: null,\r\n            elementType: \"selection\",\r\n          },\r\n          () => {\r\n            this.actionManager.executeAction(actionFinalize);\r\n          }\r\n        );\r\n      }\r\n    };\r\n    this.initializeImageDimensions = (\r\n      imageElement,\r\n      forceNaturalSize = false\r\n    ) => {\r\n      const image =\r\n        isInitializedImageElement(imageElement) &&\r\n        this.imageCache.get(imageElement.fileId)?.image;\r\n      if (!image || image instanceof Promise) {\r\n        if (\r\n          imageElement.width < DRAGGING_THRESHOLD / this.state.zoom.value &&\r\n          imageElement.height < DRAGGING_THRESHOLD / this.state.zoom.value\r\n        ) {\r\n          const placeholderSize = 100 / this.state.zoom.value;\r\n          mutateElement(imageElement, {\r\n            x: imageElement.x - placeholderSize / 2,\r\n            y: imageElement.y - placeholderSize / 2,\r\n            width: placeholderSize,\r\n            height: placeholderSize,\r\n          });\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        forceNaturalSize ||\r\n        // if user-created bounding box is below threshold, assume the\r\n        // intention was to click instead of drag, and use the image's\r\n        // intrinsic size\r\n        (imageElement.width < DRAGGING_THRESHOLD / this.state.zoom.value &&\r\n          imageElement.height < DRAGGING_THRESHOLD / this.state.zoom.value)\r\n      ) {\r\n        const minHeight = Math.max(this.state.height - 120, 160);\r\n        // max 65% of canvas height, clamped to <300px, vh - 120px>\r\n        const maxHeight = Math.min(\r\n          minHeight,\r\n          Math.floor(this.state.height * 0.5) / this.state.zoom.value\r\n        );\r\n        const height = Math.min(image.naturalHeight, maxHeight);\r\n        const width = height * (image.naturalWidth / image.naturalHeight);\r\n        // add current imageElement width/height to account for previous centering\r\n        // of the placholder image\r\n        const x = imageElement.x + imageElement.width / 2 - width / 2;\r\n        const y = imageElement.y + imageElement.height / 2 - height / 2;\r\n        mutateElement(imageElement, { x, y, width, height });\r\n      }\r\n    };\r\n    /** updates image cache, refreshing updated elements and/or setting status\r\n            to error for images that fail during <img> element creation */\r\n    this.updateImageCache = async (elements, files = this.files) => {\r\n      const { updatedFiles, erroredFiles } = await _updateImageCache({\r\n        imageCache: this.imageCache,\r\n        fileIds: elements.map((element) => element.fileId),\r\n        files,\r\n      });\r\n      if (updatedFiles.size || erroredFiles.size) {\r\n        for (const element of elements) {\r\n          if (updatedFiles.has(element.fileId)) {\r\n            invalidateShapeForElement(element);\r\n          }\r\n        }\r\n      }\r\n      if (erroredFiles.size) {\r\n        this.scene.replaceAllElements(\r\n          this.scene.getElementsIncludingDeleted().map((element) => {\r\n            if (\r\n              isInitializedImageElement(element) &&\r\n              erroredFiles.has(element.fileId)\r\n            ) {\r\n              return newElementWith(element, {\r\n                status: \"error\",\r\n              });\r\n            }\r\n            return element;\r\n          })\r\n        );\r\n      }\r\n      return { updatedFiles, erroredFiles };\r\n    };\r\n    /** adds new images to imageCache and re-renders if needed */\r\n    this.addNewImagesToImageCache = async (\r\n      imageElements = getInitializedImageElements(this.scene.getElements()),\r\n      files = this.files\r\n    ) => {\r\n      const uncachedImageElements = imageElements.filter(\r\n        (element) => !element.isDeleted && !this.imageCache.has(element.fileId)\r\n      );\r\n      if (uncachedImageElements.length) {\r\n        const { updatedFiles } = await this.updateImageCache(\r\n          uncachedImageElements,\r\n          files\r\n        );\r\n        if (updatedFiles.size) {\r\n          this.scene.informMutation();\r\n        }\r\n      }\r\n    };\r\n    /** generally you should use `addNewImagesToImageCache()` directly if you need\r\n     *  to render new images. This is just a failsafe  */\r\n    this.scheduleImageRefresh = throttle(() => {\r\n      this.addNewImagesToImageCache();\r\n    }, IMAGE_RENDER_TIMEOUT);\r\n    this.updateBindingEnabledOnPointerMove = (event) => {\r\n      const shouldEnableBinding = shouldEnableBindingForPointerEvent(event);\r\n      if (this.state.isBindingEnabled !== shouldEnableBinding) {\r\n        this.setState({ isBindingEnabled: shouldEnableBinding });\r\n      }\r\n    };\r\n    this.maybeSuggestBindingAtCursor = (pointerCoords) => {\r\n      const hoveredBindableElement = getHoveredElementForBinding(\r\n        pointerCoords,\r\n        this.scene\r\n      );\r\n      this.setState({\r\n        suggestedBindings:\r\n          hoveredBindableElement != null ? [hoveredBindableElement] : [],\r\n      });\r\n    };\r\n    this.maybeSuggestBindingForLinearElementAtCursor = (\r\n      linearElement,\r\n      startOrEnd,\r\n      pointerCoords,\r\n      // During line creation the start binding hasn't been written yet\r\n      // into `linearElement`\r\n      oppositeBindingBoundElement\r\n    ) => {\r\n      const hoveredBindableElement = getHoveredElementForBinding(\r\n        pointerCoords,\r\n        this.scene\r\n      );\r\n      this.setState({\r\n        suggestedBindings:\r\n          hoveredBindableElement != null &&\r\n          !isLinearElementSimpleAndAlreadyBound(\r\n            linearElement,\r\n            oppositeBindingBoundElement?.id,\r\n            hoveredBindableElement\r\n          )\r\n            ? [hoveredBindableElement]\r\n            : [],\r\n      });\r\n    };\r\n    this.handleCanvasRef = (canvas) => {\r\n      // canvas is null when unmounting\r\n      if (canvas !== null) {\r\n        this.canvas = canvas;\r\n        this.rc = rough.canvas(this.canvas);\r\n        this.canvas.addEventListener(EVENT.WHEEL, this.handleWheel, {\r\n          passive: false,\r\n        });\r\n        this.canvas.addEventListener(EVENT.TOUCH_START, this.onTapStart);\r\n        this.canvas.addEventListener(EVENT.TOUCH_END, this.onTapEnd);\r\n      } else {\r\n        this.canvas?.removeEventListener(EVENT.WHEEL, this.handleWheel);\r\n        this.canvas?.removeEventListener(EVENT.TOUCH_START, this.onTapStart);\r\n        this.canvas?.removeEventListener(EVENT.TOUCH_END, this.onTapEnd);\r\n      }\r\n    };\r\n    this.handleAppOnDrop = async (event) => {\r\n      try {\r\n        const file = event.dataTransfer.files[0];\r\n        if (isSupportedImageFile(file)) {\r\n          // first attempt to decode scene from the image if it's embedded\r\n          // ---------------------------------------------------------------------\r\n          if (file?.type === MIME_TYPES.png || file?.type === MIME_TYPES.svg) {\r\n            try {\r\n              if (nativeFileSystemSupported) {\r\n                try {\r\n                  // This will only work as of Chrome 86,\r\n                  // but can be safely ignored on older releases.\r\n                  const item = event.dataTransfer.items[0];\r\n                  file.handle = await item.getAsFileSystemHandle();\r\n                } catch (error) {\r\n                  console.warn(error.name, error.message);\r\n                }\r\n              }\r\n              const scene = await loadFromBlob(\r\n                file,\r\n                this.state,\r\n                this.scene.getElementsIncludingDeleted()\r\n              );\r\n              this.syncActionResult({\r\n                ...scene,\r\n                appState: {\r\n                  ...(scene.appState || this.state),\r\n                  isLoading: false,\r\n                },\r\n                replaceFiles: true,\r\n                commitToHistory: true,\r\n              });\r\n              return;\r\n            } catch (error) {\r\n              if (error.name !== \"EncodingError\") {\r\n                throw error;\r\n              }\r\n            }\r\n          }\r\n          // if no scene is embedded or we fail for whatever reason, fall back\r\n          // to importing as regular image\r\n          // ---------------------------------------------------------------------\r\n          const { x: sceneX, y: sceneY } = viewportCoordsToSceneCoords(\r\n            event,\r\n            this.state\r\n          );\r\n          const imageElement = this.createImageElement({ sceneX, sceneY });\r\n          this.insertImageElement(imageElement, file);\r\n          this.initializeImageDimensions(imageElement);\r\n          this.setState({ selectedElementIds: { [imageElement.id]: true } });\r\n          return;\r\n        }\r\n      } catch (error) {\r\n        return this.setState({\r\n          isLoading: false,\r\n          errorMessage: error.message,\r\n        });\r\n      }\r\n      const libraryShapes = event.dataTransfer.getData(\r\n        MIME_TYPES.excalidrawlib\r\n      );\r\n      if (libraryShapes !== \"\") {\r\n        this.addElementsFromPasteOrLibrary({\r\n          elements: JSON.parse(libraryShapes),\r\n          position: event,\r\n          files: null,\r\n        });\r\n        return;\r\n      }\r\n      const file = event.dataTransfer?.files[0];\r\n      if (\r\n        file?.type === MIME_TYPES.excalidrawlib ||\r\n        file?.name?.endsWith(\".excalidrawlib\")\r\n      ) {\r\n        this.library\r\n          .importLibrary(file)\r\n          .then(() => {\r\n            // Close and then open to get the libraries updated\r\n            this.setState({ isLibraryOpen: false });\r\n            this.setState({ isLibraryOpen: true });\r\n          })\r\n          .catch((error) =>\r\n            this.setState({ isLoading: false, errorMessage: error.message })\r\n          );\r\n        // default: assume an Excalidraw file regardless of extension/MimeType\r\n      } else {\r\n        this.setState({ isLoading: true });\r\n        if (nativeFileSystemSupported) {\r\n          try {\r\n            // This will only work as of Chrome 86,\r\n            // but can be safely ignored on older releases.\r\n            const item = event.dataTransfer.items[0];\r\n            file.handle = await item.getAsFileSystemHandle();\r\n          } catch (error) {\r\n            console.warn(error.name, error.message);\r\n          }\r\n        }\r\n        await this.loadFileToCanvas(file);\r\n      }\r\n    };\r\n    this.loadFileToCanvas = (file) => {\r\n      loadFromBlob(file, this.state, this.scene.getElementsIncludingDeleted())\r\n        .then((scene) => {\r\n          this.syncActionResult({\r\n            ...scene,\r\n            appState: {\r\n              ...(scene.appState || this.state),\r\n              isLoading: false,\r\n            },\r\n            replaceFiles: true,\r\n            commitToHistory: true,\r\n          });\r\n        })\r\n        .catch((error) => {\r\n          this.setState({ isLoading: false, errorMessage: error.message });\r\n        });\r\n    };\r\n    this.handleCanvasContextMenu = (event) => {\r\n      event.preventDefault();\r\n      const { x, y } = viewportCoordsToSceneCoords(event, this.state);\r\n      const element = this.getElementAtPosition(x, y, { preferSelected: true });\r\n      const type = element ? \"element\" : \"canvas\";\r\n      const container = this.excalidrawContainerRef.current;\r\n      const { top: offsetTop, left: offsetLeft } =\r\n        container.getBoundingClientRect();\r\n      const left = event.clientX - offsetLeft;\r\n      const top = event.clientY - offsetTop;\r\n      if (element && !this.state.selectedElementIds[element.id]) {\r\n        this.setState({ selectedElementIds: { [element.id]: true } }, () => {\r\n          this._openContextMenu({ top, left }, type);\r\n        });\r\n      } else {\r\n        this._openContextMenu({ top, left }, type);\r\n      }\r\n    };\r\n    this.maybeDragNewGenericElement = (pointerDownState, event) => {\r\n      const draggingElement = this.state.draggingElement;\r\n      const pointerCoords = pointerDownState.lastCoords;\r\n      if (!draggingElement) {\r\n        return;\r\n      }\r\n      if (draggingElement.type === \"selection\") {\r\n        dragNewElement(\r\n          draggingElement,\r\n          this.state.elementType,\r\n          pointerDownState.origin.x,\r\n          pointerDownState.origin.y,\r\n          pointerCoords.x,\r\n          pointerCoords.y,\r\n          distance(pointerDownState.origin.x, pointerCoords.x),\r\n          distance(pointerDownState.origin.y, pointerCoords.y),\r\n          shouldMaintainAspectRatio(event),\r\n          shouldResizeFromCenter(event)\r\n        );\r\n      } else {\r\n        const [gridX, gridY] = getGridPoint(\r\n          pointerCoords.x,\r\n          pointerCoords.y,\r\n          this.state.gridSize\r\n        );\r\n        const image =\r\n          isInitializedImageElement(draggingElement) &&\r\n          this.imageCache.get(draggingElement.fileId)?.image;\r\n        const aspectRatio =\r\n          image && !(image instanceof Promise)\r\n            ? image.width / image.height\r\n            : null;\r\n        dragNewElement(\r\n          draggingElement,\r\n          this.state.elementType,\r\n          pointerDownState.originInGrid.x,\r\n          pointerDownState.originInGrid.y,\r\n          gridX,\r\n          gridY,\r\n          distance(pointerDownState.originInGrid.x, gridX),\r\n          distance(pointerDownState.originInGrid.y, gridY),\r\n          isImageElement(draggingElement)\r\n            ? !shouldMaintainAspectRatio(event)\r\n            : shouldMaintainAspectRatio(event),\r\n          shouldResizeFromCenter(event),\r\n          aspectRatio\r\n        );\r\n        this.maybeSuggestBindingForAll([draggingElement]);\r\n      }\r\n    };\r\n    this.maybeHandleResize = (pointerDownState, event) => {\r\n      const selectedElements = getSelectedElements(\r\n        this.scene.getElements(),\r\n        this.state\r\n      );\r\n      const transformHandleType = pointerDownState.resize.handleType;\r\n      this.setState({\r\n        // TODO: rename this state field to \"isScaling\" to distinguish\r\n        // it from the generic \"isResizing\" which includes scaling and\r\n        // rotating\r\n        isResizing: transformHandleType && transformHandleType !== \"rotation\",\r\n        isRotating: transformHandleType === \"rotation\",\r\n      });\r\n      const pointerCoords = pointerDownState.lastCoords;\r\n      const [resizeX, resizeY] = getGridPoint(\r\n        pointerCoords.x - pointerDownState.resize.offset.x,\r\n        pointerCoords.y - pointerDownState.resize.offset.y,\r\n        this.state.gridSize\r\n      );\r\n      if (\r\n        transformElements(\r\n          pointerDownState,\r\n          transformHandleType,\r\n          selectedElements,\r\n          pointerDownState.resize.arrowDirection,\r\n          shouldRotateWithDiscreteAngle(event),\r\n          shouldResizeFromCenter(event),\r\n          selectedElements.length === 1 && isImageElement(selectedElements[0])\r\n            ? !shouldMaintainAspectRatio(event)\r\n            : shouldMaintainAspectRatio(event),\r\n          resizeX,\r\n          resizeY,\r\n          pointerDownState.resize.center.x,\r\n          pointerDownState.resize.center.y\r\n        )\r\n      ) {\r\n        this.maybeSuggestBindingForAll(selectedElements);\r\n        return true;\r\n      }\r\n      return false;\r\n    };\r\n    /** @private use this.handleCanvasContextMenu */\r\n    this._openContextMenu = ({ left, top }, type) => {\r\n      const maybeGroupAction = actionGroup.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const maybeUngroupAction = actionUngroup.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const maybeFlipHorizontal = actionFlipHorizontal.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const maybeFlipVertical = actionFlipVertical.contextItemPredicate(\r\n        this.actionManager.getElementsIncludingDeleted(),\r\n        this.actionManager.getAppState()\r\n      );\r\n      const separator = \"separator\";\r\n      const elements = this.scene.getElements();\r\n      const options = [];\r\n      if (probablySupportsClipboardBlob && elements.length > 0) {\r\n        options.push(actionCopyAsPng);\r\n      }\r\n      if (probablySupportsClipboardWriteText && elements.length > 0) {\r\n        options.push(actionCopyAsSvg);\r\n      }\r\n      if (type === \"canvas\") {\r\n        const viewModeOptions = [\r\n          ...options,\r\n          typeof this.props.gridModeEnabled === \"undefined\" &&\r\n            actionToggleGridMode,\r\n          typeof this.props.zenModeEnabled === \"undefined\" &&\r\n            actionToggleZenMode,\r\n          typeof this.props.viewModeEnabled === \"undefined\" &&\r\n            actionToggleViewMode,\r\n          actionToggleStats,\r\n        ];\r\n        if (this.state.viewModeEnabled) {\r\n          ContextMenu.push({\r\n            options: viewModeOptions,\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        } else {\r\n          ContextMenu.push({\r\n            options: [\r\n              this.isMobile &&\r\n                navigator.clipboard && {\r\n                  name: \"paste\",\r\n                  perform: (elements, appStates) => {\r\n                    this.pasteFromClipboard(null);\r\n                    return {\r\n                      commitToHistory: false,\r\n                    };\r\n                  },\r\n                  contextItemLabel: \"labels.paste\",\r\n                },\r\n              this.isMobile && navigator.clipboard && separator,\r\n              probablySupportsClipboardBlob &&\r\n                elements.length > 0 &&\r\n                actionCopyAsPng,\r\n              probablySupportsClipboardWriteText &&\r\n                elements.length > 0 &&\r\n                actionCopyAsSvg,\r\n              ((probablySupportsClipboardBlob && elements.length > 0) ||\r\n                (probablySupportsClipboardWriteText && elements.length > 0)) &&\r\n                separator,\r\n              actionSelectAll,\r\n              separator,\r\n              typeof this.props.gridModeEnabled === \"undefined\" &&\r\n                actionToggleGridMode,\r\n              typeof this.props.zenModeEnabled === \"undefined\" &&\r\n                actionToggleZenMode,\r\n              typeof this.props.viewModeEnabled === \"undefined\" &&\r\n                actionToggleViewMode,\r\n              actionToggleStats,\r\n            ],\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        }\r\n      } else if (type === \"element\") {\r\n        if (this.state.viewModeEnabled) {\r\n          ContextMenu.push({\r\n            options: [navigator.clipboard && actionCopy, ...options],\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        } else {\r\n          ContextMenu.push({\r\n            options: [\r\n              this.isMobile && actionCut,\r\n              this.isMobile && navigator.clipboard && actionCopy,\r\n              this.isMobile &&\r\n                navigator.clipboard && {\r\n                  name: \"paste\",\r\n                  perform: (elements, appStates) => {\r\n                    this.pasteFromClipboard(null);\r\n                    return {\r\n                      commitToHistory: false,\r\n                    };\r\n                  },\r\n                  contextItemLabel: \"labels.paste\",\r\n                },\r\n              this.isMobile && separator,\r\n              ...options,\r\n              separator,\r\n              actionCopyStyles,\r\n              actionPasteStyles,\r\n              separator,\r\n              maybeGroupAction && actionGroup,\r\n              maybeUngroupAction && actionUngroup,\r\n              (maybeGroupAction || maybeUngroupAction) && separator,\r\n              actionAddToLibrary,\r\n              separator,\r\n              actionSendBackward,\r\n              actionBringForward,\r\n              actionSendToBack,\r\n              actionBringToFront,\r\n              separator,\r\n              maybeFlipHorizontal && actionFlipHorizontal,\r\n              maybeFlipVertical && actionFlipVertical,\r\n              (maybeFlipHorizontal || maybeFlipVertical) && separator,\r\n              actionDuplicateSelection,\r\n              actionDeleteSelected,\r\n            ],\r\n            top,\r\n            left,\r\n            actionManager: this.actionManager,\r\n            appState: this.state,\r\n            container: this.excalidrawContainerRef.current,\r\n          });\r\n        }\r\n      }\r\n    };\r\n    this.handleWheel = withBatchedUpdates((event) => {\r\n      event.preventDefault();\r\n      if (isPanning) {\r\n        return;\r\n      }\r\n      const { deltaX, deltaY } = event;\r\n      const { selectedElementIds, previousSelectedElementIds } = this.state;\r\n      // note that event.ctrlKey is necessary to handle pinch zooming\r\n      if (event.metaKey || event.ctrlKey) {\r\n        const sign = Math.sign(deltaY);\r\n        const MAX_STEP = 10;\r\n        let delta = Math.abs(deltaY);\r\n        if (delta > MAX_STEP) {\r\n          delta = MAX_STEP;\r\n        }\r\n        delta *= sign;\r\n        if (Object.keys(previousSelectedElementIds).length !== 0) {\r\n          setTimeout(() => {\r\n            this.setState({\r\n              selectedElementIds: previousSelectedElementIds,\r\n              previousSelectedElementIds: {},\r\n            });\r\n          }, 1000);\r\n        }\r\n        let newZoom = this.state.zoom.value - delta / 100;\r\n        // increase zoom steps the more zoomed-in we are (applies to >100% only)\r\n        newZoom += Math.log10(Math.max(1, this.state.zoom.value)) * -sign;\r\n        // round to nearest step\r\n        newZoom = Math.round(newZoom * ZOOM_STEP * 100) / (ZOOM_STEP * 100);\r\n        this.setState(({ zoom, offsetLeft, offsetTop }) => ({\r\n          zoom: getNewZoom(\r\n            getNormalizedZoom(newZoom),\r\n            zoom,\r\n            { left: offsetLeft, top: offsetTop },\r\n            {\r\n              x: cursorX,\r\n              y: cursorY,\r\n            }\r\n          ),\r\n          selectedElementIds: {},\r\n          previousSelectedElementIds:\r\n            Object.keys(selectedElementIds).length !== 0\r\n              ? selectedElementIds\r\n              : previousSelectedElementIds,\r\n          shouldCacheIgnoreZoom: true,\r\n        }));\r\n        this.resetShouldCacheIgnoreZoomDebounced();\r\n        return;\r\n      }\r\n      // scroll horizontally when shift pressed\r\n      if (event.shiftKey) {\r\n        this.setState(({ zoom, scrollX }) => ({\r\n          // on Mac, shift+wheel tends to result in deltaX\r\n          scrollX: scrollX - (deltaY || deltaX) / zoom.value,\r\n        }));\r\n        return;\r\n      }\r\n      this.setState(({ zoom, scrollX, scrollY }) => ({\r\n        scrollX: scrollX - deltaX / zoom.value,\r\n        scrollY: scrollY - deltaY / zoom.value,\r\n      }));\r\n    });\r\n    this.savePointer = (x, y, button) => {\r\n      if (!x || !y) {\r\n        return;\r\n      }\r\n      const pointer = viewportCoordsToSceneCoords(\r\n        { clientX: x, clientY: y },\r\n        this.state\r\n      );\r\n      if (isNaN(pointer.x) || isNaN(pointer.y)) {\r\n        // sometimes the pointer goes off screen\r\n      }\r\n      this.props.onPointerUpdate?.({\r\n        pointer,\r\n        button,\r\n        pointersMap: gesture.pointers,\r\n      });\r\n    };\r\n    this.resetShouldCacheIgnoreZoomDebounced = debounce(() => {\r\n      if (!this.unmounted) {\r\n        this.setState({ shouldCacheIgnoreZoom: false });\r\n      }\r\n    }, 300);\r\n    this.updateDOMRect = (cb) => {\r\n      if (this.excalidrawContainerRef?.current) {\r\n        const excalidrawContainer = this.excalidrawContainerRef.current;\r\n        const {\r\n          width,\r\n          height,\r\n          left: offsetLeft,\r\n          top: offsetTop,\r\n        } = excalidrawContainer.getBoundingClientRect();\r\n        const {\r\n          width: currentWidth,\r\n          height: currentHeight,\r\n          offsetTop: currentOffsetTop,\r\n          offsetLeft: currentOffsetLeft,\r\n        } = this.state;\r\n        if (\r\n          width === currentWidth &&\r\n          height === currentHeight &&\r\n          offsetLeft === currentOffsetLeft &&\r\n          offsetTop === currentOffsetTop\r\n        ) {\r\n          if (cb) {\r\n            cb();\r\n          }\r\n          return;\r\n        }\r\n        this.setState(\r\n          {\r\n            width,\r\n            height,\r\n            offsetLeft,\r\n            offsetTop,\r\n          },\r\n          () => {\r\n            cb && cb();\r\n          }\r\n        );\r\n      }\r\n    };\r\n    this.refresh = () => {\r\n      this.setState({ ...this.getCanvasOffsets() });\r\n    };\r\n    const defaultAppState = getDefaultAppState();\r\n    const {\r\n      excalidrawRef,\r\n      viewModeEnabled = false,\r\n      zenModeEnabled = false,\r\n      gridModeEnabled = false,\r\n      theme = defaultAppState.theme,\r\n      name = defaultAppState.name,\r\n    } = props;\r\n    this.state = {\r\n      ...defaultAppState,\r\n      theme,\r\n      isLoading: true,\r\n      ...this.getCanvasOffsets(),\r\n      viewModeEnabled,\r\n      zenModeEnabled,\r\n      gridSize: gridModeEnabled ? GRID_SIZE : null,\r\n      name,\r\n      width: window.innerWidth,\r\n      height: window.innerHeight,\r\n    };\r\n    this.id = nanoid();\r\n    if (excalidrawRef) {\r\n      const readyPromise =\r\n        (\"current\" in excalidrawRef && excalidrawRef.current?.readyPromise) ||\r\n        resolvablePromise();\r\n      const api = {\r\n        ready: true,\r\n        readyPromise,\r\n        updateScene: this.updateScene,\r\n        addFiles: this.addFiles,\r\n        resetScene: this.resetScene,\r\n        getSceneElementsIncludingDeleted: this.getSceneElementsIncludingDeleted,\r\n        history: {\r\n          clear: this.resetHistory,\r\n        },\r\n        scrollToContent: this.scrollToContent,\r\n        getSceneElements: this.getSceneElements,\r\n        getAppState: () => this.state,\r\n        getFiles: () => this.files,\r\n        refresh: this.refresh,\r\n        importLibrary: this.importLibraryFromUrl,\r\n        setToastMessage: this.setToastMessage,\r\n        id: this.id,\r\n      };\r\n      if (typeof excalidrawRef === \"function\") {\r\n        excalidrawRef(api);\r\n      } else {\r\n        excalidrawRef.current = api;\r\n      }\r\n      readyPromise.resolve(api);\r\n    }\r\n    this.excalidrawContainerValue = {\r\n      container: this.excalidrawContainerRef.current,\r\n      id: this.id,\r\n    };\r\n    this.scene = new Scene();\r\n    this.library = new Library(this);\r\n    this.history = new History();\r\n    this.actionManager = new ActionManager(\r\n      this.syncActionResult,\r\n      () => this.state,\r\n      () => this.scene.getElementsIncludingDeleted(),\r\n      this\r\n    );\r\n    this.actionManager.registerAll(actions);\r\n    this.actionManager.registerAction(createUndoAction(this.history));\r\n    this.actionManager.registerAction(createRedoAction(this.history));\r\n  }\r\n  renderCanvas() {\r\n    const canvasScale = window.devicePixelRatio;\r\n    const {\r\n      width: canvasDOMWidth,\r\n      height: canvasDOMHeight,\r\n      viewModeEnabled,\r\n    } = this.state;\r\n    const canvasWidth = canvasDOMWidth * canvasScale;\r\n    const canvasHeight = canvasDOMHeight * canvasScale;\r\n    if (viewModeEnabled) {\r\n      return (\r\n        <canvas\r\n          className=\"excalidraw__canvas\"\r\n          style={{\r\n            width: canvasDOMWidth,\r\n            height: canvasDOMHeight,\r\n            cursor: CURSOR_TYPE.GRAB,\r\n          }}\r\n          width={canvasWidth}\r\n          height={canvasHeight}\r\n          ref={this.handleCanvasRef}\r\n          onContextMenu={this.handleCanvasContextMenu}\r\n          onPointerMove={this.handleCanvasPointerMove}\r\n          onPointerUp={this.removePointer}\r\n          onPointerCancel={this.removePointer}\r\n          onTouchMove={this.handleTouchMove}\r\n          onPointerDown={this.handleCanvasPointerDown}\r\n        >\r\n          {t(\"labels.drawingCanvas\")}\r\n        </canvas>\r\n      );\r\n    }\r\n    return (\r\n      <canvas\r\n        className=\"excalidraw__canvas\"\r\n        style={{\r\n          width: canvasDOMWidth,\r\n          height: canvasDOMHeight,\r\n        }}\r\n        width={canvasWidth}\r\n        height={canvasHeight}\r\n        ref={this.handleCanvasRef}\r\n        onContextMenu={this.handleCanvasContextMenu}\r\n        onPointerDown={this.handleCanvasPointerDown}\r\n        onDoubleClick={this.handleCanvasDoubleClick}\r\n        onPointerMove={this.handleCanvasPointerMove}\r\n        onPointerUp={this.removePointer}\r\n        onPointerCancel={this.removePointer}\r\n        onTouchMove={this.handleTouchMove}\r\n      >\r\n        {t(\"labels.drawingCanvas\")}\r\n      </canvas>\r\n    );\r\n  }\r\n  render() {\r\n    const { zenModeEnabled, viewModeEnabled } = this.state;\r\n    const {\r\n      onCollabButtonClick,\r\n      renderTopRightUI,\r\n      renderFooter,\r\n      renderCustomStats,\r\n    } = this.props;\r\n    return (\r\n      <div\r\n        className={clsx(\"excalidraw excalidraw-container\", {\r\n          \"excalidraw--view-mode\": viewModeEnabled,\r\n          \"excalidraw--mobile\": this.isMobile,\r\n        })}\r\n        ref={this.excalidrawContainerRef}\r\n        onDrop={this.handleAppOnDrop}\r\n        tabIndex={0}\r\n        onKeyDown={\r\n          this.props.handleKeyboardGlobally ? undefined : this.onKeyDown\r\n        }\r\n      >\r\n        <ExcalidrawContainerContext.Provider\r\n          value={this.excalidrawContainerValue}\r\n        >\r\n          <IsMobileContext.Provider value={this.isMobile}>\r\n            <LayerUI\r\n              canvas={this.canvas}\r\n              appState={this.state}\r\n              files={this.files}\r\n              setAppState={this.setAppState}\r\n              actionManager={this.actionManager}\r\n              elements={this.scene.getElements()}\r\n              onCollabButtonClick={onCollabButtonClick}\r\n              onLockToggle={this.toggleLock}\r\n              onInsertElements={(elements) =>\r\n                this.addElementsFromPasteOrLibrary({\r\n                  elements,\r\n                  position: \"center\",\r\n                  files: null,\r\n                })\r\n              }\r\n              zenModeEnabled={zenModeEnabled}\r\n              toggleZenMode={this.toggleZenMode}\r\n              langCode={getLanguage().code}\r\n              isCollaborating={this.props.isCollaborating || false}\r\n              renderTopRightUI={renderTopRightUI}\r\n              renderCustomFooter={renderFooter}\r\n              viewModeEnabled={viewModeEnabled}\r\n              showExitZenModeBtn={\r\n                typeof this.props?.zenModeEnabled === \"undefined\" &&\r\n                zenModeEnabled\r\n              }\r\n              showThemeBtn={\r\n                typeof this.props?.theme === \"undefined\" &&\r\n                this.props.UIOptions.canvasActions.theme\r\n              }\r\n              libraryReturnUrl={this.props.libraryReturnUrl}\r\n              UIOptions={this.props.UIOptions}\r\n              focusContainer={this.focusContainer}\r\n              library={this.library}\r\n              id={this.id}\r\n              onImageAction={this.onImageAction}\r\n            />\r\n            <div className=\"excalidraw-textEditorContainer\" />\r\n            <div className=\"excalidraw-contextMenuContainer\" />\r\n            {this.state.showStats && (\r\n              <Stats\r\n                appState={this.state}\r\n                setAppState={this.setAppState}\r\n                elements={this.scene.getElements()}\r\n                onClose={this.toggleStats}\r\n                renderCustomStats={renderCustomStats}\r\n              />\r\n            )}\r\n            {this.state.toastMessage !== null && (\r\n              <Toast\r\n                message={this.state.toastMessage}\r\n                clearToast={this.clearToast}\r\n              />\r\n            )}\r\n            <main>{this.renderCanvas()}</main>\r\n          </IsMobileContext.Provider>\r\n        </ExcalidrawContainerContext.Provider>\r\n      </div>\r\n    );\r\n  }\r\n  async componentDidMount() {\r\n    this.excalidrawContainerValue.container =\r\n      this.excalidrawContainerRef.current;\r\n    if (\r\n      process.env.NODE_ENV === ENV.TEST ||\r\n      process.env.NODE_ENV === ENV.DEVELOPMENT\r\n    ) {\r\n      const setState = this.setState.bind(this);\r\n      Object.defineProperties(window.h, {\r\n        state: {\r\n          configurable: true,\r\n          get: () => {\r\n            return this.state;\r\n          },\r\n        },\r\n        setState: {\r\n          configurable: true,\r\n          value: (...args) => {\r\n            return this.setState(...args);\r\n          },\r\n        },\r\n        app: {\r\n          configurable: true,\r\n          value: this,\r\n        },\r\n        history: {\r\n          configurable: true,\r\n          value: this.history,\r\n        },\r\n      });\r\n    }\r\n    this.scene.addCallback(this.onSceneUpdated);\r\n    this.addEventListeners();\r\n    if (this.excalidrawContainerRef.current) {\r\n      this.focusContainer();\r\n    }\r\n    if (\"ResizeObserver\" in window && this.excalidrawContainerRef?.current) {\r\n      this.resizeObserver = new ResizeObserver(() => {\r\n        // compute isMobile state\r\n        // ---------------------------------------------------------------------\r\n        const { width, height } =\r\n          this.excalidrawContainerRef.current.getBoundingClientRect();\r\n        this.isMobile =\r\n          width < MQ_MAX_WIDTH_PORTRAIT ||\r\n          (height < MQ_MAX_HEIGHT_LANDSCAPE && width < MQ_MAX_WIDTH_LANDSCAPE);\r\n        // refresh offsets\r\n        // ---------------------------------------------------------------------\r\n        this.updateDOMRect();\r\n      });\r\n      this.resizeObserver?.observe(this.excalidrawContainerRef.current);\r\n    } else if (window.matchMedia) {\r\n      const mediaQuery = window.matchMedia(\r\n        `(max-width: ${MQ_MAX_WIDTH_PORTRAIT}px), (max-height: ${MQ_MAX_HEIGHT_LANDSCAPE}px) and (max-width: ${MQ_MAX_WIDTH_LANDSCAPE}px)`\r\n      );\r\n      const handler = () => (this.isMobile = mediaQuery.matches);\r\n      mediaQuery.addListener(handler);\r\n      this.detachIsMobileMqHandler = () => mediaQuery.removeListener(handler);\r\n    }\r\n    const searchParams = new URLSearchParams(window.location.search.slice(1));\r\n    if (searchParams.has(\"web-share-target\")) {\r\n      // Obtain a file that was shared via the Web Share Target API.\r\n      this.restoreFileFromShare();\r\n    } else {\r\n      this.updateDOMRect(this.initializeScene);\r\n    }\r\n  }\r\n  componentWillUnmount() {\r\n    this.files = {};\r\n    this.imageCache.clear();\r\n    this.resizeObserver?.disconnect();\r\n    this.unmounted = true;\r\n    this.removeEventListeners();\r\n    this.scene.destroy();\r\n    clearTimeout(touchTimeout);\r\n    touchTimeout = 0;\r\n  }\r\n  removeEventListeners() {\r\n    document.removeEventListener(EVENT.POINTER_UP, this.removePointer);\r\n    document.removeEventListener(EVENT.COPY, this.onCopy);\r\n    document.removeEventListener(EVENT.PASTE, this.pasteFromClipboard);\r\n    document.removeEventListener(EVENT.CUT, this.onCut);\r\n    this.nearestScrollableContainer?.removeEventListener(\r\n      EVENT.SCROLL,\r\n      this.onScroll\r\n    );\r\n    document.removeEventListener(EVENT.KEYDOWN, this.onKeyDown, false);\r\n    document.removeEventListener(\r\n      EVENT.MOUSE_MOVE,\r\n      this.updateCurrentCursorPosition,\r\n      false\r\n    );\r\n    document.removeEventListener(EVENT.KEYUP, this.onKeyUp);\r\n    window.removeEventListener(EVENT.RESIZE, this.onResize, false);\r\n    window.removeEventListener(EVENT.UNLOAD, this.onUnload, false);\r\n    window.removeEventListener(EVENT.BLUR, this.onBlur, false);\r\n    window.removeEventListener(EVENT.DRAG_OVER, this.disableEvent, false);\r\n    window.removeEventListener(EVENT.DROP, this.disableEvent, false);\r\n    document.removeEventListener(\r\n      EVENT.GESTURE_START,\r\n      this.onGestureStart,\r\n      false\r\n    );\r\n    document.removeEventListener(\r\n      EVENT.GESTURE_CHANGE,\r\n      this.onGestureChange,\r\n      false\r\n    );\r\n    document.removeEventListener(EVENT.GESTURE_END, this.onGestureEnd, false);\r\n    this.detachIsMobileMqHandler?.();\r\n  }\r\n  addEventListeners() {\r\n    this.removeEventListeners();\r\n    document.addEventListener(EVENT.POINTER_UP, this.removePointer); // #3553\r\n    document.addEventListener(EVENT.COPY, this.onCopy);\r\n    if (this.props.handleKeyboardGlobally) {\r\n      document.addEventListener(EVENT.KEYDOWN, this.onKeyDown, false);\r\n    }\r\n    document.addEventListener(EVENT.KEYUP, this.onKeyUp, { passive: true });\r\n    document.addEventListener(\r\n      EVENT.MOUSE_MOVE,\r\n      this.updateCurrentCursorPosition\r\n    );\r\n    // rerender text elements on font load to fix #637 && #1553\r\n    document.fonts?.addEventListener?.(\"loadingdone\", this.onFontLoaded);\r\n    // Safari-only desktop pinch zoom\r\n    document.addEventListener(EVENT.GESTURE_START, this.onGestureStart, false);\r\n    document.addEventListener(\r\n      EVENT.GESTURE_CHANGE,\r\n      this.onGestureChange,\r\n      false\r\n    );\r\n    document.addEventListener(EVENT.GESTURE_END, this.onGestureEnd, false);\r\n    if (this.state.viewModeEnabled) {\r\n      return;\r\n    }\r\n    document.addEventListener(EVENT.PASTE, this.pasteFromClipboard);\r\n    document.addEventListener(EVENT.CUT, this.onCut);\r\n    if (this.props.detectScroll) {\r\n      this.nearestScrollableContainer = getNearestScrollableContainer(\r\n        this.excalidrawContainerRef.current\r\n      );\r\n      this.nearestScrollableContainer.addEventListener(\r\n        EVENT.SCROLL,\r\n        this.onScroll\r\n      );\r\n    }\r\n    window.addEventListener(EVENT.RESIZE, this.onResize, false);\r\n    window.addEventListener(EVENT.UNLOAD, this.onUnload, false);\r\n    window.addEventListener(EVENT.BLUR, this.onBlur, false);\r\n    window.addEventListener(EVENT.DRAG_OVER, this.disableEvent, false);\r\n    window.addEventListener(EVENT.DROP, this.disableEvent, false);\r\n  }\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (prevProps.langCode !== this.props.langCode) {\r\n      this.updateLanguage();\r\n    }\r\n    if (prevProps.viewModeEnabled !== this.props.viewModeEnabled) {\r\n      this.setState({ viewModeEnabled: !!this.props.viewModeEnabled });\r\n    }\r\n    if (prevState.viewModeEnabled !== this.state.viewModeEnabled) {\r\n      this.addEventListeners();\r\n      this.deselectElements();\r\n    }\r\n    if (prevProps.zenModeEnabled !== this.props.zenModeEnabled) {\r\n      this.setState({ zenModeEnabled: !!this.props.zenModeEnabled });\r\n    }\r\n    if (prevProps.theme !== this.props.theme && this.props.theme) {\r\n      this.setState({ theme: this.props.theme });\r\n    }\r\n    if (prevProps.gridModeEnabled !== this.props.gridModeEnabled) {\r\n      this.setState({\r\n        gridSize: this.props.gridModeEnabled ? GRID_SIZE : null,\r\n      });\r\n    }\r\n    if (this.props.name && prevProps.name !== this.props.name) {\r\n      this.setState({\r\n        name: this.props.name,\r\n      });\r\n    }\r\n    this.excalidrawContainerRef.current?.classList.toggle(\r\n      \"theme--dark\",\r\n      this.state.theme === \"dark\"\r\n    );\r\n    if (\r\n      this.state.editingLinearElement &&\r\n      !this.state.selectedElementIds[this.state.editingLinearElement.elementId]\r\n    ) {\r\n      // defer so that the commitToHistory flag isn't reset via current update\r\n      setTimeout(() => {\r\n        this.actionManager.executeAction(actionFinalize);\r\n      });\r\n    }\r\n    const { multiElement } = prevState;\r\n    if (\r\n      prevState.elementType !== this.state.elementType &&\r\n      multiElement != null &&\r\n      isBindingEnabled(this.state) &&\r\n      isBindingElement(multiElement)\r\n    ) {\r\n      maybeBindLinearElement(\r\n        multiElement,\r\n        this.state,\r\n        this.scene,\r\n        tupleToCoors(\r\n          LinearElementEditor.getPointAtIndexGlobalCoordinates(multiElement, -1)\r\n        )\r\n      );\r\n    }\r\n    const cursorButton = {};\r\n    const pointerViewportCoords = {};\r\n    const remoteSelectedElementIds = {};\r\n    const pointerUsernames = {};\r\n    const pointerUserStates = {};\r\n    this.state.collaborators.forEach((user, socketId) => {\r\n      if (user.selectedElementIds) {\r\n        for (const id of Object.keys(user.selectedElementIds)) {\r\n          if (!(id in remoteSelectedElementIds)) {\r\n            remoteSelectedElementIds[id] = [];\r\n          }\r\n          remoteSelectedElementIds[id].push(socketId);\r\n        }\r\n      }\r\n      if (!user.pointer) {\r\n        return;\r\n      }\r\n      if (user.username) {\r\n        pointerUsernames[socketId] = user.username;\r\n      }\r\n      if (user.userState) {\r\n        pointerUserStates[socketId] = user.userState;\r\n      }\r\n      pointerViewportCoords[socketId] = sceneCoordsToViewportCoords(\r\n        {\r\n          sceneX: user.pointer.x,\r\n          sceneY: user.pointer.y,\r\n        },\r\n        this.state\r\n      );\r\n      cursorButton[socketId] = user.button;\r\n    });\r\n    const renderingElements = this.scene.getElements().filter((element) => {\r\n      if (isImageElement(element)) {\r\n        if (\r\n          // not placed on canvas yet (but in elements array)\r\n          this.state.pendingImageElement &&\r\n          element.id === this.state.pendingImageElement.id\r\n        ) {\r\n          return false;\r\n        }\r\n      }\r\n      // don't render text element that's being currently edited (it's\r\n      // rendered on remote only)\r\n      return (\r\n        !this.state.editingElement ||\r\n        this.state.editingElement.type !== \"text\" ||\r\n        element.id !== this.state.editingElement.id\r\n      );\r\n    });\r\n    const { atLeastOneVisibleElement, scrollBars } = renderScene(\r\n      renderingElements,\r\n      this.state,\r\n      this.state.selectionElement,\r\n      window.devicePixelRatio,\r\n      this.rc,\r\n      this.canvas,\r\n      {\r\n        scrollX: this.state.scrollX,\r\n        scrollY: this.state.scrollY,\r\n        viewBackgroundColor: this.state.viewBackgroundColor,\r\n        zoom: this.state.zoom,\r\n        remotePointerViewportCoords: pointerViewportCoords,\r\n        remotePointerButton: cursorButton,\r\n        remoteSelectedElementIds,\r\n        remotePointerUsernames: pointerUsernames,\r\n        remotePointerUserStates: pointerUserStates,\r\n        shouldCacheIgnoreZoom: this.state.shouldCacheIgnoreZoom,\r\n        theme: this.state.theme,\r\n        imageCache: this.imageCache,\r\n      },\r\n      {\r\n        renderOptimizations: true,\r\n        renderScrollbars: !this.isMobile,\r\n      }\r\n    );\r\n    if (scrollBars) {\r\n      currentScrollBars = scrollBars;\r\n    }\r\n    const scrolledOutside =\r\n      // hide when editing text\r\n      this.state.editingElement?.type === \"text\"\r\n        ? false\r\n        : !atLeastOneVisibleElement && renderingElements.length > 0;\r\n    if (this.state.scrolledOutside !== scrolledOutside) {\r\n      this.setState({ scrolledOutside });\r\n    }\r\n    this.history.record(this.state, this.scene.getElementsIncludingDeleted());\r\n    this.scheduleImageRefresh();\r\n    // Do not notify consumers if we're still loading the scene. Among other\r\n    // potential issues, this fixes a case where the tab isn't focused during\r\n    // init, which would trigger onChange with empty elements, which would then\r\n    // override whatever is in localStorage currently.\r\n    if (!this.state.isLoading) {\r\n      this.props.onChange?.(\r\n        this.scene.getElementsIncludingDeleted(),\r\n        this.state,\r\n        this.files\r\n      );\r\n    }\r\n  }\r\n  static resetTapTwice() {\r\n    didTapTwice = false;\r\n  }\r\n  addTextFromPaste(text) {\r\n    const { x, y } = viewportCoordsToSceneCoords(\r\n      { clientX: cursorX, clientY: cursorY },\r\n      this.state\r\n    );\r\n    const element = newTextElement({\r\n      x,\r\n      y,\r\n      strokeColor: this.state.currentItemStrokeColor,\r\n      backgroundColor: this.state.currentItemBackgroundColor,\r\n      fillStyle: this.state.currentItemFillStyle,\r\n      strokeWidth: this.state.currentItemStrokeWidth,\r\n      strokeStyle: this.state.currentItemStrokeStyle,\r\n      roughness: this.state.currentItemRoughness,\r\n      opacity: this.state.currentItemOpacity,\r\n      strokeSharpness: this.state.currentItemStrokeSharpness,\r\n      text,\r\n      fontSize: this.state.currentItemFontSize,\r\n      fontFamily: this.state.currentItemFontFamily,\r\n      textAlign: this.state.currentItemTextAlign,\r\n      verticalAlign: DEFAULT_VERTICAL_ALIGN,\r\n    });\r\n    this.scene.replaceAllElements([\r\n      ...this.scene.getElementsIncludingDeleted(),\r\n      element,\r\n    ]);\r\n    this.setState({ selectedElementIds: { [element.id]: true } });\r\n    this.history.resumeRecording();\r\n  }\r\n  selectShapeTool(elementType) {\r\n    if (!isHoldingSpace) {\r\n      setCursorForShape(this.canvas, elementType);\r\n    }\r\n    if (isToolIcon(document.activeElement)) {\r\n      this.focusContainer();\r\n    }\r\n    if (!isLinearElementType(elementType)) {\r\n      this.setState({ suggestedBindings: [] });\r\n    }\r\n    if (elementType === \"image\") {\r\n      this.onImageAction();\r\n    }\r\n    if (elementType !== \"selection\") {\r\n      this.setState({\r\n        elementType,\r\n        selectedElementIds: {},\r\n        selectedGroupIds: {},\r\n        editingGroupId: null,\r\n      });\r\n    } else {\r\n      this.setState({ elementType });\r\n    }\r\n  }\r\n  handleTextWysiwyg(element, { isExistingElement = false }) {\r\n    const updateElement = (text, isDeleted = false) => {\r\n      this.scene.replaceAllElements([\r\n        ...this.scene.getElementsIncludingDeleted().map((_element) => {\r\n          if (_element.id === element.id && isTextElement(_element)) {\r\n            return updateTextElement(_element, {\r\n              text,\r\n              isDeleted,\r\n            });\r\n          }\r\n          return _element;\r\n        }),\r\n      ]);\r\n    };\r\n    textWysiwyg({\r\n      id: element.id,\r\n      appState: this.state,\r\n      canvas: this.canvas,\r\n      getViewportCoords: (x, y) => {\r\n        const { x: viewportX, y: viewportY } = sceneCoordsToViewportCoords(\r\n          {\r\n            sceneX: x,\r\n            sceneY: y,\r\n          },\r\n          this.state\r\n        );\r\n        return [\r\n          viewportX - this.state.offsetLeft,\r\n          viewportY - this.state.offsetTop,\r\n        ];\r\n      },\r\n      onChange: withBatchedUpdates((text) => {\r\n        updateElement(text);\r\n        if (isNonDeletedElement(element)) {\r\n          updateBoundElements(element);\r\n        }\r\n      }),\r\n      onSubmit: withBatchedUpdates(({ text, viaKeyboard }) => {\r\n        const isDeleted = !text.trim();\r\n        updateElement(text, isDeleted);\r\n        // select the created text element only if submitting via keyboard\r\n        // (when submitting via click it should act as signal to deselect)\r\n        if (!isDeleted && viaKeyboard) {\r\n          this.setState((prevState) => ({\r\n            selectedElementIds: {\r\n              ...prevState.selectedElementIds,\r\n              [element.id]: true,\r\n            },\r\n          }));\r\n        }\r\n        if (isDeleted) {\r\n          fixBindingsAfterDeletion(this.scene.getElements(), [element]);\r\n        }\r\n        if (!isDeleted || isExistingElement) {\r\n          this.history.resumeRecording();\r\n        }\r\n        this.setState({\r\n          draggingElement: null,\r\n          editingElement: null,\r\n        });\r\n        if (this.state.elementLocked) {\r\n          setCursorForShape(this.canvas, this.state.elementType);\r\n        }\r\n        this.focusContainer();\r\n      }),\r\n      element,\r\n      excalidrawContainer: this.excalidrawContainerRef.current,\r\n    });\r\n    // deselect all other elements when inserting text\r\n    this.deselectElements();\r\n    // do an initial update to re-initialize element position since we were\r\n    // modifying element's x/y for sake of editor (case: syncing to remote)\r\n    updateElement(element.text);\r\n  }\r\n  deselectElements() {\r\n    this.setState({\r\n      selectedElementIds: {},\r\n      selectedGroupIds: {},\r\n      editingGroupId: null,\r\n    });\r\n  }\r\n  getTextElementAtPosition(x, y) {\r\n    const element = this.getElementAtPosition(x, y);\r\n    if (element && isTextElement(element) && !element.isDeleted) {\r\n      return element;\r\n    }\r\n    return null;\r\n  }\r\n  getElementAtPosition(x, y, opts) {\r\n    const allHitElements = this.getElementsAtPosition(x, y);\r\n    if (allHitElements.length > 1) {\r\n      if (opts?.preferSelected) {\r\n        for (let index = allHitElements.length - 1; index > -1; index--) {\r\n          if (this.state.selectedElementIds[allHitElements[index].id]) {\r\n            return allHitElements[index];\r\n          }\r\n        }\r\n      }\r\n      const elementWithHighestZIndex =\r\n        allHitElements[allHitElements.length - 1];\r\n      // If we're hitting element with highest z-index only on its bounding box\r\n      // while also hitting other element figure, the latter should be considered.\r\n      return isHittingElementBoundingBoxWithoutHittingElement(\r\n        elementWithHighestZIndex,\r\n        this.state,\r\n        x,\r\n        y\r\n      )\r\n        ? allHitElements[allHitElements.length - 2]\r\n        : elementWithHighestZIndex;\r\n    }\r\n    if (allHitElements.length === 1) {\r\n      return allHitElements[0];\r\n    }\r\n    return null;\r\n  }\r\n  getElementsAtPosition(x, y) {\r\n    return getElementsAtPosition(this.scene.getElements(), (element) =>\r\n      hitTest(element, this.state, x, y)\r\n    );\r\n  }\r\n  maybeCleanupAfterMissingPointerUp(event) {\r\n    if (lastPointerUp !== null) {\r\n      // Unfortunately, sometimes we don't get a pointerup after a pointerdown,\r\n      // this can happen when a contextual menu or alert is triggered. In order to avoid\r\n      // being in a weird state, we clean up on the next pointerdown\r\n      lastPointerUp(event);\r\n    }\r\n  }\r\n  updateGestureOnPointerDown(event) {\r\n    gesture.pointers.set(event.pointerId, {\r\n      x: event.clientX,\r\n      y: event.clientY,\r\n    });\r\n    if (gesture.pointers.size === 2) {\r\n      gesture.lastCenter = getCenter(gesture.pointers);\r\n      gesture.initialScale = this.state.zoom.value;\r\n      gesture.initialDistance = getDistance(\r\n        Array.from(gesture.pointers.values())\r\n      );\r\n    }\r\n  }\r\n  initialPointerDownState(event) {\r\n    const origin = viewportCoordsToSceneCoords(event, this.state);\r\n    const selectedElements = getSelectedElements(\r\n      this.scene.getElements(),\r\n      this.state\r\n    );\r\n    const [minX, minY, maxX, maxY] = getCommonBounds(selectedElements);\r\n    return {\r\n      origin,\r\n      withCmdOrCtrl: event[KEYS.CTRL_OR_CMD],\r\n      originInGrid: tupleToCoors(\r\n        getGridPoint(origin.x, origin.y, this.state.gridSize)\r\n      ),\r\n      scrollbars: isOverScrollBars(\r\n        currentScrollBars,\r\n        event.clientX - this.state.offsetLeft,\r\n        event.clientY - this.state.offsetTop\r\n      ),\r\n      // we need to duplicate because we'll be updating this state\r\n      lastCoords: { ...origin },\r\n      originalElements: this.scene.getElements().reduce((acc, element) => {\r\n        acc.set(element.id, deepCopyElement(element));\r\n        return acc;\r\n      }, new Map()),\r\n      resize: {\r\n        handleType: false,\r\n        isResizing: false,\r\n        offset: { x: 0, y: 0 },\r\n        arrowDirection: \"origin\",\r\n        center: { x: (maxX + minX) / 2, y: (maxY + minY) / 2 },\r\n      },\r\n      hit: {\r\n        element: null,\r\n        allHitElements: [],\r\n        wasAddedToSelection: false,\r\n        hasBeenDuplicated: false,\r\n        hasHitCommonBoundingBoxOfSelectedElements:\r\n          this.isHittingCommonBoundingBoxOfSelectedElements(\r\n            origin,\r\n            selectedElements\r\n          ),\r\n      },\r\n      drag: {\r\n        hasOccurred: false,\r\n        offset: null,\r\n      },\r\n      eventListeners: {\r\n        onMove: null,\r\n        onUp: null,\r\n        onKeyUp: null,\r\n        onKeyDown: null,\r\n      },\r\n    };\r\n  }\r\n  // Returns whether the event is a dragging a scrollbar\r\n  handleDraggingScrollBar(event, pointerDownState) {\r\n    if (\r\n      !(pointerDownState.scrollbars.isOverEither && !this.state.multiElement)\r\n    ) {\r\n      return false;\r\n    }\r\n    isDraggingScrollBar = true;\r\n    pointerDownState.lastCoords.x = event.clientX;\r\n    pointerDownState.lastCoords.y = event.clientY;\r\n    const onPointerMove = withBatchedUpdates((event) => {\r\n      const target = event.target;\r\n      if (!(target instanceof HTMLElement)) {\r\n        return;\r\n      }\r\n      this.handlePointerMoveOverScrollbars(event, pointerDownState);\r\n    });\r\n    const onPointerUp = withBatchedUpdates(() => {\r\n      isDraggingScrollBar = false;\r\n      setCursorForShape(this.canvas, this.state.elementType);\r\n      lastPointerUp = null;\r\n      this.setState({\r\n        cursorButton: \"up\",\r\n      });\r\n      this.savePointer(event.clientX, event.clientY, \"up\");\r\n      window.removeEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n      window.removeEventListener(EVENT.POINTER_UP, onPointerUp);\r\n    });\r\n    lastPointerUp = onPointerUp;\r\n    window.addEventListener(EVENT.POINTER_MOVE, onPointerMove);\r\n    window.addEventListener(EVENT.POINTER_UP, onPointerUp);\r\n    return true;\r\n  }\r\n  isASelectedElement(hitElement) {\r\n    return hitElement != null && this.state.selectedElementIds[hitElement.id];\r\n  }\r\n  isHittingCommonBoundingBoxOfSelectedElements(point, selectedElements) {\r\n    if (selectedElements.length < 2) {\r\n      return false;\r\n    }\r\n    // How many pixels off the shape boundary we still consider a hit\r\n    const threshold = 10 / this.state.zoom.value;\r\n    const [x1, y1, x2, y2] = getCommonBounds(selectedElements);\r\n    return (\r\n      point.x > x1 - threshold &&\r\n      point.x < x2 + threshold &&\r\n      point.y > y1 - threshold &&\r\n      point.y < y2 + threshold\r\n    );\r\n  }\r\n  onKeyDownFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((event) => {\r\n      if (this.maybeHandleResize(pointerDownState, event)) {\r\n        return;\r\n      }\r\n      this.maybeDragNewGenericElement(pointerDownState, event);\r\n    });\r\n  }\r\n  onKeyUpFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((event) => {\r\n      // Prevents focus from escaping excalidraw tab\r\n      event.key === KEYS.ALT && event.preventDefault();\r\n      if (this.maybeHandleResize(pointerDownState, event)) {\r\n        return;\r\n      }\r\n      this.maybeDragNewGenericElement(pointerDownState, event);\r\n    });\r\n  }\r\n  onPointerMoveFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((event) => {\r\n      // We need to initialize dragOffsetXY only after we've updated\r\n      // `state.selectedElementIds` on pointerDown. Doing it here in pointerMove\r\n      // event handler should hopefully ensure we're already working with\r\n      // the updated state.\r\n      if (pointerDownState.drag.offset === null) {\r\n        pointerDownState.drag.offset = tupleToCoors(\r\n          getDragOffsetXY(\r\n            getSelectedElements(this.scene.getElements(), this.state),\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          )\r\n        );\r\n      }\r\n      const target = event.target;\r\n      if (!(target instanceof HTMLElement)) {\r\n        return;\r\n      }\r\n      if (this.handlePointerMoveOverScrollbars(event, pointerDownState)) {\r\n        return;\r\n      }\r\n      const pointerCoords = viewportCoordsToSceneCoords(event, this.state);\r\n      const [gridX, gridY] = getGridPoint(\r\n        pointerCoords.x,\r\n        pointerCoords.y,\r\n        this.state.gridSize\r\n      );\r\n      // for arrows/lines, don't start dragging until a given threshold\r\n      // to ensure we don't create a 2-point arrow by mistake when\r\n      // user clicks mouse in a way that it moves a tiny bit (thus\r\n      // triggering pointermove)\r\n      if (\r\n        !pointerDownState.drag.hasOccurred &&\r\n        (this.state.elementType === \"arrow\" ||\r\n          this.state.elementType === \"line\")\r\n      ) {\r\n        if (\r\n          distance2d(\r\n            pointerCoords.x,\r\n            pointerCoords.y,\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          ) < DRAGGING_THRESHOLD\r\n        ) {\r\n          return;\r\n        }\r\n      }\r\n      if (pointerDownState.resize.isResizing) {\r\n        pointerDownState.lastCoords.x = pointerCoords.x;\r\n        pointerDownState.lastCoords.y = pointerCoords.y;\r\n        if (this.maybeHandleResize(pointerDownState, event)) {\r\n          return true;\r\n        }\r\n      }\r\n      if (this.state.editingLinearElement) {\r\n        const didDrag = LinearElementEditor.handlePointDragging(\r\n          this.state,\r\n          (appState) => this.setState(appState),\r\n          pointerCoords.x,\r\n          pointerCoords.y,\r\n          (element, startOrEnd) => {\r\n            this.maybeSuggestBindingForLinearElementAtCursor(\r\n              element,\r\n              startOrEnd,\r\n              pointerCoords\r\n            );\r\n          }\r\n        );\r\n        if (didDrag) {\r\n          pointerDownState.lastCoords.x = pointerCoords.x;\r\n          pointerDownState.lastCoords.y = pointerCoords.y;\r\n          return;\r\n        }\r\n      }\r\n      const hasHitASelectedElement = pointerDownState.hit.allHitElements.some(\r\n        (element) => this.isASelectedElement(element)\r\n      );\r\n      if (\r\n        hasHitASelectedElement ||\r\n        pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements\r\n      ) {\r\n        // Marking that click was used for dragging to check\r\n        // if elements should be deselected on pointerup\r\n        pointerDownState.drag.hasOccurred = true;\r\n        const selectedElements = getSelectedElements(\r\n          this.scene.getElements(),\r\n          this.state\r\n        );\r\n        // prevent dragging even if we're no longer holding cmd/ctrl otherwise\r\n        // it would have weird results (stuff jumping all over the screen)\r\n        if (selectedElements.length > 0 && !pointerDownState.withCmdOrCtrl) {\r\n          const [dragX, dragY] = getGridPoint(\r\n            pointerCoords.x - pointerDownState.drag.offset.x,\r\n            pointerCoords.y - pointerDownState.drag.offset.y,\r\n            this.state.gridSize\r\n          );\r\n          const [dragDistanceX, dragDistanceY] = [\r\n            Math.abs(pointerCoords.x - pointerDownState.origin.x),\r\n            Math.abs(pointerCoords.y - pointerDownState.origin.y),\r\n          ];\r\n          // We only drag in one direction if shift is pressed\r\n          const lockDirection = event.shiftKey;\r\n          dragSelectedElements(\r\n            pointerDownState,\r\n            selectedElements,\r\n            dragX,\r\n            dragY,\r\n            this.scene,\r\n            lockDirection,\r\n            dragDistanceX,\r\n            dragDistanceY\r\n          );\r\n          this.maybeSuggestBindingForAll(selectedElements);\r\n          // We duplicate the selected element if alt is pressed on pointer move\r\n          if (event.altKey && !pointerDownState.hit.hasBeenDuplicated) {\r\n            // Move the currently selected elements to the top of the z index stack, and\r\n            // put the duplicates where the selected elements used to be.\r\n            // (the origin point where the dragging started)\r\n            pointerDownState.hit.hasBeenDuplicated = true;\r\n            const nextElements = [];\r\n            const elementsToAppend = [];\r\n            const groupIdMap = new Map();\r\n            const oldIdToDuplicatedId = new Map();\r\n            const hitElement = pointerDownState.hit.element;\r\n            for (const element of this.scene.getElementsIncludingDeleted()) {\r\n              if (\r\n                this.state.selectedElementIds[element.id] ||\r\n                // case: the state.selectedElementIds might not have been\r\n                // updated yet by the time this mousemove event is fired\r\n                (element.id === hitElement?.id &&\r\n                  pointerDownState.hit.wasAddedToSelection)\r\n              ) {\r\n                const duplicatedElement = duplicateElement(\r\n                  this.state.editingGroupId,\r\n                  groupIdMap,\r\n                  element\r\n                );\r\n                const [originDragX, originDragY] = getGridPoint(\r\n                  pointerDownState.origin.x - pointerDownState.drag.offset.x,\r\n                  pointerDownState.origin.y - pointerDownState.drag.offset.y,\r\n                  this.state.gridSize\r\n                );\r\n                mutateElement(duplicatedElement, {\r\n                  x: duplicatedElement.x + (originDragX - dragX),\r\n                  y: duplicatedElement.y + (originDragY - dragY),\r\n                });\r\n                nextElements.push(duplicatedElement);\r\n                elementsToAppend.push(element);\r\n                oldIdToDuplicatedId.set(element.id, duplicatedElement.id);\r\n              } else {\r\n                nextElements.push(element);\r\n              }\r\n            }\r\n            const nextSceneElements = [...nextElements, ...elementsToAppend];\r\n            fixBindingsAfterDuplication(\r\n              nextSceneElements,\r\n              elementsToAppend,\r\n              oldIdToDuplicatedId,\r\n              \"duplicatesServeAsOld\"\r\n            );\r\n            this.scene.replaceAllElements(nextSceneElements);\r\n          }\r\n          return;\r\n        }\r\n      }\r\n      // It is very important to read this.state within each move event,\r\n      // otherwise we would read a stale one!\r\n      const draggingElement = this.state.draggingElement;\r\n      if (!draggingElement) {\r\n        return;\r\n      }\r\n      if (draggingElement.type === \"freedraw\") {\r\n        const points = draggingElement.points;\r\n        const dx = pointerCoords.x - draggingElement.x;\r\n        const dy = pointerCoords.y - draggingElement.y;\r\n        const pressures = draggingElement.simulatePressure\r\n          ? draggingElement.pressures\r\n          : [...draggingElement.pressures, event.pressure];\r\n        mutateElement(draggingElement, {\r\n          points: [...points, [dx, dy]],\r\n          pressures,\r\n        });\r\n      } else if (isLinearElement(draggingElement)) {\r\n        pointerDownState.drag.hasOccurred = true;\r\n        const points = draggingElement.points;\r\n        let dx = gridX - draggingElement.x;\r\n        let dy = gridY - draggingElement.y;\r\n        if (shouldRotateWithDiscreteAngle(event) && points.length === 2) {\r\n          ({ width: dx, height: dy } = getPerfectElementSize(\r\n            this.state.elementType,\r\n            dx,\r\n            dy\r\n          ));\r\n        }\r\n        if (points.length === 1) {\r\n          mutateElement(draggingElement, { points: [...points, [dx, dy]] });\r\n        } else if (points.length > 1) {\r\n          mutateElement(draggingElement, {\r\n            points: [...points.slice(0, -1), [dx, dy]],\r\n          });\r\n        }\r\n        if (isBindingElement(draggingElement)) {\r\n          // When creating a linear element by dragging\r\n          this.maybeSuggestBindingForLinearElementAtCursor(\r\n            draggingElement,\r\n            \"end\",\r\n            pointerCoords,\r\n            this.state.startBoundElement\r\n          );\r\n        }\r\n      } else {\r\n        pointerDownState.lastCoords.x = pointerCoords.x;\r\n        pointerDownState.lastCoords.y = pointerCoords.y;\r\n        this.maybeDragNewGenericElement(pointerDownState, event);\r\n      }\r\n      if (this.state.elementType === \"selection\") {\r\n        const elements = this.scene.getElements();\r\n        if (!event.shiftKey && isSomeElementSelected(elements, this.state)) {\r\n          if (pointerDownState.withCmdOrCtrl && pointerDownState.hit.element) {\r\n            this.setState((prevState) =>\r\n              selectGroupsForSelectedElements(\r\n                {\r\n                  ...prevState,\r\n                  selectedElementIds: {\r\n                    [pointerDownState.hit.element.id]: true,\r\n                  },\r\n                },\r\n                this.scene.getElements()\r\n              )\r\n            );\r\n          } else {\r\n            this.setState({\r\n              selectedElementIds: {},\r\n              selectedGroupIds: {},\r\n              editingGroupId: null,\r\n            });\r\n          }\r\n        }\r\n        const elementsWithinSelection = getElementsWithinSelection(\r\n          elements,\r\n          draggingElement\r\n        );\r\n        this.setState((prevState) =>\r\n          selectGroupsForSelectedElements(\r\n            {\r\n              ...prevState,\r\n              selectedElementIds: {\r\n                ...prevState.selectedElementIds,\r\n                ...elementsWithinSelection.reduce((map, element) => {\r\n                  map[element.id] = true;\r\n                  return map;\r\n                }, {}),\r\n                ...(pointerDownState.hit.element\r\n                  ? {\r\n                      // if using ctrl/cmd, select the hitElement only if we\r\n                      // haven't box-selected anything else\r\n                      [pointerDownState.hit.element.id]:\r\n                        !elementsWithinSelection.length,\r\n                    }\r\n                  : null),\r\n              },\r\n            },\r\n            this.scene.getElements()\r\n          )\r\n        );\r\n      }\r\n    });\r\n  }\r\n  // Returns whether the pointer move happened over either scrollbar\r\n  handlePointerMoveOverScrollbars(event, pointerDownState) {\r\n    if (pointerDownState.scrollbars.isOverHorizontal) {\r\n      const x = event.clientX;\r\n      const dx = x - pointerDownState.lastCoords.x;\r\n      this.setState({\r\n        scrollX: this.state.scrollX - dx / this.state.zoom.value,\r\n      });\r\n      pointerDownState.lastCoords.x = x;\r\n      return true;\r\n    }\r\n    if (pointerDownState.scrollbars.isOverVertical) {\r\n      const y = event.clientY;\r\n      const dy = y - pointerDownState.lastCoords.y;\r\n      this.setState({\r\n        scrollY: this.state.scrollY - dy / this.state.zoom.value,\r\n      });\r\n      pointerDownState.lastCoords.y = y;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  onPointerUpFromPointerDownHandler(pointerDownState) {\r\n    return withBatchedUpdates((childEvent) => {\r\n      const {\r\n        draggingElement,\r\n        resizingElement,\r\n        multiElement,\r\n        elementType,\r\n        elementLocked,\r\n        isResizing,\r\n        isRotating,\r\n      } = this.state;\r\n      this.setState({\r\n        isResizing: false,\r\n        isRotating: false,\r\n        resizingElement: null,\r\n        selectionElement: null,\r\n        cursorButton: \"up\",\r\n        // text elements are reset on finalize, and resetting on pointerup\r\n        // may cause issues with double taps\r\n        editingElement:\r\n          multiElement || isTextElement(this.state.editingElement)\r\n            ? this.state.editingElement\r\n            : null,\r\n      });\r\n      this.savePointer(childEvent.clientX, childEvent.clientY, \"up\");\r\n      // Handle end of dragging a point of a linear element, might close a loop\r\n      // and sets binding element\r\n      if (this.state.editingLinearElement) {\r\n        const editingLinearElement = LinearElementEditor.handlePointerUp(\r\n          childEvent,\r\n          this.state.editingLinearElement,\r\n          this.state\r\n        );\r\n        if (editingLinearElement !== this.state.editingLinearElement) {\r\n          this.setState({\r\n            editingLinearElement,\r\n            suggestedBindings: [],\r\n          });\r\n        }\r\n      }\r\n      lastPointerUp = null;\r\n      window.removeEventListener(\r\n        EVENT.POINTER_MOVE,\r\n        pointerDownState.eventListeners.onMove\r\n      );\r\n      window.removeEventListener(\r\n        EVENT.POINTER_UP,\r\n        pointerDownState.eventListeners.onUp\r\n      );\r\n      window.removeEventListener(\r\n        EVENT.KEYDOWN,\r\n        pointerDownState.eventListeners.onKeyDown\r\n      );\r\n      window.removeEventListener(\r\n        EVENT.KEYUP,\r\n        pointerDownState.eventListeners.onKeyUp\r\n      );\r\n      if (this.state.pendingImageElement) {\r\n        this.setState({ pendingImageElement: null });\r\n      }\r\n      if (draggingElement?.type === \"freedraw\") {\r\n        const pointerCoords = viewportCoordsToSceneCoords(\r\n          childEvent,\r\n          this.state\r\n        );\r\n        const points = draggingElement.points;\r\n        let dx = pointerCoords.x - draggingElement.x;\r\n        let dy = pointerCoords.y - draggingElement.y;\r\n        // Allows dots to avoid being flagged as infinitely small\r\n        if (dx === points[0][0] && dy === points[0][1]) {\r\n          dy += 0.0001;\r\n          dx += 0.0001;\r\n        }\r\n        const pressures = draggingElement.simulatePressure\r\n          ? []\r\n          : [...draggingElement.pressures, childEvent.pressure];\r\n        mutateElement(draggingElement, {\r\n          points: [...points, [dx, dy]],\r\n          pressures,\r\n          lastCommittedPoint: [dx, dy],\r\n        });\r\n        this.actionManager.executeAction(actionFinalize);\r\n        return;\r\n      }\r\n      if (isImageElement(draggingElement)) {\r\n        const imageElement = draggingElement;\r\n        try {\r\n          this.initializeImageDimensions(imageElement);\r\n          this.setState(\r\n            { selectedElementIds: { [imageElement.id]: true } },\r\n            () => {\r\n              this.actionManager.executeAction(actionFinalize);\r\n            }\r\n          );\r\n        } catch (error) {\r\n          console.error(error);\r\n          this.scene.replaceAllElements(\r\n            this.scene\r\n              .getElementsIncludingDeleted()\r\n              .filter((el) => el.id !== imageElement.id)\r\n          );\r\n          this.actionManager.executeAction(actionFinalize);\r\n        }\r\n        return;\r\n      }\r\n      if (isLinearElement(draggingElement)) {\r\n        if (draggingElement.points.length > 1) {\r\n          this.history.resumeRecording();\r\n        }\r\n        const pointerCoords = viewportCoordsToSceneCoords(\r\n          childEvent,\r\n          this.state\r\n        );\r\n        if (\r\n          !pointerDownState.drag.hasOccurred &&\r\n          draggingElement &&\r\n          !multiElement\r\n        ) {\r\n          mutateElement(draggingElement, {\r\n            points: [\r\n              ...draggingElement.points,\r\n              [\r\n                pointerCoords.x - draggingElement.x,\r\n                pointerCoords.y - draggingElement.y,\r\n              ],\r\n            ],\r\n          });\r\n          this.setState({\r\n            multiElement: draggingElement,\r\n            editingElement: this.state.draggingElement,\r\n          });\r\n        } else if (pointerDownState.drag.hasOccurred && !multiElement) {\r\n          if (\r\n            isBindingEnabled(this.state) &&\r\n            isBindingElement(draggingElement)\r\n          ) {\r\n            maybeBindLinearElement(\r\n              draggingElement,\r\n              this.state,\r\n              this.scene,\r\n              pointerCoords\r\n            );\r\n          }\r\n          this.setState({ suggestedBindings: [], startBoundElement: null });\r\n          if (!elementLocked) {\r\n            resetCursor(this.canvas);\r\n            this.setState((prevState) => ({\r\n              draggingElement: null,\r\n              elementType: \"selection\",\r\n              selectedElementIds: {\r\n                ...prevState.selectedElementIds,\r\n                [this.state.draggingElement.id]: true,\r\n              },\r\n            }));\r\n          } else {\r\n            this.setState((prevState) => ({\r\n              draggingElement: null,\r\n              selectedElementIds: {\r\n                ...prevState.selectedElementIds,\r\n                [this.state.draggingElement.id]: true,\r\n              },\r\n            }));\r\n          }\r\n        }\r\n        return;\r\n      }\r\n      if (\r\n        elementType !== \"selection\" &&\r\n        draggingElement &&\r\n        isInvisiblySmallElement(draggingElement)\r\n      ) {\r\n        // remove invisible element which was added in onPointerDown\r\n        this.scene.replaceAllElements(\r\n          this.scene.getElementsIncludingDeleted().slice(0, -1)\r\n        );\r\n        this.setState({\r\n          draggingElement: null,\r\n        });\r\n        return;\r\n      }\r\n      if (draggingElement) {\r\n        mutateElement(\r\n          draggingElement,\r\n          getNormalizedDimensions(draggingElement)\r\n        );\r\n      }\r\n      if (resizingElement) {\r\n        this.history.resumeRecording();\r\n      }\r\n      if (resizingElement && isInvisiblySmallElement(resizingElement)) {\r\n        this.scene.replaceAllElements(\r\n          this.scene\r\n            .getElementsIncludingDeleted()\r\n            .filter((el) => el.id !== resizingElement.id)\r\n        );\r\n      }\r\n      // Code below handles selection when element(s) weren't\r\n      // drag or added to selection on pointer down phase.\r\n      const hitElement = pointerDownState.hit.element;\r\n      if (\r\n        hitElement &&\r\n        !pointerDownState.drag.hasOccurred &&\r\n        !pointerDownState.hit.wasAddedToSelection\r\n      ) {\r\n        if (childEvent.shiftKey) {\r\n          if (this.state.selectedElementIds[hitElement.id]) {\r\n            if (isSelectedViaGroup(this.state, hitElement)) {\r\n              // We want to unselect all groups hitElement is part of\r\n              // as well as all elements that are part of the groups\r\n              // hitElement is part of\r\n              const idsOfSelectedElementsThatAreInGroups = hitElement.groupIds\r\n                .flatMap((groupId) =>\r\n                  getElementsInGroup(this.scene.getElements(), groupId)\r\n                )\r\n                .map((element) => ({ [element.id]: false }))\r\n                .reduce((prevId, acc) => ({ ...prevId, ...acc }), {});\r\n              this.setState((_prevState) => ({\r\n                selectedGroupIds: {\r\n                  ..._prevState.selectedElementIds,\r\n                  ...hitElement.groupIds\r\n                    .map((gId) => ({ [gId]: false }))\r\n                    .reduce((prev, acc) => ({ ...prev, ...acc }), {}),\r\n                },\r\n                selectedElementIds: {\r\n                  ..._prevState.selectedElementIds,\r\n                  ...idsOfSelectedElementsThatAreInGroups,\r\n                },\r\n              }));\r\n            } else {\r\n              // remove element from selection while\r\n              // keeping prev elements selected\r\n              this.setState((prevState) =>\r\n                selectGroupsForSelectedElements(\r\n                  {\r\n                    ...prevState,\r\n                    selectedElementIds: {\r\n                      ...prevState.selectedElementIds,\r\n                      [hitElement.id]: false,\r\n                    },\r\n                  },\r\n                  this.scene.getElements()\r\n                )\r\n              );\r\n            }\r\n          } else {\r\n            // add element to selection while\r\n            // keeping prev elements selected\r\n            this.setState((_prevState) => ({\r\n              selectedElementIds: {\r\n                ..._prevState.selectedElementIds,\r\n                [hitElement.id]: true,\r\n              },\r\n            }));\r\n          }\r\n        } else {\r\n          this.setState((prevState) => ({\r\n            ...selectGroupsForSelectedElements(\r\n              {\r\n                ...prevState,\r\n                selectedElementIds: { [hitElement.id]: true },\r\n              },\r\n              this.scene.getElements()\r\n            ),\r\n          }));\r\n        }\r\n      }\r\n      if (\r\n        !this.state.editingLinearElement &&\r\n        !pointerDownState.drag.hasOccurred &&\r\n        !this.state.isResizing &&\r\n        ((hitElement &&\r\n          isHittingElementBoundingBoxWithoutHittingElement(\r\n            hitElement,\r\n            this.state,\r\n            pointerDownState.origin.x,\r\n            pointerDownState.origin.y\r\n          )) ||\r\n          (!hitElement &&\r\n            pointerDownState.hit.hasHitCommonBoundingBoxOfSelectedElements))\r\n      ) {\r\n        // Deselect selected elements\r\n        this.setState({\r\n          selectedElementIds: {},\r\n          selectedGroupIds: {},\r\n          editingGroupId: null,\r\n        });\r\n        return;\r\n      }\r\n      if (!elementLocked && elementType !== \"freedraw\" && draggingElement) {\r\n        this.setState((prevState) => ({\r\n          selectedElementIds: {\r\n            ...prevState.selectedElementIds,\r\n            [draggingElement.id]: true,\r\n          },\r\n        }));\r\n      }\r\n      if (\r\n        elementType !== \"selection\" ||\r\n        isSomeElementSelected(this.scene.getElements(), this.state)\r\n      ) {\r\n        this.history.resumeRecording();\r\n      }\r\n      if (pointerDownState.drag.hasOccurred || isResizing || isRotating) {\r\n        (isBindingEnabled(this.state)\r\n          ? bindOrUnbindSelectedElements\r\n          : unbindLinearElements)(\r\n          getSelectedElements(this.scene.getElements(), this.state)\r\n        );\r\n      }\r\n      if (!elementLocked && elementType !== \"freedraw\") {\r\n        resetCursor(this.canvas);\r\n        this.setState({\r\n          draggingElement: null,\r\n          suggestedBindings: [],\r\n          elementType: \"selection\",\r\n        });\r\n      } else {\r\n        this.setState({\r\n          draggingElement: null,\r\n          suggestedBindings: [],\r\n        });\r\n      }\r\n    });\r\n  }\r\n  maybeSuggestBindingForAll(selectedElements) {\r\n    const suggestedBindings = getEligibleElementsForBinding(selectedElements);\r\n    this.setState({ suggestedBindings });\r\n  }\r\n  clearSelection(hitElement) {\r\n    this.setState((prevState) => ({\r\n      selectedElementIds: {},\r\n      selectedGroupIds: {},\r\n      // Continue editing the same group if the user selected a different\r\n      // element from it\r\n      editingGroupId:\r\n        prevState.editingGroupId &&\r\n        hitElement != null &&\r\n        isElementInGroup(hitElement, prevState.editingGroupId)\r\n          ? prevState.editingGroupId\r\n          : null,\r\n    }));\r\n    this.setState({\r\n      selectedElementIds: {},\r\n      previousSelectedElementIds: this.state.selectedElementIds,\r\n    });\r\n  }\r\n  getTextWysiwygSnappedToCenterPosition(x, y, appState, canvas, scale) {\r\n    const elementClickedInside = getElementContainingPosition(\r\n      this.scene\r\n        .getElementsIncludingDeleted()\r\n        .filter((element) => !isTextElement(element)),\r\n      x,\r\n      y\r\n    );\r\n    if (elementClickedInside) {\r\n      const elementCenterX =\r\n        elementClickedInside.x + elementClickedInside.width / 2;\r\n      const elementCenterY =\r\n        elementClickedInside.y + elementClickedInside.height / 2;\r\n      const distanceToCenter = Math.hypot(\r\n        x - elementCenterX,\r\n        y - elementCenterY\r\n      );\r\n      const isSnappedToCenter =\r\n        distanceToCenter < TEXT_TO_CENTER_SNAP_THRESHOLD;\r\n      if (isSnappedToCenter) {\r\n        const { x: viewportX, y: viewportY } = sceneCoordsToViewportCoords(\r\n          { sceneX: elementCenterX, sceneY: elementCenterY },\r\n          appState\r\n        );\r\n        return { viewportX, viewportY, elementCenterX, elementCenterY };\r\n      }\r\n    }\r\n  }\r\n  getCanvasOffsets() {\r\n    if (this.excalidrawContainerRef?.current) {\r\n      const excalidrawContainer = this.excalidrawContainerRef.current;\r\n      const { left, top } = excalidrawContainer.getBoundingClientRect();\r\n      return {\r\n        offsetLeft: left,\r\n        offsetTop: top,\r\n      };\r\n    }\r\n    return {\r\n      offsetLeft: 0,\r\n      offsetTop: 0,\r\n    };\r\n  }\r\n  async updateLanguage() {\r\n    const currentLang =\r\n      languages.find((lang) => lang.code === this.props.langCode) ||\r\n      defaultLang;\r\n    await setLanguage(currentLang);\r\n    this.setAppState({});\r\n  }\r\n}\r\nApp.defaultProps = {\r\n  // needed for tests to pass since we directly render App in many tests\r\n  UIOptions: DEFAULT_UI_OPTIONS,\r\n};\r\nif (\r\n  process.env.NODE_ENV === ENV.TEST ||\r\n  process.env.NODE_ENV === ENV.DEVELOPMENT\r\n) {\r\n  window.h = window.h || {};\r\n  Object.defineProperties(window.h, {\r\n    elements: {\r\n      configurable: true,\r\n      get() {\r\n        return this.app.scene.getElementsIncludingDeleted();\r\n      },\r\n      set(elements) {\r\n        return this.app.scene.replaceAllElements(elements);\r\n      },\r\n    },\r\n  });\r\n}\r\nexport default App;\r\n","import \"./Modal.scss\";\r\nimport React, { useState, useLayoutEffect, useRef } from \"react\";\r\nimport { createPortal } from \"react-dom\";\r\nimport clsx from \"clsx\";\r\nimport { KEYS } from \"../keys\";\r\nimport { useExcalidrawContainer, useIsMobile } from \"./App\";\r\nimport { THEME } from \"../constants\";\r\nexport const Modal = (props) => {\r\n    const { theme = THEME.LIGHT } = props;\r\n    const modalRoot = useBodyRoot(theme);\r\n    if (!modalRoot) {\r\n        return null;\r\n    }\r\n    const handleKeydown = (event) => {\r\n        if (event.key === KEYS.ESCAPE) {\r\n            event.nativeEvent.stopImmediatePropagation();\r\n            event.stopPropagation();\r\n            props.onCloseRequest();\r\n        }\r\n    };\r\n    return createPortal(<div className={clsx(\"Modal\", props.className)} role=\"dialog\" aria-modal=\"true\" onKeyDown={handleKeydown} aria-labelledby={props.labelledBy}>\r\n      <div className=\"Modal__background\" onClick={props.onCloseRequest}></div>\r\n      <div className=\"Modal__content\" style={{ \"--max-width\": `${props.maxWidth}px` }} tabIndex={0}>\r\n        {props.children}\r\n      </div>\r\n    </div>, modalRoot);\r\n};\r\nconst useBodyRoot = (theme) => {\r\n    const [div, setDiv] = useState(null);\r\n    const isMobile = useIsMobile();\r\n    const isMobileRef = useRef(isMobile);\r\n    isMobileRef.current = isMobile;\r\n    const { container: excalidrawContainer } = useExcalidrawContainer();\r\n    useLayoutEffect(() => {\r\n        if (div) {\r\n            div.classList.toggle(\"excalidraw--mobile\", isMobile);\r\n        }\r\n    }, [div, isMobile]);\r\n    useLayoutEffect(() => {\r\n        const isDarkTheme = !!excalidrawContainer?.classList.contains(\"theme--dark\") ||\r\n            theme === \"dark\";\r\n        const div = document.createElement(\"div\");\r\n        div.classList.add(\"excalidraw\", \"excalidraw-modal-container\");\r\n        div.classList.toggle(\"excalidraw--mobile\", isMobileRef.current);\r\n        if (isDarkTheme) {\r\n            div.classList.add(\"theme--dark\");\r\n            div.classList.add(\"theme--dark-background-none\");\r\n        }\r\n        document.body.appendChild(div);\r\n        setDiv(div);\r\n        return () => {\r\n            document.body.removeChild(div);\r\n        };\r\n    }, [excalidrawContainer, theme]);\r\n    return div;\r\n};\r\n","import clsx from \"clsx\";\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useCallbackRefState } from \"../hooks/useCallbackRefState\";\r\nimport { t } from \"../i18n\";\r\nimport { useExcalidrawContainer, useIsMobile } from \"../components/App\";\r\nimport { KEYS } from \"../keys\";\r\nimport \"./Dialog.scss\";\r\nimport { back, close } from \"./icons\";\r\nimport { Island } from \"./Island\";\r\nimport { Modal } from \"./Modal\";\r\nexport const Dialog = (props) => {\r\n    const [islandNode, setIslandNode] = useCallbackRefState();\r\n    const [lastActiveElement] = useState(document.activeElement);\r\n    const { id } = useExcalidrawContainer();\r\n    useEffect(() => {\r\n        if (!islandNode) {\r\n            return;\r\n        }\r\n        const focusableElements = queryFocusableElements(islandNode);\r\n        if (focusableElements.length > 0 && props.autofocus !== false) {\r\n            // If there's an element other than close, focus it.\r\n            (focusableElements[1] || focusableElements[0]).focus();\r\n        }\r\n        const handleKeyDown = (event) => {\r\n            if (event.key === KEYS.TAB) {\r\n                const focusableElements = queryFocusableElements(islandNode);\r\n                const { activeElement } = document;\r\n                const currentIndex = focusableElements.findIndex((element) => element === activeElement);\r\n                if (currentIndex === 0 && event.shiftKey) {\r\n                    focusableElements[focusableElements.length - 1].focus();\r\n                    event.preventDefault();\r\n                }\r\n                else if (currentIndex === focusableElements.length - 1 &&\r\n                    !event.shiftKey) {\r\n                    focusableElements[0].focus();\r\n                    event.preventDefault();\r\n                }\r\n            }\r\n        };\r\n        islandNode.addEventListener(\"keydown\", handleKeyDown);\r\n        return () => islandNode.removeEventListener(\"keydown\", handleKeyDown);\r\n    }, [islandNode, props.autofocus]);\r\n    const queryFocusableElements = (node) => {\r\n        const focusableElements = node.querySelectorAll(\"button, a, input, select, textarea, div[tabindex]\");\r\n        return focusableElements ? Array.from(focusableElements) : [];\r\n    };\r\n    const onClose = () => {\r\n        lastActiveElement.focus();\r\n        props.onCloseRequest();\r\n    };\r\n    return (<Modal className={clsx(\"Dialog\", props.className)} labelledBy=\"dialog-title\" maxWidth={props.small ? 550 : 800} onCloseRequest={onClose} theme={props.theme}>\r\n      <Island ref={setIslandNode}>\r\n        <h2 id={`${id}-dialog-title`} className=\"Dialog__title\">\r\n          <span className=\"Dialog__titleContent\">{props.title}</span>\r\n          <button className=\"Modal__close\" onClick={onClose} aria-label={t(\"buttons.close\")}>\r\n            {useIsMobile() ? back : close}\r\n          </button>\r\n        </h2>\r\n        <div className=\"Dialog__content\">{props.children}</div>\r\n      </Island>\r\n    </Modal>);\r\n};\r\n","import React, { useState } from \"react\";\r\nimport { t } from \"../i18n\";\r\nimport { Dialog } from \"./Dialog\";\r\nimport { useExcalidrawContainer } from \"./App\";\r\nexport const ErrorDialog = ({ message, onClose, }) => {\r\n    const [modalIsShown, setModalIsShown] = useState(!!message);\r\n    const { container: excalidrawContainer } = useExcalidrawContainer();\r\n    const handleClose = React.useCallback(() => {\r\n        setModalIsShown(false);\r\n        if (onClose) {\r\n            onClose();\r\n        }\r\n        // TODO: Fix the A11y issues so this is never needed since we should always focus on last active element\r\n        excalidrawContainer?.focus();\r\n    }, [onClose, excalidrawContainer]);\r\n    return (<>\r\n      {modalIsShown && (<Dialog small onCloseRequest={handleClose} title={t(\"errorDialog.title\")}>\r\n          <div style={{ whiteSpace: \"pre-wrap\" }}>{message}</div>\r\n        </Dialog>)}\r\n    </>);\r\n};\r\n","import React from \"react\";\r\nimport * as Sentry from \"@sentry/browser\";\r\nimport { t } from \"../i18n\";\r\nexport class TopErrorBoundary extends React.Component {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.state = {\r\n            hasError: false,\r\n            sentryEventId: \"\",\r\n            localStorage: \"\",\r\n        };\r\n    }\r\n    render() {\r\n        return this.state.hasError ? this.errorSplash() : this.props.children;\r\n    }\r\n    componentDidCatch(error, errorInfo) {\r\n        const _localStorage = {};\r\n        for (const [key, value] of Object.entries({ ...localStorage })) {\r\n            try {\r\n                _localStorage[key] = JSON.parse(value);\r\n            }\r\n            catch (error) {\r\n                _localStorage[key] = value;\r\n            }\r\n        }\r\n        Sentry.withScope((scope) => {\r\n            scope.setExtras(errorInfo);\r\n            const eventId = Sentry.captureException(error);\r\n            this.setState((state) => ({\r\n                hasError: true,\r\n                sentryEventId: eventId,\r\n                localStorage: JSON.stringify(_localStorage),\r\n            }));\r\n        });\r\n    }\r\n    selectTextArea(event) {\r\n        if (event.target !== document.activeElement) {\r\n            event.preventDefault();\r\n            event.target.select();\r\n        }\r\n    }\r\n    async createGithubIssue() {\r\n        let body = \"\";\r\n        try {\r\n            const templateStrFn = (await import(\r\n            /* webpackChunkName: \"bug-issue-template\" */ \"../bug-issue-template\")).default;\r\n            body = encodeURIComponent(templateStrFn(this.state.sentryEventId));\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n        }\r\n        window.open(`https://github.com/excalidraw/excalidraw/issues/new?body=${body}`);\r\n    }\r\n    errorSplash() {\r\n        return (<div className=\"ErrorSplash excalidraw\">\r\n        <div className=\"ErrorSplash-messageContainer\">\r\n          <div className=\"ErrorSplash-paragraph bigger align-center\">\r\n            {t(\"errorSplash.headingMain_pre\")}\r\n            <button onClick={() => window.location.reload()}>\r\n              {t(\"errorSplash.headingMain_button\")}\r\n            </button>\r\n          </div>\r\n          <div className=\"ErrorSplash-paragraph align-center\">\r\n            {t(\"errorSplash.clearCanvasMessage\")}\r\n            <button onClick={() => {\r\n                try {\r\n                    localStorage.clear();\r\n                    window.location.reload();\r\n                }\r\n                catch (error) {\r\n                    console.error(error);\r\n                }\r\n            }}>\r\n              {t(\"errorSplash.clearCanvasMessage_button\")}\r\n            </button>\r\n            <br />\r\n            <div className=\"smaller\">\r\n              <span role=\"img\" aria-label=\"warning\">\r\n                ⚠️\r\n              </span>\r\n              {t(\"errorSplash.clearCanvasCaveat\")}\r\n              <span role=\"img\" aria-hidden=\"true\">\r\n                ⚠️\r\n              </span>\r\n            </div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ErrorSplash-paragraph\">\r\n              {t(\"errorSplash.trackedToSentry_pre\")}\r\n              {this.state.sentryEventId}\r\n              {t(\"errorSplash.trackedToSentry_post\")}\r\n            </div>\r\n            <div className=\"ErrorSplash-paragraph\">\r\n              {t(\"errorSplash.openIssueMessage_pre\")}\r\n              <button onClick={() => this.createGithubIssue()}>\r\n                {t(\"errorSplash.openIssueMessage_button\")}\r\n              </button>\r\n              {t(\"errorSplash.openIssueMessage_post\")}\r\n            </div>\r\n            <div className=\"ErrorSplash-paragraph\">\r\n              <div className=\"ErrorSplash-details\">\r\n                <label>{t(\"errorSplash.sceneContent\")}</label>\r\n                <textarea rows={5} onPointerDown={this.selectTextArea} readOnly={true} value={this.state.localStorage}/>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>);\r\n    }\r\n}\r\n","import { ENV } from \"../../constants\";\r\nimport pkg from \"./package.json\";\r\nif (process.env.NODE_ENV !== ENV.TEST) {\r\n    /* eslint-disable */\r\n    /* global __webpack_public_path__:writable */\r\n    __webpack_public_path__ =\r\n        window.EXCALIDRAW_ASSET_PATH ||\r\n            `https://unpkg.com/${pkg.name}@${pkg.version}/dist/`;\r\n}\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { LoadingMessage } from \"./LoadingMessage\";\r\nimport { defaultLang, languages, setLanguage } from \"../i18n\";\r\nexport const InitializeApp = (props) => {\r\n    const [loading, setLoading] = useState(true);\r\n    useEffect(() => {\r\n        const updateLang = async () => {\r\n            await setLanguage(currentLang);\r\n        };\r\n        const currentLang = languages.find((lang) => lang.code === props.langCode) || defaultLang;\r\n        updateLang();\r\n        setLoading(false);\r\n    }, [props.langCode]);\r\n    return loading ? <LoadingMessage /> : props.children;\r\n};\r\n","// time constants (ms)\r\nexport const SAVE_TO_LOCAL_STORAGE_TIMEOUT = 300;\r\nexport const INITIAL_SCENE_UPDATE_TIMEOUT = 5000;\r\nexport const FILE_UPLOAD_TIMEOUT = 300;\r\nexport const LOAD_IMAGES_TIMEOUT = 500;\r\nexport const SYNC_FULL_SCENE_INTERVAL_MS = 20000;\r\nexport const FILE_UPLOAD_MAX_BYTES = 3 * 1024 * 1024; // 3 MiB\r\n// 1 year (https://stackoverflow.com/a/25201898/927631)\r\nexport const FILE_CACHE_MAX_AGE_SEC = 31536000;\r\nexport const BROADCAST = {\r\n    SERVER_VOLATILE: \"server-volatile-broadcast\",\r\n    SERVER: \"server-broadcast\",\r\n};\r\nexport var SCENE;\r\n(function (SCENE) {\r\n    SCENE[\"INIT\"] = \"SCENE_INIT\";\r\n    SCENE[\"UPDATE\"] = \"SCENE_UPDATE\";\r\n})(SCENE || (SCENE = {}));\r\nexport const FIREBASE_STORAGE_PREFIXES = {\r\n    shareLinkFiles: `/files/shareLinks`,\r\n    collabFiles: `/files/rooms`,\r\n};\r\n","import React, { useEffect, forwardRef } from \"react\";\r\nimport \"./publicPath\";\r\nimport { InitializeApp } from \"../../components/InitializeApp\";\r\nimport App from \"../../components/App\";\r\nimport \"../../css/app.scss\";\r\nimport \"../../css/styles.scss\";\r\nimport { defaultLang } from \"../../i18n\";\r\nimport { DEFAULT_UI_OPTIONS } from \"../../constants\";\r\nconst Excalidraw = (props) => {\r\n    const { onChange, initialData, excalidrawRef, onCollabButtonClick, isCollaborating, onPointerUpdate, renderTopRightUI, renderFooter, langCode = defaultLang.code, viewModeEnabled, zenModeEnabled, gridModeEnabled, libraryReturnUrl, theme, name, renderCustomStats, onPaste, detectScroll = true, handleKeyboardGlobally = false, onLibraryChange, autoFocus = false, generateIdForFile, } = props;\r\n    const canvasActions = props.UIOptions?.canvasActions;\r\n    const UIOptions = {\r\n        canvasActions: {\r\n            ...DEFAULT_UI_OPTIONS.canvasActions,\r\n            ...canvasActions,\r\n        },\r\n    };\r\n    if (canvasActions?.export) {\r\n        UIOptions.canvasActions.export.saveFileToDisk =\r\n            canvasActions.export?.saveFileToDisk ??\r\n                DEFAULT_UI_OPTIONS.canvasActions.export.saveFileToDisk;\r\n    }\r\n    useEffect(() => {\r\n        // Block pinch-zooming on iOS outside of the content area\r\n        const handleTouchMove = (event) => {\r\n            // @ts-ignore\r\n            if (typeof event.scale === \"number\" && event.scale !== 1) {\r\n                event.preventDefault();\r\n            }\r\n        };\r\n        document.addEventListener(\"touchmove\", handleTouchMove, {\r\n            passive: false,\r\n        });\r\n        return () => {\r\n            document.removeEventListener(\"touchmove\", handleTouchMove);\r\n        };\r\n    }, []);\r\n    return (<InitializeApp langCode={langCode}>\r\n      <App onChange={onChange} initialData={initialData} excalidrawRef={excalidrawRef} onCollabButtonClick={onCollabButtonClick} isCollaborating={isCollaborating} onPointerUpdate={onPointerUpdate} renderTopRightUI={renderTopRightUI} renderFooter={renderFooter} langCode={langCode} viewModeEnabled={viewModeEnabled} zenModeEnabled={zenModeEnabled} gridModeEnabled={gridModeEnabled} libraryReturnUrl={libraryReturnUrl} theme={theme} name={name} renderCustomStats={renderCustomStats} UIOptions={UIOptions} onPaste={onPaste} detectScroll={detectScroll} handleKeyboardGlobally={handleKeyboardGlobally} onLibraryChange={onLibraryChange} autoFocus={autoFocus} generateIdForFile={generateIdForFile}/>\r\n    </InitializeApp>);\r\n};\r\nconst areEqual = (prevProps, nextProps) => {\r\n    const { initialData: prevInitialData, UIOptions: prevUIOptions = {}, ...prev } = prevProps;\r\n    const { initialData: nextInitialData, UIOptions: nextUIOptions = {}, ...next } = nextProps;\r\n    // comparing UIOptions\r\n    const prevUIOptionsKeys = Object.keys(prevUIOptions);\r\n    const nextUIOptionsKeys = Object.keys(nextUIOptions);\r\n    if (prevUIOptionsKeys.length !== nextUIOptionsKeys.length) {\r\n        return false;\r\n    }\r\n    const isUIOptionsSame = prevUIOptionsKeys.every((key) => {\r\n        if (key === \"canvasActions\") {\r\n            const canvasOptionKeys = Object.keys(prevUIOptions.canvasActions);\r\n            canvasOptionKeys.every((key) => {\r\n                if (key === \"export\" &&\r\n                    prevUIOptions?.canvasActions?.export &&\r\n                    nextUIOptions?.canvasActions?.export) {\r\n                    return (prevUIOptions.canvasActions.export.saveFileToDisk ===\r\n                        nextUIOptions.canvasActions.export.saveFileToDisk);\r\n                }\r\n                return (prevUIOptions?.canvasActions?.[key] ===\r\n                    nextUIOptions?.canvasActions?.[key]);\r\n            });\r\n        }\r\n        return true;\r\n    });\r\n    const prevKeys = Object.keys(prevProps);\r\n    const nextKeys = Object.keys(nextProps);\r\n    return (isUIOptionsSame &&\r\n        prevKeys.length === nextKeys.length &&\r\n        prevKeys.every((key) => prev[key] === next[key]));\r\n};\r\nconst forwardedRefComp = forwardRef((props, ref) => <Excalidraw {...props} excalidrawRef={ref}/>);\r\nexport default React.memo(forwardedRefComp, areEqual);\r\nexport { getSceneVersion, getElementMap, isInvisiblySmallElement, getNonDeletedElements, } from \"../../element\";\r\nexport { defaultLang, languages } from \"../../i18n\";\r\nexport { restore, restoreAppState, restoreElements } from \"../../data/restore\";\r\nexport { exportToCanvas, exportToBlob, exportToSvg, serializeAsJSON, loadLibraryFromBlob, loadFromBlob, getFreeDrawSvgPath, } from \"../../packages/utils\";\r\nexport { isLinearElement } from \"../../element/typeChecks\";\r\nexport { FONT_FAMILY, THEME } from \"../../constants\";\r\nexport { mutateElement, newElementWith, bumpVersion, } from \"../../element/mutateElement\";\r\n","import { compressData } from \"../../data/encode\";\r\nimport { newElementWith } from \"../../element/mutateElement\";\r\nimport { isInitializedImageElement } from \"../../element/typeChecks\";\r\nimport { t } from \"../../i18n\";\r\nexport class FileManager {\r\n    constructor({ getFiles, saveFiles, }) {\r\n        /** files being fetched */\r\n        this.fetchingFiles = new Map();\r\n        /** files being saved */\r\n        this.savingFiles = new Map();\r\n        /* files already saved to persistent storage */\r\n        this.savedFiles = new Map();\r\n        this.erroredFiles = new Map();\r\n        /**\r\n         * returns whether file is already saved or being processed\r\n         */\r\n        this.isFileHandled = (id) => {\r\n            return (this.savedFiles.has(id) ||\r\n                this.fetchingFiles.has(id) ||\r\n                this.savingFiles.has(id) ||\r\n                this.erroredFiles.has(id));\r\n        };\r\n        this.isFileSaved = (id) => {\r\n            return this.savedFiles.has(id);\r\n        };\r\n        this.saveFiles = async ({ elements, files, }) => {\r\n            const addedFiles = new Map();\r\n            for (const element of elements) {\r\n                if (isInitializedImageElement(element) &&\r\n                    files[element.fileId] &&\r\n                    !this.isFileHandled(element.fileId)) {\r\n                    addedFiles.set(element.fileId, files[element.fileId]);\r\n                    this.savingFiles.set(element.fileId, true);\r\n                }\r\n            }\r\n            try {\r\n                const { savedFiles, erroredFiles } = await this._saveFiles({\r\n                    addedFiles,\r\n                });\r\n                for (const [fileId] of savedFiles) {\r\n                    this.savedFiles.set(fileId, true);\r\n                }\r\n                return {\r\n                    savedFiles,\r\n                    erroredFiles,\r\n                };\r\n            }\r\n            finally {\r\n                for (const [fileId] of addedFiles) {\r\n                    this.savingFiles.delete(fileId);\r\n                }\r\n            }\r\n        };\r\n        this.getFiles = async (ids) => {\r\n            if (!ids.length) {\r\n                return {\r\n                    loadedFiles: [],\r\n                    erroredFiles: new Map(),\r\n                };\r\n            }\r\n            for (const id of ids) {\r\n                this.fetchingFiles.set(id, true);\r\n            }\r\n            try {\r\n                const { loadedFiles, erroredFiles } = await this._getFiles(ids);\r\n                for (const file of loadedFiles) {\r\n                    this.savedFiles.set(file.id, true);\r\n                }\r\n                for (const [fileId] of erroredFiles) {\r\n                    this.erroredFiles.set(fileId, true);\r\n                }\r\n                return { loadedFiles, erroredFiles };\r\n            }\r\n            finally {\r\n                for (const id of ids) {\r\n                    this.fetchingFiles.delete(id);\r\n                }\r\n            }\r\n        };\r\n        /** a file element prevents unload only if it's being saved regardless of\r\n         *  its `status`. This ensures that elements who for any reason haven't\r\n         *  beed set to `saved` status don't prevent unload in future sessions.\r\n         *  Technically we should prevent unload when the origin client haven't\r\n         *  yet saved the `status` update to storage, but that should be taken care\r\n         *  of during regular beforeUnload unsaved files check.\r\n         */\r\n        this.shouldPreventUnload = (elements) => {\r\n            return elements.some((element) => {\r\n                return (isInitializedImageElement(element) &&\r\n                    !element.isDeleted &&\r\n                    this.savingFiles.has(element.fileId));\r\n            });\r\n        };\r\n        /**\r\n         * helper to determine if image element status needs updating\r\n         */\r\n        this.shouldUpdateImageElementStatus = (element) => {\r\n            return (isInitializedImageElement(element) &&\r\n                this.isFileSaved(element.fileId) &&\r\n                element.status === \"pending\");\r\n        };\r\n        this._getFiles = getFiles;\r\n        this._saveFiles = saveFiles;\r\n    }\r\n    reset() {\r\n        this.fetchingFiles.clear();\r\n        this.savingFiles.clear();\r\n        this.savedFiles.clear();\r\n        this.erroredFiles.clear();\r\n    }\r\n}\r\nexport const encodeFilesForUpload = async ({ files, maxBytes, encryptionKey, }) => {\r\n    const processedFiles = [];\r\n    for (const [id, fileData] of files) {\r\n        const buffer = new TextEncoder().encode(fileData.dataURL);\r\n        const encodedFile = await compressData(buffer, {\r\n            encryptionKey,\r\n            metadata: {\r\n                id,\r\n                mimeType: fileData.mimeType,\r\n                created: Date.now(),\r\n            },\r\n        });\r\n        if (buffer.byteLength > maxBytes) {\r\n            throw new Error(t(\"errors.fileTooBig\", {\r\n                maxSize: `${Math.trunc(maxBytes / 1024 / 1024)}MB`,\r\n            }));\r\n        }\r\n        processedFiles.push({\r\n            id,\r\n            buffer: encodedFile,\r\n        });\r\n    }\r\n    return processedFiles;\r\n};\r\nexport const updateStaleImageStatuses = (params) => {\r\n    if (!params.erroredFiles.size) {\r\n        return;\r\n    }\r\n    params.excalidrawAPI.updateScene({\r\n        elements: params.excalidrawAPI\r\n            .getSceneElementsIncludingDeleted()\r\n            .map((element) => {\r\n            if (isInitializedImageElement(element) &&\r\n                params.erroredFiles.has(element.fileId)) {\r\n                return newElementWith(element, {\r\n                    status: \"error\",\r\n                });\r\n            }\r\n            return element;\r\n        }),\r\n    });\r\n};\r\n","import { getSceneVersion } from \"../../element\";\r\nimport { restoreElements } from \"../../data/restore\";\r\nimport { FILE_CACHE_MAX_AGE_SEC } from \"../app_constants\";\r\nimport { decompressData } from \"../../data/encode\";\r\nimport { getImportedKey, createIV } from \"../../data/encryption\";\r\nimport { MIME_TYPES } from \"../../constants\";\r\n// private\r\n// -----------------------------------------------------------------------------\r\nconst FIREBASE_CONFIG = JSON.parse(process.env.REACT_APP_FIREBASE_CONFIG);\r\nlet firebasePromise = null;\r\nlet firestorePromise = null;\r\nlet firebaseStoragePromise = null;\r\nlet isFirebaseInitialized = false;\r\nconst _loadFirebase = async () => {\r\n    const firebase = (await import(/* webpackChunkName: \"firebase\" */ \"firebase/app\")).default;\r\n    if (!isFirebaseInitialized) {\r\n        try {\r\n            firebase.initializeApp(FIREBASE_CONFIG);\r\n        }\r\n        catch (error) {\r\n            // trying initialize again throws. Usually this is harmless, and happens\r\n            // mainly in dev (HMR)\r\n            if (error.code === \"app/duplicate-app\") {\r\n                console.warn(error.name, error.code);\r\n            }\r\n            else {\r\n                throw error;\r\n            }\r\n        }\r\n        isFirebaseInitialized = true;\r\n    }\r\n    return firebase;\r\n};\r\nconst _getFirebase = async () => {\r\n    if (!firebasePromise) {\r\n        firebasePromise = _loadFirebase();\r\n    }\r\n    return firebasePromise;\r\n};\r\n// -----------------------------------------------------------------------------\r\nconst loadFirestore = async () => {\r\n    const firebase = await _getFirebase();\r\n    if (!firestorePromise) {\r\n        firestorePromise = import(\r\n        /* webpackChunkName: \"firestore\" */ \"firebase/firestore\");\r\n    }\r\n    if (firestorePromise !== true) {\r\n        await firestorePromise;\r\n        firestorePromise = true;\r\n    }\r\n    return firebase;\r\n};\r\nexport const loadFirebaseStorage = async () => {\r\n    const firebase = await _getFirebase();\r\n    if (!firebaseStoragePromise) {\r\n        firebaseStoragePromise = import(\r\n        /* webpackChunkName: \"storage\" */ \"firebase/storage\");\r\n    }\r\n    if (firebaseStoragePromise !== true) {\r\n        await firebaseStoragePromise;\r\n        firebaseStoragePromise = true;\r\n    }\r\n    return firebase;\r\n};\r\nconst encryptElements = async (key, elements) => {\r\n    const importedKey = await getImportedKey(key, \"encrypt\");\r\n    const iv = createIV();\r\n    const json = JSON.stringify(elements);\r\n    const encoded = new TextEncoder().encode(json);\r\n    const ciphertext = await window.crypto.subtle.encrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, importedKey, encoded);\r\n    return { ciphertext, iv };\r\n};\r\nconst decryptElements = async (key, iv, ciphertext) => {\r\n    const importedKey = await getImportedKey(key, \"decrypt\");\r\n    const decrypted = await window.crypto.subtle.decrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, importedKey, ciphertext);\r\n    const decodedData = new TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));\r\n    return JSON.parse(decodedData);\r\n};\r\nconst firebaseSceneVersionCache = new WeakMap();\r\nexport const isSavedToFirebase = (portal, elements) => {\r\n    if (portal.socket && portal.roomId && portal.roomKey) {\r\n        const sceneVersion = getSceneVersion(elements);\r\n        return firebaseSceneVersionCache.get(portal.socket) === sceneVersion;\r\n    }\r\n    // if no room exists, consider the room saved so that we don't unnecessarily\r\n    // prevent unload (there's nothing we could do at that point anyway)\r\n    return true;\r\n};\r\nexport const saveFilesToFirebase = async ({ prefix, files, }) => {\r\n    const firebase = await loadFirebaseStorage();\r\n    const erroredFiles = new Map();\r\n    const savedFiles = new Map();\r\n    await Promise.all(files.map(async ({ id, buffer }) => {\r\n        try {\r\n            await firebase\r\n                .storage()\r\n                .ref(`${prefix}/${id}`)\r\n                .put(new Blob([buffer], {\r\n                type: MIME_TYPES.binary,\r\n            }), {\r\n                cacheControl: `public, max-age=${FILE_CACHE_MAX_AGE_SEC}`,\r\n            });\r\n            savedFiles.set(id, true);\r\n        }\r\n        catch (error) {\r\n            erroredFiles.set(id, true);\r\n        }\r\n    }));\r\n    return { savedFiles, erroredFiles };\r\n};\r\nexport const saveToFirebase = async (portal, elements) => {\r\n    const { roomId, roomKey, socket } = portal;\r\n    if (\r\n    // if no room exists, consider the room saved because there's nothing we can\r\n    // do at this point\r\n    !roomId ||\r\n        !roomKey ||\r\n        !socket ||\r\n        isSavedToFirebase(portal, elements)) {\r\n        return true;\r\n    }\r\n    const firebase = await loadFirestore();\r\n    const sceneVersion = getSceneVersion(elements);\r\n    const { ciphertext, iv } = await encryptElements(roomKey, elements);\r\n    const nextDocData = {\r\n        sceneVersion,\r\n        ciphertext: firebase.firestore.Blob.fromUint8Array(new Uint8Array(ciphertext)),\r\n        iv: firebase.firestore.Blob.fromUint8Array(iv),\r\n    };\r\n    const db = firebase.firestore();\r\n    const docRef = db.collection(\"scenes\").doc(roomId);\r\n    const didUpdate = await db.runTransaction(async (transaction) => {\r\n        const doc = await transaction.get(docRef);\r\n        if (!doc.exists) {\r\n            transaction.set(docRef, nextDocData);\r\n            return true;\r\n        }\r\n        const prevDocData = doc.data();\r\n        if (prevDocData.sceneVersion >= nextDocData.sceneVersion) {\r\n            return false;\r\n        }\r\n        transaction.update(docRef, nextDocData);\r\n        return true;\r\n    });\r\n    if (didUpdate) {\r\n        firebaseSceneVersionCache.set(socket, sceneVersion);\r\n    }\r\n    return didUpdate;\r\n};\r\nexport const loadFromFirebase = async (roomId, roomKey, socket) => {\r\n    const firebase = await loadFirestore();\r\n    const db = firebase.firestore();\r\n    const docRef = db.collection(\"scenes\").doc(roomId);\r\n    const doc = await docRef.get();\r\n    if (!doc.exists) {\r\n        return null;\r\n    }\r\n    const storedScene = doc.data();\r\n    const ciphertext = storedScene.ciphertext.toUint8Array();\r\n    const iv = storedScene.iv.toUint8Array();\r\n    const elements = await decryptElements(roomKey, iv, ciphertext);\r\n    if (socket) {\r\n        firebaseSceneVersionCache.set(socket, getSceneVersion(elements));\r\n    }\r\n    return restoreElements(elements, null);\r\n};\r\nexport const loadFilesFromFirebase = async (prefix, decryptionKey, filesIds) => {\r\n    const loadedFiles = [];\r\n    const erroredFiles = new Map();\r\n    await Promise.all([...new Set(filesIds)].map(async (id) => {\r\n        try {\r\n            const url = `https://firebasestorage.googleapis.com/v0/b/${FIREBASE_CONFIG.storageBucket}/o/${encodeURIComponent(prefix.replace(/^\\//, \"\"))}%2F${id}`;\r\n            const response = await fetch(`${url}?alt=media`);\r\n            if (response.status < 400) {\r\n                const arrayBuffer = await response.arrayBuffer();\r\n                const { data, metadata } = await decompressData(new Uint8Array(arrayBuffer), {\r\n                    decryptionKey,\r\n                });\r\n                const dataURL = new TextDecoder().decode(data);\r\n                loadedFiles.push({\r\n                    mimeType: metadata.mimeType || MIME_TYPES.binary,\r\n                    id,\r\n                    dataURL,\r\n                    created: metadata?.created || Date.now(),\r\n                });\r\n            }\r\n            else {\r\n                erroredFiles.set(id, true);\r\n            }\r\n        }\r\n        catch (error) {\r\n            erroredFiles.set(id, true);\r\n            console.error(error);\r\n        }\r\n    }));\r\n    return { loadedFiles, erroredFiles };\r\n};\r\n","import { createIV, generateEncryptionKey, getImportedKey, IV_LENGTH_BYTES, } from \"../../data/encryption\";\r\nimport { serializeAsJSON } from \"../../data/json\";\r\nimport { restore } from \"../../data/restore\";\r\nimport { isInitializedImageElement } from \"../../element/typeChecks\";\r\nimport { t } from \"../../i18n\";\r\nimport { FILE_UPLOAD_MAX_BYTES } from \"../app_constants\";\r\nimport { encodeFilesForUpload } from \"./FileManager\";\r\nimport { saveFilesToFirebase } from \"./firebase\";\r\nconst byteToHex = (byte) => `0${byte.toString(16)}`.slice(-2);\r\nconst BACKEND_V2_GET = process.env.REACT_APP_BACKEND_V2_GET_URL;\r\nconst BACKEND_V2_POST = process.env.REACT_APP_BACKEND_V2_POST_URL;\r\nconst generateRandomID = async () => {\r\n    const arr = new Uint8Array(10);\r\n    window.crypto.getRandomValues(arr);\r\n    return Array.from(arr, byteToHex).join(\"\");\r\n};\r\nexport const SOCKET_SERVER = process.env.REACT_APP_SOCKET_SERVER_URL;\r\nexport const encryptAESGEM = async (data, key) => {\r\n    const importedKey = await getImportedKey(key, \"encrypt\");\r\n    const iv = createIV();\r\n    return {\r\n        data: await window.crypto.subtle.encrypt({\r\n            name: \"AES-GCM\",\r\n            iv,\r\n        }, importedKey, data),\r\n        iv,\r\n    };\r\n};\r\nexport const decryptAESGEM = async (data, key, iv) => {\r\n    try {\r\n        const importedKey = await getImportedKey(key, \"decrypt\");\r\n        const decrypted = await window.crypto.subtle.decrypt({\r\n            name: \"AES-GCM\",\r\n            iv,\r\n        }, importedKey, data);\r\n        const decodedData = new TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));\r\n        return JSON.parse(decodedData);\r\n    }\r\n    catch (error) {\r\n        window.alert(t(\"alerts.decryptFailed\"));\r\n        console.error(error);\r\n    }\r\n    return {\r\n        type: \"INVALID_RESPONSE\",\r\n    };\r\n};\r\nexport const getCollaborationLinkData = (link) => {\r\n    const hash = new URL(link).hash;\r\n    const match = hash.match(/^#room=([a-zA-Z0-9_-]+),([a-zA-Z0-9_-]+)$/);\r\n    if (match && match[2].length !== 22) {\r\n        window.alert(t(\"alerts.invalidEncryptionKey\"));\r\n        return null;\r\n    }\r\n    return match ? { roomId: match[1], roomKey: match[2] } : null;\r\n};\r\nexport const generateCollaborationLinkData = async () => {\r\n    const roomId = await generateRandomID();\r\n    const roomKey = await generateEncryptionKey();\r\n    if (!roomKey) {\r\n        throw new Error(\"Couldn't generate room key\");\r\n    }\r\n    return { roomId, roomKey };\r\n};\r\nexport const getCollaborationLink = (data) => {\r\n    return `${window.location.origin}${window.location.pathname}#room=${data.roomId},${data.roomKey}`;\r\n};\r\nexport const decryptImported = async (iv, encrypted, privateKey) => {\r\n    const key = await getImportedKey(privateKey, \"decrypt\");\r\n    return window.crypto.subtle.decrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, key, encrypted);\r\n};\r\nconst importFromBackend = async (id, privateKey) => {\r\n    try {\r\n        const response = await fetch(`${BACKEND_V2_GET}${id}`);\r\n        if (!response.ok) {\r\n            window.alert(t(\"alerts.importBackendFailed\"));\r\n            return {};\r\n        }\r\n        const buffer = await response.arrayBuffer();\r\n        let decrypted;\r\n        try {\r\n            // Buffer should contain both the IV (fixed length) and encrypted data\r\n            const iv = buffer.slice(0, IV_LENGTH_BYTES);\r\n            const encrypted = buffer.slice(IV_LENGTH_BYTES, buffer.byteLength);\r\n            decrypted = await decryptImported(iv, encrypted, privateKey);\r\n        }\r\n        catch (error) {\r\n            // Fixed IV (old format, backward compatibility)\r\n            const fixedIv = new Uint8Array(IV_LENGTH_BYTES);\r\n            decrypted = await decryptImported(fixedIv, buffer, privateKey);\r\n        }\r\n        // We need to convert the decrypted array buffer to a string\r\n        const string = new window.TextDecoder(\"utf-8\").decode(new Uint8Array(decrypted));\r\n        const data = JSON.parse(string);\r\n        return {\r\n            elements: data.elements || null,\r\n            appState: data.appState || null,\r\n        };\r\n    }\r\n    catch (error) {\r\n        window.alert(t(\"alerts.importBackendFailed\"));\r\n        console.error(error);\r\n        return {};\r\n    }\r\n};\r\nexport const loadScene = async (id, privateKey, \r\n// Supply local state even if importing from backend to ensure we restore\r\n// localStorage user settings which we do not persist on server.\r\n// Non-optional so we don't forget to pass it even if `undefined`.\r\nlocalDataState) => {\r\n    let data;\r\n    if (id != null && privateKey != null) {\r\n        // the private key is used to decrypt the content from the server, take\r\n        // extra care not to leak it\r\n        data = restore(await importFromBackend(id, privateKey), localDataState?.appState, localDataState?.elements);\r\n    }\r\n    else {\r\n        data = restore(localDataState || null, null, null);\r\n    }\r\n    return {\r\n        elements: data.elements,\r\n        appState: data.appState,\r\n        // note: this will always be empty because we're not storing files\r\n        // in the scene database/localStorage, and instead fetch them async\r\n        // from a different database\r\n        files: data.files,\r\n        commitToHistory: false,\r\n    };\r\n};\r\nexport const exportToBackend = async (elements, appState, files) => {\r\n    const json = serializeAsJSON(elements, appState, files, \"database\");\r\n    const encoded = new TextEncoder().encode(json);\r\n    const cryptoKey = await window.crypto.subtle.generateKey({\r\n        name: \"AES-GCM\",\r\n        length: 128,\r\n    }, true, // extractable\r\n    [\"encrypt\", \"decrypt\"]);\r\n    const iv = createIV();\r\n    // We use symmetric encryption. AES-GCM is the recommended algorithm and\r\n    // includes checks that the ciphertext has not been modified by an attacker.\r\n    const encrypted = await window.crypto.subtle.encrypt({\r\n        name: \"AES-GCM\",\r\n        iv,\r\n    }, cryptoKey, encoded);\r\n    // Concatenate IV with encrypted data (IV does not have to be secret).\r\n    const payloadBlob = new Blob([iv.buffer, encrypted]);\r\n    const payload = await new Response(payloadBlob).arrayBuffer();\r\n    // We use jwk encoding to be able to extract just the base64 encoded key.\r\n    // We will hardcode the rest of the attributes when importing back the key.\r\n    const exportedKey = await window.crypto.subtle.exportKey(\"jwk\", cryptoKey);\r\n    try {\r\n        const filesMap = new Map();\r\n        for (const element of elements) {\r\n            if (isInitializedImageElement(element) && files[element.fileId]) {\r\n                filesMap.set(element.fileId, files[element.fileId]);\r\n            }\r\n        }\r\n        const encryptionKey = exportedKey.k;\r\n        const filesToUpload = await encodeFilesForUpload({\r\n            files: filesMap,\r\n            encryptionKey,\r\n            maxBytes: FILE_UPLOAD_MAX_BYTES,\r\n        });\r\n        const response = await fetch(BACKEND_V2_POST, {\r\n            method: \"POST\",\r\n            body: payload,\r\n        });\r\n        const json = await response.json();\r\n        if (json.id) {\r\n            const url = new URL(window.location.href);\r\n            // We need to store the key (and less importantly the id) as hash instead\r\n            // of queryParam in order to never send it to the server\r\n            url.hash = `json=${json.id},${encryptionKey}`;\r\n            const urlString = url.toString();\r\n            await saveFilesToFirebase({\r\n                prefix: `/files/shareLinks/${json.id}`,\r\n                files: filesToUpload,\r\n            });\r\n            window.prompt(`🔒${t(\"alerts.uploadedSecurly\")}`, urlString);\r\n        }\r\n        else if (json.error_class === \"RequestTooLargeError\") {\r\n            window.alert(t(\"alerts.couldNotCreateShareableLinkTooBig\"));\r\n        }\r\n        else {\r\n            window.alert(t(\"alerts.couldNotCreateShareableLink\"));\r\n        }\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        window.alert(t(\"alerts.couldNotCreateShareableLink\"));\r\n    }\r\n};\r\n","import { clearAppStateForLocalStorage, getDefaultAppState, } from \"../../appState\";\r\nimport { clearElementsForLocalStorage } from \"../../element\";\r\nimport { STORAGE_KEYS as APP_STORAGE_KEYS } from \"../../constants\";\r\nexport const STORAGE_KEYS = {\r\n    LOCAL_STORAGE_ELEMENTS: \"excalidraw\",\r\n    LOCAL_STORAGE_APP_STATE: \"excalidraw-state\",\r\n    LOCAL_STORAGE_COLLAB: \"excalidraw-collab\",\r\n    LOCAL_STORAGE_KEY_COLLAB_FORCE_FLAG: \"collabLinkForceLoadFlag\",\r\n};\r\nexport const saveUsernameToLocalStorage = (username) => {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB, JSON.stringify({ username }));\r\n    }\r\n    catch (error) {\r\n        // Unable to access window.localStorage\r\n        console.error(error);\r\n    }\r\n};\r\nexport const importUsernameFromLocalStorage = () => {\r\n    try {\r\n        const data = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\r\n        if (data) {\r\n            return JSON.parse(data).username;\r\n        }\r\n    }\r\n    catch (error) {\r\n        // Unable to access localStorage\r\n        console.error(error);\r\n    }\r\n    return null;\r\n};\r\nexport const saveToLocalStorage = (elements, appState) => {\r\n    try {\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS, JSON.stringify(clearElementsForLocalStorage(elements)));\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE, JSON.stringify(clearAppStateForLocalStorage(appState)));\r\n    }\r\n    catch (error) {\r\n        // Unable to access window.localStorage\r\n        console.error(error);\r\n    }\r\n};\r\nexport const importFromLocalStorage = () => {\r\n    let savedElements = null;\r\n    let savedState = null;\r\n    try {\r\n        savedElements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\r\n        savedState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\r\n    }\r\n    catch (error) {\r\n        // Unable to access localStorage\r\n        console.error(error);\r\n    }\r\n    let elements = [];\r\n    if (savedElements) {\r\n        try {\r\n            elements = clearElementsForLocalStorage(JSON.parse(savedElements));\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            // Do nothing because elements array is already empty\r\n        }\r\n    }\r\n    let appState = null;\r\n    if (savedState) {\r\n        try {\r\n            appState = {\r\n                ...getDefaultAppState(),\r\n                ...clearAppStateForLocalStorage(JSON.parse(savedState)),\r\n            };\r\n        }\r\n        catch (error) {\r\n            console.error(error);\r\n            // Do nothing because appState is already null\r\n        }\r\n    }\r\n    return { elements, appState };\r\n};\r\nexport const getElementsStorageSize = () => {\r\n    try {\r\n        const elements = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_ELEMENTS);\r\n        const elementsSize = elements?.length || 0;\r\n        return elementsSize;\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        return 0;\r\n    }\r\n};\r\nexport const getTotalStorageSize = () => {\r\n    try {\r\n        const appState = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_APP_STATE);\r\n        const collab = localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_COLLAB);\r\n        const library = localStorage.getItem(APP_STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\r\n        const appStateSize = appState?.length || 0;\r\n        const collabSize = collab?.length || 0;\r\n        const librarySize = library?.length || 0;\r\n        return appStateSize + collabSize + librarySize + getElementsStorageSize();\r\n    }\r\n    catch (error) {\r\n        console.error(error);\r\n        return 0;\r\n    }\r\n};\r\n","import { encryptAESGEM, } from \"../data\";\r\nimport { BROADCAST, FILE_UPLOAD_TIMEOUT, SCENE } from \"../app_constants\";\r\nimport { trackEvent } from \"../../analytics\";\r\nimport { throttle } from \"lodash\";\r\nimport { newElementWith } from \"../../element/mutateElement\";\r\nclass Portal {\r\n    constructor(collab) {\r\n        this.socket = null;\r\n        this.socketInitialized = false; // we don't want the socket to emit any updates until it is fully initialized\r\n        this.roomId = null;\r\n        this.roomKey = null;\r\n        this.broadcastedElementVersions = new Map();\r\n        this.queueFileUpload = throttle(async () => {\r\n            try {\r\n                await this.collab.fileManager.saveFiles({\r\n                    elements: this.collab.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                    files: this.collab.excalidrawAPI.getFiles(),\r\n                });\r\n            }\r\n            catch (error) {\r\n                if (error.name !== \"AbortError\") {\r\n                    this.collab.excalidrawAPI.updateScene({\r\n                        appState: {\r\n                            errorMessage: error.message,\r\n                        },\r\n                    });\r\n                }\r\n            }\r\n            this.collab.excalidrawAPI.updateScene({\r\n                elements: this.collab.excalidrawAPI\r\n                    .getSceneElementsIncludingDeleted()\r\n                    .map((element) => {\r\n                    if (this.collab.fileManager.shouldUpdateImageElementStatus(element)) {\r\n                        // this will signal collaborators to pull image data from server\r\n                        // (using mutation instead of newElementWith otherwise it'd break\r\n                        // in-progress dragging)\r\n                        return newElementWith(element, { status: \"saved\" });\r\n                    }\r\n                    return element;\r\n                }),\r\n            });\r\n        }, FILE_UPLOAD_TIMEOUT);\r\n        this.broadcastScene = async (sceneType, allElements, syncAll) => {\r\n            if (sceneType === SCENE.INIT && !syncAll) {\r\n                throw new Error(\"syncAll must be true when sending SCENE.INIT\");\r\n            }\r\n            // sync out only the elements we think we need to to save bandwidth.\r\n            // periodically we'll resync the whole thing to make sure no one diverges\r\n            // due to a dropped message (server goes down etc).\r\n            const syncableElements = allElements.reduce((acc, element, idx, elements) => {\r\n                if ((syncAll ||\r\n                    !this.broadcastedElementVersions.has(element.id) ||\r\n                    element.version >\r\n                        this.broadcastedElementVersions.get(element.id)) &&\r\n                    this.collab.isSyncableElement(element)) {\r\n                    acc.push({\r\n                        ...element,\r\n                        // z-index info for the reconciler\r\n                        parent: idx === 0 ? \"^\" : elements[idx - 1]?.id,\r\n                    });\r\n                }\r\n                return acc;\r\n            }, []);\r\n            const data = {\r\n                type: sceneType,\r\n                payload: {\r\n                    elements: syncableElements,\r\n                },\r\n            };\r\n            for (const syncableElement of syncableElements) {\r\n                this.broadcastedElementVersions.set(syncableElement.id, syncableElement.version);\r\n            }\r\n            const broadcastPromise = this._broadcastSocketData(data);\r\n            this.queueFileUpload();\r\n            if (syncAll && this.collab.isCollaborating) {\r\n                await Promise.all([\r\n                    broadcastPromise,\r\n                    this.collab.saveCollabRoomToFirebase(syncableElements),\r\n                ]);\r\n            }\r\n            else {\r\n                await broadcastPromise;\r\n            }\r\n        };\r\n        this.broadcastIdleChange = (userState) => {\r\n            if (this.socket?.id) {\r\n                const data = {\r\n                    type: \"IDLE_STATUS\",\r\n                    payload: {\r\n                        socketId: this.socket.id,\r\n                        userState,\r\n                        username: this.collab.state.username,\r\n                    },\r\n                };\r\n                return this._broadcastSocketData(data, true);\r\n            }\r\n        };\r\n        this.broadcastMouseLocation = (payload) => {\r\n            if (this.socket?.id) {\r\n                const data = {\r\n                    type: \"MOUSE_LOCATION\",\r\n                    payload: {\r\n                        socketId: this.socket.id,\r\n                        pointer: payload.pointer,\r\n                        button: payload.button || \"up\",\r\n                        selectedElementIds: this.collab.excalidrawAPI.getAppState().selectedElementIds,\r\n                        username: this.collab.state.username,\r\n                    },\r\n                };\r\n                return this._broadcastSocketData(data, true);\r\n            }\r\n        };\r\n        this.collab = collab;\r\n    }\r\n    open(socket, id, key) {\r\n        this.socket = socket;\r\n        this.roomId = id;\r\n        this.roomKey = key;\r\n        // Initialize socket listeners\r\n        this.socket.on(\"init-room\", () => {\r\n            if (this.socket) {\r\n                this.socket.emit(\"join-room\", this.roomId);\r\n                trackEvent(\"share\", \"room joined\");\r\n            }\r\n        });\r\n        this.socket.on(\"new-user\", async (_socketId) => {\r\n            this.broadcastScene(SCENE.INIT, this.collab.getSceneElementsIncludingDeleted(), \r\n            /* syncAll */ true);\r\n        });\r\n        this.socket.on(\"room-user-change\", (clients) => {\r\n            this.collab.setCollaborators(clients);\r\n        });\r\n    }\r\n    close() {\r\n        if (!this.socket) {\r\n            return;\r\n        }\r\n        this.queueFileUpload.flush();\r\n        this.socket.close();\r\n        this.socket = null;\r\n        this.roomId = null;\r\n        this.roomKey = null;\r\n        this.socketInitialized = false;\r\n        this.broadcastedElementVersions = new Map();\r\n    }\r\n    isOpen() {\r\n        return !!(this.socketInitialized &&\r\n            this.socket &&\r\n            this.roomId &&\r\n            this.roomKey);\r\n    }\r\n    async _broadcastSocketData(data, volatile = false) {\r\n        if (this.isOpen()) {\r\n            const json = JSON.stringify(data);\r\n            const encoded = new TextEncoder().encode(json);\r\n            const encrypted = await encryptAESGEM(encoded, this.roomKey);\r\n            this.socket?.emit(volatile ? BROADCAST.SERVER_VOLATILE : BROADCAST.SERVER, this.roomId, encrypted.data, encrypted.iv);\r\n        }\r\n    }\r\n}\r\nexport default Portal;\r\n","import React, { useRef } from \"react\";\r\nimport { copyTextToSystemClipboard } from \"../../clipboard\";\r\nimport { Dialog } from \"../../components/Dialog\";\r\nimport { clipboard, start, stop, share, shareIOS, shareWindows, } from \"../../components/icons\";\r\nimport { ToolButton } from \"../../components/ToolButton\";\r\nimport { t } from \"../../i18n\";\r\nimport \"./RoomDialog.scss\";\r\nimport Stack from \"../../components/Stack\";\r\nconst getShareIcon = () => {\r\n    const navigator = window.navigator;\r\n    const isAppleBrowser = /Apple/.test(navigator.vendor);\r\n    const isWindowsBrowser = navigator.appVersion.indexOf(\"Win\") !== -1;\r\n    if (isAppleBrowser) {\r\n        return shareIOS;\r\n    }\r\n    else if (isWindowsBrowser) {\r\n        return shareWindows;\r\n    }\r\n    return share;\r\n};\r\nconst RoomDialog = ({ handleClose, activeRoomLink, username, onUsernameChange, onRoomCreate, onRoomDestroy, setErrorMessage, theme, }) => {\r\n    const roomLinkInput = useRef(null);\r\n    const copyRoomLink = async () => {\r\n        try {\r\n            await copyTextToSystemClipboard(activeRoomLink);\r\n        }\r\n        catch (error) {\r\n            setErrorMessage(error.message);\r\n        }\r\n        if (roomLinkInput.current) {\r\n            roomLinkInput.current.select();\r\n        }\r\n    };\r\n    const shareRoomLink = async () => {\r\n        try {\r\n            await navigator.share({\r\n                title: t(\"roomDialog.shareTitle\"),\r\n                text: t(\"roomDialog.shareTitle\"),\r\n                url: activeRoomLink,\r\n            });\r\n        }\r\n        catch (error) {\r\n            // Just ignore.\r\n        }\r\n    };\r\n    const selectInput = (event) => {\r\n        if (event.target !== document.activeElement) {\r\n            event.preventDefault();\r\n            event.target.select();\r\n        }\r\n    };\r\n    const renderRoomDialog = () => {\r\n        return (<div className=\"RoomDialog-modal\">\r\n        {!activeRoomLink && (<>\r\n            <p>{t(\"roomDialog.desc_intro\")}</p>\r\n            <p>{`🔒 ${t(\"roomDialog.desc_privacy\")}`}</p>\r\n            <div className=\"RoomDialog-sessionStartButtonContainer\">\r\n              <ToolButton className=\"RoomDialog-startSession\" type=\"button\" icon={start} title={t(\"roomDialog.button_startSession\")} aria-label={t(\"roomDialog.button_startSession\")} showAriaLabel={true} onClick={onRoomCreate}/>\r\n            </div>\r\n          </>)}\r\n        {activeRoomLink && (<>\r\n            <p>{t(\"roomDialog.desc_inProgressIntro\")}</p>\r\n            <p>{t(\"roomDialog.desc_shareLink\")}</p>\r\n            <div className=\"RoomDialog-linkContainer\">\r\n              <Stack.Row gap={2}>\r\n                {\"share\" in navigator ? (<ToolButton type=\"button\" icon={getShareIcon()} title={t(\"labels.share\")} aria-label={t(\"labels.share\")} onClick={shareRoomLink}/>) : null}\r\n                <ToolButton type=\"button\" icon={clipboard} title={t(\"labels.copy\")} aria-label={t(\"labels.copy\")} onClick={copyRoomLink}/>\r\n              </Stack.Row>\r\n              <input value={activeRoomLink} readOnly={true} className=\"RoomDialog-link\" ref={roomLinkInput} onPointerDown={selectInput}/>\r\n            </div>\r\n            <div className=\"RoomDialog-usernameContainer\">\r\n              <label className=\"RoomDialog-usernameLabel\" htmlFor=\"username\">\r\n                {t(\"labels.yourName\")}\r\n              </label>\r\n              <input id=\"username\" value={username || \"\"} className=\"RoomDialog-username TextInput\" onChange={(event) => onUsernameChange(event.target.value)} onKeyPress={(event) => event.key === \"Enter\" && handleClose()}/>\r\n            </div>\r\n            <p>\r\n              <span role=\"img\" aria-hidden=\"true\" className=\"RoomDialog-emoji\">\r\n                {\"🔒\"}\r\n              </span>{\" \"}\r\n              {t(\"roomDialog.desc_privacy\")}\r\n            </p>\r\n            <p>{t(\"roomDialog.desc_exitSession\")}</p>\r\n            <div className=\"RoomDialog-sessionStartButtonContainer\">\r\n              <ToolButton className=\"RoomDialog-stopSession\" type=\"button\" icon={stop} title={t(\"roomDialog.button_stopSession\")} aria-label={t(\"roomDialog.button_stopSession\")} showAriaLabel={true} onClick={onRoomDestroy}/>\r\n            </div>\r\n          </>)}\r\n      </div>);\r\n    };\r\n    return (<Dialog small onCloseRequest={handleClose} title={t(\"labels.liveCollaboration\")} theme={theme}>\r\n      {renderRoomDialog()}\r\n    </Dialog>);\r\n};\r\nexport default RoomDialog;\r\n","const shouldDiscardRemoteElement = (localAppState, local, remote) => {\r\n    if (local &&\r\n        // local element is being edited\r\n        (local.id === localAppState.editingElement?.id ||\r\n            local.id === localAppState.resizingElement?.id ||\r\n            local.id === localAppState.draggingElement?.id ||\r\n            // local element is newer\r\n            local.version > remote.version ||\r\n            // resolve conflicting edits deterministically by taking the one with\r\n            // the lowest versionNonce\r\n            (local.version === remote.version &&\r\n                local.versionNonce < remote.versionNonce))) {\r\n        return true;\r\n    }\r\n    return false;\r\n};\r\nconst getElementsMapWithIndex = (elements) => elements.reduce((acc, element, idx) => {\r\n    acc[element.id] = [element, idx];\r\n    return acc;\r\n}, {});\r\nexport const reconcileElements = (localElements, remoteElements, localAppState) => {\r\n    const localElementsData = getElementsMapWithIndex(localElements);\r\n    const reconciledElements = localElements.slice();\r\n    const duplicates = new WeakMap();\r\n    let cursor = 0;\r\n    let offset = 0;\r\n    let remoteElementIdx = -1;\r\n    for (const remoteElement of remoteElements) {\r\n        remoteElementIdx++;\r\n        const local = localElementsData[remoteElement.id];\r\n        if (shouldDiscardRemoteElement(localAppState, local?.[0], remoteElement)) {\r\n            if (remoteElement.parent) {\r\n                delete remoteElement.parent;\r\n            }\r\n            continue;\r\n        }\r\n        if (local) {\r\n            // mark for removal since it'll be replaced with the remote element\r\n            duplicates.set(local[0], true);\r\n        }\r\n        // parent may not be defined in case the remote client is running an older\r\n        // excalidraw version\r\n        const parent = remoteElement.parent || remoteElements[remoteElementIdx - 1]?.id || null;\r\n        if (parent != null) {\r\n            delete remoteElement.parent;\r\n            // ^ indicates the element is the first in elements array\r\n            if (parent === \"^\") {\r\n                offset++;\r\n                if (cursor === 0) {\r\n                    reconciledElements.unshift(remoteElement);\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        cursor - offset,\r\n                    ];\r\n                }\r\n                else {\r\n                    reconciledElements.splice(cursor + 1, 0, remoteElement);\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        cursor + 1 - offset,\r\n                    ];\r\n                    cursor++;\r\n                }\r\n            }\r\n            else {\r\n                let idx = localElementsData[parent]\r\n                    ? localElementsData[parent][1]\r\n                    : null;\r\n                if (idx != null) {\r\n                    idx += offset;\r\n                }\r\n                if (idx != null && idx >= cursor) {\r\n                    reconciledElements.splice(idx + 1, 0, remoteElement);\r\n                    offset++;\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        idx + 1 - offset,\r\n                    ];\r\n                    cursor = idx + 1;\r\n                }\r\n                else if (idx != null) {\r\n                    reconciledElements.splice(cursor + 1, 0, remoteElement);\r\n                    offset++;\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        cursor + 1 - offset,\r\n                    ];\r\n                    cursor++;\r\n                }\r\n                else {\r\n                    reconciledElements.push(remoteElement);\r\n                    localElementsData[remoteElement.id] = [\r\n                        remoteElement,\r\n                        reconciledElements.length - 1 - offset,\r\n                    ];\r\n                }\r\n            }\r\n            // no parent z-index information, local element exists → replace in place\r\n        }\r\n        else if (local) {\r\n            reconciledElements[local[1]] = remoteElement;\r\n            localElementsData[remoteElement.id] = [remoteElement, local[1]];\r\n            // otherwise push to the end\r\n        }\r\n        else {\r\n            reconciledElements.push(remoteElement);\r\n            localElementsData[remoteElement.id] = [\r\n                remoteElement,\r\n                reconciledElements.length - 1 - offset,\r\n            ];\r\n        }\r\n    }\r\n    const ret = reconciledElements.filter((element) => !duplicates.has(element));\r\n    return ret;\r\n};\r\n","import throttle from \"lodash.throttle\";\r\nimport { PureComponent } from \"react\";\r\nimport { ErrorDialog } from \"../../components/ErrorDialog\";\r\nimport { APP_NAME, ENV, EVENT } from \"../../constants\";\r\nimport { getSceneVersion } from \"../../packages/excalidraw/index\";\r\nimport { preventUnload, resolvablePromise, withBatchedUpdates, } from \"../../utils\";\r\nimport { FILE_UPLOAD_MAX_BYTES, FIREBASE_STORAGE_PREFIXES, INITIAL_SCENE_UPDATE_TIMEOUT, LOAD_IMAGES_TIMEOUT, SCENE, SYNC_FULL_SCENE_INTERVAL_MS, } from \"../app_constants\";\r\nimport { decryptAESGEM, generateCollaborationLinkData, getCollaborationLink, SOCKET_SERVER, } from \"../data\";\r\nimport { isSavedToFirebase, loadFilesFromFirebase, loadFromFirebase, saveFilesToFirebase, saveToFirebase, } from \"../data/firebase\";\r\nimport { importUsernameFromLocalStorage, saveUsernameToLocalStorage, STORAGE_KEYS, } from \"../data/localStorage\";\r\nimport Portal from \"./Portal\";\r\nimport RoomDialog from \"./RoomDialog\";\r\nimport { createInverseContext } from \"../../createInverseContext\";\r\nimport { t } from \"../../i18n\";\r\nimport { UserIdleState } from \"../../types\";\r\nimport { IDLE_THRESHOLD, ACTIVE_THRESHOLD } from \"../../constants\";\r\nimport { trackEvent } from \"../../analytics\";\r\nimport { isInvisiblySmallElement } from \"../../element\";\r\nimport { encodeFilesForUpload, FileManager, updateStaleImageStatuses, } from \"../data/FileManager\";\r\nimport { AbortError } from \"../../errors\";\r\nimport { isImageElement, isInitializedImageElement, } from \"../../element/typeChecks\";\r\nimport { newElementWith } from \"../../element/mutateElement\";\r\nimport { reconcileElements as _reconcileElements, } from \"./reconciliation\";\r\nconst { Context: CollabContext, Consumer: CollabContextConsumer, Provider: CollabContextProvider, } = createInverseContext({ api: null });\r\nexport { CollabContext, CollabContextConsumer };\r\nclass CollabWrapper extends PureComponent {\r\n    constructor(props) {\r\n        super(props);\r\n        this.isCollaborating = false;\r\n        this.lastBroadcastedOrReceivedSceneVersion = -1;\r\n        this.collaborators = new Map();\r\n        this.onUnload = () => {\r\n            this.destroySocketClient({ isUnload: true });\r\n        };\r\n        this.beforeUnload = withBatchedUpdates((event) => {\r\n            const syncableElements = this.getSyncableElements(this.getSceneElementsIncludingDeleted());\r\n            if (this.isCollaborating &&\r\n                (this.fileManager.shouldPreventUnload(syncableElements) ||\r\n                    !isSavedToFirebase(this.portal, syncableElements))) {\r\n                // this won't run in time if user decides to leave the site, but\r\n                //  the purpose is to run in immediately after user decides to stay\r\n                this.saveCollabRoomToFirebase(syncableElements);\r\n                preventUnload(event);\r\n            }\r\n            if (this.isCollaborating || this.portal.roomId) {\r\n                try {\r\n                    localStorage?.setItem(STORAGE_KEYS.LOCAL_STORAGE_KEY_COLLAB_FORCE_FLAG, JSON.stringify({\r\n                        timestamp: Date.now(),\r\n                        room: this.portal.roomId,\r\n                    }));\r\n                }\r\n                catch { }\r\n            }\r\n        });\r\n        this.saveCollabRoomToFirebase = async (syncableElements = this.getSyncableElements(this.excalidrawAPI.getSceneElementsIncludingDeleted())) => {\r\n            try {\r\n                await saveToFirebase(this.portal, syncableElements);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n        this.openPortal = async () => {\r\n            trackEvent(\"share\", \"room creation\");\r\n            return this.initializeSocketClient(null);\r\n        };\r\n        this.closePortal = () => {\r\n            this.queueBroadcastAllElements.cancel();\r\n            this.loadImageFiles.cancel();\r\n            this.saveCollabRoomToFirebase();\r\n            if (window.confirm(t(\"alerts.collabStopOverridePrompt\"))) {\r\n                window.history.pushState({}, APP_NAME, window.location.origin);\r\n                this.destroySocketClient();\r\n                trackEvent(\"share\", \"room closed\");\r\n                this.props.onRoomClose?.();\r\n                const elements = this.excalidrawAPI\r\n                    .getSceneElementsIncludingDeleted()\r\n                    .map((element) => {\r\n                    if (isImageElement(element) && element.status === \"saved\") {\r\n                        return newElementWith(element, { status: \"pending\" });\r\n                    }\r\n                    return element;\r\n                });\r\n                this.excalidrawAPI.updateScene({\r\n                    elements,\r\n                    commitToHistory: false,\r\n                });\r\n            }\r\n        };\r\n        this.destroySocketClient = (opts) => {\r\n            if (!opts?.isUnload) {\r\n                this.collaborators = new Map();\r\n                this.excalidrawAPI.updateScene({\r\n                    collaborators: this.collaborators,\r\n                });\r\n                this.setState({\r\n                    activeRoomLink: \"\",\r\n                });\r\n                this.isCollaborating = false;\r\n            }\r\n            this.lastBroadcastedOrReceivedSceneVersion = -1;\r\n            this.portal.close();\r\n            this.fileManager.reset();\r\n        };\r\n        this.fetchImageFilesFromFirebase = async (scene) => {\r\n            const unfetchedImages = scene.elements\r\n                .filter((element) => {\r\n                return (isInitializedImageElement(element) &&\r\n                    !this.fileManager.isFileHandled(element.fileId) &&\r\n                    !element.isDeleted &&\r\n                    element.status === \"saved\");\r\n            })\r\n                .map((element) => element.fileId);\r\n            return await this.fileManager.getFiles(unfetchedImages);\r\n        };\r\n        this.initializeSocketClient = async (existingRoomLinkData) => {\r\n            if (this.portal.socket) {\r\n                return null;\r\n            }\r\n            let roomId;\r\n            let roomKey;\r\n            if (existingRoomLinkData) {\r\n                ({ roomId, roomKey } = existingRoomLinkData);\r\n            }\r\n            else {\r\n                ({ roomId, roomKey } = await generateCollaborationLinkData());\r\n                window.history.pushState({}, APP_NAME, getCollaborationLink({ roomId, roomKey }));\r\n            }\r\n            const scenePromise = resolvablePromise();\r\n            this.isCollaborating = true;\r\n            const { default: socketIOClient } = await import(\r\n            /* webpackChunkName: \"socketIoClient\" */ \"socket.io-client\");\r\n            this.portal.open(socketIOClient(SOCKET_SERVER), roomId, roomKey);\r\n            if (existingRoomLinkData) {\r\n                this.excalidrawAPI.resetScene();\r\n                try {\r\n                    const elements = await loadFromFirebase(roomId, roomKey, this.portal.socket);\r\n                    if (elements) {\r\n                        scenePromise.resolve({\r\n                            elements,\r\n                            scrollToContent: true,\r\n                        });\r\n                    }\r\n                }\r\n                catch (error) {\r\n                    // log the error and move on. other peers will sync us the scene.\r\n                    console.error(error);\r\n                }\r\n            }\r\n            else {\r\n                const elements = this.excalidrawAPI.getSceneElements().map((element) => {\r\n                    if (isImageElement(element) && element.status === \"saved\") {\r\n                        return newElementWith(element, { status: \"pending\" });\r\n                    }\r\n                    return element;\r\n                });\r\n                // remove deleted elements from elements array & history to ensure we don't\r\n                // expose potentially sensitive user data in case user manually deletes\r\n                // existing elements (or clears scene), which would otherwise be persisted\r\n                // to database even if deleted before creating the room.\r\n                this.excalidrawAPI.history.clear();\r\n                this.excalidrawAPI.updateScene({\r\n                    elements,\r\n                    commitToHistory: true,\r\n                });\r\n                this.broadcastElements(elements);\r\n                const syncableElements = this.getSyncableElements(elements);\r\n                this.saveCollabRoomToFirebase(syncableElements);\r\n            }\r\n            // fallback in case you're not alone in the room but still don't receive\r\n            // initial SCENE_UPDATE message\r\n            this.socketInitializationTimer = window.setTimeout(() => {\r\n                this.initializeSocket();\r\n                scenePromise.resolve(null);\r\n            }, INITIAL_SCENE_UPDATE_TIMEOUT);\r\n            // All socket listeners are moving to Portal\r\n            this.portal.socket.on(\"client-broadcast\", async (encryptedData, iv) => {\r\n                if (!this.portal.roomKey) {\r\n                    return;\r\n                }\r\n                const decryptedData = await decryptAESGEM(encryptedData, this.portal.roomKey, iv);\r\n                switch (decryptedData.type) {\r\n                    case \"INVALID_RESPONSE\":\r\n                        return;\r\n                    case SCENE.INIT: {\r\n                        if (!this.portal.socketInitialized) {\r\n                            this.initializeSocket();\r\n                            const remoteElements = decryptedData.payload.elements;\r\n                            const reconciledElements = this.reconcileElements(remoteElements);\r\n                            this.handleRemoteSceneUpdate(reconciledElements, {\r\n                                init: true,\r\n                            });\r\n                            // noop if already resolved via init from firebase\r\n                            scenePromise.resolve({\r\n                                elements: reconciledElements,\r\n                                scrollToContent: true,\r\n                            });\r\n                        }\r\n                        break;\r\n                    }\r\n                    case SCENE.UPDATE:\r\n                        this.handleRemoteSceneUpdate(this.reconcileElements(decryptedData.payload.elements));\r\n                        break;\r\n                    case \"MOUSE_LOCATION\": {\r\n                        const { pointer, button, username, selectedElementIds } = decryptedData.payload;\r\n                        const socketId = decryptedData.payload.socketId ||\r\n                            // @ts-ignore legacy, see #2094 (#2097)\r\n                            decryptedData.payload.socketID;\r\n                        const collaborators = new Map(this.collaborators);\r\n                        const user = collaborators.get(socketId) || {};\r\n                        user.pointer = pointer;\r\n                        user.button = button;\r\n                        user.selectedElementIds = selectedElementIds;\r\n                        user.username = username;\r\n                        collaborators.set(socketId, user);\r\n                        this.excalidrawAPI.updateScene({\r\n                            collaborators,\r\n                        });\r\n                        break;\r\n                    }\r\n                    case \"IDLE_STATUS\": {\r\n                        const { userState, socketId, username } = decryptedData.payload;\r\n                        const collaborators = new Map(this.collaborators);\r\n                        const user = collaborators.get(socketId) || {};\r\n                        user.userState = userState;\r\n                        user.username = username;\r\n                        this.excalidrawAPI.updateScene({\r\n                            collaborators,\r\n                        });\r\n                        break;\r\n                    }\r\n                }\r\n            });\r\n            this.portal.socket.on(\"first-in-room\", () => {\r\n                if (this.portal.socket) {\r\n                    this.portal.socket.off(\"first-in-room\");\r\n                }\r\n                this.initializeSocket();\r\n                scenePromise.resolve(null);\r\n            });\r\n            this.initializeIdleDetector();\r\n            this.setState({\r\n                activeRoomLink: window.location.href,\r\n            });\r\n            return scenePromise;\r\n        };\r\n        this.initializeSocket = () => {\r\n            this.portal.socketInitialized = true;\r\n            clearTimeout(this.socketInitializationTimer);\r\n        };\r\n        this.reconcileElements = (remoteElements) => {\r\n            const localElements = this.getSceneElementsIncludingDeleted();\r\n            const appState = this.excalidrawAPI.getAppState();\r\n            const reconciledElements = _reconcileElements(localElements, remoteElements, appState);\r\n            // Avoid broadcasting to the rest of the collaborators the scene\r\n            // we just received!\r\n            // Note: this needs to be set before updating the scene as it\r\n            // synchronously calls render.\r\n            this.setLastBroadcastedOrReceivedSceneVersion(getSceneVersion(reconciledElements));\r\n            return reconciledElements;\r\n        };\r\n        this.loadImageFiles = throttle(async () => {\r\n            const { loadedFiles, erroredFiles } = await this.fetchImageFilesFromFirebase({\r\n                elements: this.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n            });\r\n            this.excalidrawAPI.addFiles(loadedFiles);\r\n            updateStaleImageStatuses({\r\n                excalidrawAPI: this.excalidrawAPI,\r\n                erroredFiles,\r\n                elements: this.excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n            });\r\n        }, LOAD_IMAGES_TIMEOUT);\r\n        this.handleRemoteSceneUpdate = (elements, { init = false } = {}) => {\r\n            this.excalidrawAPI.updateScene({\r\n                elements,\r\n                commitToHistory: !!init,\r\n            });\r\n            // We haven't yet implemented multiplayer undo functionality, so we clear the undo stack\r\n            // when we receive any messages from another peer. This UX can be pretty rough -- if you\r\n            // undo, a user makes a change, and then try to redo, your element(s) will be lost. However,\r\n            // right now we think this is the right tradeoff.\r\n            this.excalidrawAPI.history.clear();\r\n            this.loadImageFiles();\r\n        };\r\n        this.onPointerMove = () => {\r\n            if (this.idleTimeoutId) {\r\n                window.clearTimeout(this.idleTimeoutId);\r\n                this.idleTimeoutId = null;\r\n            }\r\n            this.idleTimeoutId = window.setTimeout(this.reportIdle, IDLE_THRESHOLD);\r\n            if (!this.activeIntervalId) {\r\n                this.activeIntervalId = window.setInterval(this.reportActive, ACTIVE_THRESHOLD);\r\n            }\r\n        };\r\n        this.onVisibilityChange = () => {\r\n            if (document.hidden) {\r\n                if (this.idleTimeoutId) {\r\n                    window.clearTimeout(this.idleTimeoutId);\r\n                    this.idleTimeoutId = null;\r\n                }\r\n                if (this.activeIntervalId) {\r\n                    window.clearInterval(this.activeIntervalId);\r\n                    this.activeIntervalId = null;\r\n                }\r\n                this.onIdleStateChange(UserIdleState.AWAY);\r\n            }\r\n            else {\r\n                this.idleTimeoutId = window.setTimeout(this.reportIdle, IDLE_THRESHOLD);\r\n                this.activeIntervalId = window.setInterval(this.reportActive, ACTIVE_THRESHOLD);\r\n                this.onIdleStateChange(UserIdleState.ACTIVE);\r\n            }\r\n        };\r\n        this.reportIdle = () => {\r\n            this.onIdleStateChange(UserIdleState.IDLE);\r\n            if (this.activeIntervalId) {\r\n                window.clearInterval(this.activeIntervalId);\r\n                this.activeIntervalId = null;\r\n            }\r\n        };\r\n        this.reportActive = () => {\r\n            this.onIdleStateChange(UserIdleState.ACTIVE);\r\n        };\r\n        this.initializeIdleDetector = () => {\r\n            document.addEventListener(EVENT.POINTER_MOVE, this.onPointerMove);\r\n            document.addEventListener(EVENT.VISIBILITY_CHANGE, this.onVisibilityChange);\r\n        };\r\n        this.setLastBroadcastedOrReceivedSceneVersion = (version) => {\r\n            this.lastBroadcastedOrReceivedSceneVersion = version;\r\n        };\r\n        this.getLastBroadcastedOrReceivedSceneVersion = () => {\r\n            return this.lastBroadcastedOrReceivedSceneVersion;\r\n        };\r\n        this.getSceneElementsIncludingDeleted = () => {\r\n            return this.excalidrawAPI.getSceneElementsIncludingDeleted();\r\n        };\r\n        this.onPointerUpdate = (payload) => {\r\n            payload.pointersMap.size < 2 &&\r\n                this.portal.socket &&\r\n                this.portal.broadcastMouseLocation(payload);\r\n        };\r\n        this.onIdleStateChange = (userState) => {\r\n            this.setState({ userState });\r\n            this.portal.broadcastIdleChange(userState);\r\n        };\r\n        this.broadcastElements = (elements) => {\r\n            if (getSceneVersion(elements) >\r\n                this.getLastBroadcastedOrReceivedSceneVersion()) {\r\n                this.portal.broadcastScene(SCENE.UPDATE, elements, false);\r\n                this.lastBroadcastedOrReceivedSceneVersion = getSceneVersion(elements);\r\n                this.queueBroadcastAllElements();\r\n            }\r\n        };\r\n        this.queueBroadcastAllElements = throttle(() => {\r\n            this.portal.broadcastScene(SCENE.UPDATE, this.excalidrawAPI.getSceneElementsIncludingDeleted(), true);\r\n            const currentVersion = this.getLastBroadcastedOrReceivedSceneVersion();\r\n            const newVersion = Math.max(currentVersion, getSceneVersion(this.getSceneElementsIncludingDeleted()));\r\n            this.setLastBroadcastedOrReceivedSceneVersion(newVersion);\r\n        }, SYNC_FULL_SCENE_INTERVAL_MS);\r\n        this.handleClose = () => {\r\n            this.setState({ modalIsShown: false });\r\n        };\r\n        this.onUsernameChange = (username) => {\r\n            this.setState({ username });\r\n            saveUsernameToLocalStorage(username);\r\n        };\r\n        this.onCollabButtonClick = () => {\r\n            this.setState({\r\n                modalIsShown: true,\r\n            });\r\n        };\r\n        this.isSyncableElement = (element) => {\r\n            return element.isDeleted || !isInvisiblySmallElement(element);\r\n        };\r\n        this.getSyncableElements = (elements) => elements.filter((element) => this.isSyncableElement(element));\r\n        /** PRIVATE. Use `this.getContextValue()` instead. */\r\n        this.contextValue = null;\r\n        /** Getter of context value. Returned object is stable. */\r\n        this.getContextValue = () => {\r\n            if (!this.contextValue) {\r\n                this.contextValue = {};\r\n            }\r\n            this.contextValue.isCollaborating = () => this.isCollaborating;\r\n            this.contextValue.username = this.state.username;\r\n            this.contextValue.onPointerUpdate = this.onPointerUpdate;\r\n            this.contextValue.initializeSocketClient = this.initializeSocketClient;\r\n            this.contextValue.onCollabButtonClick = this.onCollabButtonClick;\r\n            this.contextValue.broadcastElements = this.broadcastElements;\r\n            this.contextValue.fetchImageFilesFromFirebase =\r\n                this.fetchImageFilesFromFirebase;\r\n            return this.contextValue;\r\n        };\r\n        this.state = {\r\n            modalIsShown: false,\r\n            errorMessage: \"\",\r\n            username: importUsernameFromLocalStorage() || \"\",\r\n            userState: UserIdleState.ACTIVE,\r\n            activeRoomLink: \"\",\r\n        };\r\n        this.portal = new Portal(this);\r\n        this.fileManager = new FileManager({\r\n            getFiles: async (fileIds) => {\r\n                const { roomId, roomKey } = this.portal;\r\n                if (!roomId || !roomKey) {\r\n                    throw new AbortError();\r\n                }\r\n                return loadFilesFromFirebase(`files/rooms/${roomId}`, roomKey, fileIds);\r\n            },\r\n            saveFiles: async ({ addedFiles }) => {\r\n                const { roomId, roomKey } = this.portal;\r\n                if (!roomId || !roomKey) {\r\n                    throw new AbortError();\r\n                }\r\n                return saveFilesToFirebase({\r\n                    prefix: `${FIREBASE_STORAGE_PREFIXES.collabFiles}/${roomId}`,\r\n                    files: await encodeFilesForUpload({\r\n                        files: addedFiles,\r\n                        encryptionKey: roomKey,\r\n                        maxBytes: FILE_UPLOAD_MAX_BYTES,\r\n                    }),\r\n                });\r\n            },\r\n        });\r\n        this.excalidrawAPI = props.excalidrawAPI;\r\n        this.activeIntervalId = null;\r\n        this.idleTimeoutId = null;\r\n    }\r\n    componentDidMount() {\r\n        window.addEventListener(EVENT.BEFORE_UNLOAD, this.beforeUnload);\r\n        window.addEventListener(EVENT.UNLOAD, this.onUnload);\r\n        if (process.env.NODE_ENV === ENV.TEST ||\r\n            process.env.NODE_ENV === ENV.DEVELOPMENT) {\r\n            window.collab = window.collab || {};\r\n            Object.defineProperties(window, {\r\n                collab: {\r\n                    configurable: true,\r\n                    value: this,\r\n                },\r\n            });\r\n        }\r\n    }\r\n    componentWillUnmount() {\r\n        window.removeEventListener(EVENT.BEFORE_UNLOAD, this.beforeUnload);\r\n        window.removeEventListener(EVENT.UNLOAD, this.onUnload);\r\n        window.removeEventListener(EVENT.POINTER_MOVE, this.onPointerMove);\r\n        window.removeEventListener(EVENT.VISIBILITY_CHANGE, this.onVisibilityChange);\r\n        if (this.activeIntervalId) {\r\n            window.clearInterval(this.activeIntervalId);\r\n            this.activeIntervalId = null;\r\n        }\r\n        if (this.idleTimeoutId) {\r\n            window.clearTimeout(this.idleTimeoutId);\r\n            this.idleTimeoutId = null;\r\n        }\r\n    }\r\n    setCollaborators(sockets) {\r\n        this.setState((state) => {\r\n            const collaborators = new Map();\r\n            for (const socketId of sockets) {\r\n                if (this.collaborators.has(socketId)) {\r\n                    collaborators.set(socketId, this.collaborators.get(socketId));\r\n                }\r\n                else {\r\n                    collaborators.set(socketId, {});\r\n                }\r\n            }\r\n            this.collaborators = collaborators;\r\n            this.excalidrawAPI.updateScene({ collaborators });\r\n        });\r\n    }\r\n    render() {\r\n        const { modalIsShown, username, errorMessage, activeRoomLink } = this.state;\r\n        return (<>\r\n        {modalIsShown && (<RoomDialog handleClose={this.handleClose} activeRoomLink={activeRoomLink} username={username} onUsernameChange={this.onUsernameChange} onRoomCreate={this.openPortal} onRoomDestroy={this.closePortal} setErrorMessage={(errorMessage) => {\r\n                    this.setState({ errorMessage });\r\n                }} theme={this.excalidrawAPI.getAppState().theme}/>)}\r\n        {errorMessage && (<ErrorDialog message={errorMessage} onClose={() => this.setState({ errorMessage: \"\" })}/>)}\r\n        <CollabContextProvider value={{\r\n                api: this.getContextValue(),\r\n            }}/>\r\n      </>);\r\n    }\r\n}\r\nif (process.env.NODE_ENV === ENV.TEST ||\r\n    process.env.NODE_ENV === ENV.DEVELOPMENT) {\r\n    window.collab = window.collab || {};\r\n}\r\nexport default CollabWrapper;\r\n","import React from \"react\";\r\nexport const createInverseContext = (initialValue) => {\r\n    const Context = React.createContext(initialValue);\r\n    class InverseConsumer extends React.Component {\r\n        constructor(props) {\r\n            super(props);\r\n            this.state = { value: initialValue };\r\n            Context._updateProviderValue = (value) => this.setState({ value });\r\n        }\r\n        render() {\r\n            return (<Context.Provider value={this.state.value}>\r\n          {this.props.children}\r\n        </Context.Provider>);\r\n        }\r\n    }\r\n    class InverseProvider extends React.Component {\r\n        componentDidMount() {\r\n            Context._updateProviderValue?.(this.props.value);\r\n        }\r\n        componentDidUpdate() {\r\n            Context._updateProviderValue?.(this.props.value);\r\n        }\r\n        render() {\r\n            return <Context.Consumer>{() => this.props.children}</Context.Consumer>;\r\n        }\r\n    }\r\n    return {\r\n        Context,\r\n        Consumer: InverseConsumer,\r\n        Provider: InverseProvider,\r\n    };\r\n};\r\n","import React from \"react\";\r\nimport * as i18n from \"../../i18n\";\r\nexport const LanguageList = ({ onChange, languages = i18n.languages, currentLangCode = i18n.getLanguage().code, }) => (<React.Fragment>\r\n    <select className=\"dropdown-select dropdown-select__language\" onChange={({ target }) => onChange(target.value)} value={currentLangCode} aria-label={i18n.t(\"buttons.selectLanguage\")}>\r\n      <option key={i18n.defaultLang.code} value={i18n.defaultLang.code}>\r\n        {i18n.defaultLang.label}\r\n      </option>\r\n      {languages.map((lang) => (<option key={lang.code} value={lang.code}>\r\n          {lang.label}\r\n        </option>))}\r\n    </select>\r\n  </React.Fragment>);\r\n","import { useEffect, useState } from \"react\";\r\nimport { debounce, getVersion, nFormatter } from \"../utils\";\r\nimport { getElementsStorageSize, getTotalStorageSize, } from \"./data/localStorage\";\r\nimport { DEFAULT_VERSION } from \"../constants\";\r\nimport { t } from \"../i18n\";\r\nimport { copyTextToSystemClipboard } from \"../clipboard\";\r\nconst STORAGE_SIZE_TIMEOUT = 500;\r\nconst getStorageSizes = debounce((cb) => {\r\n    cb({\r\n        scene: getElementsStorageSize(),\r\n        total: getTotalStorageSize(),\r\n    });\r\n}, STORAGE_SIZE_TIMEOUT);\r\nconst CustomStats = (props) => {\r\n    const [storageSizes, setStorageSizes] = useState({\r\n        scene: 0,\r\n        total: 0,\r\n    });\r\n    useEffect(() => {\r\n        getStorageSizes((sizes) => {\r\n            setStorageSizes(sizes);\r\n        });\r\n    });\r\n    useEffect(() => () => getStorageSizes.cancel(), []);\r\n    const version = getVersion();\r\n    let hash;\r\n    let timestamp;\r\n    if (version !== DEFAULT_VERSION) {\r\n        timestamp = version.slice(0, 16).replace(\"T\", \" \");\r\n        hash = version.slice(21);\r\n    }\r\n    else {\r\n        timestamp = t(\"stats.versionNotAvailable\");\r\n    }\r\n    return (<>\r\n      <tr>\r\n        <th colSpan={2}>{t(\"stats.storage\")}</th>\r\n      </tr>\r\n      <tr>\r\n        <td>{t(\"stats.scene\")}</td>\r\n        <td>{nFormatter(storageSizes.scene, 1)}</td>\r\n      </tr>\r\n      <tr>\r\n        <td>{t(\"stats.total\")}</td>\r\n        <td>{nFormatter(storageSizes.total, 1)}</td>\r\n      </tr>\r\n      <tr>\r\n        <th colSpan={2}>{t(\"stats.version\")}</th>\r\n      </tr>\r\n      <tr>\r\n        <td colSpan={2} style={{ textAlign: \"center\", cursor: \"pointer\" }} onClick={async () => {\r\n            try {\r\n                await copyTextToSystemClipboard(getVersion());\r\n                props.setToastMessage(t(\"toast.copyToClipboard\"));\r\n            }\r\n            catch { }\r\n        }} title={t(\"stats.versionCopy\")}>\r\n          {timestamp}\r\n          <br />\r\n          {hash}\r\n        </td>\r\n      </tr>\r\n    </>);\r\n};\r\nexport default CustomStats;\r\n","import { createIcon } from \"../../components/icons\";\r\nexport const excalidrawPlusIcon = createIcon(<>\r\n    <path d=\"M72.652 63.598c-1.368.91-1.191 2.833-.953 4.572.702 5.104.47 5.323 1.073 7.016.649 1.826.433 2.553-.08 3.292-.406.588-1.207 1.371-1.906 1.516-.98.204-2.967.01-3.922-.246-.643-.174-1.292-.94-1.598-1.53-.389-.751-1.256-1.951-.694-3.593.56-1.64 1.325-5.374 1.363-6.108.098-1.904.02-3.934-1.085-5.014-1.104-1.082-3.941-1.055-5.739-1.038-1.723.017-3.583 1.207-5.045 1.141-1.343-.061-2.939-.686-3.728-1.536-.79-.852-1.082-2.469-1.007-3.57.074-1.1.726-2.398 1.454-3.033.727-.635 1.91-.867 2.909-.777 1.472.13 4.1 1.342 5.928 1.564 1.67.203 4.016.501 5.04-.227 1.021-.73 1.048-2.717 1.094-4.145.07-2.063-1.021-6.528-.683-8.23.22-1.098 1.709-1.696 2.717-1.979 1.007-.282 2.521-.125 3.328.285.788.398 1.499 1.29 1.516 2.173.031 1.68-1.209 5.66-1.322 7.905-.058 1.133-.61 3.124.482 3.764 1.264.74 2.95 1.778 7.1.673 1.765-.47 3.157-.689 4.62-.622 1.342.06 2.939.685 3.728 1.536.787.85 1.08 2.468 1.006 3.568-.074 1.101-.726 2.4-1.454 3.035-.727.634-1.908.866-2.908.777-1.473-.13-3.164-.68-4.88-1.248-2.526-.835-5.176-.708-6.354.079z\" fill=\"currentColor\"/>\r\n    <path d=\"M51.396 25.807c0 .237-.285.474-.617.474-.284 0-1.09 1.328-1.708 2.941-1.897 4.934-20.873 42.46-20.92 41.273 0-.616-.285-1.043-.76-1.043-.664 0-.759.38-.474 2.23.284 2.134.095 2.609-6.642 15.702-3.795 7.448-7.875 15.228-9.06 17.316-1.234 2.182-2.183 4.554-2.278 5.55-.142 1.708.047 1.945 4.175 5.503 2.372 2.088 5.408 4.697 6.736 5.883 5.978 5.456 8.777 7.638 9.536 7.496 1.138-.19 18.739-18.644 18.786-19.688 0-.475-.854-7.685-1.898-16.035-1.802-14.232-3.51-30.884-3.32-32.497.142-.996-.57-6.024-1.092-8.207-.426-1.708-.237-2.42 3.179-10.2 1.992-4.601 4.602-10.247 5.74-12.524 1.091-2.277 2.04-4.27 2.04-4.412 0-.142-.332-.237-.711-.237-.38 0-.712.19-.712.475zM40.485 61.245c.522 3.32 1.565 11.29 2.324 17.695 1.47 11.765 3.179 24.811 3.653 28.132.285 1.66.095 1.992-2.989 5.408-5.36 6.025-11.053 11.955-12.998 13.473l-1.803 1.423-9.25-8.634c-8.54-7.875-9.252-8.681-8.73-9.63.285-.522 2.704-4.934 5.361-9.773 2.657-4.839 6.167-11.29 7.78-14.327 1.66-3.084 3.179-5.74 3.463-5.882.332-.19.427 4.601.332 14.8-.19 15.23-.142 15.277 1.376 14.945.19 0 .332-7.686.332-17.031V74.86l4.981-9.963c2.752-5.503 5.03-9.915 5.124-9.867.095.047.57 2.846 1.044 6.215zM20.228 3.842c-3.51 2.799-8.919 7.543-13.189 11.623l-3.368 3.178.617 4.175c.332 2.277.949 6.736 1.328 9.867.427 3.132.854 6.073.996 6.5.19.57 0 .854-.521.854-.902 0-.95-.237 1.518 7.59.901 2.989 1.755 5.74 1.85 6.025.095.332.474.474.901.332.427-.19.664-.57.522-.901-.142-.38.095-.76.474-.902.522-.19.475-.569-.332-1.945-1.28-2.134-4.554-20.352-4.744-26.234-.142-4.175-.142-4.222 1.613-6.594 1.708-2.325 5.646-5.835 11.718-10.295 1.708-1.28 3.416-2.704 3.89-3.178.712-.854 1.044-.617 7.021 5.74 3.463 3.653 7.306 7.4 8.54 8.35l2.277 1.707-1.756 3.7c-.948 1.993-4.791 9.678-8.586 16.984-7.923 15.37-6.31 13.9-15.513 14.043l-5.978.047-1.992 2.277c-2.088 2.42-2.372 3.32-1.376 4.839.38.522.664 1.376.664 1.898 0 .854.332.996 2.23 1.09 1.186.048 2.277.19 2.42.333.142.142.331 3.083.474 6.547l.19 6.262-3.179 6.831c-5.266 11.386-7.353 16.604-7.353 18.312 0 .901.19 1.66.38 1.66.474 0 .474-.047 19.782-40.324 8.966-18.691 17.458-36.292 18.881-39.185 1.423-2.894 2.704-5.55 2.799-5.93.095-.427-3.178-3.7-8.397-8.303-4.696-4.174-8.824-7.97-9.203-8.396-1.091-1.329-2.704-.902-5.598 1.423zm-2.372 62.147c-.38.996-1.376 3.083-2.183 4.649-1.328 2.656-1.47 2.751-1.802 1.66-.19-.664-.332-2.61-.38-4.364-.047-3.464-.142-3.416 3.843-3.653l1.28-.048-.758 1.756zm3.985-7.59c-2.183 4.221-2.277 4.269-8.255 4.553-5.266.285-5.36.238-5.36-.759 0-.569-.19-1.328-.428-1.708-.284-.426-.094-1.186.57-2.23l1.043-1.612h4.744c2.61-.048 5.598-.237 6.642-.427 1.044-.19 1.945-.285 2.04-.237.095.047-.38 1.138-.996 2.42zm-.19-43.266c-.854.616-1.091 1.233-1.091 2.799 0 1.85.142 2.134 1.423 2.656 1.28.522 1.613.475 3.084-.522 1.945-1.328 1.992-1.66.569-3.795-1.234-1.85-2.467-2.182-3.985-1.138z\" fill=\"currentColor\"/>\r\n    <path d=\"M50.141 24.917c.352-.615 1.06-1.085 1.967-1.085.804 0 1.477.34 1.734.597.342.342.477.74.477 1.14 0 .089-.006.305-.119.612-.168.461-1.056 2.337-2.08 4.471-1.131 2.264-3.724 7.875-5.708 12.457-1.671 3.806-2.558 5.881-2.97 7.216-.301.975-.279 1.406-.123 2.032.558 2.33 1.27 7.704 1.122 8.73-.187 1.596 1.537 18.06 3.32 32.136 1.056 8.446 1.91 15.74 1.91 16.22l-.002.07c-.009.184-.087.607-.447 1.14-.506.747-1.932 2.414-3.805 4.476-4.242 4.672-10.806 11.46-13.673 14.059-.682.617-1.199 1.023-1.472 1.182a1.872 1.872 0 01-.612.236c-.41.077-1.225-.015-2.35-.737-1.495-.959-4.19-3.217-8.46-7.114-1.327-1.184-4.36-3.79-6.718-5.865-1.712-1.476-2.767-2.405-3.411-3.096-.677-.727-.994-1.291-1.16-1.839-.165-.544-.18-1.09-.117-1.847.104-1.1 1.103-3.737 2.466-6.15 1.182-2.08 5.247-9.833 9.031-17.26 3.34-6.491 5.06-9.853 5.906-11.859.677-1.603.696-2.113.587-2.93-.18-1.168-.195-1.884-.111-2.308.1-.511.321-.851.58-1.1.346-.331.813-.55 1.488-.55.199 0 .391.024.574.07 4.068-7.268 18.093-35.143 19.705-39.334.585-1.53 1.353-2.823 1.794-3.288.228-.24.462-.39.677-.482zM38.72 59.573a448.835 448.835 0 00-3.06 5.995l-4.823 9.646v16.63c0 8.501-.124 15.643-.287 16.987-.142 1.166-1.002 1.462-1.384 1.526l.16-.017c-.671.147-1.214.135-1.647-.047-.495-.209-1.058-.629-1.33-1.813-.332-1.439-.336-5.202-.22-14.563.04-4.272.047-7.59.016-9.984-.33.582-.666 1.188-.986 1.783-1.615 3.04-5.13 9.5-7.79 14.345-2.383 4.34-4.576 8.338-5.207 9.493.131.186.356.489.61.77 1.165 1.287 3.451 3.428 7.667 7.316l8.316 7.76.798-.63c1.917-1.495 7.517-7.35 12.808-13.295.898-.995 1.544-1.72 2-2.29.37-.464.594-.76.675-1.06.067-.247.004-.478-.051-.8l-.007-.041c-.475-3.324-2.184-16.382-3.657-28.168-.757-6.384-1.797-14.328-2.317-17.639l-.004-.023c-.089-.635-.185-1.272-.28-1.881zM19.289 2.67c1.673-1.343 3-2.096 4.04-2.364 1.537-.394 2.687.004 3.621 1.119.396.44 4.46 4.165 9.071 8.264 4.274 3.769 7.265 6.676 8.244 7.909.69.868.68 1.598.625 1.844-.002.013-.006.026-.009.038-.1.398-1.416 3.195-2.908 6.228-1.423 2.893-9.912 20.488-18.875 39.173C7.581 97.252 4.465 103.75 3.6 105.058c-.497.751-.885.854-1.111.924a1.729 1.729 0 01-.526.076c-.42 0-.964-.148-1.368-.767-.223-.342-.511-1.288-.511-2.394 0-.606.19-1.592.67-3.03.955-2.866 3.1-7.864 6.821-15.911l3.03-6.513-.178-5.89a153.908 153.908 0 00-.33-5.346c-.352-.041-.773-.081-1.14-.096-.98-.049-1.616-.131-2.03-.261-.645-.204-1.016-.535-1.267-.928-.221-.348-.358-.79-.358-1.4 0-.282-.173-.735-.377-1.016l-.04-.059c-.621-.945-.859-1.757-.79-2.608.085-1.023.72-2.222 2.283-4.034l1.607-1.836c-.218-.687-.996-3.199-1.807-5.89-1.558-4.942-2.122-6.841-2.152-7.56-.034-.83.282-1.245.57-1.51a1.53 1.53 0 01.406-.265c-.217-1.235-.55-3.498-.875-5.878a488.89 488.89 0 00-1.323-9.829l-.617-4.175a1.5 1.5 0 01.455-1.31l3.361-3.172c4.301-4.11 9.749-8.888 13.287-11.709zm-3.879 71.31c-.31.283-.612.394-.858.441a1.547 1.547 0 01-1.04-.132l.103 3.418v.018l1.795-3.746zm12.426 1.473a23.55 23.55 0 01-.225.553 43.912 43.912 0 01-.763 1.686c.328-.11.65-.094.966.015l.022.008v-2.262zm1.524-3.996l-.032.037a1.575 1.575 0 01-.862.5c.042.411.057.798 0 1.25l.894-1.787zM16.286 65.87c-.566.056-1.034.117-1.267.149-.014.118-.03.275-.035.408-.012.4-.001.889.007 1.466.006.237.014.477.024.716.49-.997.97-2.02 1.271-2.739zm4.486-3.076a4.31 4.31 0 01-.88.654c.136.22.21.469.22.721l.281-.585.38-.79zm-.299-5.017c-1.381.168-3.98.324-6.29.365h-3.956l-.594.92c-.19.298-.36.7-.429.874.215.444.399 1.073.478 1.666h.014c.771.012 1.964-.048 3.819-.148 2.63-.125 3.979-.11 4.898-.616.326-.18.561-.453.817-.83.374-.551.75-1.276 1.243-2.23zm4.52-3.77a6.345 6.345 0 01-1.098.892c.156.141.3.333.383.595l.714-1.487zm15.241-3.122c-.47.934-.941 1.866-1.41 2.789.6-.264 1.192-.034 1.288.014.079.04.308.15.517.425a27.335 27.335 0 00-.224-1.044c-.185-.74-.289-1.336-.17-2.184zM24.148 5.38c-.758.673-2.198 1.856-3.649 2.944-5.896 4.33-9.738 7.717-11.4 9.978-.594.803-.97 1.279-1.177 1.801-.316.802-.217 1.685-.143 3.852.132 4.065 1.762 14.092 3.157 20.466.555 2.535 1.023 4.46 1.383 5.059.528.9.771 1.5.842 1.889.088.484.016.86-.118 1.167a1.86 1.86 0 01-.27.446l2.687-.021c1.825-.028 3.22.008 4.349-.038.897-.038 1.587-.111 2.187-.396.71-.336 1.26-.968 1.948-2.018 1.313-2.003 2.904-5.314 5.721-10.782 3.785-7.286 7.618-14.95 8.563-16.935l1.23-2.593-1.311-.984c-1.258-.967-5.182-4.782-8.717-8.51-2.604-2.769-4.52-4.608-5.282-5.325zm-11.86 47.181l-.001-.003-.026-.064.027.067zm-1.503-1.764l.059-.024a1.07 1.07 0 00-.059.024zm42.106-24.884l-.002.022.001-.009.001-.013zm.003-.035l.002-.071-.002.071zM20.773 13.917c-1.241.896-1.713 1.74-1.713 4.015 0 1.663.252 2.444.727 3.002.334.391.822.714 1.63 1.043.743.303 1.275.437 1.771.44.735.005 1.457-.254 2.72-1.109 1.495-1.02 2.072-1.825 2.19-2.615.111-.744-.188-1.715-1.214-3.254-.872-1.307-1.805-2.006-2.727-2.266-1.036-.292-2.15-.105-3.356.723l-.028.02zm4.263 4.285c-.128-.242-.375-.69-.648-1.099-.4-.598-.691-1.03-1.123-1.056-.24-.015-.473.123-.744.308-.461.337-.461.721-.461 1.577 0 .417.04.883.058 1.064.1.052.282.142.431.203.283.115.47.216.66.218.084 0 .152-.057.255-.113.215-.115.46-.275.757-.476.311-.213.632-.472.815-.626zM19.293 2.669l-.005.003.005-.003z\" fill=\"currentColor\"/>\r\n  </>, { width: 89, height: 131, style: { transform: \"translateX(4px)\" } });\r\n","import React from \"react\";\r\nimport { Card } from \"../../components/Card\";\r\nimport { ToolButton } from \"../../components/ToolButton\";\r\nimport { serializeAsJSON } from \"../../data/json\";\r\nimport { loadFirebaseStorage, saveFilesToFirebase } from \"../data/firebase\";\r\nimport { nanoid } from \"nanoid\";\r\nimport { t } from \"../../i18n\";\r\nimport { excalidrawPlusIcon } from \"./icons\";\r\nimport { encryptData, generateEncryptionKey } from \"../../data/encryption\";\r\nimport { isInitializedImageElement } from \"../../element/typeChecks\";\r\nimport { FILE_UPLOAD_MAX_BYTES } from \"../app_constants\";\r\nimport { encodeFilesForUpload } from \"../data/FileManager\";\r\nimport { MIME_TYPES } from \"../../constants\";\r\nconst exportToExcalidrawPlus = async (elements, appState, files) => {\r\n    const firebase = await loadFirebaseStorage();\r\n    const id = `${nanoid(12)}`;\r\n    const encryptionKey = (await generateEncryptionKey());\r\n    const encryptedData = await encryptData(encryptionKey, serializeAsJSON(elements, appState, files, \"database\"));\r\n    const blob = new Blob([encryptedData.iv, new Uint8Array(encryptedData.encryptedBuffer)], {\r\n        type: MIME_TYPES.binary,\r\n    });\r\n    await firebase\r\n        .storage()\r\n        .ref(`/migrations/scenes/${id}`)\r\n        .put(blob, {\r\n        customMetadata: {\r\n            data: JSON.stringify({ version: 2, name: appState.name }),\r\n            created: Date.now().toString(),\r\n        },\r\n    });\r\n    const filesMap = new Map();\r\n    for (const element of elements) {\r\n        if (isInitializedImageElement(element) && files[element.fileId]) {\r\n            filesMap.set(element.fileId, files[element.fileId]);\r\n        }\r\n    }\r\n    if (filesMap.size) {\r\n        const filesToUpload = await encodeFilesForUpload({\r\n            files: filesMap,\r\n            encryptionKey,\r\n            maxBytes: FILE_UPLOAD_MAX_BYTES,\r\n        });\r\n        await saveFilesToFirebase({\r\n            prefix: `/migrations/files/scenes/${id}`,\r\n            files: filesToUpload,\r\n        });\r\n    }\r\n    window.open(`https://plus.excalidraw.com/import?excalidraw=${id},${encryptionKey}`);\r\n};\r\nexport const ExportToExcalidrawPlus = ({ elements, appState, files, onError }) => {\r\n    return (<Card color=\"indigo\">\r\n      <div className=\"Card-icon\">{excalidrawPlusIcon}</div>\r\n      <h2>Excalidraw+</h2>\r\n      <div className=\"Card-details\">\r\n        {t(\"exportDialog.excalidrawplus_description\")}\r\n      </div>\r\n      <ToolButton className=\"Card-button\" type=\"button\" title={t(\"exportDialog.excalidrawplus_button\")} aria-label={t(\"exportDialog.excalidrawplus_button\")} showAriaLabel={true} onClick={async () => {\r\n            try {\r\n                await exportToExcalidrawPlus(elements, appState, files);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n                if (error.name !== \"AbortError\") {\r\n                    onError(new Error(t(\"exportDialog.excalidrawplus_exportError\")));\r\n                }\r\n            }\r\n        }}/>\r\n    </Card>);\r\n};\r\n","import LanguageDetector from \"i18next-browser-languagedetector\";\r\nimport { useCallback, useContext, useEffect, useRef, useState } from \"react\";\r\nimport { trackEvent } from \"../analytics\";\r\nimport { getDefaultAppState } from \"../appState\";\r\nimport { ErrorDialog } from \"../components/ErrorDialog\";\r\nimport { TopErrorBoundary } from \"../components/TopErrorBoundary\";\r\nimport { APP_NAME, EVENT, STORAGE_KEYS, TITLE_TIMEOUT, URL_HASH_KEYS, VERSION_TIMEOUT, } from \"../constants\";\r\nimport { loadFromBlob } from \"../data/blob\";\r\nimport { useCallbackRefState } from \"../hooks/useCallbackRefState\";\r\nimport { t } from \"../i18n\";\r\nimport Excalidraw, { defaultLang, languages, } from \"../packages/excalidraw/index\";\r\nimport { debounce, getVersion, preventUnload, resolvablePromise, } from \"../utils\";\r\nimport { FIREBASE_STORAGE_PREFIXES, SAVE_TO_LOCAL_STORAGE_TIMEOUT, } from \"./app_constants\";\r\nimport CollabWrapper, { CollabContext, CollabContextConsumer, } from \"./collab/CollabWrapper\";\r\nimport { LanguageList } from \"./components/LanguageList\";\r\nimport { exportToBackend, getCollaborationLinkData, loadScene } from \"./data\";\r\nimport { importFromLocalStorage, saveToLocalStorage, } from \"./data/localStorage\";\r\nimport CustomStats from \"./CustomStats\";\r\nimport { restoreAppState } from \"../data/restore\";\r\nimport { Tooltip } from \"../components/Tooltip\";\r\nimport { shield } from \"../components/icons\";\r\nimport \"./index.scss\";\r\nimport { ExportToExcalidrawPlus } from \"./components/ExportToExcalidrawPlus\";\r\nimport { getMany, set, del, keys, createStore } from \"idb-keyval\";\r\nimport { FileManager, updateStaleImageStatuses } from \"./data/FileManager\";\r\nimport { newElementWith } from \"../element/mutateElement\";\r\nimport { isInitializedImageElement } from \"../element/typeChecks\";\r\nimport { loadFilesFromFirebase } from \"./data/firebase\";\r\nconst filesStore = createStore(\"files-db\", \"files-store\");\r\nconst clearObsoleteFilesFromIndexedDB = async (opts) => {\r\n    const allIds = await keys(filesStore);\r\n    for (const id of allIds) {\r\n        if (!opts.currentFileIds.includes(id)) {\r\n            del(id, filesStore);\r\n        }\r\n    }\r\n};\r\nconst localFileStorage = new FileManager({\r\n    getFiles(ids) {\r\n        return getMany(ids, filesStore).then((filesData) => {\r\n            const loadedFiles = [];\r\n            const erroredFiles = new Map();\r\n            filesData.forEach((data, index) => {\r\n                const id = ids[index];\r\n                if (data) {\r\n                    loadedFiles.push(data);\r\n                }\r\n                else {\r\n                    erroredFiles.set(id, true);\r\n                }\r\n            });\r\n            return { loadedFiles, erroredFiles };\r\n        });\r\n    },\r\n    async saveFiles({ addedFiles }) {\r\n        const savedFiles = new Map();\r\n        const erroredFiles = new Map();\r\n        await Promise.all([...addedFiles].map(async ([id, fileData]) => {\r\n            try {\r\n                await set(id, fileData, filesStore);\r\n                savedFiles.set(id, true);\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n                erroredFiles.set(id, true);\r\n            }\r\n        }));\r\n        return { savedFiles, erroredFiles };\r\n    },\r\n});\r\nconst languageDetector = new LanguageDetector();\r\nlanguageDetector.init({\r\n    languageUtils: {\r\n        formatLanguageCode: (langCode) => langCode,\r\n        isWhitelisted: () => true,\r\n    },\r\n    checkWhitelist: false,\r\n});\r\nconst saveDebounced = debounce(async (elements, appState, files, onFilesSaved) => {\r\n    saveToLocalStorage(elements, appState);\r\n    await localFileStorage.saveFiles({\r\n        elements,\r\n        files,\r\n    });\r\n    onFilesSaved();\r\n}, SAVE_TO_LOCAL_STORAGE_TIMEOUT);\r\nconst onBlur = () => {\r\n    saveDebounced.flush();\r\n};\r\nconst initializeScene = async (opts) => {\r\n    const searchParams = new URLSearchParams(window.location.search);\r\n    const id = searchParams.get(\"id\");\r\n    const jsonBackendMatch = window.location.hash.match(/^#json=([0-9]+),([a-zA-Z0-9_-]+)$/);\r\n    const externalUrlMatch = window.location.hash.match(/^#url=(.*)$/);\r\n    const localDataState = importFromLocalStorage();\r\n    let scene = await loadScene(null, null, localDataState);\r\n    let roomLinkData = getCollaborationLinkData(window.location.href);\r\n    const isExternalScene = !!(id || jsonBackendMatch || roomLinkData);\r\n    if (isExternalScene) {\r\n        if (\r\n        // don't prompt if scene is empty\r\n        !scene.elements.length ||\r\n            // don't prompt for collab scenes because we don't override local storage\r\n            roomLinkData ||\r\n            // otherwise, prompt whether user wants to override current scene\r\n            window.confirm(t(\"alerts.loadSceneOverridePrompt\"))) {\r\n            if (jsonBackendMatch) {\r\n                scene = await loadScene(jsonBackendMatch[1], jsonBackendMatch[2], localDataState);\r\n            }\r\n            scene.scrollToContent = true;\r\n            if (!roomLinkData) {\r\n                window.history.replaceState({}, APP_NAME, window.location.origin);\r\n            }\r\n        }\r\n        else {\r\n            // https://github.com/excalidraw/excalidraw/issues/1919\r\n            if (document.hidden) {\r\n                return new Promise((resolve, reject) => {\r\n                    window.addEventListener(\"focus\", () => initializeScene(opts).then(resolve).catch(reject), {\r\n                        once: true,\r\n                    });\r\n                });\r\n            }\r\n            roomLinkData = null;\r\n            window.history.replaceState({}, APP_NAME, window.location.origin);\r\n        }\r\n    }\r\n    else if (externalUrlMatch) {\r\n        window.history.replaceState({}, APP_NAME, window.location.origin);\r\n        const url = externalUrlMatch[1];\r\n        try {\r\n            const request = await fetch(window.decodeURIComponent(url));\r\n            const data = await loadFromBlob(await request.blob(), null, null);\r\n            if (!scene.elements.length ||\r\n                window.confirm(t(\"alerts.loadSceneOverridePrompt\"))) {\r\n                return { scene: data, isExternalScene };\r\n            }\r\n        }\r\n        catch (error) {\r\n            return {\r\n                scene: {\r\n                    appState: {\r\n                        errorMessage: t(\"alerts.invalidSceneUrl\"),\r\n                    },\r\n                },\r\n                isExternalScene,\r\n            };\r\n        }\r\n    }\r\n    if (roomLinkData) {\r\n        return {\r\n            scene: await opts.collabAPI.initializeSocketClient(roomLinkData),\r\n            isExternalScene: true,\r\n            id: roomLinkData.roomId,\r\n            key: roomLinkData.roomKey,\r\n        };\r\n    }\r\n    else if (scene) {\r\n        return isExternalScene && jsonBackendMatch\r\n            ? {\r\n                scene,\r\n                isExternalScene,\r\n                id: jsonBackendMatch[1],\r\n                key: jsonBackendMatch[2],\r\n            }\r\n            : { scene, isExternalScene: false };\r\n    }\r\n    return { scene: null, isExternalScene: false };\r\n};\r\n\r\nconst ExcalidrawWrapper = () => {\r\n    const [errorMessage, setErrorMessage] = useState(\"\");\r\n    let currentLangCode = languageDetector.detect() || defaultLang.code;\r\n    if (Array.isArray(currentLangCode)) {\r\n        currentLangCode = currentLangCode[0];\r\n    }\r\n    const [langCode, setLangCode] = useState(currentLangCode);\r\n    // initial state\r\n    // ---------------------------------------------------------------------------\r\n    const initialStatePromiseRef = useRef({ promise: null });\r\n    if (!initialStatePromiseRef.current.promise) {\r\n        initialStatePromiseRef.current.promise =\r\n            resolvablePromise();\r\n    }\r\n    useEffect(() => {\r\n        // Delayed so that the app has a time to load the latest SW\r\n        setTimeout(() => {\r\n            trackEvent(\"load\", \"version\", getVersion());\r\n        }, VERSION_TIMEOUT);\r\n    }, []);\r\n    const [excalidrawAPI, excalidrawRefCallback] = useCallbackRefState();\r\n    const collabAPI = useContext(CollabContext)?.api;\r\n    useEffect(() => {\r\n        if (!collabAPI || !excalidrawAPI) {\r\n            return;\r\n        }\r\n        const loadImages = (data, isInitialLoad = false) => {\r\n            if (!data.scene) {\r\n                return;\r\n            }\r\n            if (collabAPI.isCollaborating()) {\r\n                if (data.scene.elements) {\r\n                    collabAPI\r\n                        .fetchImageFilesFromFirebase({\r\n                        elements: data.scene.elements,\r\n                    })\r\n                        .then(({ loadedFiles, erroredFiles }) => {\r\n                        excalidrawAPI.addFiles(loadedFiles);\r\n                        updateStaleImageStatuses({\r\n                            excalidrawAPI,\r\n                            erroredFiles,\r\n                            elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                        });\r\n                    });\r\n                }\r\n            }\r\n            else {\r\n                const fileIds = data.scene.elements?.reduce((acc, element) => {\r\n                    if (isInitializedImageElement(element)) {\r\n                        return acc.concat(element.fileId);\r\n                    }\r\n                    return acc;\r\n                }, []) || [];\r\n                if (data.isExternalScene) {\r\n                    loadFilesFromFirebase(`${FIREBASE_STORAGE_PREFIXES.shareLinkFiles}/${data.id}`, data.key, fileIds).then(({ loadedFiles, erroredFiles }) => {\r\n                        excalidrawAPI.addFiles(loadedFiles);\r\n                        updateStaleImageStatuses({\r\n                            excalidrawAPI,\r\n                            erroredFiles,\r\n                            elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                        });\r\n                    });\r\n                }\r\n                else if (isInitialLoad) {\r\n                    if (fileIds.length) {\r\n                        localFileStorage\r\n                            .getFiles(fileIds)\r\n                            .then(({ loadedFiles, erroredFiles }) => {\r\n                            if (loadedFiles.length) {\r\n                                excalidrawAPI.addFiles(loadedFiles);\r\n                            }\r\n                            updateStaleImageStatuses({\r\n                                excalidrawAPI,\r\n                                erroredFiles,\r\n                                elements: excalidrawAPI.getSceneElementsIncludingDeleted(),\r\n                            });\r\n                        });\r\n                    }\r\n                    // on fresh load, clear unused files from IDB (from previous\r\n                    // session)\r\n                    clearObsoleteFilesFromIndexedDB({ currentFileIds: fileIds });\r\n                }\r\n            }\r\n            try {\r\n                data.scene.libraryItems =\r\n                    JSON.parse(localStorage.getItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY)) || [];\r\n            }\r\n            catch (error) {\r\n                console.error(error);\r\n            }\r\n        };\r\n        initializeScene({ collabAPI }).then((data) => {\r\n            loadImages(data, /* isInitialLoad */ true);\r\n            initialStatePromiseRef.current.promise.resolve(data.scene);\r\n        });\r\n        const onHashChange = (event) => {\r\n            event.preventDefault();\r\n            const hash = new URLSearchParams(window.location.hash.slice(1));\r\n            const libraryUrl = hash.get(URL_HASH_KEYS.addLibrary);\r\n            if (libraryUrl) {\r\n                // If hash changed and it contains library url, import it and replace\r\n                // the url to its previous state (important in case of collaboration\r\n                // and similar).\r\n                // Using history API won't trigger another hashchange.\r\n                window.history.replaceState({}, \"\", event.oldURL);\r\n                excalidrawAPI.importLibrary(libraryUrl, hash.get(\"token\"));\r\n            }\r\n            else {\r\n                initializeScene({ collabAPI }).then((data) => {\r\n                    loadImages(data);\r\n                    if (data.scene) {\r\n                        excalidrawAPI.updateScene({\r\n                            ...data.scene,\r\n                            appState: restoreAppState(data.scene.appState, null),\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        const titleTimeout = setTimeout(() => (document.title = APP_NAME), TITLE_TIMEOUT);\r\n        window.addEventListener(EVENT.HASHCHANGE, onHashChange, false);\r\n        window.addEventListener(EVENT.UNLOAD, onBlur, false);\r\n        window.addEventListener(EVENT.BLUR, onBlur, false);\r\n        return () => {\r\n            window.removeEventListener(EVENT.HASHCHANGE, onHashChange, false);\r\n            window.removeEventListener(EVENT.UNLOAD, onBlur, false);\r\n            window.removeEventListener(EVENT.BLUR, onBlur, false);\r\n            clearTimeout(titleTimeout);\r\n        };\r\n    }, [collabAPI, excalidrawAPI]);\r\n    useEffect(() => {\r\n        const unloadHandler = (event) => {\r\n            saveDebounced.flush();\r\n            if (excalidrawAPI &&\r\n                localFileStorage.shouldPreventUnload(excalidrawAPI.getSceneElements())) {\r\n                preventUnload(event);\r\n            }\r\n        };\r\n        window.addEventListener(EVENT.BEFORE_UNLOAD, unloadHandler);\r\n        return () => {\r\n            window.removeEventListener(EVENT.BEFORE_UNLOAD, unloadHandler);\r\n        };\r\n    }, [excalidrawAPI]);\r\n    useEffect(() => {\r\n        languageDetector.cacheUserLanguage(langCode);\r\n    }, [langCode]);\r\n    const onChange = (elements, appState, files) => {\r\n        if (collabAPI?.isCollaborating()) {\r\n            collabAPI.broadcastElements(elements);\r\n        }\r\n        else {\r\n            saveDebounced(elements, appState, files, () => {\r\n                if (excalidrawAPI) {\r\n                    let didChange = false;\r\n                    let pendingImageElement = appState.pendingImageElement;\r\n                    const elements = excalidrawAPI\r\n                        .getSceneElementsIncludingDeleted()\r\n                        .map((element) => {\r\n                        if (localFileStorage.shouldUpdateImageElementStatus(element)) {\r\n                            didChange = true;\r\n                            const newEl = newElementWith(element, { status: \"saved\" });\r\n                            if (pendingImageElement === element) {\r\n                                pendingImageElement = newEl;\r\n                            }\r\n                            return newEl;\r\n                        }\r\n                        return element;\r\n                    });\r\n                    if (didChange) {\r\n                        excalidrawAPI.updateScene({\r\n                            elements,\r\n                            appState: {\r\n                                pendingImageElement,\r\n                            },\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    const onExportToBackend = async (exportedElements, appState, files, canvas) => {\r\n        if (exportedElements.length === 0) {\r\n            return window.alert(t(\"alerts.cannotExportEmptyCanvas\"));\r\n        }\r\n        if (canvas) {\r\n            try {\r\n                await exportToBackend(exportedElements, {\r\n                    ...appState,\r\n                    viewBackgroundColor: appState.exportBackground\r\n                        ? appState.viewBackgroundColor\r\n                        : getDefaultAppState().viewBackgroundColor,\r\n                }, files);\r\n            }\r\n            catch (error) {\r\n                if (error.name !== \"AbortError\") {\r\n                    const { width, height } = canvas;\r\n                    console.error(error, { width, height });\r\n                    setErrorMessage(error.message);\r\n                }\r\n            }\r\n        }\r\n    };\r\n    const renderTopRightUI = useCallback((isMobile, appState) => {\r\n        if (isMobile) {\r\n            return null;\r\n        }\r\n        return (<div style={{\r\n                width: \"24ch\",\r\n                fontSize: \"0.7em\",\r\n                textAlign: \"center\",\r\n            }}>\r\n          {/* <GitHubCorner theme={appState.theme} dir={document.dir} /> */}\r\n          {/* FIXME remove after 2021-05-20 */}\r\n        </div>);\r\n    }, []);\r\n    const renderFooter = useCallback((isMobile) => {\r\n        const renderEncryptedIcon = () => (<a className=\"encrypted-icon tooltip\" href=\"https://blog.excalidraw.com/end-to-end-encryption/\" target=\"_blank\" rel=\"noopener noreferrer\" aria-label={t(\"encrypted.link\")}>\r\n          <Tooltip label={t(\"encrypted.tooltip\")} long={true}>\r\n            {shield}\r\n          </Tooltip>\r\n        </a>);\r\n        const renderLanguageList = () => (<LanguageList onChange={(langCode) => setLangCode(langCode)} languages={languages} currentLangCode={langCode}/>);\r\n        if (isMobile) {\r\n            const isTinyDevice = window.innerWidth < 362;\r\n            return (<div style={{\r\n                    display: \"flex\",\r\n                    flexDirection: isTinyDevice ? \"column\" : \"row\",\r\n                }}>\r\n            <fieldset>\r\n              <legend>{t(\"labels.language\")}</legend>\r\n              {renderLanguageList()}\r\n            </fieldset>\r\n            {/* FIXME remove after 2021-05-20 */}\r\n            <div style={{\r\n                    width: \"24ch\",\r\n                    fontSize: \"0.7em\",\r\n                    textAlign: \"center\",\r\n                    marginTop: isTinyDevice ? 16 : undefined,\r\n                    marginLeft: \"auto\",\r\n                    marginRight: isTinyDevice ? \"auto\" : undefined,\r\n                    padding: \"4px 2px\",\r\n                    border: \"1px dashed #aaa\",\r\n                    borderRadius: 12,\r\n                }}>\r\n              \r\n            </div>\r\n          </div>);\r\n        }\r\n        return (<>\r\n          {renderEncryptedIcon()}\r\n          {renderLanguageList()}\r\n        </>);\r\n    }, [langCode]);\r\n    const renderCustomStats = () => {\r\n        return (<CustomStats setToastMessage={(message) => excalidrawAPI.setToastMessage(message)}/>);\r\n    };\r\n    const onLibraryChange = async (items) => {\r\n        if (!items.length) {\r\n            localStorage.removeItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY);\r\n            return;\r\n        }\r\n        const serializedItems = JSON.stringify(items);\r\n        localStorage.setItem(STORAGE_KEYS.LOCAL_STORAGE_LIBRARY, serializedItems);\r\n    };\r\n    const onRoomClose = useCallback(() => {\r\n        localFileStorage.reset();\r\n    }, []);\r\n    return (<>\r\n      <Excalidraw ref={excalidrawRefCallback} onChange={onChange} initialData={initialStatePromiseRef.current.promise} onCollabButtonClick={collabAPI?.onCollabButtonClick} isCollaborating={collabAPI?.isCollaborating()} onPointerUpdate={collabAPI?.onPointerUpdate} UIOptions={{\r\n            canvasActions: {\r\n                export: {\r\n                    onExportToBackend,\r\n                    renderCustomUI: (elements, appState, files) => {\r\n                        return (<ExportToExcalidrawPlus elements={elements} appState={appState} files={files} onError={(error) => {\r\n                                excalidrawAPI?.updateScene({\r\n                                    appState: {\r\n                                        errorMessage: error.message,\r\n                                    },\r\n                                });\r\n                            }}/>);\r\n                    },\r\n                },\r\n            },\r\n        }} renderTopRightUI={renderTopRightUI} renderFooter={renderFooter} langCode={langCode} renderCustomStats={renderCustomStats} detectScroll={false} handleKeyboardGlobally={true} onLibraryChange={onLibraryChange} autoFocus={true}/>\r\n      {excalidrawAPI && (<CollabWrapper excalidrawAPI={excalidrawAPI} onRoomClose={onRoomClose}/>)}\r\n      {errorMessage && (<ErrorDialog message={errorMessage} onClose={() => setErrorMessage(\"\")}/>)}\r\n    </>);\r\n};\r\nconst ExcalidrawApp = () => {\r\n    return (<TopErrorBoundary>\r\n      <CollabContextConsumer>\r\n        <ExcalidrawWrapper />\r\n      </CollabContextConsumer>\r\n    </TopErrorBoundary>);\r\n};\r\nexport default ExcalidrawApp;\r\n","import * as Sentry from \"@sentry/browser\";\r\nimport * as SentryIntegrations from \"@sentry/integrations\";\r\nconst SentryEnvHostnameMap = {\r\n    \"excalidraw.com\": \"production\",\r\n    \"vercel.app\": \"staging\",\r\n};\r\nconst REACT_APP_DISABLE_SENTRY = process.env.REACT_APP_DISABLE_SENTRY === \"true\";\r\n// Disable Sentry locally or inside the Docker to avoid noise/respect privacy\r\nconst onlineEnv = !REACT_APP_DISABLE_SENTRY &&\r\n    Object.keys(SentryEnvHostnameMap).find((item) => window.location.hostname.indexOf(item) >= 0);\r\nSentry.init({\r\n    dsn: onlineEnv\r\n        ? \"https://7bfc596a5bf945eda6b660d3015a5460@sentry.io/5179260\"\r\n        : undefined,\r\n    environment: onlineEnv ? SentryEnvHostnameMap[onlineEnv] : undefined,\r\n    release: process.env.REACT_APP_GIT_SHA,\r\n    ignoreErrors: [\r\n        \"undefined is not an object (evaluating 'window.__pad.performLoop')\", // Only happens on Safari, but spams our servers. Doesn't break anything\r\n    ],\r\n    integrations: [\r\n        new SentryIntegrations.CaptureConsole({\r\n            levels: [\"error\"],\r\n        }),\r\n    ],\r\n    beforeSend(event) {\r\n        if (event.request?.url) {\r\n            event.request.url = event.request.url.replace(/#.*$/, \"\");\r\n        }\r\n        return event;\r\n    },\r\n});\r\n","import ExcalidrawApp from \"./excalidraw-app\";\r\n\r\nimport \"./excalidraw-app/sentry\";\r\nwindow.__EXCALIDRAW_SHA__ = process.env.REACT_APP_GIT_SHA;\r\n\r\nexport default ExcalidrawApp","const someJSCodeExample = ``;\r\n\r\nconst someCSSCodeExample = ``;\r\n\r\nconst someHTMLCodeExample = ``;\r\n\r\nconst someCCodeExample = ``;\r\n\r\nconst someCpp99CodeExample = ``\r\n\r\nconst someCppCodeExample = ``\r\n\r\nconst someCpp14CodeExample = ``\r\n\r\nconst someCpp17CodeExample = ``\r\n\r\nconst somePython2CodeExample = ``\r\n\r\nconst somePython3CodeExample = ``\r\n\r\nconst files = {\r\n  \"script.js\": {\r\n    name: \"script.js\",\r\n    language: \"javascript\",\r\n    value: someJSCodeExample\r\n  },\r\n  \"style.css\": {\r\n    name: \"style.css\",\r\n    language: \"css\",\r\n    value: someCSSCodeExample\r\n  },\r\n  \"index.html\": {\r\n    name: \"index.html\",\r\n    language: \"html\",\r\n    value: someHTMLCodeExample\r\n  },\r\n  \"c\": {\r\n    name: \"main.c\",\r\n    language: \"cpp\",\r\n    value: someCCodeExample\r\n  },\r\n  \"c99\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCpp99CodeExample\r\n  },\r\n  \"cpp\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCppCodeExample\r\n  },\r\n  \"cpp14\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCpp14CodeExample\r\n  },\r\n  \"cpp17\": {\r\n    name: \"main.cpp\",\r\n    language: \"cpp\",\r\n    value: someCpp17CodeExample\r\n  },\r\n  \"python2\": {\r\n    name: \"python\",\r\n    language: \"python\",\r\n    value: somePython2CodeExample\r\n  },\r\n  \"python3\": {\r\n    name: \"python\",\r\n    language: \"python\",\r\n    value: somePython3CodeExample\r\n  }\r\n};\r\n\r\nexport default files;\r\n","import React from \"react\";\r\nimport ReactModal from \"react-modal\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport Editor from \"@monaco-editor/react\";\r\nimport { js, css, html, outputModalTrue, outputModalFalse, setSrcDocs } from '../actions'\r\nimport files from \"../assets/files\"\r\nimport \"./style.css\"\r\n\r\nfunction TextEditor(props) {\r\n  const srcDoc = useSelector(state => state.srcDocs);\r\n  const modalActive = useSelector(state => state.outputModal);\r\n\r\n  const fileName = useSelector(state => state.fileName);\r\n  const dispatch = useDispatch();\r\n\r\n  const file = files[fileName];\r\n\r\n  function handleEditorChange(value) {\r\n    file.value = value;\r\n  }\r\n\r\n  const handleOutput = () => {\r\n    dispatch(setSrcDocs());\r\n    dispatch(outputModalTrue());\r\n    console.log(\"l\")\r\n  }\r\n\r\n  function handleCloseModal() {\r\n    dispatch(outputModalFalse());\r\n  }\r\n\r\n  return (\r\n    <div className = \"text-editor\">\r\n\r\n    {/* Sidebar   */}\r\n    <div className = \"editor-sidebar\">\r\n    <div className = \"sidebar-heading\">\r\n      <span id = \"explorer-spam\" >Explorer</span>\r\n      <button className = \"sidebar-add-file\">\r\n        {/* <i className = \"fas fa-plus\" style = {{color : \"#fffffe\" }}></i>  */}\r\n      </button>\r\n    </div>\r\n    <div className = \"sidebar-navbutton\">\r\n\r\n     <button\r\n        className = \"htmlfile\"\r\n        disabled={fileName === \"index.html\"}\r\n        onClick={() => dispatch(html()) }\r\n      >\r\n      <i className =\"fab fa-html5\"></i> <span className = \"buttontext html\" >{files[\"index.html\"].name} </span>\r\n     </button>\r\n\r\n     <button\r\n        className = \"cssfile\"\r\n        disabled={fileName === \"style.css\"}\r\n        onClick={() => dispatch(css())}\r\n      > \r\n      <i className = \"fab fa-css3-alt\"></i> <span className = \"buttontext style\" >{files[\"style.css\"].name} </span>\r\n      </button>\r\n\r\n      <button\r\n        className = \"jsfile\"\r\n        disabled={fileName === \"script.js\"}\r\n        onClick={() => dispatch(js())}\r\n      >\r\n      <i className=\"fab fa-js-square\"></i> <span className = \"buttontext script\" >{files[\"script.js\"].name} </span>\r\n      </button>\r\n\r\n\r\n    </div>\r\n    <div className = \"sidebar-footer\">\r\n    <button onClick={handleOutput} style = {{color : \"white\", backgroundColor: \"green\", padding: \"5px\", borderRadius: \"5px\"}} className=\"output\"><i style = {{color : \"white\"}} className=\"fas fa-play\"></i><span className = \"outputtext\" style = {{color : \"white\", backgroundColor: \"green\"}}> See Output</span></button>\r\n    </div>\r\n    </div>\r\n\r\n    {/* Editor */}\r\n    <div className = \"editor\">\r\n    <Editor\r\n            height=\"100vh\"\r\n            width=\"94vw\"\r\n            theme=\"vs-light\"\r\n            path={file.name}\r\n            defaultLanguage={file.language}\r\n            defaultValue={file.value}\r\n            saveViewState={true}\r\n            onChange={handleEditorChange}\r\n            cursorSmoothCaretAnimation = \"true\"\r\n            value={file.value}\r\n          />\r\n    </div>\r\n\r\n\r\n    <ReactModal\r\n            className=\"outputModal Modal\"\r\n            isOpen={modalActive}\r\n            contentLabel=\"onRequestClose Example\"\r\n            onRequestClose={handleCloseModal}\r\n            overlayClassName=\"Overlay\"\r\n            ariaHideApp={false}\r\n          >\r\n           \r\n            <div className=\"closeButton\"><i className=\"fas fa-window-close\" onClick={handleCloseModal}></i></div>\r\n            <iframe\r\n              srcDoc={srcDoc}\r\n              title=\"output\"\r\n              className=\"outputiframe\"\r\n              sandbox=\"allow-scripts\"\r\n              frameBorder=\"0\"\r\n            />\r\n          \r\n          </ReactModal>\r\n\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default TextEditor;\r\n","export const js = () => {\r\n    return {\r\n        type: \"js\"\r\n    };\r\n};\r\n\r\nexport const css = () => {\r\n    return {\r\n        type: \"css\"\r\n    };\r\n};\r\n\r\nexport const html = () => {\r\n    return {\r\n        type: \"html\"\r\n    };\r\n};\r\n\r\nexport const outputModalTrue = () => {\r\n    return {\r\n        type: \"outputtrue\"\r\n    };\r\n};\r\n\r\nexport const outputModalFalse = () => {\r\n    return {\r\n        type: \"outputfalse\"\r\n    };\r\n};\r\n\r\nexport const setSrcDocs = () => {\r\n    return {\r\n        type : \"setSrcdoc\",\r\n    }\r\n}\r\n\r\nexport const c = () => {\r\n    return {\r\n        type : \"c\",\r\n    }\r\n}\r\n\r\nexport const c99 = () => {\r\n    return {\r\n        type : \"c99\",\r\n    }\r\n}\r\n\r\nexport const cpp = () => {\r\n    return {\r\n        type : \"cpp\",\r\n    }\r\n}\r\n\r\nexport const cpp14 = () => {\r\n    return {\r\n        type : \"cpp14\",\r\n    }\r\n}\r\n\r\nexport const cpp17 = () => {\r\n    return {\r\n        type : \"cpp17\",\r\n    }\r\n}\r\n\r\nexport const python2 = () => {\r\n    return {\r\n        type : \"python2\",\r\n    }\r\n}\r\n\r\nexport const python3 = () => {\r\n    return {\r\n        type : \"python3\",\r\n    }\r\n}","import React, { useState, useEffect } from \"react\";\r\nimport Editor from \"@monaco-editor/react\";\r\nimport files from \"../assets/files\";\r\nimport { c, c99, cpp, cpp14, cpp17, python2, python3 } from \"../actions\";\r\nimport { useSelector, useDispatch } from \"react-redux\";\r\nimport { runCode } from \"../actions/outputAction\";\r\nimport \"./style.css\";\r\nfunction MultiFile(props) {\r\n  const [language, setLanguage] = useState(props.language);\r\n  const dispatch = useDispatch();\r\n  const [outputValue, setOutputValue] = useState(\"\");\r\n  const [inputValue, setInputValue] = useState(\"\");\r\n  const file = files[language];\r\n\r\n  function handleEditorChange(value) {\r\n    file.value = value;\r\n  }\r\n\r\n  function handleEditorWillMount(monaco) {\r\n    monaco.editor.defineTheme(\"my-cool-theme\", {\r\n      base: \"vs-dark\",\r\n      inherit: true,\r\n      rules: [],\r\n      colors: { \"editor.background\": \"#293738\" }\r\n    });\r\n  }\r\n\r\n  const languageList = {\r\n    \"Python 2\": \"python2\", \r\n    C: \"c\",\r\n    \"C-99\": \"c99\",\r\n    \"C++\": \"cpp\",\r\n    \"C++ 14\": \"cpp14\",\r\n    \"C++ 17\": \"cpp17\",\r\n    \"Python 3\": \"python3\",\r\n  };\r\n\r\n  // useEffect(() => {\r\n  //   const select = document.getElementsByClassName(\"language\")[0]\r\n  //   for (let key in languageList) {\r\n  //     var option = document.createElement(\"option\");\r\n  //     option.text = key;\r\n  //     option.value = languageList[key];\r\n  //     option.className = languageList[key];\r\n  //     select.add(option);\r\n  //   }\r\n\r\n  //   select.addEventListener(\"change\", (e) => {\r\n  //     setLanguage(select.value);\r\n  //     if (select.value === \"c\") {\r\n  //       dispatch(c());\r\n  //     }\r\n  //     if (select.value === \"c99\") {\r\n  //       dispatch(c99());\r\n  //     }\r\n  //     if (select.value === \"cpp\") {\r\n  //       dispatch(cpp());\r\n  //     }\r\n  //     if (select.value === \"cpp\") {\r\n  //       dispatch(cpp());\r\n  //     }\r\n  //     if (select.value === \"cpp14\") {\r\n  //       dispatch(cpp14());\r\n  //     }\r\n  //     if (select.value === \"cpp17\") {\r\n  //       dispatch(cpp17());\r\n  //     }\r\n  //     if (select.value === \"python2\") {\r\n  //       dispatch(python2());\r\n  //     }\r\n  //     if (select.value === \"python3\") {\r\n  //       dispatch(python3());\r\n  //     }\r\n  //   });\r\n  // }, []);\r\n\r\n  function userOutput(e) {\r\n    console.log(e);\r\n  }\r\n\r\n  function handleInput(e) {\r\n    setInputValue(e.target.value);\r\n  }\r\n\r\n  function handleOutput() {\r\n    const words = file.value.split(\"\\r\");\r\n    let code = \"\";\r\n    for (let i = 0; i < words.length; i++) {\r\n      code = code + words[i];\r\n    }\r\n    dispatch(runCode(language, code, inputValue)).then((e) => {\r\n      setOutputValue(e.data.output);\r\n      const data = {\r\n        output: e.data.output,\r\n      };\r\n      //creating a custom like predefined events like click or mousemove and more\r\n      const event = new CustomEvent(\"output\", { detail: data });\r\n      //dispatching the event in document.documentElement where we listen for it in while recording\r\n      document.documentElement.dispatchEvent(event);\r\n    });\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <div className=\"multilanguageIde\">\r\n        <div className=\"navbar\">\r\n        <div className=\"editor\">\r\n        <div className=\"navbar\">\r\n          <span className=\"fileName\">main \r\n          {language === \"python2\" || language === \"python3\" ? \".py\": \".cpp\"}\r\n          </span>\r\n          <div className=\"optionButton\">\r\n            <button\r\n              className=\"showCodeOutput\"\r\n              onClick={handleOutput}\r\n            >\r\n              <i class=\"fas fa-play\"></i> Execute\r\n            </button>\r\n          </div>\r\n        </div>\r\n          <Editor\r\n            height=\"96vh\"\r\n            width=\"80vw\"\r\n            theme=\"vs-light\"\r\n            language=\"python\"\r\n            options={{ fontSize: 18, fontWeight: 400, fontFamily: \"cursive\" }}\r\n            onChange={handleEditorChange}\r\n            value={file.value}\r\n            beforeMount={handleEditorWillMount}\r\n          />\r\n        </div>\r\n          <div className=\"inputOutput\">\r\n            <div className=\"inputArea\">\r\n              <h3>Input</h3>\r\n              <textarea\r\n                rows=\"20\"\r\n                cols=\"52\"\r\n                className=\"userInputArea\"\r\n                onChange={handleInput}\r\n                placeholder=\"Enter Input\"\r\n              ></textarea>\r\n            </div>\r\n            <div className=\"outputArea\">\r\n              <h3>Output</h3>\r\n              <textarea\r\n                rows=\"20\"\r\n                cols=\"52\"\r\n                className=\"userOutputArea\"\r\n                onChange={userOutput}\r\n                value={outputValue}\r\n              ></textarea>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default MultiFile;\r\n","import axios from \"axios\";\r\n\r\nconst env = process.env.NODE_ENV; // current environment\r\n\r\nexport const runCode = (language, code, input) => async dispatch => {\r\n    let url\r\n    if(env === \"development\") {\r\n        url = 'http://localhost:5000/'\r\n    }else{\r\n        url = 'https://fierce-reef-05156.herokuapp.com/' \r\n    }\r\n    return await axios.post( url+'api/compile', {\r\n        language: language, \r\n        stdin:input,\r\n        versionIndex: \"0\",\r\n        script:code\r\n    })\r\n}\r\n","import React from 'react';\r\nimport TextEditor from './TextEditor/TextEditor';\r\nimport MultiFile from './MultilanguageEditor/multiFile';\r\n\r\nfunction App(props) {\r\n  console.log(props)\r\n  return (\r\n    <>\r\n    {props.name === \"ide\" ? <TextEditor refresh = {props.refresh}/> :<MultiFile language={props.language} refresh = {props.refresh}/>}\r\n    </>\r\n  )\r\n}\r\n\r\nexport default App;","import React from \"react\";\r\nimport IDE from \"../IDE\";\r\nimport ChalkBoard from \"../ChalkBoard/index\";\r\nimport files from \"../assets/files\";\r\nimport MicRecorder from 'mic-recorder-to-mp3';\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore'\r\nimport 'firebase/storage';\r\nimport './style.css'\r\n\r\nvar startTime;\r\nexport default function Recorder(props) {\r\n  const name = props.location.state.lectureType\r\n  const language = props.location.state.languageType\r\n  console.log(name)\r\n  const Recording = { events: [] };\r\n  var lastMouse = {x : 0, y : 0};\r\n  var lastKey = \"\";\r\n  let fileName\r\n  if(name === \"dsa\"){\r\n    fileName= language\r\n  }else if(name=== \"ide\"){\r\n    fileName=\"index.html\"\r\n  }\r\n  let childValue;\r\n  var lastKeyClass = \"\";\r\n\r\n  function callbackFunction(childData){\r\n    childValue = childData\r\n    //console.log(childValue)\r\n  }\r\n  // Record each type of event\r\n  const handlers = [\r\n    {\r\n      eventName: \"mouseup\",\r\n      handler: function handleMouseMove(e) {\r\n        \r\n        Recording.events.push({\r\n          type: \"mouseup\",\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"mousedown\",\r\n      handler: function handleMouseMove(e) {\r\n        \r\n        Recording.events.push({\r\n          type: \"mousedown\",\r\n          button: e.button,\r\n          clientX : e.clientX,\r\n          clientY : e.clientY,\r\n          shiftKey : e.shiftKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"mousemove\",\r\n      handler: function handleMouseMove(e) {\r\n        lastMouse  = {x : e.pageX, y :e.pageY};\r\n        Recording.events.push({\r\n          type: \"mousemove\",\r\n          clientX : e.clientX,\r\n          clientY : e.clientY,   \r\n          shiftKey : e.shiftKey,       \r\n          target: lastKeyClass,\r\n          x: e.pageX,\r\n          fileName : fileName,\r\n          y: e.pageY,\r\n          value: lastKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"dblclick\",\r\n      handler: function handleMouseMove(e) {\r\n        console.log(e);\r\n        Recording.events.push({\r\n          type: \"dblclick\",\r\n          button: e.button,\r\n          clientX : e.clientX,\r\n          clientY : e.clientY,\r\n          shiftKey : e.shiftKey,\r\n          altKey : e.altKey,\r\n          time: Date.now() - startTime,\r\n        });\r\n      },\r\n    },\r\n    {\r\n      eventName: \"click\",\r\n      handler: function handleClick(e) {\r\n        // if(name === \"ide\" || name === \"other\"){\r\n          if(e.target.className === \"cssfile\" || e.target.className === \"buttontext style\" || e.target.className === \"fab fa-css3-alt\") fileName = \"style.css\"\r\n          if(e.target.className === \"jsfile\" || e.target.className === \"buttontext script\" || e.target.className === \" fa-js-square\") fileName = \"script.js\" \r\n          if(e.target.className === \"htmlfile\" || e.target.className === \"buttontext html\" || e.target.className === \"fab fa-html5fab\") fileName = \"index.html\"\r\n          console.log(e.target.className);\r\n          Recording.events.push({\r\n            type: \"click\",\r\n            target: e.target.className,\r\n            x: e.pageX,\r\n            fileName: fileName,\r\n            y: e.pageY,\r\n            time: Date.now() - startTime,\r\n          });\r\n        //}\r\n      },\r\n    },\r\n    {\r\n      eventName: \"keyup\",\r\n      handler: function handleKeyPress(e) {\r\n        console.log(files[fileName])\r\n        if(name === \"ide\" || name === \"dsa\"){\r\n          lastKey = childValue\r\n          lastKeyClass = e.target.className\r\n          Recording.events.push({\r\n            type: \"keyup\",\r\n            target: e.target.className,\r\n            x: lastMouse.x,\r\n            y: lastMouse.y,\r\n            fileName: fileName,\r\n            value: (e.target.className === \"userInputArea\") ? e.target.value :files[fileName].value,\r\n            keyCode: e.keyCode,\r\n            time: Date.now() - startTime,\r\n          });\r\n        }\r\n      },\r\n    },\r\n    // {\r\n    //   eventName: \"keydown\",\r\n    //   handler: function handleKeyPress(e) {\r\n    //       let innerText = document.getElementsByClassName(\"canvas_text\")[0].innerText\r\n    //       Recording.events.push({\r\n    //         type: \"keydown\",\r\n    //         key: e.key,\r\n    //         shiftKey: e.shiftKey,\r\n    //         innerText: innerText,\r\n    //         time: Date.now() - startTime,\r\n    //       });\r\n        \r\n    //   },\r\n    // },\r\n    {\r\n      eventName: \"click\",\r\n      handler: function handleClick(e) {\r\n        if(name === \"dsa\"){\r\n          if(language  === \"c\" || \r\n          language === \"c99\" || \r\n          language === \"cpp\" || \r\n          language === \"cpp14\" || \r\n          language === \"cpp17\" || \r\n          language === \"python2\" || \r\n          language === \"python3\"){\r\n            fileName = language\r\n          }\r\n          Recording.events.push({\r\n            type: \"click\",\r\n            target: e.target.className,\r\n            x: e.pageX,\r\n            fileName :fileName,\r\n            y: e.pageY,\r\n            value:files[fileName].value,\r\n            time: Date.now() - startTime,\r\n          });\r\n        }\r\n      },\r\n      },\r\n    {\r\n      eventName:\"output\",\r\n      handler:function handleChange(e){\r\n        Recording.events.push({\r\n          type:\"output\",\r\n          target:\"userOutputArea\",\r\n          time:Date.now() - startTime,\r\n          value:e.detail.output\r\n        })\r\n      }\r\n    }\r\n  ];\r\n\r\n  const Mp3Recorder = new MicRecorder({ \r\n    bitRate: 128,\r\n    prefix: \"data:audio/wav;base64,\"\r\n  });\r\n\r\n  function listen(eventName, handler) {\r\n    return document.documentElement.addEventListener(eventName, handler, true);\r\n  }\r\n\r\n  function startRecording() {\r\n    startTime = Date.now()\r\n    Recording.events = [];\r\n    handlers.map((x) => listen(x.eventName, x.handler));\r\n    Mp3Recorder\r\n    .start()\r\n    .then(() => {\r\n      console.log(\"Started recording\")\r\n    }).catch((e) => console.error(e));\r\n  }\r\n\r\n  function removeListener(eventName, handler) {\r\n    return document.documentElement.removeEventListener(\r\n      eventName,\r\n      handler,\r\n      true\r\n    );\r\n  }\r\n\r\n  function handleClick(e) {\r\n    e.preventDefault();\r\n    document.getElementsByClassName(\"record\")[0].style.display=\"none\"\r\n    document.getElementsByClassName(\"stop-record\")[0].style.display=\"block\"\r\n    startRecording();\r\n    console.log(\"The Button was clicked.\");\r\n  }\r\n\r\n  function stopRecording() {\r\n    // stop recording\r\n    handlers.map((x) => removeListener(x.eventName, x.handler));\r\n    localStorage.setItem(\"recording\", JSON.stringify(Recording))\r\n    document.getElementsByClassName(\"stop-record\")[0].style.display=\"none\"\r\n    document.getElementsByClassName(\"record\")[0].style.display=\"block\"\r\n    const recordingString = JSON.stringify(Recording)\r\n    console.log(Recording)\r\n    firebase.firestore().collection(\"events\").add({\r\n      recordingString,\r\n      createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n      name:props.location.state.lectureName,\r\n      creator:props.location.state.lectureCreator,\r\n      type:props.location.state.lectureType\r\n    }).then((result) => {\r\n      localStorage.setItem(\"recordingId\", JSON.stringify(result.id))\r\n      firebase.firestore().collection(\"recordIndex\").add({\r\n        createdAt: firebase.firestore.FieldValue.serverTimestamp(),\r\n        name:props.location.state.lectureName,\r\n        type:props.location.state.lectureType,\r\n        creator:props.location.state.lectureCreator,\r\n        language:language,\r\n        id:result.id\r\n      }).then((result) => {\r\n        console.log(\"Recording Tally Saved\")\r\n      })\r\n      console.log(\"Recording Saved\")\r\n      let audioString\r\n      Mp3Recorder\r\n      .stop()\r\n      .getMp3()\r\n      .then(([buffer, blob]) => {\r\n        new File(buffer, 'me-at-thevoice.mp3', {\r\n          type: blob.type,\r\n          lastModified: Date.now()\r\n        })\r\n        var reader = new FileReader();\r\n        reader.readAsDataURL(blob);\r\n        reader.onloadend = () => {\r\n            audioString =(reader.result)\r\n            var storageRef = firebase.storage().ref();\r\n              const id = JSON.parse(localStorage.getItem(\"recordingId\"))\r\n              //console.log(id)\r\n              localStorage.removeItem('recordingId');\r\n              var audioRef = storageRef.child(id);\r\n              audioRef.putString(audioString, 'data_url').then((snapshot) => {\r\n                alert('Audio saved!');\r\n              }).catch((e) => {\r\n                console.log(e)\r\n              })\r\n          }\r\n      }).catch((e) => console.log(e));\r\n    })\r\n  }\r\n\r\n  function handleStop(e) {\r\n    e.preventDefault();\r\n    stopRecording();\r\n    console.log(\"Recording Stopped.\");\r\n  }\r\n  //console.log(Recording)\r\n  return (\r\n    <>\r\n      <div className=\"recorder\">\r\n      <div className = \"recorder-button\">\r\n        <i className=\"fas fa-microphone record\" onClick={handleClick}></i>\r\n        <i className=\"fas fa-microphone-slash stop-record\" onClick={handleStop}></i>\r\n      </div>\r\n      {name === \"dra\" ?<div className = \"chalk\"> <ChalkBoard/> </div>:<IDE name={name} language={language} parentCallBack = {callbackFunction}/>}\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport {useHistory} from \"react-router-dom\";\r\n\r\nexport default function StartingComponent() {\r\n\r\n    const history = useHistory();\r\n    const navigateToLectureScreen = () => history.push('/lectures')\r\n    const navigateToDrawBoard = () => history.push('/drawboard')\r\n    const navigateToDrawBoardStart = () => history.push('/emitter')\r\n    const navigateToDrawBoardEnd = () => history.push('/receiver')\r\n    const navigateToRecorderDraw = () => history.push('/recorder/drawboard');\r\n    const navigateToRecordForm = () => history.push('/recordform');\r\n    const navigateToPlayerDraw = () => history.push('/videoplayer/drawboard');\r\n    return (\r\n        <>\r\n        <button className = \"recordWebD\" onClick={navigateToRecordForm}>Recorder A Lecture</button>\r\n        {/* <button className = \"recordOther\" onClick={navigateToRecorderOther}>Recorder with Other</button> */}\r\n        <button className = \"playWebD\" onClick={navigateToLectureScreen}>Watch lectures </button>\r\n        {/* <button className = \"playOther\" onClick={navigateToPlayerOther}>Player with Other</button> */}\r\n        <button onClick={navigateToDrawBoard}>Drawing Board</button>\r\n        <button className = \"recordWebD\" onClick={navigateToRecorderDraw}>Recorder with Drawing Board</button>\r\n        {/* <button className = \"recordOther\" onClick={navigateToRecorderOther}>Recorder with Other</button> */}\r\n        <button className = \"playWebD\" onClick={navigateToDrawBoardStart}>Drawing Board Start</button>\r\n        <button className = \"playWebD\" onClick={navigateToDrawBoardEnd}>Drawing Board End</button>\r\n        </>\r\n    )\r\n}","import React, { useEffect} from 'react'\r\nimport {useHistory} from \"react-router-dom\";\r\nimport \"./style.css\"\r\nfunction RecorderForm() {\r\n    const history = useHistory();\r\n    let lectureName;\r\n    let lectureType;\r\n    let lectureCreator;\r\n    let languageType;\r\n    const navigateToRecorderWeb = () => history.push({\r\n        pathname:'/recorder',\r\n        state:{lectureType,lectureName, lectureCreator, languageType}}\r\n    );\r\n\r\n    const languageList = {\r\n        \"Python 2\": \"python2\", \r\n        C: \"c\",\r\n        \"C-99\": \"c99\",\r\n        \"C++\": \"cpp\",\r\n        \"C++ 14\": \"cpp14\",\r\n        \"C++ 17\": \"cpp17\",\r\n        \"Python 3\": \"python3\",\r\n      };\r\n    \r\n\r\n    useEffect(() => {\r\n\r\n        const select = document.getElementById(\"language\");\r\n        for (let key in languageList) {\r\n          var option = document.createElement(\"option\");\r\n          option.text = key;\r\n          option.value = languageList[key];\r\n          option.className = languageList[key];\r\n          select.add(option);\r\n        }\r\n\r\n        const type = document.getElementById(\"lectureType\")\r\n        const name = document.getElementById(\"lectureName\")\r\n        const creator = document.getElementById(\"creator\")\r\n        const button = document.getElementById(\"submit\")\r\n\r\n        button.addEventListener(\"click\", () => {\r\n            lectureType = type.value\r\n            lectureName = name.value\r\n            lectureCreator = creator.value\r\n            if(lectureType === \"dsa\"){\r\n                languageType = select.value\r\n            }else{\r\n                languageType = ''\r\n            }\r\n        })\r\n        type.addEventListener(\"change\", (e) =>{\r\n            if(e.target.value === \"dsa\"){\r\n                select.style.display = \"block\"\r\n            }else{\r\n                select.style.display = \"none\"\r\n            }\r\n        })\r\n    },[])\r\n\r\n    return (\r\n        <>\r\n        <form>\r\n            <input id=\"lectureName\" placeholder=\"Lecture Title\"/>\r\n            <input id=\"creator\" placeholder=\"Creator\"/>\r\n            <select name=\"language\" id=\"language\"></select>\r\n            <select id=\"lectureType\">\r\n                <option value=\"ide\">Web Developerment</option>\r\n                <option value=\"dsa\">DSA</option>\r\n                <option value=\"dra\">Chalk Board</option>\r\n            </select>\r\n            <button type=\"button\"  onClick={navigateToRecorderWeb} id=\"submit\">Submit</button>\r\n        </form>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default RecorderForm","import React, { useEffect, useState } from \"react\";\r\nimport IDE from \"../IDE\";\r\nimport files from \"../assets/files\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { js, css, html, outputModalTrue, outputModalFalse, setSrcDocs } from \"../actions\";\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore';\r\nimport 'firebase/storage';\r\nimport \"./style.css\";\r\nimport ChalkBoard from \"../ChalkBoard/index\";\r\nimport img from \"../assets/Gear-0.2s-200px.png\"\r\n\r\nfunction Preloader(){\r\n  return(\r\n    <div className = \"loader\">\r\n       <div className =\"preloader\">\r\n        <div className = \"load\">\r\n\t         <img src= {img} border=\"0\"/>\r\n        </div>\r\n       </div>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default function Video(props) {\r\n  const name = props.location.state.type.slice(0,3)\r\n  const language = props.location.state.type.slice(3, 10)\r\n  console.log(name)\r\n  const [refresh, setRefresh] = useState(\"\");\r\n  const dispatch = useDispatch();\r\n  let drawingEvent=''\r\n  const [drawing, setDrawing] = useState('')\r\n  \r\n  useEffect(() => {\r\n    let offsetPlay = 0;\r\n    localStorage.setItem(\"lastSessionTimeStamp\", JSON.stringify(offsetPlay));\r\n    const videoPlayer = document.getElementsByClassName('videoplayer')[0]\r\n    const playButton = document.getElementsByClassName(\"playButton\")[0]\r\n    // fetch recording from local storage\r\n    let recording = { events: [] };\r\n    const recordingJsonValue = localStorage.getItem(\"recording\");\r\n    //const audioValue = JSON.parse(localStorage.getItem(\"file\"));\r\n    const id = (props.location.state.id)\r\n    firebase.firestore().collection('events').where(firebase.firestore.FieldPath.documentId(), '==', id).get()\r\n    .then((snap) => {\r\n        snap.forEach((doc) => {\r\n             console.log(doc.data())\r\n             recording = JSON.parse(doc.data().recordingString)\r\n        })\r\n      }).catch((err) => {\r\n        console.log(err)\r\n      })\r\n\r\n    if (recordingJsonValue != null) recording = JSON.parse(recordingJsonValue);\r\n\r\n    // console.log(recording);\r\n\r\n    var storageRef = firebase.storage().ref();\r\n    storageRef.child((id)).getDownloadURL().then((url) => {\r\n      audioPlayer.src = url\r\n      localStorage.setItem(\"url\", url)\r\n    }).catch((e) => {\r\n      console.log(e)\r\n    })\r\n\r\n    //fake cursor for playing\r\n    const fakeCursor = document.createElement(\"div\");\r\n    document.getElementById(\"root\").appendChild(fakeCursor);\r\n    fakeCursor.style.display = 'none'\r\n    const audioPlayer = document.getElementById(\"audio_player\")\r\n    var startPlay;\r\n    // console.log(playButton)\r\n    audioPlayer.addEventListener(\"onclick\", (e) => {\r\n      console.log(\"Click on the audioPlayer\")\r\n      console.log(e)\r\n    })\r\n\r\n    fakeCursor.className = \"customCursor\";\r\n    \r\n    var i = 0;\r\n    var paused = false;\r\n\r\n    audioPlayer.addEventListener(\"canplay\", () => {\r\n      document.getElementsByClassName(\"player-content\")[0].style.display = \"block\";\r\n      document.getElementsByClassName(\"loader\")[0].style.display = \"none\";\r\n      console.log(\"loaded\")\r\n    })\r\n  \r\n    audioPlayer.addEventListener(\"play\", () => {\r\n      playButton.style.display=\"none\"\r\n      playfunction();\r\n      console.log(\"audio play\")\r\n    })\r\n\r\n    audioPlayer.addEventListener(\"pause\", () => {\r\n      console.log(\"clicked pause\");\r\n      pausefunction();\r\n    })\r\n    \r\n    audioPlayer.addEventListener(\"ended\", () => {\r\n      pausefunction();\r\n      console.log(\"ended audio\")\r\n    })\r\n\r\n    audioPlayer.addEventListener(\"seeking\", () => {\r\n      fakeCursor.style.display = 'none';\r\n      pausefunction()\r\n      audioPlayer.pause()\r\n      //returns the time at which the audio is after seeking it\r\n      const curTime = audioPlayer.currentTime\r\n     \r\n      //TODO: Implement binary search or lower bound\r\n      for(let x=0;x<recording.events.length;x++){\r\n        if(recording.events[x].time>curTime*1000){\r\n          i=x;\r\n          break;\r\n        }\r\n      }\r\n\r\n      console.log(i)\r\n      console.log(recording.events[i].time)\r\n      console.log(curTime)\r\n      //localStorage.setItem(\"lastSessionTimeStamp\", JSON.stringify(recording.events[i].time))\r\n      if( recording.events[i].time>(curTime*1000)){\r\n        localStorage.setItem(\"lastSessionTimeStamp\", recording.events[i].time)\r\n      }else{\r\n        localStorage.setItem(\"lastSessionTimeStamp\", curTime*1000)\r\n      }\r\n      //handlePlayerClick()\r\n    })\r\n\r\n    playButton.addEventListener(\"click\", () => {\r\n      playButton.style.display=\"none\"\r\n      videoPlayer.style.display=\"flex\"\r\n      audioPlayer.play();\r\n      playfunction();\r\n    })\r\n\r\n    function pausefunction() {\r\n      fakeCursor.style.display = 'none';\r\n      paused = true;\r\n      localStorage.setItem(\"lastSessionTimeStamp\", JSON.stringify(offsetPlay));\r\n    }\r\n\r\n\r\n    function playfunction() {\r\n       \r\n      if( document.getElementsByClassName(\"videoscreen\")[0] != null) document.getElementsByClassName(\"videoscreen\")[0].className = \"visiblescreen\";\r\n       //append fake cursor when user clicks play button\r\n       fakeCursor.style.display = 'block';\r\n       startPlay = Date.now()\r\n       paused = false;\r\n       var frames;\r\n       //draw event to play all events in requestAnimationFrames\r\n       function draw() {\r\n           //select an event and check if its empty\r\n           let event = recording.events[i];\r\n           if (!event) {\r\n             return;\r\n           }\r\n\r\n           if(localStorage.getItem(\"lastSessionTimeStamp\") !== null){\r\n            offsetPlay = JSON.parse(localStorage.getItem(\"lastSessionTimeStamp\")) + Date.now() - startPlay;\r\n           }\r\n           else{\r\n            offsetPlay = (Date.now() - startPlay) * 1;\r\n           }\r\n\r\n         if (event.time <= offsetPlay) {\r\n           //draws event amd matches with listner\r\n           drawEvent(event, fakeCursor);\r\n           i++;\r\n         }\r\n\r\n         \r\n         if (i >= recording.events.length || paused) {\r\n           clearInterval(frames);\r\n          //  if(i >= (recording.events.length - 1)){\r\n          //    paused = true\r\n          //  }\r\n         } \r\n     };\r\n\r\n     frames = setInterval(() => {\r\n       if(!paused) draw();\r\n     }, 1)\r\n    }\r\n\r\n    \r\n    function handleButtonEvents(target) {\r\n      switch (target) {\r\n        case \"outputtext\":\r\n             dispatch(setSrcDocs());\r\n             dispatch(outputModalTrue());\r\n          break;\r\n        case \"output\":\r\n            dispatch(setSrcDocs());\r\n            dispatch(outputModalTrue());\r\n         break;\r\n        case \"buttontext output\":\r\n            dispatch(setSrcDocs());\r\n            dispatch(outputModalTrue());\r\n         break;\r\n        case \"fas fa-play\":\r\n          dispatch(setSrcDocs());\r\n          dispatch(outputModalTrue());\r\n          break;\r\n        case \"fas fa-window-close\":\r\n             dispatch(outputModalFalse());\r\n          break;\r\n        case \"style.css\":\r\n            dispatch(css());             \r\n         break;\r\n        case \"buttontext style\":\r\n          dispatch(css());             \r\n         break;\r\n        case \"index.html\":\r\n            dispatch(html());     \r\n         break;\r\n        case \"script.js\":\r\n            dispatch(js());\r\n         break;\r\n        case \"buttontext script\":\r\n            dispatch(js());\r\n         break;\r\n        default: \r\n          break;\r\n      }\r\n    }\r\n\r\n    function drawEvent(event, fakeCursor) {\r\n      if (event.type === \"mousedown\") {\r\n        let eve = new PointerEvent(\"pointerdown\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: event.button,\r\n          clientX : event.clientX,\r\n          clientY : event.clientY,\r\n          shiftKey : event.shiftKey,\r\n        });\r\n\r\n        if(document.getElementsByClassName(\"excalidraw__canvas\")[0])document.getElementsByClassName(\"excalidraw__canvas\")[0].dispatchEvent(eve);\r\n\r\n      }\r\n      else if (event.type === \"mousemove\") {\r\n        // TODO: Add e.buttons too\r\n        let eve = new PointerEvent(\"pointermove\", {\r\n          bubbles: true,\r\n          cancelable: true,\r\n          button: event.button,\r\n          clientX : event.clientX,\r\n          clientY : event.clientY,\r\n          shiftKey : event.shiftKey,\r\n        });\r\n\r\n        if(document.getElementsByClassName(\"excalidraw__canvas\")[0]){\r\n          document.getElementsByClassName(\"excalidraw__canvas\")[0].dispatchEvent(eve);\r\n        }\r\n        \r\n       //document.getElementsByClassName(\"cursor\")[0].style.top = JSON.stringify(event.y) + \"px\";\r\n        fakeCursor.style.left = JSON.stringify(event.x) + \"px\";\r\n        fakeCursor.style.top = JSON.stringify(event.y) + \"px\";\r\n        const path = event.target;\r\n        handleButtonEvents(event.fileName);\r\n        var tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n\r\n        }\r\n      }\r\n      else if (event.type === \"keydown\") {\r\n        if(document.getElementsByClassName(\"canvas_text\")[0]){\r\n          document.getElementsByClassName(\"canvas_text\")[0].innerText =  event.innerText;\r\n        } \r\n      }\r\n      else if (event.type === \"mouseup\") {\r\n        \r\n        let eve = new PointerEvent(\"pointerup\", {\r\n          bubbles: true,\r\n          cancelable: true\r\n        });\r\n        if(document.getElementsByClassName(\"excalidraw__canvas\")[0])document.getElementsByClassName(\"excalidraw__canvas\")[0].dispatchEvent(eve);\r\n      }\r\n      else if (event.type === \"click\") {\r\n \r\n        if(document.getElementsByClassName(event.target)[0] !== undefined){\r\n          let clickEvent = new MouseEvent(\"click\", {\r\n            pageX: event.x,\r\n            pageY: event.y, \r\n            bubbles: true,\r\n            cancelable: true,\r\n          });\r\n          document.getElementsByClassName(event.target)[0].dispatchEvent(clickEvent);\r\n        }\r\n        if(event.target === \"rectangle\" || event.target === \"ellipse\" || event.target === \"arrow\" || event.target === \"selection\") document.getElementsByClassName(event.target)[0].click();\r\n        flashClass(fakeCursor, \"click\");\r\n        tar = document.getElementsByClassName(event.target)[0];\r\n        if(tar !=  null){\r\n          handleButtonEvents(event.fileName);\r\n          handleButtonEvents(event.target);\r\n          flashClass(tar, \"clicked\");\r\n        }\r\n      }\r\n      else if (event.type === \"keyup\") {\r\n        const path = event.target;\r\n        tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n          if(path===\"userInputArea\"){\r\n            tar.value = event.value\r\n            }else{\r\n              files[event.fileName].value = event.value;\r\n              handleButtonEvents(event.fileName);\r\n              setRefresh(event.value);\r\n            }\r\n        }\r\n      }\r\n      else if(event.type === \"output\") {\r\n        const path = event.target;\r\n        tar = document.getElementsByClassName(path)[0];\r\n        if (tar != null) {\r\n          tar.focus();\r\n          if(path===\"userOutputArea\"){\r\n            tar.value = event.value\r\n            }\r\n        }\r\n      }\r\n      else{\r\n        setDrawing(event)\r\n      }\r\n    }\r\n\r\n    function flashClass(el, className) {\r\n      el.classList.add(className);\r\n      setTimeout(function () {\r\n        el.classList.remove(className);\r\n      }, 200);\r\n    }\r\n  }, []);\r\n\r\n  return (\r\n    <div>\r\n      <Preloader/>\r\n      <div className = \"player-content\">\r\n      <div className = \"videoscreen\">\r\n      {/* <IDE name={name} refresh = {refresh}/> */}\r\n      {name===\"dra\" ? <div className=\"chalk\"><ChalkBoard event={drawing}/></div>: <IDE name={name} language={language} refresh={refresh}/>}\r\n      </div>\r\n      <div className=\"playButton\">\r\n      <div className=\"container\"><a className=\"button button-play\"></a></div>\r\n      </div>\r\n      <div className = \"videoplayer\"> \r\n      <audio id=\"audio_player\" controls=\"controls\" controlsList=\"nodownload\"></audio>\r\n      </div>\r\n      </div>\r\n\r\n    </div>\r\n  );\r\n}\r\n","export default \"data:image/png;base64,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\"","import React, { useEffect, useRef, useState } from \"react\";\r\nimport ChalkBoard from '../ChalkBoard/index'\r\nimport Peer from \"simple-peer\"\r\nimport * as io from 'socket.io-client'\r\nimport \"./style.css\"\r\n\r\nfunction LiveClassEmitter() {\r\n    const socketRef = useRef()\r\n    const [ stream, setStream ] = useState()\r\n    //while in development mode change document.location.origin to http://localhost:5000\r\n    socketRef.current = io.connect(document.location.origin)\r\n    // Record each type of event\r\n\tconst myVideo = useRef()\r\n    const userVideo = useRef()\r\n\tconst connectionRef= useRef()\r\n    useEffect(() => {\r\n        //console.log(document.location.origin)\r\n        navigator.mediaDevices.getUserMedia({ video:true,audio: true}).then((stream) => {\r\n            setStream(stream)\r\n            myVideo.current.srcObject = stream\r\n        })\r\n    }, [])\r\n\r\n    const handlers = [\r\n        {\r\n            eventName: \"mouseup\",\r\n            handler: function handleMouseMove(e) {\r\n                const data = {\r\n                    type: \"mouseup\"\r\n                }\r\n                sendData(data)\r\n            }\r\n        },\r\n        {\r\n            eventName: \"mousedown\",\r\n            handler: function handleMouseMove(e) {\r\n                const data = {\r\n                    type: \"mousedown\",\r\n                    button: e.button,\r\n                    clientX : e.clientX,\r\n                    clientY : e.clientY,\r\n                    shiftKey : e.shiftKey,\r\n                }\r\n                sendData(data)\r\n            },\r\n        },\r\n        {\r\n            eventName: \"mousemove\",\r\n            handler: function handleMouseMove(e) {\r\n                const data = {\r\n                    type: \"mousemove\",\r\n                    button: e.button,\r\n                    clientX : e.clientX,\r\n                    clientY : e.clientY,\r\n                    shiftKey : e.shiftKey,  \r\n                }\r\n                sendData(data)\r\n            },\r\n        },\r\n        {\r\n            eventName: \"click\",\r\n            handler: function handleMouseMove(e) {\r\n                const data = {\r\n                    type: \"click\",\r\n                    target: e.target.className,\r\n                }\r\n                sendData(data)\r\n\r\n            },\r\n        },\r\n        {\r\n            eventName: \"keydown\",\r\n            handler: function handleMouseMove(e) {\r\n                let innerText = document.getElementsByClassName(\"canvas_text\")[0].innerText\r\n                const data = {\r\n                    type: \"keydown\",\r\n                    target: e.target.className,\r\n                    shiftKey: e.shiftKey,\r\n                    innerText: innerText,\r\n                }\r\n                sendData(data)\r\n            },\r\n        }\r\n    ];\r\n\r\n    function sendData(data) {\r\n        socketRef.current.emit(\"emitData\", {data})\r\n    }\r\n\r\n    function removeListener(eventName, handler) {\r\n        return document.documentElement.removeEventListener(\r\n          eventName,\r\n          handler,\r\n          true\r\n        );\r\n      }\r\n    \r\n    function listen(eventName, handler) {\r\n        return document.documentElement.addEventListener(eventName, handler, true);\r\n    }\r\n\r\n    function startLive() {\r\n        const peer = new Peer({\r\n            initiator: true,\r\n            trickle: false,\r\n            stream: stream\r\n        })\r\n        peer.on(\"signal\", (data) => {\r\n            socketRef.current.emit(\"sendStream\", {\r\n                signalData: data\r\n            })\r\n        })\r\n\r\n        socketRef.current.on(\"callAccepted\", (data) => {\r\n            peer.signal(data.signalData)\r\n\t\t})\r\n\r\n        handlers.map((x) => listen(x.eventName, x.handler));\r\n    }\r\n\r\n    function stopLive() {\r\n        handlers.map((x) => removeListener(x.eventName, x.handler));\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div style={{display:\"flex\", flexDirection:\"row-reverse\"}}>\r\n            <div className=\"streamingWindow\">\r\n                <div className=\"buttons\">\r\n                <button className=\"startButton\" onClick = {() => startLive()}>Start</button>\r\n                <button className=\"stopButton\" onClick = {() => stopLive()}>Stop</button>\r\n                </div>\r\n                {stream && <video playsInline muted ref={myVideo} autoPlay style={{width: \"300px\" }} />}\r\n            </div>\r\n            </div>\r\n            <div  className = \"chalk\"><ChalkBoard/></div>\r\n        </>\r\n    )\r\n}\r\n\r\nexport default LiveClassEmitter","import React, { useEffect,useState,useRef} from \"react\";\r\nimport ChalkBoard from '../ChalkBoard/index'\r\nimport Peer from \"simple-peer\"\r\nimport * as io from 'socket.io-client'\r\n\r\nfunction LiveClassReceiver() {\r\n    const socketRef = useRef()\r\n    const [ stream, setStream ] = useState()\r\n    const [ receivingCall, setReceivingCall ] = useState(false)\r\n    const [ callerSignal, setCallerSignal ] = useState()\r\n    const userVideo = useRef()\r\n    //while in development mode change document.location.origin to http://localhost:5000\r\n    socketRef.current = io.connect(document.location.origin)\r\n    useEffect(() => {\r\n        const button = document.getElementsByClassName(\"answerButton\")[0]\r\n        button.style.display = \"none\"\r\n        socketRef.current.on(\"receiveData\", ({data}) => {\r\n            button.style.display=\"block\"\r\n            if (data.type === \"mousedown\") {\r\n                console.log(\"mousedown\")\r\n                let eve = new PointerEvent(\"pointerdown\", {\r\n                  bubbles: true,\r\n                  cancelable: true,\r\n                  button: data.button,\r\n                  clientX : data.clientX,\r\n                  clientY : data.clientY,\r\n                  shiftKey : data.shiftKey,\r\n                });\r\n        \r\n                if(document.getElementsByClassName(\"excalidraw__canvas\")[0])document.getElementsByClassName(\"excalidraw__canvas\")[0].dispatchEvent(eve);\r\n        \r\n              }\r\n              else if (data.type === \"mousemove\") {\r\n                console.log(\"mousemove\")\r\n                // TODO: Add e.buttons too\r\n                let eve = new PointerEvent(\"pointermove\", {\r\n                  bubbles: true,\r\n                  cancelable: true,\r\n                  button: data.button,\r\n                  clientX : data.clientX,\r\n                  clientY : data.clientY,\r\n                  shiftKey : data.shiftKey,\r\n                });\r\n        \r\n                if(document.getElementsByClassName(\"excalidraw__canvas\")[0])document.getElementsByClassName(\"excalidraw__canvas\")[0].dispatchEvent(eve);\r\n                const path = data.target;\r\n                var tar = document.getElementsByClassName(path)[0];\r\n                if (tar != null) {\r\n                  tar.focus();\r\n        \r\n                }\r\n              }\r\n              else if (data.type === \"mouseup\") {\r\n                console.log(\"mouseup\")\r\n                let eve = new PointerEvent(\"pointerup\", {\r\n                  bubbles: true,\r\n                  cancelable: true\r\n                });\r\n                if(document.getElementsByClassName(\"excalidraw__canvas\")[0])document.getElementsByClassName(\"excalidraw__canvas\")[0].dispatchEvent(eve);\r\n              }\r\n              else if (data.type === \"click\") {\r\n                if(document.getElementsByClassName(data.target)[0] !== undefined && document.getElementsByClassName(data.target)[0].nodeName === \"INPUT\"){\r\n                    document.getElementsByClassName(data.target)[0].click();\r\n                }\r\n              }\r\n              else if(data.type === \"keydown\"){\r\n                if(document.getElementsByClassName(\"canvas_text\")[0]){\r\n                  document.getElementsByClassName(\"canvas_text\")[0].innerText =  data.innerText;\r\n                } \r\n              }\r\n        })\r\n\r\n        socketRef.current.on(\"emitStream\", (data) => {\r\n          setCallerSignal(data.signalData)\r\n        })\r\n\r\n    }, [])\r\n    \r\n    function answerCall() {\r\n      const peer = new Peer({\r\n        initiator: false,\r\n        trickle: false,\r\n        stream: stream\r\n      })\r\n\r\n      peer.on(\"signal\", (data) => {\r\n        socketRef.current.emit(\"answerCall\", { \r\n          signalData: data\r\n        })\r\n      })\r\n  \r\n      peer.signal(callerSignal)\r\n\r\n      peer.on(\"stream\", (stream) => {\r\n        setStream(stream)\r\n        userVideo.current.srcObject = stream\r\n      })\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <div style={{display:\"flex\", flexDirection:\"row-reverse\"}}>\r\n            <div style={{position:\"absolute\", zIndex:\"3\",display:\"flex\", flexDirection:\"column\", paddingRight:\"10px\"}}>\r\n            <button className=\"answerButton\" onClick={() => answerCall()}>Answer Call</button>\r\n            {stream && <video playsInline ref={userVideo} autoPlay style={{width: \"300px\" }} />}\r\n            </div>\r\n            </div>\r\n            <div  className = \"chalk\"><ChalkBoard/></div>\r\n        </>\r\n    )\r\n}\r\n\r\n\r\n\r\nexport default LiveClassReceiver","import React, {useEffect} from 'react'\r\nimport {useHistory} from \"react-router-dom\";\r\nimport './styles.css'\r\nfunction Card(props) {\r\n    const history = useHistory();\r\n    useEffect(() => {\r\n        const mainWindow = document.getElementById(\"lectureCard\")\r\n        for(let i=0;i<props.lectures.length;i++){\r\n            var lecture = document.createElement(\"div\")\r\n            var playButton = document.createElement(\"button\")\r\n            playButton.textContent = \"Play Lecture\"\r\n            var nameHeading = document.createElement(\"h3\")\r\n            var creator = document.createElement(\"h3\")\r\n            var language = document.createElement(\"h3\")\r\n            nameHeading.className = \"nameoflecture\"\r\n            creator.className = \"nameofcreator\" \r\n            language.className = \"languageofLecture\"\r\n            playButton.className = props.lectures[i].type + props.lectures[i].language\r\n            playButton.id = props.lectures[i].id \r\n            lecture.appendChild(nameHeading)\r\n            lecture.appendChild(creator)\r\n            lecture.appendChild(language)\r\n            lecture.appendChild(playButton)\r\n            nameHeading.innerHTML = \"Name - \" + props.lectures[i].name\r\n            creator.innerHTML = \"Creator - \" + props.lectures[i].creator\r\n            if(props.lectures[i].language !== ''){\r\n                language.innerHTML = \"Language- \" + props.lectures[i].language\r\n            }\r\n            mainWindow.appendChild(lecture)\r\n        }\r\n        \r\n        mainWindow.addEventListener(\"click\", (e) => {\r\n            const id =  e.target.id\r\n            console.log(e)\r\n            const type =  e.target.className\r\n            console.log(type)\r\n             console.log(e.target.id)\r\n            history.push({\r\n                pathname:'/videoplayer',\r\n                state:{id,type}\r\n            });\r\n        })\r\n    },[])   \r\n\r\n    return (\r\n        <>\r\n        <div id=\"lectureCard\">\r\n        </div>\r\n        </>    \r\n    )\r\n}\r\n\r\nexport default Card","import React , {useEffect, useLayoutEffect, useState} from 'react'\r\nimport firebase from 'firebase/app'\r\nimport 'firebase/firestore'\r\nimport Card from '../Card/card'\r\nfunction Preloader(){\r\n    return(\r\n      <div className = \"loader\">\r\n      <div className =\"preloader\">\r\n      <div className =\"box\">\r\n          <div className =\"box__inner\">\r\n              <div className =\"box__back-flap\"></div>\r\n              <div className =\"box__right-flap\"></div>\r\n              <div className =\"box__front-flap\"></div>\r\n              <div className =\"box__left-flap\"></div>\r\n              <div className =\"box__front\"></div>\r\n          </div>\r\n      </div>\r\n      <div className =\"box\">\r\n          <div className =\"box__inner\">\r\n              <div className =\"box__back-flap\"></div>\r\n              <div className =\"box__right-flap\"></div>\r\n              <div className =\"box__front-flap\"></div>\r\n              <div className =\"box__left-flap\"></div>\r\n              <div className =\"box__front\"></div>\r\n          </div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n      <div className =\"line\">\r\n          <div className =\"line__inner\"></div>\r\n      </div>\r\n  </div>\r\n  </div>\r\n    )\r\n  }\r\nfunction AllLectures() {\r\n    const [lectures, setLectures] = useState('')\r\n    let lecturesArray = []\r\n    const [isLoading, setLoading] = useState(false)\r\n    useEffect(() => {\r\n        firebase.firestore().collection(\"recordIndex\").orderBy(\"createdAt\", 'desc')\r\n        .limit(10).get().then((result) => {\r\n            result.forEach((doc) => {\r\n                lecturesArray.push(doc.data())\r\n            })\r\n            setLectures(lecturesArray)\r\n            setLoading(true)\r\n        })\r\n    }, [])\r\n    return (\r\n        <>\r\n            {isLoading ? <Card lectures={lectures}/>: <Preloader/>}\r\n        </>\r\n    )\r\n}\r\n\r\nexport default AllLectures","const filenameReducer = (state = \"index.html\", action) => {\r\n  switch (action.type) {\r\n    case \"js\":\r\n      state = \"script.js\";\r\n      return state;\r\n    case \"css\":\r\n      state = \"style.css\";\r\n      return state;\r\n    case \"html\":\r\n      state = \"index.html\";\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\n\r\nconst languageReducer = (state=\"c\", action) => {\r\n  switch(action.type){\r\n    case \"c\":\r\n      state = \"c\";\r\n      return state;\r\n    case \"c99\":\r\n      state = \"c99\";\r\n      return state;\r\n    case \"cpp\":\r\n      state = \"cpp\";\r\n      return state;\r\n    case \"cpp14\":\r\n      state = \"cpp14\";\r\n      return state;\r\n    case \"cpp17\":\r\n      state = \"cpp17\";\r\n      return state;\r\n    case \"python2\":\r\n      state = \"python2\";\r\n      return state;\r\n    case \"python3\":\r\n      state = \"python3\";\r\n      return state;\r\n    default:\r\n      return state;\r\n  }\r\n}\r\n\r\nexport default filenameReducer;\r\n","import files from \"../assets/files\"\r\n\r\nconst outputModalReducer = (state = false, action) => {\r\n\r\n    switch(action.type){\r\n        case \"outputtrue\":\r\n            state = true\r\n            return state\r\n        case \"outputfalse\":\r\n            state = false\r\n            return state\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport const outputSrcReducer = (state = \"\", action) => {\r\n\r\n    switch(action.type){\r\n        case \"setSrcdoc\":\r\n            state = `\r\n            <html>\r\n              <body>${files[\"index.html\"].value}</body>\r\n              <style>${files[\"style.css\"].value}</style>\r\n              <script>${files[\"script.js\"].value}</script>\r\n            </html>\r\n          `\r\n            return state\r\n        default:\r\n            return state\r\n    }\r\n}\r\n\r\nexport default outputModalReducer;","const languageReducer = (state=\"c\", action) => {\r\n    switch(action.type){\r\n      case \"c\":\r\n        state = \"c\";\r\n        return state;\r\n      case \"c99\":\r\n        state = \"c99\";\r\n        return state;\r\n      case \"cpp\":\r\n        state = \"cpp\";\r\n        return state;\r\n      case \"cpp14\":\r\n        state = \"cpp14\";\r\n        return state;\r\n      case \"cpp17\":\r\n        state = \"cpp17\";\r\n        return state;\r\n      case \"python2\":\r\n        state = \"python2\";\r\n        return state;\r\n      case \"python3\":\r\n        state = \"python3\";\r\n        return state;\r\n      default:\r\n        return state;\r\n    }\r\n  }\r\n  \r\n  export default languageReducer;\r\n  ","import filenameReducer from \"./filenameSelection\";\r\nimport outputModalReducer, { outputSrcReducer } from \"./outputModalReducer\";\r\nimport { combineReducers } from \"redux\";\r\nimport languageReducer from \"./languageSelection\";\r\nconst allReducers = combineReducers({\r\n    fileName: filenameReducer,\r\n    outputModal: outputModalReducer,\r\n    srcDocs: outputSrcReducer,\r\n    language:languageReducer\r\n})\r\n\r\nexport default allReducers;\r\n","import { BrowserRouter as Router, Route, Switch } from \"react-router-dom\";\r\nimport ChalkBoard from \"./ChalkBoard\"\r\nimport Recorder from \"./Recorder\";\r\nimport { createStore, compose, applyMiddleware} from 'redux';\r\nimport StartingComponent from './StartingComponent/startingCompoent'\r\nimport RecorderForm from './RecorderForm/recorderForm'\r\nimport Video from './Player';\r\nimport LiveClassEmitter from \"./LiveClasses/liveClassEmitter\";\r\nimport LiveClassReceiver from './LiveClasses/liveClassReceiver'\r\nimport AllLectures from './Lectures/allLectures'\r\nimport firebase from 'firebase/app';\r\nimport allReducer from './reducers';\r\nimport thunk from 'redux-thunk'\r\nimport { Provider } from 'react-redux';\r\nimport './App.css';\r\n\r\n\r\nconst firebaseConfig = {\r\n  apiKey: \"AIzaSyAp2cQvNNp8fUKOv6kO_7wR5IsKROCoh14\",\r\n  authDomain: \"engage-6ef42.firebaseapp.com\",\r\n  projectId: \"engage-6ef42\",\r\n  storageBucket: \"engage-6ef42.appspot.com\",\r\n  messagingSenderId: \"27842359842\",\r\n  appId: \"1:27842359842:web:e8f5b15f6a86ac66fa507b\",\r\n  measurementId: \"G-EVEY2DP36T\",\r\n};\r\n\r\nif (firebase.apps.length===0){\r\n  firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\nconst middleware = [thunk]\r\n\r\nconst composeEnhancer = window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__ || compose;\r\n\r\n\r\nconst store = createStore(\r\n  allReducer, \r\n  composeEnhancer(applyMiddleware(...middleware)),\r\n);\r\n\r\n\r\nfunction App() {\r\n  return (\r\n    <>\r\n        <Provider store={store}>\r\n    <Router>\r\n    <Switch>\r\n      <Route exact path = \"/\" component = {StartingComponent}/>\r\n      <Route exact path = \"/lectures\" component = {AllLectures} />\r\n      <Route exact path = \"/emitter\" component = {LiveClassEmitter}/>\r\n      <Route exact path = \"/receiver\" component = {LiveClassReceiver}/>\r\n      <Route exact path = \"/recordform\" component = {RecorderForm}/>\r\n      <Route exact path = \"/videoplayer\" component = {Video}/>\r\n      <Route exact path = \"/recorder\" component = {Recorder} ide=\"web\"/>\r\n      </Switch>\r\n    </Router>\r\n    </Provider>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\n\r\nReactDOM.render(<App />,\r\n  document.getElementById('root')\r\n);\r\n\r\n","import cssVariables from \"./css/variables.module.scss\";\r\nexport const APP_NAME = \"Excalidraw\";\r\nexport const DRAGGING_THRESHOLD = 10; // px\r\nexport const LINE_CONFIRM_THRESHOLD = 8; // px\r\nexport const ELEMENT_SHIFT_TRANSLATE_AMOUNT = 5;\r\nexport const ELEMENT_TRANSLATE_AMOUNT = 1;\r\nexport const TEXT_TO_CENTER_SNAP_THRESHOLD = 30;\r\nexport const SHIFT_LOCKING_ANGLE = Math.PI / 12;\r\nexport const CURSOR_TYPE = {\r\n    TEXT: \"text\",\r\n    CROSSHAIR: \"crosshair\",\r\n    GRABBING: \"grabbing\",\r\n    GRAB: \"grab\",\r\n    POINTER: \"pointer\",\r\n    MOVE: \"move\",\r\n    AUTO: \"\",\r\n};\r\nexport const POINTER_BUTTON = {\r\n    MAIN: 0,\r\n    WHEEL: 1,\r\n    SECONDARY: 2,\r\n    TOUCH: -1,\r\n};\r\nexport var EVENT;\r\n(function (EVENT) {\r\n    EVENT[\"COPY\"] = \"copy\";\r\n    EVENT[\"PASTE\"] = \"paste\";\r\n    EVENT[\"CUT\"] = \"cut\";\r\n    EVENT[\"KEYDOWN\"] = \"keydown\";\r\n    EVENT[\"KEYUP\"] = \"keyup\";\r\n    EVENT[\"MOUSE_MOVE\"] = \"mousemove\";\r\n    EVENT[\"RESIZE\"] = \"resize\";\r\n    EVENT[\"UNLOAD\"] = \"unload\";\r\n    EVENT[\"FOCUS\"] = \"focus\";\r\n    EVENT[\"BLUR\"] = \"blur\";\r\n    EVENT[\"DRAG_OVER\"] = \"dragover\";\r\n    EVENT[\"DROP\"] = \"drop\";\r\n    EVENT[\"GESTURE_END\"] = \"gestureend\";\r\n    EVENT[\"BEFORE_UNLOAD\"] = \"beforeunload\";\r\n    EVENT[\"GESTURE_START\"] = \"gesturestart\";\r\n    EVENT[\"GESTURE_CHANGE\"] = \"gesturechange\";\r\n    EVENT[\"POINTER_MOVE\"] = \"pointermove\";\r\n    EVENT[\"POINTER_UP\"] = \"pointerup\";\r\n    EVENT[\"STATE_CHANGE\"] = \"statechange\";\r\n    EVENT[\"WHEEL\"] = \"wheel\";\r\n    EVENT[\"TOUCH_START\"] = \"touchstart\";\r\n    EVENT[\"TOUCH_END\"] = \"touchend\";\r\n    EVENT[\"HASHCHANGE\"] = \"hashchange\";\r\n    EVENT[\"VISIBILITY_CHANGE\"] = \"visibilitychange\";\r\n    EVENT[\"SCROLL\"] = \"scroll\";\r\n})(EVENT || (EVENT = {}));\r\nexport const ENV = {\r\n    TEST: \"test\",\r\n    DEVELOPMENT: \"development\",\r\n};\r\nexport const CLASSES = {\r\n    SHAPE_ACTIONS_MENU: \"App-menu__left\",\r\n};\r\n// 1-based in case we ever do `if(element.fontFamily)`\r\nexport const FONT_FAMILY = {\r\n    Virgil: 1,\r\n    Helvetica: 2,\r\n    Cascadia: 3,\r\n};\r\nexport const THEME = {\r\n    LIGHT: \"light\",\r\n    DARK: \"dark\",\r\n};\r\nexport const WINDOWS_EMOJI_FALLBACK_FONT = \"Segoe UI Emoji\";\r\nexport const DEFAULT_FONT_SIZE = 20;\r\nexport const DEFAULT_FONT_FAMILY = FONT_FAMILY.Virgil;\r\nexport const DEFAULT_TEXT_ALIGN = \"left\";\r\nexport const DEFAULT_VERTICAL_ALIGN = \"top\";\r\nexport const DEFAULT_VERSION = \"{version}\";\r\nexport const CANVAS_ONLY_ACTIONS = [\"selectAll\"];\r\nexport const GRID_SIZE = 20; // TODO make it configurable?\r\nexport const MIME_TYPES = {\r\n    excalidraw: \"application/vnd.excalidraw+json\",\r\n    excalidrawlib: \"application/vnd.excalidrawlib+json\",\r\n    json: \"application/json\",\r\n    svg: \"image/svg+xml\",\r\n    png: \"image/png\",\r\n    jpg: \"image/jpeg\",\r\n    gif: \"image/gif\",\r\n    binary: \"application/octet-stream\",\r\n};\r\nexport const EXPORT_DATA_TYPES = {\r\n    excalidraw: \"excalidraw\",\r\n    excalidrawClipboard: \"excalidraw/clipboard\",\r\n    excalidrawLibrary: \"excalidrawlib\",\r\n};\r\nexport const EXPORT_SOURCE = window.location.origin;\r\nexport const STORAGE_KEYS = {\r\n    LOCAL_STORAGE_LIBRARY: \"excalidraw-library\",\r\n};\r\n// time in milliseconds\r\nexport const IMAGE_RENDER_TIMEOUT = 500;\r\nexport const TAP_TWICE_TIMEOUT = 300;\r\nexport const TOUCH_CTX_MENU_TIMEOUT = 500;\r\nexport const TITLE_TIMEOUT = 10000;\r\nexport const TOAST_TIMEOUT = 5000;\r\nexport const VERSION_TIMEOUT = 30000;\r\nexport const SCROLL_TIMEOUT = 100;\r\nexport const ZOOM_STEP = 0.1;\r\n// Report a user inactive after IDLE_THRESHOLD milliseconds\r\nexport const IDLE_THRESHOLD = 60000;\r\n// Report a user active each ACTIVE_THRESHOLD milliseconds\r\nexport const ACTIVE_THRESHOLD = 3000;\r\nexport const MODES = {\r\n    VIEW: \"viewMode\",\r\n    ZEN: \"zenMode\",\r\n    GRID: \"gridMode\",\r\n};\r\nexport const THEME_FILTER = cssVariables.themeFilter;\r\nexport const URL_QUERY_KEYS = {\r\n    addLibrary: \"addLibrary\",\r\n};\r\nexport const URL_HASH_KEYS = {\r\n    addLibrary: \"addLibrary\",\r\n};\r\nexport const DEFAULT_UI_OPTIONS = {\r\n    canvasActions: {\r\n        changeViewBackgroundColor: true,\r\n        clearCanvas: true,\r\n        export: { saveFileToDisk: true },\r\n        loadScene: true,\r\n        saveToActiveFile: true,\r\n        theme: true,\r\n        saveAsImage: true,\r\n    },\r\n};\r\nexport const MQ_MAX_WIDTH_PORTRAIT = 730;\r\nexport const MQ_MAX_WIDTH_LANDSCAPE = 1000;\r\nexport const MQ_MAX_HEIGHT_LANDSCAPE = 500;\r\nexport const MAX_DECIMALS_FOR_SVG_EXPORT = 2;\r\nexport const EXPORT_SCALES = [1, 2, 3];\r\nexport const DEFAULT_EXPORT_PADDING = 10; // px\r\nexport const DEFAULT_MAX_IMAGE_WIDTH_OR_HEIGHT = 1440;\r\nexport const ALLOWED_IMAGE_MIME_TYPES = [\r\n    MIME_TYPES.png,\r\n    MIME_TYPES.jpg,\r\n    MIME_TYPES.svg,\r\n    MIME_TYPES.gif,\r\n];\r\nexport const MAX_ALLOWED_FILE_BYTES = 2 * 1024 * 1024;\r\nexport const SVG_NS = \"http://www.w3.org/2000/svg\";\r\n","import { deflate, inflate } from \"pako\";\r\nimport { encryptData, decryptData } from \"./encryption\";\r\n// -----------------------------------------------------------------------------\r\n// byte (binary) strings\r\n// -----------------------------------------------------------------------------\r\n// fast, Buffer-compatible implem\r\nexport const toByteString = (data) => {\r\n    return new Promise((resolve, reject) => {\r\n        const blob = typeof data === \"string\"\r\n            ? new Blob([new TextEncoder().encode(data)])\r\n            : new Blob([data instanceof Uint8Array ? data : new Uint8Array(data)]);\r\n        const reader = new FileReader();\r\n        reader.onload = (event) => {\r\n            if (!event.target || typeof event.target.result !== \"string\") {\r\n                return reject(new Error(\"couldn't convert to byte string\"));\r\n            }\r\n            resolve(event.target.result);\r\n        };\r\n        reader.readAsBinaryString(blob);\r\n    });\r\n};\r\nconst byteStringToArrayBuffer = (byteString) => {\r\n    const buffer = new ArrayBuffer(byteString.length);\r\n    const bufferView = new Uint8Array(buffer);\r\n    for (let i = 0, len = byteString.length; i < len; i++) {\r\n        bufferView[i] = byteString.charCodeAt(i);\r\n    }\r\n    return buffer;\r\n};\r\nconst byteStringToString = (byteString) => {\r\n    return new TextDecoder(\"utf-8\").decode(byteStringToArrayBuffer(byteString));\r\n};\r\n// -----------------------------------------------------------------------------\r\n// base64\r\n// -----------------------------------------------------------------------------\r\n/**\r\n * @param isByteString set to true if already byte string to prevent bloat\r\n *  due to reencoding\r\n */\r\nexport const stringToBase64 = async (str, isByteString = false) => {\r\n    return isByteString ? window.btoa(str) : window.btoa(await toByteString(str));\r\n};\r\n// async to align with stringToBase64\r\nexport const base64ToString = async (base64, isByteString = false) => {\r\n    return isByteString\r\n        ? window.atob(base64)\r\n        : byteStringToString(window.atob(base64));\r\n};\r\n/**\r\n * Encodes (and potentially compresses via zlib) text to byte string\r\n */\r\nexport const encode = async ({ text, compress, }) => {\r\n    let deflated;\r\n    if (compress !== false) {\r\n        try {\r\n            deflated = await toByteString(deflate(text));\r\n        }\r\n        catch (error) {\r\n            console.error(\"encode: cannot deflate\", error);\r\n        }\r\n    }\r\n    return {\r\n        version: \"1\",\r\n        encoding: \"bstring\",\r\n        compressed: !!deflated,\r\n        encoded: deflated || (await toByteString(text)),\r\n    };\r\n};\r\nexport const decode = async (data) => {\r\n    let decoded;\r\n    switch (data.encoding) {\r\n        case \"bstring\":\r\n            // if compressed, do not double decode the bstring\r\n            decoded = data.compressed\r\n                ? data.encoded\r\n                : await byteStringToString(data.encoded);\r\n            break;\r\n        default:\r\n            throw new Error(`decode: unknown encoding \"${data.encoding}\"`);\r\n    }\r\n    if (data.compressed) {\r\n        return inflate(new Uint8Array(byteStringToArrayBuffer(decoded)), {\r\n            to: \"string\",\r\n        });\r\n    }\r\n    return decoded;\r\n};\r\n// -----------------------------------------------------------------------------\r\nconst CONCAT_BUFFERS_VERSION = 1;\r\n/** how many bytes we use to encode how many bytes the next chunk has.\r\n * Corresponds to DataView setter methods (setUint32, setUint16, etc).\r\n *\r\n * NOTE ! values must not be changed, which would be backwards incompatible !\r\n */\r\nconst VERSION_DATAVIEW_BYTES = 4;\r\nconst NEXT_CHUNK_SIZE_DATAVIEW_BYTES = 4;\r\n// -----------------------------------------------------------------------------\r\nconst DATA_VIEW_BITS_MAP = { 1: 8, 2: 16, 4: 32 };\r\n/**\r\n * abstraction over DataView that serves as a typed getter/setter in case\r\n * you're using constants for the byte size and want to ensure there's no\r\n * discrepenancy in the encoding across refactors.\r\n *\r\n * DataView serves for an endian-agnostic handling of numbers in ArrayBuffers.\r\n */\r\nfunction dataView(buffer, bytes, offset, value) {\r\n    if (value != null) {\r\n        if (value > Math.pow(2, DATA_VIEW_BITS_MAP[bytes]) - 1) {\r\n            throw new Error(`attempting to set value higher than the allocated bytes (value: ${value}, bytes: ${bytes})`);\r\n        }\r\n        const method = `setUint${DATA_VIEW_BITS_MAP[bytes]}`;\r\n        new DataView(buffer.buffer)[method](offset, value);\r\n        return buffer;\r\n    }\r\n    const method = `getUint${DATA_VIEW_BITS_MAP[bytes]}`;\r\n    return new DataView(buffer.buffer)[method](offset);\r\n}\r\n// -----------------------------------------------------------------------------\r\n/**\r\n * Resulting concatenated buffer has this format:\r\n *\r\n * [\r\n *   VERSION chunk (4 bytes)\r\n *   LENGTH chunk 1 (4 bytes)\r\n *   DATA chunk 1 (up to 2^32 bits)\r\n *   LENGTH chunk 2 (4 bytes)\r\n *   DATA chunk 2 (up to 2^32 bits)\r\n *   ...\r\n * ]\r\n *\r\n * @param buffers each buffer (chunk) must be at most 2^32 bits large (~4GB)\r\n */\r\nconst concatBuffers = (...buffers) => {\r\n    const bufferView = new Uint8Array(VERSION_DATAVIEW_BYTES +\r\n        NEXT_CHUNK_SIZE_DATAVIEW_BYTES * buffers.length +\r\n        buffers.reduce((acc, buffer) => acc + buffer.byteLength, 0));\r\n    let cursor = 0;\r\n    // as the first chunk we'll encode the version for backwards compatibility\r\n    dataView(bufferView, VERSION_DATAVIEW_BYTES, cursor, CONCAT_BUFFERS_VERSION);\r\n    cursor += VERSION_DATAVIEW_BYTES;\r\n    for (const buffer of buffers) {\r\n        dataView(bufferView, NEXT_CHUNK_SIZE_DATAVIEW_BYTES, cursor, buffer.byteLength);\r\n        cursor += NEXT_CHUNK_SIZE_DATAVIEW_BYTES;\r\n        bufferView.set(buffer, cursor);\r\n        cursor += buffer.byteLength;\r\n    }\r\n    return bufferView;\r\n};\r\n/** can only be used on buffers created via `concatBuffers()` */\r\nconst splitBuffers = (concatenatedBuffer) => {\r\n    const buffers = [];\r\n    let cursor = 0;\r\n    // first chunk is the version (ignored for now)\r\n    cursor += VERSION_DATAVIEW_BYTES;\r\n    while (true) {\r\n        const chunkSize = dataView(concatenatedBuffer, NEXT_CHUNK_SIZE_DATAVIEW_BYTES, cursor);\r\n        cursor += NEXT_CHUNK_SIZE_DATAVIEW_BYTES;\r\n        buffers.push(concatenatedBuffer.slice(cursor, cursor + chunkSize));\r\n        cursor += chunkSize;\r\n        if (cursor >= concatenatedBuffer.byteLength) {\r\n            break;\r\n        }\r\n    }\r\n    return buffers;\r\n};\r\n// helpers for (de)compressing data with JSON metadata including encryption\r\n// -----------------------------------------------------------------------------\r\n/** @private */\r\nconst _encryptAndCompress = async (data, encryptionKey) => {\r\n    const { encryptedBuffer, iv } = await encryptData(encryptionKey, deflate(data));\r\n    return { iv, buffer: new Uint8Array(encryptedBuffer) };\r\n};\r\n/**\r\n * The returned buffer has following format:\r\n * `[]` refers to a buffers wrapper (see `concatBuffers`)\r\n *\r\n * [\r\n *   encodingMetadataBuffer,\r\n *   iv,\r\n *   [\r\n *      contentsMetadataBuffer\r\n *      contentsBuffer\r\n *   ]\r\n * ]\r\n */\r\nexport const compressData = async (dataBuffer, options) => {\r\n    const fileInfo = {\r\n        version: 2,\r\n        compression: \"pako@1\",\r\n        encryption: \"AES-GCM\",\r\n    };\r\n    const encodingMetadataBuffer = new TextEncoder().encode(JSON.stringify(fileInfo));\r\n    const contentsMetadataBuffer = new TextEncoder().encode(JSON.stringify(options.metadata || null));\r\n    const { iv, buffer } = await _encryptAndCompress(concatBuffers(contentsMetadataBuffer, dataBuffer), options.encryptionKey);\r\n    return concatBuffers(encodingMetadataBuffer, iv, buffer);\r\n};\r\n/** @private */\r\nconst _decryptAndDecompress = async (iv, decryptedBuffer, decryptionKey, isCompressed) => {\r\n    decryptedBuffer = new Uint8Array(await decryptData(iv, decryptedBuffer, decryptionKey));\r\n    if (isCompressed) {\r\n        return inflate(decryptedBuffer);\r\n    }\r\n    return decryptedBuffer;\r\n};\r\nexport const decompressData = async (bufferView, options) => {\r\n    // first chunk is encoding metadata (ignored for now)\r\n    const [encodingMetadataBuffer, iv, buffer] = splitBuffers(bufferView);\r\n    const encodingMetadata = JSON.parse(new TextDecoder().decode(encodingMetadataBuffer));\r\n    try {\r\n        const [contentsMetadataBuffer, contentsBuffer] = splitBuffers(await _decryptAndDecompress(iv, buffer, options.decryptionKey, !!encodingMetadata.compression));\r\n        const metadata = JSON.parse(new TextDecoder().decode(contentsMetadataBuffer));\r\n        return {\r\n            /** metadata source is always JSON so we can decode it here */\r\n            metadata,\r\n            /** data can be anything so the caller must decode it */\r\n            data: contentsBuffer,\r\n        };\r\n    }\r\n    catch (error) {\r\n        console.error(`Error during decompressing and decrypting the file.`, encodingMetadata);\r\n        throw error;\r\n    }\r\n};\r\n// -----------------------------------------------------------------------------\r\n"],"sourceRoot":""}